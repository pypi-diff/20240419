# Comparing `tmp/timetagger-23.9.2.tar.gz` & `tmp/timetagger-24.4.1.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "timetagger-23.9.2.tar", last modified: Wed Sep  6 10:57:51 2023, max compression
+gzip compressed data, was "timetagger-24.4.1.tar", last modified: Fri Apr 19 12:09:49 2024, max compression
```

## Comparing `timetagger-23.9.2.tar` & `timetagger-24.4.1.tar`

### file list

```diff
@@ -1,94 +1,97 @@
-drwxr-xr-x   0 almar      (501) staff       (20)        0 2023-09-06 10:57:51.021411 timetagger-23.9.2/
--rw-r--r--   0 almar      (501) staff       (20)    35149 2022-01-20 21:21:29.000000 timetagger-23.9.2/LICENSE
--rw-r--r--   0 almar      (501) staff       (20)       43 2022-01-20 21:21:29.000000 timetagger-23.9.2/MANIFEST.in
--rw-r--r--   0 almar      (501) staff       (20)     1283 2023-09-06 10:57:51.021259 timetagger-23.9.2/PKG-INFO
--rw-r--r--   0 almar      (501) staff       (20)     5929 2023-08-15 09:09:45.000000 timetagger-23.9.2/README.md
--rw-r--r--   0 almar      (501) staff       (20)       90 2023-01-27 12:55:59.000000 timetagger-23.9.2/requirements.txt
--rw-r--r--   0 almar      (501) staff       (20)       38 2023-09-06 10:57:51.021455 timetagger-23.9.2/setup.cfg
--rw-r--r--   0 almar      (501) staff       (20)     1940 2022-06-20 14:16:21.000000 timetagger-23.9.2/setup.py
-drwxr-xr-x   0 almar      (501) staff       (20)        0 2023-09-06 10:57:50.935588 timetagger-23.9.2/timetagger/
--rw-r--r--   0 almar      (501) staff       (20)      379 2023-09-06 10:57:42.000000 timetagger-23.9.2/timetagger/__init__.py
--rw-r--r--   0 almar      (501) staff       (20)     8737 2023-09-05 21:38:07.000000 timetagger-23.9.2/timetagger/__main__.py
--rw-r--r--   0 almar      (501) staff       (20)     3596 2023-02-14 14:19:12.000000 timetagger-23.9.2/timetagger/_config.py
-drwxr-xr-x   0 almar      (501) staff       (20)        0 2023-09-06 10:57:50.945525 timetagger-23.9.2/timetagger/app/
--rw-r--r--   0 almar      (501) staff       (20)        0 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/app/__init__.py
--rw-r--r--   0 almar      (501) staff       (20)     2176 2022-09-30 21:45:34.000000 timetagger-23.9.2/timetagger/app/_template.html
--rw-r--r--   0 almar      (501) staff       (20)     9936 2023-06-27 13:52:42.000000 timetagger-23.9.2/timetagger/app/app.scss
--rw-r--r--   0 almar      (501) staff       (20)     2588 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/app/demo.md
--rw-r--r--   0 almar      (501) staff       (20)   161907 2023-09-06 10:37:41.000000 timetagger-23.9.2/timetagger/app/dialogs.py
--rw-r--r--   0 almar      (501) staff       (20)    11668 2023-09-06 10:57:30.000000 timetagger-23.9.2/timetagger/app/dt.py
--rw-r--r--   0 almar      (501) staff       (20)   133392 2023-09-06 10:57:30.000000 timetagger-23.9.2/timetagger/app/front.py
--rw-r--r--   0 almar      (501) staff       (20)     3452 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/app/index.md
--rw-r--r--   0 almar      (501) staff       (20)   307554 2022-12-20 21:16:28.000000 timetagger-23.9.2/timetagger/app/jspdf.js
--rw-r--r--   0 almar      (501) staff       (20)      604 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/app/sandbox.md
--rw-r--r--   0 almar      (501) staff       (20)    42696 2023-09-05 23:03:50.000000 timetagger-23.9.2/timetagger/app/stores.py
--rw-r--r--   0 almar      (501) staff       (20)     3884 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/app/sw.js
--rw-r--r--   0 almar      (501) staff       (20)     1048 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/app/timetagger_manifest.json
--rw-r--r--   0 almar      (501) staff       (20)     9580 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/app/tools.py
--rw-r--r--   0 almar      (501) staff       (20)    37303 2023-09-05 23:10:00.000000 timetagger-23.9.2/timetagger/app/utils.py
-drwxr-xr-x   0 almar      (501) staff       (20)        0 2023-09-06 10:57:50.958896 timetagger-23.9.2/timetagger/common/
--rw-r--r--   0 almar      (501) staff       (20)    20352 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/common/SpaceMono-Regular-webfont.woff
--rw-r--r--   0 almar      (501) staff       (20)   467474 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/common/Ubuntu-C-normal.js
--rw-r--r--   0 almar      (501) staff       (20)   350420 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/common/Ubuntu-C.ttf
--rw-r--r--   0 almar      (501) staff       (20)   472014 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/common/Ubuntu-R-normal.js
--rw-r--r--   0 almar      (501) staff       (20)   353824 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/common/Ubuntu-R.ttf
--rw-r--r--   0 almar      (501) staff       (20)    28276 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/common/UbuntuCondensed_latin.woff2
--rw-r--r--   0 almar      (501) staff       (20)    34016 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/common/Ubuntu_latin.woff2
--rw-r--r--   0 almar      (501) staff       (20)        0 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/common/__init__.py
--rw-r--r--   0 almar      (501) staff       (20)     7291 2022-09-19 23:07:38.000000 timetagger-23.9.2/timetagger/common/_style_embed.scss
--rw-r--r--   0 almar      (501) staff       (20)      762 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/common/_template.html
--rw-r--r--   0 almar      (501) staff       (20)    25629 2022-06-22 09:31:02.000000 timetagger-23.9.2/timetagger/common/bcrypt.js
--rw-r--r--   0 almar      (501) staff       (20)    19190 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/common/clearly-602.ogg
--rw-r--r--   0 almar      (501) staff       (20)     3850 2023-09-02 22:39:23.000000 timetagger-23.9.2/timetagger/common/cred.html
--rw-r--r--   0 almar      (501) staff       (20)    31383 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/common/eventually-590.ogg
--rw-r--r--   0 almar      (501) staff       (20)    79100 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/common/fa-solid-900.woff2
--rw-r--r--   0 almar      (501) staff       (20)      156 2022-06-22 09:31:03.000000 timetagger-23.9.2/timetagger/common/sha1.html
--rw-r--r--   0 almar      (501) staff       (20)     8275 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/common/wind-up-1-534.ogg
-drwxr-xr-x   0 almar      (501) staff       (20)        0 2023-09-06 10:57:51.016820 timetagger-23.9.2/timetagger/images/
--rw-r--r--   0 almar      (501) staff       (20)        0 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/images/__init__.py
--rw-r--r--   0 almar      (501) staff       (20)      394 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/images/_names.txt
--rw-r--r--   0 almar      (501) staff       (20)      929 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/images/_update_icons.py
--rw-r--r--   0 almar      (501) staff       (20)     2503 2023-02-14 14:19:12.000000 timetagger-23.9.2/timetagger/images/_update_paper.py
--rw-r--r--   0 almar      (501) staff       (20)    21898 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/images/favicon.ico
--rw-r--r--   0 almar      (501) staff       (20)  1507334 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/images/paper0.jpg
--rw-r--r--   0 almar      (501) staff       (20)    72499 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/images/paper1.jpg
--rw-r--r--   0 almar      (501) staff       (20)    72499 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/images/paper2.jpg
--rw-r--r--   0 almar      (501) staff       (20)    30158 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/images/paper3.jpg
--rw-r--r--   0 almar      (501) staff       (20)     3026 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/images/timetagger128_sf.png
--rw-r--r--   0 almar      (501) staff       (20)      653 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/images/timetagger16_sf.png
--rw-r--r--   0 almar      (501) staff       (20)     3528 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/images/timetagger192_bd.png
--rw-r--r--   0 almar      (501) staff       (20)     1259 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/images/timetagger192_sd.png
--rw-r--r--   0 almar      (501) staff       (20)     4677 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/images/timetagger192_sf.png
--rw-r--r--   0 almar      (501) staff       (20)     8086 2022-09-30 21:45:34.000000 timetagger-23.9.2/timetagger/images/timetagger192_sf_dot.png
--rw-r--r--   0 almar      (501) staff       (20)     1350 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/images/timetagger192_sl.png
--rw-r--r--   0 almar      (501) staff       (20)     1366 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/images/timetagger192_sm.png
--rw-r--r--   0 almar      (501) staff       (20)     3658 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/images/timetagger192_tg.png
--rw-r--r--   0 almar      (501) staff       (20)     6024 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/images/timetagger256_sf.png
--rw-r--r--   0 almar      (501) staff       (20)     1020 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/images/timetagger32_sf.png
--rw-r--r--   0 almar      (501) staff       (20)     1375 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/images/timetagger48_sf.png
--rw-r--r--   0 almar      (501) staff       (20)     8844 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/images/timetagger512_bd.png
--rw-r--r--   0 almar      (501) staff       (20)    13363 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/images/timetagger512_sf.png
--rw-r--r--   0 almar      (501) staff       (20)     3115 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/images/timetagger512_sm.png
--rw-r--r--   0 almar      (501) staff       (20)     1606 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/images/timetagger64_sf.png
--rw-r--r--   0 almar      (501) staff       (20)      934 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/images/timetagger_sd.svg
--rw-r--r--   0 almar      (501) staff       (20)    21898 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/images/timetagger_sf.ico
--rw-r--r--   0 almar      (501) staff       (20)      935 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/images/timetagger_sl.svg
--rw-r--r--   0 almar      (501) staff       (20)     6585 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/images/timetagger_wd.svg
--rw-r--r--   0 almar      (501) staff       (20)     6585 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/images/timetagger_wl.svg
-drwxr-xr-x   0 almar      (501) staff       (20)        0 2023-09-06 10:57:51.018863 timetagger-23.9.2/timetagger/pages/
--rw-r--r--   0 almar      (501) staff       (20)        0 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/pages/__init__.py
--rw-r--r--   0 almar      (501) staff       (20)     4508 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/pages/account.md
--rw-r--r--   0 almar      (501) staff       (20)     1286 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/pages/index.md
--rw-r--r--   0 almar      (501) staff       (20)     2519 2022-10-24 20:10:30.000000 timetagger-23.9.2/timetagger/pages/login.md
--rw-r--r--   0 almar      (501) staff       (20)      273 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/pages/logout.md
-drwxr-xr-x   0 almar      (501) staff       (20)        0 2023-09-06 10:57:51.021014 timetagger-23.9.2/timetagger/server/
--rw-r--r--   0 almar      (501) staff       (20)      303 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/server/__init__.py
--rw-r--r--   0 almar      (501) staff       (20)    15646 2023-02-14 14:19:12.000000 timetagger-23.9.2/timetagger/server/_apiserver.py
--rw-r--r--   0 almar      (501) staff       (20)     6772 2023-02-14 14:19:12.000000 timetagger-23.9.2/timetagger/server/_assets.py
--rw-r--r--   0 almar      (501) staff       (20)     4934 2022-01-20 21:21:29.000000 timetagger-23.9.2/timetagger/server/_utils.py
-drwxr-xr-x   0 almar      (501) staff       (20)        0 2023-09-06 10:57:50.937005 timetagger-23.9.2/timetagger.egg-info/
--rw-r--r--   0 almar      (501) staff       (20)     1283 2023-09-06 10:57:50.000000 timetagger-23.9.2/timetagger.egg-info/PKG-INFO
--rw-r--r--   0 almar      (501) staff       (20)     2604 2023-09-06 10:57:50.000000 timetagger-23.9.2/timetagger.egg-info/SOURCES.txt
--rw-r--r--   0 almar      (501) staff       (20)        1 2023-09-06 10:57:50.000000 timetagger-23.9.2/timetagger.egg-info/dependency_links.txt
--rw-r--r--   0 almar      (501) staff       (20)       90 2023-09-06 10:57:50.000000 timetagger-23.9.2/timetagger.egg-info/requires.txt
--rw-r--r--   0 almar      (501) staff       (20)       11 2023-09-06 10:57:50.000000 timetagger-23.9.2/timetagger.egg-info/top_level.txt
+drwxr-xr-x   0 almar      (501) staff       (20)        0 2024-04-19 12:09:49.873738 timetagger-24.4.1/
+-rw-r--r--   0 almar      (501) staff       (20)    35149 2022-01-20 21:21:29.000000 timetagger-24.4.1/LICENSE
+-rw-r--r--   0 almar      (501) staff       (20)       43 2022-01-20 21:21:29.000000 timetagger-24.4.1/MANIFEST.in
+-rw-r--r--   0 almar      (501) staff       (20)     1283 2024-04-19 12:09:49.873600 timetagger-24.4.1/PKG-INFO
+-rw-r--r--   0 almar      (501) staff       (20)     6157 2023-10-18 12:58:42.000000 timetagger-24.4.1/README.md
+drwxr-xr-x   0 almar      (501) staff       (20)        0 2024-04-19 12:09:49.802754 timetagger-24.4.1/contrib/
+drwxr-xr-x   0 almar      (501) staff       (20)        0 2024-04-19 12:09:49.806133 timetagger-24.4.1/contrib/multiuser_tweaks/
+-rwxr-xr-x   0 almar      (501) staff       (20)    12375 2024-04-19 11:26:35.000000 timetagger-24.4.1/contrib/multiuser_tweaks/timetagger_multiuser_tweaks.py
+-rw-r--r--   0 almar      (501) staff       (20)       90 2023-01-27 12:55:59.000000 timetagger-24.4.1/requirements.txt
+-rw-r--r--   0 almar      (501) staff       (20)       38 2024-04-19 12:09:49.873781 timetagger-24.4.1/setup.cfg
+-rw-r--r--   0 almar      (501) staff       (20)     2013 2024-04-19 11:26:35.000000 timetagger-24.4.1/setup.py
+drwxr-xr-x   0 almar      (501) staff       (20)        0 2024-04-19 12:09:49.806931 timetagger-24.4.1/timetagger/
+-rw-r--r--   0 almar      (501) staff       (20)      380 2024-04-19 12:08:33.000000 timetagger-24.4.1/timetagger/__init__.py
+-rw-r--r--   0 almar      (501) staff       (20)     8773 2024-04-19 12:04:28.000000 timetagger-24.4.1/timetagger/__main__.py
+-rw-r--r--   0 almar      (501) staff       (20)     3596 2024-04-17 14:20:59.000000 timetagger-24.4.1/timetagger/_config.py
+drwxr-xr-x   0 almar      (501) staff       (20)        0 2024-04-19 12:09:49.817752 timetagger-24.4.1/timetagger/app/
+-rw-r--r--   0 almar      (501) staff       (20)        0 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/app/__init__.py
+-rw-r--r--   0 almar      (501) staff       (20)     2176 2022-09-30 21:45:34.000000 timetagger-24.4.1/timetagger/app/_template.html
+-rw-r--r--   0 almar      (501) staff       (20)     9971 2023-11-16 12:27:08.000000 timetagger-24.4.1/timetagger/app/app.scss
+-rw-r--r--   0 almar      (501) staff       (20)     2588 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/app/demo.md
+-rw-r--r--   0 almar      (501) staff       (20)   168998 2024-04-19 12:08:49.000000 timetagger-24.4.1/timetagger/app/dialogs.py
+-rw-r--r--   0 almar      (501) staff       (20)    13229 2024-04-19 11:26:35.000000 timetagger-24.4.1/timetagger/app/dt.py
+-rw-r--r--   0 almar      (501) staff       (20)   141558 2024-04-19 11:26:35.000000 timetagger-24.4.1/timetagger/app/front.py
+-rw-r--r--   0 almar      (501) staff       (20)     3452 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/app/index.md
+-rw-r--r--   0 almar      (501) staff       (20)   307554 2022-12-20 21:16:28.000000 timetagger-24.4.1/timetagger/app/jspdf.js
+-rw-r--r--   0 almar      (501) staff       (20)      604 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/app/sandbox.md
+-rw-r--r--   0 almar      (501) staff       (20)    42696 2023-09-05 23:03:50.000000 timetagger-24.4.1/timetagger/app/stores.py
+-rw-r--r--   0 almar      (501) staff       (20)     3884 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/app/sw.js
+-rw-r--r--   0 almar      (501) staff       (20)     1048 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/app/timetagger_manifest.json
+-rw-r--r--   0 almar      (501) staff       (20)     9580 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/app/tools.py
+-rw-r--r--   0 almar      (501) staff       (20)    38847 2024-04-19 12:08:49.000000 timetagger-24.4.1/timetagger/app/utils.py
+drwxr-xr-x   0 almar      (501) staff       (20)        0 2024-04-19 12:09:49.835393 timetagger-24.4.1/timetagger/common/
+-rw-r--r--   0 almar      (501) staff       (20)    20352 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/common/SpaceMono-Regular-webfont.woff
+-rw-r--r--   0 almar      (501) staff       (20)   467474 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/common/Ubuntu-C-normal.js
+-rw-r--r--   0 almar      (501) staff       (20)   350420 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/common/Ubuntu-C.ttf
+-rw-r--r--   0 almar      (501) staff       (20)   472014 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/common/Ubuntu-R-normal.js
+-rw-r--r--   0 almar      (501) staff       (20)   353824 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/common/Ubuntu-R.ttf
+-rw-r--r--   0 almar      (501) staff       (20)    28276 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/common/UbuntuCondensed_latin.woff2
+-rw-r--r--   0 almar      (501) staff       (20)    34016 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/common/Ubuntu_latin.woff2
+-rw-r--r--   0 almar      (501) staff       (20)        0 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/common/__init__.py
+-rw-r--r--   0 almar      (501) staff       (20)     7291 2022-09-19 23:07:38.000000 timetagger-24.4.1/timetagger/common/_style_embed.scss
+-rw-r--r--   0 almar      (501) staff       (20)      762 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/common/_template.html
+-rw-r--r--   0 almar      (501) staff       (20)    25629 2022-06-22 09:31:02.000000 timetagger-24.4.1/timetagger/common/bcrypt.js
+-rw-r--r--   0 almar      (501) staff       (20)    19190 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/common/clearly-602.ogg
+-rw-r--r--   0 almar      (501) staff       (20)     3927 2023-11-17 07:55:03.000000 timetagger-24.4.1/timetagger/common/cred.html
+-rw-r--r--   0 almar      (501) staff       (20)    31383 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/common/eventually-590.ogg
+-rw-r--r--   0 almar      (501) staff       (20)    79100 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/common/fa-solid-900.woff2
+-rw-r--r--   0 almar      (501) staff       (20)      156 2022-06-22 09:31:03.000000 timetagger-24.4.1/timetagger/common/sha1.html
+-rw-r--r--   0 almar      (501) staff       (20)     8275 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/common/wind-up-1-534.ogg
+drwxr-xr-x   0 almar      (501) staff       (20)        0 2024-04-19 12:09:49.871086 timetagger-24.4.1/timetagger/images/
+-rw-r--r--   0 almar      (501) staff       (20)        0 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/images/__init__.py
+-rw-r--r--   0 almar      (501) staff       (20)      394 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/images/_names.txt
+-rw-r--r--   0 almar      (501) staff       (20)      929 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/images/_update_icons.py
+-rw-r--r--   0 almar      (501) staff       (20)     2503 2023-02-14 14:19:12.000000 timetagger-24.4.1/timetagger/images/_update_paper.py
+-rw-r--r--   0 almar      (501) staff       (20)    21898 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/images/favicon.ico
+-rw-r--r--   0 almar      (501) staff       (20)  1507334 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/images/paper0.jpg
+-rw-r--r--   0 almar      (501) staff       (20)    72499 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/images/paper1.jpg
+-rw-r--r--   0 almar      (501) staff       (20)    72499 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/images/paper2.jpg
+-rw-r--r--   0 almar      (501) staff       (20)    30158 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/images/paper3.jpg
+-rw-r--r--   0 almar      (501) staff       (20)     3026 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/images/timetagger128_sf.png
+-rw-r--r--   0 almar      (501) staff       (20)      653 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/images/timetagger16_sf.png
+-rw-r--r--   0 almar      (501) staff       (20)     3528 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/images/timetagger192_bd.png
+-rw-r--r--   0 almar      (501) staff       (20)     1259 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/images/timetagger192_sd.png
+-rw-r--r--   0 almar      (501) staff       (20)     4677 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/images/timetagger192_sf.png
+-rw-r--r--   0 almar      (501) staff       (20)     8086 2022-09-30 21:45:34.000000 timetagger-24.4.1/timetagger/images/timetagger192_sf_dot.png
+-rw-r--r--   0 almar      (501) staff       (20)     1350 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/images/timetagger192_sl.png
+-rw-r--r--   0 almar      (501) staff       (20)     1366 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/images/timetagger192_sm.png
+-rw-r--r--   0 almar      (501) staff       (20)     3658 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/images/timetagger192_tg.png
+-rw-r--r--   0 almar      (501) staff       (20)     6024 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/images/timetagger256_sf.png
+-rw-r--r--   0 almar      (501) staff       (20)     1020 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/images/timetagger32_sf.png
+-rw-r--r--   0 almar      (501) staff       (20)     1375 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/images/timetagger48_sf.png
+-rw-r--r--   0 almar      (501) staff       (20)     8844 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/images/timetagger512_bd.png
+-rw-r--r--   0 almar      (501) staff       (20)    13363 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/images/timetagger512_sf.png
+-rw-r--r--   0 almar      (501) staff       (20)     3115 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/images/timetagger512_sm.png
+-rw-r--r--   0 almar      (501) staff       (20)     1606 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/images/timetagger64_sf.png
+-rw-r--r--   0 almar      (501) staff       (20)      934 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/images/timetagger_sd.svg
+-rw-r--r--   0 almar      (501) staff       (20)    21898 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/images/timetagger_sf.ico
+-rw-r--r--   0 almar      (501) staff       (20)      935 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/images/timetagger_sl.svg
+-rw-r--r--   0 almar      (501) staff       (20)     6585 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/images/timetagger_wd.svg
+-rw-r--r--   0 almar      (501) staff       (20)     6585 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/images/timetagger_wl.svg
+drwxr-xr-x   0 almar      (501) staff       (20)        0 2024-04-19 12:09:49.872267 timetagger-24.4.1/timetagger/pages/
+-rw-r--r--   0 almar      (501) staff       (20)        0 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/pages/__init__.py
+-rw-r--r--   0 almar      (501) staff       (20)     4508 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/pages/account.md
+-rw-r--r--   0 almar      (501) staff       (20)     1286 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/pages/index.md
+-rw-r--r--   0 almar      (501) staff       (20)     2519 2022-10-24 20:10:30.000000 timetagger-24.4.1/timetagger/pages/login.md
+-rw-r--r--   0 almar      (501) staff       (20)      273 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/pages/logout.md
+drwxr-xr-x   0 almar      (501) staff       (20)        0 2024-04-19 12:09:49.873320 timetagger-24.4.1/timetagger/server/
+-rw-r--r--   0 almar      (501) staff       (20)      303 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/server/__init__.py
+-rw-r--r--   0 almar      (501) staff       (20)    15646 2023-02-14 14:19:12.000000 timetagger-24.4.1/timetagger/server/_apiserver.py
+-rw-r--r--   0 almar      (501) staff       (20)     6772 2023-02-14 14:19:12.000000 timetagger-24.4.1/timetagger/server/_assets.py
+-rw-r--r--   0 almar      (501) staff       (20)     4934 2022-01-20 21:21:29.000000 timetagger-24.4.1/timetagger/server/_utils.py
+drwxr-xr-x   0 almar      (501) staff       (20)        0 2024-04-19 12:09:49.807863 timetagger-24.4.1/timetagger.egg-info/
+-rw-r--r--   0 almar      (501) staff       (20)     1283 2024-04-19 12:09:49.000000 timetagger-24.4.1/timetagger.egg-info/PKG-INFO
+-rw-r--r--   0 almar      (501) staff       (20)     2660 2024-04-19 12:09:49.000000 timetagger-24.4.1/timetagger.egg-info/SOURCES.txt
+-rw-r--r--   0 almar      (501) staff       (20)        1 2024-04-19 12:09:49.000000 timetagger-24.4.1/timetagger.egg-info/dependency_links.txt
+-rw-r--r--   0 almar      (501) staff       (20)       90 2024-04-19 12:09:49.000000 timetagger-24.4.1/timetagger.egg-info/requires.txt
+-rw-r--r--   0 almar      (501) staff       (20)       11 2024-04-19 12:09:49.000000 timetagger-24.4.1/timetagger.egg-info/top_level.txt
```

### Comparing `timetagger-23.9.2/LICENSE` & `timetagger-24.4.1/LICENSE`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/PKG-INFO` & `timetagger-24.4.1/PKG-INFO`

 * *Files 8% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: timetagger
-Version: 23.9.2
+Version: 24.4.1
 Summary: Tag your time, get the insight - an open source time tracker for individuals
 Home-page: https://github.com/almarklein/timetagger
 Author: Almar Klein
 Author-email: almar.klein@gmail.com
 License: GPL-3.0
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: Intended Audience :: Developers
```

### Comparing `timetagger-23.9.2/README.md` & `timetagger-24.4.1/README.md`

 * *Files 5% similar despite different names*

```diff
@@ -55,19 +55,23 @@
 ```
 
 If the server runs on your local machine, you can use single-user mode out-of-the-box.
 
 
 ## Self-hosting your time tracker
 
-A docker image is provided via the [Github container registry](https://github.com/almarklein/timetagger/pkgs/container/timetagger), so you can use e.g. Docker-compose to easily host your
-own server.
-See the example [docker-compose.yml](https://github.com/almarklein/timetagger/blob/main/deploy/docker-compose.yml).
-See [this article](https://timetagger.app/articles/selfhost2/) for more information about self hosting.
+Docker images are provided via the [Github container registry](https://github.com/almarklein/timetagger/pkgs/container/timetagger),
+so you can use e.g. Docker-compose to easily host your own server.
 
+There are two variants, one that runs the server as root inside the container and a nonroot variant
+that runs as user 1000:
+- [docker-compose.yml](https://github.com/almarklein/timetagger/blob/main/deploy/docker-compose.yml)
+- [docker-compose.nonroot.yml](https://github.com/almarklein/timetagger/blob/main/deploy/docker-compose.nonroot.yml)
+ 
+See [this article](https://timetagger.app/articles/selfhost2/) for more information about self hosting.
 
 ### Authentication using credentials
 
 If you want multiple users, or if the server is not on localhost, you
 may want to provide the server with user credentials using an
 environment variable or a command line arg (see the
 [docs on config](https://timetagger.readthedocs.io/en/latest/libapi/)).
```

### Comparing `timetagger-23.9.2/setup.py` & `timetagger-24.4.1/setup.py`

 * *Files 4% similar despite different names*

```diff
@@ -29,14 +29,15 @@
 setup(
     name="timetagger",
     version=VERSION,
     packages=find_packages(exclude=["tests", "tests.*", "examples", "examples.*"]),
     package_data={
         f"timetagger.{x}": ["*"] for x in ["common", "images", "app", "pages"]
     },
+    scripts=["contrib/multiuser_tweaks/timetagger_multiuser_tweaks.py"],
     python_requires=">=3.6.0",
     install_requires=runtime_deps,
     license="GPL-3.0",
     description=short_description,
     long_description=long_description,
     long_description_content_type="text/markdown",
     author="Almar Klein",
```

### Comparing `timetagger-23.9.2/timetagger/__main__.py` & `timetagger-24.4.1/timetagger/__main__.py`

 * *Files 1% similar despite different names*

```diff
@@ -239,8 +239,10 @@
 
 
 CREDENTIALS = load_credentials()
 TRUSTED_PROXIES = load_trusted_proxies()
 
 
 if __name__ == "__main__":
-    asgineer.run(main_handler, "uvicorn", config.bind, log_level="warning")
+    asgineer.run(
+        "timetagger.__main__:main_handler", "uvicorn", config.bind, log_level="warning"
+    )
```

### Comparing `timetagger-23.9.2/timetagger/_config.py` & `timetagger-24.4.1/timetagger/_config.py`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/app/_template.html` & `timetagger-24.4.1/timetagger/app/_template.html`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/app/app.scss` & `timetagger-24.4.1/timetagger/app/app.scss`

 * *Files 2% similar despite different names*

```diff
@@ -1,16 +1,17 @@
 body { background: $bg1; }
 body.darkmode { background: $bg3; }
 
+main div.content { padding: 0; }  /* prevent empty space at bottom on iPhone */
+
 #canvas {
     position: absolute;
-    top: 0; left: 0; bottom: 0; right: 0; width: 100%; height: 100vh;
+    top: 0; left: 0; width: 100%; height: 100%;
     border: 0; margin: 0; padding: 0; outline: none;
     box-shadow: 0 0 4px rgba(0, 0, 0, 0.4);
-    border-radius: 2px;
     background: $sec2_clr;
 }
 body.darkmode #canvas { background: #171E28; }
 
 /**************** Popup Menu ****************/
 
 .dialog.verticalmenu {
```

### Comparing `timetagger-23.9.2/timetagger/app/demo.md` & `timetagger-24.4.1/timetagger/app/demo.md`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/app/dialogs.py` & `timetagger-24.4.1/timetagger/app/dialogs.py`

 * *Files 4% similar despite different names*

```diff
@@ -1075,9046 +1075,9489 @@
 00004320: 2020 203c 6469 763e 3c2f 6469 763e 0a20     <div></div>. 
 00004330: 2020 2020 2020 2020 2020 203c 6469 7620             <div 
 00004340: 7374 796c 653d 276d 696e 2d68 6569 6768  style='min-heigh
 00004350: 743a 2036 7078 3b27 3e3c 2f64 6976 3e0a  t: 6px;'></div>.
 00004360: 2020 2020 2020 2020 2020 2020 3c64 6976              <div
 00004370: 2063 6c61 7373 3d27 6772 6964 3527 3e0a   class='grid5'>.
 00004380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004390: 3c61 3e74 6f64 6179 203c 7370 616e 2063  <a>today <span c
-000043a0: 6c61 7373 3d27 6b65 7968 696e 7427 3e64  lass='keyhint'>d
-000043b0: 3c2f 7370 616e 3e3c 2f61 3e0a 2020 2020  </span></a>.    
-000043c0: 2020 2020 2020 2020 2020 2020 3c61 3e74              <a>t
-000043d0: 6869 7320 7765 656b 203c 7370 616e 2063  his week <span c
-000043e0: 6c61 7373 3d27 6b65 7968 696e 7427 3e77  lass='keyhint'>w
-000043f0: 3c2f 7370 616e 3e3c 2f61 3e0a 2020 2020  </span></a>.    
-00004400: 2020 2020 2020 2020 2020 2020 3c61 3e74              <a>t
-00004410: 6869 7320 6d6f 6e74 6820 3c73 7061 6e20  his month <span 
-00004420: 636c 6173 733d 276b 6579 6869 6e74 273e  class='keyhint'>
-00004430: 6d3c 2f73 7061 6e3e 3c2f 613e 0a20 2020  m</span></a>.   
-00004440: 2020 2020 2020 2020 2020 2020 203c 613e               <a>
-00004450: 7468 6973 2071 7561 7274 6572 3c2f 613e  this quarter</a>
-00004460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004470: 203c 613e 7468 6973 2079 6561 723c 2f61   <a>this year</a
-00004480: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
-00004490: 2020 3c61 3e79 6573 7465 723c 7762 723e    <a>yester<wbr>
-000044a0: 6461 793c 2f61 3e0a 2020 2020 2020 2020  day</a>.        
-000044b0: 2020 2020 2020 2020 3c61 3e6c 6173 7420          <a>last 
-000044c0: 7765 656b 3c2f 613e 0a20 2020 2020 2020  week</a>.       
-000044d0: 2020 2020 2020 2020 203c 613e 6c61 7374           <a>last
-000044e0: 206d 6f6e 7468 3c2f 613e 0a20 2020 2020   month</a>.     
-000044f0: 2020 2020 2020 2020 2020 203c 613e 6c61             <a>la
-00004500: 7374 2071 7561 7274 6572 3c2f 613e 0a20  st quarter</a>. 
-00004510: 2020 2020 2020 2020 2020 2020 2020 203c                 <
-00004520: 613e 6c61 7374 2079 6561 723c 2f61 3e0a  a>last year</a>.
-00004530: 2020 2020 2020 2020 2020 2020 3c2f 6469              </di
-00004540: 763e 0a20 2020 2020 2020 2020 2020 203c  v>.            <
-00004550: 6469 7620 7374 796c 653d 276d 696e 2d68  div style='min-h
-00004560: 6569 6768 743a 2031 3070 783b 273e 3c2f  eight: 10px;'></
-00004570: 6469 763e 0a20 2020 2020 2020 2020 2020  div>.           
-00004580: 203c 6469 7620 636c 6173 733d 276d 656e   <div class='men
-00004590: 7527 3e0a 2020 2020 2020 2020 2020 2020  u'>.            
-000045a0: 2020 2020 3c64 6976 2073 7479 6c65 3d27      <div style='
-000045b0: 666c 6578 3a20 302e 3520 302e 3520 6175  flex: 0.5 0.5 au
-000045c0: 746f 3b20 7465 7874 2d61 6c69 676e 3a20  to; text-align: 
-000045d0: 7269 6768 743b 273e 4672 6f6d 3a26 6e62  right;'>From:&nb
-000045e0: 7370 3b26 6e62 7370 3b3c 2f64 6976 3e0a  sp;&nbsp;</div>.
-000045f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004600: 3c69 6e70 7574 2074 7970 653d 2264 6174  <input type="dat
-00004610: 6522 2073 7465 703d 2231 2220 2f3e 0a20  e" step="1" />. 
-00004620: 2020 2020 2020 2020 2020 2020 2020 203c                 <
-00004630: 6469 7620 7374 796c 653d 2766 6c65 783a  div style='flex:
-00004640: 2030 2e35 2030 2e35 2061 7574 6f3b 2074   0.5 0.5 auto; t
-00004650: 6578 742d 616c 6967 6e3a 2072 6967 6874  ext-align: right
-00004660: 3b27 3e54 6f3a 266e 6273 703b 266e 6273  ;'>To:&nbsp;&nbs
-00004670: 703b 3c2f 6469 763e 0a20 2020 2020 2020  p;</div>.       
-00004680: 2020 2020 2020 2020 203c 696e 7075 7420           <input 
-00004690: 7479 7065 3d22 6461 7465 2220 7374 6570  type="date" step
-000046a0: 3d22 3122 202f 3e0a 2020 2020 2020 2020  ="1" />.        
-000046b0: 2020 2020 2020 2020 3c64 6976 2073 7479          <div sty
-000046c0: 6c65 3d27 666c 6578 3a20 302e 3520 302e  le='flex: 0.5 0.
-000046d0: 3520 6175 746f 3b27 3e3c 2f64 6976 3e0a  5 auto;'></div>.
-000046e0: 2020 2020 2020 2020 2020 2020 3c2f 6469              </di
-000046f0: 763e 0a20 2020 2020 2020 2020 2020 203c  v>.            <
-00004700: 6469 7620 7374 796c 653d 276d 6172 6769  div style='margi
-00004710: 6e2d 746f 703a 3165 6d3b 273e 3c2f 6469  n-top:1em;'></di
-00004720: 763e 0a20 2020 2020 2020 2020 2020 203c  v>.            <
-00004730: 6469 7620 7374 796c 653d 2764 6973 706c  div style='displ
-00004740: 6179 3a20 666c 6578 3b6a 7573 7469 6679  ay: flex;justify
-00004750: 2d63 6f6e 7465 6e74 3a20 666c 6578 2d65  -content: flex-e
-00004760: 6e64 3b27 3e0a 2020 2020 2020 2020 2020  nd;'>.          
-00004770: 2020 2020 2020 3c62 7574 746f 6e20 7479        <button ty
-00004780: 7065 3d27 6275 7474 6f6e 273e 446f 6e65  pe='button'>Done
-00004790: 3c2f 6275 7474 6f6e 3e0a 2020 2020 2020  </button>.      
-000047a0: 2020 2020 2020 3c2f 6469 763e 0a20 2020        </div>.   
-000047b0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-000047c0: 2020 7365 6c66 2e6d 6169 6e64 6976 2e69    self.maindiv.i
-000047d0: 6e6e 6572 4854 4d4c 203d 2068 746d 6c0a  nnerHTML = html.
-000047e0: 2020 2020 2020 2020 7072 6573 6574 7320          presets 
-000047f0: 3d20 7365 6c66 2e6d 6169 6e64 6976 2e63  = self.maindiv.c
-00004800: 6869 6c64 7265 6e5b 325d 0a20 2020 2020  hildren[2].     
-00004810: 2020 2066 6f72 6d20 3d20 7365 6c66 2e6d     form = self.m
-00004820: 6169 6e64 6976 2e63 6869 6c64 7265 6e5b  aindiv.children[
-00004830: 345d 0a0a 2020 2020 2020 2020 7365 6c66  4]..        self
-00004840: 2e5f 7431 5f69 6e70 7574 203d 2066 6f72  ._t1_input = for
-00004850: 6d2e 6368 696c 6472 656e 5b31 5d0a 2020  m.children[1].  
-00004860: 2020 2020 2020 7365 6c66 2e5f 7432 5f69        self._t2_i
-00004870: 6e70 7574 203d 2066 6f72 6d2e 6368 696c  nput = form.chil
-00004880: 6472 656e 5b33 5d0a 0a20 2020 2020 2020  dren[3]..       
-00004890: 2023 2071 7569 636b 6e61 7620 3d20 7365   # quicknav = se
-000048a0: 6c66 2e6d 6169 6e64 6976 2e63 6869 6c64  lf.maindiv.child
-000048b0: 7265 6e5b 305d 0a20 2020 2020 2020 2023  ren[0].        #
-000048c0: 2071 7569 636b 6e61 762e 6368 696c 6472   quicknav.childr
-000048d0: 656e 5b31 5d2e 6f6e 636c 6963 6b20 3d20  en[1].onclick = 
-000048e0: 6c61 6d62 6461 2065 3a20 7365 6c66 2e5f  lambda e: self._
-000048f0: 6170 706c 795f 7175 6963 6b6e 6176 2822  apply_quicknav("
-00004900: 6f75 7422 290a 2020 2020 2020 2020 2320  out").        # 
-00004910: 7175 6963 6b6e 6176 2e63 6869 6c64 7265  quicknav.childre
-00004920: 6e5b 325d 2e6f 6e63 6c69 636b 203d 206c  n[2].onclick = l
-00004930: 616d 6264 6120 653a 2073 656c 662e 5f61  ambda e: self._a
-00004940: 7070 6c79 5f71 7569 636b 6e61 7628 2269  pply_quicknav("i
-00004950: 6e22 290a 0a20 2020 2020 2020 2066 6f72  n")..        for
-00004960: 2069 2069 6e20 7261 6e67 6528 7072 6573   i in range(pres
-00004970: 6574 732e 6368 696c 6472 656e 2e6c 656e  ets.children.len
-00004980: 6774 6829 3a0a 2020 2020 2020 2020 2020  gth):.          
-00004990: 2020 6275 7420 3d20 7072 6573 6574 732e    but = presets.
-000049a0: 6368 696c 6472 656e 5b69 5d0a 2020 2020  children[i].    
-000049b0: 2020 2020 2020 2020 6275 742e 6f6e 636c          but.oncl
-000049c0: 6963 6b20 3d20 6c61 6d62 6461 2065 3a20  ick = lambda e: 
-000049d0: 7365 6c66 2e5f 6170 706c 795f 7072 6573  self._apply_pres
-000049e0: 6574 2865 2e74 6172 6765 742e 696e 6e65  et(e.target.inne
-000049f0: 7254 6578 7429 0a0a 2020 2020 2020 2020  rText)..        
-00004a00: 7365 6c66 2e5f 7431 5f69 6e70 7574 2e76  self._t1_input.v
-00004a10: 616c 7565 203d 2074 315f 6461 7465 0a20  alue = t1_date. 
-00004a20: 2020 2020 2020 2073 656c 662e 5f74 315f         self._t1_
-00004a30: 696e 7075 742e 6f6e 706f 696e 7465 7264  input.onpointerd
-00004a40: 6f77 6e20 3d20 7365 6c66 2e5f 7072 6576  own = self._prev
-00004a50: 656e 745f 626c 7572 0a20 2020 2020 2020  ent_blur.       
-00004a60: 2073 656c 662e 5f74 315f 696e 7075 742e   self._t1_input.
-00004a70: 6f6e 696e 7075 7420 3d20 7365 6c66 2e5f  oninput = self._
-00004a80: 7570 6461 7465 5f72 616e 6765 0a20 2020  update_range.   
-00004a90: 2020 2020 2073 656c 662e 5f74 325f 696e       self._t2_in
-00004aa0: 7075 742e 7661 6c75 6520 3d20 7432 5f64  put.value = t2_d
-00004ab0: 6174 650a 2020 2020 2020 2020 7365 6c66  ate.        self
-00004ac0: 2e5f 7432 5f69 6e70 7574 2e6f 6e70 6f69  ._t2_input.onpoi
-00004ad0: 6e74 6572 646f 776e 203d 2073 656c 662e  nterdown = self.
-00004ae0: 5f70 7265 7665 6e74 5f62 6c75 720a 2020  _prevent_blur.  
-00004af0: 2020 2020 2020 7365 6c66 2e5f 7432 5f69        self._t2_i
-00004b00: 6e70 7574 2e6f 6e69 6e70 7574 203d 2073  nput.oninput = s
-00004b10: 656c 662e 5f75 7064 6174 655f 7261 6e67  elf._update_rang
-00004b20: 650a 0a20 2020 2020 2020 2063 6c6f 7365  e..        close
-00004b30: 5f62 7574 203d 2073 656c 662e 6d61 696e  _but = self.main
-00004b40: 6469 762e 6368 696c 6472 656e 5b36 5d2e  div.children[6].
-00004b50: 6368 696c 6472 656e 5b30 5d0a 2020 2020  children[0].    
-00004b60: 2020 2020 636c 6f73 655f 6275 742e 6f6e      close_but.on
-00004b70: 636c 6963 6b20 3d20 7365 6c66 2e63 6c6f  click = self.clo
-00004b80: 7365 0a0a 2020 2020 2020 2020 7365 6c66  se..        self
-00004b90: 2e6d 6169 6e64 6976 2e63 6c61 7373 4c69  .maindiv.classLi
-00004ba0: 7374 2e61 6464 2822 7665 7274 6963 616c  st.add("vertical
-00004bb0: 6d65 6e75 2229 0a20 2020 2020 2020 2073  menu").        s
-00004bc0: 7570 6572 2829 2e6f 7065 6e28 6361 6c6c  uper().open(call
-00004bd0: 6261 636b 290a 0a20 2020 2064 6566 205f  back)..    def _
-00004be0: 6170 706c 795f 7175 6963 6b6e 6176 2873  apply_quicknav(s
-00004bf0: 656c 662c 2074 6578 7429 3a0a 2020 2020  elf, text):.    
-00004c00: 2020 2020 7363 616c 6573 7465 7020 3d20      scalestep = 
-00004c10: 2b31 2069 6620 226f 7574 2220 696e 2074  +1 if "out" in t
-00004c20: 6578 742e 6c6f 7765 7228 2920 656c 7365  ext.lower() else
-00004c30: 202d 310a 2020 2020 2020 2020 7431 2c20   -1.        t1, 
-00004c40: 7432 203d 2073 656c 662e 5f63 616e 7661  t2 = self._canva
-00004c50: 732e 7261 6e67 652e 6765 745f 736e 6170  s.range.get_snap
-00004c60: 5f72 616e 6765 2873 6361 6c65 7374 6570  _range(scalestep
-00004c70: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00004c80: 5f74 315f 696e 7075 742e 7661 6c75 6520  _t1_input.value 
-00004c90: 3d20 6474 2e74 696d 6532 6c6f 6361 6c73  = dt.time2locals
-00004ca0: 7472 2874 3129 2e73 706c 6974 2822 2022  tr(t1).split(" "
-00004cb0: 295b 305d 0a20 2020 2020 2020 2073 656c  )[0].        sel
-00004cc0: 662e 5f74 325f 696e 7075 742e 7661 6c75  f._t2_input.valu
-00004cd0: 6520 3d20 6474 2e74 696d 6532 6c6f 6361  e = dt.time2loca
-00004ce0: 6c73 7472 2874 3229 2e73 706c 6974 2822  lstr(t2).split("
-00004cf0: 2022 295b 305d 0a0a 2020 2020 2020 2020   ")[0]..        
-00004d00: 7365 6c66 2e5f 6361 6e76 6173 2e72 616e  self._canvas.ran
-00004d10: 6765 2e61 6e69 6d61 7465 5f72 616e 6765  ge.animate_range
-00004d20: 2874 312c 2074 3229 0a0a 2020 2020 6465  (t1, t2)..    de
-00004d30: 6620 5f61 7070 6c79 5f70 7265 7365 7428  f _apply_preset(
-00004d40: 7365 6c66 2c20 7465 7874 293a 0a20 2020  self, text):.   
-00004d50: 2020 2020 2074 6578 7420 3d20 7465 7874       text = text
-00004d60: 2e6c 6f77 6572 2829 0a20 2020 2020 2020  .lower().       
-00004d70: 206c 6173 7420 3d20 7465 7874 2e63 6f75   last = text.cou
-00004d80: 6e74 2822 6c61 7374 2229 0a20 2020 2020  nt("last").     
-00004d90: 2020 2069 6620 7465 7874 2e63 6f75 6e74     if text.count
-00004da0: 2822 746f 6461 7922 293a 0a20 2020 2020  ("today"):.     
-00004db0: 2020 2020 2020 2072 6f75 6e64 6572 203d         rounder =
-00004dc0: 2022 3144 220a 2020 2020 2020 2020 656c   "1D".        el
-00004dd0: 6966 2074 6578 742e 636f 756e 7428 2279  if text.count("y
-00004de0: 6573 7465 7264 6179 2229 3a0a 2020 2020  esterday"):.    
-00004df0: 2020 2020 2020 2020 726f 756e 6465 7220          rounder 
-00004e00: 3d20 2231 4422 0a20 2020 2020 2020 2020  = "1D".         
-00004e10: 2020 206c 6173 7420 3d20 5472 7565 0a20     last = True. 
-00004e20: 2020 2020 2020 2065 6c69 6620 7465 7874         elif text
-00004e30: 2e63 6f75 6e74 2822 7765 656b 2229 3a0a  .count("week"):.
-00004e40: 2020 2020 2020 2020 2020 2020 726f 756e              roun
-00004e50: 6465 7220 3d20 2231 5722 0a20 2020 2020  der = "1W".     
-00004e60: 2020 2065 6c69 6620 7465 7874 2e63 6f75     elif text.cou
-00004e70: 6e74 2822 6d6f 6e74 6822 293a 0a20 2020  nt("month"):.   
-00004e80: 2020 2020 2020 2020 2072 6f75 6e64 6572           rounder
-00004e90: 203d 2022 314d 220a 2020 2020 2020 2020   = "1M".        
-00004ea0: 656c 6966 2074 6578 742e 636f 756e 7428  elif text.count(
-00004eb0: 2271 7561 7274 6572 2229 3a0a 2020 2020  "quarter"):.    
-00004ec0: 2020 2020 2020 2020 726f 756e 6465 7220          rounder 
-00004ed0: 3d20 2233 4d22 0a20 2020 2020 2020 2065  = "3M".        e
-00004ee0: 6c69 6620 7465 7874 2e63 6f75 6e74 2822  lif text.count("
-00004ef0: 7965 6172 2229 3a0a 2020 2020 2020 2020  year"):.        
-00004f00: 2020 2020 726f 756e 6465 7220 3d20 2231      rounder = "1
-00004f10: 5922 0a20 2020 2020 2020 2065 6c73 653a  Y".        else:
-00004f20: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00004f30: 7572 6e0a 0a20 2020 2020 2020 2074 3120  urn..        t1 
-00004f40: 3d20 6474 2e66 6c6f 6f72 2864 742e 6e6f  = dt.floor(dt.no
-00004f50: 7728 292c 2072 6f75 6e64 6572 290a 2020  w(), rounder).  
-00004f60: 2020 2020 2020 6966 206c 6173 743a 0a20        if last:. 
-00004f70: 2020 2020 2020 2020 2020 2074 3120 3d20             t1 = 
-00004f80: 6474 2e61 6464 2874 312c 2022 2d22 202b  dt.add(t1, "-" +
-00004f90: 2072 6f75 6e64 6572 290a 2020 2020 2020   rounder).      
-00004fa0: 2020 7432 203d 2064 742e 6164 6428 7431    t2 = dt.add(t1
-00004fb0: 2c20 726f 756e 6465 7229 0a20 2020 2020  , rounder).     
-00004fc0: 2020 2074 3220 3d20 6474 2e61 6464 2874     t2 = dt.add(t
-00004fd0: 322c 2022 2d31 4422 2920 2023 2072 616e  2, "-1D")  # ran
-00004fe0: 6765 2069 7320 696e 636c 7573 6976 650a  ge is inclusive.
-00004ff0: 0a20 2020 2020 2020 2073 656c 662e 5f74  .        self._t
-00005000: 315f 696e 7075 742e 7661 6c75 6520 3d20  1_input.value = 
-00005010: 6474 2e74 696d 6532 6c6f 6361 6c73 7472  dt.time2localstr
-00005020: 2874 3129 2e73 706c 6974 2822 2022 295b  (t1).split(" ")[
-00005030: 305d 0a20 2020 2020 2020 2073 656c 662e  0].        self.
-00005040: 5f74 325f 696e 7075 742e 7661 6c75 6520  _t2_input.value 
-00005050: 3d20 6474 2e74 696d 6532 6c6f 6361 6c73  = dt.time2locals
-00005060: 7472 2874 3229 2e73 706c 6974 2822 2022  tr(t2).split(" "
-00005070: 295b 305d 0a20 2020 2020 2020 2073 656c  )[0].        sel
-00005080: 662e 5f75 7064 6174 655f 7261 6e67 6528  f._update_range(
-00005090: 290a 0a20 2020 2064 6566 205f 7570 6461  )..    def _upda
-000050a0: 7465 5f72 616e 6765 2873 656c 6629 3a0a  te_range(self):.
-000050b0: 2020 2020 2020 2020 7431 5f64 6174 6520          t1_date 
-000050c0: 3d20 7365 6c66 2e5f 7431 5f69 6e70 7574  = self._t1_input
-000050d0: 2e76 616c 7565 0a20 2020 2020 2020 2074  .value.        t
-000050e0: 325f 6461 7465 203d 2073 656c 662e 5f74  2_date = self._t
-000050f0: 325f 696e 7075 742e 7661 6c75 650a 2020  2_input.value.  
-00005100: 2020 2020 2020 6966 206e 6f74 2066 6c6f        if not flo
-00005110: 6174 2874 315f 6461 7465 2e73 706c 6974  at(t1_date.split
-00005120: 2822 2d22 295b 305d 2920 3e20 3138 3939  ("-")[0]) > 1899
-00005130: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00005140: 7475 726e 0a20 2020 2020 2020 2065 6c69  turn.        eli
-00005150: 6620 6e6f 7420 666c 6f61 7428 7432 5f64  f not float(t2_d
-00005160: 6174 652e 7370 6c69 7428 222d 2229 5b30  ate.split("-")[0
-00005170: 5d29 203e 2031 3839 393a 0a20 2020 2020  ]) > 1899:.     
-00005180: 2020 2020 2020 2072 6574 7572 6e0a 0a20         return.. 
-00005190: 2020 2020 2020 2074 3120 3d20 7374 725f         t1 = str_
-000051a0: 6461 7465 5f74 6f5f 7469 6d65 5f69 6e74  date_to_time_int
-000051b0: 2874 315f 6461 7465 290a 2020 2020 2020  (t1_date).      
-000051c0: 2020 7432 203d 2073 7472 5f64 6174 655f    t2 = str_date_
-000051d0: 746f 5f74 696d 655f 696e 7428 7432 5f64  to_time_int(t2_d
-000051e0: 6174 6529 0a20 2020 2020 2020 2069 6620  ate).        if 
-000051f0: 7431 203e 2074 323a 0a20 2020 2020 2020  t1 > t2:.       
-00005200: 2020 2020 2074 312c 2074 3220 3d20 7432       t1, t2 = t2
-00005210: 2c20 7431 0a20 2020 2020 2020 2074 3220  , t1.        t2 
-00005220: 3d20 6474 2e61 6464 2874 322c 2022 3144  = dt.add(t2, "1D
-00005230: 2229 2020 2320 6c6f 6f6b 2075 6e74 696c  ")  # look until
-00005240: 2074 6865 2065 6e64 206f 6620 7468 6520   the end of the 
-00005250: 6461 790a 0a20 2020 2020 2020 2077 696e  day..        win
-00005260: 646f 772e 6361 6e76 6173 2e72 616e 6765  dow.canvas.range
-00005270: 2e61 6e69 6d61 7465 5f72 616e 6765 2874  .animate_range(t
-00005280: 312c 2074 322c 204e 6f6e 652c 2046 616c  1, t2, None, Fal
-00005290: 7365 2920 2023 2077 6974 686f 7574 2073  se)  # without s
-000052a0: 6e61 700a 0a0a 636c 6173 7320 5374 6172  nap...class Star
-000052b0: 7453 746f 7045 6469 743a 0a20 2020 2022  tStopEdit:.    "
-000052c0: 2222 4865 6c70 6572 2063 6c61 7373 2074  ""Helper class t
-000052d0: 6f20 616c 6c6f 7720 7468 6520 7573 6572  o allow the user
-000052e0: 2074 6f20 7365 7420 7468 6520 7374 6172   to set the star
-000052f0: 7420 616e 6420 7374 6f70 2074 696d 6520  t and stop time 
-00005300: 6f66 2061 2072 6563 6f72 642e 2222 220a  of a record.""".
-00005310: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
-00005320: 5f28 7365 6c66 2c20 6e6f 6465 2c20 6361  _(self, node, ca
-00005330: 6c6c 6261 636b 2c20 7431 2c20 7432 2c20  llback, t1, t2, 
-00005340: 6d6f 6465 293a 0a20 2020 2020 2020 2073  mode):.        s
-00005350: 656c 662e 6e6f 6465 203d 206e 6f64 650a  elf.node = node.
-00005360: 2020 2020 2020 2020 7365 6c66 2e63 616c          self.cal
-00005370: 6c62 6163 6b20 3d20 6361 6c6c 6261 636b  lback = callback
-00005380: 0a20 2020 2020 2020 2073 656c 662e 696e  .        self.in
-00005390: 6974 6961 6c6d 6f64 6520 3d20 6d6f 6465  itialmode = mode
-000053a0: 2e6c 6f77 6572 2829 0a20 2020 2020 2020  .lower().       
-000053b0: 2073 656c 662e 696e 6974 6961 6c5f 7431   self.initial_t1
-000053c0: 2c20 7365 6c66 2e69 6e69 7469 616c 5f74  , self.initial_t
-000053d0: 3220 3d20 7431 2c20 7432 2020 2320 6576  2 = t1, t2  # ev
-000053e0: 656e 206d 6f72 6520 6f72 6967 696e 616c  en more original
-000053f0: 2074 6861 6e20 6f72 695f 7431 203a 290a   than ori_t1 :).
-00005400: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00005410: 2e69 6e69 7469 616c 6d6f 6465 2069 6e20  .initialmode in 
-00005420: 2822 7374 6172 7422 2c20 226e 6577 2229  ("start", "new")
-00005430: 3a0a 2020 2020 2020 2020 2020 2020 7465  :.            te
-00005440: 7874 5f73 7461 7274 6e6f 7720 3d20 2253  xt_startnow = "S
-00005450: 7461 7274 206e 6f77 220a 2020 2020 2020  tart now".      
-00005460: 2020 2020 2020 7465 7874 5f73 7461 7274        text_start
-00005470: 726c 7220 3d20 2253 7461 7274 6564 2065  rlr = "Started e
-00005480: 6172 6c69 6572 220a 2020 2020 2020 2020  arlier".        
-00005490: 2020 2020 7465 7874 5f66 696e 6973 6865      text_finishe
-000054a0: 6420 3d20 2241 6c72 6561 6479 2064 6f6e  d = "Already don
-000054b0: 6522 0a20 2020 2020 2020 2065 6c73 653a  e".        else:
-000054c0: 0a20 2020 2020 2020 2020 2020 2074 6578  .            tex
-000054d0: 745f 7374 6172 746e 6f77 203d 2022 5374  t_startnow = "St
-000054e0: 6172 7420 6e6f 7722 2020 2320 6e6f 7420  art now"  # not 
-000054f0: 7669 7369 626c 650a 2020 2020 2020 2020  visible.        
-00005500: 2020 2020 7465 7874 5f73 7461 7274 726c      text_startrl
-00005510: 7220 3d20 2253 7469 6c6c 2072 756e 6e69  r = "Still runni
-00005520: 6e67 220a 2020 2020 2020 2020 2020 2020  ng".            
-00005530: 7465 7874 5f66 696e 6973 6865 6420 3d20  text_finished = 
-00005540: 2253 746f 7070 6564 220a 0a20 2020 2020  "Stopped"..     
-00005550: 2020 2073 656c 662e 6e6f 6465 2e69 6e6e     self.node.inn
-00005560: 6572 4854 4d4c 203d 2066 2222 220a 2020  erHTML = f""".  
-00005570: 2020 2020 2020 3c64 6976 3e0a 2020 2020        <div>.    
-00005580: 2020 2020 2020 2020 3c6c 6162 656c 2073          <label s
-00005590: 7479 6c65 3d27 7573 6572 2d73 656c 6563  tyle='user-selec
-000055a0: 743a 6e6f 6e65 3b27 3e3c 696e 7075 7420  t:none;'><input 
-000055b0: 7479 7065 3d27 7261 6469 6f27 206e 616d  type='radio' nam
-000055c0: 653d 2772 756e 6e69 6e67 6f72 6e6f 7427  e='runningornot'
-000055d0: 202f 3e26 6e62 7370 3b7b 7465 7874 5f73   />&nbsp;{text_s
-000055e0: 7461 7274 6e6f 777d 266e 6273 703b 266e  tartnow}&nbsp;&n
-000055f0: 6273 703b 3c2f 6c61 6265 6c3e 0a20 2020  bsp;</label>.   
-00005600: 2020 2020 2020 2020 203c 6c61 6265 6c20           <label 
-00005610: 7374 796c 653d 2775 7365 722d 7365 6c65  style='user-sele
-00005620: 6374 3a6e 6f6e 653b 273e 3c69 6e70 7574  ct:none;'><input
-00005630: 2074 7970 653d 2772 6164 696f 2720 6e61   type='radio' na
-00005640: 6d65 3d27 7275 6e6e 696e 676f 726e 6f74  me='runningornot
-00005650: 2720 2f3e 266e 6273 703b 7b74 6578 745f  ' />&nbsp;{text_
-00005660: 7374 6172 7472 6c72 7d26 6e62 7370 3b26  startrlr}&nbsp;&
-00005670: 6e62 7370 3b3c 2f6c 6162 656c 3e0a 2020  nbsp;</label>.  
-00005680: 2020 2020 2020 2020 2020 3c6c 6162 656c            <label
-00005690: 2073 7479 6c65 3d27 7573 6572 2d73 656c   style='user-sel
-000056a0: 6563 743a 6e6f 6e65 3b27 3e3c 696e 7075  ect:none;'><inpu
-000056b0: 7420 7479 7065 3d27 7261 6469 6f27 206e  t type='radio' n
-000056c0: 616d 653d 2772 756e 6e69 6e67 6f72 6e6f  ame='runningorno
-000056d0: 7427 202f 3e26 6e62 7370 3b7b 7465 7874  t' />&nbsp;{text
-000056e0: 5f66 696e 6973 6865 647d 266e 6273 703b  _finished}&nbsp;
-000056f0: 266e 6273 703b 3c2f 6c61 6265 6c3e 0a20  &nbsp;</label>. 
-00005700: 2020 2020 2020 2020 2020 203c 6469 7620             <div 
-00005710: 7374 796c 653d 276d 696e 2d68 6569 6768  style='min-heigh
-00005720: 743a 3165 6d3b 273e 3c2f 6469 763e 0a20  t:1em;'></div>. 
-00005730: 2020 2020 2020 203c 2f64 6976 3e0a 2020         </div>.  
-00005740: 2020 2020 2020 3c64 6976 3e0a 2020 2020        <div>.    
-00005750: 2020 2020 3c73 7061 6e3e 3c69 2063 6c61      <span><i cla
-00005760: 7373 3d27 6661 7327 2073 7479 6c65 3d27  ss='fas' style='
-00005770: 636f 6c6f 723a 2339 3939 3b20 7665 7274  color:#999; vert
-00005780: 6963 616c 2d61 6c69 676e 3a6d 6964 646c  ical-align:middl
-00005790: 653b 273e 5c75 6631 3434 3c2f 693e 3c2f  e;'>\uf144</i></
-000057a0: 7370 616e 3e0a 2020 2020 2020 2020 2020  span>.          
-000057b0: 2020 3c69 6e70 7574 2074 7970 653d 2764    <input type='d
-000057c0: 6174 6527 2073 7465 703d 2731 2720 2073  ate' step='1'  s
-000057d0: 7479 6c65 3d27 666f 6e74 2d73 697a 653a  tyle='font-size:
-000057e0: 2037 3025 3b27 202f 3e0a 2020 2020 2020   70%;' />.      
-000057f0: 2020 2020 2020 3c73 7061 6e20 7374 796c        <span styl
-00005800: 653d 2764 6973 706c 6179 3a20 666c 6578  e='display: flex
-00005810: 3b27 3e0a 2020 2020 2020 2020 2020 2020  ;'>.            
-00005820: 2020 2020 3c69 6e70 7574 2074 7970 653d      <input type=
-00005830: 2774 6578 7427 2073 7479 6c65 3d27 666c  'text' style='fl
-00005840: 6578 3a31 3b20 6d69 6e2d 7769 6474 683a  ex:1; min-width:
-00005850: 2035 3070 783b 2066 6f6e 742d 7369 7a65   50px; font-size
-00005860: 3a20 3830 253b 2720 2f3e 0a20 2020 2020  : 80%;' />.     
-00005870: 2020 2020 2020 2020 2020 203c 6275 7474             <butt
-00005880: 6f6e 2074 7970 653d 2762 7574 746f 6e27  on type='button'
-00005890: 2073 7479 6c65 3d27 7769 6474 683a 3265   style='width:2e
-000058a0: 6d3b 206d 6172 6769 6e2d 6c65 6674 3a2d  m; margin-left:-
-000058b0: 3170 783b 273e 2b3c 2f62 7574 746f 6e3e  1px;'>+</button>
-000058c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000058d0: 203c 6275 7474 6f6e 2074 7970 653d 2762   <button type='b
-000058e0: 7574 746f 6e27 2073 7479 6c65 3d27 7769  utton' style='wi
-000058f0: 6474 683a 3265 6d3b 206d 6172 6769 6e2d  dth:2em; margin-
-00005900: 6c65 6674 3a2d 3170 783b 273e 2d3c 2f62  left:-1px;'>-</b
-00005910: 7574 746f 6e3e 0a20 2020 2020 2020 2020  utton>.         
-00005920: 2020 2020 2020 203c 2f73 7061 6e3e 0a20         </span>. 
-00005930: 2020 2020 2020 2020 2020 203c 7370 616e             <span
-00005940: 3e3c 2f73 7061 6e3e 0a20 2020 2020 2020  ></span>.       
-00005950: 203c 7370 616e 3e3c 6920 636c 6173 733d   <span><i class=
-00005960: 2766 6173 2720 7374 796c 653d 2763 6f6c  'fas' style='col
-00005970: 6f72 3a23 3939 393b 2076 6572 7469 6361  or:#999; vertica
-00005980: 6c2d 616c 6967 6e3a 6d69 6464 6c65 3b27  l-align:middle;'
-00005990: 3e5c 7566 3238 643c 2f69 3e3c 2f73 7061  >\uf28d</i></spa
-000059a0: 6e3e 0a20 2020 2020 2020 2020 2020 203c  n>.            <
-000059b0: 696e 7075 7420 7479 7065 3d27 6461 7465  input type='date
-000059c0: 2720 7374 6570 3d27 3127 2073 7479 6c65  ' step='1' style
-000059d0: 3d27 666f 6e74 2d73 697a 653a 2037 3025  ='font-size: 70%
-000059e0: 3b27 202f 3e0a 2020 2020 2020 2020 2020  ;' />.          
-000059f0: 2020 3c73 7061 6e20 7374 796c 653d 2764    <span style='d
-00005a00: 6973 706c 6179 3a20 666c 6578 3b27 3e0a  isplay: flex;'>.
-00005a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005a20: 3c69 6e70 7574 2074 7970 653d 2774 6578  <input type='tex
-00005a30: 7427 2073 7479 6c65 3d27 666c 6578 3a31  t' style='flex:1
-00005a40: 3b20 6d69 6e2d 7769 6474 683a 2035 3070  ; min-width: 50p
-00005a50: 783b 2066 6f6e 742d 7369 7a65 3a20 3830  x; font-size: 80
-00005a60: 253b 2720 2f3e 0a20 2020 2020 2020 2020  %;' />.         
-00005a70: 2020 2020 2020 203c 6275 7474 6f6e 2074         <button t
-00005a80: 7970 653d 2762 7574 746f 6e27 2073 7479  ype='button' sty
-00005a90: 6c65 3d27 7769 6474 683a 3265 6d3b 206d  le='width:2em; m
-00005aa0: 6172 6769 6e2d 6c65 6674 3a2d 3170 783b  argin-left:-1px;
-00005ab0: 273e 2b3c 2f62 7574 746f 6e3e 0a20 2020  '>+</button>.   
-00005ac0: 2020 2020 2020 2020 2020 2020 203c 6275               <bu
-00005ad0: 7474 6f6e 2074 7970 653d 2762 7574 746f  tton type='butto
-00005ae0: 6e27 2073 7479 6c65 3d27 7769 6474 683a  n' style='width:
-00005af0: 3265 6d3b 206d 6172 6769 6e2d 6c65 6674  2em; margin-left
-00005b00: 3a2d 3170 783b 273e 2d3c 2f62 7574 746f  :-1px;'>-</butto
-00005b10: 6e3e 0a20 2020 2020 2020 2020 2020 2020  n>.             
-00005b20: 2020 203c 2f73 7061 6e3e 0a20 2020 2020     </span>.     
-00005b30: 2020 2020 2020 203c 7370 616e 3e3c 2f73         <span></s
-00005b40: 7061 6e3e 0a20 2020 2020 2020 203c 7370  pan>.        <sp
-00005b50: 616e 3e3c 6920 636c 6173 733d 2766 6173  an><i class='fas
-00005b60: 2720 7374 796c 653d 2763 6f6c 6f72 3a23  ' style='color:#
-00005b70: 3939 393b 2076 6572 7469 6361 6c2d 616c  999; vertical-al
-00005b80: 6967 6e3a 6d69 6464 6c65 3b27 3e5c 7566  ign:middle;'>\uf
-00005b90: 3266 323c 2f69 3e3c 2f73 7061 6e3e 0a20  2f2</i></span>. 
-00005ba0: 2020 2020 2020 2020 2020 203c 7370 616e             <span
-00005bb0: 3e3c 2f73 7061 6e3e 0a20 2020 2020 2020  ></span>.       
-00005bc0: 2020 2020 203c 696e 7075 7420 7479 7065       <input type
-00005bd0: 3d27 7465 7874 2720 7374 796c 653d 2766  ='text' style='f
-00005be0: 6c65 783a 2031 3b20 6d69 6e2d 7769 6474  lex: 1; min-widt
-00005bf0: 683a 2035 3070 783b 2066 6f6e 742d 7369  h: 50px; font-si
-00005c00: 7a65 3a20 3830 2527 202f 3e0a 2020 2020  ze: 80%' />.    
-00005c10: 2020 2020 2020 2020 3c73 7061 6e3e 3c2f          <span></
-00005c20: 7370 616e 3e0a 2020 2020 2020 2020 3c2f  span>.        </
-00005c30: 6469 763e 0a20 2020 2020 2020 2022 2222  div>.        """
-00005c40: 0a0a 2020 2020 2020 2020 2320 556e 7061  ..        # Unpa
-00005c50: 636b 2063 6869 6c64 7265 6e0a 2020 2020  ck children.    
-00005c60: 2020 2020 7365 6c66 2e72 6164 696f 6e6f      self.radiono
-00005c70: 6465 203d 2073 656c 662e 6e6f 6465 2e63  de = self.node.c
-00005c80: 6869 6c64 7265 6e5b 305d 0a20 2020 2020  hildren[0].     
-00005c90: 2020 2073 656c 662e 6772 6964 6e6f 6465     self.gridnode
-00005ca0: 203d 2073 656c 662e 6e6f 6465 2e63 6869   = self.node.chi
-00005cb0: 6c64 7265 6e5b 315d 0a20 2020 2020 2020  ldren[1].       
-00005cc0: 2073 656c 662e 7261 6469 6f5f 7374 6172   self.radio_star
-00005cd0: 746e 6f77 203d 2073 656c 662e 7261 6469  tnow = self.radi
-00005ce0: 6f6e 6f64 652e 6368 696c 6472 656e 5b30  onode.children[0
-00005cf0: 5d2e 6368 696c 6472 656e 5b30 5d0a 2020  ].children[0].  
-00005d00: 2020 2020 2020 7365 6c66 2e72 6164 696f        self.radio
-00005d10: 5f73 7461 7274 726c 7220 3d20 7365 6c66  _startrlr = self
-00005d20: 2e72 6164 696f 6e6f 6465 2e63 6869 6c64  .radionode.child
-00005d30: 7265 6e5b 315d 2e63 6869 6c64 7265 6e5b  ren[1].children[
-00005d40: 305d 0a20 2020 2020 2020 2073 656c 662e  0].        self.
-00005d50: 7261 6469 6f5f 6669 6e69 7368 6564 203d  radio_finished =
-00005d60: 2073 656c 662e 7261 6469 6f6e 6f64 652e   self.radionode.
-00005d70: 6368 696c 6472 656e 5b32 5d2e 6368 696c  children[2].chil
-00005d80: 6472 656e 5b30 5d0a 2020 2020 2020 2020  dren[0].        
-00005d90: 280a 2020 2020 2020 2020 2020 2020 5f2c  (.            _,
-00005da0: 2020 2320 6461 7465 2061 6e64 2074 696d    # date and tim
-00005db0: 6520 310a 2020 2020 2020 2020 2020 2020  e 1.            
-00005dc0: 7365 6c66 2e64 6174 6531 696e 7075 742c  self.date1input,
-00005dd0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00005de0: 662e 7469 6d65 3173 7475 6666 2c0a 2020  f.time1stuff,.  
-00005df0: 2020 2020 2020 2020 2020 5f2c 0a20 2020            _,.   
-00005e00: 2020 2020 2020 2020 205f 2c20 2023 2064           _,  # d
-00005e10: 6174 6520 616e 6420 7469 6d65 2032 0a20  ate and time 2. 
-00005e20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00005e30: 6461 7465 3269 6e70 7574 2c0a 2020 2020  date2input,.    
-00005e40: 2020 2020 2020 2020 7365 6c66 2e74 696d          self.tim
-00005e50: 6532 7374 7566 662c 0a20 2020 2020 2020  e2stuff,.       
-00005e60: 2020 2020 205f 2c0a 2020 2020 2020 2020       _,.        
-00005e70: 2020 2020 5f2c 2020 2320 6475 7261 7469      _,  # durati
-00005e80: 6f6e 0a20 2020 2020 2020 2020 2020 205f  on.            _
-00005e90: 2c0a 2020 2020 2020 2020 2020 2020 7365  ,.            se
-00005ea0: 6c66 2e64 7572 6174 696f 6e69 6e70 7574  lf.durationinput
-00005eb0: 2c0a 2020 2020 2020 2020 2020 2020 5f2c  ,.            _,
-00005ec0: 0a20 2020 2020 2020 2029 203d 2073 656c  .        ) = sel
-00005ed0: 662e 6772 6964 6e6f 6465 2e63 6869 6c64  f.gridnode.child
-00005ee0: 7265 6e0a 0a20 2020 2020 2020 2073 656c  ren..        sel
-00005ef0: 662e 7469 6d65 3169 6e70 7574 2c20 7365  f.time1input, se
-00005f00: 6c66 2e74 696d 6531 6d6f 7265 2c20 7365  lf.time1more, se
-00005f10: 6c66 2e74 696d 6531 6c65 7373 203d 2073  lf.time1less = s
-00005f20: 656c 662e 7469 6d65 3173 7475 6666 2e63  elf.time1stuff.c
-00005f30: 6869 6c64 7265 6e0a 2020 2020 2020 2020  hildren.        
-00005f40: 7365 6c66 2e74 696d 6532 696e 7075 742c  self.time2input,
-00005f50: 2073 656c 662e 7469 6d65 326d 6f72 652c   self.time2more,
-00005f60: 2073 656c 662e 7469 6d65 326c 6573 7320   self.time2less 
-00005f70: 3d20 7365 6c66 2e74 696d 6532 7374 7566  = self.time2stuf
-00005f80: 662e 6368 696c 6472 656e 0a0a 2020 2020  f.children..    
-00005f90: 2020 2020 2320 5477 6561 6b73 0a20 2020      # Tweaks.   
-00005fa0: 2020 2020 2066 6f72 2062 7574 2069 6e20       for but in 
-00005fb0: 2873 656c 662e 7469 6d65 316c 6573 732c  (self.time1less,
-00005fc0: 2073 656c 662e 7469 6d65 316d 6f72 652c   self.time1more,
-00005fd0: 2073 656c 662e 7469 6d65 326c 6573 732c   self.time2less,
-00005fe0: 2073 656c 662e 7469 6d65 326d 6f72 6529   self.time2more)
-00005ff0: 3a0a 2020 2020 2020 2020 2020 2020 6275  :.            bu
-00006000: 742e 7365 7441 7474 7269 6275 7465 2822  t.setAttribute("
-00006010: 7461 6249 6e64 6578 222c 202d 3129 0a0a  tabIndex", -1)..
-00006020: 2020 2020 2020 2020 2320 5374 796c 696e          # Stylin
-00006030: 670a 2020 2020 2020 2020 7365 6c66 2e67  g.        self.g
-00006040: 7269 646e 6f64 652e 7374 796c 652e 6469  ridnode.style.di
-00006050: 7370 6c61 7920 3d20 2267 7269 6422 0a20  splay = "grid". 
-00006060: 2020 2020 2020 2073 656c 662e 6772 6964         self.grid
-00006070: 6e6f 6465 2e73 7479 6c65 2e67 7269 6454  node.style.gridT
-00006080: 656d 706c 6174 6543 6f6c 756d 6e73 203d  emplateColumns =
-00006090: 2022 6175 746f 2031 3330 7078 2031 3430   "auto 130px 140
-000060a0: 7078 2032 6672 220a 2020 2020 2020 2020  px 2fr".        
-000060b0: 7365 6c66 2e67 7269 646e 6f64 652e 7374  self.gridnode.st
-000060c0: 796c 652e 6772 6964 4761 7020 3d20 2234  yle.gridGap = "4
-000060d0: 7078 2030 2e35 656d 220a 2020 2020 2020  px 0.5em".      
-000060e0: 2020 7365 6c66 2e67 7269 646e 6f64 652e    self.gridnode.
-000060f0: 7374 796c 652e 6a75 7374 6966 7949 7465  style.justifyIte
-00006100: 6d73 203d 2022 7374 7265 7463 6822 0a20  ms = "stretch". 
-00006110: 2020 2020 2020 2073 656c 662e 6772 6964         self.grid
-00006120: 6e6f 6465 2e73 7479 6c65 2e61 6c69 676e  node.style.align
-00006130: 4974 656d 7320 3d20 2273 7472 6574 6368  Items = "stretch
-00006140: 220a 0a20 2020 2020 2020 2023 2053 6574  "..        # Set
-00006150: 2076 6973 6962 696c 6974 7920 6f66 206d   visibility of m
-00006160: 6f64 652d 7261 6469 6f2d 6275 7474 6f6e  ode-radio-button
-00006170: 730a 2020 2020 2020 2020 6966 2073 656c  s.        if sel
-00006180: 662e 696e 6974 6961 6c6d 6f64 6520 3d3d  f.initialmode ==
-00006190: 2022 7374 6172 7422 3a0a 2020 2020 2020   "start":.      
-000061a0: 2020 2020 2020 7365 6c66 2e72 6164 696f        self.radio
-000061b0: 5f73 7461 7274 6e6f 772e 7365 7441 7474  _startnow.setAtt
-000061c0: 7269 6275 7465 2822 6368 6563 6b65 6422  ribute("checked"
-000061d0: 2c20 5472 7565 290a 2020 2020 2020 2020  , True).        
-000061e0: 656c 6966 2073 656c 662e 696e 6974 6961  elif self.initia
-000061f0: 6c6d 6f64 6520 3d3d 2022 6e65 7722 3a0a  lmode == "new":.
-00006200: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00006210: 2e72 6164 696f 5f66 696e 6973 6865 642e  .radio_finished.
-00006220: 7365 7441 7474 7269 6275 7465 2822 6368  setAttribute("ch
-00006230: 6563 6b65 6422 2c20 5472 7565 290a 2020  ecked", True).  
-00006240: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
-00006250: 696e 6974 6961 6c6d 6f64 6520 3d3d 2022  initialmode == "
-00006260: 7374 6f70 223a 0a20 2020 2020 2020 2020  stop":.         
-00006270: 2020 2073 656c 662e 7261 6469 6f5f 6669     self.radio_fi
-00006280: 6e69 7368 6564 2e73 6574 4174 7472 6962  nished.setAttrib
-00006290: 7574 6528 2263 6865 636b 6564 222c 2054  ute("checked", T
-000062a0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-000062b0: 2073 656c 662e 7261 6469 6f5f 7374 6172   self.radio_star
-000062c0: 746e 6f77 2e70 6172 656e 744e 6f64 652e  tnow.parentNode.
-000062d0: 7374 796c 652e 6469 7370 6c61 7920 3d20  style.display = 
-000062e0: 226e 6f6e 6522 0a20 2020 2020 2020 2065  "none".        e
-000062f0: 6c69 6620 7431 203d 3d20 7432 3a0a 2020  lif t1 == t2:.  
-00006300: 2020 2020 2020 2020 2020 7365 6c66 2e72            self.r
-00006310: 6164 696f 5f73 7461 7274 726c 722e 7365  adio_startrlr.se
-00006320: 7441 7474 7269 6275 7465 2822 6368 6563  tAttribute("chec
-00006330: 6b65 6422 2c20 5472 7565 290a 2020 2020  ked", True).    
-00006340: 2020 2020 2020 2020 7365 6c66 2e72 6164          self.rad
-00006350: 696f 5f73 7461 7274 6e6f 772e 7061 7265  io_startnow.pare
-00006360: 6e74 4e6f 6465 2e73 7479 6c65 2e64 6973  ntNode.style.dis
-00006370: 706c 6179 203d 2022 6e6f 6e65 220a 2020  play = "none".  
-00006380: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00006390: 2020 2020 2020 2020 7365 6c66 2e72 6164          self.rad
-000063a0: 696f 5f66 696e 6973 6865 642e 7365 7441  io_finished.setA
-000063b0: 7474 7269 6275 7465 2822 6368 6563 6b65  ttribute("checke
-000063c0: 6422 2c20 5472 7565 290a 2020 2020 2020  d", True).      
-000063d0: 2020 2020 2020 7365 6c66 2e72 6164 696f        self.radio
-000063e0: 6e6f 6465 2e73 7479 6c65 2e64 6973 706c  node.style.displ
-000063f0: 6179 203d 2022 6e6f 6e65 220a 0a20 2020  ay = "none"..   
-00006400: 2020 2020 2023 2043 6f6e 6e65 6374 2065       # Connect e
-00006410: 7665 6e74 730a 2020 2020 2020 2020 7365  vents.        se
-00006420: 6c66 2e72 6164 696f 5f73 7461 7274 6e6f  lf.radio_startno
-00006430: 772e 6f6e 636c 6963 6b20 3d20 7365 6c66  w.onclick = self
-00006440: 2e5f 6f6e 5f6d 6f64 655f 6368 616e 6765  ._on_mode_change
-00006450: 0a20 2020 2020 2020 2073 656c 662e 7261  .        self.ra
-00006460: 6469 6f5f 7374 6172 7472 6c72 2e6f 6e63  dio_startrlr.onc
-00006470: 6c69 636b 203d 2073 656c 662e 5f6f 6e5f  lick = self._on_
-00006480: 6d6f 6465 5f63 6861 6e67 650a 2020 2020  mode_change.    
-00006490: 2020 2020 7365 6c66 2e72 6164 696f 5f66      self.radio_f
-000064a0: 696e 6973 6865 642e 6f6e 636c 6963 6b20  inished.onclick 
-000064b0: 3d20 7365 6c66 2e5f 6f6e 5f6d 6f64 655f  = self._on_mode_
-000064c0: 6368 616e 6765 0a20 2020 2020 2020 2073  change.        s
-000064d0: 656c 662e 6461 7465 3169 6e70 7574 2e6f  elf.date1input.o
-000064e0: 6e62 6c75 7220 3d20 6c61 6d62 6461 3a20  nblur = lambda: 
-000064f0: 7365 6c66 2e6f 6e63 6861 6e67 6564 2822  self.onchanged("
-00006500: 6461 7465 3122 290a 2020 2020 2020 2020  date1").        
-00006510: 7365 6c66 2e74 696d 6531 696e 7075 742e  self.time1input.
-00006520: 6f6e 6368 616e 6765 203d 206c 616d 6264  onchange = lambd
-00006530: 613a 2073 656c 662e 6f6e 6368 616e 6765  a: self.onchange
-00006540: 6428 2274 696d 6531 2229 0a20 2020 2020  d("time1").     
-00006550: 2020 2073 656c 662e 6461 7465 3269 6e70     self.date2inp
-00006560: 7574 2e6f 6e62 6c75 7220 3d20 6c61 6d62  ut.onblur = lamb
-00006570: 6461 3a20 7365 6c66 2e6f 6e63 6861 6e67  da: self.onchang
-00006580: 6564 2822 6461 7465 3222 290a 2020 2020  ed("date2").    
-00006590: 2020 2020 7365 6c66 2e74 696d 6532 696e      self.time2in
-000065a0: 7075 742e 6f6e 6368 616e 6765 203d 206c  put.onchange = l
-000065b0: 616d 6264 613a 2073 656c 662e 6f6e 6368  ambda: self.onch
-000065c0: 616e 6765 6428 2274 696d 6532 2229 0a20  anged("time2"). 
-000065d0: 2020 2020 2020 2073 656c 662e 6475 7261         self.dura
-000065e0: 7469 6f6e 696e 7075 742e 6f6e 6368 616e  tioninput.onchan
-000065f0: 6765 203d 206c 616d 6264 613a 2073 656c  ge = lambda: sel
-00006600: 662e 6f6e 6368 616e 6765 6428 2264 7572  f.onchanged("dur
-00006610: 6174 696f 6e22 290a 2020 2020 2020 2020  ation").        
-00006620: 7365 6c66 2e74 696d 6531 6d6f 7265 2e6f  self.time1more.o
-00006630: 6e63 6c69 636b 203d 206c 616d 6264 613a  nclick = lambda:
-00006640: 2073 656c 662e 6f6e 6368 616e 6765 6428   self.onchanged(
-00006650: 2274 696d 6531 6d6f 7265 2229 0a20 2020  "time1more").   
-00006660: 2020 2020 2073 656c 662e 7469 6d65 316c       self.time1l
-00006670: 6573 732e 6f6e 636c 6963 6b20 3d20 6c61  ess.onclick = la
-00006680: 6d62 6461 3a20 7365 6c66 2e6f 6e63 6861  mbda: self.oncha
-00006690: 6e67 6564 2822 7469 6d65 316c 6573 7322  nged("time1less"
-000066a0: 290a 2020 2020 2020 2020 7365 6c66 2e74  ).        self.t
-000066b0: 696d 6532 6d6f 7265 2e6f 6e63 6c69 636b  ime2more.onclick
-000066c0: 203d 206c 616d 6264 613a 2073 656c 662e   = lambda: self.
-000066d0: 6f6e 6368 616e 6765 6428 2274 696d 6532  onchanged("time2
-000066e0: 6d6f 7265 2229 0a20 2020 2020 2020 2073  more").        s
-000066f0: 656c 662e 7469 6d65 326c 6573 732e 6f6e  elf.time2less.on
-00006700: 636c 6963 6b20 3d20 6c61 6d62 6461 3a20  click = lambda: 
-00006710: 7365 6c66 2e6f 6e63 6861 6e67 6564 2822  self.onchanged("
-00006720: 7469 6d65 326c 6573 7322 290a 2020 2020  time2less").    
-00006730: 2020 2020 7365 6c66 2e74 696d 6531 696e      self.time1in
-00006740: 7075 742e 6f6e 696e 7075 7420 3d20 6c61  put.oninput = la
-00006750: 6d62 6461 3a20 7365 6c66 2e6f 6e63 6861  mbda: self.oncha
-00006760: 6e67 6564 2822 7469 6d65 3166 6173 7422  nged("time1fast"
-00006770: 290a 2020 2020 2020 2020 7365 6c66 2e74  ).        self.t
-00006780: 696d 6532 696e 7075 742e 6f6e 696e 7075  ime2input.oninpu
-00006790: 7420 3d20 6c61 6d62 6461 3a20 7365 6c66  t = lambda: self
-000067a0: 2e6f 6e63 6861 6e67 6564 2822 7469 6d65  .onchanged("time
-000067b0: 3266 6173 7422 290a 0a20 2020 2020 2020  2fast")..       
-000067c0: 2073 656c 662e 7265 7365 7428 7431 2c20   self.reset(t1, 
-000067d0: 7432 2c20 5472 7565 290a 2020 2020 2020  t2, True).      
-000067e0: 2020 7365 6c66 2e5f 7469 6d65 725f 6861    self._timer_ha
-000067f0: 6e64 6c65 203d 2077 696e 646f 772e 7365  ndle = window.se
-00006800: 7449 6e74 6572 7661 6c28 6c61 6d62 6461  tInterval(lambda
-00006810: 3a20 7365 6c66 2e5f 7570 6461 7465 5f64  : self._update_d
-00006820: 7572 6174 696f 6e28 292c 2032 3030 290a  uration(), 200).
-00006830: 0a20 2020 2064 6566 2063 6c6f 7365 2873  .    def close(s
-00006840: 656c 6629 3a0a 2020 2020 2020 2020 7769  elf):.        wi
-00006850: 6e64 6f77 2e63 6c65 6172 496e 7465 7276  ndow.clearInterv
-00006860: 616c 2873 656c 662e 5f74 696d 6572 5f68  al(self._timer_h
-00006870: 616e 646c 6529 0a0a 2020 2020 6465 6620  andle)..    def 
-00006880: 5f67 6574 5f73 656e 7369 626c 655f 7374  _get_sensible_st
-00006890: 6172 745f 7469 6d65 2873 656c 6629 3a0a  art_time(self):.
-000068a0: 2020 2020 2020 2020 7432 203d 2064 742e          t2 = dt.
-000068b0: 6e6f 7728 290a 2020 2020 2020 2020 7365  now().        se
-000068c0: 6373 5f65 6172 6c69 6572 203d 2038 202a  cs_earlier = 8 *
-000068d0: 2033 3630 3020 2023 2038 2068 6f75 7273   3600  # 8 hours
-000068e0: 0a20 2020 2020 2020 2072 756e 6e69 6e67  .        running
-000068f0: 203d 2077 696e 646f 772e 7374 6f72 652e   = window.store.
-00006900: 7265 636f 7264 732e 6765 745f 7275 6e6e  records.get_runn
-00006910: 696e 675f 7265 636f 7264 7328 290a 2020  ing_records().  
-00006920: 2020 2020 2020 7265 636f 7264 7320 3d20        records = 
-00006930: 7769 6e64 6f77 2e73 746f 7265 2e72 6563  window.store.rec
-00006940: 6f72 6473 2e67 6574 5f72 6563 6f72 6473  ords.get_records
-00006950: 2874 3220 2d20 7365 6373 5f65 6172 6c69  (t2 - secs_earli
-00006960: 6572 2c20 7432 292e 7661 6c75 6573 2829  er, t2).values()
-00006970: 0a20 2020 2020 2020 2069 6620 7275 6e6e  .        if runn
-00006980: 696e 673a 0a20 2020 2020 2020 2020 2020  ing:.           
-00006990: 2074 3120 3d20 7432 202d 2033 3030 2020   t1 = t2 - 300  
-000069a0: 2320 3520 6d69 6e20 6561 726c 6965 720a  # 5 min earlier.
-000069b0: 2020 2020 2020 2020 656c 6966 206c 656e          elif len
-000069c0: 2872 6563 6f72 6473 2920 3e20 303a 0a20  (records) > 0:. 
-000069d0: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
-000069e0: 6473 2e73 6f72 7428 6b65 793d 6c61 6d62  ds.sort(key=lamb
-000069f0: 6461 2072 3a20 722e 7432 290a 2020 2020  da r: r.t2).    
-00006a00: 2020 2020 2020 2020 7431 203d 2072 6563          t1 = rec
-00006a10: 6f72 6473 5b2d 315d 2e74 3220 2023 2073  ords[-1].t2  # s
-00006a20: 7461 7274 2074 696d 6520 3d3d 206c 6173  tart time == las
-00006a30: 7420 7265 636f 7264 7320 7374 6f70 2074  t records stop t
-00006a40: 696d 650a 2020 2020 2020 2020 2020 2020  ime.            
-00006a50: 7431 203d 206d 696e 2874 312c 2074 3220  t1 = min(t1, t2 
-00006a60: 2d20 3129 0a20 2020 2020 2020 2065 6c73  - 1).        els
-00006a70: 653a 0a20 2020 2020 2020 2020 2020 2074  e:.            t
-00006a80: 3120 3d20 7432 202d 2033 3630 3020 2023  1 = t2 - 3600  #
-00006a90: 2073 7461 7274 2074 696d 6520 6973 2061   start time is a
-00006aa0: 6e20 686f 7572 2061 676f 0a20 2020 2020  n hour ago.     
-00006ab0: 2020 2072 6574 7572 6e20 7431 0a0a 2020     return t1..  
-00006ac0: 2020 6465 6620 5f6f 6e5f 6d6f 6465 5f63    def _on_mode_c
-00006ad0: 6861 6e67 6528 7365 6c66 293a 0a20 2020  hange(self):.   
-00006ae0: 2020 2020 2069 6620 7365 6c66 2e69 6e69       if self.ini
-00006af0: 7469 616c 6d6f 6465 2069 6e20 2822 7374  tialmode in ("st
-00006b00: 6172 7422 2c20 226e 6577 2229 3a0a 2020  art", "new"):.  
-00006b10: 2020 2020 2020 2020 2020 7432 203d 2064            t2 = d
-00006b20: 742e 6e6f 7728 290a 2020 2020 2020 2020  t.now().        
-00006b30: 2020 2020 6966 2073 656c 662e 7261 6469      if self.radi
-00006b40: 6f5f 7374 6172 746e 6f77 2e63 6865 636b  o_startnow.check
-00006b50: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
-00006b60: 2020 2020 7365 6c66 2e72 6573 6574 2874      self.reset(t
-00006b70: 322c 2074 3229 0a20 2020 2020 2020 2020  2, t2).         
-00006b80: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00006b90: 2020 2020 2020 2020 2023 2049 6620 7468           # If th
-00006ba0: 6520 6375 7272 656e 7420 7374 6172 7420  e current start 
-00006bb0: 7469 6d65 2069 7320 3520 6d69 6e20 6561  time is 5 min ea
-00006bc0: 726c 6965 722c 2075 7365 2074 6861 742c  rlier, use that,
-00006bd0: 206f 7468 6572 7769 7365 0a20 2020 2020   otherwise.     
-00006be0: 2020 2020 2020 2020 2020 2023 2063 616c             # cal
-00006bf0: 6375 6c61 7465 2061 2073 656e 7369 626c  culate a sensibl
-00006c00: 6520 7374 6172 7420 7469 6d65 2e20 5468  e start time. Th
-00006c10: 6520 3520 6d69 6e20 6170 706c 6965 7320  e 5 min applies 
-00006c20: 7768 656e 2061 2073 656e 7369 626c 650a  when a sensible.
-00006c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006c40: 2320 7374 6172 7420 7469 6d65 2068 6173  # start time has
-00006c50: 2061 6c72 6561 6479 2062 6565 6e20 7365   already been se
-00006c60: 742c 206f 7220 7768 656e 2074 6865 2064  t, or when the d
-00006c70: 6961 6c6f 6720 6861 7320 6265 656e 0a20  ialog has been. 
-00006c80: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00006c90: 206f 6e20 2273 7461 7274 206e 6f77 2220   on "start now" 
-00006ca0: 666f 7220 6f76 6572 2035 206d 696e 7574  for over 5 minut
-00006cb0: 6573 2028 7768 6963 6820 6973 2061 6c73  es (which is als
-00006cc0: 6f20 4f4b 2049 2067 7565 7373 292e 0a20  o OK I guess).. 
-00006cd0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00006ce0: 6620 7365 6c66 2e74 3120 3c3d 2074 3220  f self.t1 <= t2 
-00006cf0: 2d20 3330 303a 0a20 2020 2020 2020 2020  - 300:.         
-00006d00: 2020 2020 2020 2020 2020 2074 3120 3d20             t1 = 
-00006d10: 7365 6c66 2e74 310a 2020 2020 2020 2020  self.t1.        
-00006d20: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00006d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006d40: 2020 7431 203d 2073 656c 662e 5f67 6574    t1 = self._get
-00006d50: 5f73 656e 7369 626c 655f 7374 6172 745f  _sensible_start_
-00006d60: 7469 6d65 2829 0a20 2020 2020 2020 2020  time().         
-00006d70: 2020 2020 2020 2069 6620 7365 6c66 2e72         if self.r
-00006d80: 6164 696f 5f73 7461 7274 726c 722e 6368  adio_startrlr.ch
-00006d90: 6563 6b65 643a 0a20 2020 2020 2020 2020  ecked:.         
-00006da0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00006db0: 7265 7365 7428 7431 2c20 7431 290a 2020  reset(t1, t1).  
-00006dc0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00006dd0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00006de0: 2020 2020 2020 2020 7365 6c66 2e72 6573          self.res
-00006df0: 6574 2874 312c 2074 3229 0a20 2020 2020  et(t1, t2).     
-00006e00: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00006e10: 2020 2020 2023 2053 7769 7463 6820 6265       # Switch be
-00006e20: 7477 6565 6e20 2261 6c72 6561 6479 2072  tween "already r
-00006e30: 756e 6e69 6e67 2220 616e 6420 2266 696e  unning" and "fin
-00006e40: 6973 6865 6422 2e0a 2020 2020 2020 2020  ished"..        
-00006e50: 2020 2020 2320 5369 6e63 6520 7468 6973      # Since this
-00006e60: 2069 7320 616e 2065 7869 7374 696e 6720   is an existing 
-00006e70: 7265 636f 7264 2c20 7765 2073 686f 756c  record, we shoul
-00006e80: 6420 6d61 696e 7461 696e 2069 6e69 7469  d maintain initi
-00006e90: 616c 2076 616c 7565 732e 0a20 2020 2020  al values..     
-00006ea0: 2020 2020 2020 2069 6620 7365 6c66 2e72         if self.r
-00006eb0: 6164 696f 5f73 7461 7274 726c 722e 6368  adio_startrlr.ch
-00006ec0: 6563 6b65 643a 0a20 2020 2020 2020 2020  ecked:.         
-00006ed0: 2020 2020 2020 2073 656c 662e 7265 7365         self.rese
-00006ee0: 7428 7365 6c66 2e69 6e69 7469 616c 5f74  t(self.initial_t
-00006ef0: 312c 2073 656c 662e 696e 6974 6961 6c5f  1, self.initial_
-00006f00: 7431 290a 2020 2020 2020 2020 2020 2020  t1).            
-00006f10: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00006f20: 2020 2020 2020 7432 203d 206d 6178 2873        t2 = max(s
-00006f30: 656c 662e 696e 6974 6961 6c5f 7431 202b  elf.initial_t1 +
-00006f40: 2031 2c20 6474 2e6e 6f77 2829 290a 2020   1, dt.now()).  
-00006f50: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00006f60: 6c66 2e72 6573 6574 2873 656c 662e 696e  lf.reset(self.in
-00006f70: 6974 6961 6c5f 7431 2c20 7432 290a 0a20  itial_t1, t2).. 
-00006f80: 2020 2064 6566 2072 6573 6574 2873 656c     def reset(sel
-00006f90: 662c 2074 312c 2074 322c 2069 6e69 7469  f, t1, t2, initi
-00006fa0: 616c 3d46 616c 7365 293a 0a20 2020 2020  al=False):.     
-00006fb0: 2020 2022 2222 5265 7365 7420 7769 7468     """Reset with
-00006fc0: 2061 2067 6976 656e 2074 3120 616e 6420   a given t1 and 
-00006fd0: 7432 2e22 2222 0a0a 2020 2020 2020 2020  t2."""..        
-00006fe0: 2320 5374 6f72 6520 6f72 6967 696e 616c  # Store original
-00006ff0: 730a 2020 2020 2020 2020 7365 6c66 2e6f  s.        self.o
-00007000: 7269 5f74 3120 3d20 7365 6c66 2e74 3120  ri_t1 = self.t1 
-00007010: 3d20 7431 0a20 2020 2020 2020 2073 656c  = t1.        sel
-00007020: 662e 6f72 695f 7432 203d 2073 656c 662e  f.ori_t2 = self.
-00007030: 7432 203d 2074 320a 0a20 2020 2020 2020  t2 = t2..       
-00007040: 2023 2047 6574 206f 7269 6769 6e61 6c20   # Get original 
-00007050: 6461 7465 7320 616e 6420 2873 7472 2920  dates and (str) 
-00007060: 7469 6d65 730a 2020 2020 2020 2020 7365  times.        se
-00007070: 6c66 2e6f 7269 5f64 6174 6531 2c20 7365  lf.ori_date1, se
-00007080: 6c66 2e6f 7269 5f74 696d 6531 203d 2064  lf.ori_time1 = d
-00007090: 742e 7469 6d65 326c 6f63 616c 7374 7228  t.time2localstr(
-000070a0: 7365 6c66 2e74 3129 2e73 706c 6974 2822  self.t1).split("
-000070b0: 2022 290a 2020 2020 2020 2020 7365 6c66   ").        self
-000070c0: 2e6f 7269 5f64 6174 6532 2c20 7365 6c66  .ori_date2, self
-000070d0: 2e6f 7269 5f74 696d 6532 203d 2064 742e  .ori_time2 = dt.
-000070e0: 7469 6d65 326c 6f63 616c 7374 7228 7365  time2localstr(se
-000070f0: 6c66 2e74 3229 2e73 706c 6974 2822 2022  lf.t2).split(" "
-00007100: 290a 2020 2020 2020 2020 7365 6c66 2e6f  ).        self.o
-00007110: 7269 5f64 6179 7332 203d 2073 656c 662e  ri_days2 = self.
-00007120: 6461 7973 3220 3d20 7365 6c66 2e5f 6461  days2 = self._da
-00007130: 7973 5f62 6574 7765 656e 5f64 6174 6573  ys_between_dates
-00007140: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
-00007150: 6c66 2e6f 7269 5f64 6174 6531 2c20 7365  lf.ori_date1, se
-00007160: 6c66 2e6f 7269 5f64 6174 6532 0a20 2020  lf.ori_date2.   
-00007170: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00007180: 2320 5374 6f72 6520 6f72 6967 696e 616c  # Store original
-00007190: 2073 7472 2064 7572 6174 696f 6e0a 2020   str duration.  
-000071a0: 2020 2020 2020 7420 3d20 7432 202d 2074        t = t2 - t
-000071b0: 310a 2020 2020 2020 2020 7365 6c66 2e6f  1.        self.o
-000071c0: 7269 5f64 7572 6174 696f 6e20 3d20 6622  ri_duration = f"
-000071d0: 7b74 2f2f 3336 3030 3a2e 3066 7d68 207b  {t//3600:.0f}h {
-000071e0: 2874 2f2f 3630 2925 3630 3a30 322e 3066  (t//60)%60:02.0f
-000071f0: 7d6d 207b 7425 3630 3a30 322e 3066 7d73  }m {t%60:02.0f}s
-00007200: 220a 0a20 2020 2020 2020 2073 656c 662e  "..        self.
-00007210: 5f73 6574 5f74 696d 655f 696e 7075 745f  _set_time_input_
-00007220: 7669 7369 6269 6c69 7479 2829 0a20 2020  visibility().   
-00007230: 2020 2020 2073 656c 662e 7265 6e64 6572       self.render
-00007240: 2829 0a20 2020 2020 2020 2069 6620 6e6f  ().        if no
-00007250: 7420 696e 6974 6961 6c3a 0a20 2020 2020  t initial:.     
-00007260: 2020 2020 2020 2077 696e 646f 772e 7365         window.se
-00007270: 7454 696d 656f 7574 2873 656c 662e 6361  tTimeout(self.ca
-00007280: 6c6c 6261 636b 2c20 3129 0a0a 2020 2020  llback, 1)..    
-00007290: 6465 6620 5f73 6574 5f74 696d 655f 696e  def _set_time_in
-000072a0: 7075 745f 7669 7369 6269 6c69 7479 2873  put_visibility(s
-000072b0: 656c 6629 3a0a 2020 2020 2020 2020 6465  elf):.        de
-000072c0: 6620 7368 6f77 5f73 7562 6e6f 6465 2869  f show_subnode(i
-000072d0: 2c20 7368 6f77 293a 0a20 2020 2020 2020  , show):.       
-000072e0: 2020 2020 2073 7562 6e6f 6465 203d 2073       subnode = s
-000072f0: 656c 662e 6772 6964 6e6f 6465 2e63 6869  elf.gridnode.chi
-00007300: 6c64 7265 6e5b 695d 0a20 2020 2020 2020  ldren[i].       
-00007310: 2020 2020 2069 6620 6e6f 7420 7368 6f77       if not show
-00007320: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00007330: 2020 7375 626e 6f64 652e 7374 796c 652e    subnode.style.
-00007340: 6469 7370 6c61 7920 3d20 226e 6f6e 6522  display = "none"
-00007350: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-00007360: 6620 6920 2520 3420 3d3d 2032 3a0a 2020  f i % 4 == 2:.  
-00007370: 2020 2020 2020 2020 2020 2020 2020 7375                su
-00007380: 626e 6f64 652e 7374 796c 652e 6469 7370  bnode.style.disp
-00007390: 6c61 7920 3d20 2266 6c65 7822 0a20 2020  lay = "flex".   
-000073a0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-000073b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000073c0: 7562 6e6f 6465 2e73 7479 6c65 2e64 6973  ubnode.style.dis
-000073d0: 706c 6179 203d 2022 696e 6c69 6e65 2d62  play = "inline-b
-000073e0: 6c6f 636b 220a 0a20 2020 2020 2020 2066  lock"..        f
-000073f0: 6f72 2069 2069 6e20 7261 6e67 6528 302c  or i in range(0,
-00007400: 2034 293a 0a20 2020 2020 2020 2020 2020   4):.           
-00007410: 2073 686f 775f 7375 626e 6f64 6528 692c   show_subnode(i,
-00007420: 206e 6f74 2073 656c 662e 7261 6469 6f5f   not self.radio_
-00007430: 7374 6172 746e 6f77 2e63 6865 636b 6564  startnow.checked
-00007440: 290a 2020 2020 2020 2020 666f 7220 6920  ).        for i 
-00007450: 696e 2072 616e 6765 2834 2c20 3829 3a0a  in range(4, 8):.
-00007460: 2020 2020 2020 2020 2020 2020 7368 6f77              show
-00007470: 5f73 7562 6e6f 6465 2869 2c20 7365 6c66  _subnode(i, self
-00007480: 2e72 6164 696f 5f66 696e 6973 6865 642e  .radio_finished.
-00007490: 6368 6563 6b65 6429 0a20 2020 2020 2020  checked).       
-000074a0: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-000074b0: 382c 2031 3229 3a0a 2020 2020 2020 2020  8, 12):.        
-000074c0: 2020 2020 7368 6f77 5f73 7562 6e6f 6465      show_subnode
-000074d0: 2869 2c20 6e6f 7420 7365 6c66 2e72 6164  (i, not self.rad
-000074e0: 696f 5f73 7461 7274 6e6f 772e 6368 6563  io_startnow.chec
-000074f0: 6b65 6429 0a0a 2020 2020 6465 6620 5f75  ked)..    def _u
-00007500: 7064 6174 655f 6475 7261 7469 6f6e 2873  pdate_duration(s
-00007510: 656c 662c 2066 6f72 6365 3d46 616c 7365  elf, force=False
-00007520: 293a 0a20 2020 2020 2020 2069 735f 7275  ):.        is_ru
-00007530: 6e6e 696e 6720 3d20 7365 6c66 2e6f 7269  nning = self.ori
-00007540: 5f74 3120 3d3d 2073 656c 662e 6f72 695f  _t1 == self.ori_
-00007550: 7432 0a20 2020 2020 2020 2069 6620 6e6f  t2.        if no
-00007560: 7420 2866 6f72 6365 206f 7220 6973 5f72  t (force or is_r
-00007570: 756e 6e69 6e67 293a 0a20 2020 2020 2020  unning):.       
-00007580: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
-00007590: 2020 2020 2069 6620 6973 5f72 756e 6e69       if is_runni
-000075a0: 6e67 3a0a 2020 2020 2020 2020 2020 2020  ng:.            
-000075b0: 7420 3d20 6474 2e6e 6f77 2829 202d 2073  t = dt.now() - s
-000075c0: 656c 662e 7431 0a20 2020 2020 2020 2020  elf.t1.         
-000075d0: 2020 2073 656c 662e 6475 7261 7469 6f6e     self.duration
-000075e0: 696e 7075 742e 7661 6c75 6520 3d20 280a  input.value = (.
-000075f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007600: 6622 7b74 2f2f 3336 3030 3a2e 3066 7d68  f"{t//3600:.0f}h
-00007610: 207b 2874 2f2f 3630 2925 3630 3a30 322e   {(t//60)%60:02.
-00007620: 3066 7d6d 207b 7425 3630 3a30 322e 3066  0f}m {t%60:02.0f
-00007630: 7d73 220a 2020 2020 2020 2020 2020 2020  }s".            
-00007640: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-00007650: 2020 2020 2020 2020 2020 2020 7420 3d20              t = 
-00007660: 7365 6c66 2e74 3220 2d20 7365 6c66 2e74  self.t2 - self.t
-00007670: 310a 2020 2020 2020 2020 2020 2020 6d20  1.            m 
-00007680: 3d20 4d61 7468 2e72 6f75 6e64 2874 202f  = Math.round(t /
-00007690: 2036 3029 0a20 2020 2020 2020 2020 2020   60).           
-000076a0: 2073 656c 662e 6475 7261 7469 6f6e 696e   self.durationin
-000076b0: 7075 742e 7661 6c75 6520 3d20 6622 7b6d  put.value = f"{m
-000076c0: 2f2f 3630 3a2e 3066 7d68 207b 6d25 3630  //60:.0f}h {m%60
-000076d0: 3a30 322e 3066 7d6d 220a 0a20 2020 2064  :02.0f}m"..    d
-000076e0: 6566 205f 6461 7973 5f62 6574 7765 656e  ef _days_between
-000076f0: 5f64 6174 6573 2873 656c 662c 2064 312c  _dates(self, d1,
-00007700: 2064 3229 3a0a 2020 2020 2020 2020 7965   d2):.        ye
-00007710: 6172 312c 206d 6f6e 7468 312c 2064 6179  ar1, month1, day
-00007720: 3120 3d20 6431 2e73 706c 6974 2822 2d22  1 = d1.split("-"
-00007730: 290a 2020 2020 2020 2020 7965 6172 322c  ).        year2,
-00007740: 206d 6f6e 7468 322c 2064 6179 3220 3d20   month2, day2 = 
-00007750: 6432 2e73 706c 6974 2822 2d22 290a 2020  d2.split("-").  
-00007760: 2020 2020 2020 6474 3120 3d20 7769 6e64        dt1 = wind
-00007770: 6f77 2e44 6174 6528 7965 6172 312c 206d  ow.Date(year1, m
-00007780: 6f6e 7468 3120 2d20 312c 2064 6179 3129  onth1 - 1, day1)
-00007790: 2e67 6574 5469 6d65 2829 0a20 2020 2020  .getTime().     
-000077a0: 2020 2066 6f72 2065 7874 7261 6461 7920     for extraday 
-000077b0: 696e 2072 616e 6765 2831 3030 293a 0a20  in range(100):. 
-000077c0: 2020 2020 2020 2020 2020 2064 7432 203d             dt2 =
-000077d0: 2077 696e 646f 772e 4461 7465 2879 6561   window.Date(yea
-000077e0: 7232 2c20 6d6f 6e74 6832 202d 2031 2c20  r2, month2 - 1, 
-000077f0: 6461 7932 202d 2065 7874 7261 6461 7929  day2 - extraday)
-00007800: 2e67 6574 5469 6d65 2829 0a20 2020 2020  .getTime().     
-00007810: 2020 2020 2020 2069 6620 6474 3120 3d3d         if dt1 ==
-00007820: 2064 7432 3a0a 2020 2020 2020 2020 2020   dt2:.          
-00007830: 2020 2020 2020 7265 7475 726e 2065 7874        return ext
-00007840: 7261 6461 790a 2020 2020 2020 2020 656c  raday.        el
-00007850: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00007860: 7265 7475 726e 2030 2020 2320 6d6f 7265  return 0  # more
-00007870: 2074 6861 6e20 3130 3020 6461 7973 202e   than 100 days .
-00007880: 2e2e 2066 616c 6c20 6261 636b 2074 6f20  .. fall back to 
-00007890: 7a65 726f 3f0a 0a20 2020 2064 6566 205f  zero?..    def _
-000078a0: 6765 745f 7469 6d65 2873 656c 662c 2077  get_time(self, w
-000078b0: 6861 742c 2066 616c 6c62 6163 6b3d 5472  hat, fallback=Tr
-000078c0: 7565 293a 0a20 2020 2020 2020 206e 6f64  ue):.        nod
-000078d0: 6520 3d20 7365 6c66 5b77 6861 7420 2b20  e = self[what + 
-000078e0: 2269 6e70 7574 225d 0a20 2020 2020 2020  "input"].       
-000078f0: 2068 6820 3d20 6d6d 203d 2073 7320 3d20   hh = mm = ss = 
-00007900: 4e6f 6e65 0a20 2020 2020 2020 2069 6620  None.        if 
-00007910: 6e6f 6465 2e76 616c 7565 3a0a 2020 2020  node.value:.    
-00007920: 2020 2020 2020 2020 6868 2c20 6d6d 2c20          hh, mm, 
-00007930: 7373 203d 2075 7469 6c73 2e74 696d 6573  ss = utils.times
-00007940: 7472 3274 7570 6c65 286e 6f64 652e 7661  tr2tuple(node.va
-00007950: 6c75 6529 0a20 2020 2020 2020 2069 6620  lue).        if 
-00007960: 6868 2069 7320 4e6f 6e65 2061 6e64 2066  hh is None and f
-00007970: 616c 6c62 6163 6b3a 0a20 2020 2020 2020  allback:.       
-00007980: 2020 2020 2069 6620 7768 6174 203d 3d20       if what == 
-00007990: 2274 696d 6532 223a 0a20 2020 2020 2020  "time2":.       
-000079a0: 2020 2020 2020 2020 2073 656c 662e 6461           self.da
-000079b0: 7973 3220 3d20 7365 6c66 2e6f 7269 5f64  ys2 = self.ori_d
-000079c0: 6179 7332 2020 2320 7265 7374 2061 6c6f  ays2  # rest alo
-000079d0: 6e67 2077 6974 6820 7469 6d65 320a 2020  ng with time2.  
-000079e0: 2020 2020 2020 2020 2020 6868 2c20 6d6d            hh, mm
-000079f0: 2c20 7373 203d 2075 7469 6c73 2e74 696d  , ss = utils.tim
-00007a00: 6573 7472 3274 7570 6c65 2873 656c 665b  estr2tuple(self[
-00007a10: 226f 7269 5f22 202b 2077 6861 745d 290a  "ori_" + what]).
-00007a20: 2020 2020 2020 2020 7265 7475 726e 2068          return h
-00007a30: 682c 206d 6d2c 2073 730a 0a20 2020 2064  h, mm, ss..    d
-00007a40: 6566 2072 656e 6465 7228 7365 6c66 293a  ef render(self):
-00007a50: 0a20 2020 2020 2020 206e 6f77 203d 2064  .        now = d
-00007a60: 742e 6e6f 7728 290a 0a20 2020 2020 2020  t.now()..       
-00007a70: 2023 2047 6574 2064 6174 652f 7469 6d65   # Get date/time
-00007a80: 2069 6e66 6f0a 2020 2020 2020 2020 7431   info.        t1
-00007a90: 5f64 6174 652c 2074 315f 7469 6d65 203d  _date, t1_time =
-00007aa0: 2064 742e 7469 6d65 326c 6f63 616c 7374   dt.time2localst
-00007ab0: 7228 7365 6c66 2e74 3129 2e73 706c 6974  r(self.t1).split
-00007ac0: 2822 2022 290a 2020 2020 2020 2020 7432  (" ").        t2
-00007ad0: 5f64 6174 652c 2074 325f 7469 6d65 203d  _date, t2_time =
-00007ae0: 2064 742e 7469 6d65 326c 6f63 616c 7374   dt.time2localst
-00007af0: 7228 7365 6c66 2e74 3229 2e73 706c 6974  r(self.t2).split
-00007b00: 2822 2022 290a 2020 2020 2020 2020 6e6f  (" ").        no
-00007b10: 775f 6461 7465 2c20 6e6f 775f 7469 6d65  w_date, now_time
-00007b20: 203d 2064 742e 7469 6d65 326c 6f63 616c   = dt.time2local
-00007b30: 7374 7228 6e6f 7729 2e73 706c 6974 2822  str(now).split("
-00007b40: 2022 290a 0a20 2020 2020 2020 2023 2053   ")..        # S
-00007b50: 6574 2064 6174 6520 616e 6420 7469 6d65  et date and time
-00007b60: 2066 6f72 2074 310a 2020 2020 2020 2020   for t1.        
-00007b70: 7365 6c66 2e64 6174 6531 696e 7075 742e  self.date1input.
-00007b80: 7661 6c75 6520 3d20 7431 5f64 6174 650a  value = t1_date.
-00007b90: 2020 2020 2020 2020 7365 6c66 2e74 696d          self.tim
-00007ba0: 6531 696e 7075 742e 7661 6c75 6520 3d20  e1input.value = 
-00007bb0: 7431 5f74 696d 655b 3a35 5d0a 2020 2020  t1_time[:5].    
-00007bc0: 2020 2020 7365 6c66 2e64 6179 7332 203d      self.days2 =
-00007bd0: 2073 656c 662e 5f64 6179 735f 6265 7477   self._days_betw
-00007be0: 6565 6e5f 6461 7465 7328 7431 5f64 6174  een_dates(t1_dat
-00007bf0: 652c 2074 325f 6461 7465 290a 0a20 2020  e, t2_date)..   
-00007c00: 2020 2020 2023 2053 6574 2073 746f 7020       # Set stop 
-00007c10: 7469 6d65 2061 6e64 2064 7572 6174 696f  time and duratio
-00007c20: 6e0a 2020 2020 2020 2020 6966 2073 656c  n.        if sel
-00007c30: 662e 7431 203d 3d20 7365 6c66 2e74 323a  f.t1 == self.t2:
-00007c40: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
-00007c50: 7320 7275 6e6e 696e 670a 2020 2020 2020  s running.      
-00007c60: 2020 2020 2020 7420 3d20 6e6f 7720 2d20        t = now - 
-00007c70: 7365 6c66 2e74 310a 2020 2020 2020 2020  self.t1.        
-00007c80: 2020 2020 7365 6c66 2e74 696d 6532 696e      self.time2in
-00007c90: 7075 742e 6469 7361 626c 6564 203d 2054  put.disabled = T
-00007ca0: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-00007cb0: 7365 6c66 2e64 6174 6532 696e 7075 742e  self.date2input.
-00007cc0: 6469 7361 626c 6564 203d 2054 7275 650a  disabled = True.
-00007cd0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00007ce0: 2e64 7572 6174 696f 6e69 6e70 7574 2e64  .durationinput.d
-00007cf0: 6973 6162 6c65 6420 3d20 5472 7565 0a20  isabled = True. 
-00007d00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00007d10: 6461 7465 3269 6e70 7574 2e76 616c 7565  date2input.value
-00007d20: 203d 206e 6f77 5f64 6174 650a 2020 2020   = now_date.    
-00007d30: 2020 2020 2020 2020 7365 6c66 2e74 696d          self.tim
-00007d40: 6532 696e 7075 742e 7661 6c75 6520 3d20  e2input.value = 
-00007d50: 2272 756e 6e69 6e67 220a 2020 2020 2020  "running".      
-00007d60: 2020 2020 2020 7365 6c66 2e5f 7570 6461        self._upda
-00007d70: 7465 5f64 7572 6174 696f 6e28 2920 2023  te_duration()  #
-00007d80: 2075 7365 206d 6574 686f 6420 7468 6174   use method that
-00007d90: 2077 6520 616c 736f 2075 7365 2070 6572   we also use per
-00007da0: 696f 6469 6361 6c6c 790a 2020 2020 2020  iodically.      
-00007db0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00007dc0: 2020 2020 2320 4973 206e 6f74 2072 756e      # Is not run
-00007dd0: 6e69 6e67 0a20 2020 2020 2020 2020 2020  ning.           
-00007de0: 2074 203d 2073 656c 662e 7432 202d 2073   t = self.t2 - s
-00007df0: 656c 662e 7431 0a20 2020 2020 2020 2020  elf.t1.         
-00007e00: 2020 2073 656c 662e 7469 6d65 3269 6e70     self.time2inp
-00007e10: 7574 2e64 6973 6162 6c65 6420 3d20 4661  ut.disabled = Fa
-00007e20: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-00007e30: 7365 6c66 2e64 6174 6532 696e 7075 742e  self.date2input.
-00007e40: 6469 7361 626c 6564 203d 2046 616c 7365  disabled = False
-00007e50: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00007e60: 662e 6475 7261 7469 6f6e 696e 7075 742e  f.durationinput.
-00007e70: 6469 7361 626c 6564 203d 2046 616c 7365  disabled = False
-00007e80: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00007e90: 662e 6461 7465 3269 6e70 7574 2e76 616c  f.date2input.val
-00007ea0: 7565 203d 2074 325f 6461 7465 0a20 2020  ue = t2_date.   
-00007eb0: 2020 2020 2020 2020 2073 656c 662e 7469           self.ti
-00007ec0: 6d65 3269 6e70 7574 2e76 616c 7565 203d  me2input.value =
-00007ed0: 2074 325f 7469 6d65 5b3a 355d 0a20 2020   t2_time[:5].   
-00007ee0: 2020 2020 2020 2020 206d 203d 204d 6174           m = Mat
-00007ef0: 682e 726f 756e 6428 7420 2f20 3630 290a  h.round(t / 60).
-00007f00: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00007f10: 2e64 7572 6174 696f 6e69 6e70 7574 2e76  .durationinput.v
-00007f20: 616c 7565 203d 2066 227b 6d2f 2f36 303a  alue = f"{m//60:
-00007f30: 2e30 667d 6820 7b6d 2536 303a 3032 2e30  .0f}h {m%60:02.0
-00007f40: 667d 6d22 0a0a 2020 2020 2020 2020 2320  f}m"..        # 
-00007f50: 5477 6561 6b20 6267 636f 6c6f 7220 6f66  Tweak bgcolor of
-00007f60: 2064 6174 6532 2066 6965 6c64 2074 6f20   date2 field to 
-00007f70: 6869 6465 2069 7420 6120 6269 740a 2020  hide it a bit.  
-00007f80: 2020 2020 2020 6966 2073 656c 662e 6461        if self.da
-00007f90: 7973 3220 3d3d 2030 3a0a 2020 2020 2020  ys2 == 0:.      
-00007fa0: 2020 2020 2020 7365 6c66 2e64 6174 6532        self.date2
-00007fb0: 696e 7075 742e 7374 796c 652e 636f 6c6f  input.style.colo
-00007fc0: 7220 3d20 2223 3838 3822 0a20 2020 2020  r = "#888".     
-00007fd0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00007fe0: 2020 2020 2073 656c 662e 6461 7465 3269       self.date2i
-00007ff0: 6e70 7574 2e73 7479 6c65 2e63 6f6c 6f72  nput.style.color
-00008000: 203d 204e 6f6e 650a 0a20 2020 2064 6566   = None..    def
-00008010: 206f 6e63 6861 6e67 6564 2873 656c 662c   onchanged(self,
-00008020: 2061 6374 696f 6e29 3a0a 2020 2020 2020   action):.      
-00008030: 2020 6e6f 7720 3d20 6474 2e6e 6f77 2829    now = dt.now()
-00008040: 0a0a 2020 2020 2020 2020 2320 4765 7420  ..        # Get 
-00008050: 6e6f 6465 0a20 2020 2020 2020 2069 6620  node.        if 
-00008060: 280a 2020 2020 2020 2020 2020 2020 6163  (.            ac
-00008070: 7469 6f6e 2e65 6e64 7357 6974 6828 226d  tion.endsWith("m
-00008080: 6f72 6522 290a 2020 2020 2020 2020 2020  ore").          
-00008090: 2020 6f72 2061 6374 696f 6e2e 656e 6473    or action.ends
-000080a0: 5769 7468 2822 6c65 7373 2229 0a20 2020  With("less").   
-000080b0: 2020 2020 2020 2020 206f 7220 6163 7469           or acti
-000080c0: 6f6e 2e65 6e64 7377 6974 6828 2266 6173  on.endswith("fas
-000080d0: 7422 290a 2020 2020 2020 2020 293a 0a20  t").        ):. 
-000080e0: 2020 2020 2020 2020 2020 2077 6861 7420             what 
-000080f0: 3d20 6163 7469 6f6e 5b3a 2d34 5d0a 2020  = action[:-4].  
-00008100: 2020 2020 2020 2020 2020 6f70 7469 6f6e            option
-00008110: 203d 2061 6374 696f 6e5b 2d34 3a5d 0a20   = action[-4:]. 
-00008120: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00008130: 2020 2020 2020 2020 2077 6861 7420 3d20           what = 
-00008140: 6163 7469 6f6e 0a20 2020 2020 2020 2020  action.         
-00008150: 2020 206f 7074 696f 6e20 3d20 2222 0a20     option = "". 
-00008160: 2020 2020 2020 206e 6f64 6520 3d20 7365         node = se
-00008170: 6c66 5b77 6861 7420 2b20 2269 6e70 7574  lf[what + "input
-00008180: 225d 0a20 2020 2020 2020 2069 6620 6e6f  "].        if no
-00008190: 7420 6e6f 6465 3a0a 2020 2020 2020 2020  t node:.        
-000081a0: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
-000081b0: 2020 2020 6361 6c6c 5f63 616c 6c62 6163      call_callbac
-000081c0: 6b20 3d20 5472 7565 0a0a 2020 2020 2020  k = True..      
-000081d0: 2020 2320 4765 7420 7468 6520 7265 6665    # Get the refe
-000081e0: 7265 6e63 6520 6461 7465 730a 2020 2020  rence dates.    
-000081f0: 2020 2020 6966 2073 656c 662e 6461 7465      if self.date
-00008200: 3169 6e70 7574 2e76 616c 7565 3a0a 2020  1input.value:.  
-00008210: 2020 2020 2020 2020 2020 7965 6172 312c            year1,
-00008220: 206d 6f6e 7468 312c 2064 6179 3120 3d20   month1, day1 = 
-00008230: 7365 6c66 2e64 6174 6531 696e 7075 742e  self.date1input.
-00008240: 7661 6c75 652e 7370 6c69 7428 222d 2229  value.split("-")
-00008250: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00008260: 2020 2020 2020 2020 2020 2079 6561 7231             year1
-00008270: 2c20 6d6f 6e74 6831 2c20 6461 7931 203d  , month1, day1 =
-00008280: 2073 656c 662e 6f72 695f 6461 7465 312e   self.ori_date1.
-00008290: 7370 6c69 7428 222d 2229 0a20 2020 2020  split("-").     
-000082a0: 2020 2079 6561 7231 2c20 6d6f 6e74 6831     year1, month1
-000082b0: 2c20 6461 7931 203d 2069 6e74 2879 6561  , day1 = int(yea
-000082c0: 7231 292c 2069 6e74 286d 6f6e 7468 3129  r1), int(month1)
-000082d0: 2c20 696e 7428 6461 7931 290a 2020 2020  , int(day1).    
-000082e0: 2020 2020 230a 2020 2020 2020 2020 6966      #.        if
-000082f0: 2073 656c 662e 6461 7465 3269 6e70 7574   self.date2input
-00008300: 2e76 616c 7565 3a0a 2020 2020 2020 2020  .value:.        
-00008310: 2020 2020 7965 6172 322c 206d 6f6e 7468      year2, month
-00008320: 322c 2064 6179 3220 3d20 7365 6c66 2e64  2, day2 = self.d
-00008330: 6174 6532 696e 7075 742e 7661 6c75 652e  ate2input.value.
-00008340: 7370 6c69 7428 222d 2229 0a20 2020 2020  split("-").     
-00008350: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00008360: 2020 2020 2079 6561 7232 2c20 6d6f 6e74       year2, mont
-00008370: 6832 2c20 6461 7932 203d 2073 656c 662e  h2, day2 = self.
-00008380: 6f72 695f 6461 7465 322e 7370 6c69 7428  ori_date2.split(
-00008390: 222d 2229 0a20 2020 2020 2020 2079 6561  "-").        yea
-000083a0: 7232 2c20 6d6f 6e74 6832 2c20 6461 7932  r2, month2, day2
-000083b0: 203d 2069 6e74 2879 6561 7232 292c 2069   = int(year2), i
-000083c0: 6e74 286d 6f6e 7468 3229 2c20 696e 7428  nt(month2), int(
-000083d0: 6461 7932 290a 0a20 2020 2020 2020 2069  day2)..        i
-000083e0: 6620 7768 6174 203d 3d20 2264 6174 6531  f what == "date1
-000083f0: 223a 0a20 2020 2020 2020 2020 2020 2023  ":.            #
-00008400: 2043 6861 6e67 696e 6720 6461 7465 3120   Changing date1 
-00008410: 2d3e 2075 7064 6174 6520 626f 7468 2074  -> update both t
-00008420: 3120 616e 6420 7432 2c20 6461 7465 3220  1 and t2, date2 
-00008430: 6d6f 7665 7320 616c 6f6e 670a 2020 2020  moves along.    
-00008440: 2020 2020 2020 2020 6868 2c20 6d6d 2c20          hh, mm, 
-00008450: 7373 203d 2073 656c 662e 5f67 6574 5f74  ss = self._get_t
-00008460: 696d 6528 2274 696d 6531 2229 0a20 2020  ime("time1").   
-00008470: 2020 2020 2020 2020 2064 3120 3d20 7769           d1 = wi
-00008480: 6e64 6f77 2e44 6174 6528 7965 6172 312c  ndow.Date(year1,
-00008490: 206d 6f6e 7468 3120 2d20 312c 2064 6179   month1 - 1, day
-000084a0: 312c 2068 682c 206d 6d2c 2073 7329 0a20  1, hh, mm, ss). 
-000084b0: 2020 2020 2020 2020 2020 2068 682c 206d             hh, m
-000084c0: 6d2c 2073 7320 3d20 7365 6c66 2e5f 6765  m, ss = self._ge
-000084d0: 745f 7469 6d65 2822 7469 6d65 3222 290a  t_time("time2").
-000084e0: 2020 2020 2020 2020 2020 2020 6432 203d              d2 =
-000084f0: 2077 696e 646f 772e 4461 7465 2879 6561   window.Date(yea
-00008500: 7231 2c20 6d6f 6e74 6831 202d 2031 2c20  r1, month1 - 1, 
-00008510: 6461 7931 202b 2073 656c 662e 6461 7973  day1 + self.days
-00008520: 322c 2068 682c 206d 6d2c 2073 7329 0a20  2, hh, mm, ss). 
-00008530: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00008540: 7431 203d 2064 742e 746f 5f74 696d 655f  t1 = dt.to_time_
-00008550: 696e 7428 6431 290a 2020 2020 2020 2020  int(d1).        
-00008560: 2020 2020 7365 6c66 2e74 3220 3d20 6474      self.t2 = dt
-00008570: 2e74 6f5f 7469 6d65 5f69 6e74 2864 3229  .to_time_int(d2)
-00008580: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00008590: 7365 6c66 2e6f 7269 5f74 3120 3d3d 2073  self.ori_t1 == s
-000085a0: 656c 662e 6f72 695f 7432 3a0a 2020 2020  elf.ori_t2:.    
-000085b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000085c0: 2e74 3220 3d20 7365 6c66 2e74 310a 2020  .t2 = self.t1.  
-000085d0: 2020 2020 2020 2020 2020 656c 6966 2073            elif s
-000085e0: 656c 662e 7431 203e 3d20 7365 6c66 2e74  elf.t1 >= self.t
-000085f0: 323a 0a20 2020 2020 2020 2020 2020 2020  2:.             
-00008600: 2020 2073 656c 662e 7432 203d 2073 656c     self.t2 = sel
-00008610: 662e 7431 202b 2031 0a0a 2020 2020 2020  f.t1 + 1..      
-00008620: 2020 656c 6966 2077 6861 7420 3d3d 2022    elif what == "
-00008630: 6461 7465 3222 3a0a 2020 2020 2020 2020  date2":.        
-00008640: 2020 2020 2320 4368 616e 6769 6e67 2064      # Changing d
-00008650: 6174 6532 202d 3e20 7570 6461 7465 206f  ate2 -> update o
-00008660: 6e6c 7920 7432 0a20 2020 2020 2020 2020  nly t2.         
-00008670: 2020 2068 682c 206d 6d2c 2073 7320 3d20     hh, mm, ss = 
-00008680: 7365 6c66 2e5f 6765 745f 7469 6d65 2822  self._get_time("
-00008690: 7469 6d65 3222 290a 2020 2020 2020 2020  time2").        
-000086a0: 2020 2020 6432 203d 2077 696e 646f 772e      d2 = window.
-000086b0: 4461 7465 2879 6561 7232 2c20 6d6f 6e74  Date(year2, mont
-000086c0: 6832 202d 2031 2c20 6461 7932 2c20 6868  h2 - 1, day2, hh
-000086d0: 2c20 6d6d 2c20 7373 290a 2020 2020 2020  , mm, ss).      
-000086e0: 2020 2020 2020 7365 6c66 2e74 3220 3d20        self.t2 = 
-000086f0: 6474 2e74 6f5f 7469 6d65 5f69 6e74 2864  dt.to_time_int(d
-00008700: 3229 0a20 2020 2020 2020 2020 2020 2069  2).            i
-00008710: 6620 7365 6c66 2e6f 7269 5f74 3120 3d3d  f self.ori_t1 ==
-00008720: 2073 656c 662e 6f72 695f 7432 3a0a 2020   self.ori_t2:.  
-00008730: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00008740: 6c66 2e74 3220 3d20 7365 6c66 2e74 310a  lf.t2 = self.t1.
-00008750: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00008760: 2073 656c 662e 7432 203c 3d20 7365 6c66   self.t2 <= self
-00008770: 2e74 313a 0a20 2020 2020 2020 2020 2020  .t1:.           
-00008780: 2020 2020 2073 656c 662e 7432 203d 2073       self.t2 = s
-00008790: 656c 662e 7431 202b 2036 300a 0a20 2020  elf.t1 + 60..   
-000087a0: 2020 2020 2065 6c69 6620 7768 6174 203d       elif what =
-000087b0: 3d20 2274 696d 6531 223a 0a20 2020 2020  = "time1":.     
-000087c0: 2020 2020 2020 2023 2043 6861 6e67 696e         # Changin
-000087d0: 6720 7469 6d65 3120 2d3e 2075 7064 6174  g time1 -> updat
-000087e0: 6520 7431 2c20 6b65 6570 2074 3220 696e  e t1, keep t2 in
-000087f0: 2063 6865 636b 0a20 2020 2020 2020 2020   check.         
-00008800: 2020 2069 6620 6f70 7469 6f6e 203d 3d20     if option == 
-00008810: 2266 6173 7422 3a0a 2020 2020 2020 2020  "fast":.        
-00008820: 2020 2020 2020 2020 6868 2c20 6d6d 2c20          hh, mm, 
-00008830: 7373 203d 2073 656c 662e 5f67 6574 5f74  ss = self._get_t
-00008840: 696d 6528 2274 696d 6531 222c 2046 616c  ime("time1", Fal
-00008850: 7365 290a 2020 2020 2020 2020 2020 2020  se).            
-00008860: 2020 2020 6966 2068 6820 6973 206e 6f74      if hh is not
-00008870: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00008880: 2020 2020 2020 2020 2020 2064 3120 3d20             d1 = 
-00008890: 7769 6e64 6f77 2e44 6174 6528 7965 6172  window.Date(year
-000088a0: 312c 206d 6f6e 7468 3120 2d20 312c 2064  1, month1 - 1, d
-000088b0: 6179 312c 2068 682c 206d 6d2c 2073 7329  ay1, hh, mm, ss)
-000088c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000088d0: 2020 2020 2073 656c 662e 7431 203d 2064       self.t1 = d
-000088e0: 742e 746f 5f74 696d 655f 696e 7428 6431  t.to_time_int(d1
-000088f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00008900: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00008910: 2020 2020 2020 2020 2020 2020 6361 6c6c              call
-00008920: 5f63 616c 6c62 6163 6b20 3d20 4661 6c73  _callback = Fals
-00008930: 650a 2020 2020 2020 2020 2020 2020 656c  e.            el
-00008940: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00008950: 2020 2020 6868 2c20 6d6d 2c20 7373 203d      hh, mm, ss =
-00008960: 2073 656c 662e 5f67 6574 5f74 696d 6528   self._get_time(
-00008970: 2274 696d 6531 2229 0a20 2020 2020 2020  "time1").       
-00008980: 2020 2020 2020 2020 2069 6620 6f70 7469           if opti
-00008990: 6f6e 203d 3d20 226d 6f72 6522 3a0a 2020  on == "more":.  
-000089a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000089b0: 2020 6d6d 2c20 7373 203d 206d 6d20 2b20    mm, ss = mm + 
-000089c0: 352c 2030 0a20 2020 2020 2020 2020 2020  5, 0.           
-000089d0: 2020 2020 2065 6c69 6620 6f70 7469 6f6e       elif option
-000089e0: 203d 3d20 226c 6573 7322 3a0a 2020 2020   == "less":.    
-000089f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008a00: 6d6d 2c20 7373 203d 206d 6d20 2d20 352c  mm, ss = mm - 5,
-00008a10: 2030 0a20 2020 2020 2020 2020 2020 2020   0.             
-00008a20: 2020 2064 3120 3d20 7769 6e64 6f77 2e44     d1 = window.D
-00008a30: 6174 6528 7965 6172 312c 206d 6f6e 7468  ate(year1, month
-00008a40: 3120 2d20 312c 2064 6179 312c 2068 682c  1 - 1, day1, hh,
-00008a50: 206d 6d2c 2073 7329 0a20 2020 2020 2020   mm, ss).       
-00008a60: 2020 2020 2020 2020 2073 656c 662e 7431           self.t1
-00008a70: 203d 2064 742e 746f 5f74 696d 655f 696e   = dt.to_time_in
-00008a80: 7428 6431 290a 2020 2020 2020 2020 2020  t(d1).          
-00008a90: 2020 2020 2020 6966 2073 656c 662e 6f72        if self.or
-00008aa0: 695f 7431 203d 3d20 7365 6c66 2e6f 7269  i_t1 == self.ori
-00008ab0: 5f74 323a 0a20 2020 2020 2020 2020 2020  _t2:.           
-00008ac0: 2020 2020 2020 2020 2073 656c 662e 7432           self.t2
-00008ad0: 203d 2073 656c 662e 7431 203d 206d 696e   = self.t1 = min
-00008ae0: 2873 656c 662e 7431 2c20 6e6f 7729 0a20  (self.t1, now). 
-00008af0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00008b00: 6c69 6620 7365 6c66 2e74 3120 3e3d 2073  lif self.t1 >= s
-00008b10: 656c 662e 7432 3a0a 2020 2020 2020 2020  elf.t2:.        
-00008b20: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00008b30: 2e74 3220 3d20 7365 6c66 2e74 3120 2b20  .t2 = self.t1 + 
-00008b40: 310a 0a20 2020 2020 2020 2065 6c69 6620  1..        elif 
-00008b50: 7768 6174 203d 3d20 2274 696d 6532 223a  what == "time2":
-00008b60: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
-00008b70: 6861 6e67 696e 6720 7469 6d65 3220 2d3e  hanging time2 ->
-00008b80: 2075 7064 6174 6520 7432 2c20 6b65 6570   update t2, keep
-00008b90: 2074 3120 616e 6420 7432 2069 6e20 6368   t1 and t2 in ch
-00008ba0: 6563 6b0a 2020 2020 2020 2020 2020 2020  eck.            
-00008bb0: 6966 206f 7074 696f 6e20 3d3d 2022 6661  if option == "fa
-00008bc0: 7374 223a 0a20 2020 2020 2020 2020 2020  st":.           
-00008bd0: 2020 2020 2068 682c 206d 6d2c 2073 7320       hh, mm, ss 
-00008be0: 3d20 7365 6c66 2e5f 6765 745f 7469 6d65  = self._get_time
-00008bf0: 2822 7469 6d65 3222 2c20 4661 6c73 6529  ("time2", False)
-00008c00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008c10: 2069 6620 6868 2069 7320 6e6f 7420 4e6f   if hh is not No
-00008c20: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00008c30: 2020 2020 2020 2020 6432 203d 2077 696e          d2 = win
-00008c40: 646f 772e 4461 7465 2879 6561 7232 2c20  dow.Date(year2, 
-00008c50: 6d6f 6e74 6832 202d 2031 2c20 6461 7932  month2 - 1, day2
-00008c60: 2c20 6868 2c20 6d6d 2c20 7373 290a 2020  , hh, mm, ss).  
-00008c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008c80: 2020 7365 6c66 2e74 3220 3d20 6474 2e74    self.t2 = dt.t
-00008c90: 6f5f 7469 6d65 5f69 6e74 2864 3229 0a20  o_time_int(d2). 
-00008ca0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00008cb0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00008cc0: 2020 2020 2020 2020 2063 616c 6c5f 6361           call_ca
-00008cd0: 6c6c 6261 636b 203d 2046 616c 7365 0a20  llback = False. 
-00008ce0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00008cf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008d00: 2068 682c 206d 6d2c 2073 7320 3d20 7365   hh, mm, ss = se
-00008d10: 6c66 2e5f 6765 745f 7469 6d65 2822 7469  lf._get_time("ti
-00008d20: 6d65 3222 290a 2020 2020 2020 2020 2020  me2").          
-00008d30: 2020 2020 2020 6966 206f 7074 696f 6e20        if option 
-00008d40: 3d3d 2022 6d6f 7265 223a 0a20 2020 2020  == "more":.     
-00008d50: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00008d60: 6d2c 2073 7320 3d20 6d6d 202b 2035 2c20  m, ss = mm + 5, 
-00008d70: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
-00008d80: 2020 656c 6966 206f 7074 696f 6e20 3d3d    elif option ==
-00008d90: 2022 6c65 7373 223a 0a20 2020 2020 2020   "less":.       
-00008da0: 2020 2020 2020 2020 2020 2020 206d 6d2c               mm,
-00008db0: 2073 7320 3d20 6d6d 202d 2035 2c20 300a   ss = mm - 5, 0.
-00008dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008dd0: 6432 203d 2077 696e 646f 772e 4461 7465  d2 = window.Date
-00008de0: 2879 6561 7232 2c20 6d6f 6e74 6832 202d  (year2, month2 -
-00008df0: 2031 2c20 6461 7932 2c20 6868 2c20 6d6d   1, day2, hh, mm
-00008e00: 2c20 7373 290a 2020 2020 2020 2020 2020  , ss).          
-00008e10: 2020 2020 2020 7365 6c66 2e74 3220 3d20        self.t2 = 
-00008e20: 6474 2e74 6f5f 7469 6d65 5f69 6e74 2864  dt.to_time_int(d
-00008e30: 3229 0a20 2020 2020 2020 2020 2020 2020  2).             
-00008e40: 2020 2069 6620 7365 6c66 2e6f 7269 5f74     if self.ori_t
-00008e50: 3120 3d3d 2073 656c 662e 6f72 695f 7432  1 == self.ori_t2
-00008e60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00008e70: 2020 2020 2020 7365 6c66 2e74 3220 3d20        self.t2 = 
-00008e80: 7365 6c66 2e74 310a 2020 2020 2020 2020  self.t1.        
-00008e90: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
-00008ea0: 662e 7432 203c 3d20 7365 6c66 2e74 313a  f.t2 <= self.t1:
-00008eb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008ec0: 2020 2020 2073 656c 662e 7431 203d 2073       self.t1 = s
-00008ed0: 656c 662e 7432 0a20 2020 2020 2020 2020  elf.t2.         
-00008ee0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00008ef0: 7432 203d 2073 656c 662e 7431 202b 2031  t2 = self.t1 + 1
-00008f00: 0a0a 2020 2020 2020 2020 656c 6966 2077  ..        elif w
-00008f10: 6861 7420 3d3d 2022 6475 7261 7469 6f6e  hat == "duration
-00008f20: 223a 0a20 2020 2020 2020 2020 2020 2023  ":.            #
-00008f30: 2043 6861 6e67 696e 6720 6475 7261 7469   Changing durati
-00008f40: 6f6e 202d 3e20 7570 6461 7465 2074 322c  on -> update t2,
-00008f50: 2062 7574 206b 6565 7020 6974 2069 6e20   but keep it in 
-00008f60: 6368 6563 6b0a 2020 2020 2020 2020 2020  check.          
-00008f70: 2020 6868 2c20 6d6d 2c20 7373 203d 2073    hh, mm, ss = s
-00008f80: 656c 662e 5f67 6574 5f74 696d 6528 2264  elf._get_time("d
-00008f90: 7572 6174 696f 6e22 290a 2020 2020 2020  uration").      
-00008fa0: 2020 2020 2020 6475 7261 7469 6f6e 203d        duration =
-00008fb0: 2068 6820 2a20 3336 3030 202b 206d 6d20   hh * 3600 + mm 
-00008fc0: 2a20 3630 202b 2073 730a 2020 2020 2020  * 60 + ss.      
-00008fd0: 2020 2020 2020 2320 4170 706c 790a 2020        # Apply.  
-00008fe0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00008ff0: 662e 6f72 695f 7431 203d 3d20 7365 6c66  f.ori_t1 == self
-00009000: 2e6f 7269 5f74 323a 2020 2320 6661 696c  .ori_t2:  # fail
-00009010: 7361 6665 202d 206b 6565 7020 7275 6e6e  safe - keep runn
-00009020: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
-00009030: 2020 2020 7365 6c66 2e64 7572 6174 696f      self.duratio
-00009040: 6e20 3d20 300a 2020 2020 2020 2020 2020  n = 0.          
-00009050: 2020 2020 2020 7365 6c66 2e74 3220 3d20        self.t2 = 
-00009060: 7365 6c66 2e74 310a 2020 2020 2020 2020  self.t1.        
-00009070: 2020 2020 656c 6966 2064 7572 6174 696f      elif duratio
-00009080: 6e20 3c20 303a 0a20 2020 2020 2020 2020  n < 0:.         
-00009090: 2020 2020 2020 2073 656c 662e 7431 202b         self.t1 +
-000090a0: 3d20 6475 7261 7469 6f6e 0a20 2020 2020  = duration.     
-000090b0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000090c0: 7432 203d 2073 656c 662e 7431 202b 2031  t2 = self.t1 + 1
-000090d0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-000090e0: 6620 6e6f 7420 6475 7261 7469 6f6e 3a20  f not duration: 
-000090f0: 2023 204b 6565 7020 6e6f 742d 7275 6e6e   # Keep not-runn
-00009100: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
-00009110: 2020 2020 7365 6c66 2e74 3220 3d20 7365      self.t2 = se
-00009120: 6c66 2e74 3120 2b20 310a 2020 2020 2020  lf.t1 + 1.      
-00009130: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00009140: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00009150: 2e74 3220 3d20 7365 6c66 2e74 3120 2b20  .t2 = self.t1 + 
-00009160: 6475 7261 7469 6f6e 0a0a 2020 2020 2020  duration..      
-00009170: 2020 2320 496e 766f 6b65 2063 616c 6c62    # Invoke callb
-00009180: 6163 6b20 616e 6420 7265 7265 6e64 6572  ack and rerender
-00009190: 0a20 2020 2020 2020 2069 6620 6361 6c6c  .        if call
-000091a0: 5f63 616c 6c62 6163 6b3a 0a20 2020 2020  _callback:.     
-000091b0: 2020 2020 2020 2077 696e 646f 772e 7365         window.se
-000091c0: 7454 696d 656f 7574 2873 656c 662e 6361  tTimeout(self.ca
-000091d0: 6c6c 6261 636b 2c20 3129 0a0a 2020 2020  llback, 1)..    
-000091e0: 2020 2020 6966 2061 6374 696f 6e2e 656e      if action.en
-000091f0: 6473 7769 7468 2822 6661 7374 2229 3a0a  dswith("fast"):.
-00009200: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00009210: 2e5f 7570 6461 7465 5f64 7572 6174 696f  ._update_duratio
-00009220: 6e28 5472 7565 290a 2020 2020 2020 2020  n(True).        
-00009230: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00009240: 2020 7265 7475 726e 2073 656c 662e 7265    return self.re
-00009250: 6e64 6572 2829 0a0a 0a63 6f6d 706c 6574  nder()...complet
-00009260: 6572 5f61 6c6c 5f74 6167 7320 3d20 4e6f  er_all_tags = No
-00009270: 6e65 0a0a 0a63 6c61 7373 2041 7574 6f63  ne...class Autoc
-00009280: 6f6d 706c 6574 6572 3a0a 2020 2020 2222  ompleter:.    ""
-00009290: 2248 656c 7065 7220 636c 6173 7320 746f  "Helper class to
-000092a0: 2061 7574 6f63 6f6d 706c 6574 6520 7461   autocomplete ta
-000092b0: 6773 2e22 2222 0a0a 2020 2020 6465 6620  gs."""..    def 
-000092c0: 5f5f 696e 6974 5f5f 2873 656c 662c 2064  __init__(self, d
-000092d0: 6976 2c20 696e 7075 742c 2063 616c 6c62  iv, input, callb
-000092e0: 6163 6b2c 206d 6f64 655f 6d61 736b 3d31  ack, mode_mask=1
-000092f0: 3529 3a0a 2020 2020 2020 2020 7365 6c66  5):.        self
-00009300: 2e5f 6469 7620 3d20 6469 760a 2020 2020  ._div = div.    
-00009310: 2020 2020 7365 6c66 2e5f 696e 7075 7420      self._input 
-00009320: 3d20 696e 7075 740a 2020 2020 2020 2020  = input.        
-00009330: 7365 6c66 2e5f 6361 6c6c 6261 636b 203d  self._callback =
-00009340: 2063 616c 6c62 6163 6b0a 2020 2020 2020   callback.      
-00009350: 2020 7365 6c66 2e5f 6d6f 6465 5f6d 6173    self._mode_mas
-00009360: 6b20 3d20 6d6f 6465 5f6d 6173 6b20 2023  k = mode_mask  #
-00009370: 2031 3a20 616c 6c2c 2032 3a20 7461 6773   1: all, 2: tags
-00009380: 2c20 343a 2070 7265 7365 7473 2c20 383a  , 4: presets, 8:
-00009390: 2064 6573 6372 6970 7469 6f6e 730a 0a20   descriptions.. 
-000093a0: 2020 2020 2020 2073 656c 662e 636c 6561         self.clea
-000093b0: 7228 290a 2020 2020 2020 2020 7365 6c66  r().        self
-000093c0: 2e5f 7374 6174 6520 3d20 2222 2c20 302c  ._state = "", 0,
-000093d0: 2030 0a0a 2020 2020 2020 2020 2320 5375   0..        # Su
-000093e0: 6767 6573 7465 6420 7461 6773 0a20 2020  ggested tags.   
-000093f0: 2020 2020 2072 6563 656e 745f 6473 2c20       recent_ds, 
-00009400: 7265 6365 6e74 5f74 6167 7320 3d20 7365  recent_tags = se
-00009410: 6c66 2e5f 6765 745f 7375 6767 6573 7465  lf._get_suggeste
-00009420: 645f 7265 6365 6e74 7328 290a 2020 2020  d_recents().    
-00009430: 2020 2020 7365 6c66 2e5f 7375 6767 6573      self._sugges
-00009440: 7465 645f 6473 5f72 6563 656e 7420 3d20  ted_ds_recent = 
-00009450: 7265 6365 6e74 5f64 7320 2023 2064 6573  recent_ds  # des
-00009460: 6372 6970 7469 6f6e 730a 2020 2020 2020  criptions.      
-00009470: 2020 7365 6c66 2e5f 7375 6767 6573 7465    self._suggeste
-00009480: 645f 7461 6773 5f72 6563 656e 7420 3d20  d_tags_recent = 
-00009490: 7265 6365 6e74 5f74 6167 730a 2020 2020  recent_tags.    
-000094a0: 2020 2020 7365 6c66 2e5f 7375 6767 6573      self._sugges
-000094b0: 7465 645f 7461 6773 5f63 6f6d 6269 6e65  ted_tags_combine
-000094c0: 6420 3d20 7365 6c66 2e5f 6765 745f 7375  d = self._get_su
-000094d0: 6767 6573 7465 645f 7461 6773 5f63 6f6d  ggested_tags_com
-000094e0: 6269 6e65 6428 290a 2020 2020 2020 2020  bined().        
-000094f0: 7365 6c66 2e5f 7375 6767 6573 7465 645f  self._suggested_
-00009500: 7461 6773 5f70 7265 7365 7473 203d 205b  tags_presets = [
-00009510: 5d0a 0a20 2020 2020 2020 2023 2043 7572  ]..        # Cur
-00009520: 7265 6e74 2073 7567 6765 7374 696f 6e0a  rent suggestion.
-00009530: 2020 2020 2020 2020 7365 6c66 2e5f 7375          self._su
-00009540: 6767 6573 7465 645f 7461 6773 5f69 6e5f  ggested_tags_in_
-00009550: 6175 746f 636f 6d70 203d 205b 5d0a 0a20  autocomp = [].. 
-00009560: 2020 2020 2020 2077 696e 646f 772e 5f61         window._a
-00009570: 7574 6f63 6f6d 705f 6669 6e69 7368 203d  utocomp_finish =
-00009580: 2073 656c 662e 5f66 696e 6973 685f 6362   self._finish_cb
-00009590: 0a0a 2020 2020 6465 6620 636c 6f73 6528  ..    def close(
-000095a0: 7365 6c66 293a 0a20 2020 2020 2020 2073  self):.        s
-000095b0: 656c 662e 5f64 6976 203d 204e 6f6e 650a  elf._div = None.
-000095c0: 2020 2020 2020 2020 7365 6c66 2e5f 696e          self._in
-000095d0: 7075 7420 3d20 4e6f 6e65 0a20 2020 2020  put = None.     
-000095e0: 2020 2073 656c 662e 5f63 616c 6c62 6163     self._callbac
-000095f0: 6b20 3d20 4e6f 6e65 0a0a 2020 2020 6465  k = None..    de
-00009600: 6620 636c 6561 7228 7365 6c66 293a 0a20  f clear(self):. 
-00009610: 2020 2020 2020 2073 656c 662e 5f69 6e64         self._ind
-00009620: 6578 203d 2030 0a20 2020 2020 2020 2073  ex = 0.        s
-00009630: 656c 662e 5f61 6374 6976 655f 7375 6767  elf._active_sugg
-00009640: 6573 7469 6f6e 203d 2022 220a 2020 2020  estion = "".    
-00009650: 2020 2020 6966 2073 656c 662e 5f64 6976      if self._div
-00009660: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00009670: 6c66 2e5f 6469 762e 6869 6464 656e 203d  lf._div.hidden =
-00009680: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-00009690: 2020 7365 6c66 2e5f 6469 762e 696e 6e65    self._div.inne
-000096a0: 7248 544d 4c20 3d20 2222 0a20 2020 2020  rHTML = "".     
-000096b0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000096c0: 2020 2020 2070 6173 7320 2023 2063 6c65       pass  # cle
-000096d0: 6172 2063 616e 2062 6520 6361 6c6c 6564  ar can be called
-000096e0: 2077 6865 6e20 7468 6520 636f 6d70 6c65   when the comple
-000096f0: 7465 7220 6861 7320 6265 656e 2063 6c6f  ter has been clo
-00009700: 7365 640a 0a20 2020 2064 6566 2069 6e69  sed..    def ini
-00009710: 7428 7365 6c66 293a 0a20 2020 2020 2020  t(self):.       
-00009720: 2022 2222 5368 6f77 2074 6167 2073 7567   """Show tag sug
-00009730: 6765 7374 696f 6e73 2069 6e20 7468 6520  gestions in the 
-00009740: 6175 746f 636f 6d70 6c65 7469 6f6e 2064  autocompletion d
-00009750: 6961 6c6f 672e 2222 220a 0a20 2020 2020  ialog."""..     
-00009760: 2020 2023 2047 6574 2070 6172 7469 616c     # Get partial
-00009770: 2074 6167 2062 6569 6e67 2077 7269 7474   tag being writt
-00009780: 656e 0a20 2020 2020 2020 2073 656c 662e  en.        self.
-00009790: 5f73 7461 7465 203d 2073 656c 662e 5f67  _state = self._g
-000097a0: 6574 5f73 7461 7465 2829 0a20 2020 2020  et_state().     
-000097b0: 2020 2076 616c 2c20 6931 2c20 6932 203d     val, i1, i2 =
-000097c0: 2073 656c 662e 5f73 7461 7465 0a20 2020   self._state.   
-000097d0: 2020 2020 2074 6167 5f74 6f5f 6265 203d       tag_to_be =
-000097e0: 2076 616c 5b69 313a 6932 5d2e 746f 4c6f   val[i1:i2].toLo
-000097f0: 7765 7243 6173 6528 290a 0a20 2020 2020  werCase()..     
-00009800: 2020 2023 2047 6574 2077 6861 7420 746f     # Get what to
-00009810: 2073 686f 770a 2020 2020 2020 2020 7368   show.        sh
-00009820: 6f77 5f64 6573 6372 6970 7469 6f6e 7320  ow_descriptions 
-00009830: 3d20 7368 6f77 5f74 6167 7320 3d20 7368  = show_tags = sh
-00009840: 6f77 5f70 7265 7365 7473 203d 2046 616c  ow_presets = Fal
-00009850: 7365 0a20 2020 2020 2020 2069 6620 7461  se.        if ta
-00009860: 675f 746f 5f62 653a 0a20 2020 2020 2020  g_to_be:.       
-00009870: 2020 2020 2069 6620 6931 203e 2030 2061       if i1 > 0 a
-00009880: 6e64 2076 616c 5b69 3120 2d20 315d 203d  nd val[i1 - 1] =
-00009890: 3d20 2223 2220 616e 6420 2834 2026 2073  = "#" and (4 & s
-000098a0: 656c 662e 5f6d 6f64 655f 6d61 736b 293a  elf._mode_mask):
-000098b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000098c0: 2073 686f 775f 7072 6573 6574 7320 3d20   show_presets = 
-000098d0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-000098e0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000098f0: 2020 2020 2020 2073 686f 775f 7461 6773         show_tags
-00009900: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-00009910: 2020 2020 6e65 6564 6c65 203d 2074 6167      needle = tag
-00009920: 5f74 6f5f 6265 5b31 3a5d 2020 2320 7468  _to_be[1:]  # th
-00009930: 6520 7461 6720 7769 7468 6f75 7420 7468  e tag without th
-00009940: 6520 2723 270a 2020 2020 2020 2020 656c  e '#'.        el
-00009950: 6966 2028 3820 2620 7365 6c66 2e5f 6d6f  if (8 & self._mo
-00009960: 6465 5f6d 6173 6b29 2061 6e64 206c 656e  de_mask) and len
-00009970: 2876 616c 2920 3e3d 2032 2061 6e64 2022  (val) >= 2 and "
-00009980: 2022 206e 6f74 2069 6e20 7661 6c3a 0a20   " not in val:. 
-00009990: 2020 2020 2020 2020 2020 2073 686f 775f             show_
-000099a0: 6465 7363 7269 7074 696f 6e73 203d 2054  descriptions = T
-000099b0: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-000099c0: 6e65 6564 6c65 203d 2076 616c 2e74 6f4c  needle = val.toL
-000099d0: 6f77 6572 4361 7365 2829 0a20 2020 2020  owerCase().     
-000099e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000099f0: 2020 2020 2073 656c 662e 636c 6561 7228       self.clear(
-00009a00: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00009a10: 7475 726e 0a0a 2020 2020 2020 2020 2320  turn..        # 
-00009a20: 5765 2073 686f 7720 7072 6573 6574 7320  We show presets 
-00009a30: 6966 2075 7369 6e67 2064 6f75 626c 6520  if using double 
-00009a40: 6861 7368 7461 6773 0a20 2020 2020 2020  hashtags.       
-00009a50: 2069 6620 7461 675f 746f 5f62 6520 3d3d   if tag_to_be ==
-00009a60: 2022 2322 3a0a 2020 2020 2020 2020 2020   "#":.          
-00009a70: 2020 6966 2073 656c 662e 5f6d 6f64 655f    if self._mode_
-00009a80: 6d61 736b 203d 3d20 313a 0a20 2020 2020  mask == 1:.     
-00009a90: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00009aa0: 6e0a 2020 2020 2020 2020 2020 2020 656c  n.            el
-00009ab0: 6966 2073 686f 775f 7072 6573 6574 733a  if show_presets:
-00009ac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009ad0: 2072 6574 7572 6e20 7365 6c66 2e73 686f   return self.sho
-00009ae0: 775f 7375 6767 6573 7469 6f6e 7328 2270  w_suggestions("p
-00009af0: 7265 7365 7473 2229 0a20 2020 2020 2020  resets").       
-00009b00: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00009b10: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00009b20: 6e20 7365 6c66 2e73 686f 775f 7375 6767  n self.show_sugg
-00009b30: 6573 7469 6f6e 7328 2274 6167 7322 290a  estions("tags").
-00009b40: 0a20 2020 2020 2020 2023 204f 6274 6169  .        # Obtai
-00009b50: 6e20 7375 6767 6573 7469 6f6e 730a 2020  n suggestions.  
-00009b60: 2020 2020 2020 6d61 7463 6865 7331 203d        matches1 =
-00009b70: 205b 5d0a 2020 2020 2020 2020 6d61 7463   [].        matc
-00009b80: 6865 7332 203d 205b 5d0a 2020 2020 2020  hes2 = [].      
-00009b90: 2020 6966 2073 686f 775f 7072 6573 6574    if show_preset
-00009ba0: 733a 0a20 2020 2020 2020 2020 2020 2023  s:.            #
-00009bb0: 2053 7567 6765 7374 696f 6e73 2066 726f   Suggestions fro
-00009bc0: 6d20 7072 6573 6574 730a 2020 2020 2020  m presets.      
-00009bd0: 2020 2020 2020 666f 7220 7072 6573 6574        for preset
-00009be0: 2069 6e20 7365 6c66 2e5f 6765 745f 7375   in self._get_su
-00009bf0: 6767 6573 7465 645f 7461 6773 5f70 7265  ggested_tags_pre
-00009c00: 7365 7473 2829 3a0a 2020 2020 2020 2020  sets():.        
-00009c10: 2020 2020 2020 2020 6874 6d6c 203d 2070          html = p
-00009c20: 7265 7365 7420 2b20 223c 7370 616e 2063  reset + "<span c
-00009c30: 6c61 7373 3d27 6d65 7461 273e 7072 6573  lass='meta'>pres
-00009c40: 6574 3c73 7061 6e3e 220a 2020 2020 2020  et<span>".      
-00009c50: 2020 2020 2020 2020 2020 6920 3d20 7072            i = pr
-00009c60: 6573 6574 2e69 6e64 6578 4f66 286e 6565  eset.indexOf(nee
-00009c70: 646c 6529 0a20 2020 2020 2020 2020 2020  dle).           
-00009c80: 2020 2020 2069 6620 6920 3e20 303a 0a20       if i > 0:. 
-00009c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ca0: 2020 2069 6620 7072 6573 6574 5b69 202d     if preset[i -
-00009cb0: 2031 5d20 3d3d 2022 2322 3a0a 2020 2020   1] == "#":.    
-00009cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009cd0: 2020 2020 2320 4120 7461 6720 696e 2074      # A tag in t
-00009ce0: 6865 2070 7265 7365 7420 7374 6172 7473  he preset starts
-00009cf0: 7769 7468 2074 6865 206e 6565 646c 650a  with the needle.
-00009d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009d10: 2020 2020 2020 2020 6874 6d6c 203d 2028          html = (
-00009d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009d30: 2020 2020 2020 2020 2020 2020 2070 7265               pre
-00009d40: 7365 745b 3a20 6920 2d20 315d 0a20 2020  set[: i - 1].   
-00009d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009d60: 2020 2020 2020 2020 202b 2022 3c62 3e22           + "<b>"
-00009d70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009d80: 2020 2020 2020 2020 2020 2020 202b 2074               + t
-00009d90: 6167 5f74 6f5f 6265 0a20 2020 2020 2020  ag_to_be.       
-00009da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009db0: 2020 2020 202b 2022 3c2f 623e 220a 2020       + "</b>".  
-00009dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009dd0: 2020 2020 2020 2020 2020 2b20 7072 6573            + pres
-00009de0: 6574 5b69 202b 206e 6565 646c 652e 6c65  et[i + needle.le
-00009df0: 6e67 7468 203a 5d0a 2020 2020 2020 2020  ngth :].        
-00009e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009e10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00009e20: 2020 2020 2020 2020 2020 6874 6d6c 202b            html +
-00009e30: 3d20 223c 7370 616e 2063 6c61 7373 3d27  = "<span class='
-00009e40: 6d65 7461 273e 7072 6573 6574 3c73 7061  meta'>preset<spa
-00009e50: 6e3e 220a 2020 2020 2020 2020 2020 2020  n>".            
-00009e60: 2020 2020 2020 2020 2020 2020 6d61 7463              matc
-00009e70: 6865 7331 2e70 7573 6828 2870 7265 7365  hes1.push((prese
-00009e80: 742c 2068 746d 6c29 290a 2020 2020 2020  t, html)).      
-00009e90: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00009ea0: 6966 206e 6565 646c 652e 6c65 6e67 7468  if needle.length
-00009eb0: 203e 3d20 323a 0a20 2020 2020 2020 2020   >= 2:.         
-00009ec0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00009ed0: 2054 6865 2070 7265 7365 7420 636f 6e74   The preset cont
-00009ee0: 6169 6e73 2074 6865 206e 6565 646c 652c  ains the needle,
-00009ef0: 2061 6e64 2074 6865 206e 6565 646c 6520   and the needle 
-00009f00: 6973 206d 6f72 6520 7468 616e 2031 2063  is more than 1 c
-00009f10: 6861 720a 2020 2020 2020 2020 2020 2020  har.            
-00009f20: 2020 2020 2020 2020 2020 2020 6874 6d6c              html
-00009f30: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-00009f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009f50: 2070 7265 7365 745b 3a69 5d0a 2020 2020   preset[:i].    
-00009f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009f70: 2020 2020 2020 2020 2b20 223c 623e 220a          + "<b>".
-00009f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009f90: 2020 2020 2020 2020 2020 2020 2b20 6e65              + ne
-00009fa0: 6564 6c65 0a20 2020 2020 2020 2020 2020  edle.           
-00009fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009fc0: 202b 2022 3c2f 623e 220a 2020 2020 2020   + "</b>".      
-00009fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009fe0: 2020 2020 2020 2b20 7072 6573 6574 5b69        + preset[i
-00009ff0: 202b 206e 6565 646c 652e 6c65 6e67 7468   + needle.length
-0000a000: 203a 5d0a 2020 2020 2020 2020 2020 2020   :].            
-0000a010: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0000a020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a030: 2020 2020 2020 6874 6d6c 202b 3d20 223c        html += "<
-0000a040: 7370 616e 2063 6c61 7373 3d27 6d65 7461  span class='meta
-0000a050: 273e 7072 6573 6574 3c73 7061 6e3e 220a  '>preset<span>".
-0000a060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a070: 2020 2020 2020 2020 6d61 7463 6865 7332          matches2
-0000a080: 2e70 7573 6828 2870 7265 7365 742c 2068  .push((preset, h
-0000a090: 746d 6c29 290a 2020 2020 2020 2020 6966  tml)).        if
-0000a0a0: 2073 686f 775f 7461 6773 3a0a 2020 2020   show_tags:.    
-0000a0b0: 2020 2020 2020 2020 2320 5375 6767 6573          # Sugges
-0000a0c0: 7469 6f6e 7320 6672 6f6d 2072 6563 656e  tions from recen
-0000a0d0: 7420 7461 6773 0a20 2020 2020 2020 2020  t tags.         
-0000a0e0: 2020 2066 6f72 2074 6167 2c20 7461 675f     for tag, tag_
-0000a0f0: 7432 2069 6e20 7365 6c66 2e5f 7375 6767  t2 in self._sugg
-0000a100: 6573 7465 645f 7461 6773 5f63 6f6d 6269  ested_tags_combi
-0000a110: 6e65 643a 0a20 2020 2020 2020 2020 2020  ned:.           
-0000a120: 2020 2020 2069 203d 2074 6167 2e69 6e64       i = tag.ind
-0000a130: 6578 4f66 286e 6565 646c 6529 0a20 2020  exOf(needle).   
-0000a140: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000a150: 6920 3e20 303a 0a20 2020 2020 2020 2020  i > 0:.         
-0000a160: 2020 2020 2020 2020 2020 2064 6174 6520             date 
-0000a170: 3d20 6461 7973 5f61 676f 2874 6167 5f74  = days_ago(tag_t
-0000a180: 3229 0a20 2020 2020 2020 2020 2020 2020  2).             
-0000a190: 2020 2020 2020 2064 6174 6520 3d20 7b30         date = {0
-0000a1a0: 3a20 2274 6f64 6179 222c 2031 3a20 2279  : "today", 1: "y
-0000a1b0: 6573 7465 7264 6179 227d 2e67 6574 2864  esterday"}.get(d
-0000a1c0: 6174 652c 2064 6174 6520 2b20 2220 6461  ate, date + " da
-0000a1d0: 7973 2061 676f 2229 0a20 2020 2020 2020  ys ago").       
-0000a1e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000a1f0: 6920 3d3d 2031 3a0a 2020 2020 2020 2020  i == 1:.        
-0000a200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a210: 2320 5468 6520 7461 6720 7374 6172 7473  # The tag starts
-0000a220: 7769 7468 2074 6865 206e 6565 646c 650a  with the needle.
-0000a230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a240: 2020 2020 2020 2020 6874 6d6c 203d 2022          html = "
-0000a250: 3c62 3e22 202b 2074 6167 5f74 6f5f 6265  <b>" + tag_to_be
-0000a260: 202b 2022 3c2f 623e 2220 2b20 7461 675b   + "</b>" + tag[
-0000a270: 7461 675f 746f 5f62 652e 6c65 6e67 7468  tag_to_be.length
-0000a280: 203a 5d0a 2020 2020 2020 2020 2020 2020   :].            
-0000a290: 2020 2020 2020 2020 2020 2020 6874 6d6c              html
-0000a2a0: 202b 3d20 223c 7370 616e 2063 6c61 7373   += "<span class
-0000a2b0: 3d27 6d65 7461 273e 6c61 7374 2075 7365  ='meta'>last use
-0000a2c0: 6420 2220 2b20 6461 7465 202b 2022 3c73  d " + date + "<s
-0000a2d0: 7061 6e3e 220a 2020 2020 2020 2020 2020  pan>".          
-0000a2e0: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-0000a2f0: 7463 6865 7331 2e70 7573 6828 2874 6167  tches1.push((tag
-0000a300: 2c20 6874 6d6c 2929 0a20 2020 2020 2020  , html)).       
-0000a310: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-0000a320: 6620 6e65 6564 6c65 2e6c 656e 6774 6820  f needle.length 
-0000a330: 3e3d 2032 3a0a 2020 2020 2020 2020 2020  >= 2:.          
-0000a340: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000a350: 5468 6520 7461 6720 636f 6e74 6169 6e73  The tag contains
-0000a360: 2074 6865 206e 6565 646c 652c 2061 6e64   the needle, and
-0000a370: 2074 6865 206e 6565 646c 6520 6973 206d   the needle is m
-0000a380: 6f72 6520 7468 616e 2031 2063 6861 720a  ore than 1 char.
+00004390: 3c61 3e74 6f64 6179 3c2f 613e 0a20 2020  <a>today</a>.   
+000043a0: 2020 2020 2020 2020 2020 2020 203c 613e               <a>
+000043b0: 7468 6973 2077 6565 6b3c 2f61 3e0a 2020  this week</a>.  
+000043c0: 2020 2020 2020 2020 2020 2020 2020 3c61                <a
+000043d0: 3e74 6869 7320 6d6f 6e74 683c 2f61 3e0a  >this month</a>.
+000043e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000043f0: 3c61 3e74 6869 7320 7175 6172 7465 723c  <a>this quarter<
+00004400: 2f61 3e0a 2020 2020 2020 2020 2020 2020  /a>.            
+00004410: 2020 2020 3c61 3e74 6869 7320 7965 6172      <a>this year
+00004420: 3c2f 613e 0a20 2020 2020 2020 2020 2020  </a>.           
+00004430: 2020 2020 203c 613e 7965 7374 6572 3c77       <a>yester<w
+00004440: 6272 3e64 6179 3c2f 613e 0a20 2020 2020  br>day</a>.     
+00004450: 2020 2020 2020 2020 2020 203c 613e 6c61             <a>la
+00004460: 7374 2077 6565 6b3c 2f61 3e0a 2020 2020  st week</a>.    
+00004470: 2020 2020 2020 2020 2020 2020 3c61 3e6c              <a>l
+00004480: 6173 7420 6d6f 6e74 683c 2f61 3e0a 2020  ast month</a>.  
+00004490: 2020 2020 2020 2020 2020 2020 2020 3c61                <a
+000044a0: 3e6c 6173 7420 7175 6172 7465 723c 2f61  >last quarter</a
+000044b0: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
+000044c0: 2020 3c61 3e6c 6173 7420 7965 6172 3c2f    <a>last year</
+000044d0: 613e 0a20 2020 2020 2020 2020 2020 203c  a>.            <
+000044e0: 2f64 6976 3e0a 2020 2020 2020 2020 2020  /div>.          
+000044f0: 2020 3c64 6976 2073 7479 6c65 3d27 6d69    <div style='mi
+00004500: 6e2d 6865 6967 6874 3a20 3130 7078 3b27  n-height: 10px;'
+00004510: 3e3c 2f64 6976 3e0a 2020 2020 2020 2020  ></div>.        
+00004520: 2020 2020 3c64 6976 2063 6c61 7373 3d27      <div class='
+00004530: 6d65 6e75 273e 0a20 2020 2020 2020 2020  menu'>.         
+00004540: 2020 2020 2020 203c 6469 7620 7374 796c         <div styl
+00004550: 653d 2766 6c65 783a 2030 2e35 2030 2e35  e='flex: 0.5 0.5
+00004560: 2061 7574 6f3b 2074 6578 742d 616c 6967   auto; text-alig
+00004570: 6e3a 2072 6967 6874 3b27 3e46 726f 6d3a  n: right;'>From:
+00004580: 266e 6273 703b 266e 6273 703b 3c2f 6469  &nbsp;&nbsp;</di
+00004590: 763e 0a20 2020 2020 2020 2020 2020 2020  v>.             
+000045a0: 2020 203c 696e 7075 7420 7479 7065 3d22     <input type="
+000045b0: 6461 7465 2220 7374 6570 3d22 3122 202f  date" step="1" /
+000045c0: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
+000045d0: 2020 3c64 6976 2073 7479 6c65 3d27 666c    <div style='fl
+000045e0: 6578 3a20 302e 3520 302e 3520 6175 746f  ex: 0.5 0.5 auto
+000045f0: 3b20 7465 7874 2d61 6c69 676e 3a20 7269  ; text-align: ri
+00004600: 6768 743b 273e 546f 3a26 6e62 7370 3b26  ght;'>To:&nbsp;&
+00004610: 6e62 7370 3b3c 2f64 6976 3e0a 2020 2020  nbsp;</div>.    
+00004620: 2020 2020 2020 2020 2020 2020 3c69 6e70              <inp
+00004630: 7574 2074 7970 653d 2264 6174 6522 2073  ut type="date" s
+00004640: 7465 703d 2231 2220 2f3e 0a20 2020 2020  tep="1" />.     
+00004650: 2020 2020 2020 2020 2020 203c 6469 7620             <div 
+00004660: 7374 796c 653d 2766 6c65 783a 2030 2e35  style='flex: 0.5
+00004670: 2030 2e35 2061 7574 6f3b 273e 3c2f 6469   0.5 auto;'></di
+00004680: 763e 0a20 2020 2020 2020 2020 2020 203c  v>.            <
+00004690: 2f64 6976 3e0a 2020 2020 2020 2020 2020  /div>.          
+000046a0: 2020 3c64 6976 2073 7479 6c65 3d27 6d61    <div style='ma
+000046b0: 7267 696e 2d74 6f70 3a31 656d 3b27 3e3c  rgin-top:1em;'><
+000046c0: 2f64 6976 3e0a 2020 2020 2020 2020 2020  /div>.          
+000046d0: 2020 3c64 6976 2073 7479 6c65 3d27 6469    <div style='di
+000046e0: 7370 6c61 793a 2066 6c65 783b 6a75 7374  splay: flex;just
+000046f0: 6966 792d 636f 6e74 656e 743a 2066 6c65  ify-content: fle
+00004700: 782d 656e 643b 273e 0a20 2020 2020 2020  x-end;'>.       
+00004710: 2020 2020 2020 2020 203c 6275 7474 6f6e           <button
+00004720: 2074 7970 653d 2762 7574 746f 6e27 3e44   type='button'>D
+00004730: 6f6e 653c 2f62 7574 746f 6e3e 0a20 2020  one</button>.   
+00004740: 2020 2020 2020 2020 203c 2f64 6976 3e0a           </div>.
+00004750: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+00004760: 2020 2020 2073 656c 662e 6d61 696e 6469       self.maindi
+00004770: 762e 696e 6e65 7248 544d 4c20 3d20 6874  v.innerHTML = ht
+00004780: 6d6c 0a20 2020 2020 2020 2070 7265 7365  ml.        prese
+00004790: 7473 203d 2073 656c 662e 6d61 696e 6469  ts = self.maindi
+000047a0: 762e 6368 696c 6472 656e 5b32 5d0a 2020  v.children[2].  
+000047b0: 2020 2020 2020 666f 726d 203d 2073 656c        form = sel
+000047c0: 662e 6d61 696e 6469 762e 6368 696c 6472  f.maindiv.childr
+000047d0: 656e 5b34 5d0a 0a20 2020 2020 2020 2073  en[4]..        s
+000047e0: 656c 662e 5f74 315f 696e 7075 7420 3d20  elf._t1_input = 
+000047f0: 666f 726d 2e63 6869 6c64 7265 6e5b 315d  form.children[1]
+00004800: 0a20 2020 2020 2020 2073 656c 662e 5f74  .        self._t
+00004810: 325f 696e 7075 7420 3d20 666f 726d 2e63  2_input = form.c
+00004820: 6869 6c64 7265 6e5b 335d 0a0a 2020 2020  hildren[3]..    
+00004830: 2020 2020 2320 7175 6963 6b6e 6176 203d      # quicknav =
+00004840: 2073 656c 662e 6d61 696e 6469 762e 6368   self.maindiv.ch
+00004850: 696c 6472 656e 5b30 5d0a 2020 2020 2020  ildren[0].      
+00004860: 2020 2320 7175 6963 6b6e 6176 2e63 6869    # quicknav.chi
+00004870: 6c64 7265 6e5b 315d 2e6f 6e63 6c69 636b  ldren[1].onclick
+00004880: 203d 206c 616d 6264 6120 653a 2073 656c   = lambda e: sel
+00004890: 662e 5f61 7070 6c79 5f71 7569 636b 6e61  f._apply_quickna
+000048a0: 7628 226f 7574 2229 0a20 2020 2020 2020  v("out").       
+000048b0: 2023 2071 7569 636b 6e61 762e 6368 696c   # quicknav.chil
+000048c0: 6472 656e 5b32 5d2e 6f6e 636c 6963 6b20  dren[2].onclick 
+000048d0: 3d20 6c61 6d62 6461 2065 3a20 7365 6c66  = lambda e: self
+000048e0: 2e5f 6170 706c 795f 7175 6963 6b6e 6176  ._apply_quicknav
+000048f0: 2822 696e 2229 0a0a 2020 2020 2020 2020  ("in")..        
+00004900: 6966 2075 7469 6c73 2e6c 6f6f 6b73 5f6c  if utils.looks_l
+00004910: 696b 655f 6465 736b 746f 7028 293a 0a20  ike_desktop():. 
+00004920: 2020 2020 2020 2020 2020 2070 7265 7365             prese
+00004930: 7473 2e63 6869 6c64 7265 6e5b 305d 2e69  ts.children[0].i
+00004940: 6e6e 6572 4854 4d4c 202b 3d20 2220 3c73  nnerHTML += " <s
+00004950: 7061 6e20 636c 6173 733d 276b 6579 6869  pan class='keyhi
+00004960: 6e74 273e 643c 2f73 7061 6e3e 220a 2020  nt'>d</span>".  
+00004970: 2020 2020 2020 2020 2020 7072 6573 6574            preset
+00004980: 732e 6368 696c 6472 656e 5b31 5d2e 696e  s.children[1].in
+00004990: 6e65 7248 544d 4c20 2b3d 2022 203c 7370  nerHTML += " <sp
+000049a0: 616e 2063 6c61 7373 3d27 6b65 7968 696e  an class='keyhin
+000049b0: 7427 3e77 3c2f 7370 616e 3e22 0a20 2020  t'>w</span>".   
+000049c0: 2020 2020 2020 2020 2070 7265 7365 7473           presets
+000049d0: 2e63 6869 6c64 7265 6e5b 325d 2e69 6e6e  .children[2].inn
+000049e0: 6572 4854 4d4c 202b 3d20 2220 3c73 7061  erHTML += " <spa
+000049f0: 6e20 636c 6173 733d 276b 6579 6869 6e74  n class='keyhint
+00004a00: 273e 6d3c 2f73 7061 6e3e 220a 2020 2020  '>m</span>".    
+00004a10: 2020 2020 2020 2020 7072 6573 6574 732e          presets.
+00004a20: 6368 696c 6472 656e 5b33 5d2e 696e 6e65  children[3].inne
+00004a30: 7248 544d 4c20 2b3d 2022 203c 7370 616e  rHTML += " <span
+00004a40: 2063 6c61 7373 3d27 6b65 7968 696e 7427   class='keyhint'
+00004a50: 3e71 3c2f 7370 616e 3e22 0a20 2020 2020  >q</span>".     
+00004a60: 2020 2020 2020 2070 7265 7365 7473 2e63         presets.c
+00004a70: 6869 6c64 7265 6e5b 345d 2e69 6e6e 6572  hildren[4].inner
+00004a80: 4854 4d4c 202b 3d20 2220 3c73 7061 6e20  HTML += " <span 
+00004a90: 636c 6173 733d 276b 6579 6869 6e74 273e  class='keyhint'>
+00004aa0: 793c 2f73 7061 6e3e 220a 0a20 2020 2020  y</span>"..     
+00004ab0: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+00004ac0: 6528 7072 6573 6574 732e 6368 696c 6472  e(presets.childr
+00004ad0: 656e 2e6c 656e 6774 6829 3a0a 2020 2020  en.length):.    
+00004ae0: 2020 2020 2020 2020 6275 7420 3d20 7072          but = pr
+00004af0: 6573 6574 732e 6368 696c 6472 656e 5b69  esets.children[i
+00004b00: 5d0a 2020 2020 2020 2020 2020 2020 6275  ].            bu
+00004b10: 742e 6f6e 636c 6963 6b20 3d20 6c61 6d62  t.onclick = lamb
+00004b20: 6461 2065 3a20 7365 6c66 2e5f 6170 706c  da e: self._appl
+00004b30: 795f 7072 6573 6574 2865 2e74 6172 6765  y_preset(e.targe
+00004b40: 742e 696e 6e65 7254 6578 7429 0a0a 2020  t.innerText)..  
+00004b50: 2020 2020 2020 7365 6c66 2e5f 7431 5f69        self._t1_i
+00004b60: 6e70 7574 2e76 616c 7565 203d 2074 315f  nput.value = t1_
+00004b70: 6461 7465 0a20 2020 2020 2020 2073 656c  date.        sel
+00004b80: 662e 5f74 315f 696e 7075 742e 6f6e 706f  f._t1_input.onpo
+00004b90: 696e 7465 7264 6f77 6e20 3d20 7365 6c66  interdown = self
+00004ba0: 2e5f 7072 6576 656e 745f 626c 7572 0a20  ._prevent_blur. 
+00004bb0: 2020 2020 2020 2073 656c 662e 5f74 315f         self._t1_
+00004bc0: 696e 7075 742e 6f6e 696e 7075 7420 3d20  input.oninput = 
+00004bd0: 7365 6c66 2e5f 7570 6461 7465 5f72 616e  self._update_ran
+00004be0: 6765 0a20 2020 2020 2020 2073 656c 662e  ge.        self.
+00004bf0: 5f74 325f 696e 7075 742e 7661 6c75 6520  _t2_input.value 
+00004c00: 3d20 7432 5f64 6174 650a 2020 2020 2020  = t2_date.      
+00004c10: 2020 7365 6c66 2e5f 7432 5f69 6e70 7574    self._t2_input
+00004c20: 2e6f 6e70 6f69 6e74 6572 646f 776e 203d  .onpointerdown =
+00004c30: 2073 656c 662e 5f70 7265 7665 6e74 5f62   self._prevent_b
+00004c40: 6c75 720a 2020 2020 2020 2020 7365 6c66  lur.        self
+00004c50: 2e5f 7432 5f69 6e70 7574 2e6f 6e69 6e70  ._t2_input.oninp
+00004c60: 7574 203d 2073 656c 662e 5f75 7064 6174  ut = self._updat
+00004c70: 655f 7261 6e67 650a 0a20 2020 2020 2020  e_range..       
+00004c80: 2063 6c6f 7365 5f62 7574 203d 2073 656c   close_but = sel
+00004c90: 662e 6d61 696e 6469 762e 6368 696c 6472  f.maindiv.childr
+00004ca0: 656e 5b36 5d2e 6368 696c 6472 656e 5b30  en[6].children[0
+00004cb0: 5d0a 2020 2020 2020 2020 636c 6f73 655f  ].        close_
+00004cc0: 6275 742e 6f6e 636c 6963 6b20 3d20 7365  but.onclick = se
+00004cd0: 6c66 2e63 6c6f 7365 0a0a 2020 2020 2020  lf.close..      
+00004ce0: 2020 7365 6c66 2e6d 6169 6e64 6976 2e63    self.maindiv.c
+00004cf0: 6c61 7373 4c69 7374 2e61 6464 2822 7665  lassList.add("ve
+00004d00: 7274 6963 616c 6d65 6e75 2229 0a20 2020  rticalmenu").   
+00004d10: 2020 2020 2073 7570 6572 2829 2e6f 7065       super().ope
+00004d20: 6e28 6361 6c6c 6261 636b 290a 0a20 2020  n(callback)..   
+00004d30: 2064 6566 205f 6170 706c 795f 7175 6963   def _apply_quic
+00004d40: 6b6e 6176 2873 656c 662c 2074 6578 7429  knav(self, text)
+00004d50: 3a0a 2020 2020 2020 2020 7363 616c 6573  :.        scales
+00004d60: 7465 7020 3d20 2b31 2069 6620 226f 7574  tep = +1 if "out
+00004d70: 2220 696e 2074 6578 742e 6c6f 7765 7228  " in text.lower(
+00004d80: 2920 656c 7365 202d 310a 2020 2020 2020  ) else -1.      
+00004d90: 2020 7431 2c20 7432 203d 2073 656c 662e    t1, t2 = self.
+00004da0: 5f63 616e 7661 732e 7261 6e67 652e 6765  _canvas.range.ge
+00004db0: 745f 736e 6170 5f72 616e 6765 2873 6361  t_snap_range(sca
+00004dc0: 6c65 7374 6570 290a 0a20 2020 2020 2020  lestep)..       
+00004dd0: 2073 656c 662e 5f74 315f 696e 7075 742e   self._t1_input.
+00004de0: 7661 6c75 6520 3d20 6474 2e74 696d 6532  value = dt.time2
+00004df0: 6c6f 6361 6c73 7472 2874 3129 2e73 706c  localstr(t1).spl
+00004e00: 6974 2822 2022 295b 305d 0a20 2020 2020  it(" ")[0].     
+00004e10: 2020 2073 656c 662e 5f74 325f 696e 7075     self._t2_inpu
+00004e20: 742e 7661 6c75 6520 3d20 6474 2e74 696d  t.value = dt.tim
+00004e30: 6532 6c6f 6361 6c73 7472 2874 3229 2e73  e2localstr(t2).s
+00004e40: 706c 6974 2822 2022 295b 305d 0a0a 2020  plit(" ")[0]..  
+00004e50: 2020 2020 2020 7365 6c66 2e5f 6361 6e76        self._canv
+00004e60: 6173 2e72 616e 6765 2e61 6e69 6d61 7465  as.range.animate
+00004e70: 5f72 616e 6765 2874 312c 2074 3229 0a0a  _range(t1, t2)..
+00004e80: 2020 2020 6465 6620 5f61 7070 6c79 5f70      def _apply_p
+00004e90: 7265 7365 7428 7365 6c66 2c20 7465 7874  reset(self, text
+00004ea0: 293a 0a20 2020 2020 2020 2074 6578 7420  ):.        text 
+00004eb0: 3d20 7465 7874 2e6c 6f77 6572 2829 0a20  = text.lower(). 
+00004ec0: 2020 2020 2020 206c 6173 7420 3d20 7465         last = te
+00004ed0: 7874 2e63 6f75 6e74 2822 6c61 7374 2229  xt.count("last")
+00004ee0: 0a20 2020 2020 2020 2069 6620 7465 7874  .        if text
+00004ef0: 2e63 6f75 6e74 2822 746f 6461 7922 293a  .count("today"):
+00004f00: 0a20 2020 2020 2020 2020 2020 2072 6f75  .            rou
+00004f10: 6e64 6572 203d 2022 3144 220a 2020 2020  nder = "1D".    
+00004f20: 2020 2020 656c 6966 2074 6578 742e 636f      elif text.co
+00004f30: 756e 7428 2279 6573 7465 7264 6179 2229  unt("yesterday")
+00004f40: 3a0a 2020 2020 2020 2020 2020 2020 726f  :.            ro
+00004f50: 756e 6465 7220 3d20 2231 4422 0a20 2020  under = "1D".   
+00004f60: 2020 2020 2020 2020 206c 6173 7420 3d20           last = 
+00004f70: 5472 7565 0a20 2020 2020 2020 2065 6c69  True.        eli
+00004f80: 6620 7465 7874 2e63 6f75 6e74 2822 7765  f text.count("we
+00004f90: 656b 2229 3a0a 2020 2020 2020 2020 2020  ek"):.          
+00004fa0: 2020 726f 756e 6465 7220 3d20 2231 5722    rounder = "1W"
+00004fb0: 0a20 2020 2020 2020 2065 6c69 6620 7465  .        elif te
+00004fc0: 7874 2e63 6f75 6e74 2822 6d6f 6e74 6822  xt.count("month"
+00004fd0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00004fe0: 6f75 6e64 6572 203d 2022 314d 220a 2020  ounder = "1M".  
+00004ff0: 2020 2020 2020 656c 6966 2074 6578 742e        elif text.
+00005000: 636f 756e 7428 2271 7561 7274 6572 2229  count("quarter")
+00005010: 3a0a 2020 2020 2020 2020 2020 2020 726f  :.            ro
+00005020: 756e 6465 7220 3d20 2233 4d22 0a20 2020  under = "3M".   
+00005030: 2020 2020 2065 6c69 6620 7465 7874 2e63       elif text.c
+00005040: 6f75 6e74 2822 7965 6172 2229 3a0a 2020  ount("year"):.  
+00005050: 2020 2020 2020 2020 2020 726f 756e 6465            rounde
+00005060: 7220 3d20 2231 5922 0a20 2020 2020 2020  r = "1Y".       
+00005070: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00005080: 2020 2072 6574 7572 6e0a 0a20 2020 2020     return..     
+00005090: 2020 2074 3120 3d20 6474 2e66 6c6f 6f72     t1 = dt.floor
+000050a0: 2864 742e 6e6f 7728 292c 2072 6f75 6e64  (dt.now(), round
+000050b0: 6572 290a 2020 2020 2020 2020 6966 206c  er).        if l
+000050c0: 6173 743a 0a20 2020 2020 2020 2020 2020  ast:.           
+000050d0: 2074 3120 3d20 6474 2e61 6464 2874 312c   t1 = dt.add(t1,
+000050e0: 2022 2d22 202b 2072 6f75 6e64 6572 290a   "-" + rounder).
+000050f0: 2020 2020 2020 2020 7432 203d 2064 742e          t2 = dt.
+00005100: 6164 6428 7431 2c20 726f 756e 6465 7229  add(t1, rounder)
+00005110: 0a20 2020 2020 2020 2074 3220 3d20 6474  .        t2 = dt
+00005120: 2e61 6464 2874 322c 2022 2d31 4422 2920  .add(t2, "-1D") 
+00005130: 2023 2072 616e 6765 2069 7320 696e 636c   # range is incl
+00005140: 7573 6976 650a 0a20 2020 2020 2020 2073  usive..        s
+00005150: 656c 662e 5f74 315f 696e 7075 742e 7661  elf._t1_input.va
+00005160: 6c75 6520 3d20 6474 2e74 696d 6532 6c6f  lue = dt.time2lo
+00005170: 6361 6c73 7472 2874 3129 2e73 706c 6974  calstr(t1).split
+00005180: 2822 2022 295b 305d 0a20 2020 2020 2020  (" ")[0].       
+00005190: 2073 656c 662e 5f74 325f 696e 7075 742e   self._t2_input.
+000051a0: 7661 6c75 6520 3d20 6474 2e74 696d 6532  value = dt.time2
+000051b0: 6c6f 6361 6c73 7472 2874 3229 2e73 706c  localstr(t2).spl
+000051c0: 6974 2822 2022 295b 305d 0a20 2020 2020  it(" ")[0].     
+000051d0: 2020 2073 656c 662e 5f75 7064 6174 655f     self._update_
+000051e0: 7261 6e67 6528 290a 2020 2020 2020 2020  range().        
+000051f0: 7365 6c66 2e63 6c6f 7365 2829 0a0a 2020  self.close()..  
+00005200: 2020 6465 6620 5f75 7064 6174 655f 7261    def _update_ra
+00005210: 6e67 6528 7365 6c66 293a 0a20 2020 2020  nge(self):.     
+00005220: 2020 2074 315f 6461 7465 203d 2073 656c     t1_date = sel
+00005230: 662e 5f74 315f 696e 7075 742e 7661 6c75  f._t1_input.valu
+00005240: 650a 2020 2020 2020 2020 7432 5f64 6174  e.        t2_dat
+00005250: 6520 3d20 7365 6c66 2e5f 7432 5f69 6e70  e = self._t2_inp
+00005260: 7574 2e76 616c 7565 0a20 2020 2020 2020  ut.value.       
+00005270: 2069 6620 6e6f 7420 666c 6f61 7428 7431   if not float(t1
+00005280: 5f64 6174 652e 7370 6c69 7428 222d 2229  _date.split("-")
+00005290: 5b30 5d29 203e 2031 3839 393a 0a20 2020  [0]) > 1899:.   
+000052a0: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+000052b0: 2020 2020 2020 2020 656c 6966 206e 6f74          elif not
+000052c0: 2066 6c6f 6174 2874 325f 6461 7465 2e73   float(t2_date.s
+000052d0: 706c 6974 2822 2d22 295b 305d 2920 3e20  plit("-")[0]) > 
+000052e0: 3138 3939 3a0a 2020 2020 2020 2020 2020  1899:.          
+000052f0: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
+00005300: 2020 7431 203d 2073 7472 5f64 6174 655f    t1 = str_date_
+00005310: 746f 5f74 696d 655f 696e 7428 7431 5f64  to_time_int(t1_d
+00005320: 6174 6529 0a20 2020 2020 2020 2074 3220  ate).        t2 
+00005330: 3d20 7374 725f 6461 7465 5f74 6f5f 7469  = str_date_to_ti
+00005340: 6d65 5f69 6e74 2874 325f 6461 7465 290a  me_int(t2_date).
+00005350: 2020 2020 2020 2020 6966 2074 3120 3e20          if t1 > 
+00005360: 7432 3a0a 2020 2020 2020 2020 2020 2020  t2:.            
+00005370: 7431 2c20 7432 203d 2074 322c 2074 310a  t1, t2 = t2, t1.
+00005380: 2020 2020 2020 2020 7432 203d 2064 742e          t2 = dt.
+00005390: 6164 6428 7432 2c20 2231 4422 2920 2023  add(t2, "1D")  #
+000053a0: 206c 6f6f 6b20 756e 7469 6c20 7468 6520   look until the 
+000053b0: 656e 6420 6f66 2074 6865 2064 6179 0a0a  end of the day..
+000053c0: 2020 2020 2020 2020 7769 6e64 6f77 2e63          window.c
+000053d0: 616e 7661 732e 7261 6e67 652e 616e 696d  anvas.range.anim
+000053e0: 6174 655f 7261 6e67 6528 7431 2c20 7432  ate_range(t1, t2
+000053f0: 2c20 4e6f 6e65 2c20 4661 6c73 6529 2020  , None, False)  
+00005400: 2320 7769 7468 6f75 7420 736e 6170 0a0a  # without snap..
+00005410: 0a63 6c61 7373 2053 7461 7274 5374 6f70  .class StartStop
+00005420: 4564 6974 3a0a 2020 2020 2222 2248 656c  Edit:.    """Hel
+00005430: 7065 7220 636c 6173 7320 746f 2061 6c6c  per class to all
+00005440: 6f77 2074 6865 2075 7365 7220 746f 2073  ow the user to s
+00005450: 6574 2074 6865 2073 7461 7274 2061 6e64  et the start and
+00005460: 2073 746f 7020 7469 6d65 206f 6620 6120   stop time of a 
+00005470: 7265 636f 7264 2e22 2222 0a0a 2020 2020  record."""..    
+00005480: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+00005490: 662c 206e 6f64 652c 2063 616c 6c62 6163  f, node, callbac
+000054a0: 6b2c 2074 312c 2074 322c 206d 6f64 6529  k, t1, t2, mode)
+000054b0: 3a0a 2020 2020 2020 2020 7365 6c66 2e6e  :.        self.n
+000054c0: 6f64 6520 3d20 6e6f 6465 0a20 2020 2020  ode = node.     
+000054d0: 2020 2073 656c 662e 6361 6c6c 6261 636b     self.callback
+000054e0: 203d 2063 616c 6c62 6163 6b0a 2020 2020   = callback.    
+000054f0: 2020 2020 7365 6c66 2e69 6e69 7469 616c      self.initial
+00005500: 6d6f 6465 203d 206d 6f64 652e 6c6f 7765  mode = mode.lowe
+00005510: 7228 290a 2020 2020 2020 2020 7365 6c66  r().        self
+00005520: 2e69 6e69 7469 616c 5f74 312c 2073 656c  .initial_t1, sel
+00005530: 662e 696e 6974 6961 6c5f 7432 203d 2074  f.initial_t2 = t
+00005540: 312c 2074 3220 2023 2065 7665 6e20 6d6f  1, t2  # even mo
+00005550: 7265 206f 7269 6769 6e61 6c20 7468 616e  re original than
+00005560: 206f 7269 5f74 3120 3a29 0a0a 2020 2020   ori_t1 :)..    
+00005570: 2020 2020 6966 2073 656c 662e 696e 6974      if self.init
+00005580: 6961 6c6d 6f64 6520 696e 2028 2273 7461  ialmode in ("sta
+00005590: 7274 222c 2022 6e65 7722 293a 0a20 2020  rt", "new"):.   
+000055a0: 2020 2020 2020 2020 2074 6578 745f 7374           text_st
+000055b0: 6172 746e 6f77 203d 2022 5374 6172 7420  artnow = "Start 
+000055c0: 6e6f 7722 0a20 2020 2020 2020 2020 2020  now".           
+000055d0: 2074 6578 745f 7374 6172 7472 6c72 203d   text_startrlr =
+000055e0: 2022 5374 6172 7465 6420 6561 726c 6965   "Started earlie
+000055f0: 7222 0a20 2020 2020 2020 2020 2020 2074  r".            t
+00005600: 6578 745f 6669 6e69 7368 6564 203d 2022  ext_finished = "
+00005610: 416c 7265 6164 7920 646f 6e65 220a 2020  Already done".  
+00005620: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00005630: 2020 2020 2020 2020 7465 7874 5f73 7461          text_sta
+00005640: 7274 6e6f 7720 3d20 2253 7461 7274 206e  rtnow = "Start n
+00005650: 6f77 2220 2023 206e 6f74 2076 6973 6962  ow"  # not visib
+00005660: 6c65 0a20 2020 2020 2020 2020 2020 2074  le.            t
+00005670: 6578 745f 7374 6172 7472 6c72 203d 2022  ext_startrlr = "
+00005680: 5374 696c 6c20 7275 6e6e 696e 6722 0a20  Still running". 
+00005690: 2020 2020 2020 2020 2020 2074 6578 745f             text_
+000056a0: 6669 6e69 7368 6564 203d 2022 5374 6f70  finished = "Stop
+000056b0: 7065 6422 0a0a 2020 2020 2020 2020 7365  ped"..        se
+000056c0: 6c66 2e6e 6f64 652e 696e 6e65 7248 544d  lf.node.innerHTM
+000056d0: 4c20 3d20 6622 2222 0a20 2020 2020 2020  L = f""".       
+000056e0: 203c 6469 763e 0a20 2020 2020 2020 2020   <div>.         
+000056f0: 2020 203c 6c61 6265 6c20 7374 796c 653d     <label style=
+00005700: 2775 7365 722d 7365 6c65 6374 3a6e 6f6e  'user-select:non
+00005710: 653b 273e 3c69 6e70 7574 2074 7970 653d  e;'><input type=
+00005720: 2772 6164 696f 2720 6e61 6d65 3d27 7275  'radio' name='ru
+00005730: 6e6e 696e 676f 726e 6f74 2720 2f3e 266e  nningornot' />&n
+00005740: 6273 703b 7b74 6578 745f 7374 6172 746e  bsp;{text_startn
+00005750: 6f77 7d26 6e62 7370 3b26 6e62 7370 3b3c  ow}&nbsp;&nbsp;<
+00005760: 2f6c 6162 656c 3e0a 2020 2020 2020 2020  /label>.        
+00005770: 2020 2020 3c6c 6162 656c 2073 7479 6c65      <label style
+00005780: 3d27 7573 6572 2d73 656c 6563 743a 6e6f  ='user-select:no
+00005790: 6e65 3b27 3e3c 696e 7075 7420 7479 7065  ne;'><input type
+000057a0: 3d27 7261 6469 6f27 206e 616d 653d 2772  ='radio' name='r
+000057b0: 756e 6e69 6e67 6f72 6e6f 7427 202f 3e26  unningornot' />&
+000057c0: 6e62 7370 3b7b 7465 7874 5f73 7461 7274  nbsp;{text_start
+000057d0: 726c 727d 266e 6273 703b 266e 6273 703b  rlr}&nbsp;&nbsp;
+000057e0: 3c2f 6c61 6265 6c3e 0a20 2020 2020 2020  </label>.       
+000057f0: 2020 2020 203c 6c61 6265 6c20 7374 796c       <label styl
+00005800: 653d 2775 7365 722d 7365 6c65 6374 3a6e  e='user-select:n
+00005810: 6f6e 653b 273e 3c69 6e70 7574 2074 7970  one;'><input typ
+00005820: 653d 2772 6164 696f 2720 6e61 6d65 3d27  e='radio' name='
+00005830: 7275 6e6e 696e 676f 726e 6f74 2720 2f3e  runningornot' />
+00005840: 266e 6273 703b 7b74 6578 745f 6669 6e69  &nbsp;{text_fini
+00005850: 7368 6564 7d26 6e62 7370 3b26 6e62 7370  shed}&nbsp;&nbsp
+00005860: 3b3c 2f6c 6162 656c 3e0a 2020 2020 2020  ;</label>.      
+00005870: 2020 2020 2020 3c64 6976 2073 7479 6c65        <div style
+00005880: 3d27 6d69 6e2d 6865 6967 6874 3a31 656d  ='min-height:1em
+00005890: 3b27 3e3c 2f64 6976 3e0a 2020 2020 2020  ;'></div>.      
+000058a0: 2020 3c2f 6469 763e 0a20 2020 2020 2020    </div>.       
+000058b0: 203c 6469 763e 0a20 2020 2020 2020 203c   <div>.        <
+000058c0: 7370 616e 3e3c 6920 636c 6173 733d 2766  span><i class='f
+000058d0: 6173 2720 7374 796c 653d 2763 6f6c 6f72  as' style='color
+000058e0: 3a23 3939 393b 2076 6572 7469 6361 6c2d  :#999; vertical-
+000058f0: 616c 6967 6e3a 6d69 6464 6c65 3b27 3e5c  align:middle;'>\
+00005900: 7566 3134 343c 2f69 3e3c 2f73 7061 6e3e  uf144</i></span>
+00005910: 0a20 2020 2020 2020 2020 2020 203c 696e  .            <in
+00005920: 7075 7420 7479 7065 3d27 6461 7465 2720  put type='date' 
+00005930: 7374 6570 3d27 3127 2020 7374 796c 653d  step='1'  style=
+00005940: 2766 6f6e 742d 7369 7a65 3a20 3136 7078  'font-size: 16px
+00005950: 3b27 202f 3e0a 2020 2020 2020 2020 2020  ;' />.          
+00005960: 2020 3c73 7061 6e20 7374 796c 653d 2764    <span style='d
+00005970: 6973 706c 6179 3a20 666c 6578 3b27 3e0a  isplay: flex;'>.
+00005980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005990: 3c69 6e70 7574 2074 7970 653d 2774 6578  <input type='tex
+000059a0: 7427 2073 7479 6c65 3d27 666c 6578 3a31  t' style='flex:1
+000059b0: 3b20 6d69 6e2d 7769 6474 683a 2035 3070  ; min-width: 50p
+000059c0: 783b 2066 6f6e 742d 7369 7a65 3a20 3136  x; font-size: 16
+000059d0: 7078 3b27 202f 3e0a 2020 2020 2020 2020  px;' />.        
+000059e0: 2020 2020 2020 2020 3c62 7574 746f 6e20          <button 
+000059f0: 7479 7065 3d27 6275 7474 6f6e 2720 7374  type='button' st
+00005a00: 796c 653d 2777 6964 7468 3a32 656d 3b20  yle='width:2em; 
+00005a10: 6d61 7267 696e 2d6c 6566 743a 2d31 7078  margin-left:-1px
+00005a20: 3b27 3e2b 3c2f 6275 7474 6f6e 3e0a 2020  ;'>+</button>.  
+00005a30: 2020 2020 2020 2020 2020 2020 2020 3c62                <b
+00005a40: 7574 746f 6e20 7479 7065 3d27 6275 7474  utton type='butt
+00005a50: 6f6e 2720 7374 796c 653d 2777 6964 7468  on' style='width
+00005a60: 3a32 656d 3b20 6d61 7267 696e 2d6c 6566  :2em; margin-lef
+00005a70: 743a 2d31 7078 3b27 3e2d 3c2f 6275 7474  t:-1px;'>-</butt
+00005a80: 6f6e 3e0a 2020 2020 2020 2020 2020 2020  on>.            
+00005a90: 2020 2020 3c2f 7370 616e 3e0a 2020 2020      </span>.    
+00005aa0: 2020 2020 2020 2020 3c73 7061 6e3e 3c2f          <span></
+00005ab0: 7370 616e 3e0a 2020 2020 2020 2020 3c73  span>.        <s
+00005ac0: 7061 6e3e 3c69 2063 6c61 7373 3d27 6661  pan><i class='fa
+00005ad0: 7327 2073 7479 6c65 3d27 636f 6c6f 723a  s' style='color:
+00005ae0: 2339 3939 3b20 7665 7274 6963 616c 2d61  #999; vertical-a
+00005af0: 6c69 676e 3a6d 6964 646c 653b 273e 5c75  lign:middle;'>\u
+00005b00: 6632 3864 3c2f 693e 3c2f 7370 616e 3e0a  f28d</i></span>.
+00005b10: 2020 2020 2020 2020 2020 2020 3c69 6e70              <inp
+00005b20: 7574 2074 7970 653d 2764 6174 6527 2073  ut type='date' s
+00005b30: 7465 703d 2731 2720 7374 796c 653d 2766  tep='1' style='f
+00005b40: 6f6e 742d 7369 7a65 3a20 3136 7078 3b27  ont-size: 16px;'
+00005b50: 202f 3e0a 2020 2020 2020 2020 2020 2020   />.            
+00005b60: 3c73 7061 6e20 7374 796c 653d 2764 6973  <span style='dis
+00005b70: 706c 6179 3a20 666c 6578 3b27 3e0a 2020  play: flex;'>.  
+00005b80: 2020 2020 2020 2020 2020 2020 2020 3c69                <i
+00005b90: 6e70 7574 2074 7970 653d 2774 6578 7427  nput type='text'
+00005ba0: 2073 7479 6c65 3d27 666c 6578 3a31 3b20   style='flex:1; 
+00005bb0: 6d69 6e2d 7769 6474 683a 2035 3070 783b  min-width: 50px;
+00005bc0: 2066 6f6e 742d 7369 7a65 3a20 3136 7078   font-size: 16px
+00005bd0: 3b27 202f 3e0a 2020 2020 2020 2020 2020  ;' />.          
+00005be0: 2020 2020 2020 3c62 7574 746f 6e20 7479        <button ty
+00005bf0: 7065 3d27 6275 7474 6f6e 2720 7374 796c  pe='button' styl
+00005c00: 653d 2777 6964 7468 3a32 656d 3b20 6d61  e='width:2em; ma
+00005c10: 7267 696e 2d6c 6566 743a 2d31 7078 3b27  rgin-left:-1px;'
+00005c20: 3e2b 3c2f 6275 7474 6f6e 3e0a 2020 2020  >+</button>.    
+00005c30: 2020 2020 2020 2020 2020 2020 3c62 7574              <but
+00005c40: 746f 6e20 7479 7065 3d27 6275 7474 6f6e  ton type='button
+00005c50: 2720 7374 796c 653d 2777 6964 7468 3a32  ' style='width:2
+00005c60: 656d 3b20 6d61 7267 696e 2d6c 6566 743a  em; margin-left:
+00005c70: 2d31 7078 3b27 3e2d 3c2f 6275 7474 6f6e  -1px;'>-</button
+00005c80: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
+00005c90: 2020 3c2f 7370 616e 3e0a 2020 2020 2020    </span>.      
+00005ca0: 2020 2020 2020 3c73 7061 6e3e 3c2f 7370        <span></sp
+00005cb0: 616e 3e0a 2020 2020 2020 2020 3c73 7061  an>.        <spa
+00005cc0: 6e3e 3c69 2063 6c61 7373 3d27 6661 7327  n><i class='fas'
+00005cd0: 2073 7479 6c65 3d27 636f 6c6f 723a 2339   style='color:#9
+00005ce0: 3939 3b20 7665 7274 6963 616c 2d61 6c69  99; vertical-ali
+00005cf0: 676e 3a6d 6964 646c 653b 273e 5c75 6632  gn:middle;'>\uf2
+00005d00: 6632 3c2f 693e 3c2f 7370 616e 3e0a 2020  f2</i></span>.  
+00005d10: 2020 2020 2020 2020 2020 3c73 7061 6e3e            <span>
+00005d20: 3c2f 7370 616e 3e0a 2020 2020 2020 2020  </span>.        
+00005d30: 2020 2020 3c69 6e70 7574 2074 7970 653d      <input type=
+00005d40: 2774 6578 7427 2073 7479 6c65 3d27 666c  'text' style='fl
+00005d50: 6578 3a20 313b 206d 696e 2d77 6964 7468  ex: 1; min-width
+00005d60: 3a20 3530 7078 3b20 666f 6e74 2d73 697a  : 50px; font-siz
+00005d70: 653a 2031 3670 7827 202f 3e0a 2020 2020  e: 16px' />.    
+00005d80: 2020 2020 2020 2020 3c73 7061 6e3e 3c2f          <span></
+00005d90: 7370 616e 3e0a 2020 2020 2020 2020 3c2f  span>.        </
+00005da0: 6469 763e 0a20 2020 2020 2020 2022 2222  div>.        """
+00005db0: 0a0a 2020 2020 2020 2020 2320 556e 7061  ..        # Unpa
+00005dc0: 636b 2063 6869 6c64 7265 6e0a 2020 2020  ck children.    
+00005dd0: 2020 2020 7365 6c66 2e72 6164 696f 6e6f      self.radiono
+00005de0: 6465 203d 2073 656c 662e 6e6f 6465 2e63  de = self.node.c
+00005df0: 6869 6c64 7265 6e5b 305d 0a20 2020 2020  hildren[0].     
+00005e00: 2020 2073 656c 662e 6772 6964 6e6f 6465     self.gridnode
+00005e10: 203d 2073 656c 662e 6e6f 6465 2e63 6869   = self.node.chi
+00005e20: 6c64 7265 6e5b 315d 0a20 2020 2020 2020  ldren[1].       
+00005e30: 2073 656c 662e 7261 6469 6f5f 7374 6172   self.radio_star
+00005e40: 746e 6f77 203d 2073 656c 662e 7261 6469  tnow = self.radi
+00005e50: 6f6e 6f64 652e 6368 696c 6472 656e 5b30  onode.children[0
+00005e60: 5d2e 6368 696c 6472 656e 5b30 5d0a 2020  ].children[0].  
+00005e70: 2020 2020 2020 7365 6c66 2e72 6164 696f        self.radio
+00005e80: 5f73 7461 7274 726c 7220 3d20 7365 6c66  _startrlr = self
+00005e90: 2e72 6164 696f 6e6f 6465 2e63 6869 6c64  .radionode.child
+00005ea0: 7265 6e5b 315d 2e63 6869 6c64 7265 6e5b  ren[1].children[
+00005eb0: 305d 0a20 2020 2020 2020 2073 656c 662e  0].        self.
+00005ec0: 7261 6469 6f5f 6669 6e69 7368 6564 203d  radio_finished =
+00005ed0: 2073 656c 662e 7261 6469 6f6e 6f64 652e   self.radionode.
+00005ee0: 6368 696c 6472 656e 5b32 5d2e 6368 696c  children[2].chil
+00005ef0: 6472 656e 5b30 5d0a 2020 2020 2020 2020  dren[0].        
+00005f00: 280a 2020 2020 2020 2020 2020 2020 5f2c  (.            _,
+00005f10: 2020 2320 6461 7465 2061 6e64 2074 696d    # date and tim
+00005f20: 6520 310a 2020 2020 2020 2020 2020 2020  e 1.            
+00005f30: 7365 6c66 2e64 6174 6531 696e 7075 742c  self.date1input,
+00005f40: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00005f50: 662e 7469 6d65 3173 7475 6666 2c0a 2020  f.time1stuff,.  
+00005f60: 2020 2020 2020 2020 2020 5f2c 0a20 2020            _,.   
+00005f70: 2020 2020 2020 2020 205f 2c20 2023 2064           _,  # d
+00005f80: 6174 6520 616e 6420 7469 6d65 2032 0a20  ate and time 2. 
+00005f90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00005fa0: 6461 7465 3269 6e70 7574 2c0a 2020 2020  date2input,.    
+00005fb0: 2020 2020 2020 2020 7365 6c66 2e74 696d          self.tim
+00005fc0: 6532 7374 7566 662c 0a20 2020 2020 2020  e2stuff,.       
+00005fd0: 2020 2020 205f 2c0a 2020 2020 2020 2020       _,.        
+00005fe0: 2020 2020 5f2c 2020 2320 6475 7261 7469      _,  # durati
+00005ff0: 6f6e 0a20 2020 2020 2020 2020 2020 205f  on.            _
+00006000: 2c0a 2020 2020 2020 2020 2020 2020 7365  ,.            se
+00006010: 6c66 2e64 7572 6174 696f 6e69 6e70 7574  lf.durationinput
+00006020: 2c0a 2020 2020 2020 2020 2020 2020 5f2c  ,.            _,
+00006030: 0a20 2020 2020 2020 2029 203d 2073 656c  .        ) = sel
+00006040: 662e 6772 6964 6e6f 6465 2e63 6869 6c64  f.gridnode.child
+00006050: 7265 6e0a 0a20 2020 2020 2020 2073 656c  ren..        sel
+00006060: 662e 7469 6d65 3169 6e70 7574 2c20 7365  f.time1input, se
+00006070: 6c66 2e74 696d 6531 6d6f 7265 2c20 7365  lf.time1more, se
+00006080: 6c66 2e74 696d 6531 6c65 7373 203d 2073  lf.time1less = s
+00006090: 656c 662e 7469 6d65 3173 7475 6666 2e63  elf.time1stuff.c
+000060a0: 6869 6c64 7265 6e0a 2020 2020 2020 2020  hildren.        
+000060b0: 7365 6c66 2e74 696d 6532 696e 7075 742c  self.time2input,
+000060c0: 2073 656c 662e 7469 6d65 326d 6f72 652c   self.time2more,
+000060d0: 2073 656c 662e 7469 6d65 326c 6573 7320   self.time2less 
+000060e0: 3d20 7365 6c66 2e74 696d 6532 7374 7566  = self.time2stuf
+000060f0: 662e 6368 696c 6472 656e 0a0a 2020 2020  f.children..    
+00006100: 2020 2020 2320 5477 6561 6b73 0a20 2020      # Tweaks.   
+00006110: 2020 2020 2066 6f72 2062 7574 2069 6e20       for but in 
+00006120: 2873 656c 662e 7469 6d65 316c 6573 732c  (self.time1less,
+00006130: 2073 656c 662e 7469 6d65 316d 6f72 652c   self.time1more,
+00006140: 2073 656c 662e 7469 6d65 326c 6573 732c   self.time2less,
+00006150: 2073 656c 662e 7469 6d65 326d 6f72 6529   self.time2more)
+00006160: 3a0a 2020 2020 2020 2020 2020 2020 6275  :.            bu
+00006170: 742e 7365 7441 7474 7269 6275 7465 2822  t.setAttribute("
+00006180: 7461 6249 6e64 6578 222c 202d 3129 0a0a  tabIndex", -1)..
+00006190: 2020 2020 2020 2020 2320 5374 796c 696e          # Stylin
+000061a0: 670a 2020 2020 2020 2020 7365 6c66 2e67  g.        self.g
+000061b0: 7269 646e 6f64 652e 7374 796c 652e 6469  ridnode.style.di
+000061c0: 7370 6c61 7920 3d20 2267 7269 6422 0a20  splay = "grid". 
+000061d0: 2020 2020 2020 2073 656c 662e 6772 6964         self.grid
+000061e0: 6e6f 6465 2e73 7479 6c65 2e67 7269 6454  node.style.gridT
+000061f0: 656d 706c 6174 6543 6f6c 756d 6e73 203d  emplateColumns =
+00006200: 2022 6175 746f 2031 3330 7078 2031 3430   "auto 130px 140
+00006210: 7078 2032 6672 220a 2020 2020 2020 2020  px 2fr".        
+00006220: 7365 6c66 2e67 7269 646e 6f64 652e 7374  self.gridnode.st
+00006230: 796c 652e 6772 6964 4761 7020 3d20 2234  yle.gridGap = "4
+00006240: 7078 2030 2e35 656d 220a 2020 2020 2020  px 0.5em".      
+00006250: 2020 7365 6c66 2e67 7269 646e 6f64 652e    self.gridnode.
+00006260: 7374 796c 652e 6a75 7374 6966 7949 7465  style.justifyIte
+00006270: 6d73 203d 2022 7374 7265 7463 6822 0a20  ms = "stretch". 
+00006280: 2020 2020 2020 2073 656c 662e 6772 6964         self.grid
+00006290: 6e6f 6465 2e73 7479 6c65 2e61 6c69 676e  node.style.align
+000062a0: 4974 656d 7320 3d20 2273 7472 6574 6368  Items = "stretch
+000062b0: 220a 0a20 2020 2020 2020 2023 2053 6574  "..        # Set
+000062c0: 2076 6973 6962 696c 6974 7920 6f66 206d   visibility of m
+000062d0: 6f64 652d 7261 6469 6f2d 6275 7474 6f6e  ode-radio-button
+000062e0: 730a 2020 2020 2020 2020 6966 2073 656c  s.        if sel
+000062f0: 662e 696e 6974 6961 6c6d 6f64 6520 3d3d  f.initialmode ==
+00006300: 2022 7374 6172 7422 3a0a 2020 2020 2020   "start":.      
+00006310: 2020 2020 2020 7365 6c66 2e72 6164 696f        self.radio
+00006320: 5f73 7461 7274 6e6f 772e 7365 7441 7474  _startnow.setAtt
+00006330: 7269 6275 7465 2822 6368 6563 6b65 6422  ribute("checked"
+00006340: 2c20 5472 7565 290a 2020 2020 2020 2020  , True).        
+00006350: 656c 6966 2073 656c 662e 696e 6974 6961  elif self.initia
+00006360: 6c6d 6f64 6520 3d3d 2022 6e65 7722 3a0a  lmode == "new":.
+00006370: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00006380: 2e72 6164 696f 5f66 696e 6973 6865 642e  .radio_finished.
+00006390: 7365 7441 7474 7269 6275 7465 2822 6368  setAttribute("ch
+000063a0: 6563 6b65 6422 2c20 5472 7565 290a 2020  ecked", True).  
+000063b0: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
+000063c0: 696e 6974 6961 6c6d 6f64 6520 3d3d 2022  initialmode == "
+000063d0: 7374 6f70 223a 0a20 2020 2020 2020 2020  stop":.         
+000063e0: 2020 2073 656c 662e 7261 6469 6f5f 6669     self.radio_fi
+000063f0: 6e69 7368 6564 2e73 6574 4174 7472 6962  nished.setAttrib
+00006400: 7574 6528 2263 6865 636b 6564 222c 2054  ute("checked", T
+00006410: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+00006420: 2073 656c 662e 7261 6469 6f5f 7374 6172   self.radio_star
+00006430: 746e 6f77 2e70 6172 656e 744e 6f64 652e  tnow.parentNode.
+00006440: 7374 796c 652e 6469 7370 6c61 7920 3d20  style.display = 
+00006450: 226e 6f6e 6522 0a20 2020 2020 2020 2065  "none".        e
+00006460: 6c69 6620 7431 203d 3d20 7432 3a0a 2020  lif t1 == t2:.  
+00006470: 2020 2020 2020 2020 2020 7365 6c66 2e72            self.r
+00006480: 6164 696f 5f73 7461 7274 726c 722e 7365  adio_startrlr.se
+00006490: 7441 7474 7269 6275 7465 2822 6368 6563  tAttribute("chec
+000064a0: 6b65 6422 2c20 5472 7565 290a 2020 2020  ked", True).    
+000064b0: 2020 2020 2020 2020 7365 6c66 2e72 6164          self.rad
+000064c0: 696f 5f73 7461 7274 6e6f 772e 7061 7265  io_startnow.pare
+000064d0: 6e74 4e6f 6465 2e73 7479 6c65 2e64 6973  ntNode.style.dis
+000064e0: 706c 6179 203d 2022 6e6f 6e65 220a 2020  play = "none".  
+000064f0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00006500: 2020 2020 2020 2020 7365 6c66 2e72 6164          self.rad
+00006510: 696f 5f66 696e 6973 6865 642e 7365 7441  io_finished.setA
+00006520: 7474 7269 6275 7465 2822 6368 6563 6b65  ttribute("checke
+00006530: 6422 2c20 5472 7565 290a 2020 2020 2020  d", True).      
+00006540: 2020 2020 2020 7365 6c66 2e72 6164 696f        self.radio
+00006550: 6e6f 6465 2e73 7479 6c65 2e64 6973 706c  node.style.displ
+00006560: 6179 203d 2022 6e6f 6e65 220a 0a20 2020  ay = "none"..   
+00006570: 2020 2020 2023 2043 6f6e 6e65 6374 2065       # Connect e
+00006580: 7665 6e74 730a 2020 2020 2020 2020 7365  vents.        se
+00006590: 6c66 2e72 6164 696f 5f73 7461 7274 6e6f  lf.radio_startno
+000065a0: 772e 6f6e 636c 6963 6b20 3d20 7365 6c66  w.onclick = self
+000065b0: 2e5f 6f6e 5f6d 6f64 655f 6368 616e 6765  ._on_mode_change
+000065c0: 0a20 2020 2020 2020 2073 656c 662e 7261  .        self.ra
+000065d0: 6469 6f5f 7374 6172 7472 6c72 2e6f 6e63  dio_startrlr.onc
+000065e0: 6c69 636b 203d 2073 656c 662e 5f6f 6e5f  lick = self._on_
+000065f0: 6d6f 6465 5f63 6861 6e67 650a 2020 2020  mode_change.    
+00006600: 2020 2020 7365 6c66 2e72 6164 696f 5f66      self.radio_f
+00006610: 696e 6973 6865 642e 6f6e 636c 6963 6b20  inished.onclick 
+00006620: 3d20 7365 6c66 2e5f 6f6e 5f6d 6f64 655f  = self._on_mode_
+00006630: 6368 616e 6765 0a20 2020 2020 2020 2073  change.        s
+00006640: 656c 662e 6461 7465 3169 6e70 7574 2e6f  elf.date1input.o
+00006650: 6e62 6c75 7220 3d20 6c61 6d62 6461 3a20  nblur = lambda: 
+00006660: 7365 6c66 2e6f 6e63 6861 6e67 6564 2822  self.onchanged("
+00006670: 6461 7465 3122 290a 2020 2020 2020 2020  date1").        
+00006680: 7365 6c66 2e74 696d 6531 696e 7075 742e  self.time1input.
+00006690: 6f6e 6368 616e 6765 203d 206c 616d 6264  onchange = lambd
+000066a0: 613a 2073 656c 662e 6f6e 6368 616e 6765  a: self.onchange
+000066b0: 6428 2274 696d 6531 2229 0a20 2020 2020  d("time1").     
+000066c0: 2020 2073 656c 662e 6461 7465 3269 6e70     self.date2inp
+000066d0: 7574 2e6f 6e62 6c75 7220 3d20 6c61 6d62  ut.onblur = lamb
+000066e0: 6461 3a20 7365 6c66 2e6f 6e63 6861 6e67  da: self.onchang
+000066f0: 6564 2822 6461 7465 3222 290a 2020 2020  ed("date2").    
+00006700: 2020 2020 7365 6c66 2e74 696d 6532 696e      self.time2in
+00006710: 7075 742e 6f6e 6368 616e 6765 203d 206c  put.onchange = l
+00006720: 616d 6264 613a 2073 656c 662e 6f6e 6368  ambda: self.onch
+00006730: 616e 6765 6428 2274 696d 6532 2229 0a20  anged("time2"). 
+00006740: 2020 2020 2020 2073 656c 662e 6475 7261         self.dura
+00006750: 7469 6f6e 696e 7075 742e 6f6e 6368 616e  tioninput.onchan
+00006760: 6765 203d 206c 616d 6264 613a 2073 656c  ge = lambda: sel
+00006770: 662e 6f6e 6368 616e 6765 6428 2264 7572  f.onchanged("dur
+00006780: 6174 696f 6e22 290a 2020 2020 2020 2020  ation").        
+00006790: 7365 6c66 2e74 696d 6531 6d6f 7265 2e6f  self.time1more.o
+000067a0: 6e63 6c69 636b 203d 206c 616d 6264 613a  nclick = lambda:
+000067b0: 2073 656c 662e 6f6e 6368 616e 6765 6428   self.onchanged(
+000067c0: 2274 696d 6531 6d6f 7265 2229 0a20 2020  "time1more").   
+000067d0: 2020 2020 2073 656c 662e 7469 6d65 316c       self.time1l
+000067e0: 6573 732e 6f6e 636c 6963 6b20 3d20 6c61  ess.onclick = la
+000067f0: 6d62 6461 3a20 7365 6c66 2e6f 6e63 6861  mbda: self.oncha
+00006800: 6e67 6564 2822 7469 6d65 316c 6573 7322  nged("time1less"
+00006810: 290a 2020 2020 2020 2020 7365 6c66 2e74  ).        self.t
+00006820: 696d 6532 6d6f 7265 2e6f 6e63 6c69 636b  ime2more.onclick
+00006830: 203d 206c 616d 6264 613a 2073 656c 662e   = lambda: self.
+00006840: 6f6e 6368 616e 6765 6428 2274 696d 6532  onchanged("time2
+00006850: 6d6f 7265 2229 0a20 2020 2020 2020 2073  more").        s
+00006860: 656c 662e 7469 6d65 326c 6573 732e 6f6e  elf.time2less.on
+00006870: 636c 6963 6b20 3d20 6c61 6d62 6461 3a20  click = lambda: 
+00006880: 7365 6c66 2e6f 6e63 6861 6e67 6564 2822  self.onchanged("
+00006890: 7469 6d65 326c 6573 7322 290a 2020 2020  time2less").    
+000068a0: 2020 2020 7365 6c66 2e74 696d 6531 696e      self.time1in
+000068b0: 7075 742e 6f6e 696e 7075 7420 3d20 6c61  put.oninput = la
+000068c0: 6d62 6461 3a20 7365 6c66 2e6f 6e63 6861  mbda: self.oncha
+000068d0: 6e67 6564 2822 7469 6d65 3166 6173 7422  nged("time1fast"
+000068e0: 290a 2020 2020 2020 2020 7365 6c66 2e74  ).        self.t
+000068f0: 696d 6532 696e 7075 742e 6f6e 696e 7075  ime2input.oninpu
+00006900: 7420 3d20 6c61 6d62 6461 3a20 7365 6c66  t = lambda: self
+00006910: 2e6f 6e63 6861 6e67 6564 2822 7469 6d65  .onchanged("time
+00006920: 3266 6173 7422 290a 0a20 2020 2020 2020  2fast")..       
+00006930: 2073 656c 662e 7265 7365 7428 7431 2c20   self.reset(t1, 
+00006940: 7432 2c20 5472 7565 290a 2020 2020 2020  t2, True).      
+00006950: 2020 7365 6c66 2e5f 7469 6d65 725f 6861    self._timer_ha
+00006960: 6e64 6c65 203d 2077 696e 646f 772e 7365  ndle = window.se
+00006970: 7449 6e74 6572 7661 6c28 6c61 6d62 6461  tInterval(lambda
+00006980: 3a20 7365 6c66 2e5f 7570 6461 7465 5f64  : self._update_d
+00006990: 7572 6174 696f 6e28 292c 2032 3030 290a  uration(), 200).
+000069a0: 0a20 2020 2064 6566 2063 6c6f 7365 2873  .    def close(s
+000069b0: 656c 6629 3a0a 2020 2020 2020 2020 7769  elf):.        wi
+000069c0: 6e64 6f77 2e63 6c65 6172 496e 7465 7276  ndow.clearInterv
+000069d0: 616c 2873 656c 662e 5f74 696d 6572 5f68  al(self._timer_h
+000069e0: 616e 646c 6529 0a0a 2020 2020 6465 6620  andle)..    def 
+000069f0: 5f67 6574 5f73 656e 7369 626c 655f 7374  _get_sensible_st
+00006a00: 6172 745f 7469 6d65 2873 656c 6629 3a0a  art_time(self):.
+00006a10: 2020 2020 2020 2020 7432 203d 2064 742e          t2 = dt.
+00006a20: 6e6f 7728 290a 2020 2020 2020 2020 7365  now().        se
+00006a30: 6373 5f65 6172 6c69 6572 203d 2038 202a  cs_earlier = 8 *
+00006a40: 2033 3630 3020 2023 2038 2068 6f75 7273   3600  # 8 hours
+00006a50: 0a20 2020 2020 2020 2072 756e 6e69 6e67  .        running
+00006a60: 203d 2077 696e 646f 772e 7374 6f72 652e   = window.store.
+00006a70: 7265 636f 7264 732e 6765 745f 7275 6e6e  records.get_runn
+00006a80: 696e 675f 7265 636f 7264 7328 290a 2020  ing_records().  
+00006a90: 2020 2020 2020 7265 636f 7264 7320 3d20        records = 
+00006aa0: 7769 6e64 6f77 2e73 746f 7265 2e72 6563  window.store.rec
+00006ab0: 6f72 6473 2e67 6574 5f72 6563 6f72 6473  ords.get_records
+00006ac0: 2874 3220 2d20 7365 6373 5f65 6172 6c69  (t2 - secs_earli
+00006ad0: 6572 2c20 7432 292e 7661 6c75 6573 2829  er, t2).values()
+00006ae0: 0a20 2020 2020 2020 2069 6620 7275 6e6e  .        if runn
+00006af0: 696e 673a 0a20 2020 2020 2020 2020 2020  ing:.           
+00006b00: 2074 3120 3d20 7432 202d 2033 3030 2020   t1 = t2 - 300  
+00006b10: 2320 3520 6d69 6e20 6561 726c 6965 720a  # 5 min earlier.
+00006b20: 2020 2020 2020 2020 656c 6966 206c 656e          elif len
+00006b30: 2872 6563 6f72 6473 2920 3e20 303a 0a20  (records) > 0:. 
+00006b40: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
+00006b50: 6473 2e73 6f72 7428 6b65 793d 6c61 6d62  ds.sort(key=lamb
+00006b60: 6461 2072 3a20 722e 7432 290a 2020 2020  da r: r.t2).    
+00006b70: 2020 2020 2020 2020 7431 203d 2072 6563          t1 = rec
+00006b80: 6f72 6473 5b2d 315d 2e74 3220 2023 2073  ords[-1].t2  # s
+00006b90: 7461 7274 2074 696d 6520 3d3d 206c 6173  tart time == las
+00006ba0: 7420 7265 636f 7264 7320 7374 6f70 2074  t records stop t
+00006bb0: 696d 650a 2020 2020 2020 2020 2020 2020  ime.            
+00006bc0: 7431 203d 206d 696e 2874 312c 2074 3220  t1 = min(t1, t2 
+00006bd0: 2d20 3129 0a20 2020 2020 2020 2065 6c73  - 1).        els
+00006be0: 653a 0a20 2020 2020 2020 2020 2020 2074  e:.            t
+00006bf0: 3120 3d20 7432 202d 2033 3630 3020 2023  1 = t2 - 3600  #
+00006c00: 2073 7461 7274 2074 696d 6520 6973 2061   start time is a
+00006c10: 6e20 686f 7572 2061 676f 0a20 2020 2020  n hour ago.     
+00006c20: 2020 2072 6574 7572 6e20 7431 0a0a 2020     return t1..  
+00006c30: 2020 6465 6620 5f6f 6e5f 6d6f 6465 5f63    def _on_mode_c
+00006c40: 6861 6e67 6528 7365 6c66 293a 0a20 2020  hange(self):.   
+00006c50: 2020 2020 2069 6620 7365 6c66 2e69 6e69       if self.ini
+00006c60: 7469 616c 6d6f 6465 2069 6e20 2822 7374  tialmode in ("st
+00006c70: 6172 7422 2c20 226e 6577 2229 3a0a 2020  art", "new"):.  
+00006c80: 2020 2020 2020 2020 2020 7432 203d 2064            t2 = d
+00006c90: 742e 6e6f 7728 290a 2020 2020 2020 2020  t.now().        
+00006ca0: 2020 2020 6966 2073 656c 662e 7261 6469      if self.radi
+00006cb0: 6f5f 7374 6172 746e 6f77 2e63 6865 636b  o_startnow.check
+00006cc0: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
+00006cd0: 2020 2020 7365 6c66 2e72 6573 6574 2874      self.reset(t
+00006ce0: 322c 2074 3229 0a20 2020 2020 2020 2020  2, t2).         
+00006cf0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00006d00: 2020 2020 2020 2020 2023 2049 6620 7468           # If th
+00006d10: 6520 6375 7272 656e 7420 7374 6172 7420  e current start 
+00006d20: 7469 6d65 2069 7320 3520 6d69 6e20 6561  time is 5 min ea
+00006d30: 726c 6965 722c 2075 7365 2074 6861 742c  rlier, use that,
+00006d40: 206f 7468 6572 7769 7365 0a20 2020 2020   otherwise.     
+00006d50: 2020 2020 2020 2020 2020 2023 2063 616c             # cal
+00006d60: 6375 6c61 7465 2061 2073 656e 7369 626c  culate a sensibl
+00006d70: 6520 7374 6172 7420 7469 6d65 2e20 5468  e start time. Th
+00006d80: 6520 3520 6d69 6e20 6170 706c 6965 7320  e 5 min applies 
+00006d90: 7768 656e 2061 2073 656e 7369 626c 650a  when a sensible.
+00006da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006db0: 2320 7374 6172 7420 7469 6d65 2068 6173  # start time has
+00006dc0: 2061 6c72 6561 6479 2062 6565 6e20 7365   already been se
+00006dd0: 742c 206f 7220 7768 656e 2074 6865 2064  t, or when the d
+00006de0: 6961 6c6f 6720 6861 7320 6265 656e 0a20  ialog has been. 
+00006df0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00006e00: 206f 6e20 2273 7461 7274 206e 6f77 2220   on "start now" 
+00006e10: 666f 7220 6f76 6572 2035 206d 696e 7574  for over 5 minut
+00006e20: 6573 2028 7768 6963 6820 6973 2061 6c73  es (which is als
+00006e30: 6f20 4f4b 2049 2067 7565 7373 292e 0a20  o OK I guess).. 
+00006e40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00006e50: 6620 7365 6c66 2e74 3120 3c3d 2074 3220  f self.t1 <= t2 
+00006e60: 2d20 3330 303a 0a20 2020 2020 2020 2020  - 300:.         
+00006e70: 2020 2020 2020 2020 2020 2074 3120 3d20             t1 = 
+00006e80: 7365 6c66 2e74 310a 2020 2020 2020 2020  self.t1.        
+00006e90: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00006ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006eb0: 2020 7431 203d 2073 656c 662e 5f67 6574    t1 = self._get
+00006ec0: 5f73 656e 7369 626c 655f 7374 6172 745f  _sensible_start_
+00006ed0: 7469 6d65 2829 0a20 2020 2020 2020 2020  time().         
+00006ee0: 2020 2020 2020 2069 6620 7365 6c66 2e72         if self.r
+00006ef0: 6164 696f 5f73 7461 7274 726c 722e 6368  adio_startrlr.ch
+00006f00: 6563 6b65 643a 0a20 2020 2020 2020 2020  ecked:.         
+00006f10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00006f20: 7265 7365 7428 7431 2c20 7431 290a 2020  reset(t1, t1).  
+00006f30: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00006f40: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00006f50: 2020 2020 2020 2020 7365 6c66 2e72 6573          self.res
+00006f60: 6574 2874 312c 2074 3229 0a20 2020 2020  et(t1, t2).     
+00006f70: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00006f80: 2020 2020 2023 2053 7769 7463 6820 6265       # Switch be
+00006f90: 7477 6565 6e20 2261 6c72 6561 6479 2072  tween "already r
+00006fa0: 756e 6e69 6e67 2220 616e 6420 2266 696e  unning" and "fin
+00006fb0: 6973 6865 6422 2e0a 2020 2020 2020 2020  ished"..        
+00006fc0: 2020 2020 2320 5369 6e63 6520 7468 6973      # Since this
+00006fd0: 2069 7320 616e 2065 7869 7374 696e 6720   is an existing 
+00006fe0: 7265 636f 7264 2c20 7765 2073 686f 756c  record, we shoul
+00006ff0: 6420 6d61 696e 7461 696e 2069 6e69 7469  d maintain initi
+00007000: 616c 2076 616c 7565 732e 0a20 2020 2020  al values..     
+00007010: 2020 2020 2020 2069 6620 7365 6c66 2e72         if self.r
+00007020: 6164 696f 5f73 7461 7274 726c 722e 6368  adio_startrlr.ch
+00007030: 6563 6b65 643a 0a20 2020 2020 2020 2020  ecked:.         
+00007040: 2020 2020 2020 2073 656c 662e 7265 7365         self.rese
+00007050: 7428 7365 6c66 2e69 6e69 7469 616c 5f74  t(self.initial_t
+00007060: 312c 2073 656c 662e 696e 6974 6961 6c5f  1, self.initial_
+00007070: 7431 290a 2020 2020 2020 2020 2020 2020  t1).            
+00007080: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00007090: 2020 2020 2020 7432 203d 206d 6178 2873        t2 = max(s
+000070a0: 656c 662e 696e 6974 6961 6c5f 7431 202b  elf.initial_t1 +
+000070b0: 2031 2c20 6474 2e6e 6f77 2829 290a 2020   1, dt.now()).  
+000070c0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000070d0: 6c66 2e72 6573 6574 2873 656c 662e 696e  lf.reset(self.in
+000070e0: 6974 6961 6c5f 7431 2c20 7432 290a 0a20  itial_t1, t2).. 
+000070f0: 2020 2064 6566 2072 6573 6574 2873 656c     def reset(sel
+00007100: 662c 2074 312c 2074 322c 2069 6e69 7469  f, t1, t2, initi
+00007110: 616c 3d46 616c 7365 293a 0a20 2020 2020  al=False):.     
+00007120: 2020 2022 2222 5265 7365 7420 7769 7468     """Reset with
+00007130: 2061 2067 6976 656e 2074 3120 616e 6420   a given t1 and 
+00007140: 7432 2e22 2222 0a0a 2020 2020 2020 2020  t2."""..        
+00007150: 2320 5374 6f72 6520 6f72 6967 696e 616c  # Store original
+00007160: 730a 2020 2020 2020 2020 7365 6c66 2e6f  s.        self.o
+00007170: 7269 5f74 3120 3d20 7365 6c66 2e74 3120  ri_t1 = self.t1 
+00007180: 3d20 7431 0a20 2020 2020 2020 2073 656c  = t1.        sel
+00007190: 662e 6f72 695f 7432 203d 2073 656c 662e  f.ori_t2 = self.
+000071a0: 7432 203d 2074 320a 0a20 2020 2020 2020  t2 = t2..       
+000071b0: 2023 2047 6574 206f 7269 6769 6e61 6c20   # Get original 
+000071c0: 6461 7465 7320 616e 6420 2873 7472 2920  dates and (str) 
+000071d0: 7469 6d65 730a 2020 2020 2020 2020 7365  times.        se
+000071e0: 6c66 2e6f 7269 5f64 6174 6531 2c20 7365  lf.ori_date1, se
+000071f0: 6c66 2e6f 7269 5f74 696d 6531 203d 2064  lf.ori_time1 = d
+00007200: 742e 7469 6d65 326c 6f63 616c 7374 7228  t.time2localstr(
+00007210: 7365 6c66 2e74 3129 2e73 706c 6974 2822  self.t1).split("
+00007220: 2022 290a 2020 2020 2020 2020 7365 6c66   ").        self
+00007230: 2e6f 7269 5f64 6174 6532 2c20 7365 6c66  .ori_date2, self
+00007240: 2e6f 7269 5f74 696d 6532 203d 2064 742e  .ori_time2 = dt.
+00007250: 7469 6d65 326c 6f63 616c 7374 7228 7365  time2localstr(se
+00007260: 6c66 2e74 3229 2e73 706c 6974 2822 2022  lf.t2).split(" "
+00007270: 290a 2020 2020 2020 2020 7365 6c66 2e6f  ).        self.o
+00007280: 7269 5f64 6179 7332 203d 2073 656c 662e  ri_days2 = self.
+00007290: 6461 7973 3220 3d20 7365 6c66 2e5f 6461  days2 = self._da
+000072a0: 7973 5f62 6574 7765 656e 5f64 6174 6573  ys_between_dates
+000072b0: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
+000072c0: 6c66 2e6f 7269 5f64 6174 6531 2c20 7365  lf.ori_date1, se
+000072d0: 6c66 2e6f 7269 5f64 6174 6532 0a20 2020  lf.ori_date2.   
+000072e0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+000072f0: 2320 5374 6f72 6520 6f72 6967 696e 616c  # Store original
+00007300: 2073 7472 2064 7572 6174 696f 6e0a 2020   str duration.  
+00007310: 2020 2020 2020 7420 3d20 7432 202d 2074        t = t2 - t
+00007320: 310a 2020 2020 2020 2020 7365 6c66 2e6f  1.        self.o
+00007330: 7269 5f64 7572 6174 696f 6e20 3d20 6622  ri_duration = f"
+00007340: 7b74 2f2f 3336 3030 3a2e 3066 7d68 207b  {t//3600:.0f}h {
+00007350: 2874 2f2f 3630 2925 3630 3a30 322e 3066  (t//60)%60:02.0f
+00007360: 7d6d 207b 7425 3630 3a30 322e 3066 7d73  }m {t%60:02.0f}s
+00007370: 220a 0a20 2020 2020 2020 2073 656c 662e  "..        self.
+00007380: 5f73 6574 5f74 696d 655f 696e 7075 745f  _set_time_input_
+00007390: 7669 7369 6269 6c69 7479 2829 0a20 2020  visibility().   
+000073a0: 2020 2020 2073 656c 662e 7265 6e64 6572       self.render
+000073b0: 2829 0a20 2020 2020 2020 2069 6620 6e6f  ().        if no
+000073c0: 7420 696e 6974 6961 6c3a 0a20 2020 2020  t initial:.     
+000073d0: 2020 2020 2020 2077 696e 646f 772e 7365         window.se
+000073e0: 7454 696d 656f 7574 2873 656c 662e 6361  tTimeout(self.ca
+000073f0: 6c6c 6261 636b 2c20 3129 0a0a 2020 2020  llback, 1)..    
+00007400: 6465 6620 5f73 6574 5f74 696d 655f 696e  def _set_time_in
+00007410: 7075 745f 7669 7369 6269 6c69 7479 2873  put_visibility(s
+00007420: 656c 6629 3a0a 2020 2020 2020 2020 6465  elf):.        de
+00007430: 6620 7368 6f77 5f73 7562 6e6f 6465 2869  f show_subnode(i
+00007440: 2c20 7368 6f77 293a 0a20 2020 2020 2020  , show):.       
+00007450: 2020 2020 2073 7562 6e6f 6465 203d 2073       subnode = s
+00007460: 656c 662e 6772 6964 6e6f 6465 2e63 6869  elf.gridnode.chi
+00007470: 6c64 7265 6e5b 695d 0a20 2020 2020 2020  ldren[i].       
+00007480: 2020 2020 2069 6620 6e6f 7420 7368 6f77       if not show
+00007490: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000074a0: 2020 7375 626e 6f64 652e 7374 796c 652e    subnode.style.
+000074b0: 6469 7370 6c61 7920 3d20 226e 6f6e 6522  display = "none"
+000074c0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+000074d0: 6620 6920 2520 3420 3d3d 2032 3a0a 2020  f i % 4 == 2:.  
+000074e0: 2020 2020 2020 2020 2020 2020 2020 7375                su
+000074f0: 626e 6f64 652e 7374 796c 652e 6469 7370  bnode.style.disp
+00007500: 6c61 7920 3d20 2266 6c65 7822 0a20 2020  lay = "flex".   
+00007510: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00007520: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00007530: 7562 6e6f 6465 2e73 7479 6c65 2e64 6973  ubnode.style.dis
+00007540: 706c 6179 203d 2022 696e 6c69 6e65 2d62  play = "inline-b
+00007550: 6c6f 636b 220a 0a20 2020 2020 2020 2066  lock"..        f
+00007560: 6f72 2069 2069 6e20 7261 6e67 6528 302c  or i in range(0,
+00007570: 2034 293a 0a20 2020 2020 2020 2020 2020   4):.           
+00007580: 2073 686f 775f 7375 626e 6f64 6528 692c   show_subnode(i,
+00007590: 206e 6f74 2073 656c 662e 7261 6469 6f5f   not self.radio_
+000075a0: 7374 6172 746e 6f77 2e63 6865 636b 6564  startnow.checked
+000075b0: 290a 2020 2020 2020 2020 666f 7220 6920  ).        for i 
+000075c0: 696e 2072 616e 6765 2834 2c20 3829 3a0a  in range(4, 8):.
+000075d0: 2020 2020 2020 2020 2020 2020 7368 6f77              show
+000075e0: 5f73 7562 6e6f 6465 2869 2c20 7365 6c66  _subnode(i, self
+000075f0: 2e72 6164 696f 5f66 696e 6973 6865 642e  .radio_finished.
+00007600: 6368 6563 6b65 6429 0a20 2020 2020 2020  checked).       
+00007610: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+00007620: 382c 2031 3229 3a0a 2020 2020 2020 2020  8, 12):.        
+00007630: 2020 2020 7368 6f77 5f73 7562 6e6f 6465      show_subnode
+00007640: 2869 2c20 6e6f 7420 7365 6c66 2e72 6164  (i, not self.rad
+00007650: 696f 5f73 7461 7274 6e6f 772e 6368 6563  io_startnow.chec
+00007660: 6b65 6429 0a0a 2020 2020 6465 6620 5f75  ked)..    def _u
+00007670: 7064 6174 655f 6475 7261 7469 6f6e 2873  pdate_duration(s
+00007680: 656c 662c 2066 6f72 6365 3d46 616c 7365  elf, force=False
+00007690: 293a 0a20 2020 2020 2020 2069 735f 7275  ):.        is_ru
+000076a0: 6e6e 696e 6720 3d20 7365 6c66 2e6f 7269  nning = self.ori
+000076b0: 5f74 3120 3d3d 2073 656c 662e 6f72 695f  _t1 == self.ori_
+000076c0: 7432 0a20 2020 2020 2020 2069 6620 6e6f  t2.        if no
+000076d0: 7420 2866 6f72 6365 206f 7220 6973 5f72  t (force or is_r
+000076e0: 756e 6e69 6e67 293a 0a20 2020 2020 2020  unning):.       
+000076f0: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
+00007700: 2020 2020 2069 6620 6973 5f72 756e 6e69       if is_runni
+00007710: 6e67 3a0a 2020 2020 2020 2020 2020 2020  ng:.            
+00007720: 7420 3d20 6474 2e6e 6f77 2829 202d 2073  t = dt.now() - s
+00007730: 656c 662e 7431 0a20 2020 2020 2020 2020  elf.t1.         
+00007740: 2020 2073 656c 662e 6475 7261 7469 6f6e     self.duration
+00007750: 696e 7075 742e 7661 6c75 6520 3d20 280a  input.value = (.
+00007760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007770: 6622 7b74 2f2f 3336 3030 3a2e 3066 7d68  f"{t//3600:.0f}h
+00007780: 207b 2874 2f2f 3630 2925 3630 3a30 322e   {(t//60)%60:02.
+00007790: 3066 7d6d 207b 7425 3630 3a30 322e 3066  0f}m {t%60:02.0f
+000077a0: 7d73 220a 2020 2020 2020 2020 2020 2020  }s".            
+000077b0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+000077c0: 2020 2020 2020 2020 2020 2020 7420 3d20              t = 
+000077d0: 7365 6c66 2e74 3220 2d20 7365 6c66 2e74  self.t2 - self.t
+000077e0: 310a 2020 2020 2020 2020 2020 2020 6d20  1.            m 
+000077f0: 3d20 4d61 7468 2e72 6f75 6e64 2874 202f  = Math.round(t /
+00007800: 2036 3029 0a20 2020 2020 2020 2020 2020   60).           
+00007810: 2073 656c 662e 6475 7261 7469 6f6e 696e   self.durationin
+00007820: 7075 742e 7661 6c75 6520 3d20 6622 7b6d  put.value = f"{m
+00007830: 2f2f 3630 3a2e 3066 7d68 207b 6d25 3630  //60:.0f}h {m%60
+00007840: 3a30 322e 3066 7d6d 220a 0a20 2020 2064  :02.0f}m"..    d
+00007850: 6566 205f 6461 7973 5f62 6574 7765 656e  ef _days_between
+00007860: 5f64 6174 6573 2873 656c 662c 2064 312c  _dates(self, d1,
+00007870: 2064 3229 3a0a 2020 2020 2020 2020 7965   d2):.        ye
+00007880: 6172 312c 206d 6f6e 7468 312c 2064 6179  ar1, month1, day
+00007890: 3120 3d20 6431 2e73 706c 6974 2822 2d22  1 = d1.split("-"
+000078a0: 290a 2020 2020 2020 2020 7965 6172 322c  ).        year2,
+000078b0: 206d 6f6e 7468 322c 2064 6179 3220 3d20   month2, day2 = 
+000078c0: 6432 2e73 706c 6974 2822 2d22 290a 2020  d2.split("-").  
+000078d0: 2020 2020 2020 6474 3120 3d20 7769 6e64        dt1 = wind
+000078e0: 6f77 2e44 6174 6528 7965 6172 312c 206d  ow.Date(year1, m
+000078f0: 6f6e 7468 3120 2d20 312c 2064 6179 3129  onth1 - 1, day1)
+00007900: 2e67 6574 5469 6d65 2829 0a20 2020 2020  .getTime().     
+00007910: 2020 2066 6f72 2065 7874 7261 6461 7920     for extraday 
+00007920: 696e 2072 616e 6765 2831 3030 293a 0a20  in range(100):. 
+00007930: 2020 2020 2020 2020 2020 2064 7432 203d             dt2 =
+00007940: 2077 696e 646f 772e 4461 7465 2879 6561   window.Date(yea
+00007950: 7232 2c20 6d6f 6e74 6832 202d 2031 2c20  r2, month2 - 1, 
+00007960: 6461 7932 202d 2065 7874 7261 6461 7929  day2 - extraday)
+00007970: 2e67 6574 5469 6d65 2829 0a20 2020 2020  .getTime().     
+00007980: 2020 2020 2020 2069 6620 6474 3120 3d3d         if dt1 ==
+00007990: 2064 7432 3a0a 2020 2020 2020 2020 2020   dt2:.          
+000079a0: 2020 2020 2020 7265 7475 726e 2065 7874        return ext
+000079b0: 7261 6461 790a 2020 2020 2020 2020 656c  raday.        el
+000079c0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000079d0: 7265 7475 726e 2030 2020 2320 6d6f 7265  return 0  # more
+000079e0: 2074 6861 6e20 3130 3020 6461 7973 202e   than 100 days .
+000079f0: 2e2e 2066 616c 6c20 6261 636b 2074 6f20  .. fall back to 
+00007a00: 7a65 726f 3f0a 0a20 2020 2064 6566 205f  zero?..    def _
+00007a10: 6765 745f 7469 6d65 2873 656c 662c 2077  get_time(self, w
+00007a20: 6861 742c 2066 616c 6c62 6163 6b3d 5472  hat, fallback=Tr
+00007a30: 7565 293a 0a20 2020 2020 2020 206e 6f64  ue):.        nod
+00007a40: 6520 3d20 7365 6c66 5b77 6861 7420 2b20  e = self[what + 
+00007a50: 2269 6e70 7574 225d 0a20 2020 2020 2020  "input"].       
+00007a60: 2068 6820 3d20 6d6d 203d 2073 7320 3d20   hh = mm = ss = 
+00007a70: 4e6f 6e65 0a20 2020 2020 2020 2069 6620  None.        if 
+00007a80: 6e6f 6465 2e76 616c 7565 3a0a 2020 2020  node.value:.    
+00007a90: 2020 2020 2020 2020 6868 2c20 6d6d 2c20          hh, mm, 
+00007aa0: 7373 203d 2075 7469 6c73 2e74 696d 6573  ss = utils.times
+00007ab0: 7472 3274 7570 6c65 286e 6f64 652e 7661  tr2tuple(node.va
+00007ac0: 6c75 6529 0a20 2020 2020 2020 2069 6620  lue).        if 
+00007ad0: 6868 2069 7320 4e6f 6e65 2061 6e64 2066  hh is None and f
+00007ae0: 616c 6c62 6163 6b3a 0a20 2020 2020 2020  allback:.       
+00007af0: 2020 2020 2069 6620 7768 6174 203d 3d20       if what == 
+00007b00: 2274 696d 6532 223a 0a20 2020 2020 2020  "time2":.       
+00007b10: 2020 2020 2020 2020 2073 656c 662e 6461           self.da
+00007b20: 7973 3220 3d20 7365 6c66 2e6f 7269 5f64  ys2 = self.ori_d
+00007b30: 6179 7332 2020 2320 7265 7374 2061 6c6f  ays2  # rest alo
+00007b40: 6e67 2077 6974 6820 7469 6d65 320a 2020  ng with time2.  
+00007b50: 2020 2020 2020 2020 2020 6868 2c20 6d6d            hh, mm
+00007b60: 2c20 7373 203d 2075 7469 6c73 2e74 696d  , ss = utils.tim
+00007b70: 6573 7472 3274 7570 6c65 2873 656c 665b  estr2tuple(self[
+00007b80: 226f 7269 5f22 202b 2077 6861 745d 290a  "ori_" + what]).
+00007b90: 2020 2020 2020 2020 7265 7475 726e 2068          return h
+00007ba0: 682c 206d 6d2c 2073 730a 0a20 2020 2064  h, mm, ss..    d
+00007bb0: 6566 205f 7374 6570 7769 7365 5f64 656c  ef _stepwise_del
+00007bc0: 7461 2873 656c 662c 206d 6d2c 2064 656c  ta(self, mm, del
+00007bd0: 7461 293a 0a20 2020 2020 2020 2069 6620  ta):.        if 
+00007be0: 6465 6c74 6120 3e3d 2030 3a0a 2020 2020  delta >= 0:.    
+00007bf0: 2020 2020 2020 2020 2320 6465 6c74 6120          # delta 
+00007c00: 6973 2070 6f73 6974 6976 2c20 6170 706c  is positiv, appl
+00007c10: 7920 6d6f 6475 6c6f 2077 6974 6820 6f66  y modulo with of
+00007c20: 6673 6574 0a20 2020 2020 2020 2020 2020  fset.           
+00007c30: 2072 6574 7572 6e20 6465 6c74 6120 2d20   return delta - 
+00007c40: 286d 6d20 2520 6465 6c74 6129 0a20 2020  (mm % delta).   
+00007c50: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00007c60: 2020 2020 2020 2023 2064 656c 7461 2069         # delta i
+00007c70: 7320 6e65 6761 7469 7665 0a20 2020 2020  s negative.     
+00007c80: 2020 2020 2020 206d 6d5f 6e65 7720 3d20         mm_new = 
+00007c90: 2d28 6d6d 2025 202d 2864 656c 7461 2929  -(mm % -(delta))
+00007ca0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00007cb0: 6d6d 5f6e 6577 203d 3d20 303a 0a20 2020  mm_new == 0:.   
+00007cc0: 2020 2020 2020 2020 2020 2020 2023 2077               # w
+00007cd0: 6520 6172 6520 616c 7265 6164 7920 6174  e are already at
+00007ce0: 2073 7465 7073 697a 652c 206a 7573 7420   stepsize, just 
+00007cf0: 7265 7475 726e 2064 656c 7461 0a20 2020  return delta.   
+00007d00: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00007d10: 7572 6e20 6465 6c74 610a 2020 2020 2020  urn delta.      
+00007d20: 2020 2020 2020 7265 7475 726e 206d 6d5f        return mm_
+00007d30: 6e65 770a 0a20 2020 2064 6566 2072 656e  new..    def ren
+00007d40: 6465 7228 7365 6c66 293a 0a20 2020 2020  der(self):.     
+00007d50: 2020 206e 6f77 203d 2064 742e 6e6f 7728     now = dt.now(
+00007d60: 290a 0a20 2020 2020 2020 2023 2047 6574  )..        # Get
+00007d70: 2064 6174 652f 7469 6d65 2069 6e66 6f0a   date/time info.
+00007d80: 2020 2020 2020 2020 7431 5f64 6174 652c          t1_date,
+00007d90: 2074 315f 7469 6d65 203d 2064 742e 7469   t1_time = dt.ti
+00007da0: 6d65 326c 6f63 616c 7374 7228 7365 6c66  me2localstr(self
+00007db0: 2e74 3129 2e73 706c 6974 2822 2022 290a  .t1).split(" ").
+00007dc0: 2020 2020 2020 2020 7432 5f64 6174 652c          t2_date,
+00007dd0: 2074 325f 7469 6d65 203d 2064 742e 7469   t2_time = dt.ti
+00007de0: 6d65 326c 6f63 616c 7374 7228 7365 6c66  me2localstr(self
+00007df0: 2e74 3229 2e73 706c 6974 2822 2022 290a  .t2).split(" ").
+00007e00: 2020 2020 2020 2020 6e6f 775f 6461 7465          now_date
+00007e10: 2c20 6e6f 775f 7469 6d65 203d 2064 742e  , now_time = dt.
+00007e20: 7469 6d65 326c 6f63 616c 7374 7228 6e6f  time2localstr(no
+00007e30: 7729 2e73 706c 6974 2822 2022 290a 0a20  w).split(" ").. 
+00007e40: 2020 2020 2020 2023 2053 6574 2064 6174         # Set dat
+00007e50: 6520 616e 6420 7469 6d65 2066 6f72 2074  e and time for t
+00007e60: 310a 2020 2020 2020 2020 7365 6c66 2e64  1.        self.d
+00007e70: 6174 6531 696e 7075 742e 7661 6c75 6520  ate1input.value 
+00007e80: 3d20 7431 5f64 6174 650a 2020 2020 2020  = t1_date.      
+00007e90: 2020 7365 6c66 2e74 696d 6531 696e 7075    self.time1inpu
+00007ea0: 742e 7661 6c75 6520 3d20 7431 5f74 696d  t.value = t1_tim
+00007eb0: 655b 3a35 5d0a 2020 2020 2020 2020 7365  e[:5].        se
+00007ec0: 6c66 2e64 6179 7332 203d 2073 656c 662e  lf.days2 = self.
+00007ed0: 5f64 6179 735f 6265 7477 6565 6e5f 6461  _days_between_da
+00007ee0: 7465 7328 7431 5f64 6174 652c 2074 325f  tes(t1_date, t2_
+00007ef0: 6461 7465 290a 0a20 2020 2020 2020 2023  date)..        #
+00007f00: 2053 6574 2073 746f 7020 7469 6d65 2061   Set stop time a
+00007f10: 6e64 2064 7572 6174 696f 6e0a 2020 2020  nd duration.    
+00007f20: 2020 2020 6966 2073 656c 662e 7431 203d      if self.t1 =
+00007f30: 3d20 7365 6c66 2e74 323a 0a20 2020 2020  = self.t2:.     
+00007f40: 2020 2020 2020 2023 2049 7320 7275 6e6e         # Is runn
+00007f50: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
+00007f60: 7420 3d20 6e6f 7720 2d20 7365 6c66 2e74  t = now - self.t
+00007f70: 310a 2020 2020 2020 2020 2020 2020 7365  1.            se
+00007f80: 6c66 2e74 696d 6532 696e 7075 742e 6469  lf.time2input.di
+00007f90: 7361 626c 6564 203d 2054 7275 650a 2020  sabled = True.  
+00007fa0: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+00007fb0: 6174 6532 696e 7075 742e 6469 7361 626c  ate2input.disabl
+00007fc0: 6564 203d 2054 7275 650a 2020 2020 2020  ed = True.      
+00007fd0: 2020 2020 2020 7365 6c66 2e64 7572 6174        self.durat
+00007fe0: 696f 6e69 6e70 7574 2e64 6973 6162 6c65  ioninput.disable
+00007ff0: 6420 3d20 5472 7565 0a20 2020 2020 2020  d = True.       
+00008000: 2020 2020 2073 656c 662e 6461 7465 3269       self.date2i
+00008010: 6e70 7574 2e76 616c 7565 203d 206e 6f77  nput.value = now
+00008020: 5f64 6174 650a 2020 2020 2020 2020 2020  _date.          
+00008030: 2020 7365 6c66 2e74 696d 6532 696e 7075    self.time2inpu
+00008040: 742e 7661 6c75 6520 3d20 2272 756e 6e69  t.value = "runni
+00008050: 6e67 220a 2020 2020 2020 2020 2020 2020  ng".            
+00008060: 7365 6c66 2e5f 7570 6461 7465 5f64 7572  self._update_dur
+00008070: 6174 696f 6e28 2920 2023 2075 7365 206d  ation()  # use m
+00008080: 6574 686f 6420 7468 6174 2077 6520 616c  ethod that we al
+00008090: 736f 2075 7365 2070 6572 696f 6469 6361  so use periodica
+000080a0: 6c6c 790a 2020 2020 2020 2020 656c 7365  lly.        else
+000080b0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+000080c0: 4973 206e 6f74 2072 756e 6e69 6e67 0a20  Is not running. 
+000080d0: 2020 2020 2020 2020 2020 2074 203d 2073             t = s
+000080e0: 656c 662e 7432 202d 2073 656c 662e 7431  elf.t2 - self.t1
+000080f0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00008100: 662e 7469 6d65 3269 6e70 7574 2e64 6973  f.time2input.dis
+00008110: 6162 6c65 6420 3d20 4661 6c73 650a 2020  abled = False.  
+00008120: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+00008130: 6174 6532 696e 7075 742e 6469 7361 626c  ate2input.disabl
+00008140: 6564 203d 2046 616c 7365 0a20 2020 2020  ed = False.     
+00008150: 2020 2020 2020 2073 656c 662e 6475 7261         self.dura
+00008160: 7469 6f6e 696e 7075 742e 6469 7361 626c  tioninput.disabl
+00008170: 6564 203d 2046 616c 7365 0a20 2020 2020  ed = False.     
+00008180: 2020 2020 2020 2073 656c 662e 6461 7465         self.date
+00008190: 3269 6e70 7574 2e76 616c 7565 203d 2074  2input.value = t
+000081a0: 325f 6461 7465 0a20 2020 2020 2020 2020  2_date.         
+000081b0: 2020 2073 656c 662e 7469 6d65 3269 6e70     self.time2inp
+000081c0: 7574 2e76 616c 7565 203d 2074 325f 7469  ut.value = t2_ti
+000081d0: 6d65 5b3a 355d 0a20 2020 2020 2020 2020  me[:5].         
+000081e0: 2020 206d 203d 204d 6174 682e 726f 756e     m = Math.roun
+000081f0: 6428 7420 2f20 3630 290a 2020 2020 2020  d(t / 60).      
+00008200: 2020 2020 2020 7365 6c66 2e64 7572 6174        self.durat
+00008210: 696f 6e69 6e70 7574 2e76 616c 7565 203d  ioninput.value =
+00008220: 2066 227b 6d2f 2f36 303a 2e30 667d 6820   f"{m//60:.0f}h 
+00008230: 7b6d 2536 303a 3032 2e30 667d 6d22 0a0a  {m%60:02.0f}m"..
+00008240: 2020 2020 2020 2020 2320 5477 6561 6b20          # Tweak 
+00008250: 6267 636f 6c6f 7220 6f66 2064 6174 6532  bgcolor of date2
+00008260: 2066 6965 6c64 2074 6f20 6869 6465 2069   field to hide i
+00008270: 7420 6120 6269 740a 2020 2020 2020 2020  t a bit.        
+00008280: 6966 2073 656c 662e 6461 7973 3220 3d3d  if self.days2 ==
+00008290: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+000082a0: 7365 6c66 2e64 6174 6532 696e 7075 742e  self.date2input.
+000082b0: 7374 796c 652e 636f 6c6f 7220 3d20 2223  style.color = "#
+000082c0: 3838 3822 0a20 2020 2020 2020 2065 6c73  888".        els
+000082d0: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+000082e0: 656c 662e 6461 7465 3269 6e70 7574 2e73  elf.date2input.s
+000082f0: 7479 6c65 2e63 6f6c 6f72 203d 204e 6f6e  tyle.color = Non
+00008300: 650a 0a20 2020 2064 6566 206f 6e63 6861  e..    def oncha
+00008310: 6e67 6564 2873 656c 662c 2061 6374 696f  nged(self, actio
+00008320: 6e29 3a0a 2020 2020 2020 2020 2320 7374  n):.        # st
+00008330: 6570 2073 697a 6520 7573 6564 2066 6f72  ep size used for
+00008340: 2074 696d 6520 6275 7474 6f6e 730a 2020   time buttons.  
+00008350: 2020 2020 2020 5f73 7465 7073 697a 6520        _stepsize 
+00008360: 3d20 350a 0a20 2020 2020 2020 206e 6f77  = 5..        now
+00008370: 203d 2064 742e 6e6f 7728 290a 0a20 2020   = dt.now()..   
+00008380: 2020 2020 2023 2047 6574 206e 6f64 650a       # Get node.
+00008390: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
+000083a0: 2020 2020 2020 2020 2061 6374 696f 6e2e           action.
+000083b0: 656e 6473 5769 7468 2822 6d6f 7265 2229  endsWith("more")
+000083c0: 0a20 2020 2020 2020 2020 2020 206f 7220  .            or 
+000083d0: 6163 7469 6f6e 2e65 6e64 7357 6974 6828  action.endsWith(
+000083e0: 226c 6573 7322 290a 2020 2020 2020 2020  "less").        
+000083f0: 2020 2020 6f72 2061 6374 696f 6e2e 656e      or action.en
+00008400: 6473 7769 7468 2822 6661 7374 2229 0a20  dswith("fast"). 
+00008410: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
+00008420: 2020 2020 2020 7768 6174 203d 2061 6374        what = act
+00008430: 696f 6e5b 3a2d 345d 0a20 2020 2020 2020  ion[:-4].       
+00008440: 2020 2020 206f 7074 696f 6e20 3d20 6163       option = ac
+00008450: 7469 6f6e 5b2d 343a 5d0a 2020 2020 2020  tion[-4:].      
+00008460: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00008470: 2020 2020 7768 6174 203d 2061 6374 696f      what = actio
+00008480: 6e0a 2020 2020 2020 2020 2020 2020 6f70  n.            op
+00008490: 7469 6f6e 203d 2022 220a 2020 2020 2020  tion = "".      
+000084a0: 2020 6e6f 6465 203d 2073 656c 665b 7768    node = self[wh
+000084b0: 6174 202b 2022 696e 7075 7422 5d0a 2020  at + "input"].  
+000084c0: 2020 2020 2020 6966 206e 6f74 206e 6f64        if not nod
+000084d0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+000084e0: 6574 7572 6e0a 0a20 2020 2020 2020 2063  eturn..        c
+000084f0: 616c 6c5f 6361 6c6c 6261 636b 203d 2054  all_callback = T
+00008500: 7275 650a 0a20 2020 2020 2020 2023 2047  rue..        # G
+00008510: 6574 2074 6865 2072 6566 6572 656e 6365  et the reference
+00008520: 2064 6174 6573 0a20 2020 2020 2020 2069   dates.        i
+00008530: 6620 7365 6c66 2e64 6174 6531 696e 7075  f self.date1inpu
+00008540: 742e 7661 6c75 653a 0a20 2020 2020 2020  t.value:.       
+00008550: 2020 2020 2079 6561 7231 2c20 6d6f 6e74       year1, mont
+00008560: 6831 2c20 6461 7931 203d 2073 656c 662e  h1, day1 = self.
+00008570: 6461 7465 3169 6e70 7574 2e76 616c 7565  date1input.value
+00008580: 2e73 706c 6974 2822 2d22 290a 2020 2020  .split("-").    
+00008590: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000085a0: 2020 2020 2020 7965 6172 312c 206d 6f6e        year1, mon
+000085b0: 7468 312c 2064 6179 3120 3d20 7365 6c66  th1, day1 = self
+000085c0: 2e6f 7269 5f64 6174 6531 2e73 706c 6974  .ori_date1.split
+000085d0: 2822 2d22 290a 2020 2020 2020 2020 7965  ("-").        ye
+000085e0: 6172 312c 206d 6f6e 7468 312c 2064 6179  ar1, month1, day
+000085f0: 3120 3d20 696e 7428 7965 6172 3129 2c20  1 = int(year1), 
+00008600: 696e 7428 6d6f 6e74 6831 292c 2069 6e74  int(month1), int
+00008610: 2864 6179 3129 0a20 2020 2020 2020 2023  (day1).        #
+00008620: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00008630: 2e64 6174 6532 696e 7075 742e 7661 6c75  .date2input.valu
+00008640: 653a 0a20 2020 2020 2020 2020 2020 2079  e:.            y
+00008650: 6561 7232 2c20 6d6f 6e74 6832 2c20 6461  ear2, month2, da
+00008660: 7932 203d 2073 656c 662e 6461 7465 3269  y2 = self.date2i
+00008670: 6e70 7574 2e76 616c 7565 2e73 706c 6974  nput.value.split
+00008680: 2822 2d22 290a 2020 2020 2020 2020 656c  ("-").        el
+00008690: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000086a0: 7965 6172 322c 206d 6f6e 7468 322c 2064  year2, month2, d
+000086b0: 6179 3220 3d20 7365 6c66 2e6f 7269 5f64  ay2 = self.ori_d
+000086c0: 6174 6532 2e73 706c 6974 2822 2d22 290a  ate2.split("-").
+000086d0: 2020 2020 2020 2020 7965 6172 322c 206d          year2, m
+000086e0: 6f6e 7468 322c 2064 6179 3220 3d20 696e  onth2, day2 = in
+000086f0: 7428 7965 6172 3229 2c20 696e 7428 6d6f  t(year2), int(mo
+00008700: 6e74 6832 292c 2069 6e74 2864 6179 3229  nth2), int(day2)
+00008710: 0a0a 2020 2020 2020 2020 6966 2077 6861  ..        if wha
+00008720: 7420 3d3d 2022 6461 7465 3122 3a0a 2020  t == "date1":.  
+00008730: 2020 2020 2020 2020 2020 2320 4368 616e            # Chan
+00008740: 6769 6e67 2064 6174 6531 202d 3e20 7570  ging date1 -> up
+00008750: 6461 7465 2062 6f74 6820 7431 2061 6e64  date both t1 and
+00008760: 2074 322c 2064 6174 6532 206d 6f76 6573   t2, date2 moves
+00008770: 2061 6c6f 6e67 0a20 2020 2020 2020 2020   along.         
+00008780: 2020 2068 682c 206d 6d2c 2073 7320 3d20     hh, mm, ss = 
+00008790: 7365 6c66 2e5f 6765 745f 7469 6d65 2822  self._get_time("
+000087a0: 7469 6d65 3122 290a 2020 2020 2020 2020  time1").        
+000087b0: 2020 2020 6431 203d 2077 696e 646f 772e      d1 = window.
+000087c0: 4461 7465 2879 6561 7231 2c20 6d6f 6e74  Date(year1, mont
+000087d0: 6831 202d 2031 2c20 6461 7931 2c20 6868  h1 - 1, day1, hh
+000087e0: 2c20 6d6d 2c20 7373 290a 2020 2020 2020  , mm, ss).      
+000087f0: 2020 2020 2020 6868 2c20 6d6d 2c20 7373        hh, mm, ss
+00008800: 203d 2073 656c 662e 5f67 6574 5f74 696d   = self._get_tim
+00008810: 6528 2274 696d 6532 2229 0a20 2020 2020  e("time2").     
+00008820: 2020 2020 2020 2064 3220 3d20 7769 6e64         d2 = wind
+00008830: 6f77 2e44 6174 6528 7965 6172 312c 206d  ow.Date(year1, m
+00008840: 6f6e 7468 3120 2d20 312c 2064 6179 3120  onth1 - 1, day1 
+00008850: 2b20 7365 6c66 2e64 6179 7332 2c20 6868  + self.days2, hh
+00008860: 2c20 6d6d 2c20 7373 290a 2020 2020 2020  , mm, ss).      
+00008870: 2020 2020 2020 7365 6c66 2e74 3120 3d20        self.t1 = 
+00008880: 6474 2e74 6f5f 7469 6d65 5f69 6e74 2864  dt.to_time_int(d
+00008890: 3129 0a20 2020 2020 2020 2020 2020 2073  1).            s
+000088a0: 656c 662e 7432 203d 2064 742e 746f 5f74  elf.t2 = dt.to_t
+000088b0: 696d 655f 696e 7428 6432 290a 2020 2020  ime_int(d2).    
+000088c0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+000088d0: 6f72 695f 7431 203d 3d20 7365 6c66 2e6f  ori_t1 == self.o
+000088e0: 7269 5f74 323a 0a20 2020 2020 2020 2020  ri_t2:.         
+000088f0: 2020 2020 2020 2073 656c 662e 7432 203d         self.t2 =
+00008900: 2073 656c 662e 7431 0a20 2020 2020 2020   self.t1.       
+00008910: 2020 2020 2065 6c69 6620 7365 6c66 2e74       elif self.t
+00008920: 3120 3e3d 2073 656c 662e 7432 3a0a 2020  1 >= self.t2:.  
+00008930: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00008940: 6c66 2e74 3220 3d20 7365 6c66 2e74 3120  lf.t2 = self.t1 
+00008950: 2b20 310a 0a20 2020 2020 2020 2065 6c69  + 1..        eli
+00008960: 6620 7768 6174 203d 3d20 2264 6174 6532  f what == "date2
+00008970: 223a 0a20 2020 2020 2020 2020 2020 2023  ":.            #
+00008980: 2043 6861 6e67 696e 6720 6461 7465 3220   Changing date2 
+00008990: 2d3e 2075 7064 6174 6520 6f6e 6c79 2074  -> update only t
+000089a0: 320a 2020 2020 2020 2020 2020 2020 6868  2.            hh
+000089b0: 2c20 6d6d 2c20 7373 203d 2073 656c 662e  , mm, ss = self.
+000089c0: 5f67 6574 5f74 696d 6528 2274 696d 6532  _get_time("time2
+000089d0: 2229 0a20 2020 2020 2020 2020 2020 2064  ").            d
+000089e0: 3220 3d20 7769 6e64 6f77 2e44 6174 6528  2 = window.Date(
+000089f0: 7965 6172 322c 206d 6f6e 7468 3220 2d20  year2, month2 - 
+00008a00: 312c 2064 6179 322c 2068 682c 206d 6d2c  1, day2, hh, mm,
+00008a10: 2073 7329 0a20 2020 2020 2020 2020 2020   ss).           
+00008a20: 2073 656c 662e 7432 203d 2064 742e 746f   self.t2 = dt.to
+00008a30: 5f74 696d 655f 696e 7428 6432 290a 2020  _time_int(d2).  
+00008a40: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00008a50: 662e 6f72 695f 7431 203d 3d20 7365 6c66  f.ori_t1 == self
+00008a60: 2e6f 7269 5f74 323a 0a20 2020 2020 2020  .ori_t2:.       
+00008a70: 2020 2020 2020 2020 2073 656c 662e 7432           self.t2
+00008a80: 203d 2073 656c 662e 7431 0a20 2020 2020   = self.t1.     
+00008a90: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
+00008aa0: 2e74 3220 3c3d 2073 656c 662e 7431 3a0a  .t2 <= self.t1:.
+00008ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008ac0: 7365 6c66 2e74 3220 3d20 7365 6c66 2e74  self.t2 = self.t
+00008ad0: 3120 2b20 3630 0a0a 2020 2020 2020 2020  1 + 60..        
+00008ae0: 656c 6966 2077 6861 7420 3d3d 2022 7469  elif what == "ti
+00008af0: 6d65 3122 3a0a 2020 2020 2020 2020 2020  me1":.          
+00008b00: 2020 2320 4368 616e 6769 6e67 2074 696d    # Changing tim
+00008b10: 6531 202d 3e20 7570 6461 7465 2074 312c  e1 -> update t1,
+00008b20: 206b 6565 7020 7432 2069 6e20 6368 6563   keep t2 in chec
+00008b30: 6b0a 2020 2020 2020 2020 2020 2020 6966  k.            if
+00008b40: 206f 7074 696f 6e20 3d3d 2022 6661 7374   option == "fast
+00008b50: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+00008b60: 2020 2068 682c 206d 6d2c 2073 7320 3d20     hh, mm, ss = 
+00008b70: 7365 6c66 2e5f 6765 745f 7469 6d65 2822  self._get_time("
+00008b80: 7469 6d65 3122 2c20 4661 6c73 6529 0a20  time1", False). 
+00008b90: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00008ba0: 6620 6868 2069 7320 6e6f 7420 4e6f 6e65  f hh is not None
+00008bb0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00008bc0: 2020 2020 2020 6431 203d 2077 696e 646f        d1 = windo
+00008bd0: 772e 4461 7465 2879 6561 7231 2c20 6d6f  w.Date(year1, mo
+00008be0: 6e74 6831 202d 2031 2c20 6461 7931 2c20  nth1 - 1, day1, 
+00008bf0: 6868 2c20 6d6d 2c20 7373 290a 2020 2020  hh, mm, ss).    
+00008c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008c10: 7365 6c66 2e74 3120 3d20 6474 2e74 6f5f  self.t1 = dt.to_
+00008c20: 7469 6d65 5f69 6e74 2864 3129 0a20 2020  time_int(d1).   
+00008c30: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00008c40: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00008c50: 2020 2020 2020 2063 616c 6c5f 6361 6c6c         call_call
+00008c60: 6261 636b 203d 2046 616c 7365 0a20 2020  back = False.   
+00008c70: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00008c80: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+00008c90: 682c 206d 6d2c 2073 7320 3d20 7365 6c66  h, mm, ss = self
+00008ca0: 2e5f 6765 745f 7469 6d65 2822 7469 6d65  ._get_time("time
+00008cb0: 3122 290a 2020 2020 2020 2020 2020 2020  1").            
+00008cc0: 2020 2020 6966 206f 7074 696f 6e20 3d3d      if option ==
+00008cd0: 2022 6d6f 7265 223a 0a20 2020 2020 2020   "more":.       
+00008ce0: 2020 2020 2020 2020 2020 2020 206d 6d2c               mm,
+00008cf0: 2073 7320 3d20 6d6d 202b 2073 656c 662e   ss = mm + self.
+00008d00: 5f73 7465 7077 6973 655f 6465 6c74 6128  _stepwise_delta(
+00008d10: 6d6d 2c20 5f73 7465 7073 697a 6529 2c20  mm, _stepsize), 
+00008d20: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
+00008d30: 2020 656c 6966 206f 7074 696f 6e20 3d3d    elif option ==
+00008d40: 2022 6c65 7373 223a 0a20 2020 2020 2020   "less":.       
+00008d50: 2020 2020 2020 2020 2020 2020 206d 6d2c               mm,
+00008d60: 2073 7320 3d20 6d6d 202b 2073 656c 662e   ss = mm + self.
+00008d70: 5f73 7465 7077 6973 655f 6465 6c74 6128  _stepwise_delta(
+00008d80: 6d6d 2c20 2d28 5f73 7465 7073 697a 6529  mm, -(_stepsize)
+00008d90: 292c 2030 0a20 2020 2020 2020 2020 2020  ), 0.           
+00008da0: 2020 2020 2064 3120 3d20 7769 6e64 6f77       d1 = window
+00008db0: 2e44 6174 6528 7965 6172 312c 206d 6f6e  .Date(year1, mon
+00008dc0: 7468 3120 2d20 312c 2064 6179 312c 2068  th1 - 1, day1, h
+00008dd0: 682c 206d 6d2c 2073 7329 0a20 2020 2020  h, mm, ss).     
+00008de0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00008df0: 7431 203d 2064 742e 746f 5f74 696d 655f  t1 = dt.to_time_
+00008e00: 696e 7428 6431 290a 2020 2020 2020 2020  int(d1).        
+00008e10: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00008e20: 6f72 695f 7431 203d 3d20 7365 6c66 2e6f  ori_t1 == self.o
+00008e30: 7269 5f74 323a 0a20 2020 2020 2020 2020  ri_t2:.         
+00008e40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00008e50: 7432 203d 2073 656c 662e 7431 203d 206d  t2 = self.t1 = m
+00008e60: 696e 2873 656c 662e 7431 2c20 6e6f 7729  in(self.t1, now)
+00008e70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008e80: 2065 6c69 6620 7365 6c66 2e74 3120 3e3d   elif self.t1 >=
+00008e90: 2073 656c 662e 7432 3a0a 2020 2020 2020   self.t2:.      
+00008ea0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00008eb0: 6c66 2e74 3220 3d20 7365 6c66 2e74 3120  lf.t2 = self.t1 
+00008ec0: 2b20 310a 0a20 2020 2020 2020 2065 6c69  + 1..        eli
+00008ed0: 6620 7768 6174 203d 3d20 2274 696d 6532  f what == "time2
+00008ee0: 223a 0a20 2020 2020 2020 2020 2020 2023  ":.            #
+00008ef0: 2043 6861 6e67 696e 6720 7469 6d65 3220   Changing time2 
+00008f00: 2d3e 2075 7064 6174 6520 7432 2c20 6b65  -> update t2, ke
+00008f10: 6570 2074 3120 616e 6420 7432 2069 6e20  ep t1 and t2 in 
+00008f20: 6368 6563 6b0a 2020 2020 2020 2020 2020  check.          
+00008f30: 2020 6966 206f 7074 696f 6e20 3d3d 2022    if option == "
+00008f40: 6661 7374 223a 0a20 2020 2020 2020 2020  fast":.         
+00008f50: 2020 2020 2020 2068 682c 206d 6d2c 2073         hh, mm, s
+00008f60: 7320 3d20 7365 6c66 2e5f 6765 745f 7469  s = self._get_ti
+00008f70: 6d65 2822 7469 6d65 3222 2c20 4661 6c73  me("time2", Fals
+00008f80: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00008f90: 2020 2069 6620 6868 2069 7320 6e6f 7420     if hh is not 
+00008fa0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00008fb0: 2020 2020 2020 2020 2020 6432 203d 2077            d2 = w
+00008fc0: 696e 646f 772e 4461 7465 2879 6561 7232  indow.Date(year2
+00008fd0: 2c20 6d6f 6e74 6832 202d 2031 2c20 6461  , month2 - 1, da
+00008fe0: 7932 2c20 6868 2c20 6d6d 2c20 7373 290a  y2, hh, mm, ss).
+00008ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009000: 2020 2020 7365 6c66 2e74 3220 3d20 6474      self.t2 = dt
+00009010: 2e74 6f5f 7469 6d65 5f69 6e74 2864 3229  .to_time_int(d2)
+00009020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009030: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00009040: 2020 2020 2020 2020 2020 2063 616c 6c5f             call_
+00009050: 6361 6c6c 6261 636b 203d 2046 616c 7365  callback = False
+00009060: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00009070: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00009080: 2020 2068 682c 206d 6d2c 2073 7320 3d20     hh, mm, ss = 
+00009090: 7365 6c66 2e5f 6765 745f 7469 6d65 2822  self._get_time("
+000090a0: 7469 6d65 3222 290a 2020 2020 2020 2020  time2").        
+000090b0: 2020 2020 2020 2020 6966 206f 7074 696f          if optio
+000090c0: 6e20 3d3d 2022 6d6f 7265 223a 0a20 2020  n == "more":.   
+000090d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000090e0: 206d 6d2c 2073 7320 3d20 6d6d 202b 2073   mm, ss = mm + s
+000090f0: 656c 662e 5f73 7465 7077 6973 655f 6465  elf._stepwise_de
+00009100: 6c74 6128 6d6d 2c20 5f73 7465 7073 697a  lta(mm, _stepsiz
+00009110: 6529 2c20 300a 2020 2020 2020 2020 2020  e), 0.          
+00009120: 2020 2020 2020 656c 6966 206f 7074 696f        elif optio
+00009130: 6e20 3d3d 2022 6c65 7373 223a 0a20 2020  n == "less":.   
+00009140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009150: 206d 6d2c 2073 7320 3d20 6d6d 202b 2073   mm, ss = mm + s
+00009160: 656c 662e 5f73 7465 7077 6973 655f 6465  elf._stepwise_de
+00009170: 6c74 6128 6d6d 2c20 2d28 5f73 7465 7073  lta(mm, -(_steps
+00009180: 697a 6529 292c 2030 0a20 2020 2020 2020  ize)), 0.       
+00009190: 2020 2020 2020 2020 2064 3220 3d20 7769           d2 = wi
+000091a0: 6e64 6f77 2e44 6174 6528 7965 6172 322c  ndow.Date(year2,
+000091b0: 206d 6f6e 7468 3220 2d20 312c 2064 6179   month2 - 1, day
+000091c0: 322c 2068 682c 206d 6d2c 2073 7329 0a20  2, hh, mm, ss). 
+000091d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000091e0: 656c 662e 7432 203d 2064 742e 746f 5f74  elf.t2 = dt.to_t
+000091f0: 696d 655f 696e 7428 6432 290a 2020 2020  ime_int(d2).    
+00009200: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00009210: 656c 662e 6f72 695f 7431 203d 3d20 7365  elf.ori_t1 == se
+00009220: 6c66 2e6f 7269 5f74 323a 0a20 2020 2020  lf.ori_t2:.     
+00009230: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00009240: 656c 662e 7432 203d 2073 656c 662e 7431  elf.t2 = self.t1
+00009250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009260: 2065 6c69 6620 7365 6c66 2e74 3220 3c3d   elif self.t2 <=
+00009270: 2073 656c 662e 7431 3a0a 2020 2020 2020   self.t1:.      
+00009280: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00009290: 6c66 2e74 3120 3d20 7365 6c66 2e74 320a  lf.t1 = self.t2.
+000092a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000092b0: 2020 2020 7365 6c66 2e74 3220 3d20 7365      self.t2 = se
+000092c0: 6c66 2e74 3120 2b20 310a 0a20 2020 2020  lf.t1 + 1..     
+000092d0: 2020 2065 6c69 6620 7768 6174 203d 3d20     elif what == 
+000092e0: 2264 7572 6174 696f 6e22 3a0a 2020 2020  "duration":.    
+000092f0: 2020 2020 2020 2020 2320 4368 616e 6769          # Changi
+00009300: 6e67 2064 7572 6174 696f 6e20 2d3e 2075  ng duration -> u
+00009310: 7064 6174 6520 7432 2c20 6275 7420 6b65  pdate t2, but ke
+00009320: 6570 2069 7420 696e 2063 6865 636b 0a20  ep it in check. 
+00009330: 2020 2020 2020 2020 2020 2068 682c 206d             hh, m
+00009340: 6d2c 2073 7320 3d20 7365 6c66 2e5f 6765  m, ss = self._ge
+00009350: 745f 7469 6d65 2822 6475 7261 7469 6f6e  t_time("duration
+00009360: 2229 0a20 2020 2020 2020 2020 2020 2064  ").            d
+00009370: 7572 6174 696f 6e20 3d20 6868 202a 2033  uration = hh * 3
+00009380: 3630 3020 2b20 6d6d 202a 2036 3020 2b20  600 + mm * 60 + 
+00009390: 7373 0a20 2020 2020 2020 2020 2020 2023  ss.            #
+000093a0: 2041 7070 6c79 0a20 2020 2020 2020 2020   Apply.         
+000093b0: 2020 2069 6620 7365 6c66 2e6f 7269 5f74     if self.ori_t
+000093c0: 3120 3d3d 2073 656c 662e 6f72 695f 7432  1 == self.ori_t2
+000093d0: 3a20 2023 2066 6169 6c73 6166 6520 2d20  :  # failsafe - 
+000093e0: 6b65 6570 2072 756e 6e69 6e67 0a20 2020  keep running.   
+000093f0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00009400: 662e 6475 7261 7469 6f6e 203d 2030 0a20  f.duration = 0. 
+00009410: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00009420: 656c 662e 7432 203d 2073 656c 662e 7431  elf.t2 = self.t1
+00009430: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+00009440: 6620 6475 7261 7469 6f6e 203c 2030 3a0a  f duration < 0:.
+00009450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009460: 7365 6c66 2e74 3120 2b3d 2064 7572 6174  self.t1 += durat
+00009470: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
+00009480: 2020 2020 7365 6c66 2e74 3220 3d20 7365      self.t2 = se
+00009490: 6c66 2e74 3120 2b20 310a 2020 2020 2020  lf.t1 + 1.      
+000094a0: 2020 2020 2020 656c 6966 206e 6f74 2064        elif not d
+000094b0: 7572 6174 696f 6e3a 2020 2320 4b65 6570  uration:  # Keep
+000094c0: 206e 6f74 2d72 756e 6e69 6e67 0a20 2020   not-running.   
+000094d0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000094e0: 662e 7432 203d 2073 656c 662e 7431 202b  f.t2 = self.t1 +
+000094f0: 2031 0a20 2020 2020 2020 2020 2020 2065   1.            e
+00009500: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00009510: 2020 2020 2073 656c 662e 7432 203d 2073       self.t2 = s
+00009520: 656c 662e 7431 202b 2064 7572 6174 696f  elf.t1 + duratio
+00009530: 6e0a 0a20 2020 2020 2020 2023 2049 6e76  n..        # Inv
+00009540: 6f6b 6520 6361 6c6c 6261 636b 2061 6e64  oke callback and
+00009550: 2072 6572 656e 6465 720a 2020 2020 2020   rerender.      
+00009560: 2020 6966 2063 616c 6c5f 6361 6c6c 6261    if call_callba
+00009570: 636b 3a0a 2020 2020 2020 2020 2020 2020  ck:.            
+00009580: 7769 6e64 6f77 2e73 6574 5469 6d65 6f75  window.setTimeou
+00009590: 7428 7365 6c66 2e63 616c 6c62 6163 6b2c  t(self.callback,
+000095a0: 2031 290a 0a20 2020 2020 2020 2069 6620   1)..        if 
+000095b0: 6163 7469 6f6e 2e65 6e64 7377 6974 6828  action.endswith(
+000095c0: 2266 6173 7422 293a 0a20 2020 2020 2020  "fast"):.       
+000095d0: 2020 2020 2073 656c 662e 5f75 7064 6174       self._updat
+000095e0: 655f 6475 7261 7469 6f6e 2854 7275 6529  e_duration(True)
+000095f0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00009600: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00009610: 6e20 7365 6c66 2e72 656e 6465 7228 290a  n self.render().
+00009620: 0a0a 636f 6d70 6c65 7465 725f 616c 6c5f  ..completer_all_
+00009630: 7461 6773 203d 204e 6f6e 650a 0a0a 636c  tags = None...cl
+00009640: 6173 7320 4175 746f 636f 6d70 6c65 7465  ass Autocomplete
+00009650: 723a 0a20 2020 2022 2222 4865 6c70 6572  r:.    """Helper
+00009660: 2063 6c61 7373 2074 6f20 6175 746f 636f   class to autoco
+00009670: 6d70 6c65 7465 2074 6167 732e 2222 220a  mplete tags.""".
+00009680: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+00009690: 5f28 7365 6c66 2c20 6469 762c 2069 6e70  _(self, div, inp
+000096a0: 7574 2c20 6361 6c6c 6261 636b 2c20 6d6f  ut, callback, mo
+000096b0: 6465 5f6d 6173 6b3d 3135 293a 0a20 2020  de_mask=15):.   
+000096c0: 2020 2020 2073 656c 662e 5f64 6976 203d       self._div =
+000096d0: 2064 6976 0a20 2020 2020 2020 2073 656c   div.        sel
+000096e0: 662e 5f69 6e70 7574 203d 2069 6e70 7574  f._input = input
+000096f0: 0a20 2020 2020 2020 2073 656c 662e 5f63  .        self._c
+00009700: 616c 6c62 6163 6b20 3d20 6361 6c6c 6261  allback = callba
+00009710: 636b 0a20 2020 2020 2020 2073 656c 662e  ck.        self.
+00009720: 5f6d 6f64 655f 6d61 736b 203d 206d 6f64  _mode_mask = mod
+00009730: 655f 6d61 736b 2020 2320 313a 2061 6c6c  e_mask  # 1: all
+00009740: 2c20 323a 2074 6167 732c 2034 3a20 7072  , 2: tags, 4: pr
+00009750: 6573 6574 732c 2038 3a20 6465 7363 7269  esets, 8: descri
+00009760: 7074 696f 6e73 0a0a 2020 2020 2020 2020  ptions..        
+00009770: 7365 6c66 2e63 6c65 6172 2829 0a20 2020  self.clear().   
+00009780: 2020 2020 2073 656c 662e 5f73 7461 7465       self._state
+00009790: 203d 2022 222c 2030 2c20 300a 0a20 2020   = "", 0, 0..   
+000097a0: 2020 2020 2023 2053 7567 6765 7374 6564       # Suggested
+000097b0: 2074 6167 730a 2020 2020 2020 2020 7265   tags.        re
+000097c0: 6365 6e74 5f64 732c 2072 6563 656e 745f  cent_ds, recent_
+000097d0: 7461 6773 203d 2073 656c 662e 5f67 6574  tags = self._get
+000097e0: 5f73 7567 6765 7374 6564 5f72 6563 656e  _suggested_recen
+000097f0: 7473 2829 0a20 2020 2020 2020 2073 656c  ts().        sel
+00009800: 662e 5f73 7567 6765 7374 6564 5f64 735f  f._suggested_ds_
+00009810: 7265 6365 6e74 203d 2072 6563 656e 745f  recent = recent_
+00009820: 6473 2020 2320 6465 7363 7269 7074 696f  ds  # descriptio
+00009830: 6e73 0a20 2020 2020 2020 2073 656c 662e  ns.        self.
+00009840: 5f73 7567 6765 7374 6564 5f74 6167 735f  _suggested_tags_
+00009850: 7265 6365 6e74 203d 2072 6563 656e 745f  recent = recent_
+00009860: 7461 6773 0a20 2020 2020 2020 2073 656c  tags.        sel
+00009870: 662e 5f73 7567 6765 7374 6564 5f74 6167  f._suggested_tag
+00009880: 735f 636f 6d62 696e 6564 203d 2073 656c  s_combined = sel
+00009890: 662e 5f67 6574 5f73 7567 6765 7374 6564  f._get_suggested
+000098a0: 5f74 6167 735f 636f 6d62 696e 6564 2829  _tags_combined()
+000098b0: 0a20 2020 2020 2020 2073 656c 662e 5f73  .        self._s
+000098c0: 7567 6765 7374 6564 5f74 6167 735f 7072  uggested_tags_pr
+000098d0: 6573 6574 7320 3d20 5b5d 0a0a 2020 2020  esets = []..    
+000098e0: 2020 2020 2320 4375 7272 656e 7420 7375      # Current su
+000098f0: 6767 6573 7469 6f6e 0a20 2020 2020 2020  ggestion.       
+00009900: 2073 656c 662e 5f73 7567 6765 7374 6564   self._suggested
+00009910: 5f74 6167 735f 696e 5f61 7574 6f63 6f6d  _tags_in_autocom
+00009920: 7020 3d20 5b5d 0a0a 2020 2020 2020 2020  p = []..        
+00009930: 7769 6e64 6f77 2e5f 6175 746f 636f 6d70  window._autocomp
+00009940: 5f66 696e 6973 6820 3d20 7365 6c66 2e5f  _finish = self._
+00009950: 6669 6e69 7368 5f63 620a 0a20 2020 2064  finish_cb..    d
+00009960: 6566 2063 6c6f 7365 2873 656c 6629 3a0a  ef close(self):.
+00009970: 2020 2020 2020 2020 7365 6c66 2e5f 6469          self._di
+00009980: 7620 3d20 4e6f 6e65 0a20 2020 2020 2020  v = None.       
+00009990: 2073 656c 662e 5f69 6e70 7574 203d 204e   self._input = N
+000099a0: 6f6e 650a 2020 2020 2020 2020 7365 6c66  one.        self
+000099b0: 2e5f 6361 6c6c 6261 636b 203d 204e 6f6e  ._callback = Non
+000099c0: 650a 0a20 2020 2064 6566 2063 6c65 6172  e..    def clear
+000099d0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+000099e0: 7365 6c66 2e5f 696e 6465 7820 3d20 300a  self._index = 0.
+000099f0: 2020 2020 2020 2020 7365 6c66 2e5f 6163          self._ac
+00009a00: 7469 7665 5f73 7567 6765 7374 696f 6e20  tive_suggestion 
+00009a10: 3d20 2222 0a20 2020 2020 2020 2069 6620  = "".        if 
+00009a20: 7365 6c66 2e5f 6469 763a 0a20 2020 2020  self._div:.     
+00009a30: 2020 2020 2020 2073 656c 662e 5f64 6976         self._div
+00009a40: 2e68 6964 6465 6e20 3d20 5472 7565 0a20  .hidden = True. 
+00009a50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00009a60: 5f64 6976 2e69 6e6e 6572 4854 4d4c 203d  _div.innerHTML =
+00009a70: 2022 220a 2020 2020 2020 2020 656c 7365   "".        else
+00009a80: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
+00009a90: 7373 2020 2320 636c 6561 7220 6361 6e20  ss  # clear can 
+00009aa0: 6265 2063 616c 6c65 6420 7768 656e 2074  be called when t
+00009ab0: 6865 2063 6f6d 706c 6574 6572 2068 6173  he completer has
+00009ac0: 2062 6565 6e20 636c 6f73 6564 0a0a 2020   been closed..  
+00009ad0: 2020 6465 6620 696e 6974 2873 656c 6629    def init(self)
+00009ae0: 3a0a 2020 2020 2020 2020 2222 2253 686f  :.        """Sho
+00009af0: 7720 7461 6720 7375 6767 6573 7469 6f6e  w tag suggestion
+00009b00: 7320 696e 2074 6865 2061 7574 6f63 6f6d  s in the autocom
+00009b10: 706c 6574 696f 6e20 6469 616c 6f67 2e22  pletion dialog."
+00009b20: 2222 0a0a 2020 2020 2020 2020 2320 4765  ""..        # Ge
+00009b30: 7420 7061 7274 6961 6c20 7461 6720 6265  t partial tag be
+00009b40: 696e 6720 7772 6974 7465 6e0a 2020 2020  ing written.    
+00009b50: 2020 2020 7365 6c66 2e5f 7374 6174 6520      self._state 
+00009b60: 3d20 7365 6c66 2e5f 6765 745f 7374 6174  = self._get_stat
+00009b70: 6528 290a 2020 2020 2020 2020 7661 6c2c  e().        val,
+00009b80: 2069 312c 2069 3220 3d20 7365 6c66 2e5f   i1, i2 = self._
+00009b90: 7374 6174 650a 2020 2020 2020 2020 7461  state.        ta
+00009ba0: 675f 746f 5f62 6520 3d20 7661 6c5b 6931  g_to_be = val[i1
+00009bb0: 3a69 325d 2e74 6f4c 6f77 6572 4361 7365  :i2].toLowerCase
+00009bc0: 2829 0a0a 2020 2020 2020 2020 2320 4765  ()..        # Ge
+00009bd0: 7420 7768 6174 2074 6f20 7368 6f77 0a20  t what to show. 
+00009be0: 2020 2020 2020 2073 686f 775f 6465 7363         show_desc
+00009bf0: 7269 7074 696f 6e73 203d 2073 686f 775f  riptions = show_
+00009c00: 7461 6773 203d 2073 686f 775f 7072 6573  tags = show_pres
+00009c10: 6574 7320 3d20 4661 6c73 650a 2020 2020  ets = False.    
+00009c20: 2020 2020 6966 2074 6167 5f74 6f5f 6265      if tag_to_be
+00009c30: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00009c40: 2069 3120 3e20 3020 616e 6420 7661 6c5b   i1 > 0 and val[
+00009c50: 6931 202d 2031 5d20 3d3d 2022 2322 2061  i1 - 1] == "#" a
+00009c60: 6e64 2028 3420 2620 7365 6c66 2e5f 6d6f  nd (4 & self._mo
+00009c70: 6465 5f6d 6173 6b29 3a0a 2020 2020 2020  de_mask):.      
+00009c80: 2020 2020 2020 2020 2020 7368 6f77 5f70            show_p
+00009c90: 7265 7365 7473 203d 2054 7275 650a 2020  resets = True.  
+00009ca0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00009cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009cc0: 7368 6f77 5f74 6167 7320 3d20 5472 7565  show_tags = True
+00009cd0: 0a20 2020 2020 2020 2020 2020 206e 6565  .            nee
+00009ce0: 646c 6520 3d20 7461 675f 746f 5f62 655b  dle = tag_to_be[
+00009cf0: 313a 5d20 2023 2074 6865 2074 6167 2077  1:]  # the tag w
+00009d00: 6974 686f 7574 2074 6865 2027 2327 0a20  ithout the '#'. 
+00009d10: 2020 2020 2020 2065 6c69 6620 2838 2026         elif (8 &
+00009d20: 2073 656c 662e 5f6d 6f64 655f 6d61 736b   self._mode_mask
+00009d30: 2920 616e 6420 6c65 6e28 7661 6c29 203e  ) and len(val) >
+00009d40: 3d20 3220 616e 6420 2220 2220 6e6f 7420  = 2 and " " not 
+00009d50: 696e 2076 616c 3a0a 2020 2020 2020 2020  in val:.        
+00009d60: 2020 2020 7368 6f77 5f64 6573 6372 6970      show_descrip
+00009d70: 7469 6f6e 7320 3d20 5472 7565 0a20 2020  tions = True.   
+00009d80: 2020 2020 2020 2020 206e 6565 646c 6520           needle 
+00009d90: 3d20 7661 6c2e 746f 4c6f 7765 7243 6173  = val.toLowerCas
+00009da0: 6528 290a 2020 2020 2020 2020 656c 7365  e().        else
+00009db0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00009dc0: 6c66 2e63 6c65 6172 2829 0a20 2020 2020  lf.clear().     
+00009dd0: 2020 2020 2020 2072 6574 7572 6e0a 0a20         return.. 
+00009de0: 2020 2020 2020 2023 2057 6520 7368 6f77         # We show
+00009df0: 2070 7265 7365 7473 2069 6620 7573 696e   presets if usin
+00009e00: 6720 646f 7562 6c65 2068 6173 6874 6167  g double hashtag
+00009e10: 730a 2020 2020 2020 2020 6966 2074 6167  s.        if tag
+00009e20: 5f74 6f5f 6265 203d 3d20 2223 223a 0a20  _to_be == "#":. 
+00009e30: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00009e40: 6c66 2e5f 6d6f 6465 5f6d 6173 6b20 3d3d  lf._mode_mask ==
+00009e50: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+00009e60: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
+00009e70: 2020 2020 2020 2065 6c69 6620 7368 6f77         elif show
+00009e80: 5f70 7265 7365 7473 3a0a 2020 2020 2020  _presets:.      
+00009e90: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00009ea0: 2073 656c 662e 7368 6f77 5f73 7567 6765   self.show_sugge
+00009eb0: 7374 696f 6e73 2822 7072 6573 6574 7322  stions("presets"
+00009ec0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+00009ed0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00009ee0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00009ef0: 7368 6f77 5f73 7567 6765 7374 696f 6e73  show_suggestions
+00009f00: 2822 7461 6773 2229 0a0a 2020 2020 2020  ("tags")..      
+00009f10: 2020 2320 4f62 7461 696e 2073 7567 6765    # Obtain sugge
+00009f20: 7374 696f 6e73 0a20 2020 2020 2020 206d  stions.        m
+00009f30: 6174 6368 6573 3120 3d20 5b5d 2020 2320  atches1 = []  # 
+00009f40: 6c69 7374 206f 6620 2874 6578 742c 2068  list of (text, h
+00009f50: 746d 6c2c 2073 656c 6563 745f 646f 6573  tml, select_does
+00009f60: 5f72 6570 6c61 6365 290a 2020 2020 2020  _replace).      
+00009f70: 2020 6d61 7463 6865 7332 203d 205b 5d20    matches2 = [] 
+00009f80: 2023 2073 616d 650a 2020 2020 2020 2020   # same.        
+00009f90: 6966 2073 686f 775f 7072 6573 6574 733a  if show_presets:
+00009fa0: 0a20 2020 2020 2020 2020 2020 2023 2053  .            # S
+00009fb0: 7567 6765 7374 696f 6e73 2066 726f 6d20  uggestions from 
+00009fc0: 7072 6573 6574 730a 2020 2020 2020 2020  presets.        
+00009fd0: 2020 2020 666f 7220 7072 6573 6574 2069      for preset i
+00009fe0: 6e20 7365 6c66 2e5f 6765 745f 7375 6767  n self._get_sugg
+00009ff0: 6573 7465 645f 7461 6773 5f70 7265 7365  ested_tags_prese
+0000a000: 7473 2829 3a0a 2020 2020 2020 2020 2020  ts():.          
+0000a010: 2020 2020 2020 6874 6d6c 203d 2070 7265        html = pre
+0000a020: 7365 7420 2b20 223c 7370 616e 2063 6c61  set + "<span cla
+0000a030: 7373 3d27 6d65 7461 273e 7072 6573 6574  ss='meta'>preset
+0000a040: 3c73 7061 6e3e 220a 2020 2020 2020 2020  <span>".        
+0000a050: 2020 2020 2020 2020 6920 3d20 7072 6573          i = pres
+0000a060: 6574 2e69 6e64 6578 4f66 286e 6565 646c  et.indexOf(needl
+0000a070: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+0000a080: 2020 2069 6620 6920 3e20 303a 0a20 2020     if i > 0:.   
+0000a090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a0a0: 2069 6620 7072 6573 6574 5b69 202d 2031   if preset[i - 1
+0000a0b0: 5d20 3d3d 2022 2322 3a0a 2020 2020 2020  ] == "#":.      
+0000a0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a0d0: 2020 2320 4120 7461 6720 696e 2074 6865    # A tag in the
+0000a0e0: 2070 7265 7365 7420 7374 6172 7473 7769   preset startswi
+0000a0f0: 7468 2074 6865 206e 6565 646c 650a 2020  th the needle.  
+0000a100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a110: 2020 2020 2020 6874 6d6c 203d 2028 0a20        html = (. 
+0000a120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a130: 2020 2020 2020 2020 2020 2070 7265 7365             prese
+0000a140: 745b 3a20 6920 2d20 315d 0a20 2020 2020  t[: i - 1].     
+0000a150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a160: 2020 2020 2020 202b 2022 3c62 3e22 0a20         + "<b>". 
+0000a170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a180: 2020 2020 2020 2020 2020 202b 2074 6167             + tag
+0000a190: 5f74 6f5f 6265 0a20 2020 2020 2020 2020  _to_be.         
+0000a1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a1b0: 2020 202b 2022 3c2f 623e 220a 2020 2020     + "</b>".    
+0000a1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a1d0: 2020 2020 2020 2020 2b20 7072 6573 6574          + preset
+0000a1e0: 5b69 202b 206e 6565 646c 652e 6c65 6e67  [i + needle.leng
+0000a1f0: 7468 203a 5d0a 2020 2020 2020 2020 2020  th :].          
+0000a200: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0000a210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a220: 2020 2020 2020 2020 6874 6d6c 202b 3d20          html += 
+0000a230: 223c 7370 616e 2063 6c61 7373 3d27 6d65  "<span class='me
+0000a240: 7461 273e 7072 6573 6574 3c73 7061 6e3e  ta'>preset<span>
+0000a250: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0000a260: 2020 2020 2020 2020 2020 6d61 7463 6865            matche
+0000a270: 7331 2e70 7573 6828 2870 7265 7365 742c  s1.push((preset,
+0000a280: 2068 746d 6c2c 2046 616c 7365 2929 0a20   html, False)). 
+0000a290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a2a0: 2020 2065 6c69 6620 6e65 6564 6c65 2e6c     elif needle.l
+0000a2b0: 656e 6774 6820 3e3d 2032 3a0a 2020 2020  ength >= 2:.    
+0000a2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a2d0: 2020 2020 2320 5468 6520 7072 6573 6574      # The preset
+0000a2e0: 2063 6f6e 7461 696e 7320 7468 6520 6e65   contains the ne
+0000a2f0: 6564 6c65 2c20 616e 6420 7468 6520 6e65  edle, and the ne
+0000a300: 6564 6c65 2069 7320 6d6f 7265 2074 6861  edle is more tha
+0000a310: 6e20 3120 6368 6172 0a20 2020 2020 2020  n 1 char.       
+0000a320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a330: 2068 746d 6c20 3d20 280a 2020 2020 2020   html = (.      
+0000a340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a350: 2020 2020 2020 7072 6573 6574 5b3a 695d        preset[:i]
+0000a360: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a370: 2020 2020 2020 2020 2020 2020 202b 2022               + "
+0000a380: 3c62 3e22 0a20 2020 2020 2020 2020 2020  <b>".           
 0000a390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a3a0: 2020 2020 2020 2020 6874 6d6c 203d 2028          html = (
-0000a3b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a3c0: 2020 2020 2020 2020 2020 2020 2074 6167               tag
-0000a3d0: 5b3a 695d 202b 2022 3c62 3e22 202b 206e  [:i] + "<b>" + n
-0000a3e0: 6565 646c 6520 2b20 223c 2f62 3e22 202b  eedle + "</b>" +
-0000a3f0: 2074 6167 5b69 202b 206e 6565 646c 652e   tag[i + needle.
-0000a400: 6c65 6e67 7468 203a 5d0a 2020 2020 2020  length :].      
+0000a3a0: 202b 206e 6565 646c 650a 2020 2020 2020   + needle.      
+0000a3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a3c0: 2020 2020 2020 2b20 223c 2f62 3e22 0a20        + "</b>". 
+0000a3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a3e0: 2020 2020 2020 2020 2020 202b 2070 7265             + pre
+0000a3f0: 7365 745b 6920 2b20 6e65 6564 6c65 2e6c  set[i + needle.l
+0000a400: 656e 6774 6820 3a5d 0a20 2020 2020 2020  ength :].       
 0000a410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a420: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0000a430: 2020 2020 2020 2020 2020 2020 6874 6d6c              html
-0000a440: 202b 3d20 223c 7370 616e 2063 6c61 7373   += "<span class
-0000a450: 3d27 6d65 7461 273e 6c61 7374 2075 7365  ='meta'>last use
-0000a460: 6420 2220 2b20 6461 7465 202b 2022 3c73  d " + date + "<s
-0000a470: 7061 6e3e 220a 2020 2020 2020 2020 2020  pan>".          
-0000a480: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-0000a490: 7463 6865 7332 2e70 7573 6828 2874 6167  tches2.push((tag
-0000a4a0: 2c20 6874 6d6c 2929 0a20 2020 2020 2020  , html)).       
-0000a4b0: 2069 6620 7368 6f77 5f64 6573 6372 6970   if show_descrip
-0000a4c0: 7469 6f6e 733a 0a20 2020 2020 2020 2020  tions:.         
-0000a4d0: 2020 2023 2053 7567 6765 7374 696f 6e73     # Suggestions
-0000a4e0: 2066 726f 6d20 7265 6365 6e74 2064 6573   from recent des
-0000a4f0: 6372 6970 7469 6f6e 730a 2020 2020 2020  criptions.      
-0000a500: 2020 2020 2020 666f 7220 6473 2c20 6473        for ds, ds
-0000a510: 5f74 3220 696e 2073 656c 662e 5f73 7567  _t2 in self._sug
-0000a520: 6765 7374 6564 5f64 735f 7265 6365 6e74  gested_ds_recent
-0000a530: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000a540: 2020 6920 3d20 6473 2e74 6f4c 6f77 6572    i = ds.toLower
-0000a550: 4361 7365 2829 2e69 6e64 6578 4f66 286e  Case().indexOf(n
-0000a560: 6565 646c 6529 0a20 2020 2020 2020 2020  eedle).         
-0000a570: 2020 2020 2020 2069 6620 6920 3e3d 2030         if i >= 0
-0000a580: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000a590: 2020 2020 2020 6461 7465 203d 2064 6179        date = day
-0000a5a0: 735f 6167 6f28 6473 5f74 3229 0a20 2020  s_ago(ds_t2).   
-0000a5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a5c0: 2064 6174 6520 3d20 7b30 3a20 2274 6f64   date = {0: "tod
-0000a5d0: 6179 222c 2031 3a20 2279 6573 7465 7264  ay", 1: "yesterd
-0000a5e0: 6179 227d 2e67 6574 2864 6174 652c 2064  ay"}.get(date, d
-0000a5f0: 6174 6520 2b20 2220 6461 7973 2061 676f  ate + " days ago
-0000a600: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0000a610: 2020 2020 2020 2068 746d 6c20 3d20 280a         html = (.
-0000a620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a630: 2020 2020 2020 2020 6473 5b3a 695d 0a20          ds[:i]. 
+0000a420: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+0000a430: 2020 2020 2020 2020 2020 2068 746d 6c20             html 
+0000a440: 2b3d 2022 3c73 7061 6e20 636c 6173 733d  += "<span class=
+0000a450: 276d 6574 6127 3e70 7265 7365 743c 7370  'meta'>preset<sp
+0000a460: 616e 3e22 0a20 2020 2020 2020 2020 2020  an>".           
+0000a470: 2020 2020 2020 2020 2020 2020 206d 6174               mat
+0000a480: 6368 6573 322e 7075 7368 2828 7072 6573  ches2.push((pres
+0000a490: 6574 2c20 6874 6d6c 2c20 4661 6c73 6529  et, html, False)
+0000a4a0: 290a 2020 2020 2020 2020 6966 2073 686f  ).        if sho
+0000a4b0: 775f 7461 6773 3a0a 2020 2020 2020 2020  w_tags:.        
+0000a4c0: 2020 2020 2320 5375 6767 6573 7469 6f6e      # Suggestion
+0000a4d0: 7320 6672 6f6d 2072 6563 656e 7420 7461  s from recent ta
+0000a4e0: 6773 0a20 2020 2020 2020 2020 2020 2066  gs.            f
+0000a4f0: 6f72 2074 6167 2c20 7461 675f 7432 2069  or tag, tag_t2 i
+0000a500: 6e20 7365 6c66 2e5f 7375 6767 6573 7465  n self._suggeste
+0000a510: 645f 7461 6773 5f63 6f6d 6269 6e65 643a  d_tags_combined:
+0000a520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a530: 2069 203d 2074 6167 2e69 6e64 6578 4f66   i = tag.indexOf
+0000a540: 286e 6565 646c 6529 0a20 2020 2020 2020  (needle).       
+0000a550: 2020 2020 2020 2020 2069 6620 6920 3e20           if i > 
+0000a560: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+0000a570: 2020 2020 2020 2064 6174 6520 3d20 6461         date = da
+0000a580: 7973 5f61 676f 2874 6167 5f74 3229 0a20  ys_ago(tag_t2). 
+0000a590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a5a0: 2020 2064 6174 6520 3d20 7b30 3a20 2274     date = {0: "t
+0000a5b0: 6f64 6179 222c 2031 3a20 2279 6573 7465  oday", 1: "yeste
+0000a5c0: 7264 6179 227d 2e67 6574 2864 6174 652c  rday"}.get(date,
+0000a5d0: 2064 6174 6520 2b20 2220 6461 7973 2061   date + " days a
+0000a5e0: 676f 2229 0a20 2020 2020 2020 2020 2020  go").           
+0000a5f0: 2020 2020 2020 2020 2069 6620 6920 3d3d           if i ==
+0000a600: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+0000a610: 2020 2020 2020 2020 2020 2020 2320 5468              # Th
+0000a620: 6520 7461 6720 7374 6172 7473 7769 7468  e tag startswith
+0000a630: 2074 6865 206e 6565 646c 650a 2020 2020   the needle.    
 0000a640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a650: 2020 2020 2020 202b 2022 3c62 3e22 0a20         + "<b>". 
-0000a660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a670: 2020 2020 2020 202b 2064 735b 6920 3a20         + ds[i : 
-0000a680: 6920 2b20 6e65 6564 6c65 2e6c 656e 6774  i + needle.lengt
-0000a690: 685d 0a20 2020 2020 2020 2020 2020 2020  h].             
-0000a6a0: 2020 2020 2020 2020 2020 202b 2022 3c2f             + "</
-0000a6b0: 623e 220a 2020 2020 2020 2020 2020 2020  b>".            
-0000a6c0: 2020 2020 2020 2020 2020 2020 2b20 6473              + ds
-0000a6d0: 5b69 202b 206e 6565 646c 652e 6c65 6e67  [i + needle.leng
-0000a6e0: 7468 203a 5d0a 2020 2020 2020 2020 2020  th :].          
-0000a6f0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0000a700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a710: 6874 6d6c 202b 3d20 223c 7370 616e 2063  html += "<span c
-0000a720: 6c61 7373 3d27 6d65 7461 273e 6c61 7374  lass='meta'>last
-0000a730: 2075 7365 6420 2220 2b20 6461 7465 202b   used " + date +
-0000a740: 2022 3c73 7061 6e3e 220a 2020 2020 2020   "<span>".      
-0000a750: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-0000a760: 7463 6865 7332 2e70 7573 6828 2864 732c  tches2.push((ds,
-0000a770: 2068 746d 6c29 290a 0a20 2020 2020 2020   html))..       
-0000a780: 2073 7567 6765 7374 696f 6e73 203d 206d   suggestions = m
-0000a790: 6174 6368 6573 310a 2020 2020 2020 2020  atches1.        
-0000a7a0: 7375 6767 6573 7469 6f6e 732e 6578 7465  suggestions.exte
-0000a7b0: 6e64 286d 6174 6368 6573 3229 0a0a 2020  nd(matches2)..  
-0000a7c0: 2020 2020 2020 2320 5368 6f77 0a20 2020        # Show.   
-0000a7d0: 2020 2020 2069 6620 7375 6767 6573 7469       if suggesti
-0000a7e0: 6f6e 733a 0a20 2020 2020 2020 2020 2020  ons:.           
-0000a7f0: 2069 6620 7368 6f77 5f64 6573 6372 6970   if show_descrip
-0000a800: 7469 6f6e 733a 0a20 2020 2020 2020 2020  tions:.         
-0000a810: 2020 2020 2020 2073 656c 662e 5f73 686f         self._sho
-0000a820: 7728 224d 6174 6368 696e 6720 6465 7363  w("Matching desc
-0000a830: 7269 7074 696f 6e73 3a22 2c20 7375 6767  riptions:", sugg
-0000a840: 6573 7469 6f6e 732c 2046 616c 7365 290a  estions, False).
-0000a850: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0000a860: 2073 686f 775f 7072 6573 6574 733a 0a20   show_presets:. 
-0000a870: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000a880: 656c 662e 5f73 686f 7728 224d 6174 6368  elf._show("Match
-0000a890: 696e 6720 7072 6573 6574 733a 222c 2073  ing presets:", s
-0000a8a0: 7567 6765 7374 696f 6e73 290a 2020 2020  uggestions).    
-0000a8b0: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
-0000a8c0: 662e 5f6d 6f64 655f 6d61 736b 2026 2032  f._mode_mask & 2
-0000a8d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000a8e0: 2020 7365 6c66 2e5f 7368 6f77 2822 4d61    self._show("Ma
-0000a8f0: 7463 6869 6e67 2072 6563 656e 7420 7461  tching recent ta
-0000a900: 6773 3a22 2c20 7375 6767 6573 7469 6f6e  gs:", suggestion
-0000a910: 7329 0a20 2020 2020 2020 2020 2020 2065  s).            e
-0000a920: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000a930: 2020 2020 2073 656c 662e 5f73 686f 7728       self._show(
-0000a940: 224d 6174 6368 696e 6720 7461 6773 3a22  "Matching tags:"
-0000a950: 2c20 7375 6767 6573 7469 6f6e 7329 0a20  , suggestions). 
-0000a960: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000a970: 2020 2020 2020 2020 2069 6620 7368 6f77           if show
-0000a980: 5f64 6573 6372 6970 7469 6f6e 733a 0a20  _descriptions:. 
-0000a990: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000a9a0: 656c 662e 636c 6561 7228 290a 2020 2020  elf.clear().    
-0000a9b0: 2020 2020 2020 2020 656c 6966 2073 686f          elif sho
-0000a9c0: 775f 7072 6573 6574 733a 0a20 2020 2020  w_presets:.     
-0000a9d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000a9e0: 5f73 686f 7728 224e 6f20 6d61 7463 6869  _show("No matchi
-0000a9f0: 6e67 2070 7265 7365 7473 202e 2e2e 222c  ng presets ...",
-0000aa00: 2073 7567 6765 7374 696f 6e73 290a 2020   suggestions).  
-0000aa10: 2020 2020 2020 2020 2020 656c 6966 2073            elif s
-0000aa20: 656c 662e 5f6d 6f64 655f 6d61 736b 2026  elf._mode_mask &
-0000aa30: 2032 3a0a 2020 2020 2020 2020 2020 2020   2:.            
-0000aa40: 2020 2020 7365 6c66 2e5f 7368 6f77 2822      self._show("
-0000aa50: 4e6f 206d 6174 6368 696e 6720 7265 6365  No matching rece
-0000aa60: 6e74 2074 6167 7320 2e2e 2e22 2c20 7375  nt tags ...", su
-0000aa70: 6767 6573 7469 6f6e 7329 0a20 2020 2020  ggestions).     
-0000aa80: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000aa90: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000aaa0: 662e 5f73 686f 7728 224e 6f20 6d61 7463  f._show("No matc
-0000aab0: 6869 6e67 2074 6167 7320 2e2e 2e22 2c20  hing tags ...", 
-0000aac0: 7375 6767 6573 7469 6f6e 7329 0a0a 2020  suggestions)..  
-0000aad0: 2020 6465 6620 7368 6f77 5f73 7567 6765    def show_sugge
-0000aae0: 7374 696f 6e73 2873 656c 662c 206b 696e  stions(self, kin
-0000aaf0: 643d 2222 293a 0a20 2020 2020 2020 2073  d=""):.        s
-0000ab00: 7567 6765 7374 696f 6e73 203d 205b 5d0a  uggestions = [].
-0000ab10: 2020 2020 2020 2020 7479 7065 7320 3d20          types = 
-0000ab20: 5b5d 0a20 2020 2020 2020 2023 2043 6f6c  [].        # Col
-0000ab30: 6c65 6374 2072 6563 656e 7420 6473 2773  lect recent ds's
-0000ab40: 0a20 2020 2020 2020 2069 6620 2264 6573  .        if "des
-0000ab50: 6372 6970 7469 6f6e 7322 2069 6e20 6b69  criptions" in ki
-0000ab60: 6e64 3a0a 2020 2020 2020 2020 2020 2020  nd:.            
-0000ab70: 7479 7065 732e 7075 7368 2822 5265 6365  types.push("Rece
-0000ab80: 6e74 2064 6573 6372 6970 7469 6f6e 7322  nt descriptions"
-0000ab90: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
-0000aba0: 7220 6473 2c20 6473 5f74 3220 696e 2073  r ds, ds_t2 in s
-0000abb0: 656c 662e 5f73 7567 6765 7374 6564 5f64  elf._suggested_d
-0000abc0: 735f 7265 6365 6e74 3a0a 2020 2020 2020  s_recent:.      
-0000abd0: 2020 2020 2020 2020 2020 6461 7465 203d            date =
-0000abe0: 2064 6179 735f 6167 6f28 6473 5f74 3229   days_ago(ds_t2)
-0000abf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ac00: 2064 6174 6520 3d20 7b30 3a20 2274 6f64   date = {0: "tod
-0000ac10: 6179 222c 2031 3a20 2279 6573 7465 7264  ay", 1: "yesterd
-0000ac20: 6179 227d 2e67 6574 2864 6174 652c 2064  ay"}.get(date, d
-0000ac30: 6174 6520 2b20 2220 6461 7973 2061 676f  ate + " days ago
-0000ac40: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0000ac50: 2020 2068 746d 6c20 3d20 6473 202b 2022     html = ds + "
-0000ac60: 3c73 7061 6e20 636c 6173 733d 276d 6574  <span class='met
-0000ac70: 6127 3e72 6563 656e 743a 2022 202b 2064  a'>recent: " + d
-0000ac80: 6174 6520 2b20 223c 7370 616e 3e22 0a20  ate + "<span>". 
+0000a650: 2020 2020 6874 6d6c 203d 2022 3c62 3e22      html = "<b>"
+0000a660: 202b 2074 6167 5f74 6f5f 6265 202b 2022   + tag_to_be + "
+0000a670: 3c2f 623e 2220 2b20 7461 675b 7461 675f  </b>" + tag[tag_
+0000a680: 746f 5f62 652e 6c65 6e67 7468 203a 5d0a  to_be.length :].
+0000a690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a6a0: 2020 2020 2020 2020 6874 6d6c 202b 3d20          html += 
+0000a6b0: 223c 7370 616e 2063 6c61 7373 3d27 6d65  "<span class='me
+0000a6c0: 7461 273e 6c61 7374 2075 7365 6420 2220  ta'>last used " 
+0000a6d0: 2b20 6461 7465 202b 2022 3c73 7061 6e3e  + date + "<span>
+0000a6e0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0000a6f0: 2020 2020 2020 2020 2020 6d61 7463 6865            matche
+0000a700: 7331 2e70 7573 6828 2874 6167 2c20 6874  s1.push((tag, ht
+0000a710: 6d6c 2c20 4661 6c73 6529 290a 2020 2020  ml, False)).    
+0000a720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a730: 656c 6966 206e 6565 646c 652e 6c65 6e67  elif needle.leng
+0000a740: 7468 203e 3d20 323a 0a20 2020 2020 2020  th >= 2:.       
+0000a750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a760: 2023 2054 6865 2074 6167 2063 6f6e 7461   # The tag conta
+0000a770: 696e 7320 7468 6520 6e65 6564 6c65 2c20  ins the needle, 
+0000a780: 616e 6420 7468 6520 6e65 6564 6c65 2069  and the needle i
+0000a790: 7320 6d6f 7265 2074 6861 6e20 3120 6368  s more than 1 ch
+0000a7a0: 6172 0a20 2020 2020 2020 2020 2020 2020  ar.             
+0000a7b0: 2020 2020 2020 2020 2020 2068 746d 6c20             html 
+0000a7c0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+0000a7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a7e0: 7461 675b 3a69 5d20 2b20 223c 623e 2220  tag[:i] + "<b>" 
+0000a7f0: 2b20 6e65 6564 6c65 202b 2022 3c2f 623e  + needle + "</b>
+0000a800: 2220 2b20 7461 675b 6920 2b20 6e65 6564  " + tag[i + need
+0000a810: 6c65 2e6c 656e 6774 6820 3a5d 0a20 2020  le.length :].   
+0000a820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a830: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0000a840: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+0000a850: 746d 6c20 2b3d 2022 3c73 7061 6e20 636c  tml += "<span cl
+0000a860: 6173 733d 276d 6574 6127 3e6c 6173 7420  ass='meta'>last 
+0000a870: 7573 6564 2022 202b 2064 6174 6520 2b20  used " + date + 
+0000a880: 223c 7370 616e 3e22 0a20 2020 2020 2020  "<span>".       
+0000a890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a8a0: 206d 6174 6368 6573 322e 7075 7368 2828   matches2.push((
+0000a8b0: 7461 672c 2068 746d 6c2c 2046 616c 7365  tag, html, False
+0000a8c0: 2929 0a20 2020 2020 2020 2069 6620 7368  )).        if sh
+0000a8d0: 6f77 5f64 6573 6372 6970 7469 6f6e 733a  ow_descriptions:
+0000a8e0: 0a20 2020 2020 2020 2020 2020 2023 2053  .            # S
+0000a8f0: 7567 6765 7374 696f 6e73 2066 726f 6d20  uggestions from 
+0000a900: 7265 6365 6e74 2064 6573 6372 6970 7469  recent descripti
+0000a910: 6f6e 730a 2020 2020 2020 2020 2020 2020  ons.            
+0000a920: 666f 7220 6473 2c20 6473 5f74 3220 696e  for ds, ds_t2 in
+0000a930: 2073 656c 662e 5f73 7567 6765 7374 6564   self._suggested
+0000a940: 5f64 735f 7265 6365 6e74 3a0a 2020 2020  _ds_recent:.    
+0000a950: 2020 2020 2020 2020 2020 2020 6920 3d20              i = 
+0000a960: 6473 2e74 6f4c 6f77 6572 4361 7365 2829  ds.toLowerCase()
+0000a970: 2e69 6e64 6578 4f66 286e 6565 646c 6529  .indexOf(needle)
+0000a980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a990: 2069 6620 6920 3e3d 2030 3a0a 2020 2020   if i >= 0:.    
+0000a9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a9b0: 6461 7465 203d 2064 6179 735f 6167 6f28  date = days_ago(
+0000a9c0: 6473 5f74 3229 0a20 2020 2020 2020 2020  ds_t2).         
+0000a9d0: 2020 2020 2020 2020 2020 2064 6174 6520             date 
+0000a9e0: 3d20 7b30 3a20 2274 6f64 6179 222c 2031  = {0: "today", 1
+0000a9f0: 3a20 2279 6573 7465 7264 6179 227d 2e67  : "yesterday"}.g
+0000aa00: 6574 2864 6174 652c 2064 6174 6520 2b20  et(date, date + 
+0000aa10: 2220 6461 7973 2061 676f 2229 0a20 2020  " days ago").   
+0000aa20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aa30: 2068 746d 6c20 3d20 280a 2020 2020 2020   html = (.      
+0000aa40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aa50: 2020 6473 5b3a 695d 0a20 2020 2020 2020    ds[:i].       
+0000aa60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aa70: 202b 2022 3c62 3e22 0a20 2020 2020 2020   + "<b>".       
+0000aa80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aa90: 202b 2064 735b 6920 3a20 6920 2b20 6e65   + ds[i : i + ne
+0000aaa0: 6564 6c65 2e6c 656e 6774 685d 0a20 2020  edle.length].   
+0000aab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aac0: 2020 2020 202b 2022 3c2f 623e 220a 2020       + "</b>".  
+0000aad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aae0: 2020 2020 2020 2b20 6473 5b69 202b 206e        + ds[i + n
+0000aaf0: 6565 646c 652e 6c65 6e67 7468 203a 5d0a  eedle.length :].
+0000ab00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ab10: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0000ab20: 2020 2020 2020 2020 2020 6874 6d6c 202b            html +
+0000ab30: 3d20 223c 7370 616e 2063 6c61 7373 3d27  = "<span class='
+0000ab40: 6d65 7461 273e 6c61 7374 2075 7365 6420  meta'>last used 
+0000ab50: 2220 2b20 6461 7465 202b 2022 3c73 7061  " + date + "<spa
+0000ab60: 6e3e 220a 2020 2020 2020 2020 2020 2020  n>".            
+0000ab70: 2020 2020 2020 2020 6d61 7463 6865 7332          matches2
+0000ab80: 2e70 7573 6828 2864 732c 2068 746d 6c2c  .push((ds, html,
+0000ab90: 2054 7275 6529 290a 0a20 2020 2020 2020   True))..       
+0000aba0: 2073 7567 6765 7374 696f 6e73 203d 206d   suggestions = m
+0000abb0: 6174 6368 6573 310a 2020 2020 2020 2020  atches1.        
+0000abc0: 7375 6767 6573 7469 6f6e 732e 6578 7465  suggestions.exte
+0000abd0: 6e64 286d 6174 6368 6573 3229 0a0a 2020  nd(matches2)..  
+0000abe0: 2020 2020 2020 2320 5368 6f77 0a20 2020        # Show.   
+0000abf0: 2020 2020 2069 6620 7375 6767 6573 7469       if suggesti
+0000ac00: 6f6e 733a 0a20 2020 2020 2020 2020 2020  ons:.           
+0000ac10: 2069 6620 7368 6f77 5f64 6573 6372 6970   if show_descrip
+0000ac20: 7469 6f6e 733a 0a20 2020 2020 2020 2020  tions:.         
+0000ac30: 2020 2020 2020 2073 656c 662e 5f73 686f         self._sho
+0000ac40: 7728 224d 6174 6368 696e 6720 6465 7363  w("Matching desc
+0000ac50: 7269 7074 696f 6e73 3a22 2c20 7375 6767  riptions:", sugg
+0000ac60: 6573 7469 6f6e 732c 2046 616c 7365 290a  estions, False).
+0000ac70: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+0000ac80: 2073 686f 775f 7072 6573 6574 733a 0a20   show_presets:. 
 0000ac90: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000aca0: 7567 6765 7374 696f 6e73 2e70 7573 6828  uggestions.push(
-0000acb0: 2864 732c 2068 746d 6c29 290a 2020 2020  (ds, html)).    
-0000acc0: 2020 2020 2320 436f 6c6c 6563 7420 7072      # Collect pr
-0000acd0: 6573 6574 730a 2020 2020 2020 2020 6966  esets.        if
-0000ace0: 2022 7072 6573 6574 7322 2069 6e20 6b69   "presets" in ki
-0000acf0: 6e64 3a0a 2020 2020 2020 2020 2020 2020  nd:.            
-0000ad00: 7479 7065 732e 7075 7368 2822 5072 6573  types.push("Pres
-0000ad10: 6574 7322 290a 2020 2020 2020 2020 2020  ets").          
-0000ad20: 2020 666f 7220 7072 6573 6574 2069 6e20    for preset in 
-0000ad30: 7365 6c66 2e5f 6765 745f 7375 6767 6573  self._get_sugges
-0000ad40: 7465 645f 7461 6773 5f70 7265 7365 7473  ted_tags_presets
-0000ad50: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-0000ad60: 2020 2020 6874 6d6c 203d 2070 7265 7365      html = prese
-0000ad70: 7420 2b20 223c 7370 616e 2063 6c61 7373  t + "<span class
-0000ad80: 3d27 6d65 7461 273e 7072 6573 6574 3c73  ='meta'>preset<s
-0000ad90: 7061 6e3e 220a 2020 2020 2020 2020 2020  pan>".          
-0000ada0: 2020 2020 2020 7375 6767 6573 7469 6f6e        suggestion
-0000adb0: 732e 7075 7368 2828 7072 6573 6574 2c20  s.push((preset, 
-0000adc0: 6874 6d6c 2929 0a20 2020 2020 2020 2023  html)).        #
-0000add0: 2043 6f6c 6c65 6374 2074 6167 730a 2020   Collect tags.  
-0000ade0: 2020 2020 2020 6966 2022 7461 6773 2220        if "tags" 
-0000adf0: 696e 206b 696e 643a 0a20 2020 2020 2020  in kind:.       
-0000ae00: 2020 2020 2074 7970 6573 2e70 7573 6828       types.push(
-0000ae10: 2252 6563 656e 7420 7461 6773 2229 0a20  "Recent tags"). 
-0000ae20: 2020 2020 2020 2020 2020 2066 6f72 2074             for t
-0000ae30: 6167 2c20 7461 675f 7432 2069 6e20 7365  ag, tag_t2 in se
-0000ae40: 6c66 2e5f 7375 6767 6573 7465 645f 7461  lf._suggested_ta
-0000ae50: 6773 5f72 6563 656e 743a 0a20 2020 2020  gs_recent:.     
-0000ae60: 2020 2020 2020 2020 2020 2064 6174 6520             date 
-0000ae70: 3d20 6461 7973 5f61 676f 2874 6167 5f74  = days_ago(tag_t
-0000ae80: 3229 0a20 2020 2020 2020 2020 2020 2020  2).             
-0000ae90: 2020 2064 6174 6520 3d20 7b30 3a20 2274     date = {0: "t
-0000aea0: 6f64 6179 222c 2031 3a20 2279 6573 7465  oday", 1: "yeste
-0000aeb0: 7264 6179 227d 2e67 6574 2864 6174 652c  rday"}.get(date,
-0000aec0: 2064 6174 6520 2b20 2220 6461 7973 2061   date + " days a
-0000aed0: 676f 2229 0a20 2020 2020 2020 2020 2020  go").           
-0000aee0: 2020 2020 2068 746d 6c20 3d20 7461 6720       html = tag 
-0000aef0: 2b20 223c 7370 616e 2063 6c61 7373 3d27  + "<span class='
-0000af00: 6d65 7461 273e 7265 6365 6e74 3a20 2220  meta'>recent: " 
-0000af10: 2b20 6461 7465 202b 2022 3c73 7061 6e3e  + date + "<span>
-0000af20: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000af30: 2020 7375 6767 6573 7469 6f6e 732e 7075    suggestions.pu
-0000af40: 7368 2828 7461 672c 2068 746d 6c29 290a  sh((tag, html)).
-0000af50: 2020 2020 2020 2020 2320 5368 6f77 0a20          # Show. 
-0000af60: 2020 2020 2020 2069 6620 6e6f 7420 7479         if not ty
-0000af70: 7065 733a 0a20 2020 2020 2020 2020 2020  pes:.           
-0000af80: 2073 656c 662e 636c 6561 7228 290a 2020   self.clear().  
-0000af90: 2020 2020 2020 656c 6966 2073 7567 6765        elif sugge
-0000afa0: 7374 696f 6e73 3a0a 2020 2020 2020 2020  stions:.        
-0000afb0: 2020 2020 7365 6c66 2e5f 7374 6174 6520      self._state 
-0000afc0: 3d20 7365 6c66 2e5f 6765 745f 7374 6174  = self._get_stat
-0000afd0: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
-0000afe0: 7365 6c66 2e5f 7368 6f77 2874 7970 6573  self._show(types
-0000aff0: 2e6a 6f69 6e28 2220 2620 2229 202b 2022  .join(" & ") + "
-0000b000: 3a22 2c20 7375 6767 6573 7469 6f6e 732c  :", suggestions,
-0000b010: 2046 616c 7365 290a 2020 2020 2020 2020   False).        
-0000b020: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000b030: 2020 7365 6c66 2e5f 7368 6f77 2822 4e6f    self._show("No
-0000b040: 2022 202b 2074 7970 6573 2e6a 6f69 6e28   " + types.join(
-0000b050: 2220 6f72 2022 2920 2b20 2220 2e2e 2e22  " or ") + " ..."
-0000b060: 2c20 5b5d 2c20 4661 6c73 6529 0a0a 2020  , [], False)..  
-0000b070: 2020 6465 6620 6f6e 5f6b 6579 2873 656c    def on_key(sel
-0000b080: 662c 2065 293a 0a20 2020 2020 2020 2069  f, e):.        i
-0000b090: 6620 6e6f 7420 7365 6c66 2e5f 6469 762e  f not self._div.
-0000b0a0: 6869 6464 656e 3a0a 2020 2020 2020 2020  hidden:.        
-0000b0b0: 2020 2020 6b65 7920 3d20 652e 6b65 792e      key = e.key.
-0000b0c0: 6c6f 7765 7228 290a 2020 2020 2020 2020  lower().        
-0000b0d0: 2020 2020 6966 206b 6579 203d 3d20 2265      if key == "e
-0000b0e0: 6e74 6572 2220 6f72 206b 6579 203d 3d20  nter" or key == 
-0000b0f0: 2272 6574 7572 6e22 206f 7220 6b65 7920  "return" or key 
-0000b100: 3d3d 2022 7461 6222 3a0a 2020 2020 2020  == "tab":.      
-0000b110: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0000b120: 6669 6e69 7368 2873 656c 662e 5f61 6374  finish(self._act
-0000b130: 6976 655f 7375 6767 6573 7469 6f6e 290a  ive_suggestion).
+0000aca0: 656c 662e 5f73 686f 7728 224d 6174 6368  elf._show("Match
+0000acb0: 696e 6720 7072 6573 6574 733a 222c 2073  ing presets:", s
+0000acc0: 7567 6765 7374 696f 6e73 290a 2020 2020  uggestions).    
+0000acd0: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
+0000ace0: 662e 5f6d 6f64 655f 6d61 736b 2026 2032  f._mode_mask & 2
+0000acf0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000ad00: 2020 7365 6c66 2e5f 7368 6f77 2822 4d61    self._show("Ma
+0000ad10: 7463 6869 6e67 2072 6563 656e 7420 7461  tching recent ta
+0000ad20: 6773 3a22 2c20 7375 6767 6573 7469 6f6e  gs:", suggestion
+0000ad30: 7329 0a20 2020 2020 2020 2020 2020 2065  s).            e
+0000ad40: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000ad50: 2020 2020 2073 656c 662e 5f73 686f 7728       self._show(
+0000ad60: 224d 6174 6368 696e 6720 7461 6773 3a22  "Matching tags:"
+0000ad70: 2c20 7375 6767 6573 7469 6f6e 7329 0a20  , suggestions). 
+0000ad80: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000ad90: 2020 2020 2020 2020 2069 6620 7368 6f77           if show
+0000ada0: 5f64 6573 6372 6970 7469 6f6e 733a 0a20  _descriptions:. 
+0000adb0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000adc0: 656c 662e 636c 6561 7228 290a 2020 2020  elf.clear().    
+0000add0: 2020 2020 2020 2020 656c 6966 2073 686f          elif sho
+0000ade0: 775f 7072 6573 6574 733a 0a20 2020 2020  w_presets:.     
+0000adf0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000ae00: 5f73 686f 7728 224e 6f20 6d61 7463 6869  _show("No matchi
+0000ae10: 6e67 2070 7265 7365 7473 202e 2e2e 222c  ng presets ...",
+0000ae20: 2073 7567 6765 7374 696f 6e73 290a 2020   suggestions).  
+0000ae30: 2020 2020 2020 2020 2020 656c 6966 2073            elif s
+0000ae40: 656c 662e 5f6d 6f64 655f 6d61 736b 2026  elf._mode_mask &
+0000ae50: 2032 3a0a 2020 2020 2020 2020 2020 2020   2:.            
+0000ae60: 2020 2020 7365 6c66 2e5f 7368 6f77 2822      self._show("
+0000ae70: 4e6f 206d 6174 6368 696e 6720 7265 6365  No matching rece
+0000ae80: 6e74 2074 6167 7320 2e2e 2e22 2c20 7375  nt tags ...", su
+0000ae90: 6767 6573 7469 6f6e 7329 0a20 2020 2020  ggestions).     
+0000aea0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000aeb0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000aec0: 662e 5f73 686f 7728 224e 6f20 6d61 7463  f._show("No matc
+0000aed0: 6869 6e67 2074 6167 7320 2e2e 2e22 2c20  hing tags ...", 
+0000aee0: 7375 6767 6573 7469 6f6e 7329 0a0a 2020  suggestions)..  
+0000aef0: 2020 6465 6620 7368 6f77 5f73 7567 6765    def show_sugge
+0000af00: 7374 696f 6e73 2873 656c 662c 206b 696e  stions(self, kin
+0000af10: 643d 2222 293a 0a20 2020 2020 2020 2073  d=""):.        s
+0000af20: 7567 6765 7374 696f 6e73 203d 205b 5d0a  uggestions = [].
+0000af30: 2020 2020 2020 2020 7479 7065 7320 3d20          types = 
+0000af40: 5b5d 0a20 2020 2020 2020 205f 2c20 776f  [].        _, wo
+0000af50: 7264 7320 3d20 7574 696c 732e 6765 745f  rds = utils.get_
+0000af60: 7461 6773 5f61 6e64 5f70 6172 7473 5f66  tags_and_parts_f
+0000af70: 726f 6d5f 7374 7269 6e67 2873 656c 662e  rom_string(self.
+0000af80: 5f69 6e70 7574 2e76 616c 7565 290a 2020  _input.value).  
+0000af90: 2020 2020 2020 7365 6172 6368 5f77 6f72        search_wor
+0000afa0: 6420 3d20 4e6f 6e65 0a20 2020 2020 2020  d = None.       
+0000afb0: 2069 6620 6c65 6e28 776f 7264 7329 203d   if len(words) =
+0000afc0: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
+0000afd0: 2073 6561 7263 685f 776f 7264 203d 2077   search_word = w
+0000afe0: 6f72 6473 5b30 5d2e 6c6f 7765 7228 290a  ords[0].lower().
+0000aff0: 2020 2020 2020 2020 2320 436f 6c6c 6563          # Collec
+0000b000: 7420 7265 6365 6e74 2064 7327 730a 2020  t recent ds's.  
+0000b010: 2020 2020 2020 6966 2022 6465 7363 7269        if "descri
+0000b020: 7074 696f 6e73 2220 696e 206b 696e 643a  ptions" in kind:
+0000b030: 0a20 2020 2020 2020 2020 2020 2074 7970  .            typ
+0000b040: 6573 2e70 7573 6828 2252 6563 656e 7420  es.push("Recent 
+0000b050: 6465 7363 7269 7074 696f 6e73 2229 0a20  descriptions"). 
+0000b060: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+0000b070: 6172 6368 5f77 6f72 643a 0a20 2020 2020  arch_word:.     
+0000b080: 2020 2020 2020 2020 2020 2066 6f72 2064             for d
+0000b090: 732c 2064 735f 7432 2069 6e20 7365 6c66  s, ds_t2 in self
+0000b0a0: 2e5f 7375 6767 6573 7465 645f 6473 5f72  ._suggested_ds_r
+0000b0b0: 6563 656e 743a 0a20 2020 2020 2020 2020  ecent:.         
+0000b0c0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+0000b0d0: 6172 6368 5f77 6f72 6420 696e 2064 732e  arch_word in ds.
+0000b0e0: 6c6f 7765 7228 293a 0a20 2020 2020 2020  lower():.       
+0000b0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b100: 2068 746d 6c20 3d20 223c 623e 2220 2b20   html = "<b>" + 
+0000b110: 6473 202b 2022 3c2f 623e 3c73 7061 6e20  ds + "</b><span 
+0000b120: 636c 6173 733d 276d 6574 6127 3e6d 6174  class='meta'>mat
+0000b130: 6368 3c73 7061 6e3e 220a 2020 2020 2020  ch<span>".      
 0000b140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b150: 652e 7072 6576 656e 7444 6566 6175 6c74  e.preventDefault
-0000b160: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-0000b170: 2020 2072 6574 7572 6e20 5472 7565 0a20     return True. 
-0000b180: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-0000b190: 6b65 7920 3d3d 2022 6573 6361 7065 223a  key == "escape":
-0000b1a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b1b0: 2073 656c 662e 636c 6561 7228 290a 2020   self.clear().  
-0000b1c0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000b1d0: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
-0000b1e0: 2020 2020 2020 656c 6966 206b 6579 203d        elif key =
-0000b1f0: 3d20 2261 7272 6f77 646f 776e 223a 0a20  = "arrowdown":. 
-0000b200: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000b210: 656c 662e 5f6d 616b 655f 6163 7469 7665  elf._make_active
-0000b220: 2873 656c 662e 5f69 6e64 6578 202b 2031  (self._index + 1
-0000b230: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000b240: 2020 652e 7072 6576 656e 7444 6566 6175    e.preventDefau
-0000b250: 6c74 2829 0a20 2020 2020 2020 2020 2020  lt().           
-0000b260: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
-0000b270: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-0000b280: 6620 6b65 7920 3d3d 2022 6172 726f 7775  f key == "arrowu
-0000b290: 7022 3a0a 2020 2020 2020 2020 2020 2020  p":.            
-0000b2a0: 2020 2020 7365 6c66 2e5f 6d61 6b65 5f61      self._make_a
-0000b2b0: 6374 6976 6528 7365 6c66 2e5f 696e 6465  ctive(self._inde
-0000b2c0: 7820 2d20 3129 0a20 2020 2020 2020 2020  x - 1).         
-0000b2d0: 2020 2020 2020 2065 2e70 7265 7665 6e74         e.prevent
-0000b2e0: 4465 6661 756c 7428 290a 2020 2020 2020  Default().      
-0000b2f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000b300: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-0000b310: 2020 656c 6966 206b 6579 203d 3d20 2223    elif key == "#
-0000b320: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-0000b330: 2020 2023 2054 6f67 676c 6520 6265 7477     # Toggle betw
-0000b340: 6565 6e20 7072 6573 6574 2f74 6167 7320  een preset/tags 
-0000b350: 6279 2069 6e73 6572 7469 6e67 2f72 656d  by inserting/rem
-0000b360: 6f76 696e 6720 6120 2723 270a 2020 2020  oving a '#'.    
-0000b370: 2020 2020 2020 2020 2020 2020 7661 6c2c              val,
-0000b380: 2069 312c 2069 3220 3d20 7365 6c66 2e5f   i1, i2 = self._
-0000b390: 7374 6174 650a 2020 2020 2020 2020 2020  state.          
-0000b3a0: 2020 2020 2020 6966 2069 3220 3e20 6931        if i2 > i1
-0000b3b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000b3c0: 2020 2020 2020 6973 5f64 6f75 626c 6520        is_double 
-0000b3d0: 3d20 6931 203e 2030 2061 6e64 2076 616c  = i1 > 0 and val
-0000b3e0: 5b69 3120 2d20 315d 203d 3d20 2223 220a  [i1 - 1] == "#".
-0000b3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b400: 2020 2020 6966 2028 7365 6c66 2e5f 6d6f      if (self._mo
-0000b410: 6465 5f6d 6173 6b20 2620 3429 203d 3d20  de_mask & 4) == 
-0000b420: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-0000b430: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-0000b440: 5f64 6f75 626c 653a 0a20 2020 2020 2020  _double:.       
-0000b450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b460: 2020 2020 206e 6577 5f76 616c 203d 2076       new_val = v
-0000b470: 616c 5b3a 6931 5d20 2b20 7661 6c5b 6931  al[:i1] + val[i1
-0000b480: 202b 2031 203a 5d0a 2020 2020 2020 2020   + 1 :].        
-0000b490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b4a0: 2020 2020 6e65 775f 6920 3d20 6932 202d      new_i = i2 -
-0000b4b0: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
-0000b4c0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000b4d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b4e0: 2020 2020 2020 2020 2020 2020 206e 6577               new
-0000b4f0: 5f76 616c 203d 2076 616c 0a20 2020 2020  _val = val.     
-0000b500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b510: 2020 2020 2020 206e 6577 5f69 203d 2069         new_i = i
-0000b520: 320a 2020 2020 2020 2020 2020 2020 2020  2.              
-0000b530: 2020 2020 2020 656c 6966 2069 735f 646f        elif is_do
-0000b540: 7562 6c65 3a0a 2020 2020 2020 2020 2020  uble:.          
-0000b550: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-0000b560: 775f 7661 6c20 3d20 7661 6c5b 3a69 315d  w_val = val[:i1]
-0000b570: 202b 2076 616c 5b69 3120 2b20 3120 3a5d   + val[i1 + 1 :]
-0000b580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b590: 2020 2020 2020 2020 206e 6577 5f69 203d           new_i =
-0000b5a0: 2069 3220 2d20 310a 2020 2020 2020 2020   i2 - 1.        
-0000b5b0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0000b5c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000b5d0: 2020 2020 2020 2020 2020 6e65 775f 7661            new_va
-0000b5e0: 6c20 3d20 7661 6c5b 3a69 315d 202b 2022  l = val[:i1] + "
-0000b5f0: 2322 202b 2076 616c 5b69 313a 5d0a 2020  #" + val[i1:].  
-0000b600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b610: 2020 2020 2020 6e65 775f 6920 3d20 6932        new_i = i2
-0000b620: 202b 2031 0a20 2020 2020 2020 2020 2020   + 1.           
-0000b630: 2020 2020 2020 2020 2073 656c 662e 5f69           self._i
-0000b640: 6e70 7574 2e76 616c 7565 203d 206e 6577  nput.value = new
-0000b650: 5f76 616c 0a20 2020 2020 2020 2020 2020  _val.           
-0000b660: 2020 2020 2020 2020 2073 656c 662e 5f69           self._i
-0000b670: 6e70 7574 2e73 656c 6563 7469 6f6e 5374  nput.selectionSt
-0000b680: 6172 7420 3d20 7365 6c66 2e5f 696e 7075  art = self._inpu
-0000b690: 742e 7365 6c65 6374 696f 6e45 6e64 203d  t.selectionEnd =
-0000b6a0: 206e 6577 5f69 0a20 2020 2020 2020 2020   new_i.         
-0000b6b0: 2020 2020 2020 2020 2020 2065 2e70 7265             e.pre
-0000b6c0: 7665 6e74 4465 6661 756c 7428 290a 2020  ventDefault().  
-0000b6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b6e0: 2020 7365 6c66 2e69 6e69 7428 290a 2020    self.init().  
-0000b6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b700: 2020 7265 7475 726e 2054 7275 650a 0a20    return True.. 
-0000b710: 2020 2064 6566 2068 6173 5f72 6563 656e     def has_recen
-0000b720: 745f 7461 6773 2873 656c 6629 3a0a 2020  t_tags(self):.  
-0000b730: 2020 2020 2020 7265 7475 726e 206c 656e        return len
-0000b740: 2873 656c 662e 5f73 7567 6765 7374 6564  (self._suggested
-0000b750: 5f74 6167 735f 7265 6365 6e74 2920 3e20  _tags_recent) > 
-0000b760: 300a 0a20 2020 2064 6566 205f 7368 6f77  0..    def _show
-0000b770: 2873 656c 662c 2068 6561 646c 696e 652c  (self, headline,
-0000b780: 2073 7567 6765 7374 696f 6e73 2c20 7368   suggestions, sh
-0000b790: 6f77 5f74 6f67 676c 653d 5472 7565 293a  ow_toggle=True):
-0000b7a0: 0a20 2020 2020 2020 2073 656c 662e 636c  .        self.cl
-0000b7b0: 6561 7228 290a 2020 2020 2020 2020 2320  ear().        # 
-0000b7c0: 4164 6420 7469 746c 650a 2020 2020 2020  Add title.      
-0000b7d0: 2020 6869 6e74 5f68 746d 6c20 3d20 2222    hint_html = ""
-0000b7e0: 0a20 2020 2020 2020 2069 6620 7368 6f77  .        if show
-0000b7f0: 5f74 6f67 676c 6520 616e 6420 7365 6c66  _toggle and self
-0000b800: 2e5f 6d6f 6465 5f6d 6173 6b20 2620 3320  ._mode_mask & 3 
-0000b810: 616e 6420 7365 6c66 2e5f 6d6f 6465 5f6d  and self._mode_m
-0000b820: 6173 6b20 2620 343a 0a20 2020 2020 2020  ask & 4:.       
-0000b830: 2020 2020 2068 696e 7420 3d20 2228 7479       hint = "(ty
-0000b840: 7065 2027 2327 2061 6761 696e 2074 6f20  pe '#' again to 
-0000b850: 746f 6767 6c65 2074 6167 7320 2f20 7072  toggle tags / pr
-0000b860: 6573 6574 7329 220a 2020 2020 2020 2020  esets)".        
-0000b870: 2020 2020 6869 6e74 5f68 746d 6c20 3d20      hint_html = 
-0000b880: 223c 7370 616e 2073 7479 6c65 3d27 636f  "<span style='co
-0000b890: 6c6f 723a 2339 3939 3b27 3e22 202b 2068  lor:#999;'>" + h
-0000b8a0: 696e 7420 2b20 223c 2f73 7061 6e3e 220a  int + "</span>".
-0000b8b0: 2020 2020 2020 2020 6974 656d 203d 2064          item = d
-0000b8c0: 6f63 756d 656e 742e 6372 6561 7465 456c  ocument.createEl
-0000b8d0: 656d 656e 7428 2264 6976 2229 0a20 2020  ement("div").   
-0000b8e0: 2020 2020 2069 7465 6d2e 636c 6173 734c       item.classL
-0000b8f0: 6973 742e 6164 6428 226d 6574 6122 290a  ist.add("meta").
-0000b900: 2020 2020 2020 2020 6974 656d 2e69 6e6e          item.inn
-0000b910: 6572 4854 4d4c 203d 2068 6561 646c 696e  erHTML = headlin
-0000b920: 6520 2b20 2220 266e 6273 703b 266e 6273  e + " &nbsp;&nbs
-0000b930: 703b 266e 6273 703b 2220 2b20 6869 6e74  p;&nbsp;" + hint
-0000b940: 5f68 746d 6c0a 2020 2020 2020 2020 7365  _html.        se
-0000b950: 6c66 2e5f 6469 762e 6170 7065 6e64 4368  lf._div.appendCh
-0000b960: 696c 6428 6974 656d 290a 2020 2020 2020  ild(item).      
-0000b970: 2020 2320 4164 6420 7375 6767 6573 7469    # Add suggesti
-0000b980: 6f6e 730a 2020 2020 2020 2020 7365 6c66  ons.        self
-0000b990: 2e5f 7375 6767 6573 7465 645f 7461 6773  ._suggested_tags
-0000b9a0: 5f69 6e5f 6175 746f 636f 6d70 203d 205b  _in_autocomp = [
-0000b9b0: 5d0a 2020 2020 2020 2020 666f 7220 7465  ].        for te
-0000b9c0: 7874 2c20 6874 6d6c 2069 6e20 7375 6767  xt, html in sugg
-0000b9d0: 6573 7469 6f6e 733a 2020 2320 7465 7874  estions:  # text
-0000b9e0: 2069 7320 6120 7461 6720 6f72 2061 2070   is a tag or a p
-0000b9f0: 7265 7365 740a 2020 2020 2020 2020 2020  reset.          
-0000ba00: 2020 7365 6c66 2e5f 7375 6767 6573 7465    self._suggeste
-0000ba10: 645f 7461 6773 5f69 6e5f 6175 746f 636f  d_tags_in_autoco
-0000ba20: 6d70 2e70 7573 6828 7465 7874 290a 2020  mp.push(text).  
-0000ba30: 2020 2020 2020 2020 2020 6920 3d20 6c65            i = le
-0000ba40: 6e28 7365 6c66 2e5f 7375 6767 6573 7465  n(self._suggeste
-0000ba50: 645f 7461 6773 5f69 6e5f 6175 746f 636f  d_tags_in_autoco
-0000ba60: 6d70 2920 2d20 310a 2020 2020 2020 2020  mp) - 1.        
-0000ba70: 2020 2020 6974 656d 203d 2064 6f63 756d      item = docum
-0000ba80: 656e 742e 6372 6561 7465 456c 656d 656e  ent.createElemen
-0000ba90: 7428 2264 6976 2229 0a20 2020 2020 2020  t("div").       
-0000baa0: 2020 2020 2069 7465 6d2e 636c 6173 734c       item.classL
-0000bab0: 6973 742e 6164 6428 2274 6167 2d73 7567  ist.add("tag-sug
-0000bac0: 6765 7374 696f 6e22 290a 2020 2020 2020  gestion").      
-0000bad0: 2020 2020 2020 6974 656d 2e69 6e6e 6572        item.inner
-0000bae0: 4854 4d4c 203d 2068 746d 6c0a 2020 2020  HTML = html.    
-0000baf0: 2020 2020 2020 2020 6f6e 636c 6963 6b20          onclick 
-0000bb00: 3d20 6622 7769 6e64 6f77 2e5f 6175 746f  = f"window._auto
-0000bb10: 636f 6d70 5f66 696e 6973 6828 6576 656e  comp_finish(even
-0000bb20: 742c 207b 697d 293b 220a 2020 2020 2020  t, {i});".      
-0000bb30: 2020 2020 2020 6974 656d 2e73 6574 4174        item.setAt
-0000bb40: 7472 6962 7574 6528 226f 6e6d 6f75 7365  tribute("onmouse
-0000bb50: 646f 776e 222c 206f 6e63 6c69 636b 290a  down", onclick).
-0000bb60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000bb70: 2e5f 6469 762e 6170 7065 6e64 4368 696c  ._div.appendChil
-0000bb80: 6428 6974 656d 290a 2020 2020 2020 2020  d(item).        
-0000bb90: 2320 5368 6f77 0a20 2020 2020 2020 2073  # Show.        s
-0000bba0: 656c 662e 5f73 656c 6563 745f 646f 6573  elf._select_does
-0000bbb0: 5f72 6570 6c61 6365 203d 2022 6465 7363  _replace = "desc
-0000bbc0: 7269 7074 696f 6e73 2220 696e 2068 6561  riptions" in hea
-0000bbd0: 646c 696e 650a 2020 2020 2020 2020 7365  dline.        se
-0000bbe0: 6c66 2e5f 6469 762e 6869 6464 656e 203d  lf._div.hidden =
-0000bbf0: 2046 616c 7365 0a20 2020 2020 2020 2073   False.        s
-0000bc00: 656c 662e 5f6d 616b 655f 6163 7469 7665  elf._make_active
-0000bc10: 2830 290a 0a20 2020 2064 6566 205f 6d61  (0)..    def _ma
-0000bc20: 6b65 5f61 6374 6976 6528 7365 6c66 2c20  ke_active(self, 
-0000bc30: 696e 6465 7829 3a0a 2020 2020 2020 2020  index):.        
-0000bc40: 6175 746f 636f 6d70 5f63 6f75 6e74 203d  autocomp_count =
-0000bc50: 206c 656e 2873 656c 662e 5f73 7567 6765   len(self._sugge
-0000bc60: 7374 6564 5f74 6167 735f 696e 5f61 7574  sted_tags_in_aut
-0000bc70: 6f63 6f6d 7029 0a20 2020 2020 2020 2023  ocomp).        #
-0000bc80: 2043 6f72 7265 6374 2069 6e64 6578 2028   Correct index (
-0000bc90: 7772 6170 2061 726f 756e 6429 0a20 2020  wrap around).   
-0000bca0: 2020 2020 2077 6869 6c65 2069 6e64 6578       while index
-0000bcb0: 203c 2030 3a0a 2020 2020 2020 2020 2020   < 0:.          
-0000bcc0: 2020 696e 6465 7820 2b3d 2061 7574 6f63    index += autoc
-0000bcd0: 6f6d 705f 636f 756e 740a 2020 2020 2020  omp_count.      
-0000bce0: 2020 7365 6c66 2e5f 696e 6465 7820 3d20    self._index = 
-0000bcf0: 696e 6465 7820 2520 6175 746f 636f 6d70  index % autocomp
-0000bd00: 5f63 6f75 6e74 0a20 2020 2020 2020 2069  _count.        i
-0000bd10: 6620 6e6f 7420 6175 746f 636f 6d70 5f63  f not autocomp_c
-0000bd20: 6f75 6e74 3a0a 2020 2020 2020 2020 2020  ount:.          
-0000bd30: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
-0000bd40: 2023 2041 7070 6c79 0a20 2020 2020 2020   # Apply.       
-0000bd50: 2073 656c 662e 5f61 6374 6976 655f 7375   self._active_su
-0000bd60: 6767 6573 7469 6f6e 203d 2073 656c 662e  ggestion = self.
-0000bd70: 5f73 7567 6765 7374 6564 5f74 6167 735f  _suggested_tags_
-0000bd80: 696e 5f61 7574 6f63 6f6d 705b 7365 6c66  in_autocomp[self
-0000bd90: 2e5f 696e 6465 785d 0a20 2020 2020 2020  ._index].       
-0000bda0: 2023 2046 6978 2063 7373 2063 6c61 7373   # Fix css class
-0000bdb0: 0a20 2020 2020 2020 2066 6f72 2069 2069  .        for i i
-0000bdc0: 6e20 7261 6e67 6528 7365 6c66 2e5f 6469  n range(self._di
-0000bdd0: 762e 6368 696c 6472 656e 2e6c 656e 6774  v.children.lengt
-0000bde0: 6829 3a0a 2020 2020 2020 2020 2020 2020  h):.            
-0000bdf0: 7365 6c66 2e5f 6469 762e 6368 696c 6472  self._div.childr
-0000be00: 656e 5b69 5d2e 636c 6173 734c 6973 742e  en[i].classList.
-0000be10: 7265 6d6f 7665 2822 6163 7469 7665 2229  remove("active")
-0000be20: 0a20 2020 2020 2020 2063 6869 6c64 5f69  .        child_i
-0000be30: 6e64 6578 203d 2073 656c 662e 5f69 6e64  ndex = self._ind
-0000be40: 6578 202b 2031 0a20 2020 2020 2020 2061  ex + 1.        a
-0000be50: 6374 6976 655f 6368 696c 6420 3d20 7365  ctive_child = se
-0000be60: 6c66 2e5f 6469 762e 6368 696c 6472 656e  lf._div.children
-0000be70: 5b63 6869 6c64 5f69 6e64 6578 5d0a 2020  [child_index].  
-0000be80: 2020 2020 2020 6163 7469 7665 5f63 6869        active_chi
-0000be90: 6c64 2e63 6c61 7373 4c69 7374 2e61 6464  ld.classList.add
-0000bea0: 2822 6163 7469 7665 2229 0a20 2020 2020  ("active").     
-0000beb0: 2020 2023 204d 616b 6520 636f 7272 6573     # Make corres
-0000bec0: 706f 6e64 696e 6720 6974 656d 2076 6973  ponding item vis
-0000bed0: 6962 6c65 0a20 2020 2020 2020 2061 6374  ible.        act
-0000bee0: 6976 655f 6368 696c 642e 7363 726f 6c6c  ive_child.scroll
-0000bef0: 496e 746f 5669 6577 287b 2262 6c6f 636b  IntoView({"block
-0000bf00: 223a 2022 6e65 6172 6573 7422 7d29 0a0a  ": "nearest"})..
-0000bf10: 2020 2020 6465 6620 5f66 696e 6973 685f      def _finish_
-0000bf20: 6362 2873 656c 662c 2065 2c20 6929 3a0a  cb(self, e, i):.
-0000bf30: 2020 2020 2020 2020 2320 4361 6c6c 6564          # Called
-0000bf40: 2077 6865 6e20 7468 6520 6175 746f 636f   when the autoco
-0000bf50: 6d70 2069 7465 6d20 6973 2063 6c69 636b  mp item is click
-0000bf60: 6564 0a20 2020 2020 2020 2073 656c 662e  ed.        self.
-0000bf70: 5f66 696e 6973 6828 7365 6c66 2e5f 7375  _finish(self._su
-0000bf80: 6767 6573 7465 645f 7461 6773 5f69 6e5f  ggested_tags_in_
-0000bf90: 6175 746f 636f 6d70 5b69 5d29 0a20 2020  autocomp[i]).   
-0000bfa0: 2020 2020 2069 6620 6520 616e 6420 652e       if e and e.
-0000bfb0: 7374 6f70 5072 6f70 6167 6174 696f 6e3a  stopPropagation:
-0000bfc0: 0a20 2020 2020 2020 2020 2020 2065 2e73  .            e.s
-0000bfd0: 746f 7050 726f 7061 6761 7469 6f6e 2829  topPropagation()
-0000bfe0: 0a20 2020 2020 2020 2020 2020 2065 2e70  .            e.p
-0000bff0: 7265 7665 6e74 4465 6661 756c 7428 290a  reventDefault().
-0000c000: 0a20 2020 2064 6566 205f 6669 6e69 7368  .    def _finish
-0000c010: 2873 656c 662c 2074 6578 7429 3a0a 2020  (self, text):.  
-0000c020: 2020 2020 2020 7365 6c66 2e63 6c65 6172        self.clear
-0000c030: 2829 0a20 2020 2020 2020 2069 6620 7465  ().        if te
-0000c040: 7874 3a0a 2020 2020 2020 2020 2020 2020  xt:.            
-0000c050: 6966 2073 656c 662e 5f73 656c 6563 745f  if self._select_
-0000c060: 646f 6573 5f72 6570 6c61 6365 3a0a 2020  does_replace:.  
-0000c070: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000c080: 5265 6365 6e74 2064 732c 206a 7573 7420  Recent ds, just 
-0000c090: 7265 706c 6163 6520 7468 6520 7768 6f6c  replace the whol
-0000c0a0: 6520 7468 696e 670a 2020 2020 2020 2020  e thing.        
-0000c0b0: 2020 2020 2020 2020 7365 6c66 2e5f 696e          self._in
-0000c0c0: 7075 742e 7661 6c75 6520 3d20 7465 7874  put.value = text
-0000c0d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c0e0: 2073 656c 662e 5f69 6e70 7574 2e73 656c   self._input.sel
-0000c0f0: 6563 7469 6f6e 5374 6172 7420 3d20 7365  ectionStart = se
-0000c100: 6c66 2e5f 696e 7075 742e 7365 6c65 6374  lf._input.select
-0000c110: 696f 6e45 6e64 203d 206c 656e 2874 6578  ionEnd = len(tex
-0000c120: 7429 0a20 2020 2020 2020 2020 2020 2065  t).            e
-0000c130: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000c140: 2020 2020 2023 2041 7070 656e 642f 696e       # Append/in
-0000c150: 7365 7274 2074 6865 2074 6167 2f70 7265  sert the tag/pre
-0000c160: 7365 740a 2020 2020 2020 2020 2020 2020  set.            
-0000c170: 2020 2020 2320 4765 7420 7072 6520 616e      # Get pre an
-0000c180: 6420 706f 7374 2070 6172 742c 2069 6e20  d post part, in 
-0000c190: 6265 7477 6565 6e20 7768 6963 6820 7765  between which we
-0000c1a0: 2070 7574 2074 6865 206e 6577 2074 6578   put the new tex
-0000c1b0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-0000c1c0: 2020 7661 6c2c 2069 312c 2069 3220 3d20    val, i1, i2 = 
-0000c1d0: 7365 6c66 2e5f 7374 6174 650a 2020 2020  self._state.    
-0000c1e0: 2020 2020 2020 2020 2020 2020 7072 6520              pre 
-0000c1f0: 3d20 7661 6c5b 3a69 315d 2e72 7374 7269  = val[:i1].rstri
-0000c200: 7028 2223 2229 2e72 7374 7269 7028 2220  p("#").rstrip(" 
-0000c210: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0000c220: 2020 2070 6f73 7420 3d20 7661 6c5b 6932     post = val[i2
-0000c230: 3a5d 2e6c 7374 7269 7028 2220 2229 0a20  :].lstrip(" "). 
-0000c240: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000c250: 6620 7072 653a 0a20 2020 2020 2020 2020  f pre:.         
-0000c260: 2020 2020 2020 2020 2020 2070 7265 203d             pre =
-0000c270: 2070 7265 202b 2022 2022 0a20 2020 2020   pre + " ".     
-0000c280: 2020 2020 2020 2020 2020 2023 2043 6f6d             # Com
-0000c290: 706f 7365 206e 6577 2076 616c 7565 0a20  pose new value. 
-0000c2a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000c2b0: 656c 662e 5f69 6e70 7574 2e76 616c 7565  elf._input.value
-0000c2c0: 203d 2070 7265 202b 2074 6578 7420 2b20   = pre + text + 
-0000c2d0: 2220 2220 2b20 706f 7374 0a20 2020 2020  " " + post.     
-0000c2e0: 2020 2020 2020 2020 2020 2023 2050 7574             # Put
-0000c2f0: 2073 656c 6563 7469 6f6e 2061 7420 7468   selection at th
-0000c300: 6520 656e 6420 6f66 2074 6865 2069 6e73  e end of the ins
-0000c310: 6572 7465 6420 7465 7874 0a20 2020 2020  erted text.     
-0000c320: 2020 2020 2020 2020 2020 2063 7572 736f             curso
-0000c330: 725f 706f 7320 3d20 6c65 6e28 7072 6529  r_pos = len(pre)
-0000c340: 202b 206c 656e 2874 6578 7429 202b 2031   + len(text) + 1
-0000c350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c360: 2073 656c 662e 5f69 6e70 7574 2e73 656c   self._input.sel
-0000c370: 6563 7469 6f6e 5374 6172 7420 3d20 7365  ectionStart = se
-0000c380: 6c66 2e5f 696e 7075 742e 7365 6c65 6374  lf._input.select
-0000c390: 696f 6e45 6e64 203d 2063 7572 736f 725f  ionEnd = cursor_
-0000c3a0: 706f 730a 2020 2020 2020 2020 2020 2020  pos.            
-0000c3b0: 6966 2075 7469 6c73 2e6c 6f6f 6b73 5f6c  if utils.looks_l
-0000c3c0: 696b 655f 6465 736b 746f 7028 293a 0a20  ike_desktop():. 
-0000c3d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000c3e0: 656c 662e 5f69 6e70 7574 2e66 6f63 7573  elf._input.focus
-0000c3f0: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
-0000c400: 5f63 616c 6c62 6163 6b28 290a 0a20 2020  _callback()..   
-0000c410: 2064 6566 205f 6765 745f 7374 6174 6528   def _get_state(
-0000c420: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-0000c430: 2222 4765 7420 7468 6520 7061 7274 6961  ""Get the partia
-0000c440: 6c20 7461 6720 7468 6174 2069 7320 6265  l tag that is be
-0000c450: 696e 6720 7772 6974 7465 6e2e 2222 220a  ing written.""".
-0000c460: 2020 2020 2020 2020 2320 4765 7420 7661          # Get va
-0000c470: 6c75 6520 616e 6420 706f 7369 7469 6f6e  lue and position
-0000c480: 0a20 2020 2020 2020 2076 616c 203d 2073  .        val = s
-0000c490: 656c 662e 5f69 6e70 7574 2e76 616c 7565  elf._input.value
-0000c4a0: 0a20 2020 2020 2020 2069 3220 3d20 7365  .        i2 = se
-0000c4b0: 6c66 2e5f 696e 7075 742e 7365 6c65 6374  lf._input.select
-0000c4c0: 696f 6e53 7461 7274 0a20 2020 2020 2020  ionStart.       
-0000c4d0: 2023 2049 6620 7468 6520 696e 7075 7420   # If the input 
-0000c4e0: 656c 656d 656e 7420 646f 6573 206e 6f74  element does not
-0000c4f0: 2068 6176 6520 666f 6375 732c 2074 6869   have focus, thi
-0000c500: 7320 6973 2061 6c6c 2077 6520 6e65 6564  s is all we need
-0000c510: 0a20 2020 2020 2020 2069 6620 7769 6e64  .        if wind
-0000c520: 6f77 2e64 6f63 756d 656e 742e 6163 7469  ow.document.acti
-0000c530: 7665 456c 656d 656e 7420 6973 206e 6f74  veElement is not
-0000c540: 2073 656c 662e 5f69 6e70 7574 3a0a 2020   self._input:.  
-0000c550: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000c560: 2076 616c 2c20 6932 2c20 6932 0a20 2020   val, i2, i2.   
-0000c570: 2020 2020 2023 204f 7468 6572 7769 7365       # Otherwise
-0000c580: 2077 6520 7472 7920 746f 2066 696e 6420   we try to find 
-0000c590: 7468 6520 7374 6172 7420 6f66 2074 6865  the start of the
-0000c5a0: 2077 7269 7474 656e 2074 6167 0a20 2020   written tag.   
-0000c5b0: 2020 2020 2069 203d 2069 3220 2d20 310a       i = i2 - 1.
-0000c5c0: 2020 2020 2020 2020 7768 696c 6520 6920          while i 
-0000c5d0: 3e3d 2030 3a0a 2020 2020 2020 2020 2020  >= 0:.          
-0000c5e0: 2020 6320 3d20 7661 6c5b 695d 0a20 2020    c = val[i].   
-0000c5f0: 2020 2020 2020 2020 2069 6620 6320 3d3d           if c ==
-0000c600: 2022 2322 3a0a 2020 2020 2020 2020 2020   "#":.          
-0000c610: 2020 2020 2020 7265 7475 726e 2076 616c        return val
-0000c620: 2c20 692c 2069 320a 2020 2020 2020 2020  , i, i2.        
-0000c630: 2020 2020 656c 6966 206e 6f74 2075 7469      elif not uti
-0000c640: 6c73 2e69 735f 7661 6c69 645f 7461 675f  ls.is_valid_tag_
-0000c650: 6368 6172 636f 6465 286f 7264 2863 2929  charcode(ord(c))
-0000c660: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000c670: 2020 7265 7475 726e 2076 616c 2c20 6932    return val, i2
-0000c680: 2c20 6932 0a20 2020 2020 2020 2020 2020  , i2.           
-0000c690: 2069 202d 3d20 310a 2020 2020 2020 2020   i -= 1.        
-0000c6a0: 7265 7475 726e 2076 616c 2c20 6932 2c20  return val, i2, 
-0000c6b0: 6932 0a0a 2020 2020 6465 6620 5f67 6574  i2..    def _get
-0000c6c0: 5f73 7567 6765 7374 6564 5f74 6167 735f  _suggested_tags_
-0000c6d0: 7072 6573 6574 7328 7365 6c66 293a 0a20  presets(self):. 
-0000c6e0: 2020 2020 2020 2022 2222 4765 7420 7375         """Get su
-0000c6f0: 6767 6573 7465 6420 7461 6773 2062 6173  ggested tags bas
-0000c700: 6564 206f 6e20 7468 6520 7072 6573 6574  ed on the preset
-0000c710: 732e 2222 220a 2020 2020 2020 2020 6974  s.""".        it
-0000c720: 656d 203d 2077 696e 646f 772e 7374 6f72  em = window.stor
-0000c730: 652e 7365 7474 696e 6773 2e67 6574 5f62  e.settings.get_b
-0000c740: 795f 6b65 7928 2274 6167 5f70 7265 7365  y_key("tag_prese
-0000c750: 7473 2229 0a20 2020 2020 2020 2070 7265  ts").        pre
-0000c760: 7365 7473 203d 2028 4e6f 6e65 2069 6620  sets = (None if 
-0000c770: 6974 656d 2069 7320 4e6f 6e65 2065 6c73  item is None els
-0000c780: 6520 6974 656d 2e76 616c 7565 2920 6f72  e item.value) or
-0000c790: 205b 5d0a 2020 2020 2020 2020 7265 7475   [].        retu
-0000c7a0: 726e 205b 7072 6573 6574 2066 6f72 2070  rn [preset for p
-0000c7b0: 7265 7365 7420 696e 2070 7265 7365 7473  reset in presets
-0000c7c0: 2069 6620 7072 6573 6574 5d0a 0a20 2020   if preset]..   
-0000c7d0: 2064 6566 205f 6765 745f 7375 6767 6573   def _get_sugges
-0000c7e0: 7465 645f 7461 6773 5f61 6c6c 5f64 6963  ted_tags_all_dic
-0000c7f0: 7428 7365 6c66 2c20 666f 7263 653d 4661  t(self, force=Fa
-0000c800: 6c73 6529 3a0a 2020 2020 2020 2020 2222  lse):.        ""
-0000c810: 2247 6574 202a 616c 6c2a 2074 6167 7320  "Get *all* tags 
-0000c820: 6576 6572 2075 7365 642e 2222 220a 2020  ever used.""".  
-0000c830: 2020 2020 2020 5053 4352 4950 545f 4f56        PSCRIPT_OV
-0000c840: 4552 4c4f 4144 203d 2046 616c 7365 2020  ERLOAD = False  
-0000c850: 2320 6e6f 7161 0a20 2020 2020 2020 2067  # noqa.        g
-0000c860: 6c6f 6261 6c20 636f 6d70 6c65 7465 725f  lobal completer_
-0000c870: 616c 6c5f 7461 6773 0a20 2020 2020 2020  all_tags.       
-0000c880: 2069 6620 666f 7263 6520 6f72 2063 6f6d   if force or com
-0000c890: 706c 6574 6572 5f61 6c6c 5f74 6167 7320  pleter_all_tags 
-0000c8a0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0000c8b0: 2020 2020 2073 7567 6765 7374 6564 5f74       suggested_t
-0000c8c0: 6167 7320 3d20 7b7d 0a20 2020 2020 2020  ags = {}.       
-0000c8d0: 2020 2020 2066 6f72 2072 2069 6e20 7769       for r in wi
-0000c8e0: 6e64 6f77 2e73 746f 7265 2e72 6563 6f72  ndow.store.recor
-0000c8f0: 6473 2e67 6574 5f64 756d 7028 293a 0a20  ds.get_dump():. 
-0000c900: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0000c910: 6167 732c 205f 203d 2075 7469 6c73 2e67  ags, _ = utils.g
-0000c920: 6574 5f74 6167 735f 616e 645f 7061 7274  et_tags_and_part
-0000c930: 735f 6672 6f6d 5f73 7472 696e 6728 722e  s_from_string(r.
-0000c940: 6473 290a 2020 2020 2020 2020 2020 2020  ds).            
-0000c950: 2020 2020 666f 7220 7461 6720 696e 2074      for tag in t
-0000c960: 6167 733a 0a20 2020 2020 2020 2020 2020  ags:.           
-0000c970: 2020 2020 2020 2020 2073 7567 6765 7374           suggest
-0000c980: 6564 5f74 6167 735b 7461 675d 203d 206d  ed_tags[tag] = m
-0000c990: 6178 2872 2e74 322c 2073 7567 6765 7374  ax(r.t2, suggest
-0000c9a0: 6564 5f74 6167 735b 7461 675d 207c 2030  ed_tags[tag] | 0
-0000c9b0: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
-0000c9c0: 6d70 6c65 7465 725f 616c 6c5f 7461 6773  mpleter_all_tags
-0000c9d0: 203d 2073 7567 6765 7374 6564 5f74 6167   = suggested_tag
-0000c9e0: 730a 2020 2020 2020 2020 7265 7475 726e  s.        return
-0000c9f0: 2063 6f6d 706c 6574 6572 5f61 6c6c 5f74   completer_all_t
-0000ca00: 6167 730a 0a20 2020 2064 6566 205f 6765  ags..    def _ge
-0000ca10: 745f 7375 6767 6573 7465 645f 7265 6365  t_suggested_rece
-0000ca20: 6e74 7328 7365 6c66 293a 0a20 2020 2020  nts(self):.     
-0000ca30: 2020 2022 2222 4765 7420 7265 6365 6e74     """Get recent
-0000ca40: 2074 6167 7320 616e 6420 6f72 6465 7220   tags and order 
-0000ca50: 6279 2074 6865 6972 2075 7361 6765 2f72  by their usage/r
-0000ca60: 6563 656e 742d 6e65 7373 2e22 2222 0a20  ecent-ness.""". 
-0000ca70: 2020 2020 2020 2023 2047 6574 2068 6973         # Get his
-0000ca80: 746f 7279 206f 6620 736f 6d65 7768 6174  tory of somewhat
-0000ca90: 2072 6563 656e 7420 7265 636f 7264 730a   recent records.
-0000caa0: 2020 2020 2020 2020 7432 203d 2064 742e          t2 = dt.
-0000cab0: 6e6f 7728 290a 2020 2020 2020 2020 7431  now().        t1
-0000cac0: 203d 2074 3220 2d20 3132 202a 2037 202a   = t2 - 12 * 7 *
-0000cad0: 2032 3420 2a20 3336 3030 2020 2320 3132   24 * 3600  # 12
-0000cae0: 2077 6565 6b73 2c20 6162 6f75 7420 6120   weeks, about a 
-0000caf0: 7175 6172 7465 7220 7965 6172 0a20 2020  quarter year.   
-0000cb00: 2020 2020 2072 6563 6f72 6473 203d 2077       records = w
-0000cb10: 696e 646f 772e 7374 6f72 652e 7265 636f  indow.store.reco
-0000cb20: 7264 732e 6765 745f 7265 636f 7264 7328  rds.get_records(
-0000cb30: 7431 2c20 7432 290a 2020 2020 2020 2020  t1, t2).        
-0000cb40: 2320 4170 706c 7920 5363 6f72 650a 2020  # Apply Score.  
-0000cb50: 2020 2020 2020 7461 6773 5f74 6f5f 7363        tags_to_sc
-0000cb60: 6f72 6573 203d 207b 7d0a 2020 2020 2020  ores = {}.      
-0000cb70: 2020 7461 6773 5f74 6f5f 7432 203d 207b    tags_to_t2 = {
-0000cb80: 7d0a 2020 2020 2020 2020 6465 7363 7269  }.        descri
-0000cb90: 7074 696f 6e73 203d 207b 7d0a 2020 2020  ptions = {}.    
-0000cba0: 2020 2020 666f 7220 7220 696e 2072 6563      for r in rec
-0000cbb0: 6f72 6473 2e76 616c 7565 7328 293a 0a20  ords.values():. 
-0000cbc0: 2020 2020 2020 2020 2020 2064 6573 6372             descr
-0000cbd0: 6970 7469 6f6e 735b 722e 6473 5d20 3d20  iptions[r.ds] = 
-0000cbe0: 6d61 7828 722e 7432 2c20 6465 7363 7269  max(r.t2, descri
-0000cbf0: 7074 696f 6e73 5b72 2e64 735d 207c 2030  ptions[r.ds] | 0
-0000cc00: 290a 2020 2020 2020 2020 2020 2020 7461  ).            ta
-0000cc10: 6773 2c20 5f20 3d20 7574 696c 732e 6765  gs, _ = utils.ge
-0000cc20: 745f 7461 6773 5f61 6e64 5f70 6172 7473  t_tags_and_parts
-0000cc30: 5f66 726f 6d5f 7374 7269 6e67 2872 2e64  _from_string(r.d
-0000cc40: 7329 0a20 2020 2020 2020 2020 2020 2073  s).            s
-0000cc50: 636f 7265 203d 2031 202f 2028 7432 202d  core = 1 / (t2 -
-0000cc60: 2072 2e74 3129 0a20 2020 2020 2020 2020   r.t1).         
-0000cc70: 2020 2066 6f72 2074 6167 2069 6e20 7461     for tag in ta
-0000cc80: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-0000cc90: 2020 2020 7461 6773 5f74 6f5f 7432 5b74      tags_to_t2[t
-0000cca0: 6167 5d20 3d20 6d61 7828 722e 7432 2c20  ag] = max(r.t2, 
-0000ccb0: 7461 6773 5f74 6f5f 7432 5b74 6167 5d20  tags_to_t2[tag] 
-0000ccc0: 7c20 3029 0a20 2020 2020 2020 2020 2020  | 0).           
-0000ccd0: 2020 2020 2074 6167 735f 746f 5f73 636f       tags_to_sco
-0000cce0: 7265 735b 7461 675d 203d 2028 7461 6773  res[tag] = (tags
-0000ccf0: 5f74 6f5f 7363 6f72 6573 5b74 6167 5d20  _to_scores[tag] 
-0000cd00: 7c20 3029 202b 2073 636f 7265 0a20 2020  | 0) + score.   
-0000cd10: 2020 2020 2023 2050 7574 2064 7320 696e       # Put ds in
-0000cd20: 2061 206c 6973 740a 2020 2020 2020 2020   a list.        
-0000cd30: 6473 5f6c 6973 7420 3d20 6c69 7374 2864  ds_list = list(d
-0000cd40: 6573 6372 6970 7469 6f6e 732e 6974 656d  escriptions.item
-0000cd50: 7328 2929 0a20 2020 2020 2020 2064 735f  s()).        ds_
-0000cd60: 6c69 7374 2e73 6f72 7428 6b65 793d 6c61  list.sort(key=la
-0000cd70: 6d62 6461 2078 3a20 2d78 5b31 5d29 0a20  mbda x: -x[1]). 
-0000cd80: 2020 2020 2020 2023 2050 7574 2074 6167         # Put tag
-0000cd90: 7320 696e 2061 206c 6973 740a 2020 2020  s in a list.    
-0000cda0: 2020 2020 7363 6f72 655f 7461 675f 6c69      score_tag_li
-0000cdb0: 7374 203d 205b 5d0a 2020 2020 2020 2020  st = [].        
-0000cdc0: 666f 7220 7461 6720 696e 2074 6167 735f  for tag in tags_
-0000cdd0: 746f 5f73 636f 7265 732e 6b65 7973 2829  to_scores.keys()
-0000cde0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0000cdf0: 2074 6167 203d 3d20 2223 756e 7461 6767   tag == "#untagg
-0000ce00: 6564 223a 0a20 2020 2020 2020 2020 2020  ed":.           
-0000ce10: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
-0000ce20: 2020 2020 2020 2020 2020 7363 6f72 655f            score_
-0000ce30: 7461 675f 6c69 7374 2e70 7573 6828 2874  tag_list.push((t
-0000ce40: 6167 2c20 7461 6773 5f74 6f5f 7432 5b74  ag, tags_to_t2[t
-0000ce50: 6167 5d2c 2074 6167 735f 746f 5f73 636f  ag], tags_to_sco
-0000ce60: 7265 735b 7461 675d 2929 0a20 2020 2020  res[tag])).     
-0000ce70: 2020 2023 2053 6f72 7420 6279 2073 636f     # Sort by sco
-0000ce80: 7265 2061 6e64 2074 7269 6d20 6e61 6d65  re and trim name
-0000ce90: 730a 2020 2020 2020 2020 7363 6f72 655f  s.        score_
-0000cea0: 7461 675f 6c69 7374 2e73 6f72 7428 6b65  tag_list.sort(ke
-0000ceb0: 793d 6c61 6d62 6461 2078 3a20 2d78 5b32  y=lambda x: -x[2
-0000cec0: 5d29 0a20 2020 2020 2020 2074 6167 5f6c  ]).        tag_l
-0000ced0: 6973 7420 3d20 5b73 636f 7265 5f74 6167  ist = [score_tag
-0000cee0: 5b3a 325d 2066 6f72 2073 636f 7265 5f74  [:2] for score_t
-0000cef0: 6167 2069 6e20 7363 6f72 655f 7461 675f  ag in score_tag_
-0000cf00: 6c69 7374 5d0a 2020 2020 2020 2020 7265  list].        re
-0000cf10: 7475 726e 2064 735f 6c69 7374 2c20 7461  turn ds_list, ta
-0000cf20: 675f 6c69 7374 0a0a 2020 2020 6465 6620  g_list..    def 
-0000cf30: 5f67 6574 5f73 7567 6765 7374 6564 5f74  _get_suggested_t
-0000cf40: 6167 735f 636f 6d62 696e 6564 2873 656c  ags_combined(sel
-0000cf50: 6629 3a0a 2020 2020 2020 2020 2222 2243  f):.        """C
-0000cf60: 6f6d 6269 6e65 2074 6865 2066 756c 6c20  ombine the full 
-0000cf70: 7461 6720 6469 6374 2077 6974 6820 7468  tag dict with th
-0000cf80: 6520 6d6f 7265 2072 6563 656e 7420 7461  e more recent ta
-0000cf90: 6773 2e22 2222 0a20 2020 2020 2020 2023  gs.""".        #
-0000cfa0: 2043 6f6c 6c65 6374 0a20 2020 2020 2020   Collect.       
-0000cfb0: 2074 6167 735f 6469 6374 203d 207b 7d0a   tags_dict = {}.
-0000cfc0: 2020 2020 2020 2020 6e65 775f 7461 6773          new_tags
-0000cfd0: 203d 205b 5d0a 2020 2020 2020 2020 6966   = [].        if
-0000cfe0: 2073 656c 662e 5f6d 6f64 655f 6d61 736b   self._mode_mask
-0000cff0: 2026 2031 3a0a 2020 2020 2020 2020 2020   & 1:.          
-0000d000: 2020 7461 6773 5f64 6963 7420 3d20 7365    tags_dict = se
-0000d010: 6c66 2e5f 6765 745f 7375 6767 6573 7465  lf._get_suggeste
-0000d020: 645f 7461 6773 5f61 6c6c 5f64 6963 7428  d_tags_all_dict(
-0000d030: 7365 6c66 2e5f 6d6f 6465 5f6d 6173 6b20  self._mode_mask 
-0000d040: 3d3d 2031 292e 636f 7079 2829 0a20 2020  == 1).copy().   
-0000d050: 2020 2020 2069 6620 7365 6c66 2e5f 6d6f       if self._mo
-0000d060: 6465 5f6d 6173 6b20 2620 323a 0a20 2020  de_mask & 2:.   
-0000d070: 2020 2020 2020 2020 206e 6577 5f74 6167           new_tag
-0000d080: 7320 3d20 7365 6c66 2e5f 7375 6767 6573  s = self._sugges
-0000d090: 7465 645f 7461 6773 5f72 6563 656e 740a  ted_tags_recent.
-0000d0a0: 2020 2020 2020 2020 2320 436f 6d62 696e          # Combin
-0000d0b0: 650a 2020 2020 2020 2020 666f 7220 7461  e.        for ta
-0000d0c0: 672c 2074 6167 5f74 3220 696e 206e 6577  g, tag_t2 in new
-0000d0d0: 5f74 6167 733a 0a20 2020 2020 2020 2020  _tags:.         
-0000d0e0: 2020 2074 6167 735f 6469 6374 5b74 6167     tags_dict[tag
-0000d0f0: 5d20 3d20 7461 675f 7432 0a20 2020 2020  ] = tag_t2.     
-0000d100: 2020 2023 2043 6f6d 706f 7365 2066 756c     # Compose ful
-0000d110: 6c20 7461 6720 7375 6767 6573 7469 6f6e  l tag suggestion
-0000d120: 7320 6c69 7374 0a20 2020 2020 2020 2074  s list.        t
-0000d130: 6167 5f6c 6973 7420 3d20 5b5d 0a20 2020  ag_list = [].   
-0000d140: 2020 2020 2066 6f72 2074 6167 2c20 7461       for tag, ta
-0000d150: 675f 7432 2069 6e20 7461 6773 5f64 6963  g_t2 in tags_dic
-0000d160: 742e 6974 656d 7328 293a 0a20 2020 2020  t.items():.     
-0000d170: 2020 2020 2020 2074 6167 5f6c 6973 742e         tag_list.
-0000d180: 7075 7368 2828 7461 672c 2074 6167 5f74  push((tag, tag_t
-0000d190: 3229 290a 2020 2020 2020 2020 7461 675f  2)).        tag_
-0000d1a0: 6c69 7374 2e73 6f72 7428 6b65 793d 6c61  list.sort(key=la
-0000d1b0: 6d62 6461 2078 3a20 785b 305d 290a 2020  mbda x: x[0]).  
-0000d1c0: 2020 2020 2020 7265 7475 726e 2074 6167        return tag
-0000d1d0: 5f6c 6973 740a 0a0a 636c 6173 7320 5265  _list...class Re
-0000d1e0: 636f 7264 4469 616c 6f67 2842 6173 6544  cordDialog(BaseD
-0000d1f0: 6961 6c6f 6729 3a0a 2020 2020 2222 2244  ialog):.    """D
-0000d200: 6961 6c6f 6720 746f 2061 6c6c 6f77 206d  ialog to allow m
-0000d210: 6f64 6966 7969 6e67 2061 2072 6563 6f72  odifying a recor
-0000d220: 6420 2873 6574 7469 6e67 2064 6573 6372  d (setting descr
-0000d230: 6970 7469 6f6e 2061 6e64 2074 696d 6573  iption and times
-0000d240: 292e 2222 220a 0a20 2020 2064 6566 205f  )."""..    def _
-0000d250: 5f69 6e69 745f 5f28 7365 6c66 2c20 6361  _init__(self, ca
-0000d260: 6e76 6173 293a 0a20 2020 2020 2020 2073  nvas):.        s
-0000d270: 7570 6572 2829 2e5f 5f69 6e69 745f 5f28  uper().__init__(
-0000d280: 6361 6e76 6173 290a 2020 2020 2020 2020  canvas).        
-0000d290: 7365 6c66 2e5f 7265 636f 7264 203d 204e  self._record = N
-0000d2a0: 6f6e 650a 2020 2020 2020 2020 7365 6c66  one.        self
-0000d2b0: 2e5f 6e6f 5f75 7365 725f 6564 6974 5f79  ._no_user_edit_y
-0000d2c0: 6574 203d 2054 7275 650a 0a20 2020 2064  et = True..    d
-0000d2d0: 6566 206f 7065 6e28 7365 6c66 2c20 6d6f  ef open(self, mo
-0000d2e0: 6465 2c20 7265 636f 7264 2c20 6361 6c6c  de, record, call
-0000d2f0: 6261 636b 3d4e 6f6e 6529 3a0a 2020 2020  back=None):.    
-0000d300: 2020 2020 2222 2253 686f 772f 6f70 656e      """Show/open
-0000d310: 2074 6865 2064 6961 6c6f 6720 666f 7220   the dialog for 
-0000d320: 7468 6520 6769 7665 6e20 7265 636f 7264  the given record
-0000d330: 2e20 4f6e 2073 7562 6d69 742c 2074 6865  . On submit, the
-0000d340: 0a20 2020 2020 2020 2072 6563 6f72 6420  .        record 
-0000d350: 7769 6c6c 2062 6520 7075 7368 6564 2074  will be pushed t
-0000d360: 6f20 7468 6520 7374 6f72 6520 616e 6420  o the store and 
-0000d370: 6361 6c6c 6261 636b 2028 6966 2067 6976  callback (if giv
-0000d380: 656e 2920 7769 6c6c 0a20 2020 2020 2020  en) will.       
-0000d390: 2062 6520 6361 6c6c 6564 2077 6974 6820   be called with 
-0000d3a0: 7468 6520 7265 636f 7264 2e20 4f6e 2063  the record. On c
-0000d3b0: 6c6f 7365 2f63 616e 6365 6c2c 2074 6865  lose/cancel, the
-0000d3c0: 2063 616c 6c62 6163 6b20 7769 6c6c 0a20   callback will. 
-0000d3d0: 2020 2020 2020 2062 6520 6361 6c6c 6564         be called
-0000d3e0: 2077 6974 686f 7574 2061 7267 756d 656e   without argumen
-0000d3f0: 7473 2e0a 2020 2020 2020 2020 2222 220a  ts..        """.
-0000d400: 2020 2020 2020 2020 7365 6c66 2e5f 7265          self._re
-0000d410: 636f 7264 203d 2072 6563 6f72 642e 636f  cord = record.co
-0000d420: 7079 2829 0a20 2020 2020 2020 2061 7373  py().        ass
-0000d430: 6572 7420 6d6f 6465 2e6c 6f77 6572 2829  ert mode.lower()
-0000d440: 2069 6e20 2822 7374 6172 7422 2c20 226e   in ("start", "n
-0000d450: 6577 222c 2022 6564 6974 222c 2022 7374  ew", "edit", "st
-0000d460: 6f70 2229 0a0a 2020 2020 2020 2020 6874  op")..        ht
-0000d470: 6d6c 203d 2066 2222 220a 2020 2020 2020  ml = f""".      
-0000d480: 2020 2020 2020 3c68 313e 3c69 2063 6c61        <h1><i cla
-0000d490: 7373 3d27 6661 7327 3e5c 7566 3638 323c  ss='fas'>\uf682<
-0000d4a0: 2f69 3e26 6e62 7370 3b26 6e62 7370 3b3c  /i>&nbsp;&nbsp;<
-0000d4b0: 7370 616e 3e52 6563 6f72 643c 2f73 7061  span>Record</spa
-0000d4c0: 6e3e 0a20 2020 2020 2020 2020 2020 2020  n>.             
-0000d4d0: 2020 203c 6275 7474 6f6e 2074 7970 653d     <button type=
-0000d4e0: 2762 7574 746f 6e27 3e3c 6920 636c 6173  'button'><i clas
-0000d4f0: 733d 2766 6173 273e 5c75 6630 3064 3c2f  s='fas'>\uf00d</
-0000d500: 693e 3c2f 6275 7474 6f6e 3e0a 2020 2020  i></button>.    
-0000d510: 2020 2020 2020 2020 3c2f 6831 3e0a 2020          </h1>.  
-0000d520: 2020 2020 2020 2020 2020 3c68 323e 3c69            <h2><i
-0000d530: 2063 6c61 7373 3d27 6661 7327 3e5c 7566   class='fas'>\uf
-0000d540: 3330 353c 2f69 3e26 6e62 7370 3b26 6e62  305</i>&nbsp;&nb
-0000d550: 7370 3b44 6573 6372 6970 7469 6f6e 3c2f  sp;Description</
-0000d560: 6832 3e0a 2020 2020 2020 2020 2020 2020  h2>.            
-0000d570: 3c64 6976 2063 6c61 7373 3d27 636f 6e74  <div class='cont
-0000d580: 6169 6e65 7227 2073 7479 6c65 3d27 706f  ainer' style='po
-0000d590: 7369 7469 6f6e 3a20 7265 6c61 7469 7665  sition: relative
-0000d5a0: 3b27 3e0a 2020 2020 2020 2020 2020 2020  ;'>.            
-0000d5b0: 2020 2020 3c69 6e70 7574 2074 7970 653d      <input type=
-0000d5c0: 2774 6578 7427 2073 7479 6c65 3d27 7769  'text' style='wi
-0000d5d0: 6474 683a 3130 3025 3b27 2073 7065 6c6c  dth:100%;' spell
-0000d5e0: 6368 6563 6b3d 2774 7275 6527 202f 3e0a  check='true' />.
-0000d5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d600: 3c64 6976 2063 6c61 7373 3d27 7461 672d  <div class='tag-
-0000d610: 7375 6767 6573 7469 6f6e 732d 6175 746f  suggestions-auto
-0000d620: 636f 6d70 273e 3c2f 6469 763e 0a20 2020  comp'></div>.   
-0000d630: 2020 2020 2020 2020 203c 2f64 6976 3e0a           </div>.
-0000d640: 2020 2020 2020 2020 2020 2020 3c64 6976              <div
-0000d650: 2063 6c61 7373 3d27 636f 6e74 6169 6e65   class='containe
-0000d660: 7227 2073 7479 6c65 3d27 6d69 6e2d 6865  r' style='min-he
-0000d670: 6967 6874 3a32 3070 783b 273e 0a20 2020  ight:20px;'>.   
-0000d680: 2020 2020 2020 2020 2020 2020 203c 6275               <bu
-0000d690: 7474 6f6e 2074 7970 653d 2762 7574 746f  tton type='butto
-0000d6a0: 6e27 2073 7479 6c65 3d27 666c 6f61 743a  n' style='float:
-0000d6b0: 7269 6768 743b 2066 6f6e 742d 7369 7a65  right; font-size
-0000d6c0: 3a37 3525 3b20 6d61 7267 696e 2d74 6f70  :75%; margin-top
-0000d6d0: 3a2d 3470 783b 273e 0a20 2020 2020 2020  :-4px;'>.       
-0000d6e0: 2020 2020 2020 2020 2020 2020 203c 6920               <i 
-0000d6f0: 636c 6173 733d 2766 6173 273e 5c75 6630  class='fas'>\uf0
-0000d700: 3434 3c2f 693e 3c2f 6275 7474 6f6e 3e0a  44</i></button>.
-0000d710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d720: 3c62 7574 746f 6e20 7479 7065 3d27 6275  <button type='bu
-0000d730: 7474 6f6e 2720 7374 796c 653d 2766 6c6f  tton' style='flo
-0000d740: 6174 3a72 6967 6874 3b20 666f 6e74 2d73  at:right; font-s
-0000d750: 697a 653a 3735 253b 206d 6172 6769 6e2d  ize:75%; margin-
-0000d760: 746f 703a 2d34 7078 3b27 3e0a 2020 2020  top:-4px;'>.    
-0000d770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d780: 5072 6573 6574 7320 3c69 2063 6c61 7373  Presets <i class
-0000d790: 3d27 6661 7327 3e5c 7566 3064 373c 2f69  ='fas'>\uf0d7</i
-0000d7a0: 3e3c 2f62 7574 746f 6e3e 0a20 2020 2020  ></button>.     
-0000d7b0: 2020 2020 2020 2020 2020 203c 6275 7474             <butt
-0000d7c0: 6f6e 2074 7970 653d 2762 7574 746f 6e27  on type='button'
-0000d7d0: 2073 7479 6c65 3d27 666c 6f61 743a 7269   style='float:ri
-0000d7e0: 6768 743b 2066 6f6e 742d 7369 7a65 3a37  ght; font-size:7
-0000d7f0: 3525 3b20 6d61 7267 696e 2d74 6f70 3a2d  5%; margin-top:-
-0000d800: 3470 783b 273e 0a20 2020 2020 2020 2020  4px;'>.         
-0000d810: 2020 2020 2020 2020 2020 2054 6167 7320             Tags 
-0000d820: 3c69 2063 6c61 7373 3d27 6661 7327 3e5c  <i class='fas'>\
-0000d830: 7566 3064 373c 2f69 3e3c 2f62 7574 746f  uf0d7</i></butto
-0000d840: 6e3e 0a20 2020 2020 2020 2020 2020 2020  n>.             
-0000d850: 2020 203c 6275 7474 6f6e 2074 7970 653d     <button type=
-0000d860: 2762 7574 746f 6e27 2073 7479 6c65 3d27  'button' style='
-0000d870: 666c 6f61 743a 7269 6768 743b 2066 6f6e  float:right; fon
-0000d880: 742d 7369 7a65 3a37 3525 3b20 6d61 7267  t-size:75%; marg
-0000d890: 696e 2d74 6f70 3a2d 3470 783b 273e 0a20  in-top:-4px;'>. 
-0000d8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d8b0: 2020 2052 6563 656e 7420 3c69 2063 6c61     Recent <i cla
-0000d8c0: 7373 3d27 6661 7327 3e5c 7566 3064 373c  ss='fas'>\uf0d7<
-0000d8d0: 2f69 3e3c 2f62 7574 746f 6e3e 0a20 2020  /i></button>.   
-0000d8e0: 2020 2020 2020 2020 203c 2f64 6976 3e0a           </div>.
-0000d8f0: 2020 2020 2020 2020 2020 2020 3c64 6976              <div
-0000d900: 3e3c 2f64 6976 3e0a 2020 2020 2020 2020  ></div>.        
-0000d910: 2020 2020 3c64 6976 2073 7479 6c65 3d27      <div style='
-0000d920: 636f 6c6f 723a 2337 3737 3b27 3e3c 2f64  color:#777;'></d
-0000d930: 6976 3e0a 2020 2020 2020 2020 2020 2020  iv>.            
-0000d940: 3c68 323e 3c69 2063 6c61 7373 3d27 6661  <h2><i class='fa
-0000d950: 7327 3e5c 7566 3031 373c 2f69 3e26 6e62  s'>\uf017</i>&nb
-0000d960: 7370 3b26 6e62 7370 3b54 696d 653c 2f68  sp;&nbsp;Time</h
-0000d970: 323e 0a20 2020 2020 2020 2020 2020 203c  2>.            <
-0000d980: 6469 763e 3c2f 6469 763e 0a20 2020 2020  div></div>.     
-0000d990: 2020 2020 2020 203c 6469 7620 7374 796c         <div styl
-0000d9a0: 653d 276d 6172 6769 6e2d 746f 703a 3265  e='margin-top:2e
-0000d9b0: 6d3b 273e 3c2f 6469 763e 0a20 2020 2020  m;'></div>.     
-0000d9c0: 2020 2020 2020 203c 6469 7620 7374 796c         <div styl
-0000d9d0: 653d 2764 6973 706c 6179 3a20 666c 6578  e='display: flex
-0000d9e0: 3b6a 7573 7469 6679 2d63 6f6e 7465 6e74  ;justify-content
-0000d9f0: 3a20 666c 6578 2d65 6e64 3b27 3e0a 2020  : flex-end;'>.  
-0000da00: 2020 2020 2020 2020 2020 2020 2020 3c62                <b
-0000da10: 7574 746f 6e20 7479 7065 3d27 6275 7474  utton type='butt
-0000da20: 6f6e 2720 636c 6173 733d 2761 6374 696f  on' class='actio
-0000da30: 6e62 7574 746f 6e27 3e3c 6920 636c 6173  nbutton'><i clas
-0000da40: 733d 2766 6173 273e 5c75 6630 3064 3c2f  s='fas'>\uf00d</
-0000da50: 693e 266e 6273 703b 266e 6273 703b 4361  i>&nbsp;&nbsp;Ca
-0000da60: 6e63 656c 3c2f 6275 7474 6f6e 3e0a 2020  ncel</button>.  
-0000da70: 2020 2020 2020 2020 2020 2020 2020 3c62                <b
-0000da80: 7574 746f 6e20 7479 7065 3d27 6275 7474  utton type='butt
-0000da90: 6f6e 2720 636c 6173 733d 2761 6374 696f  on' class='actio
-0000daa0: 6e62 7574 746f 6e27 3e3c 6920 636c 6173  nbutton'><i clas
-0000dab0: 733d 2766 6173 273e 5c75 6631 6638 3c2f  s='fas'>\uf1f8</
-0000dac0: 693e 266e 6273 703b 266e 6273 703b 4465  i>&nbsp;&nbsp;De
-0000dad0: 6c65 7465 3c2f 6275 7474 6f6e 3e0a 2020  lete</button>.  
-0000dae0: 2020 2020 2020 2020 2020 2020 2020 3c62                <b
-0000daf0: 7574 746f 6e20 7479 7065 3d27 6275 7474  utton type='butt
-0000db00: 6f6e 2720 636c 6173 733d 2761 6374 696f  on' class='actio
-0000db10: 6e62 7574 746f 6e27 3e3c 6920 636c 6173  nbutton'><i clas
-0000db20: 733d 2766 6173 273e 5c75 6632 3464 3c2f  s='fas'>\uf24d</
-0000db30: 693e 266e 6273 703b 266e 6273 703b 5265  i>&nbsp;&nbsp;Re
-0000db40: 7375 6d65 3c2f 6275 7474 6f6e 3e0a 2020  sume</button>.  
-0000db50: 2020 2020 2020 2020 2020 2020 2020 3c62                <b
-0000db60: 7574 746f 6e20 7479 7065 3d27 6275 7474  utton type='butt
-0000db70: 6f6e 2720 636c 6173 733d 2761 6374 696f  on' class='actio
-0000db80: 6e62 7574 746f 6e20 7375 626d 6974 273e  nbutton submit'>
-0000db90: 5375 626d 6974 3c2f 6275 7474 6f6e 3e0a  Submit</button>.
-0000dba0: 2020 2020 2020 2020 2020 2020 3c2f 6469              </di
-0000dbb0: 763e 0a20 2020 2020 2020 2020 2020 203c  v>.            <
-0000dbc0: 6275 7474 6f6e 2074 7970 653d 2762 7574  button type='but
-0000dbd0: 746f 6e27 2073 7479 6c65 3d27 666c 6f61  ton' style='floa
-0000dbe0: 743a 7269 6768 743b 2720 636c 6173 733d  t:right;' class=
-0000dbf0: 2761 6374 696f 6e62 7574 746f 6e27 3e43  'actionbutton'>C
-0000dc00: 6f6e 6669 726d 2064 656c 6574 696e 6720  onfirm deleting 
-0000dc10: 7468 6973 2072 6563 6f72 643c 2f62 7574  this record</but
-0000dc20: 746f 6e3e 0a20 2020 2020 2020 2022 2222  ton>.        """
-0000dc30: 0a20 2020 2020 2020 2073 656c 662e 6d61  .        self.ma
-0000dc40: 696e 6469 762e 696e 6e65 7248 544d 4c20  indiv.innerHTML 
-0000dc50: 3d20 6874 6d6c 0a0a 2020 2020 2020 2020  = html..        
-0000dc60: 2320 556e 7061 636b 2073 6f20 7765 2068  # Unpack so we h
-0000dc70: 6176 6520 616c 6c20 7468 6520 636f 6d70  ave all the comp
-0000dc80: 6f6e 656e 7473 0a20 2020 2020 2020 2028  onents.        (
-0000dc90: 0a20 2020 2020 2020 2020 2020 2068 312c  .            h1,
-0000dca0: 2020 2320 4469 616c 6f67 2074 6974 6c65    # Dialog title
-0000dcb0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000dcc0: 662e 5f64 735f 6865 6164 6572 2c0a 2020  f._ds_header,.  
-0000dcd0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0000dce0: 6473 5f63 6f6e 7461 696e 6572 2c0a 2020  ds_container,.  
-0000dcf0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0000dd00: 7072 6573 6574 5f63 6f6e 7461 696e 6572  preset_container
-0000dd10: 2c0a 2020 2020 2020 2020 2020 2020 7365  ,.            se
-0000dd20: 6c66 2e5f 7461 6773 5f64 6976 2c0a 2020  lf._tags_div,.  
-0000dd30: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0000dd40: 7461 675f 6869 6e74 735f 6469 762c 0a20  tag_hints_div,. 
-0000dd50: 2020 2020 2020 2020 2020 205f 2c20 2023             _,  #
-0000dd60: 2054 696d 6520 6865 6164 6572 0a20 2020   Time header.   
-0000dd70: 2020 2020 2020 2020 2073 656c 662e 5f74           self._t
-0000dd80: 696d 655f 6e6f 6465 2c0a 2020 2020 2020  ime_node,.      
-0000dd90: 2020 2020 2020 5f2c 2020 2320 5370 6c69        _,  # Spli
-0000dda0: 7474 6572 0a20 2020 2020 2020 2020 2020  tter.           
-0000ddb0: 2073 656c 662e 5f62 7574 746f 6e73 2c0a   self._buttons,.
-0000ddc0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000ddd0: 2e5f 6465 6c65 7465 5f62 7574 322c 0a20  ._delete_but2,. 
-0000dde0: 2020 2020 2020 2029 203d 2073 656c 662e         ) = self.
-0000ddf0: 6d61 696e 6469 762e 6368 696c 6472 656e  maindiv.children
-0000de00: 0a20 2020 2020 2020 2023 0a20 2020 2020  .        #.     
-0000de10: 2020 2073 656c 662e 5f64 735f 696e 7075     self._ds_inpu
-0000de20: 7420 3d20 7365 6c66 2e5f 6473 5f63 6f6e  t = self._ds_con
-0000de30: 7461 696e 6572 2e63 6869 6c64 7265 6e5b  tainer.children[
-0000de40: 305d 0a20 2020 2020 2020 2073 656c 662e  0].        self.
-0000de50: 5f61 7574 6f63 6f6d 706c 6574 6572 5f64  _autocompleter_d
-0000de60: 6976 203d 2073 656c 662e 5f64 735f 636f  iv = self._ds_co
-0000de70: 6e74 6169 6e65 722e 6368 696c 6472 656e  ntainer.children
-0000de80: 5b31 5d0a 2020 2020 2020 2020 7365 6c66  [1].        self
-0000de90: 2e5f 7265 6365 6e74 5f62 7574 203d 2073  ._recent_but = s
-0000dea0: 656c 662e 5f70 7265 7365 745f 636f 6e74  elf._preset_cont
-0000deb0: 6169 6e65 722e 6368 696c 6472 656e 5b33  ainer.children[3
-0000dec0: 5d0a 2020 2020 2020 2020 7365 6c66 2e5f  ].        self._
-0000ded0: 7461 6773 5f62 7574 203d 2073 656c 662e  tags_but = self.
-0000dee0: 5f70 7265 7365 745f 636f 6e74 6169 6e65  _preset_containe
-0000def0: 722e 6368 696c 6472 656e 5b32 5d0a 2020  r.children[2].  
-0000df00: 2020 2020 2020 7365 6c66 2e5f 7072 6573        self._pres
-0000df10: 6574 5f62 7574 203d 2073 656c 662e 5f70  et_but = self._p
-0000df20: 7265 7365 745f 636f 6e74 6169 6e65 722e  reset_container.
-0000df30: 6368 696c 6472 656e 5b31 5d0a 2020 2020  children[1].    
-0000df40: 2020 2020 7365 6c66 2e5f 7072 6573 6574      self._preset
-0000df50: 5f65 6469 7420 3d20 7365 6c66 2e5f 7072  _edit = self._pr
-0000df60: 6573 6574 5f63 6f6e 7461 696e 6572 2e63  eset_container.c
-0000df70: 6869 6c64 7265 6e5b 305d 0a20 2020 2020  hildren[0].     
-0000df80: 2020 2073 656c 662e 5f74 6974 6c65 5f64     self._title_d
-0000df90: 6976 203d 2068 312e 6368 696c 6472 656e  iv = h1.children
-0000dfa0: 5b31 5d0a 2020 2020 2020 2020 7365 6c66  [1].        self
-0000dfb0: 2e5f 6361 6e63 656c 5f62 7574 3120 3d20  ._cancel_but1 = 
-0000dfc0: 7365 6c66 2e6d 6169 6e64 6976 2e63 6869  self.maindiv.chi
-0000dfd0: 6c64 7265 6e5b 305d 2e63 6869 6c64 7265  ldren[0].childre
-0000dfe0: 6e5b 2d31 5d0a 2020 2020 2020 2020 280a  n[-1].        (.
-0000dff0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000e000: 2e5f 6361 6e63 656c 5f62 7574 322c 0a20  ._cancel_but2,. 
-0000e010: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000e020: 5f64 656c 6574 655f 6275 7431 2c0a 2020  _delete_but1,.  
-0000e030: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0000e040: 7265 7375 6d65 5f62 7574 2c0a 2020 2020  resume_but,.    
-0000e050: 2020 2020 2020 2020 7365 6c66 2e5f 7375          self._su
-0000e060: 626d 6974 5f62 7574 2c0a 2020 2020 2020  bmit_but,.      
-0000e070: 2020 2920 3d20 7365 6c66 2e5f 6275 7474    ) = self._butt
-0000e080: 6f6e 732e 6368 696c 6472 656e 0a0a 2020  ons.children..  
-0000e090: 2020 2020 2020 2320 4372 6561 7465 2074        # Create t
-0000e0a0: 6865 2073 7461 7274 7374 6f70 2d65 6469  he startstop-edi
-0000e0b0: 740a 2020 2020 2020 2020 7365 6c66 2e5f  t.        self._
-0000e0c0: 7469 6d65 5f65 6469 7420 3d20 5374 6172  time_edit = Star
-0000e0d0: 7453 746f 7045 6469 7428 0a20 2020 2020  tStopEdit(.     
-0000e0e0: 2020 2020 2020 2073 656c 662e 5f74 696d         self._tim
-0000e0f0: 655f 6e6f 6465 2c20 7365 6c66 2e5f 6f6e  e_node, self._on
-0000e100: 5f74 696d 6573 5f63 6861 6e67 652c 2072  _times_change, r
-0000e110: 6563 6f72 642e 7431 2c20 7265 636f 7264  ecord.t1, record
-0000e120: 2e74 322c 206d 6f64 650a 2020 2020 2020  .t2, mode.      
-0000e130: 2020 290a 0a20 2020 2020 2020 2023 2050    )..        # P
-0000e140: 7265 7061 7265 2061 7574 6f63 6f6d 706c  repare autocompl
-0000e150: 6574 696f 6e0a 2020 2020 2020 2020 7365  etion.        se
-0000e160: 6c66 2e5f 6175 746f 636f 6d70 6c65 7465  lf._autocomplete
-0000e170: 7220 3d20 4175 746f 636f 6d70 6c65 7465  r = Autocomplete
-0000e180: 7228 0a20 2020 2020 2020 2020 2020 2073  r(.            s
-0000e190: 656c 662e 5f61 7574 6f63 6f6d 706c 6574  elf._autocomplet
-0000e1a0: 6572 5f64 6976 2c20 7365 6c66 2e5f 6473  er_div, self._ds
-0000e1b0: 5f69 6e70 7574 2c20 7365 6c66 2e5f 6175  _input, self._au
-0000e1c0: 746f 636f 6d70 5f66 696e 6973 6865 640a  tocomp_finished.
-0000e1d0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-0000e1e0: 2020 2023 2053 6574 2073 6f6d 6520 696e     # Set some in
-0000e1f0: 6974 6961 6c20 7661 6c75 6573 0a20 2020  itial values.   
-0000e200: 2020 2020 2073 656c 662e 5f64 735f 696e       self._ds_in
-0000e210: 7075 742e 7661 6c75 6520 3d20 7265 636f  put.value = reco
-0000e220: 7264 2e67 6574 2822 6473 222c 2022 2229  rd.get("ds", "")
-0000e230: 0a20 2020 2020 2020 2073 656c 662e 5f73  .        self._s
-0000e240: 686f 775f 7461 6773 5f66 726f 6d5f 6473  how_tags_from_ds
-0000e250: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
-0000e260: 5f64 656c 6574 655f 6275 7432 2e73 7479  _delete_but2.sty
-0000e270: 6c65 2e64 6973 706c 6179 203d 2022 6e6f  le.display = "no
-0000e280: 6e65 220a 2020 2020 2020 2020 7365 6c66  ne".        self
-0000e290: 2e5f 6e6f 5f75 7365 725f 6564 6974 5f79  ._no_user_edit_y
-0000e2a0: 6574 203d 2054 7275 650a 0a20 2020 2020  et = True..     
-0000e2b0: 2020 2023 2053 686f 7720 7468 6520 7269     # Show the ri
-0000e2c0: 6768 7420 6275 7474 6f6e 730a 2020 2020  ght buttons.    
-0000e2d0: 2020 2020 7365 6c66 2e5f 7365 745f 6d6f      self._set_mo
-0000e2e0: 6465 286d 6f64 6529 0a0a 2020 2020 2020  de(mode)..      
-0000e2f0: 2020 2320 436f 6e6e 6563 7420 7468 696e    # Connect thin
-0000e300: 6773 2075 700a 2020 2020 2020 2020 7365  gs up.        se
-0000e310: 6c66 2e5f 6361 6e63 656c 5f62 7574 312e  lf._cancel_but1.
-0000e320: 6f6e 636c 6963 6b20 3d20 7365 6c66 2e63  onclick = self.c
-0000e330: 6c6f 7365 0a20 2020 2020 2020 2073 656c  lose.        sel
-0000e340: 662e 5f63 616e 6365 6c5f 6275 7432 2e6f  f._cancel_but2.o
-0000e350: 6e63 6c69 636b 203d 2073 656c 662e 636c  nclick = self.cl
-0000e360: 6f73 650a 2020 2020 2020 2020 7365 6c66  ose.        self
-0000e370: 2e5f 7375 626d 6974 5f62 7574 2e6f 6e63  ._submit_but.onc
-0000e380: 6c69 636b 203d 2073 656c 662e 7375 626d  lick = self.subm
-0000e390: 6974 5f73 6f6f 6e0a 2020 2020 2020 2020  it_soon.        
-0000e3a0: 7365 6c66 2e5f 7265 7375 6d65 5f62 7574  self._resume_but
-0000e3b0: 2e6f 6e63 6c69 636b 203d 2073 656c 662e  .onclick = self.
-0000e3c0: 7265 7375 6d65 5f72 6563 6f72 640a 2020  resume_record.  
-0000e3d0: 2020 2020 2020 7365 6c66 2e5f 6473 5f69        self._ds_i
-0000e3e0: 6e70 7574 2e6f 6e69 6e70 7574 203d 2073  nput.oninput = s
-0000e3f0: 656c 662e 5f6f 6e5f 7573 6572 5f65 6469  elf._on_user_edi
-0000e400: 740a 2020 2020 2020 2020 7365 6c66 2e5f  t.        self._
-0000e410: 6473 5f69 6e70 7574 2e6f 6e62 6c75 7220  ds_input.onblur 
-0000e420: 3d20 7365 6c66 2e5f 6f6e 5f75 7365 725f  = self._on_user_
-0000e430: 6564 6974 5f64 6f6e 650a 2020 2020 2020  edit_done.      
-0000e440: 2020 7365 6c66 2e5f 7265 6365 6e74 5f62    self._recent_b
-0000e450: 7574 2e6f 6e63 6c69 636b 203d 2073 656c  ut.onclick = sel
-0000e460: 662e 7368 6f77 5f72 6563 656e 745f 6465  f.show_recent_de
-0000e470: 7363 7269 7074 696f 6e73 0a20 2020 2020  scriptions.     
-0000e480: 2020 2073 656c 662e 5f74 6167 735f 6275     self._tags_bu
-0000e490: 742e 6f6e 636c 6963 6b20 3d20 7365 6c66  t.onclick = self
-0000e4a0: 2e73 686f 775f 7265 6365 6e74 5f74 6167  .show_recent_tag
-0000e4b0: 730a 2020 2020 2020 2020 7365 6c66 2e5f  s.        self._
-0000e4c0: 7072 6573 6574 5f62 7574 2e6f 6e63 6c69  preset_but.oncli
-0000e4d0: 636b 203d 2073 656c 662e 7368 6f77 5f70  ck = self.show_p
-0000e4e0: 7265 7365 7473 0a20 2020 2020 2020 2073  resets.        s
-0000e4f0: 656c 662e 5f70 7265 7365 745f 6564 6974  elf._preset_edit
-0000e500: 2e6f 6e63 6c69 636b 203d 206c 616d 6264  .onclick = lambd
-0000e510: 613a 2073 656c 662e 5f63 616e 7661 732e  a: self._canvas.
-0000e520: 7461 675f 7072 6573 6574 5f64 6961 6c6f  tag_preset_dialo
-0000e530: 672e 6f70 656e 2829 0a20 2020 2020 2020  g.open().       
-0000e540: 2073 656c 662e 5f64 656c 6574 655f 6275   self._delete_bu
-0000e550: 7431 2e6f 6e63 6c69 636b 203d 2073 656c  t1.onclick = sel
-0000e560: 662e 5f64 656c 6574 6531 0a20 2020 2020  f._delete1.     
-0000e570: 2020 2073 656c 662e 5f64 656c 6574 655f     self._delete_
-0000e580: 6275 7432 2e6f 6e63 6c69 636b 203d 2073  but2.onclick = s
-0000e590: 656c 662e 5f64 656c 6574 6532 0a20 2020  elf._delete2.   
-0000e5a0: 2020 2020 2073 656c 662e 6d61 696e 6469       self.maindi
-0000e5b0: 762e 6164 6445 7665 6e74 4c69 7374 656e  v.addEventListen
-0000e5c0: 6572 2822 636c 6963 6b22 2c20 7365 6c66  er("click", self
-0000e5d0: 2e5f 6175 746f 636f 6d70 6c65 7465 722e  ._autocompleter.
-0000e5e0: 636c 6561 7229 0a0a 2020 2020 2020 2020  clear)..        
-0000e5f0: 2320 456e 6162 6c65 2066 6f72 2073 6f6d  # Enable for som
-0000e600: 6520 6d6f 7265 2069 6e66 6f20 2865 2e67  e more info (e.g
-0000e610: 2e20 6475 7269 6e67 2064 6576 290a 2020  . during dev).  
-0000e620: 2020 2020 2020 6966 2046 616c 7365 3a0a        if False:.
-0000e630: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0000e640: 7820 696e 205b 6622 4944 3a20 7b72 6563  x in [f"ID: {rec
-0000e650: 6f72 642e 6b65 797d 222c 2066 224d 6f64  ord.key}", f"Mod
-0000e660: 6966 6965 643a 207b 6474 2e74 696d 6532  ified: {dt.time2
-0000e670: 6c6f 6361 6c73 7472 2872 6563 6f72 642e  localstr(record.
-0000e680: 6d74 297d 225d 3a0a 2020 2020 2020 2020  mt)}"]:.        
-0000e690: 2020 2020 2020 2020 656c 203d 2064 6f63          el = doc
-0000e6a0: 756d 656e 742e 6372 6561 7465 456c 656d  ument.createElem
-0000e6b0: 656e 7428 2264 6976 2229 0a20 2020 2020  ent("div").     
-0000e6c0: 2020 2020 2020 2020 2020 2065 6c2e 696e             el.in
-0000e6d0: 6e65 7254 6578 7420 3d20 780a 2020 2020  nerText = x.    
-0000e6e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000e6f0: 2e6d 6169 6e64 6976 2e61 7070 656e 6443  .maindiv.appendC
-0000e700: 6869 6c64 2865 6c29 0a0a 2020 2020 2020  hild(el)..      
-0000e710: 2020 2320 416c 6d6f 7374 2064 6f6e 652e    # Almost done.
-0000e720: 2046 6f63 7573 206f 6e20 6473 2069 6620   Focus on ds if 
-0000e730: 7468 6973 206c 6f6f 6b73 206c 696b 6520  this looks like 
-0000e740: 6465 736b 746f 703b 2069 7427 7320 616e  desktop; it's an
-0000e750: 6f79 696e 6720 6f6e 206d 6f62 696c 650a  oying on mobile.
-0000e760: 2020 2020 2020 2020 7375 7065 7228 292e          super().
-0000e770: 6f70 656e 2863 616c 6c62 6163 6b29 0a20  open(callback). 
-0000e780: 2020 2020 2020 2069 6620 7574 696c 732e         if utils.
-0000e790: 6c6f 6f6b 735f 6c69 6b65 5f64 6573 6b74  looks_like_deskt
-0000e7a0: 6f70 2829 3a0a 2020 2020 2020 2020 2020  op():.          
-0000e7b0: 2020 7365 6c66 2e5f 6473 5f69 6e70 7574    self._ds_input
-0000e7c0: 2e66 6f63 7573 2829 0a0a 2020 2020 6465  .focus()..    de
-0000e7d0: 6620 5f61 7574 6f63 6f6d 705f 6669 6e69  f _autocomp_fini
-0000e7e0: 7368 6564 2873 656c 6629 3a0a 2020 2020  shed(self):.    
-0000e7f0: 2020 2020 7365 6c66 2e5f 7368 6f77 5f74      self._show_t
-0000e800: 6167 735f 6672 6f6d 5f64 7328 290a 2020  ags_from_ds().  
-0000e810: 2020 2020 2020 7365 6c66 2e5f 6d61 726b        self._mark
-0000e820: 5f61 735f 6564 6974 6564 2829 0a0a 2020  _as_edited()..  
-0000e830: 2020 6465 6620 5f73 6574 5f6d 6f64 6528    def _set_mode(
-0000e840: 7365 6c66 2c20 6d6f 6465 293a 0a20 2020  self, mode):.   
-0000e850: 2020 2020 2073 656c 662e 5f6c 6d6f 6465       self._lmode
-0000e860: 203d 206c 6d6f 6465 203d 206d 6f64 652e   = lmode = mode.
-0000e870: 6c6f 7765 7228 290a 2020 2020 2020 2020  lower().        
-0000e880: 7365 6c66 2e5f 7469 746c 655f 6469 762e  self._title_div.
-0000e890: 696e 6e65 7254 6578 7420 3d20 6622 7b6d  innerText = f"{m
-0000e8a0: 6f64 657d 2072 6563 6f72 6422 0a20 2020  ode} record".   
-0000e8b0: 2020 2020 2069 735f 7275 6e6e 696e 6720       is_running 
-0000e8c0: 3d20 7365 6c66 2e5f 7265 636f 7264 2e74  = self._record.t
-0000e8d0: 3120 3d3d 2073 656c 662e 5f72 6563 6f72  1 == self._recor
-0000e8e0: 642e 7432 0a20 2020 2020 2020 2023 2068  d.t2.        # h
-0000e8f0: 6173 5f72 756e 6e69 6e67 203d 206c 656e  as_running = len
-0000e900: 2877 696e 646f 772e 7374 6f72 652e 7265  (window.store.re
-0000e910: 636f 7264 732e 6765 745f 7275 6e6e 696e  cords.get_runnin
-0000e920: 675f 7265 636f 7264 7328 2929 203e 2030  g_records()) > 0
-0000e930: 0a20 2020 2020 2020 2023 2053 6574 2064  .        # Set d
-0000e940: 6573 6372 6970 7469 6f6e 2070 6c61 6365  escription place
-0000e950: 686f 6c64 6572 0a20 2020 2020 2020 2069  holder.        i
-0000e960: 6620 6c6d 6f64 6520 3d3d 2022 7374 6172  f lmode == "star
-0000e970: 7422 3a0a 2020 2020 2020 2020 2020 2020  t":.            
-0000e980: 7365 6c66 2e5f 6473 5f69 6e70 7574 2e73  self._ds_input.s
-0000e990: 6574 4174 7472 6962 7574 6528 2270 6c61  etAttribute("pla
-0000e9a0: 6365 686f 6c64 6572 222c 2022 5768 6174  ceholder", "What
-0000e9b0: 2061 7265 2079 6f75 2067 6f69 6e67 2074   are you going t
-0000e9c0: 6f20 646f 3f22 290a 2020 2020 2020 2020  o do?").        
-0000e9d0: 656c 6966 206c 6d6f 6465 203d 3d20 226e  elif lmode == "n
-0000e9e0: 6577 223a 0a20 2020 2020 2020 2020 2020  ew":.           
-0000e9f0: 2073 656c 662e 5f64 735f 696e 7075 742e   self._ds_input.
-0000ea00: 7365 7441 7474 7269 6275 7465 2822 706c  setAttribute("pl
-0000ea10: 6163 6568 6f6c 6465 7222 2c20 2257 6861  aceholder", "Wha
-0000ea20: 7420 6861 7665 2079 6f75 2064 6f6e 653f  t have you done?
-0000ea30: 2229 0a20 2020 2020 2020 2065 6c69 6620  ").        elif 
-0000ea40: 6c6d 6f64 6520 3d3d 2022 7374 6f70 223a  lmode == "stop":
-0000ea50: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000ea60: 662e 5f64 735f 696e 7075 742e 7365 7441  f._ds_input.setA
-0000ea70: 7474 7269 6275 7465 2822 706c 6163 6568  ttribute("placeh
-0000ea80: 6f6c 6465 7222 2c20 2257 6861 7420 6469  older", "What di
-0000ea90: 6420 796f 7520 6a75 7374 2064 6f3f 2229  d you just do?")
-0000eaa0: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
-0000eab0: 5f72 756e 6e69 6e67 3a0a 2020 2020 2020  _running:.      
-0000eac0: 2020 2020 2020 7365 6c66 2e5f 6473 5f69        self._ds_i
-0000ead0: 6e70 7574 2e73 6574 4174 7472 6962 7574  nput.setAttribut
-0000eae0: 6528 2270 6c61 6365 686f 6c64 6572 222c  e("placeholder",
-0000eaf0: 2022 5768 6174 2061 7265 2079 6f75 2064   "What are you d
-0000eb00: 6f69 6e67 3f22 290a 2020 2020 2020 2020  oing?").        
-0000eb10: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000eb20: 2020 7365 6c66 2e5f 6473 5f69 6e70 7574    self._ds_input
-0000eb30: 2e73 6574 4174 7472 6962 7574 6528 2270  .setAttribute("p
-0000eb40: 6c61 6365 686f 6c64 6572 222c 2022 5768  laceholder", "Wh
-0000eb50: 6174 2068 6173 2062 6565 6e20 646f 6e65  at has been done
-0000eb60: 3f22 290a 2020 2020 2020 2020 2320 5477  ?").        # Tw
-0000eb70: 6561 6b20 7468 6520 6275 7474 6f6e 7320  eak the buttons 
-0000eb80: 6174 2074 6865 2062 6f74 746f 6d0a 2020  at the bottom.  
-0000eb90: 2020 2020 2020 6966 206c 6d6f 6465 203d        if lmode =
-0000eba0: 3d20 2273 7461 7274 223a 0a20 2020 2020  = "start":.     
-0000ebb0: 2020 2020 2020 2073 656c 662e 5f73 7562         self._sub
-0000ebc0: 6d69 745f 6275 742e 696e 6e65 7248 544d  mit_but.innerHTM
-0000ebd0: 4c20 3d20 223c 6920 636c 6173 733d 2766  L = "<i class='f
-0000ebe0: 6173 273e 5c75 6630 3462 3c2f 693e 266e  as'>\uf04b</i>&n
-0000ebf0: 6273 703b 266e 6273 703b 5374 6172 7422  bsp;&nbsp;Start"
-0000ec00: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000ec10: 662e 5f72 6573 756d 655f 6275 742e 7374  f._resume_but.st
-0000ec20: 796c 652e 6469 7370 6c61 7920 3d20 226e  yle.display = "n
-0000ec30: 6f6e 6522 0a20 2020 2020 2020 2020 2020  one".           
-0000ec40: 2073 656c 662e 5f64 656c 6574 655f 6275   self._delete_bu
-0000ec50: 7431 2e73 7479 6c65 2e64 6973 706c 6179  t1.style.display
-0000ec60: 203d 2022 6e6f 6e65 220a 2020 2020 2020   = "none".      
-0000ec70: 2020 656c 6966 206c 6d6f 6465 203d 3d20    elif lmode == 
-0000ec80: 226e 6577 223a 0a20 2020 2020 2020 2020  "new":.         
-0000ec90: 2020 2073 656c 662e 5f73 7562 6d69 745f     self._submit_
-0000eca0: 6275 742e 696e 6e65 7248 544d 4c20 3d20  but.innerHTML = 
-0000ecb0: 223c 6920 636c 6173 733d 2766 6173 273e  "<i class='fas'>
-0000ecc0: 5c75 6630 3637 3c2f 693e 266e 6273 703b  \uf067</i>&nbsp;
-0000ecd0: 266e 6273 703b 4372 6561 7465 220a 2020  &nbsp;Create".  
-0000ece0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0000ecf0: 7265 7375 6d65 5f62 7574 2e73 7479 6c65  resume_but.style
-0000ed00: 2e64 6973 706c 6179 203d 2022 6e6f 6e65  .display = "none
-0000ed10: 220a 2020 2020 2020 2020 2020 2020 7365  ".            se
-0000ed20: 6c66 2e5f 6465 6c65 7465 5f62 7574 312e  lf._delete_but1.
-0000ed30: 7374 796c 652e 6469 7370 6c61 7920 3d20  style.display = 
-0000ed40: 226e 6f6e 6522 0a20 2020 2020 2020 2065  "none".        e
-0000ed50: 6c69 6620 6c6d 6f64 6520 3d3d 2022 6564  lif lmode == "ed
-0000ed60: 6974 223a 0a20 2020 2020 2020 2020 2020  it":.           
-0000ed70: 2073 656c 662e 5f73 7562 6d69 745f 6275   self._submit_bu
-0000ed80: 742e 696e 6e65 7248 544d 4c20 3d20 223c  t.innerHTML = "<
-0000ed90: 6920 636c 6173 733d 2766 6173 273e 5c75  i class='fas'>\u
-0000eda0: 6633 3034 3c2f 693e 266e 6273 703b 266e  f304</i>&nbsp;&n
-0000edb0: 6273 703b 5361 7665 220a 2020 2020 2020  bsp;Save".      
-0000edc0: 2020 2020 2020 7469 746c 655f 6d6f 6465        title_mode
-0000edd0: 203d 2022 4564 6974 2072 756e 6e69 6e67   = "Edit running
-0000ede0: 2220 6966 2069 735f 7275 6e6e 696e 6720  " if is_running 
-0000edf0: 656c 7365 2022 4564 6974 220a 2020 2020  else "Edit".    
-0000ee00: 2020 2020 2020 2020 7365 6c66 2e5f 7469          self._ti
-0000ee10: 746c 655f 6469 762e 696e 6e65 7254 6578  tle_div.innerTex
-0000ee20: 7420 3d20 6622 7b74 6974 6c65 5f6d 6f64  t = f"{title_mod
-0000ee30: 657d 2072 6563 6f72 6422 0a20 2020 2020  e} record".     
-0000ee40: 2020 2020 2020 2073 656c 662e 5f73 7562         self._sub
-0000ee50: 6d69 745f 6275 742e 6469 7361 626c 6564  mit_but.disabled
-0000ee60: 203d 2073 656c 662e 5f6e 6f5f 7573 6572   = self._no_user
-0000ee70: 5f65 6469 745f 7965 740a 2020 2020 2020  _edit_yet.      
-0000ee80: 2020 2020 2020 7365 6c66 2e5f 7265 7375        self._resu
-0000ee90: 6d65 5f62 7574 2e73 7479 6c65 2e64 6973  me_but.style.dis
-0000eea0: 706c 6179 203d 2022 6e6f 6e65 2220 6966  play = "none" if
-0000eeb0: 2069 735f 7275 6e6e 696e 6720 656c 7365   is_running else
-0000eec0: 2022 626c 6f63 6b22 0a20 2020 2020 2020   "block".       
-0000eed0: 2020 2020 2073 656c 662e 5f64 656c 6574       self._delet
-0000eee0: 655f 6275 7431 2e73 7479 6c65 2e64 6973  e_but1.style.dis
-0000eef0: 706c 6179 203d 2022 626c 6f63 6b22 0a20  play = "block". 
-0000ef00: 2020 2020 2020 2065 6c69 6620 6c6d 6f64         elif lmod
-0000ef10: 6520 3d3d 2022 7374 6f70 223a 0a20 2020  e == "stop":.   
-0000ef20: 2020 2020 2020 2020 2073 656c 662e 5f73           self._s
-0000ef30: 7562 6d69 745f 6275 742e 696e 6e65 7248  ubmit_but.innerH
-0000ef40: 544d 4c20 3d20 223c 6920 636c 6173 733d  TML = "<i class=
-0000ef50: 2766 6173 273e 5c75 6630 3464 3c2f 693e  'fas'>\uf04d</i>
-0000ef60: 266e 6273 703b 266e 6273 703b 5361 7665  &nbsp;&nbsp;Save
-0000ef70: 220a 2020 2020 2020 2020 2020 2020 7365  ".            se
-0000ef80: 6c66 2e5f 7265 7375 6d65 5f62 7574 2e73  lf._resume_but.s
-0000ef90: 7479 6c65 2e64 6973 706c 6179 203d 2022  tyle.display = "
-0000efa0: 6e6f 6e65 220a 2020 2020 2020 2020 2020  none".          
-0000efb0: 2020 7365 6c66 2e5f 6465 6c65 7465 5f62    self._delete_b
-0000efc0: 7574 312e 7374 796c 652e 6469 7370 6c61  ut1.style.displa
-0000efd0: 7920 3d20 2262 6c6f 636b 220a 2020 2020  y = "block".    
-0000efe0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000eff0: 2020 2020 2020 636f 6e73 6f6c 652e 7761        console.wa
-0000f000: 726e 2822 556e 6578 7065 6374 6564 2072  rn("Unexpected r
-0000f010: 6563 6f72 6420 6469 616c 6f67 206d 6f64  ecord dialog mod
-0000f020: 6520 2220 2b20 6d6f 6465 290a 0a20 2020  e " + mode)..   
-0000f030: 2064 6566 205f 6d61 726b 5f61 735f 6564   def _mark_as_ed
-0000f040: 6974 6564 2873 656c 6629 3a0a 2020 2020  ited(self):.    
-0000f050: 2020 2020 6966 2073 656c 662e 5f6e 6f5f      if self._no_
-0000f060: 7573 6572 5f65 6469 745f 7965 743a 0a20  user_edit_yet:. 
-0000f070: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000f080: 5f6e 6f5f 7573 6572 5f65 6469 745f 7965  _no_user_edit_ye
-0000f090: 7420 3d20 4661 6c73 650a 2020 2020 2020  t = False.      
-0000f0a0: 2020 2020 2020 7365 6c66 2e5f 7375 626d        self._subm
-0000f0b0: 6974 5f62 7574 2e64 6973 6162 6c65 6420  it_but.disabled 
-0000f0c0: 3d20 4661 6c73 650a 0a20 2020 2064 6566  = False..    def
-0000f0d0: 205f 6f6e 5f75 7365 725f 6564 6974 2873   _on_user_edit(s
-0000f0e0: 656c 6629 3a0a 2020 2020 2020 2020 7365  elf):.        se
-0000f0f0: 6c66 2e5f 6d61 726b 5f61 735f 6564 6974  lf._mark_as_edit
-0000f100: 6564 2829 0a20 2020 2020 2020 2073 656c  ed().        sel
-0000f110: 662e 5f61 7574 6f63 6f6d 706c 6574 6572  f._autocompleter
-0000f120: 2e69 6e69 7428 290a 2020 2020 2020 2020  .init().        
-0000f130: 7365 6c66 2e5f 7368 6f77 5f74 6167 735f  self._show_tags_
-0000f140: 6672 6f6d 5f64 7328 290a 2020 2020 2020  from_ds().      
-0000f150: 2020 2320 4966 2074 6865 2073 7472 2069    # If the str i
-0000f160: 7320 746f 6f20 6c6f 6e67 2c20 6c69 6d69  s too long, limi
-0000f170: 7420 6974 0a20 2020 2020 2020 2069 6620  t it.        if 
-0000f180: 6c65 6e28 7365 6c66 2e5f 6473 5f69 6e70  len(self._ds_inp
-0000f190: 7574 2e76 616c 7565 2920 3e3d 2073 746f  ut.value) >= sto
-0000f1a0: 7265 732e 5354 525f 4d41 583a 0a20 2020  res.STR_MAX:.   
-0000f1b0: 2020 2020 2020 2020 2073 656c 662e 5f64           self._d
-0000f1c0: 735f 696e 7075 742e 7661 6c75 6520 3d20  s_input.value = 
-0000f1d0: 7365 6c66 2e5f 6473 5f69 6e70 7574 2e76  self._ds_input.v
-0000f1e0: 616c 7565 2e73 6c69 6365 2830 2c20 7374  alue.slice(0, st
-0000f1f0: 6f72 6573 2e53 5452 5f4d 4158 290a 2020  ores.STR_MAX).  
-0000f200: 2020 2020 2020 2020 2020 6966 2022 6d61            if "ma
-0000f210: 7822 206e 6f74 2069 6e20 7365 6c66 2e5f  x" not in self._
-0000f220: 6473 5f68 6561 6465 722e 696e 6e65 7248  ds_header.innerH
-0000f230: 544d 4c3a 0a20 2020 2020 2020 2020 2020  TML:.           
-0000f240: 2020 2020 2073 656c 662e 5f64 735f 6865       self._ds_he
-0000f250: 6164 6572 2e69 6e6e 6572 4854 4d4c 202b  ader.innerHTML +
-0000f260: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-0000f270: 2020 2020 2020 2020 6622 203c 736d 616c          f" <smal
-0000f280: 6c3e 286d 6178 207b 7374 6f72 6573 2e53  l>(max {stores.S
-0000f290: 5452 5f4d 4158 2d31 7d20 6368 6172 7329  TR_MAX-1} chars)
-0000f2a0: 3c2f 736d 616c 6c3e 220a 2020 2020 2020  </small>".      
-0000f2b0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0000f2c0: 2020 2020 2020 2020 7365 6c66 2e5f 6473          self._ds
-0000f2d0: 5f69 6e70 7574 2e73 7479 6c65 2e73 6574  _input.style.set
-0000f2e0: 5072 6f70 6572 7479 2822 6f75 746c 696e  Property("outlin
-0000f2f0: 6522 2c20 2264 6173 6865 6420 3270 7820  e", "dashed 2px 
-0000f300: 7265 6422 290a 2020 2020 2020 2020 2020  red").          
-0000f310: 2020 7265 7365 7420 3d20 6c61 6d62 6461    reset = lambda
-0000f320: 3a20 7365 6c66 2e5f 6473 5f69 6e70 7574  : self._ds_input
-0000f330: 2e73 7479 6c65 2e73 6574 5072 6f70 6572  .style.setProper
-0000f340: 7479 2822 6f75 746c 696e 6522 2c20 2222  ty("outline", ""
-0000f350: 290a 2020 2020 2020 2020 2020 2020 7769  ).            wi
-0000f360: 6e64 6f77 2e73 6574 5469 6d65 6f75 7428  ndow.setTimeout(
-0000f370: 7265 7365 742c 2032 3030 3029 0a0a 2020  reset, 2000)..  
-0000f380: 2020 6465 6620 7368 6f77 5f70 7265 7365    def show_prese
-0000f390: 7473 2873 656c 662c 2065 293a 0a20 2020  ts(self, e):.   
-0000f3a0: 2020 2020 2023 2050 7265 7665 6e74 2074       # Prevent t
-0000f3b0: 6861 7420 7468 6520 636c 6963 6b20 7769  hat the click wi
-0000f3c0: 6c6c 2068 6964 6520 7468 6520 6175 746f  ll hide the auto
-0000f3d0: 636f 6d70 0a20 2020 2020 2020 2069 6620  comp.        if 
-0000f3e0: 6520 616e 6420 652e 7374 6f70 5072 6f70  e and e.stopProp
-0000f3f0: 6167 6174 696f 6e3a 0a20 2020 2020 2020  agation:.       
-0000f400: 2020 2020 2065 2e73 746f 7050 726f 7061       e.stopPropa
-0000f410: 6761 7469 6f6e 2829 0a20 2020 2020 2020  gation().       
-0000f420: 2073 656c 662e 5f61 7574 6f63 6f6d 706c   self._autocompl
-0000f430: 6574 6572 2e73 686f 775f 7375 6767 6573  eter.show_sugges
-0000f440: 7469 6f6e 7328 2270 7265 7365 7473 2229  tions("presets")
-0000f450: 0a20 2020 2020 2020 2023 204e 6f74 653a  .        # Note:
-0000f460: 2064 6f6e 2774 2067 6976 6520 6473 5f69   don't give ds_i
-0000f470: 6e70 7574 2066 6f63 7573 2c20 6265 6361  nput focus, beca
-0000f480: 7573 6520 7468 6174 2077 696c 6c20 706f  use that will po
-0000f490: 7020 7570 2074 6865 0a20 2020 2020 2020  p up the.       
-0000f4a0: 2023 206b 6579 626f 6172 6420 6f6e 206d   # keyboard on m
-0000f4b0: 6f62 696c 6520 6465 7669 6365 730a 0a20  obile devices.. 
-0000f4c0: 2020 2064 6566 2073 686f 775f 7265 6365     def show_rece
-0000f4d0: 6e74 5f74 6167 7328 7365 6c66 2c20 6529  nt_tags(self, e)
-0000f4e0: 3a0a 2020 2020 2020 2020 2320 5072 6576  :.        # Prev
-0000f4f0: 656e 7420 7468 6174 2074 6865 2063 6c69  ent that the cli
-0000f500: 636b 2077 696c 6c20 6869 6465 2074 6865  ck will hide the
-0000f510: 2061 7574 6f63 6f6d 700a 2020 2020 2020   autocomp.      
-0000f520: 2020 6966 2065 2061 6e64 2065 2e73 746f    if e and e.sto
-0000f530: 7050 726f 7061 6761 7469 6f6e 3a0a 2020  pPropagation:.  
-0000f540: 2020 2020 2020 2020 2020 652e 7374 6f70            e.stop
-0000f550: 5072 6f70 6167 6174 696f 6e28 290a 2020  Propagation().  
-0000f560: 2020 2020 2020 7365 6c66 2e5f 6175 746f        self._auto
-0000f570: 636f 6d70 6c65 7465 722e 7368 6f77 5f73  completer.show_s
-0000f580: 7567 6765 7374 696f 6e73 2822 7461 6773  uggestions("tags
-0000f590: 2229 0a0a 2020 2020 6465 6620 7368 6f77  ")..    def show
-0000f5a0: 5f72 6563 656e 745f 6465 7363 7269 7074  _recent_descript
-0000f5b0: 696f 6e73 2873 656c 662c 2065 293a 0a20  ions(self, e):. 
-0000f5c0: 2020 2020 2020 2069 6620 6520 616e 6420         if e and 
-0000f5d0: 652e 7374 6f70 5072 6f70 6167 6174 696f  e.stopPropagatio
-0000f5e0: 6e3a 0a20 2020 2020 2020 2020 2020 2065  n:.            e
-0000f5f0: 2e73 746f 7050 726f 7061 6761 7469 6f6e  .stopPropagation
-0000f600: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
-0000f610: 5f61 7574 6f63 6f6d 706c 6574 6572 2e73  _autocompleter.s
-0000f620: 686f 775f 7375 6767 6573 7469 6f6e 7328  how_suggestions(
-0000f630: 2264 6573 6372 6970 7469 6f6e 7322 290a  "descriptions").
-0000f640: 0a20 2020 2064 6566 205f 6164 645f 7461  .    def _add_ta
-0000f650: 6728 7365 6c66 2c20 7461 6729 3a0a 2020  g(self, tag):.  
-0000f660: 2020 2020 2020 7365 6c66 2e5f 6473 5f69        self._ds_i
-0000f670: 6e70 7574 2e76 616c 7565 203d 2073 656c  nput.value = sel
-0000f680: 662e 5f64 735f 696e 7075 742e 7661 6c75  f._ds_input.valu
-0000f690: 652e 7273 7472 6970 2829 202b 2022 2022  e.rstrip() + " "
-0000f6a0: 202b 2074 6167 202b 2022 2022 0a20 2020   + tag + " ".   
-0000f6b0: 2020 2020 2073 656c 662e 5f6f 6e5f 7573       self._on_us
-0000f6c0: 6572 5f65 6469 7428 290a 2020 2020 2020  er_edit().      
-0000f6d0: 2020 6966 2075 7469 6c73 2e6c 6f6f 6b73    if utils.looks
-0000f6e0: 5f6c 696b 655f 6465 736b 746f 7028 293a  _like_desktop():
-0000f6f0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000f700: 662e 5f64 735f 696e 7075 742e 666f 6375  f._ds_input.focu
-0000f710: 7328 290a 0a20 2020 2064 6566 205f 6f6e  s()..    def _on
-0000f720: 5f75 7365 725f 6564 6974 5f64 6f6e 6528  _user_edit_done(
-0000f730: 7365 6c66 293a 0a20 2020 2020 2020 2073  self):.        s
-0000f740: 656c 662e 5f61 7574 6f63 6f6d 706c 6574  elf._autocomplet
-0000f750: 6572 2e63 6c65 6172 2829 0a20 2020 2020  er.clear().     
-0000f760: 2020 2064 7320 3d20 746f 5f73 7472 2873     ds = to_str(s
-0000f770: 656c 662e 5f64 735f 696e 7075 742e 7661  elf._ds_input.va
-0000f780: 6c75 6529 0a20 2020 2020 2020 205f 2c20  lue).        _, 
-0000f790: 7061 7274 7320 3d20 7574 696c 732e 6765  parts = utils.ge
-0000f7a0: 745f 7461 6773 5f61 6e64 5f70 6172 7473  t_tags_and_parts
-0000f7b0: 5f66 726f 6d5f 7374 7269 6e67 2864 7329  _from_string(ds)
-0000f7c0: 0a20 2020 2020 2020 2073 656c 662e 5f64  .        self._d
-0000f7d0: 735f 696e 7075 742e 7661 6c75 6520 3d20  s_input.value = 
-0000f7e0: 7061 7274 732e 6a6f 696e 2822 2229 2e73  parts.join("").s
-0000f7f0: 7472 6970 2829 0a20 2020 2020 2020 2073  trip().        s
-0000f800: 656c 662e 5f73 686f 775f 7461 6773 5f66  elf._show_tags_f
-0000f810: 726f 6d5f 6473 2829 0a0a 2020 2020 6465  rom_ds()..    de
-0000f820: 6620 5f6f 6e5f 7469 6d65 735f 6368 616e  f _on_times_chan
-0000f830: 6765 2873 656c 6629 3a0a 2020 2020 2020  ge(self):.      
-0000f840: 2020 7761 735f 7275 6e6e 696e 6720 3d20    was_running = 
-0000f850: 7365 6c66 2e5f 7265 636f 7264 2e74 3120  self._record.t1 
-0000f860: 3d3d 2073 656c 662e 5f72 6563 6f72 642e  == self._record.
-0000f870: 7432 0a20 2020 2020 2020 2073 656c 662e  t2.        self.
-0000f880: 5f72 6563 6f72 642e 7431 203d 2073 656c  _record.t1 = sel
-0000f890: 662e 5f74 696d 655f 6564 6974 2e74 310a  f._time_edit.t1.
-0000f8a0: 2020 2020 2020 2020 7365 6c66 2e5f 7265          self._re
-0000f8b0: 636f 7264 2e74 3220 3d20 7365 6c66 2e5f  cord.t2 = self._
-0000f8c0: 7469 6d65 5f65 6469 742e 7432 0a20 2020  time_edit.t2.   
-0000f8d0: 2020 2020 2069 735f 7275 6e6e 696e 6720       is_running 
-0000f8e0: 3d20 7365 6c66 2e5f 7265 636f 7264 2e74  = self._record.t
-0000f8f0: 3120 3d3d 2073 656c 662e 5f72 6563 6f72  1 == self._recor
-0000f900: 642e 7432 0a20 2020 2020 2020 2073 656c  d.t2.        sel
-0000f910: 662e 5f6d 6172 6b5f 6173 5f65 6469 7465  f._mark_as_edite
-0000f920: 6428 290a 2020 2020 2020 2020 2320 5377  d().        # Sw
-0000f930: 6170 206d 6f64 653f 0a20 2020 2020 2020  ap mode?.       
-0000f940: 2069 6620 7761 735f 7275 6e6e 696e 6720   if was_running 
-0000f950: 616e 6420 6e6f 7420 6973 5f72 756e 6e69  and not is_runni
-0000f960: 6e67 3a0a 2020 2020 2020 2020 2020 2020  ng:.            
-0000f970: 6966 2073 656c 662e 5f6c 6d6f 6465 203d  if self._lmode =
-0000f980: 3d20 2273 7461 7274 223a 0a20 2020 2020  = "start":.     
-0000f990: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000f9a0: 5f73 6574 5f6d 6f64 6528 224e 6577 2229  _set_mode("New")
-0000f9b0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0000f9c0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000f9d0: 2020 2073 656c 662e 5f73 6574 5f6d 6f64     self._set_mod
-0000f9e0: 6528 2253 746f 7022 290a 2020 2020 2020  e("Stop").      
-0000f9f0: 2020 656c 6966 2069 735f 7275 6e6e 696e    elif is_runnin
-0000fa00: 6720 616e 6420 6e6f 7420 7761 735f 7275  g and not was_ru
-0000fa10: 6e6e 696e 673a 0a20 2020 2020 2020 2020  nning:.         
-0000fa20: 2020 2069 6620 7365 6c66 2e5f 6c6d 6f64     if self._lmod
-0000fa30: 6520 3d3d 2022 6e65 7722 3a0a 2020 2020  e == "new":.    
-0000fa40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000fa50: 2e5f 7365 745f 6d6f 6465 2822 5374 6172  ._set_mode("Star
-0000fa60: 7422 290a 2020 2020 2020 2020 2020 2020  t").            
-0000fa70: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000fa80: 2020 2020 2020 7365 6c66 2e5f 7365 745f        self._set_
-0000fa90: 6d6f 6465 2822 4564 6974 2229 0a0a 2020  mode("Edit")..  
-0000faa0: 2020 6465 6620 5f73 686f 775f 7461 6773    def _show_tags
-0000fab0: 5f66 726f 6d5f 6473 2873 656c 6629 3a0a  _from_ds(self):.
-0000fac0: 2020 2020 2020 2020 2222 2247 6574 2061          """Get a
-0000fad0: 6c6c 2063 7572 7265 6e74 2074 6167 732e  ll current tags.
-0000fae0: 2049 6620 6469 6666 6572 656e 742c 2075   If different, u
-0000faf0: 7064 6174 6520 7375 6767 6573 7469 6f6e  pdate suggestion
-0000fb00: 732e 2222 220a 2020 2020 2020 2020 2320  s.""".        # 
-0000fb10: 5368 6f77 2069 6e66 6f20 6162 6f75 7420  Show info about 
-0000fb20: 6375 7272 656e 7420 7461 6773 2069 6e20  current tags in 
-0000fb30: 6465 7363 7269 7074 696f 6e0a 2020 2020  description.    
-0000fb40: 2020 2020 7461 6773 2c20 7061 7274 7320      tags, parts 
-0000fb50: 3d20 7574 696c 732e 6765 745f 7461 6773  = utils.get_tags
-0000fb60: 5f61 6e64 5f70 6172 7473 5f66 726f 6d5f  _and_parts_from_
-0000fb70: 7374 7269 6e67 2873 656c 662e 5f64 735f  string(self._ds_
-0000fb80: 696e 7075 742e 7661 6c75 6529 0a20 2020  input.value).   
-0000fb90: 2020 2020 2074 6167 735f 6874 6d6c 203d       tags_html =
-0000fba0: 2022 5461 6773 3a26 6e62 7370 3b20 266e   "Tags:&nbsp; &n
-0000fbb0: 6273 703b 220a 2020 2020 2020 2020 6966  bsp;".        if
-0000fbc0: 206c 656e 2874 6167 7329 203d 3d20 303a   len(tags) == 0:
-0000fbd0: 0a20 2020 2020 2020 2020 2020 2074 6167  .            tag
-0000fbe0: 7320 3d20 5b22 2375 6e74 6167 6765 6422  s = ["#untagged"
-0000fbf0: 5d0a 2020 2020 2020 2020 7461 6773 5f6c  ].        tags_l
-0000fc00: 6973 7420 3d20 5b5d 0a20 2020 2020 2020  ist = [].       
-0000fc10: 2066 6f72 2074 6167 2069 6e20 7461 6773   for tag in tags
-0000fc20: 3a0a 2020 2020 2020 2020 2020 2020 636c  :.            cl
-0000fc30: 7220 3d20 7769 6e64 6f77 2e73 746f 7265  r = window.store
-0000fc40: 2e73 6574 7469 6e67 732e 6765 745f 636f  .settings.get_co
-0000fc50: 6c6f 725f 666f 725f 7461 6728 7461 6729  lor_for_tag(tag)
-0000fc60: 0a20 2020 2020 2020 2020 2020 2074 6167  .            tag
-0000fc70: 735f 6c69 7374 2e61 7070 656e 6428 6622  s_list.append(f"
-0000fc80: 3c62 2073 7479 6c65 3d27 636f 6c6f 723a  <b style='color:
-0000fc90: 7b63 6c72 7d3b 273e 233c 2f62 3e7b 7461  {clr};'>#</b>{ta
-0000fca0: 675b 313a 5d7d 2229 0a20 2020 2020 2020  g[1:]}").       
-0000fcb0: 2074 6167 735f 6874 6d6c 202b 3d20 2226   tags_html += "&
-0000fcc0: 6e62 7370 3b20 266e 6273 703b 222e 6a6f  nbsp; &nbsp;".jo
-0000fcd0: 696e 2874 6167 735f 6c69 7374 290a 2020  in(tags_list).  
-0000fce0: 2020 2020 2020 2320 4765 7420 6869 6e74        # Get hint
-0000fcf0: 730a 2020 2020 2020 2020 6869 6e74 5f68  s.        hint_h
-0000fd00: 746d 6c20 3d20 2222 0a20 2020 2020 2020  tml = "".       
-0000fd10: 2069 6620 6e6f 7420 7365 6c66 2e5f 6175   if not self._au
-0000fd20: 746f 636f 6d70 6c65 7465 722e 6861 735f  tocompleter.has_
-0000fd30: 7265 6365 6e74 5f74 6167 7328 293a 0a20  recent_tags():. 
-0000fd40: 2020 2020 2020 2020 2020 2068 696e 745f             hint_
-0000fd50: 6874 6d6c 203d 2022 5573 6520 652e 672e  html = "Use e.g.
-0000fd60: 2027 2623 3335 3b6d 6565 7469 6e67 2720   '&#35;meeting' 
-0000fd70: 746f 2061 6464 206f 6e65 206f 7220 6d6f  to add one or mo
-0000fd80: 7265 2074 6167 732e 220a 2020 2020 2020  re tags.".      
-0000fd90: 2020 2320 4465 7465 6374 2064 7570 6c69    # Detect dupli
-0000fda0: 6361 7465 2074 6167 730a 2020 2020 2020  cate tags.      
-0000fdb0: 2020 7461 675f 636f 756e 7473 203d 207b    tag_counts = {
-0000fdc0: 7d0a 2020 2020 2020 2020 666f 7220 7061  }.        for pa
-0000fdd0: 7274 2069 6e20 7061 7274 733a 0a20 2020  rt in parts:.   
-0000fde0: 2020 2020 2020 2020 2069 6620 7061 7274           if part
-0000fdf0: 2e73 7461 7274 7377 6974 6828 2223 2229  .startswith("#")
-0000fe00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000fe10: 2020 7461 675f 636f 756e 7473 5b70 6172    tag_counts[par
-0000fe20: 745d 203d 2074 6167 5f63 6f75 6e74 732e  t] = tag_counts.
-0000fe30: 6765 7428 7061 7274 2c20 3029 202b 2031  get(part, 0) + 1
-0000fe40: 0a20 2020 2020 2020 2064 7570 6c69 6361  .        duplica
-0000fe50: 7465 7320 3d20 5b74 6167 2066 6f72 2074  tes = [tag for t
-0000fe60: 6167 2c20 636f 756e 7420 696e 2074 6167  ag, count in tag
-0000fe70: 5f63 6f75 6e74 732e 6974 656d 7328 2920  _counts.items() 
-0000fe80: 6966 2063 6f75 6e74 203e 2031 5d0a 2020  if count > 1].  
-0000fe90: 2020 2020 2020 6966 206c 656e 2864 7570        if len(dup
-0000fea0: 6c69 6361 7465 7329 3a0a 2020 2020 2020  licates):.      
-0000feb0: 2020 2020 2020 6869 6e74 5f68 746d 6c20        hint_html 
-0000fec0: 2b3d 2022 3c62 723e 4475 706c 6963 6174  += "<br>Duplicat
-0000fed0: 6520 7461 6773 3a20 2220 2b20 6475 706c  e tags: " + dupl
-0000fee0: 6963 6174 6573 2e6a 6f69 6e28 2220 2229  icates.join(" ")
-0000fef0: 0a20 2020 2020 2020 2023 2044 6574 6563  .        # Detec
-0000ff00: 7420 5552 4c27 730a 2020 2020 2020 2020  t URL's.        
-0000ff10: 7572 6c73 203d 205b 5d0a 2020 2020 2020  urls = [].      
-0000ff20: 2020 666f 7220 7061 7274 2069 6e20 7061    for part in pa
-0000ff30: 7274 733a 0a20 2020 2020 2020 2020 2020  rts:.           
-0000ff40: 2066 6f72 2077 6f72 6420 696e 2070 6172   for word in par
-0000ff50: 742e 7370 6c69 7428 293a 0a20 2020 2020  t.split():.     
-0000ff60: 2020 2020 2020 2020 2020 2069 6620 776f             if wo
-0000ff70: 7264 2e73 7461 7274 7357 6974 6828 2268  rd.startsWith("h
-0000ff80: 7474 703a 2f2f 2229 206f 7220 776f 7264  ttp://") or word
-0000ff90: 2e73 7461 7274 7357 6974 6828 2268 7474  .startsWith("htt
-0000ffa0: 7073 3a2f 2f22 293a 0a20 2020 2020 2020  ps://"):.       
-0000ffb0: 2020 2020 2020 2020 2020 2020 2075 726c               url
-0000ffc0: 732e 6170 7065 6e64 2877 6f72 642e 7374  s.append(word.st
-0000ffd0: 7269 7028 2227 2229 2e73 7472 6970 2827  rip("'").strip('
-0000ffe0: 2227 2929 0a20 2020 2020 2020 2069 6620  "')).        if 
-0000fff0: 7572 6c73 3a0a 2020 2020 2020 2020 2020  urls:.          
-00010000: 2020 6869 6e74 5f68 746d 6c20 2b3d 2022    hint_html += "
-00010010: 3c62 723e 4c69 6e6b 733a 220a 2020 2020  <br>Links:".    
-00010020: 2020 2020 2020 2020 666f 7220 7572 6c20          for url 
-00010030: 696e 2075 726c 733a 0a20 2020 2020 2020  in urls:.       
-00010040: 2020 2020 2020 2020 2068 696e 745f 6874           hint_ht
-00010050: 6d6c 202b 3d20 6622 3c62 723e 3c61 2073  ml += f"<br><a s
-00010060: 7479 6c65 3d27 666f 6e74 2d73 697a 653a  tyle='font-size:
-00010070: 736d 616c 6c65 723b 2720 6872 6566 3d27  smaller;' href='
-00010080: 7b75 726c 7d27 2074 6172 6765 743d 275f  {url}' target='_
-00010090: 626c 616e 6b27 3e7b 7572 6c7d 3c2f 613e  blank'>{url}</a>
-000100a0: 220a 2020 2020 2020 2020 2320 4170 706c  ".        # Appl
-000100b0: 790a 2020 2020 2020 2020 7365 6c66 2e5f  y.        self._
-000100c0: 7461 675f 6869 6e74 735f 6469 762e 696e  tag_hints_div.in
-000100d0: 6e65 7248 544d 4c20 3d20 6869 6e74 5f68  nerHTML = hint_h
-000100e0: 746d 6c0a 2020 2020 2020 2020 7365 6c66  tml.        self
-000100f0: 2e5f 7461 6773 5f64 6976 2e69 6e6e 6572  ._tags_div.inner
-00010100: 4854 4d4c 203d 2074 6167 735f 6874 6d6c  HTML = tags_html
-00010110: 0a0a 2020 2020 6465 6620 636c 6f73 6528  ..    def close(
-00010120: 7365 6c66 2c20 653d 4e6f 6e65 293a 0a20  self, e=None):. 
-00010130: 2020 2020 2020 2073 656c 662e 5f74 696d         self._tim
-00010140: 655f 6564 6974 2e63 6c6f 7365 2829 0a20  e_edit.close(). 
-00010150: 2020 2020 2020 2073 656c 662e 5f61 7574         self._aut
-00010160: 6f63 6f6d 706c 6574 6572 2e63 6c6f 7365  ocompleter.close
-00010170: 2829 0a20 2020 2020 2020 2073 7570 6572  ().        super
-00010180: 2829 2e63 6c6f 7365 2865 290a 0a20 2020  ().close(e)..   
-00010190: 2064 6566 205f 6f6e 5f6b 6579 2873 656c   def _on_key(sel
-000101a0: 662c 2065 293a 0a20 2020 2020 2020 206b  f, e):.        k
-000101b0: 6579 203d 2065 2e6b 6579 2e6c 6f77 6572  ey = e.key.lower
-000101c0: 2829 0a20 2020 2020 2020 2069 6620 7365  ().        if se
-000101d0: 6c66 2e5f 6175 746f 636f 6d70 6c65 7465  lf._autocomplete
-000101e0: 722e 6f6e 5f6b 6579 2865 293a 0a20 2020  r.on_key(e):.   
-000101f0: 2020 2020 2020 2020 2065 2e73 746f 7050           e.stopP
-00010200: 726f 7061 6761 7469 6f6e 2829 0a20 2020  ropagation().   
-00010210: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
-00010220: 2020 2020 2020 2020 656c 6966 206b 6579          elif key
-00010230: 203d 3d20 2265 6e74 6572 2220 6f72 206b   == "enter" or k
-00010240: 6579 203d 3d20 2272 6574 7572 6e22 3a0a  ey == "return":.
-00010250: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00010260: 2e73 7562 6d69 745f 736f 6f6e 2829 0a20  .submit_soon(). 
-00010270: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00010280: 2020 2020 2020 2020 2073 7570 6572 2829           super()
-00010290: 2e5f 6f6e 5f6b 6579 2865 290a 0a20 2020  ._on_key(e)..   
-000102a0: 2064 6566 205f 6465 6c65 7465 3128 7365   def _delete1(se
-000102b0: 6c66 293a 0a20 2020 2020 2020 2073 656c  lf):.        sel
-000102c0: 662e 5f64 656c 6574 655f 6275 7432 2e73  f._delete_but2.s
-000102d0: 7479 6c65 2e64 6973 706c 6179 203d 2022  tyle.display = "
-000102e0: 626c 6f63 6b22 0a0a 2020 2020 6465 6620  block"..    def 
-000102f0: 5f64 656c 6574 6532 2873 656c 6629 3a0a  _delete2(self):.
-00010300: 2020 2020 2020 2020 7265 636f 7264 203d          record =
-00010310: 2073 656c 662e 5f72 6563 6f72 640a 2020   self._record.  
-00010320: 2020 2020 2020 7769 6e64 6f77 2e73 746f        window.sto
-00010330: 7265 732e 6d61 6b65 5f68 6964 6465 6e28  res.make_hidden(
-00010340: 7265 636f 7264 2920 2023 2053 6574 7320  record)  # Sets 
-00010350: 7468 6520 6465 7363 7269 7074 696f 6e0a  the description.
-00010360: 2020 2020 2020 2020 7265 636f 7264 2e74          record.t
-00010370: 3220 3d20 7265 636f 7264 2e74 3120 2b20  2 = record.t1 + 
-00010380: 3120 2023 2053 6574 2064 7572 6174 696f  1  # Set duratio
-00010390: 6e20 746f 2031 7320 2874 3120 3d3d 2074  n to 1s (t1 == t
-000103a0: 3220 6d65 616e 7320 7275 6e6e 696e 6729  2 means running)
-000103b0: 0a20 2020 2020 2020 2077 696e 646f 772e  .        window.
-000103c0: 7374 6f72 652e 7265 636f 7264 732e 7075  store.records.pu
-000103d0: 7428 7265 636f 7264 290a 2020 2020 2020  t(record).      
-000103e0: 2020 7365 6c66 2e63 6c6f 7365 2872 6563    self.close(rec
-000103f0: 6f72 6429 0a0a 2020 2020 6465 6620 5f73  ord)..    def _s
-00010400: 746f 705f 616c 6c5f 7275 6e6e 696e 675f  top_all_running_
-00010410: 7265 636f 7264 7328 7365 6c66 2c20 7432  records(self, t2
-00010420: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-00010430: 7265 636f 7264 7320 3d20 7769 6e64 6f77  records = window
-00010440: 2e73 746f 7265 2e72 6563 6f72 6473 2e67  .store.records.g
-00010450: 6574 5f72 756e 6e69 6e67 5f72 6563 6f72  et_running_recor
-00010460: 6473 2829 0a20 2020 2020 2020 2069 6620  ds().        if 
-00010470: 7432 2069 7320 4e6f 6e65 3a0a 2020 2020  t2 is None:.    
-00010480: 2020 2020 2020 2020 7432 203d 2064 742e          t2 = dt.
-00010490: 6e6f 7728 290a 2020 2020 2020 2020 666f  now().        fo
-000104a0: 7220 7265 636f 7264 2069 6e20 7265 636f  r record in reco
-000104b0: 7264 733a 0a20 2020 2020 2020 2020 2020  rds:.           
-000104c0: 2072 6563 6f72 642e 7432 203d 206d 6178   record.t2 = max
-000104d0: 2872 6563 6f72 642e 7431 202b 2032 2c20  (record.t1 + 2, 
-000104e0: 7432 290a 2020 2020 2020 2020 2020 2020  t2).            
-000104f0: 7769 6e64 6f77 2e73 746f 7265 2e72 6563  window.store.rec
-00010500: 6f72 6473 2e70 7574 2872 6563 6f72 6429  ords.put(record)
-00010510: 0a0a 2020 2020 6465 6620 7375 626d 6974  ..    def submit
-00010520: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00010530: 2222 2253 7562 6d69 7420 7468 6520 7265  """Submit the re
-00010540: 636f 7264 2074 6f20 7468 6520 7374 6f72  cord to the stor
-00010550: 652e 2222 220a 2020 2020 2020 2020 2320  e.""".        # 
-00010560: 5375 626d 6974 206d 6561 6e73 2063 6c6f  Submit means clo
-00010570: 7365 2069 6620 7468 6572 6520 7761 7320  se if there was 
-00010580: 6e6f 7468 696e 6720 746f 2073 7562 6d69  nothing to submi
-00010590: 740a 2020 2020 2020 2020 6966 2073 656c  t.        if sel
-000105a0: 662e 5f73 7562 6d69 745f 6275 742e 6469  f._submit_but.di
-000105b0: 7361 626c 6564 3a0a 2020 2020 2020 2020  sabled:.        
-000105c0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-000105d0: 636c 6f73 6528 290a 2020 2020 2020 2020  close().        
-000105e0: 2320 5365 7420 7265 636f 7264 2e64 730a  # Set record.ds.
-000105f0: 2020 2020 2020 2020 5f2c 2070 6172 7473          _, parts
-00010600: 203d 2075 7469 6c73 2e67 6574 5f74 6167   = utils.get_tag
-00010610: 735f 616e 645f 7061 7274 735f 6672 6f6d  s_and_parts_from
-00010620: 5f73 7472 696e 6728 746f 5f73 7472 2873  _string(to_str(s
-00010630: 656c 662e 5f64 735f 696e 7075 742e 7661  elf._ds_input.va
-00010640: 6c75 6529 290a 2020 2020 2020 2020 7365  lue)).        se
-00010650: 6c66 2e5f 7265 636f 7264 2e64 7320 3d20  lf._record.ds = 
-00010660: 7061 7274 732e 6a6f 696e 2822 2229 0a20  parts.join(""). 
-00010670: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
-00010680: 6c66 2e5f 7265 636f 7264 2e64 733a 0a20  lf._record.ds:. 
-00010690: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000106a0: 5f72 6563 6f72 642e 706f 7028 2264 7322  _record.pop("ds"
-000106b0: 2c20 4e6f 6e65 290a 2020 2020 2020 2020  , None).        
-000106c0: 2320 5072 6576 656e 7420 6d75 6c74 6970  # Prevent multip
-000106d0: 6c65 2074 696d 6572 7320 6174 206f 6e63  le timers at onc
-000106e0: 650a 2020 2020 2020 2020 6966 2073 656c  e.        if sel
-000106f0: 662e 5f72 6563 6f72 642e 7431 203d 3d20  f._record.t1 == 
-00010700: 7365 6c66 2e5f 7265 636f 7264 2e74 323a  self._record.t2:
-00010710: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00010720: 662e 5f73 746f 705f 616c 6c5f 7275 6e6e  f._stop_all_runn
-00010730: 696e 675f 7265 636f 7264 7328 7365 6c66  ing_records(self
-00010740: 2e5f 7265 636f 7264 2e74 3129 0a20 2020  ._record.t1).   
-00010750: 2020 2020 2023 2041 7070 6c79 0a20 2020       # Apply.   
-00010760: 2020 2020 2077 696e 646f 772e 7374 6f72       window.stor
-00010770: 652e 7265 636f 7264 732e 7075 7428 7365  e.records.put(se
-00010780: 6c66 2e5f 7265 636f 7264 290a 2020 2020  lf._record).    
-00010790: 2020 2020 7375 7065 7228 292e 7375 626d      super().subm
-000107a0: 6974 2873 656c 662e 5f72 6563 6f72 6429  it(self._record)
-000107b0: 0a20 2020 2020 2020 2023 2053 7461 7274  .        # Start
-000107c0: 2070 6f6d 6f3f 0a20 2020 2020 2020 2069   pomo?.        i
-000107d0: 6620 7769 6e64 6f77 2e73 696d 706c 6573  f window.simples
-000107e0: 6574 7469 6e67 732e 6765 7428 2270 6f6d  ettings.get("pom
-000107f0: 6f64 6f72 6f5f 656e 6162 6c65 6422 293a  odoro_enabled"):
-00010800: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00010810: 7365 6c66 2e5f 6c6d 6f64 6520 3d3d 2022  self._lmode == "
-00010820: 7374 6172 7422 3a0a 2020 2020 2020 2020  start":.        
-00010830: 2020 2020 2020 2020 7365 6c66 2e5f 6361          self._ca
-00010840: 6e76 6173 2e70 6f6d 6f64 6f72 6f5f 6469  nvas.pomodoro_di
-00010850: 616c 6f67 2e73 7461 7274 5f77 6f72 6b28  alog.start_work(
-00010860: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00010870: 6966 2073 656c 662e 5f6c 6d6f 6465 203d  if self._lmode =
-00010880: 3d20 2273 746f 7022 3a0a 2020 2020 2020  = "stop":.      
-00010890: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-000108a0: 6361 6e76 6173 2e70 6f6d 6f64 6f72 6f5f  canvas.pomodoro_
-000108b0: 6469 616c 6f67 2e73 746f 7028 290a 0a20  dialog.stop().. 
-000108c0: 2020 2064 6566 2072 6573 756d 655f 7265     def resume_re
-000108d0: 636f 7264 2873 656c 6629 3a0a 2020 2020  cord(self):.    
-000108e0: 2020 2020 2222 2253 7461 7274 2061 206e      """Start a n
-000108f0: 6577 2072 6563 6f72 6420 7769 7468 2074  ew record with t
-00010900: 6865 2073 616d 6520 6465 7363 7269 7074  he same descript
-00010910: 696f 6e2e 2222 220a 2020 2020 2020 2020  ion.""".        
-00010920: 2320 5468 6520 7265 7375 6d65 2062 7574  # The resume but
-00010930: 746f 6e20 7368 6f75 6c64 206f 6e6c 7920  ton should only 
-00010940: 6265 2076 6973 6962 6c65 2066 6f72 206e  be visible for n
-00010950: 6f6e 2d72 756e 6e69 6e67 2072 6563 6f72  on-running recor
-00010960: 6473 2c20 6275 740a 2020 2020 2020 2020  ds, but.        
-00010970: 2320 6966 2028 666f 7220 7768 6174 6576  # if (for whatev
-00010980: 6572 2072 6561 736f 6e29 2074 6869 7320  er reason) this 
-00010990: 6765 7473 2063 616c 6c65 642c 2072 6573  gets called, res
-000109a0: 756d 6520 7769 6c6c 206d 6561 6e20 6c65  ume will mean le
-000109b0: 6176 6520 7275 6e6e 696e 672e 0a20 2020  ave running..   
-000109c0: 2020 2020 2069 6620 7365 6c66 2e5f 7265       if self._re
-000109d0: 636f 7264 2e74 3120 3d3d 2073 656c 662e  cord.t1 == self.
-000109e0: 5f72 6563 6f72 642e 7432 3a0a 2020 2020  _record.t2:.    
-000109f0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00010a00: 656c 662e 7375 626d 6974 2829 0a20 2020  elf.submit().   
-00010a10: 2020 2020 2023 2049 6e20 6361 7365 206f       # In case o
-00010a20: 7468 6572 2074 696d 6572 7320 6172 6520  ther timers are 
-00010a30: 7275 6e6e 6e69 6e67 2c20 7374 6f70 2074  runnning, stop t
-00010a40: 6865 7365 210a 2020 2020 2020 2020 7365  hese!.        se
-00010a50: 6c66 2e5f 7374 6f70 5f61 6c6c 5f72 756e  lf._stop_all_run
-00010a60: 6e69 6e67 5f72 6563 6f72 6473 2829 0a20  ning_records(). 
-00010a70: 2020 2020 2020 2023 2043 7265 6174 6520         # Create 
-00010a80: 6e65 7720 7265 636f 7264 2077 6974 6820  new record with 
-00010a90: 6375 7272 656e 7420 6465 7363 7269 7074  current descript
-00010aa0: 696f 6e0a 2020 2020 2020 2020 6e6f 7720  ion.        now 
-00010ab0: 3d20 6474 2e6e 6f77 2829 0a20 2020 2020  = dt.now().     
-00010ac0: 2020 2072 6563 6f72 6420 3d20 7769 6e64     record = wind
-00010ad0: 6f77 2e73 746f 7265 2e72 6563 6f72 6473  ow.store.records
-00010ae0: 2e63 7265 6174 6528 6e6f 772c 206e 6f77  .create(now, now
-00010af0: 290a 2020 2020 2020 2020 5f2c 2070 6172  ).        _, par
-00010b00: 7473 203d 2075 7469 6c73 2e67 6574 5f74  ts = utils.get_t
-00010b10: 6167 735f 616e 645f 7061 7274 735f 6672  ags_and_parts_fr
-00010b20: 6f6d 5f73 7472 696e 6728 746f 5f73 7472  om_string(to_str
-00010b30: 2873 656c 662e 5f64 735f 696e 7075 742e  (self._ds_input.
-00010b40: 7661 6c75 6529 290a 2020 2020 2020 2020  value)).        
-00010b50: 7265 636f 7264 2e64 7320 3d20 7061 7274  record.ds = part
-00010b60: 732e 6a6f 696e 2822 2229 0a20 2020 2020  s.join("").     
-00010b70: 2020 2077 696e 646f 772e 7374 6f72 652e     window.store.
-00010b80: 7265 636f 7264 732e 7075 7428 7265 636f  records.put(reco
-00010b90: 7264 290a 2020 2020 2020 2020 2320 436c  rd).        # Cl
-00010ba0: 6f73 6520 7468 6520 6469 616c 6f67 202d  ose the dialog -
-00010bb0: 2064 6f6e 2774 2061 7070 6c79 206c 6f63   don't apply loc
-00010bc0: 616c 2063 6861 6e67 6573 0a20 2020 2020  al changes.     
-00010bd0: 2020 2073 656c 662e 636c 6f73 6528 290a     self.close().
-00010be0: 2020 2020 2020 2020 2320 4d6f 7665 2074          # Move t
-00010bf0: 6f20 746f 6461 792c 2069 6620 6e65 6564  o today, if need
-00010c00: 6564 0a20 2020 2020 2020 2074 312c 2074  ed.        t1, t
-00010c10: 3220 3d20 7365 6c66 2e5f 6361 6e76 6173  2 = self._canvas
-00010c20: 2e72 616e 6765 2e67 6574 5f74 6172 6765  .range.get_targe
-00010c30: 745f 7261 6e67 6528 290a 2020 2020 2020  t_range().      
-00010c40: 2020 6966 206e 6f74 2028 7431 203c 206e    if not (t1 < n
-00010c50: 6f77 203c 2074 3229 3a0a 2020 2020 2020  ow < t2):.      
-00010c60: 2020 2020 2020 7431 2c20 7432 203d 2073        t1, t2 = s
-00010c70: 656c 662e 5f63 616e 7661 732e 7261 6e67  elf._canvas.rang
-00010c80: 652e 6765 745f 746f 6461 795f 7261 6e67  e.get_today_rang
-00010c90: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
-00010ca0: 7365 6c66 2e5f 6361 6e76 6173 2e72 616e  self._canvas.ran
-00010cb0: 6765 2e61 6e69 6d61 7465 5f72 616e 6765  ge.animate_range
-00010cc0: 2874 312c 2074 3229 0a20 2020 2020 2020  (t1, t2).       
-00010cd0: 2023 2053 7461 7274 2070 6f6d 6f3f 0a20   # Start pomo?. 
-00010ce0: 2020 2020 2020 2069 6620 7769 6e64 6f77         if window
-00010cf0: 2e73 696d 706c 6573 6574 7469 6e67 732e  .simplesettings.
-00010d00: 6765 7428 2270 6f6d 6f64 6f72 6f5f 656e  get("pomodoro_en
-00010d10: 6162 6c65 6422 293a 0a20 2020 2020 2020  abled"):.       
-00010d20: 2020 2020 2073 656c 662e 5f63 616e 7661       self._canva
-00010d30: 732e 706f 6d6f 646f 726f 5f64 6961 6c6f  s.pomodoro_dialo
-00010d40: 672e 7374 6172 745f 776f 726b 2829 0a0a  g.start_work()..
-00010d50: 0a63 6c61 7373 2054 6172 6765 7448 656c  .class TargetHel
-00010d60: 7065 723a 0a20 2020 2022 2222 4120 6c69  per:.    """A li
-00010d70: 7474 6c65 2063 6c61 7373 2074 6f20 6865  ttle class to he
-00010d80: 6c70 2077 6974 6820 7461 7267 6574 732e  lp with targets.
-00010d90: 2042 6563 6175 7365 2074 6172 6765 7473   Because targets
-00010da0: 206f 6363 7572 2069 6e20 7477 6f20 6469   occur in two di
-00010db0: 616c 6f67 732e 2222 220a 0a20 2020 2064  alogs."""..    d
-00010dc0: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
-00010dd0: 2c20 7461 677a 2c20 6469 7629 3a0a 2020  , tagz, div):.  
-00010de0: 2020 2020 2020 7365 6c66 2e5f 7461 677a        self._tagz
-00010df0: 203d 2074 6167 7a0a 0a20 2020 2020 2020   = tagz..       
-00010e00: 2064 6976 2e69 6e6e 6572 4854 4d4c 203d   div.innerHTML =
-00010e10: 2066 2222 220a 2020 2020 2020 2020 2020   f""".          
-00010e20: 2020 3c69 6e70 7574 2074 7970 653d 276e    <input type='n
-00010e30: 756d 6265 7227 206d 696e 3d31 2076 616c  umber' min=1 val
-00010e40: 7565 3d31 2073 7479 6c65 3d27 7769 6474  ue=1 style='widt
-00010e50: 683a 3565 6d3b 2720 2f3e 0a20 2020 2020  h:5em;' />.     
-00010e60: 2020 2020 2020 203c 7370 616e 2073 7479         <span sty
-00010e70: 6c65 3d27 7061 6464 696e 673a 2030 2031  le='padding: 0 1
-00010e80: 656d 3b27 3e68 6f75 7273 2070 6572 3c2f  em;'>hours per</
-00010e90: 7370 616e 3e0a 2020 2020 2020 2020 2020  span>.          
-00010ea0: 2020 3c73 656c 6563 743e 0a20 2020 2020    <select>.     
-00010eb0: 2020 2020 2020 2020 2020 203c 6f70 7469             <opti
-00010ec0: 6f6e 2076 616c 7565 3d27 6e6f 6e65 273e  on value='none'>
-00010ed0: 4e6f 2074 6172 6765 743c 2f6f 7074 696f  No target</optio
-00010ee0: 6e3e 0a20 2020 2020 2020 2020 2020 2020  n>.             
-00010ef0: 2020 203c 6f70 7469 6f6e 2076 616c 7565     <option value
-00010f00: 3d27 6461 7927 3e44 6179 3c2f 6f70 7469  ='day'>Day</opti
-00010f10: 6f6e 3e0a 2020 2020 2020 2020 2020 2020  on>.            
-00010f20: 2020 2020 3c6f 7074 696f 6e20 7661 6c75      <option valu
-00010f30: 653d 2777 6565 6b27 3e57 6565 6b3c 2f6f  e='week'>Week</o
-00010f40: 7074 696f 6e3e 0a20 2020 2020 2020 2020  ption>.         
-00010f50: 2020 2020 2020 203c 6f70 7469 6f6e 2076         <option v
-00010f60: 616c 7565 3d27 6d6f 6e74 6827 3e4d 6f6e  alue='month'>Mon
-00010f70: 7468 3c2f 6f70 7469 6f6e 3e0a 2020 2020  th</option>.    
-00010f80: 2020 2020 2020 2020 2020 2020 3c6f 7074              <opt
-00010f90: 696f 6e20 7661 6c75 653d 2779 6561 7227  ion value='year'
-00010fa0: 3e59 6561 723c 2f6f 7074 696f 6e3e 0a20  >Year</option>. 
-00010fb0: 2020 2020 2020 2020 2020 203c 2f73 656c             </sel
-00010fc0: 6563 743e 0a20 2020 2020 2020 2020 2020  ect>.           
-00010fd0: 2022 2222 0a0a 2020 2020 2020 2020 7365   """..        se
-00010fe0: 6c66 2e5f 686f 7572 5f69 6e70 7574 2c20  lf._hour_input, 
-00010ff0: 5f2c 2073 656c 662e 5f70 6572 696f 645f  _, self._period_
-00011000: 7365 6c65 6374 203d 2064 6976 2e63 6869  select = div.chi
-00011010: 6c64 7265 6e0a 0a20 2020 2064 6566 206c  ldren..    def l
-00011020: 6f61 645f 6672 6f6d 5f69 6e66 6f28 7365  oad_from_info(se
-00011030: 6c66 2c20 696e 666f 293a 0a20 2020 2020  lf, info):.     
-00011040: 2020 2074 6172 6765 7473 203d 2069 6e66     targets = inf
-00011050: 6f2e 6765 7428 2274 6172 6765 7473 222c  o.get("targets",
-00011060: 204e 6f6e 6529 206f 7220 7b7d 0a20 2020   None) or {}.   
-00011070: 2020 2020 2066 6f72 2070 6572 696f 642c       for period,
-00011080: 2068 6f75 7273 2069 6e20 7461 7267 6574   hours in target
-00011090: 732e 6974 656d 7328 293a 0a20 2020 2020  s.items():.     
-000110a0: 2020 2020 2020 2069 6620 7065 7269 6f64         if period
-000110b0: 2061 6e64 2068 6f75 7273 3a0a 2020 2020   and hours:.    
-000110c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000110d0: 2e5f 686f 7572 5f69 6e70 7574 2e76 616c  ._hour_input.val
-000110e0: 7565 203d 2068 6f75 7273 206f 7220 310a  ue = hours or 1.
-000110f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011100: 7365 6c66 2e5f 7065 7269 6f64 5f73 656c  self._period_sel
-00011110: 6563 742e 7661 6c75 6520 3d20 7065 7269  ect.value = peri
-00011120: 6f64 206f 7220 226e 6f6e 6522 0a20 2020  od or "none".   
-00011130: 2020 2020 2020 2020 2020 2020 2062 7265               bre
-00011140: 616b 0a20 2020 2020 2020 2020 2020 2065  ak.            e
-00011150: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00011160: 2020 2020 2073 656c 662e 5f68 6f75 725f       self._hour_
-00011170: 696e 7075 742e 7661 6c75 6520 3d20 300a  input.value = 0.
-00011180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011190: 7365 6c66 2e5f 7065 7269 6f64 5f73 656c  self._period_sel
-000111a0: 6563 742e 7661 6c75 6520 3d20 226e 6f6e  ect.value = "non
-000111b0: 6522 0a0a 2020 2020 6465 6620 7772 6974  e"..    def writ
-000111c0: 655f 746f 5f69 6e66 6f28 7365 6c66 2c20  e_to_info(self, 
-000111d0: 696e 666f 293a 0a20 2020 2020 2020 2074  info):.        t
-000111e0: 6172 6765 7473 203d 207b 7d0a 0a20 2020  argets = {}..   
-000111f0: 2020 2020 2068 6f75 7273 203d 2066 6c6f       hours = flo
-00011200: 6174 2873 656c 662e 5f68 6f75 725f 696e  at(self._hour_in
-00011210: 7075 742e 7661 6c75 6529 0a20 2020 2020  put.value).     
-00011220: 2020 2070 6572 696f 6420 3d20 7365 6c66     period = self
-00011230: 2e5f 7065 7269 6f64 5f73 656c 6563 742e  ._period_select.
-00011240: 7661 6c75 650a 2020 2020 2020 2020 6966  value.        if
-00011250: 2068 6f75 7273 203e 2030 2061 6e64 2070   hours > 0 and p
-00011260: 6572 696f 6420 616e 6420 7065 7269 6f64  eriod and period
-00011270: 2021 3d20 226e 6f6e 6522 3a0a 2020 2020   != "none":.    
-00011280: 2020 2020 2020 2020 7461 7267 6574 735b          targets[
-00011290: 7065 7269 6f64 5d20 3d20 686f 7572 730a  period] = hours.
-000112a0: 0a20 2020 2020 2020 2069 6e66 6f2e 7461  .        info.ta
-000112b0: 7267 6574 7320 3d20 7461 7267 6574 730a  rgets = targets.
-000112c0: 0a0a 636c 6173 7320 5461 6743 6f6d 626f  ..class TagCombo
-000112d0: 4469 616c 6f67 2842 6173 6544 6961 6c6f  Dialog(BaseDialo
-000112e0: 6729 3a0a 2020 2020 2222 2244 6961 6c6f  g):.    """Dialo
-000112f0: 6720 746f 2063 6f6e 6669 6775 7265 2061  g to configure a
-00011300: 2063 6f6d 6269 6e61 7469 6f6e 206f 6620   combination of 
-00011310: 7461 6773 2e22 2222 0a0a 2020 2020 6465  tags."""..    de
-00011320: 6620 6f70 656e 2873 656c 662c 2074 6167  f open(self, tag
-00011330: 732c 2063 616c 6c62 6163 6b29 3a0a 2020  s, callback):.  
-00011340: 2020 2020 2020 2320 5075 7420 696e 2064        # Put in d
-00011350: 6574 6572 6d69 6e69 7374 6963 206f 7264  eterministic ord
-00011360: 6572 0a20 2020 2020 2020 2069 6620 6973  er.        if is
-00011370: 696e 7374 616e 6365 2874 6167 732c 2073  instance(tags, s
-00011380: 7472 293a 0a20 2020 2020 2020 2020 2020  tr):.           
-00011390: 2074 6167 7320 3d20 7461 6773 2e73 706c   tags = tags.spl
-000113a0: 6974 2822 2022 290a 2020 2020 2020 2020  it(" ").        
-000113b0: 7461 6773 2e73 6f72 7428 290a 2020 2020  tags.sort().    
-000113c0: 2020 2020 7365 6c66 2e5f 7461 677a 203d      self._tagz =
-000113d0: 2074 6167 7a20 3d20 7461 6773 2e6a 6f69   tagz = tags.joi
-000113e0: 6e28 2220 2229 0a0a 2020 2020 2020 2020  n(" ")..        
-000113f0: 7365 6c66 2e6d 6169 6e64 6976 2e69 6e6e  self.maindiv.inn
-00011400: 6572 4854 4d4c 203d 2066 2222 220a 2020  erHTML = f""".  
-00011410: 2020 2020 2020 2020 2020 3c68 313e 3c69            <h1><i
-00011420: 2063 6c61 7373 3d27 6661 7327 3e5c 7566   class='fas'>\uf
-00011430: 3032 633c 2f69 3e26 6e62 7370 3b26 6e62  02c</i>&nbsp;&nb
-00011440: 7370 3b54 6167 2063 6f6d 626f 207b 7461  sp;Tag combo {ta
-00011450: 677a 7d0a 2020 2020 2020 2020 2020 2020  gz}.            
-00011460: 2020 2020 3c62 7574 746f 6e20 7479 7065      <button type
-00011470: 3d27 6275 7474 6f6e 273e 3c69 2063 6c61  ='button'><i cla
-00011480: 7373 3d27 6661 7327 3e5c 7566 3030 643c  ss='fas'>\uf00d<
-00011490: 2f69 3e3c 2f62 7574 746f 6e3e 0a20 2020  /i></button>.   
-000114a0: 2020 2020 2020 2020 2020 2020 203c 2f68               </h
-000114b0: 313e 0a20 2020 2020 2020 2020 2020 203c  1>.            <
-000114c0: 6832 3e3c 6920 636c 6173 733d 2766 6173  h2><i class='fas
-000114d0: 273e 5c75 6630 3263 3c2f 693e 266e 6273  '>\uf02c</i>&nbs
-000114e0: 703b 266e 6273 703b 5461 6773 3c2f 6832  p;&nbsp;Tags</h2
-000114f0: 3e0a 2020 2020 2020 2020 2020 2020 3c64  >.            <d
-00011500: 6976 3e62 7574 746f 6e73 2066 6f72 2074  iv>buttons for t
-00011510: 6167 7320 676f 2068 6572 653c 2f64 6976  ags go here</div
-00011520: 3e0a 2020 2020 2020 2020 2020 2020 3c68  >.            <h
-00011530: 323e 3c69 2063 6c61 7373 3d27 6661 7327  2><i class='fas'
-00011540: 3e5c 7566 3134 303c 2f69 3e26 6e62 7370  >\uf140</i>&nbsp
-00011550: 3b26 6e62 7370 3b54 6172 6765 743c 2f68  ;&nbsp;Target</h
-00011560: 323e 0a20 2020 2020 2020 2020 2020 203c  2>.            <
-00011570: 6469 763e 7461 7267 6574 2067 6f65 7320  div>target goes 
-00011580: 6865 7265 3c2f 6469 763e 0a20 2020 2020  here</div>.     
-00011590: 2020 2020 2020 203c 6469 7620 7374 796c         <div styl
-000115a0: 653d 276d 6172 6769 6e2d 746f 703a 3265  e='margin-top:2e
-000115b0: 6d3b 273e 3c2f 6469 763e 0a20 2020 2020  m;'></div>.     
-000115c0: 2020 2020 2020 203c 6469 7620 7374 796c         <div styl
-000115d0: 653d 2764 6973 706c 6179 3a20 666c 6578  e='display: flex
-000115e0: 3b6a 7573 7469 6679 2d63 6f6e 7465 6e74  ;justify-content
-000115f0: 3a20 666c 6578 2d65 6e64 3b27 3e0a 2020  : flex-end;'>.  
-00011600: 2020 2020 2020 2020 2020 2020 2020 3c62                <b
-00011610: 7574 746f 6e20 7479 7065 3d27 6275 7474  utton type='butt
-00011620: 6f6e 2720 636c 6173 733d 2761 6374 696f  on' class='actio
-00011630: 6e62 7574 746f 6e27 3e3c 6920 636c 6173  nbutton'><i clas
-00011640: 733d 2766 6173 273e 5c75 6633 3034 3c2f  s='fas'>\uf304</
-00011650: 693e 266e 6273 703b 266e 6273 703b 5265  i>&nbsp;&nbsp;Re
-00011660: 6e61 6d65 3c2f 6275 7474 6f6e 3e0a 2020  name</button>.  
-00011670: 2020 2020 2020 2020 2020 2020 2020 3c62                <b
-00011680: 7574 746f 6e20 7479 7065 3d27 6275 7474  utton type='butt
-00011690: 6f6e 2720 636c 6173 733d 2761 6374 696f  on' class='actio
-000116a0: 6e62 7574 746f 6e27 3e3c 6920 636c 6173  nbutton'><i clas
-000116b0: 733d 2766 6173 273e 5c75 6630 3064 3c2f  s='fas'>\uf00d</
-000116c0: 693e 266e 6273 703b 266e 6273 703b 4361  i>&nbsp;&nbsp;Ca
-000116d0: 6e63 656c 3c2f 6275 7474 6f6e 3e0a 2020  ncel</button>.  
-000116e0: 2020 2020 2020 2020 2020 2020 2020 3c62                <b
-000116f0: 7574 746f 6e20 7479 7065 3d27 6275 7474  utton type='butt
-00011700: 6f6e 2720 636c 6173 733d 2761 6374 696f  on' class='actio
-00011710: 6e62 7574 746f 6e20 7375 626d 6974 273e  nbutton submit'>
-00011720: 3c69 2063 6c61 7373 3d27 6661 7327 3e5c  <i class='fas'>\
-00011730: 7566 3030 633c 2f69 3e26 6e62 7370 3b26  uf00c</i>&nbsp;&
-00011740: 6e62 7370 3b41 7070 6c79 3c2f 6275 7474  nbsp;Apply</butt
-00011750: 6f6e 3e0a 2020 2020 2020 2020 2020 2020  on>.            
-00011760: 3c2f 6469 763e 0a20 2020 2020 2020 2022  </div>.        "
-00011770: 2222 0a0a 2020 2020 2020 2020 636c 6f73  ""..        clos
-00011780: 655f 6275 7420 3d20 7365 6c66 2e6d 6169  e_but = self.mai
-00011790: 6e64 6976 2e63 6869 6c64 7265 6e5b 305d  ndiv.children[0]
-000117a0: 2e63 6869 6c64 7265 6e5b 2d31 5d0a 2020  .children[-1].  
-000117b0: 2020 2020 2020 280a 2020 2020 2020 2020        (.        
-000117c0: 2020 2020 5f2c 0a20 2020 2020 2020 2020      _,.         
-000117d0: 2020 205f 2c20 2023 2062 7574 746f 6e20     _,  # button 
-000117e0: 6865 6164 6572 0a20 2020 2020 2020 2020  header.         
-000117f0: 2020 2062 7574 746f 6e5f 6469 762c 0a20     button_div,. 
-00011800: 2020 2020 2020 2020 2020 205f 2c20 2023             _,  #
-00011810: 2074 6172 6765 7420 6865 6164 6572 0a20   target header. 
-00011820: 2020 2020 2020 2020 2020 2074 6172 6765             targe
-00011830: 745f 6469 762c 0a20 2020 2020 2020 2020  t_div,.         
-00011840: 2020 205f 2c20 2023 206d 6172 6769 6e0a     _,  # margin.
-00011850: 2020 2020 2020 2020 2020 2020 6669 6e69              fini
-00011860: 7368 5f62 7574 746f 6e73 2c0a 2020 2020  sh_buttons,.    
-00011870: 2020 2020 2920 3d20 7365 6c66 2e6d 6169      ) = self.mai
-00011880: 6e64 6976 2e63 6869 6c64 7265 6e0a 2020  ndiv.children.  
-00011890: 2020 2020 2020 636c 6f73 655f 6275 742e        close_but.
-000118a0: 6f6e 636c 6963 6b20 3d20 7365 6c66 2e63  onclick = self.c
-000118b0: 6c6f 7365 0a0a 2020 2020 2020 2020 6275  lose..        bu
-000118c0: 7474 6f6e 5f64 6976 2e69 6e6e 6572 4854  tton_div.innerHT
-000118d0: 4d4c 203d 2022 220a 2020 2020 2020 2020  ML = "".        
-000118e0: 666f 7220 7461 6720 696e 2074 6167 733a  for tag in tags:
-000118f0: 0a20 2020 2020 2020 2020 2020 2063 6c72  .            clr
-00011900: 203d 2077 696e 646f 772e 7374 6f72 652e   = window.store.
-00011910: 7365 7474 696e 6773 2e67 6574 5f63 6f6c  settings.get_col
-00011920: 6f72 5f66 6f72 5f74 6167 2874 6167 290a  or_for_tag(tag).
-00011930: 2020 2020 2020 2020 2020 2020 656c 203d              el =
-00011940: 2064 6f63 756d 656e 742e 6372 6561 7465   document.create
-00011950: 456c 656d 656e 7428 2262 7574 746f 6e22  Element("button"
-00011960: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00011970: 2e73 6574 4174 7472 6962 7574 6528 2274  .setAttribute("t
-00011980: 7970 6522 2c20 2262 7574 746f 6e22 290a  ype", "button").
-00011990: 2020 2020 2020 2020 2020 2020 656c 2e73              el.s
-000119a0: 7479 6c65 2e6d 6172 6769 6e52 6967 6874  tyle.marginRight
-000119b0: 203d 2022 3370 7822 0a20 2020 2020 2020   = "3px".       
-000119c0: 2020 2020 2065 6c2e 696e 6e65 7248 544d       el.innerHTM
-000119d0: 4c20 3d20 6622 3c62 2073 7479 6c65 3d27  L = f"<b style='
-000119e0: 636f 6c6f 723a 7b63 6c72 7d3b 273e 233c  color:{clr};'>#<
-000119f0: 2f62 3e22 202b 2074 6167 5b31 3a5d 0a20  /b>" + tag[1:]. 
-00011a00: 2020 2020 2020 2020 2020 2065 6c2e 6f6e             el.on
-00011a10: 636c 6963 6b20 3d20 7365 6c66 2e5f 6d61  click = self._ma
-00011a20: 6b65 5f63 6c69 636b 5f68 616e 646c 6572  ke_click_handler
-00011a30: 2874 6167 2c20 6361 6c6c 6261 636b 290a  (tag, callback).
-00011a40: 2020 2020 2020 2020 2020 2020 6275 7474              butt
-00011a50: 6f6e 5f64 6976 2e61 7070 656e 6443 6869  on_div.appendChi
-00011a60: 6c64 2865 6c29 0a0a 2020 2020 2020 2020  ld(el)..        
-00011a70: 7365 6c66 2e5f 7461 7267 6574 203d 2054  self._target = T
-00011a80: 6172 6765 7448 656c 7065 7228 7461 6773  argetHelper(tags
-00011a90: 2c20 7461 7267 6574 5f64 6976 290a 2020  , target_div).  
-00011aa0: 2020 2020 2020 6669 6e69 7368 5f62 7574        finish_but
-00011ab0: 746f 6e73 2e63 6869 6c64 7265 6e5b 305d  tons.children[0]
-00011ac0: 2e6f 6e63 6c69 636b 203d 2073 656c 662e  .onclick = self.
-00011ad0: 7265 6e61 6d65 0a20 2020 2020 2020 2066  rename.        f
-00011ae0: 696e 6973 685f 6275 7474 6f6e 732e 6368  inish_buttons.ch
-00011af0: 696c 6472 656e 5b31 5d2e 6f6e 636c 6963  ildren[1].onclic
-00011b00: 6b20 3d20 7365 6c66 2e63 6c6f 7365 0a20  k = self.close. 
-00011b10: 2020 2020 2020 2066 696e 6973 685f 6275         finish_bu
-00011b20: 7474 6f6e 732e 6368 696c 6472 656e 5b32  ttons.children[2
-00011b30: 5d2e 6f6e 636c 6963 6b20 3d20 7365 6c66  ].onclick = self
-00011b40: 2e73 7562 6d69 740a 0a20 2020 2020 2020  .submit..       
-00011b50: 2073 7570 6572 2829 2e6f 7065 6e28 4e6f   super().open(No
-00011b60: 6e65 290a 2020 2020 2020 2020 7365 6c66  ne).        self
-00011b70: 2e5f 6c6f 6164 5f63 7572 7265 6e74 2829  ._load_current()
-00011b80: 0a0a 2020 2020 6465 6620 5f6d 616b 655f  ..    def _make_
-00011b90: 636c 6963 6b5f 6861 6e64 6c65 7228 7365  click_handler(se
-00011ba0: 6c66 2c20 7461 672c 2063 616c 6c62 6163  lf, tag, callbac
-00011bb0: 6b29 3a0a 2020 2020 2020 2020 6465 6620  k):.        def 
-00011bc0: 6861 6e64 6c65 7228 293a 0a20 2020 2020  handler():.     
-00011bd0: 2020 2020 2020 2073 656c 662e 636c 6f73         self.clos
-00011be0: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
-00011bf0: 7365 6c66 2e5f 6361 6e76 6173 2e74 6167  self._canvas.tag
-00011c00: 5f64 6961 6c6f 672e 6f70 656e 2874 6167  _dialog.open(tag
-00011c10: 2c20 6361 6c6c 6261 636b 292c 0a0a 2020  , callback),..  
-00011c20: 2020 2020 2020 7265 7475 726e 2068 616e        return han
-00011c30: 646c 6572 0a0a 2020 2020 6465 6620 5f6c  dler..    def _l
-00011c40: 6f61 645f 6375 7272 656e 7428 7365 6c66  oad_current(self
-00011c50: 293a 0a20 2020 2020 2020 2069 6e66 6f20  ):.        info 
-00011c60: 3d20 7769 6e64 6f77 2e73 746f 7265 2e73  = window.store.s
-00011c70: 6574 7469 6e67 732e 6765 745f 7461 675f  ettings.get_tag_
-00011c80: 696e 666f 2873 656c 662e 5f74 6167 7a29  info(self._tagz)
-00011c90: 0a20 2020 2020 2020 2073 656c 662e 5f74  .        self._t
-00011ca0: 6172 6765 742e 6c6f 6164 5f66 726f 6d5f  arget.load_from_
-00011cb0: 696e 666f 2869 6e66 6f29 0a0a 2020 2020  info(info)..    
-00011cc0: 6465 6620 7375 626d 6974 2873 656c 6629  def submit(self)
-00011cd0: 3a0a 2020 2020 2020 2020 696e 666f 203d  :.        info =
-00011ce0: 207b 7d0a 2020 2020 2020 2020 7365 6c66   {}.        self
-00011cf0: 2e5f 7461 7267 6574 2e77 7269 7465 5f74  ._target.write_t
-00011d00: 6f5f 696e 666f 2869 6e66 6f29 0a20 2020  o_info(info).   
-00011d10: 2020 2020 2077 696e 646f 772e 7374 6f72       window.stor
-00011d20: 652e 7365 7474 696e 6773 2e73 6574 5f74  e.settings.set_t
-00011d30: 6167 5f69 6e66 6f28 7365 6c66 2e5f 7461  ag_info(self._ta
-00011d40: 677a 2c20 696e 666f 290a 2020 2020 2020  gz, info).      
-00011d50: 2020 7375 7065 7228 292e 7375 626d 6974    super().submit
-00011d60: 2829 0a0a 2020 2020 6465 6620 7265 6e61  ()..    def rena
-00011d70: 6d65 2873 656c 6629 3a0a 2020 2020 2020  me(self):.      
-00011d80: 2020 7365 6c66 2e5f 6361 6e76 6173 2e74    self._canvas.t
-00011d90: 6167 5f72 656e 616d 655f 6469 616c 6f67  ag_rename_dialog
-00011da0: 2e6f 7065 6e28 7365 6c66 2e5f 7461 677a  .open(self._tagz
-00011db0: 2e73 706c 6974 2822 2022 292c 2073 656c  .split(" "), sel
-00011dc0: 662e 636c 6f73 6529 0a0a 0a63 6c61 7373  f.close)...class
-00011dd0: 2054 6167 4469 616c 6f67 2842 6173 6544   TagDialog(BaseD
-00011de0: 6961 6c6f 6729 3a0a 2020 2020 2222 2244  ialog):.    """D
-00011df0: 6961 6c6f 6720 746f 2063 6f6e 6669 6775  ialog to configu
-00011e00: 7265 2061 2073 696e 676c 6574 6f6e 2074  re a singleton t
-00011e10: 6167 2e22 2222 0a0a 2020 2020 6465 6620  ag."""..    def 
-00011e20: 6f70 656e 2873 656c 662c 2074 6167 732c  open(self, tags,
-00011e30: 2063 616c 6c62 6163 6b3d 4e6f 6e65 293a   callback=None):
-00011e40: 0a20 2020 2020 2020 2023 2050 7574 2069  .        # Put i
-00011e50: 6e20 6465 7465 726d 696e 6973 7469 6320  n deterministic 
-00011e60: 6f72 6465 720a 2020 2020 2020 2020 6966  order.        if
-00011e70: 2069 7369 6e73 7461 6e63 6528 7461 6773   isinstance(tags
-00011e80: 2c20 7374 7229 3a0a 2020 2020 2020 2020  , str):.        
-00011e90: 2020 2020 7461 6773 203d 2074 6167 732e      tags = tags.
-00011ea0: 7370 6c69 7428 2220 2229 0a20 2020 2020  split(" ").     
-00011eb0: 2020 2074 6167 732e 736f 7274 2829 0a20     tags.sort(). 
-00011ec0: 2020 2020 2020 2073 656c 662e 5f74 6167         self._tag
-00011ed0: 7a20 3d20 7461 677a 203d 2074 6167 732e  z = tagz = tags.
-00011ee0: 6a6f 696e 2822 2022 290a 0a20 2020 2020  join(" ")..     
-00011ef0: 2020 2073 656c 662e 5f64 6566 6175 6c74     self._default
-00011f00: 5f63 6f6c 6f72 203d 2077 696e 646f 772e  _color = window.
-00011f10: 6672 6f6e 742e 434f 4c4f 5253 2e61 6363  front.COLORS.acc
-00011f20: 5f63 6c72 0a20 2020 2020 2020 2023 2073  _clr.        # s
-00011f30: 656c 662e 5f64 6566 6175 6c74 5f63 6f6c  elf._default_col
-00011f40: 6f72 203d 2075 7469 6c73 2e63 6f6c 6f72  or = utils.color
-00011f50: 5f66 726f 6d5f 6e61 6d65 2873 656c 662e  _from_name(self.
-00011f60: 5f74 6167 7a29 0a0a 2020 2020 2020 2020  _tagz)..        
-00011f70: 7365 6c66 2e6d 6169 6e64 6976 2e69 6e6e  self.maindiv.inn
-00011f80: 6572 4854 4d4c 203d 2066 2222 220a 2020  erHTML = f""".  
-00011f90: 2020 2020 2020 2020 2020 3c68 313e 3c69            <h1><i
-00011fa0: 2063 6c61 7373 3d27 6661 7327 3e5c 7566   class='fas'>\uf
-00011fb0: 3032 623c 2f69 3e26 6e62 7370 3b26 6e62  02b</i>&nbsp;&nb
-00011fc0: 7370 3b43 6f6e 6669 6775 7265 2074 6167  sp;Configure tag
-00011fd0: 207b 7461 677a 7d0a 2020 2020 2020 2020   {tagz}.        
-00011fe0: 2020 2020 2020 2020 3c62 7574 746f 6e20          <button 
-00011ff0: 7479 7065 3d27 6275 7474 6f6e 273e 3c69  type='button'><i
-00012000: 2063 6c61 7373 3d27 6661 7327 3e5c 7566   class='fas'>\uf
-00012010: 3030 643c 2f69 3e3c 2f62 7574 746f 6e3e  00d</i></button>
-00012020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012030: 203c 2f68 313e 0a20 2020 2020 2020 2020   </h1>.         
-00012040: 2020 203c 6832 3e3c 6920 636c 6173 733d     <h2><i class=
-00012050: 2766 6173 273e 5c75 6631 3430 3c2f 693e  'fas'>\uf140</i>
-00012060: 266e 6273 703b 266e 6273 703b 5461 7267  &nbsp;&nbsp;Targ
-00012070: 6574 3c2f 6832 3e0a 2020 2020 2020 2020  et</h2>.        
-00012080: 2020 2020 3c64 6976 3e74 6172 6765 7420      <div>target 
-00012090: 676f 6573 2068 6572 653c 2f64 6976 3e0a  goes here</div>.
-000120a0: 2020 2020 2020 2020 2020 2020 3c68 323e              <h2>
-000120b0: 3c69 2063 6c61 7373 3d27 6661 7327 3e5c  <i class='fas'>\
-000120c0: 7566 3037 343c 2f69 3e26 6e62 7370 3b26  uf074</i>&nbsp;&
-000120d0: 6e62 7370 3b50 7269 6f72 6974 793c 2f68  nbsp;Priority</h
-000120e0: 323e 0a20 2020 2020 2020 2020 2020 203c  2>.            <
-000120f0: 7365 6c65 6374 3e0a 2020 2020 2020 2020  select>.        
-00012100: 2020 2020 2020 2020 3c6f 7074 696f 6e20          <option 
-00012110: 7661 6c75 653d 2731 273e 5072 696d 6172  value='1'>Primar
-00012120: 7920 2864 6566 6175 6c74 293c 2f6f 7074  y (default)</opt
-00012130: 696f 6e3e 0a20 2020 2020 2020 2020 2020  ion>.           
-00012140: 2020 2020 203c 6f70 7469 6f6e 2076 616c       <option val
-00012150: 7565 3d27 3227 3e53 6563 6f6e 6461 7279  ue='2'>Secondary
-00012160: 2028 666f 7220 2265 7874 7261 2220 7461   (for "extra" ta
-00012170: 6773 293c 2f6f 7074 696f 6e3e 0a20 2020  gs)</option>.   
-00012180: 2020 2020 2020 2020 203c 2f73 656c 6563           </selec
-00012190: 743e 0a20 2020 2020 2020 2020 2020 203c  t>.            <
-000121a0: 6832 3e3c 6920 636c 6173 733d 2766 6173  h2><i class='fas
-000121b0: 273e 5c75 6635 3366 3c2f 693e 266e 6273  '>\uf53f</i>&nbs
-000121c0: 703b 266e 6273 703b 436f 6c6f 723c 2f68  p;&nbsp;Color</h
-000121d0: 323e 0a20 2020 2020 2020 2020 2020 203c  2>.            <
-000121e0: 696e 7075 7420 7479 7065 3d27 7465 7874  input type='text
-000121f0: 2720 7374 796c 653d 2777 6964 7468 3a20  ' style='width: 
-00012200: 3130 3070 783b 2062 6f72 6465 723a 2035  100px; border: 5
-00012210: 7078 2073 6f6c 6964 2023 6565 6527 2073  px solid #eee' s
-00012220: 7065 6c6c 6368 6563 6b3d 2766 616c 7365  pellcheck='false
-00012230: 2720 2f3e 0a20 2020 2020 2020 2020 2020  ' />.           
-00012240: 203c 6275 7474 6f6e 2074 7970 653d 2762   <button type='b
-00012250: 7574 746f 6e27 2073 7479 6c65 3d27 6d61  utton' style='ma
-00012260: 7267 696e 2d6c 6566 743a 2032 7078 273e  rgin-left: 2px'>
-00012270: 3c69 2063 6c61 7373 3d27 6661 7327 3e5c  <i class='fas'>\
-00012280: 7566 3132 643c 2f69 3e20 4465 6661 756c  uf12d</i> Defaul
-00012290: 743c 2f62 7574 746f 6e3e 0a20 2020 2020  t</button>.     
-000122a0: 2020 2020 2020 203c 6275 7474 6f6e 2074         <button t
-000122b0: 7970 653d 2762 7574 746f 6e27 2073 7479  ype='button' sty
-000122c0: 6c65 3d27 6d61 7267 696e 2d6c 6566 743a  le='margin-left:
-000122d0: 2032 7078 273e 3c69 2063 6c61 7373 3d27   2px'><i class='
-000122e0: 6661 7327 3e5c 7566 3266 313c 2f69 3e20  fas'>\uf2f1</i> 
-000122f0: 5261 6e64 6f6d 3c2f 6275 7474 6f6e 3e0a  Random</button>.
-00012300: 2020 2020 2020 2020 2020 2020 3c62 723e              <br>
-00012310: 0a20 2020 2020 2020 2020 2020 203c 6469  .            <di
-00012320: 7620 7374 796c 653d 2764 6973 706c 6179  v style='display
-00012330: 3a20 696e 6c69 6e65 2d67 7269 643b 2067  : inline-grid; g
-00012340: 7269 642d 6761 703a 2032 7078 3b27 3e3c  rid-gap: 2px;'><
-00012350: 2f64 6976 3e0a 2020 2020 2020 2020 2020  /div>.          
-00012360: 2020 3c64 6976 2073 7479 6c65 3d27 6d61    <div style='ma
-00012370: 7267 696e 2d74 6f70 3a32 656d 3b27 3e3c  rgin-top:2em;'><
-00012380: 2f64 6976 3e0a 2020 2020 2020 2020 2020  /div>.          
-00012390: 2020 3c64 6976 2073 7479 6c65 3d27 6469    <div style='di
-000123a0: 7370 6c61 793a 2066 6c65 783b 6a75 7374  splay: flex;just
-000123b0: 6966 792d 636f 6e74 656e 743a 2066 6c65  ify-content: fle
-000123c0: 782d 656e 643b 273e 0a20 2020 2020 2020  x-end;'>.       
-000123d0: 2020 2020 2020 2020 203c 6275 7474 6f6e           <button
-000123e0: 2074 7970 653d 2762 7574 746f 6e27 2063   type='button' c
-000123f0: 6c61 7373 3d27 6163 7469 6f6e 6275 7474  lass='actionbutt
-00012400: 6f6e 273e 3c69 2063 6c61 7373 3d27 6661  on'><i class='fa
-00012410: 7327 3e5c 7566 3330 343c 2f69 3e26 6e62  s'>\uf304</i>&nb
-00012420: 7370 3b26 6e62 7370 3b52 656e 616d 653c  sp;&nbsp;Rename<
-00012430: 2f62 7574 746f 6e3e 0a20 2020 2020 2020  /button>.       
-00012440: 2020 2020 2020 2020 203c 6275 7474 6f6e           <button
-00012450: 2074 7970 653d 2762 7574 746f 6e27 2063   type='button' c
-00012460: 6c61 7373 3d27 6163 7469 6f6e 6275 7474  lass='actionbutt
-00012470: 6f6e 273e 3c69 2063 6c61 7373 3d27 6661  on'><i class='fa
-00012480: 7327 3e5c 7566 3030 643c 2f69 3e26 6e62  s'>\uf00d</i>&nb
-00012490: 7370 3b26 6e62 7370 3b43 616e 6365 6c3c  sp;&nbsp;Cancel<
-000124a0: 2f62 7574 746f 6e3e 0a20 2020 2020 2020  /button>.       
-000124b0: 2020 2020 2020 2020 203c 6275 7474 6f6e           <button
-000124c0: 2074 7970 653d 2762 7574 746f 6e27 2063   type='button' c
-000124d0: 6c61 7373 3d27 6163 7469 6f6e 6275 7474  lass='actionbutt
-000124e0: 6f6e 2073 7562 6d69 7427 3e3c 6920 636c  on submit'><i cl
-000124f0: 6173 733d 2766 6173 273e 5c75 6630 3063  ass='fas'>\uf00c
-00012500: 3c2f 693e 266e 6273 703b 266e 6273 703b  </i>&nbsp;&nbsp;
-00012510: 4170 706c 793c 2f62 7574 746f 6e3e 0a20  Apply</button>. 
-00012520: 2020 2020 2020 2020 2020 203c 2f64 6976             </div
-00012530: 3e0a 2020 2020 2020 2020 2222 220a 0a20  >.        """.. 
-00012540: 2020 2020 2020 2063 6c6f 7365 5f62 7574         close_but
-00012550: 203d 2073 656c 662e 6d61 696e 6469 762e   = self.maindiv.
-00012560: 6368 696c 6472 656e 5b30 5d2e 6368 696c  children[0].chil
-00012570: 6472 656e 5b2d 315d 0a0a 2020 2020 2020  dren[-1]..      
-00012580: 2020 280a 2020 2020 2020 2020 2020 2020    (.            
-00012590: 5f2c 2020 2320 6831 0a20 2020 2020 2020  _,  # h1.       
-000125a0: 2020 2020 205f 2c20 2023 2074 6172 6765       _,  # targe
-000125b0: 7420 6865 6164 6572 0a20 2020 2020 2020  t header.       
-000125c0: 2020 2020 2074 6172 6765 745f 6469 762c       target_div,
-000125d0: 0a20 2020 2020 2020 2020 2020 205f 2c20  .            _, 
-000125e0: 2023 2070 7269 6f72 6974 7920 6865 6164   # priority head
-000125f0: 6572 0a20 2020 2020 2020 2020 2020 2073  er.            s
-00012600: 656c 662e 5f70 7269 6f72 6974 795f 7365  elf._priority_se
-00012610: 6c65 6374 2c0a 2020 2020 2020 2020 2020  lect,.          
-00012620: 2020 5f2c 2020 2320 636f 6c6f 7220 6865    _,  # color he
-00012630: 6164 6572 0a20 2020 2020 2020 2020 2020  ader.           
-00012640: 2073 656c 662e 5f63 6f6c 6f72 5f69 6e70   self._color_inp
-00012650: 7574 2c0a 2020 2020 2020 2020 2020 2020  ut,.            
-00012660: 7365 6c66 2e5f 636f 6c6f 725f 6465 6661  self._color_defa
-00012670: 756c 745f 6275 7474 6f6e 2c0a 2020 2020  ult_button,.    
-00012680: 2020 2020 2020 2020 7365 6c66 2e5f 636f          self._co
-00012690: 6c6f 725f 7261 6e64 6f6d 5f62 7574 746f  lor_random_butto
-000126a0: 6e2c 0a20 2020 2020 2020 2020 2020 205f  n,.            _
-000126b0: 2c20 2023 2062 720a 2020 2020 2020 2020  ,  # br.        
-000126c0: 2020 2020 7365 6c66 2e5f 636f 6c6f 725f      self._color_
-000126d0: 6772 6964 2c0a 2020 2020 2020 2020 2020  grid,.          
-000126e0: 2020 5f2c 2020 2320 6761 700a 2020 2020    _,  # gap.    
-000126f0: 2020 2020 2020 2020 6669 6e69 7368 5f62          finish_b
-00012700: 7574 746f 6e73 2c0a 2020 2020 2020 2020  uttons,.        
-00012710: 2920 3d20 7365 6c66 2e6d 6169 6e64 6976  ) = self.maindiv
-00012720: 2e63 6869 6c64 7265 6e0a 0a20 2020 2020  .children..     
-00012730: 2020 2073 656c 662e 5f74 6172 6765 7420     self._target 
-00012740: 3d20 5461 7267 6574 4865 6c70 6572 2874  = TargetHelper(t
-00012750: 6167 732c 2074 6172 6765 745f 6469 7629  ags, target_div)
-00012760: 0a0a 2020 2020 2020 2020 2320 436f 6e6e  ..        # Conn
-00012770: 6563 7420 7468 696e 6773 2075 700a 2020  ect things up.  
-00012780: 2020 2020 2020 636c 6f73 655f 6275 742e        close_but.
-00012790: 6f6e 636c 6963 6b20 3d20 7365 6c66 2e63  onclick = self.c
-000127a0: 6c6f 7365 0a20 2020 2020 2020 2066 696e  lose.        fin
-000127b0: 6973 685f 6275 7474 6f6e 732e 6368 696c  ish_buttons.chil
-000127c0: 6472 656e 5b30 5d2e 6f6e 636c 6963 6b20  dren[0].onclick 
-000127d0: 3d20 7365 6c66 2e72 656e 616d 650a 2020  = self.rename.  
-000127e0: 2020 2020 2020 6669 6e69 7368 5f62 7574        finish_but
-000127f0: 746f 6e73 2e63 6869 6c64 7265 6e5b 315d  tons.children[1]
-00012800: 2e6f 6e63 6c69 636b 203d 2073 656c 662e  .onclick = self.
-00012810: 636c 6f73 650a 2020 2020 2020 2020 6669  close.        fi
-00012820: 6e69 7368 5f62 7574 746f 6e73 2e63 6869  nish_buttons.chi
-00012830: 6c64 7265 6e5b 325d 2e6f 6e63 6c69 636b  ldren[2].onclick
-00012840: 203d 2073 656c 662e 7375 626d 6974 0a0a   = self.submit..
-00012850: 2020 2020 2020 2020 7365 6c66 2e5f 636f          self._co
-00012860: 6c6f 725f 696e 7075 742e 6f6e 6368 616e  lor_input.onchan
-00012870: 6765 203d 206c 616d 6264 613a 2073 656c  ge = lambda: sel
-00012880: 662e 5f73 6574 5f63 6f6c 6f72 2873 656c  f._set_color(sel
-00012890: 662e 5f63 6f6c 6f72 5f69 6e70 7574 2e76  f._color_input.v
-000128a0: 616c 7565 290a 2020 2020 2020 2020 7365  alue).        se
-000128b0: 6c66 2e5f 636f 6c6f 725f 6465 6661 756c  lf._color_defaul
-000128c0: 745f 6275 7474 6f6e 2e6f 6e63 6c69 636b  t_button.onclick
-000128d0: 203d 2073 656c 662e 5f73 6574 5f64 6566   = self._set_def
-000128e0: 6175 6c74 5f63 6f6c 6f72 0a20 2020 2020  ault_color.     
-000128f0: 2020 2073 656c 662e 5f63 6f6c 6f72 5f72     self._color_r
-00012900: 616e 646f 6d5f 6275 7474 6f6e 2e6f 6e63  andom_button.onc
-00012910: 6c69 636b 203d 2073 656c 662e 5f73 6574  lick = self._set
-00012920: 5f72 616e 646f 6d5f 636f 6c6f 720a 0a20  _random_color.. 
-00012930: 2020 2020 2020 2023 2047 656e 6572 6174         # Generat
-00012940: 6520 7061 6c65 7474 650a 2020 2020 2020  e palette.      
-00012950: 2020 7365 6c66 2e5f 636f 6c6f 725f 6772    self._color_gr
-00012960: 6964 2e73 7479 6c65 2e67 7269 6454 656d  id.style.gridTem
-00012970: 706c 6174 6543 6f6c 756d 6e73 203d 2022  plateColumns = "
-00012980: 6175 746f 2022 2e72 6570 6561 7428 7574  auto ".repeat(ut
-00012990: 696c 732e 5041 4c45 5454 455f 434f 4c53  ils.PALETTE_COLS
-000129a0: 290a 2020 2020 2020 2020 666f 7220 6865  ).        for he
-000129b0: 7820 696e 2075 7469 6c73 2e50 414c 4554  x in utils.PALET
-000129c0: 5445 323a 0a20 2020 2020 2020 2020 2020  TE2:.           
-000129d0: 2065 6c20 3d20 646f 6375 6d65 6e74 2e63   el = document.c
-000129e0: 7265 6174 6545 6c65 6d65 6e74 2822 7370  reateElement("sp
-000129f0: 616e 2229 0a20 2020 2020 2020 2020 2020  an").           
-00012a00: 2065 6c2e 7374 796c 652e 6261 636b 6772   el.style.backgr
-00012a10: 6f75 6e64 203d 2068 6578 0a20 2020 2020  ound = hex.     
-00012a20: 2020 2020 2020 2065 6c2e 7374 796c 652e         el.style.
-00012a30: 7769 6474 6820 3d20 2233 3070 7822 0a20  width = "30px". 
-00012a40: 2020 2020 2020 2020 2020 2065 6c2e 7374             el.st
-00012a50: 796c 652e 6865 6967 6874 203d 2022 3330  yle.height = "30
-00012a60: 7078 220a 2020 2020 2020 2020 2020 2020  px".            
-00012a70: 7365 6c66 2e5f 6d61 6b65 5f63 6c69 636b  self._make_click
-00012a80: 6162 6c65 2865 6c2c 2068 6578 290a 2020  able(el, hex).  
-00012a90: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00012aa0: 636f 6c6f 725f 6772 6964 2e61 7070 656e  color_grid.appen
-00012ab0: 6443 6869 6c64 2865 6c29 0a0a 2020 2020  dChild(el)..    
-00012ac0: 2020 2020 7375 7065 7228 292e 6f70 656e      super().open
-00012ad0: 2863 616c 6c62 6163 6b29 0a20 2020 2020  (callback).     
-00012ae0: 2020 2073 656c 662e 5f6c 6f61 645f 6375     self._load_cu
-00012af0: 7272 656e 7428 290a 2020 2020 2020 2020  rrent().        
-00012b00: 6966 2075 7469 6c73 2e6c 6f6f 6b73 5f6c  if utils.looks_l
-00012b10: 696b 655f 6465 736b 746f 7028 293a 0a20  ike_desktop():. 
-00012b20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00012b30: 5f63 6f6c 6f72 5f69 6e70 7574 2e66 6f63  _color_input.foc
-00012b40: 7573 2829 0a20 2020 2020 2020 2020 2020  us().           
-00012b50: 2073 656c 662e 5f63 6f6c 6f72 5f69 6e70   self._color_inp
-00012b60: 7574 2e73 656c 6563 7428 290a 0a20 2020  ut.select()..   
-00012b70: 2064 6566 205f 6f6e 5f6b 6579 2873 656c   def _on_key(sel
-00012b80: 662c 2065 293a 0a20 2020 2020 2020 206b  f, e):.        k
-00012b90: 6579 203d 2065 2e6b 6579 2e6c 6f77 6572  ey = e.key.lower
-00012ba0: 2829 0a20 2020 2020 2020 2069 6620 6b65  ().        if ke
-00012bb0: 7920 3d3d 2022 656e 7465 7222 206f 7220  y == "enter" or 
-00012bc0: 6b65 7920 3d3d 2022 7265 7475 726e 223a  key == "return":
-00012bd0: 0a20 2020 2020 2020 2020 2020 2065 2e70  .            e.p
-00012be0: 7265 7665 6e74 4465 6661 756c 7428 290a  reventDefault().
-00012bf0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00012c00: 2e73 7562 6d69 7428 290a 2020 2020 2020  .submit().      
-00012c10: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00012c20: 2020 2020 7375 7065 7228 292e 5f6f 6e5f      super()._on_
-00012c30: 6b65 7928 6529 0a0a 2020 2020 6465 6620  key(e)..    def 
-00012c40: 5f6d 616b 655f 636c 6963 6b61 626c 6528  _make_clickable(
-00012c50: 7365 6c66 2c20 656c 2c20 6865 7829 3a0a  self, el, hex):.
-00012c60: 2020 2020 2020 2020 2320 6465 6620 636c          # def cl
-00012c70: 6963 6b63 616c 6c62 6163 6b28 293a 0a20  ickcallback():. 
-00012c80: 2020 2020 2020 2023 2020 2020 2073 656c         #     sel
-00012c90: 662e 5f63 6f6c 6f72 5f69 6e70 7574 2e76  f._color_input.v
-00012ca0: 616c 7565 203d 2068 6578 0a20 2020 2020  alue = hex.     
-00012cb0: 2020 2065 6c2e 6f6e 636c 6963 6b20 3d20     el.onclick = 
-00012cc0: 6c61 6d62 6461 3a20 7365 6c66 2e5f 7365  lambda: self._se
-00012cd0: 745f 636f 6c6f 7228 6865 7829 0a0a 2020  t_color(hex)..  
-00012ce0: 2020 6465 6620 5f73 6574 5f64 6566 6175    def _set_defau
-00012cf0: 6c74 5f63 6f6c 6f72 2873 656c 6629 3a0a  lt_color(self):.
-00012d00: 2020 2020 2020 2020 7365 6c66 2e5f 7365          self._se
-00012d10: 745f 636f 6c6f 7228 7365 6c66 2e5f 6465  t_color(self._de
-00012d20: 6661 756c 745f 636f 6c6f 7229 0a0a 2020  fault_color)..  
-00012d30: 2020 6465 6620 5f73 6574 5f72 616e 646f    def _set_rando
-00012d40: 6d5f 636f 6c6f 7228 7365 6c66 293a 0a20  m_color(self):. 
-00012d50: 2020 2020 2020 2063 6c72 203d 2022 2322         clr = "#"
-00012d60: 202b 204d 6174 682e 666c 6f6f 7228 4d61   + Math.floor(Ma
-00012d70: 7468 2e72 616e 646f 6d28 2920 2a20 3136  th.random() * 16
-00012d80: 3737 3732 3135 292e 746f 5374 7269 6e67  777215).toString
-00012d90: 2831 3629 0a20 2020 2020 2020 2073 656c  (16).        sel
-00012da0: 662e 5f73 6574 5f63 6f6c 6f72 2863 6c72  f._set_color(clr
-00012db0: 290a 0a20 2020 2064 6566 205f 7365 745f  )..    def _set_
-00012dc0: 636f 6c6f 7228 7365 6c66 2c20 636c 7229  color(self, clr)
-00012dd0: 3a0a 2020 2020 2020 2020 6966 206e 6f74  :.        if not
-00012de0: 2063 6c72 206f 7220 636c 722e 6c6f 7765   clr or clr.lowe
-00012df0: 7228 2920 696e 205b 2261 7574 6f22 2c20  r() in ["auto", 
-00012e00: 2275 6e64 6566 696e 6564 222c 2022 6e75  "undefined", "nu
-00012e10: 6c6c 225d 3a0a 2020 2020 2020 2020 2020  ll"]:.          
-00012e20: 2020 636c 7220 3d20 7365 6c66 2e5f 6465    clr = self._de
-00012e30: 6661 756c 745f 636f 6c6f 720a 2020 2020  fault_color.    
-00012e40: 2020 2020 6966 2063 6c72 2021 3d20 7365      if clr != se
-00012e50: 6c66 2e5f 636f 6c6f 725f 696e 7075 742e  lf._color_input.
-00012e60: 7661 6c75 653a 0a20 2020 2020 2020 2020  value:.         
-00012e70: 2020 2073 656c 662e 5f63 6f6c 6f72 5f69     self._color_i
-00012e80: 6e70 7574 2e76 616c 7565 203d 2063 6c72  nput.value = clr
-00012e90: 0a20 2020 2020 2020 2073 656c 662e 5f63  .        self._c
-00012ea0: 6f6c 6f72 5f69 6e70 7574 2e73 7479 6c65  olor_input.style
-00012eb0: 2e62 6f72 6465 7243 6f6c 6f72 203d 2022  .borderColor = "
-00012ec0: 7267 6261 2830 2c20 302c 2030 2c20 3029  rgba(0, 0, 0, 0)
-00012ed0: 220a 2020 2020 2020 2020 7365 6c66 2e5f  ".        self._
-00012ee0: 636f 6c6f 725f 696e 7075 742e 7374 796c  color_input.styl
-00012ef0: 652e 626f 7264 6572 436f 6c6f 7220 3d20  e.borderColor = 
-00012f00: 636c 720a 0a20 2020 2064 6566 205f 6c6f  clr..    def _lo
-00012f10: 6164 5f63 7572 7265 6e74 2873 656c 6629  ad_current(self)
-00012f20: 3a0a 2020 2020 2020 2020 696e 666f 203d  :.        info =
-00012f30: 2077 696e 646f 772e 7374 6f72 652e 7365   window.store.se
-00012f40: 7474 696e 6773 2e67 6574 5f74 6167 5f69  ttings.get_tag_i
-00012f50: 6e66 6f28 7365 6c66 2e5f 7461 677a 290a  nfo(self._tagz).
-00012f60: 2020 2020 2020 2020 7365 6c66 2e5f 7461          self._ta
-00012f70: 7267 6574 2e6c 6f61 645f 6672 6f6d 5f69  rget.load_from_i
-00012f80: 6e66 6f28 696e 666f 290a 2020 2020 2020  nfo(info).      
-00012f90: 2020 7365 6c66 2e5f 7072 696f 7269 7479    self._priority
-00012fa0: 5f73 656c 6563 742e 7661 6c75 6520 3d20  _select.value = 
-00012fb0: 696e 666f 2e67 6574 2822 7072 696f 7269  info.get("priori
-00012fc0: 7479 222c 2030 2920 6f72 2031 0a20 2020  ty", 0) or 1.   
-00012fd0: 2020 2020 2073 656c 662e 5f73 6574 5f63       self._set_c
-00012fe0: 6f6c 6f72 2869 6e66 6f2e 6765 7428 2263  olor(info.get("c
-00012ff0: 6f6c 6f72 222c 2022 2229 290a 0a20 2020  olor", ""))..   
-00013000: 2064 6566 2073 7562 6d69 7428 7365 6c66   def submit(self
-00013010: 293a 0a20 2020 2020 2020 2069 6e66 6f20  ):.        info 
-00013020: 3d20 7b7d 0a20 2020 2020 2020 2023 2053  = {}.        # S
-00013030: 6574 2074 6172 6765 740a 2020 2020 2020  et target.      
-00013040: 2020 7365 6c66 2e5f 7461 7267 6574 2e77    self._target.w
-00013050: 7269 7465 5f74 6f5f 696e 666f 2869 6e66  rite_to_info(inf
-00013060: 6f29 0a20 2020 2020 2020 2023 2053 6574  o).        # Set
-00013070: 2070 7269 6f72 6974 790a 2020 2020 2020   priority.      
-00013080: 2020 7072 696f 203d 2069 6e74 2873 656c    prio = int(sel
-00013090: 662e 5f70 7269 6f72 6974 795f 7365 6c65  f._priority_sele
-000130a0: 6374 2e76 616c 7565 290a 2020 2020 2020  ct.value).      
-000130b0: 2020 696e 666f 5b22 7072 696f 7269 7479    info["priority
-000130c0: 225d 203d 2030 2069 6620 7072 696f 203d  "] = 0 if prio =
-000130d0: 3d20 3120 656c 7365 2070 7269 6f0a 2020  = 1 else prio.  
-000130e0: 2020 2020 2020 2320 5365 7420 636f 6c6f        # Set colo
-000130f0: 720a 2020 2020 2020 2020 636c 7220 3d20  r.        clr = 
-00013100: 7365 6c66 2e5f 636f 6c6f 725f 696e 7075  self._color_inpu
-00013110: 742e 7661 6c75 650a 2020 2020 2020 2020  t.value.        
-00013120: 696e 666f 5b22 636f 6c6f 7222 5d20 3d20  info["color"] = 
-00013130: 2222 2069 6620 636c 7220 3d3d 2073 656c  "" if clr == sel
-00013140: 662e 5f64 6566 6175 6c74 5f63 6f6c 6f72  f._default_color
-00013150: 2065 6c73 6520 636c 720a 2020 2020 2020   else clr.      
-00013160: 2020 2320 5374 6f72 650a 2020 2020 2020    # Store.      
-00013170: 2020 7769 6e64 6f77 2e73 746f 7265 2e73    window.store.s
-00013180: 6574 7469 6e67 732e 7365 745f 7461 675f  ettings.set_tag_
-00013190: 696e 666f 2873 656c 662e 5f74 6167 7a2c  info(self._tagz,
-000131a0: 2069 6e66 6f29 0a20 2020 2020 2020 2073   info).        s
-000131b0: 7570 6572 2829 2e73 7562 6d69 7428 290a  uper().submit().
-000131c0: 0a20 2020 2064 6566 2072 656e 616d 6528  .    def rename(
-000131d0: 7365 6c66 293a 0a20 2020 2020 2020 2073  self):.        s
-000131e0: 656c 662e 5f63 616e 7661 732e 7461 675f  elf._canvas.tag_
-000131f0: 7265 6e61 6d65 5f64 6961 6c6f 672e 6f70  rename_dialog.op
-00013200: 656e 2873 656c 662e 5f74 6167 7a2e 7370  en(self._tagz.sp
-00013210: 6c69 7428 2220 2229 2c20 7365 6c66 2e63  lit(" "), self.c
-00013220: 6c6f 7365 290a 0a0a 636c 6173 7320 5461  lose)...class Ta
-00013230: 6750 7265 7365 7473 4469 616c 6f67 2842  gPresetsDialog(B
-00013240: 6173 6544 6961 6c6f 6729 3a0a 2020 2020  aseDialog):.    
-00013250: 2222 2244 6961 6c6f 6720 746f 2064 6566  """Dialog to def
-00013260: 696e 6520 7461 6720 7072 6573 6574 732e  ine tag presets.
-00013270: 2222 220a 0a20 2020 2064 6566 206f 7065  """..    def ope
-00013280: 6e28 7365 6c66 2c20 6361 6c6c 6261 636b  n(self, callback
-00013290: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-000132a0: 7365 6c66 2e6d 6169 6e64 6976 2e69 6e6e  self.maindiv.inn
-000132b0: 6572 4854 4d4c 203d 2066 2222 220a 2020  erHTML = f""".  
-000132c0: 2020 2020 2020 2020 2020 3c68 313e 3c69            <h1><i
-000132d0: 2063 6c61 7373 3d27 6661 7327 3e5c 7566   class='fas'>\uf
-000132e0: 3034 343c 2f69 3e26 6e62 7370 3b26 6e62  044</i>&nbsp;&nb
-000132f0: 7370 3b54 6167 2070 7265 7365 7473 0a20  sp;Tag presets. 
-00013300: 2020 2020 2020 2020 2020 2020 2020 203c                 <
-00013310: 6275 7474 6f6e 2074 7970 653d 2762 7574  button type='but
-00013320: 746f 6e27 3e3c 6920 636c 6173 733d 2766  ton'><i class='f
-00013330: 6173 273e 5c75 6630 3064 3c2f 693e 3c2f  as'>\uf00d</i></
-00013340: 6275 7474 6f6e 3e0a 2020 2020 2020 2020  button>.        
-00013350: 2020 2020 3c2f 6831 3e0a 2020 2020 2020      </h1>.      
-00013360: 2020 2020 2020 3c70 3e0a 2020 2020 2020        <p>.      
-00013370: 2020 2020 2020 5573 6520 7468 6520 7465        Use the te
-00013380: 7874 2066 6965 6c64 2062 656c 6f77 2074  xt field below t
-00013390: 6f20 6465 6669 6e65 2074 6167 2070 7265  o define tag pre
-000133a0: 7365 7473 2c20 6f6e 6520 7065 7220 6c69  sets, one per li
-000133b0: 6e65 2e0a 2020 2020 2020 2020 2020 2020  ne..            
-000133c0: 4561 6368 206c 696e 6520 6d61 7920 636f  Each line may co
-000133d0: 6e74 6169 6e20 6f6e 6520 6f72 206d 6f72  ntain one or mor
-000133e0: 6520 7461 6773 2e0a 2020 2020 2020 2020  e tags..        
-000133f0: 2020 2020 596f 7520 6361 6e20 616c 736f      You can also
-00013400: 2064 7261 672d 616e 642d 6472 6f70 2061   drag-and-drop a
-00013410: 2074 6578 7420 6669 6c65 2077 6974 6820   text file with 
-00013420: 7072 6573 6574 732e 0a20 2020 2020 2020  presets..       
-00013430: 2020 2020 203c 2f70 3e0a 2020 2020 2020       </p>.      
-00013440: 2020 2020 2020 3c62 7574 746f 6e20 7479        <button ty
-00013450: 7065 3d27 6275 7474 6f6e 273e 4368 6563  pe='button'>Chec
-00013460: 6b20 2620 5361 7665 3c2f 6275 7474 6f6e  k & Save</button
-00013470: 3e0a 2020 2020 2020 2020 2020 2020 3c64  >.            <d
-00013480: 6976 3e3c 2f64 6976 3e0a 2020 2020 2020  iv></div>.      
-00013490: 2020 2020 2020 3c74 6578 7461 7265 6120        <textarea 
-000134a0: 726f 7773 3d27 3132 270a 2020 2020 2020  rows='12'.      
-000134b0: 2020 2020 2020 2020 2020 7374 796c 653d            style=
-000134c0: 2762 6163 6b67 726f 756e 643a 2023 6666  'background: #ff
-000134d0: 663b 2064 6973 706c 6179 3a20 626c 6f63  f; display: bloc
-000134e0: 6b3b 206d 6172 6769 6e3a 2030 2e35 656d  k; margin: 0.5em
-000134f0: 3b20 7769 6474 683a 2063 616c 6328 3130  ; width: calc(10
-00013500: 3025 202d 2031 2e35 656d 293b 273e 0a20  0% - 1.5em);'>. 
-00013510: 2020 2020 2020 2020 2020 203c 2f74 6578             </tex
-00013520: 7461 7265 613e 0a20 2020 2020 2020 2020  tarea>.         
-00013530: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-00013540: 7365 6c66 2e5f 696e 7075 745f 656c 656d  self._input_elem
-00013550: 656e 7420 3d20 7365 6c66 2e6d 6169 6e64  ent = self.maind
-00013560: 6976 2e63 6869 6c64 7265 6e5b 2d31 5d0a  iv.children[-1].
-00013570: 2020 2020 2020 2020 7365 6c66 2e5f 696e          self._in
-00013580: 7075 745f 656c 656d 656e 742e 7661 6c75  put_element.valu
-00013590: 6520 3d20 2222 0a20 2020 2020 2020 2073  e = "".        s
-000135a0: 656c 662e 5f69 6e70 7574 5f65 6c65 6d65  elf._input_eleme
-000135b0: 6e74 2e6f 6e64 7261 6765 7869 7420 3d20  nt.ondragexit = 
-000135c0: 7365 6c66 2e5f 6f6e 5f64 726f 705f 7374  self._on_drop_st
-000135d0: 6f70 0a20 2020 2020 2020 2073 656c 662e  op.        self.
-000135e0: 5f69 6e70 7574 5f65 6c65 6d65 6e74 2e6f  _input_element.o
-000135f0: 6e64 7261 676f 7665 7220 3d20 7365 6c66  ndragover = self
-00013600: 2e5f 6f6e 5f64 726f 705f 6f76 6572 0a20  ._on_drop_over. 
-00013610: 2020 2020 2020 2073 656c 662e 5f69 6e70         self._inp
-00013620: 7574 5f65 6c65 6d65 6e74 2e6f 6e64 726f  ut_element.ondro
-00013630: 7020 3d20 7365 6c66 2e5f 6f6e 5f64 726f  p = self._on_dro
-00013640: 700a 2020 2020 2020 2020 7365 6c66 2e5f  p.        self._
-00013650: 696e 7075 745f 656c 656d 656e 742e 6f6e  input_element.on
-00013660: 696e 7075 7420 3d20 7365 6c66 2e5f 6f6e  input = self._on
-00013670: 5f65 6469 740a 2020 2020 2020 2020 7365  _edit.        se
-00013680: 6c66 2e5f 696e 7075 745f 656c 656d 656e  lf._input_elemen
-00013690: 742e 6f6e 6368 616e 6765 203d 2073 656c  t.onchange = sel
-000136a0: 662e 5f6f 6e5f 6564 6974 0a0a 2020 2020  f._on_edit..    
-000136b0: 2020 2020 7365 6c66 2e5f 616e 616c 7973      self._analys
-000136c0: 6973 5f6f 7574 203d 2073 656c 662e 6d61  is_out = self.ma
-000136d0: 696e 6469 762e 6368 696c 6472 656e 5b2d  indiv.children[-
-000136e0: 325d 0a0a 2020 2020 2020 2020 7365 6c66  2]..        self
-000136f0: 2e5f 6170 706c 795f 6275 7420 3d20 7365  ._apply_but = se
-00013700: 6c66 2e6d 6169 6e64 6976 2e63 6869 6c64  lf.maindiv.child
-00013710: 7265 6e5b 325d 0a20 2020 2020 2020 2073  ren[2].        s
-00013720: 656c 662e 5f61 7070 6c79 5f62 7574 2e6f  elf._apply_but.o
-00013730: 6e63 6c69 636b 203d 2073 656c 662e 646f  nclick = self.do
-00013740: 5f61 7070 6c79 0a0a 2020 2020 2020 2020  _apply..        
-00013750: 7365 6c66 2e5f 6361 6e63 656c 5f62 7574  self._cancel_but
-00013760: 203d 2073 656c 662e 6d61 696e 6469 762e   = self.maindiv.
-00013770: 6368 696c 6472 656e 5b30 5d2e 6368 696c  children[0].chil
-00013780: 6472 656e 5b2d 315d 0a20 2020 2020 2020  dren[-1].       
-00013790: 2073 656c 662e 5f63 616e 6365 6c5f 6275   self._cancel_bu
-000137a0: 742e 6f6e 636c 6963 6b20 3d20 7365 6c66  t.onclick = self
-000137b0: 2e63 6c6f 7365 0a20 2020 2020 2020 2073  .close.        s
-000137c0: 7570 6572 2829 2e6f 7065 6e28 6361 6c6c  uper().open(call
-000137d0: 6261 636b 290a 2020 2020 2020 2020 7365  back).        se
-000137e0: 6c66 2e5f 6c6f 6164 5f63 7572 7265 6e74  lf._load_current
-000137f0: 2829 0a0a 2020 2020 6465 6620 5f6f 6e5f  ()..    def _on_
-00013800: 6472 6f70 5f73 746f 7028 7365 6c66 2c20  drop_stop(self, 
-00013810: 6576 293a 0a20 2020 2020 2020 2073 656c  ev):.        sel
-00013820: 662e 5f69 6e70 7574 5f65 6c65 6d65 6e74  f._input_element
-00013830: 2e73 7479 6c65 2e62 6163 6b67 726f 756e  .style.backgroun
-00013840: 6420 3d20 4e6f 6e65 0a0a 2020 2020 6465  d = None..    de
-00013850: 6620 5f6f 6e5f 6472 6f70 5f6f 7665 7228  f _on_drop_over(
-00013860: 7365 6c66 2c20 6576 293a 0a20 2020 2020  self, ev):.     
-00013870: 2020 2065 762e 7072 6576 656e 7444 6566     ev.preventDef
-00013880: 6175 6c74 2829 0a20 2020 2020 2020 2073  ault().        s
-00013890: 656c 662e 5f69 6e70 7574 5f65 6c65 6d65  elf._input_eleme
-000138a0: 6e74 2e73 7479 6c65 2e62 6163 6b67 726f  nt.style.backgro
-000138b0: 756e 6420 3d20 2223 4446 4422 0a0a 2020  und = "#DFD"..  
-000138c0: 2020 6465 6620 5f6f 6e5f 6472 6f70 2873    def _on_drop(s
-000138d0: 656c 662c 2065 7629 3a0a 2020 2020 2020  elf, ev):.      
-000138e0: 2020 6576 2e70 7265 7665 6e74 4465 6661    ev.preventDefa
-000138f0: 756c 7428 290a 2020 2020 2020 2020 7365  ult().        se
-00013900: 6c66 2e5f 6f6e 5f64 726f 705f 7374 6f70  lf._on_drop_stop
-00013910: 2829 0a0a 2020 2020 2020 2020 6465 6620  ()..        def 
-00013920: 6170 706c 795f 7465 7874 2873 293a 0a20  apply_text(s):. 
-00013930: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00013940: 5f69 6e70 7574 5f65 6c65 6d65 6e74 2e76  _input_element.v
-00013950: 616c 7565 203d 2073 0a0a 2020 2020 2020  alue = s..      
-00013960: 2020 6966 2065 762e 6461 7461 5472 616e    if ev.dataTran
-00013970: 7366 6572 2e69 7465 6d73 3a0a 2020 2020  sfer.items:.    
-00013980: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
-00013990: 2072 616e 6765 286c 656e 2865 762e 6461   range(len(ev.da
-000139a0: 7461 5472 616e 7366 6572 2e69 7465 6d73  taTransfer.items
-000139b0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-000139c0: 2020 2020 6966 2065 762e 6461 7461 5472      if ev.dataTr
-000139d0: 616e 7366 6572 2e69 7465 6d73 5b69 5d2e  ansfer.items[i].
-000139e0: 6b69 6e64 203d 3d20 2266 696c 6522 3a0a  kind == "file":.
-000139f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013a00: 2020 2020 6669 6c65 203d 2065 762e 6461      file = ev.da
-00013a10: 7461 5472 616e 7366 6572 2e69 7465 6d73  taTransfer.items
-00013a20: 5b69 5d2e 6765 7441 7346 696c 6528 290a  [i].getAsFile().
-00013a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013a40: 2020 2020 6578 7420 3d20 6669 6c65 2e6e      ext = file.n
-00013a50: 616d 652e 6c6f 7765 7228 292e 7370 6c69  ame.lower().spli
-00013a60: 7428 222e 2229 5b2d 315d 0a20 2020 2020  t(".")[-1].     
-00013a70: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00013a80: 6620 6578 7420 696e 2028 2278 6c73 222c  f ext in ("xls",
-00013a90: 2022 786c 7378 222c 2022 786c 736d 222c   "xlsx", "xlsm",
-00013aa0: 2022 7064 6622 293a 0a20 2020 2020 2020   "pdf"):.       
-00013ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ac0: 2073 656c 662e 5f61 6e61 6c79 7369 735f   self._analysis_
-00013ad0: 6f75 742e 696e 6e65 7248 544d 4c20 3d20  out.innerHTML = 
-00013ae0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00013af0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-00013b00: 4361 6e6e 6f74 2070 726f 6365 7373 203c  Cannot process <
-00013b10: 753e 7b66 696c 652e 6e61 6d65 7d3c 2f75  u>{file.name}</u
-00013b20: 3e2e 2044 726f 7020 6120 2e63 7376 2066  >. Drop a .csv f
-00013b30: 696c 6520 6f72 2022 0a20 2020 2020 2020  ile or ".       
-00013b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b50: 2020 2020 202b 2066 2263 6f70 7920 7468       + f"copy th
-00013b60: 6520 636f 6c75 6d6e 7320 696e 2045 7863  e columns in Exc
-00013b70: 656c 2061 6e64 2070 6173 7465 2068 6572  el and paste her
-00013b80: 652e 220a 2020 2020 2020 2020 2020 2020  e.".            
-00013b90: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00013ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013bb0: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
-00013bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013bd0: 2020 2072 6561 6465 7220 3d20 7769 6e64     reader = wind
-00013be0: 6f77 2e46 696c 6552 6561 6465 7228 290a  ow.FileReader().
-00013bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c00: 2020 2020 7265 6164 6572 2e6f 6e6c 6f61      reader.onloa
-00013c10: 6420 3d20 6c61 6d62 6461 3a20 6170 706c  d = lambda: appl
-00013c20: 795f 7465 7874 2872 6561 6465 722e 7265  y_text(reader.re
-00013c30: 7375 6c74 290a 2020 2020 2020 2020 2020  sult).          
-00013c40: 2020 2020 2020 2020 2020 7265 6164 6572            reader
-00013c50: 2e72 6561 6441 7354 6578 7428 6669 6c65  .readAsText(file
-00013c60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00013c70: 2020 2020 2020 7365 6c66 2e5f 616e 616c        self._anal
-00013c80: 7973 6973 5f6f 7574 2e69 6e6e 6572 4854  ysis_out.innerHT
-00013c90: 4d4c 203d 2066 2252 6561 6420 6672 6f6d  ML = f"Read from
-00013ca0: 203c 753e 7b66 696c 652e 6e61 6d65 7d3c   <u>{file.name}<
-00013cb0: 2f75 3e22 0a20 2020 2020 2020 2020 2020  /u>".           
-00013cc0: 2020 2020 2020 2020 2062 7265 616b 2020           break  
-00013cd0: 2320 6f6e 6c79 2070 726f 6365 7373 2066  # only process f
-00013ce0: 6972 7374 206f 6e65 0a0a 2020 2020 6465  irst one..    de
-00013cf0: 6620 5f6f 6e5f 6564 6974 2873 656c 6629  f _on_edit(self)
-00013d00: 3a0a 2020 2020 2020 2020 2320 5468 6973  :.        # This
-00013d10: 206c 656e 6774 6820 6573 7469 6d61 7465   length estimate
-00013d20: 2069 7320 6f6e 6c79 2063 6f72 7265 6374   is only correct
-00013d30: 2069 6620 7468 6520 7461 6773 2061 7265   if the tags are
-00013d40: 2066 6f72 6d61 7474 6564 0a20 2020 2020   formatted.     
-00013d50: 2020 2023 2063 6f72 7265 6374 6c79 2c20     # correctly, 
-00013d60: 692e 652e 206e 6f20 7768 6974 6573 7061  i.e. no whitespa
-00013d70: 6365 206f 7220 6e6f 6e2d 7461 6720 776f  ce or non-tag wo
-00013d80: 7264 732e 2054 6865 2061 6374 7561 6c0a  rds. The actual.
-00013d90: 2020 2020 2020 2020 2320 6c65 6e67 7468          # length
-00013da0: 2063 616e 206f 6e6c 7920 7265 616c 6c79   can only really
-00013db0: 2062 6520 6f62 7461 696e 6564 2062 7920   be obtained by 
-00013dc0: 636f 6c6c 6563 7469 6e67 2061 6c6c 2074  collecting all t
-00013dd0: 6167 730a 2020 2020 2020 2020 2320 6672  ags.        # fr
-00013de0: 6f6d 2074 6865 2074 6578 7420 616e 6420  om the text and 
-00013df0: 7374 7269 6e67 6966 7969 6e67 2069 7420  stringifying it 
-00013e00: 7769 7468 206a 736f 6e2c 2062 7574 2074  with json, but t
-00013e10: 6861 7420 776f 756c 640a 2020 2020 2020  hat would.      
-00013e20: 2020 2320 6265 2074 6f6f 2073 6c6f 7720    # be too slow 
-00013e30: 746f 2064 6f20 6f6e 2065 6163 6820 6b65  to do on each ke
-00013e40: 7920 7072 6573 7320 2874 6865 7265 2063  y press (there c
-00013e50: 616e 2062 6520 4d41 4e59 206c 696e 6573  an be MANY lines
-00013e60: 292e 0a20 2020 2020 2020 2023 2057 6520  )..        # We 
-00013e70: 7461 6b65 2074 6865 206e 6f72 6d61 6c20  take the normal 
-00013e80: 6c65 6e67 7468 2c20 706c 7573 2032 2070  length, plus 2 p
-00013e90: 6572 206c 696e 6520 666f 7220 7175 6f74  er line for quot
-00013ea0: 6573 2c20 616e 6420 3420 666f 7220 6272  es, and 4 for br
-00013eb0: 6163 6573 2e0a 2020 2020 2020 2020 6c65  aces..        le
-00013ec0: 6e67 7468 5f65 7374 203d 2073 656c 662e  ngth_est = self.
-00013ed0: 5f69 6e70 7574 5f65 6c65 6d65 6e74 2e76  _input_element.v
-00013ee0: 616c 7565 2e6c 656e 6774 680a 2020 2020  alue.length.    
-00013ef0: 2020 2020 6c65 6e67 7468 5f65 7374 202b      length_est +
-00013f00: 3d20 7365 6c66 2e5f 696e 7075 745f 656c  = self._input_el
-00013f10: 656d 656e 742e 7661 6c75 652e 636f 756e  ement.value.coun
-00013f20: 7428 225c 6e22 2920 2a20 3220 2b20 340a  t("\n") * 2 + 4.
-00013f30: 2020 2020 2020 2020 6966 206c 656e 6774          if lengt
-00013f40: 685f 6573 7420 3e3d 2073 746f 7265 732e  h_est >= stores.
-00013f50: 4a53 4f4e 5f4d 4158 3a0a 2020 2020 2020  JSON_MAX:.      
-00013f60: 2020 2020 2020 7365 6c66 2e5f 696e 7075        self._inpu
-00013f70: 745f 656c 656d 656e 742e 7374 796c 652e  t_element.style.
-00013f80: 7365 7450 726f 7065 7274 7928 226f 7574  setProperty("out
-00013f90: 6c69 6e65 222c 2022 6461 7368 6564 2032  line", "dashed 2
-00013fa0: 7078 2072 6564 2229 0a20 2020 2020 2020  px red").       
-00013fb0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00013fc0: 2020 2073 656c 662e 5f69 6e70 7574 5f65     self._input_e
-00013fd0: 6c65 6d65 6e74 2e73 7479 6c65 2e73 6574  lement.style.set
-00013fe0: 5072 6f70 6572 7479 2822 6f75 746c 696e  Property("outlin
-00013ff0: 6522 2c20 2222 290a 0a20 2020 2064 6566  e", "")..    def
-00014000: 205f 6c6f 6164 5f63 7572 7265 6e74 2873   _load_current(s
-00014010: 656c 6629 3a0a 2020 2020 2020 2020 6974  elf):.        it
-00014020: 656d 203d 2077 696e 646f 772e 7374 6f72  em = window.stor
-00014030: 652e 7365 7474 696e 6773 2e67 6574 5f62  e.settings.get_b
-00014040: 795f 6b65 7928 2274 6167 5f70 7265 7365  y_key("tag_prese
-00014050: 7473 2229 0a20 2020 2020 2020 206c 696e  ts").        lin
-00014060: 6573 203d 2028 4e6f 6e65 2069 6620 6974  es = (None if it
-00014070: 656d 2069 7320 4e6f 6e65 2065 6c73 6520  em is None else 
-00014080: 6974 656d 2e76 616c 7565 2920 6f72 205b  item.value) or [
-00014090: 5d0a 2020 2020 2020 2020 7465 7874 203d  ].        text =
-000140a0: 2022 5c6e 222e 6a6f 696e 286c 696e 6573   "\n".join(lines
-000140b0: 290a 2020 2020 2020 2020 6966 2074 6578  ).        if tex
-000140c0: 743a 0a20 2020 2020 2020 2020 2020 2074  t:.            t
-000140d0: 6578 7420 2b3d 2022 5c6e 220a 2020 2020  ext += "\n".    
-000140e0: 2020 2020 7365 6c66 2e5f 696e 7075 745f      self._input_
-000140f0: 656c 656d 656e 742e 7661 6c75 6520 3d20  element.value = 
-00014100: 7465 7874 0a0a 2020 2020 6465 6620 646f  text..    def do
-00014110: 5f61 7070 6c79 2873 656c 6629 3a0a 2020  _apply(self):.  
-00014120: 2020 2020 2020 2222 224e 6f72 6d61 6c69        """Normali
-00014130: 7a65 2074 6167 7322 2222 0a20 2020 2020  ze tags""".     
-00014140: 2020 2023 2050 726f 6365 7373 0a20 2020     # Process.   
-00014150: 2020 2020 2073 656c 662e 5f61 6e61 6c79       self._analy
-00014160: 7369 735f 6f75 742e 696e 6e65 7248 544d  sis_out.innerHTM
-00014170: 4c20 3d20 2250 726f 6365 7373 696e 6720  L = "Processing 
-00014180: 2e2e 2e22 0a20 2020 2020 2020 206c 696e  ...".        lin
-00014190: 6573 3120 3d20 7365 6c66 2e5f 696e 7075  es1 = self._inpu
-000141a0: 745f 656c 656d 656e 742e 7661 6c75 652e  t_element.value.
-000141b0: 6c73 7472 6970 2829 2e73 706c 6974 6c69  lstrip().splitli
-000141c0: 6e65 7328 290a 2020 2020 2020 2020 6c69  nes().        li
-000141d0: 6e65 7332 203d 205b 5d0a 2020 2020 2020  nes2 = [].      
-000141e0: 2020 666f 756e 645f 7461 6773 203d 207b    found_tags = {
-000141f0: 7d0a 2020 2020 2020 2020 666f 7220 6c69  }.        for li
-00014200: 6e65 2069 6e20 6c69 6e65 7331 3a0a 2020  ne in lines1:.  
-00014210: 2020 2020 2020 2020 2020 6c69 6e65 203d            line =
-00014220: 206c 696e 652e 7374 7269 7028 290a 2020   line.strip().  
-00014230: 2020 2020 2020 2020 2020 6966 206c 696e            if lin
-00014240: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00014250: 2020 2074 6167 732c 205f 203d 2075 7469     tags, _ = uti
-00014260: 6c73 2e67 6574 5f74 6167 735f 616e 645f  ls.get_tags_and_
-00014270: 7061 7274 735f 6672 6f6d 5f73 7472 696e  parts_from_strin
-00014280: 6728 746f 5f73 7472 286c 696e 6529 2c20  g(to_str(line), 
-00014290: 4661 6c73 6529 0a20 2020 2020 2020 2020  False).         
-000142a0: 2020 2020 2020 2066 6f72 2074 6167 2069         for tag i
-000142b0: 6e20 7461 6773 3a0a 2020 2020 2020 2020  n tags:.        
-000142c0: 2020 2020 2020 2020 2020 2020 666f 756e              foun
-000142d0: 645f 7461 6773 5b74 6167 5d20 3d20 7461  d_tags[tag] = ta
-000142e0: 670a 2020 2020 2020 2020 2020 2020 2020  g.              
-000142f0: 2020 6c69 6e65 203d 2074 6167 732e 6a6f    line = tags.jo
-00014300: 696e 2822 2022 290a 2020 2020 2020 2020  in(" ").        
-00014310: 2020 2020 6c69 6e65 7332 2e61 7070 656e      lines2.appen
-00014320: 6428 6c69 6e65 290a 0a20 2020 2020 2020  d(line)..       
-00014330: 2023 2043 6865 636b 2073 697a 650a 2020   # Check size.  
-00014340: 2020 2020 2020 6c65 6e67 7468 203d 204a        length = J
-00014350: 534f 4e2e 7374 7269 6e67 6966 7928 6c69  SON.stringify(li
-00014360: 6e65 7332 292e 6c65 6e67 7468 0a20 2020  nes2).length.   
-00014370: 2020 2020 2069 6620 6c65 6e67 7468 203e       if length >
-00014380: 3d20 7374 6f72 6573 2e4a 534f 4e5f 4d41  = stores.JSON_MA
-00014390: 583a 0a20 2020 2020 2020 2020 2020 2073  X:.            s
-000143a0: 656c 662e 5f69 6e70 7574 5f65 6c65 6d65  elf._input_eleme
-000143b0: 6e74 2e73 7479 6c65 2e73 6574 5072 6f70  nt.style.setProp
-000143c0: 6572 7479 2822 6f75 746c 696e 6522 2c20  erty("outline", 
-000143d0: 2264 6173 6865 6420 3270 7820 7265 6422  "dashed 2px red"
-000143e0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-000143f0: 6c66 2e5f 616e 616c 7973 6973 5f6f 7574  lf._analysis_out
-00014400: 2e69 6e6e 6572 4854 4d4c 203d 2028 0a20  .innerHTML = (. 
-00014410: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00014420: 2253 6f72 7279 2c20 7573 6564 207b 6c65  "Sorry, used {le
-00014430: 6e67 7468 7d20 6f66 206d 6178 207b 7374  ngth} of max {st
-00014440: 6f72 6573 2e4a 534f 4e5f 4d41 582d 317d  ores.JSON_MAX-1}
-00014450: 2063 6861 7273 2e22 0a20 2020 2020 2020   chars.".       
-00014460: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00014470: 2020 2072 6574 7572 6e0a 0a20 2020 2020     return..     
-00014480: 2020 2023 2053 6176 650a 2020 2020 2020     # Save.      
-00014490: 2020 6974 656d 203d 2077 696e 646f 772e    item = window.
-000144a0: 7374 6f72 652e 7365 7474 696e 6773 2e63  store.settings.c
-000144b0: 7265 6174 6528 2274 6167 5f70 7265 7365  reate("tag_prese
-000144c0: 7473 222c 206c 696e 6573 3229 0a20 2020  ts", lines2).   
-000144d0: 2020 2020 2077 696e 646f 772e 7374 6f72       window.stor
-000144e0: 652e 7365 7474 696e 6773 2e70 7574 2869  e.settings.put(i
-000144f0: 7465 6d29 0a0a 2020 2020 2020 2020 2320  tem)..        # 
-00014500: 5265 706f 7274 0a20 2020 2020 2020 2073  Report.        s
-00014510: 656c 662e 5f6c 6f61 645f 6375 7272 656e  elf._load_curren
-00014520: 7428 290a 2020 2020 2020 2020 6e74 6167  t().        ntag
-00014530: 7320 3d20 6c65 6e28 666f 756e 645f 7461  s = len(found_ta
-00014540: 6773 2e6b 6579 7328 2929 0a20 2020 2020  gs.keys()).     
-00014550: 2020 2073 656c 662e 5f61 6e61 6c79 7369     self._analysi
-00014560: 735f 6f75 742e 696e 6e65 7248 544d 4c20  s_out.innerHTML 
-00014570: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-00014580: 223c 6920 636c 6173 733d 2766 6173 273e  "<i class='fas'>
-00014590: 5c75 6630 3063 3c2f 693e 2053 6176 6564  \uf00c</i> Saved
-000145a0: 2022 0a20 2020 2020 2020 2020 2020 202b   ".            +
-000145b0: 206c 656e 286c 696e 6573 3229 0a20 2020   len(lines2).   
-000145c0: 2020 2020 2020 2020 202b 2022 2070 7265           + " pre
-000145d0: 7365 7473 2c20 7769 7468 2022 0a20 2020  sets, with ".   
-000145e0: 2020 2020 2020 2020 202b 206e 7461 6773           + ntags
-000145f0: 0a20 2020 2020 2020 2020 2020 202b 2022  .            + "
-00014600: 2075 6e69 7175 6520 7461 6773 2e22 0a20   unique tags.". 
-00014610: 2020 2020 2020 2029 0a0a 0a63 6c61 7373         )...class
-00014620: 2054 6167 5265 6e61 6d65 4469 616c 6f67   TagRenameDialog
-00014630: 2842 6173 6544 6961 6c6f 6729 3a0a 2020  (BaseDialog):.  
-00014640: 2020 2222 2244 6961 6c6f 6720 746f 2072    """Dialog to r
-00014650: 656e 616d 6520 7461 6773 2e22 2222 0a0a  ename tags."""..
-00014660: 2020 2020 6465 6620 6f70 656e 2873 656c      def open(sel
-00014670: 662c 2074 6167 732c 2063 616c 6c62 6163  f, tags, callbac
-00014680: 6b3d 4e6f 6e65 293a 0a20 2020 2020 2020  k=None):.       
-00014690: 2023 2050 7574 2069 6e20 6465 7465 726d   # Put in determ
-000146a0: 696e 6973 7469 6320 6f72 6465 720a 2020  inistic order.  
-000146b0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-000146c0: 6e63 6528 7461 6773 2c20 7374 7229 3a0a  nce(tags, str):.
-000146d0: 2020 2020 2020 2020 2020 2020 7461 6773              tags
-000146e0: 203d 2074 6167 732e 7370 6c69 7428 2220   = tags.split(" 
-000146f0: 2229 0a20 2020 2020 2020 2074 6167 732e  ").        tags.
-00014700: 736f 7274 2829 0a20 2020 2020 2020 2073  sort().        s
-00014710: 656c 662e 5f74 6167 7a20 3d20 7461 677a  elf._tagz = tagz
-00014720: 203d 2074 6167 732e 6a6f 696e 2822 2022   = tags.join(" "
-00014730: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00014740: 5f74 6167 7331 203d 2074 6167 730a 2020  _tags1 = tags.  
-00014750: 2020 2020 2020 7365 6c66 2e5f 7461 6773        self._tags
-00014760: 3220 3d20 5b5d 0a0a 2020 2020 2020 2020  2 = []..        
-00014770: 6966 206c 656e 2874 6167 7329 203d 3d20  if len(tags) == 
-00014780: 313a 0a20 2020 2020 2020 2020 2020 2074  1:.            t
-00014790: 6974 6c65 203d 2022 4375 7272 656e 7420  itle = "Current 
-000147a0: 7461 6720 6e61 6d65 220a 2020 2020 2020  tag name".      
-000147b0: 2020 2020 2020 7461 6777 6f72 6420 3d20        tagword = 
-000147c0: 2274 6167 220a 2020 2020 2020 2020 656c  "tag".        el
-000147d0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000147e0: 7469 746c 6520 3d20 2254 6167 2063 6f6d  title = "Tag com
-000147f0: 6269 2074 6f20 7265 6e61 6d65 220a 2020  bi to rename".  
-00014800: 2020 2020 2020 2020 2020 7461 6777 6f72            tagwor
-00014810: 6420 3d20 2274 6167 7322 0a0a 2020 2020  d = "tags"..    
-00014820: 2020 2020 7365 6c66 2e6d 6169 6e64 6976      self.maindiv
-00014830: 2e69 6e6e 6572 4854 4d4c 203d 2066 2222  .innerHTML = f""
-00014840: 220a 2020 2020 2020 2020 2020 2020 3c68  ".            <h
-00014850: 313e 3c69 2063 6c61 7373 3d27 6661 7327  1><i class='fas'
-00014860: 3e5c 7566 3032 623c 2f69 3e26 6e62 7370  >\uf02b</i>&nbsp
-00014870: 3b26 6e62 7370 3b52 656e 616d 6520 7b74  ;&nbsp;Rename {t
-00014880: 6167 776f 7264 7d0a 2020 2020 2020 2020  agword}.        
-00014890: 2020 2020 2020 2020 3c62 7574 746f 6e20          <button 
-000148a0: 7479 7065 3d27 6275 7474 6f6e 273e 3c69  type='button'><i
-000148b0: 2063 6c61 7373 3d27 6661 7327 3e5c 7566   class='fas'>\uf
-000148c0: 3030 643c 2f69 3e3c 2f62 7574 746f 6e3e  00d</i></button>
-000148d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000148e0: 203c 2f68 313e 0a20 2020 2020 2020 2020   </h1>.         
-000148f0: 2020 203c 6469 7620 636c 6173 733d 2766     <div class='f
-00014900: 6f72 6d6c 6179 6f75 7427 3e0a 2020 2020  ormlayout'>.    
-00014910: 2020 2020 2020 2020 2020 2020 3c64 6976              <div
-00014920: 3e7b 7469 746c 657d 3a3c 2f64 6976 3e0a  >{title}:</div>.
-00014930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014940: 3c64 6976 3e7b 7461 677a 7d3c 2f64 6976  <div>{tagz}</div
-00014950: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
-00014960: 2020 3c64 6976 3e4e 6577 2074 6167 2873    <div>New tag(s
-00014970: 293a 3c2f 6469 763e 0a20 2020 2020 2020  ):</div>.       
-00014980: 2020 2020 2020 2020 203c 696e 7075 7420           <input 
-00014990: 7479 7065 3d27 7465 7874 2720 7370 656c  type='text' spel
-000149a0: 6c63 6865 636b 3d27 6661 6c73 6527 202f  lcheck='false' /
-000149b0: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
-000149c0: 2020 3c64 6976 3e3c 2f64 6976 3e0a 2020    <div></div>.  
-000149d0: 2020 2020 2020 2020 2020 2020 2020 3c62                <b
-000149e0: 7574 746f 6e20 7479 7065 3d27 6275 7474  utton type='butt
-000149f0: 6f6e 273e 5072 6570 6172 6520 7265 6e61  on'>Prepare rena
-00014a00: 6d69 6e67 202e 2e2e 3c2f 6275 7474 6f6e  ming ...</button
-00014a10: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
-00014a20: 2020 3c64 6976 3e3c 2f64 6976 3e0a 2020    <div></div>.  
-00014a30: 2020 2020 2020 2020 2020 2020 2020 3c62                <b
-00014a40: 7574 746f 6e20 7479 7065 3d27 6275 7474  utton type='butt
-00014a50: 6f6e 273e 436f 6e66 6972 6d3c 2f62 7574  on'>Confirm</but
-00014a60: 746f 6e3e 0a20 2020 2020 2020 2020 2020  ton>.           
-00014a70: 203c 2f64 6976 3e0a 2020 2020 2020 2020   </div>.        
-00014a80: 2020 2020 3c64 6976 2073 7479 6c65 3d27      <div style='
-00014a90: 6d61 7267 696e 2d74 6f70 3a32 656d 3b27  margin-top:2em;'
-00014aa0: 3e3c 2f64 6976 3e0a 2020 2020 2020 2020  ></div>.        
-00014ab0: 2222 220a 0a20 2020 2020 2020 2063 6c6f  """..        clo
-00014ac0: 7365 5f62 7574 203d 2073 656c 662e 6d61  se_but = self.ma
-00014ad0: 696e 6469 762e 6368 696c 6472 656e 5b30  indiv.children[0
-00014ae0: 5d2e 6368 696c 6472 656e 5b2d 315d 0a20  ].children[-1]. 
-00014af0: 2020 2020 2020 2063 6c6f 7365 5f62 7574         close_but
-00014b00: 2e6f 6e63 6c69 636b 203d 2073 656c 662e  .onclick = self.
-00014b10: 636c 6f73 650a 0a20 2020 2020 2020 2066  close..        f
-00014b20: 6f72 6d64 6976 203d 2073 656c 662e 6d61  ormdiv = self.ma
-00014b30: 696e 6469 762e 6368 696c 6472 656e 5b31  indiv.children[1
-00014b40: 5d0a 2020 2020 2020 2020 7365 6c66 2e5f  ].        self._
-00014b50: 7461 676e 616d 6532 203d 2066 6f72 6d64  tagname2 = formd
-00014b60: 6976 2e63 6869 6c64 7265 6e5b 335d 0a20  iv.children[3]. 
-00014b70: 2020 2020 2020 2073 656c 662e 5f62 7574         self._but
-00014b80: 746f 6e5f 7265 706c 6163 6520 3d20 666f  ton_replace = fo
-00014b90: 726d 6469 762e 6368 696c 6472 656e 5b35  rmdiv.children[5
-00014ba0: 5d0a 2020 2020 2020 2020 7365 6c66 2e5f  ].        self._
-00014bb0: 6275 7474 6f6e 5f72 6570 6c61 6365 5f63  button_replace_c
-00014bc0: 6f6d 6669 726d 203d 2066 6f72 6d64 6976  omfirm = formdiv
-00014bd0: 2e63 6869 6c64 7265 6e5b 375d 0a0a 2020  .children[7]..  
-00014be0: 2020 2020 2020 7365 6c66 2e5f 7461 676e        self._tagn
-00014bf0: 616d 6532 2e6f 6e69 6e70 7574 203d 2073  ame2.oninput = s
-00014c00: 656c 662e 5f68 6964 655f 636f 6e66 6972  elf._hide_confir
-00014c10: 6d5f 6275 7474 6f6e 0a20 2020 2020 2020  m_button.       
-00014c20: 2073 656c 662e 5f74 6167 6e61 6d65 322e   self._tagname2.
-00014c30: 6f6e 6368 616e 6765 203d 2073 656c 662e  onchange = self.
-00014c40: 5f6f 6e5f 6e61 6d65 325f 646f 6e65 0a20  _on_name2_done. 
-00014c50: 2020 2020 2020 2073 656c 662e 5f74 6167         self._tag
-00014c60: 6e61 6d65 322e 6f6e 6b65 7964 6f77 6e20  name2.onkeydown 
-00014c70: 3d20 7365 6c66 2e5f 6f6e 5f6b 6579 320a  = self._on_key2.
-00014c80: 0a20 2020 2020 2020 2073 656c 662e 5f62  .        self._b
-00014c90: 7574 746f 6e5f 7265 706c 6163 652e 6f6e  utton_replace.on
-00014ca0: 636c 6963 6b20 3d20 7365 6c66 2e5f 7265  click = self._re
-00014cb0: 706c 6163 655f 616c 6c0a 2020 2020 2020  place_all.      
-00014cc0: 2020 7365 6c66 2e5f 6275 7474 6f6e 5f72    self._button_r
-00014cd0: 6570 6c61 6365 5f63 6f6d 6669 726d 2e6f  eplace_comfirm.o
-00014ce0: 6e63 6c69 636b 203d 2073 656c 662e 5f72  nclick = self._r
-00014cf0: 6561 6c6c 795f 7265 706c 6163 655f 616c  eally_replace_al
-00014d00: 6c0a 0a20 2020 2020 2020 2073 656c 662e  l..        self.
-00014d10: 5f62 7574 746f 6e5f 7265 706c 6163 655f  _button_replace_
-00014d20: 636f 6d66 6972 6d2e 6469 7361 626c 6564  comfirm.disabled
-00014d30: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-00014d40: 7365 6c66 2e5f 6275 7474 6f6e 5f72 6570  self._button_rep
-00014d50: 6c61 6365 5f63 6f6d 6669 726d 2e73 7479  lace_comfirm.sty
-00014d60: 6c65 2e76 6973 6962 696c 6974 7920 3d20  le.visibility = 
-00014d70: 2268 6964 6465 6e22 0a0a 2020 2020 2020  "hidden"..      
-00014d80: 2020 7365 6c66 2e5f 7265 636f 7264 7320    self._records 
-00014d90: 3d20 5b5d 0a0a 2020 2020 2020 2020 7375  = []..        su
-00014da0: 7065 7228 292e 6f70 656e 2863 616c 6c62  per().open(callb
-00014db0: 6163 6b29 0a20 2020 2020 2020 2069 6620  ack).        if 
-00014dc0: 7574 696c 732e 6c6f 6f6b 735f 6c69 6b65  utils.looks_like
-00014dd0: 5f64 6573 6b74 6f70 2829 3a0a 2020 2020  _desktop():.    
-00014de0: 2020 2020 2020 2020 7365 6c66 2e5f 7461          self._ta
-00014df0: 676e 616d 6532 2e66 6f63 7573 2829 0a0a  gname2.focus()..
-00014e00: 2020 2020 6465 6620 636c 6f73 6528 7365      def close(se
-00014e10: 6c66 293a 0a20 2020 2020 2020 2073 656c  lf):.        sel
-00014e20: 662e 5f72 6563 6f72 6473 203d 205b 5d0a  f._records = [].
-00014e30: 2020 2020 2020 2020 7375 7065 7228 292e          super().
-00014e40: 636c 6f73 6528 290a 0a20 2020 2064 6566  close()..    def
-00014e50: 205f 6869 6465 5f63 6f6e 6669 726d 5f62   _hide_confirm_b
-00014e60: 7574 746f 6e28 7365 6c66 293a 0a20 2020  utton(self):.   
-00014e70: 2020 2020 2073 656c 662e 5f62 7574 746f       self._butto
-00014e80: 6e5f 7265 706c 6163 655f 636f 6d66 6972  n_replace_comfir
-00014e90: 6d2e 6469 7361 626c 6564 203d 2054 7275  m.disabled = Tru
-00014ea0: 650a 2020 2020 2020 2020 7365 6c66 2e5f  e.        self._
-00014eb0: 6275 7474 6f6e 5f72 6570 6c61 6365 5f63  button_replace_c
-00014ec0: 6f6d 6669 726d 2e73 7479 6c65 2e76 6973  omfirm.style.vis
-00014ed0: 6962 696c 6974 7920 3d20 2268 6964 6465  ibility = "hidde
-00014ee0: 6e22 0a20 2020 2020 2020 2073 656c 662e  n".        self.
-00014ef0: 5f62 7574 746f 6e5f 7265 706c 6163 655f  _button_replace_
-00014f00: 636f 6d66 6972 6d2e 696e 6e65 7254 6578  comfirm.innerTex
-00014f10: 7420 3d20 2243 6f6e 6669 726d 220a 0a20  t = "Confirm".. 
-00014f20: 2020 2064 6566 205f 6f6e 5f6e 616d 6532     def _on_name2
-00014f30: 5f64 6f6e 6528 7365 6c66 293a 0a20 2020  _done(self):.   
-00014f40: 2020 2020 2072 6177 5f70 6172 7473 203d       raw_parts =
-00014f50: 2073 656c 662e 5f74 6167 6e61 6d65 322e   self._tagname2.
-00014f60: 7661 6c75 652e 7370 6c69 7428 2220 2229  value.split(" ")
-00014f70: 0a20 2020 2020 2020 2074 6578 7432 203d  .        text2 =
-00014f80: 205b 2223 2220 2b20 7020 666f 7220 7020   ["#" + p for p 
-00014f90: 696e 2072 6177 5f70 6172 7473 5d2e 6a6f  in raw_parts].jo
-00014fa0: 696e 2822 2022 290a 2020 2020 2020 2020  in(" ").        
-00014fb0: 7461 6773 322c 205f 203d 2075 7469 6c73  tags2, _ = utils
-00014fc0: 2e67 6574 5f74 6167 735f 616e 645f 7061  .get_tags_and_pa
-00014fd0: 7274 735f 6672 6f6d 5f73 7472 696e 6728  rts_from_string(
-00014fe0: 7465 7874 3229 0a20 2020 2020 2020 2073  text2).        s
-00014ff0: 656c 662e 5f74 6167 7332 203d 2074 6167  elf._tags2 = tag
-00015000: 7332 0a20 2020 2020 2020 2073 656c 662e  s2.        self.
-00015010: 5f74 6167 6e61 6d65 322e 7661 6c75 6520  _tagname2.value 
-00015020: 3d20 2220 222e 6a6f 696e 2874 6167 7332  = " ".join(tags2
-00015030: 290a 0a20 2020 2064 6566 205f 6f6e 5f6b  )..    def _on_k
-00015040: 6579 3228 7365 6c66 2c20 6529 3a0a 2020  ey2(self, e):.  
-00015050: 2020 2020 2020 6b65 7920 3d20 652e 6b65        key = e.ke
-00015060: 792e 6c6f 7765 7228 290a 2020 2020 2020  y.lower().      
-00015070: 2020 6966 206b 6579 203d 3d20 2265 6e74    if key == "ent
-00015080: 6572 2220 6f72 206b 6579 203d 3d20 2272  er" or key == "r
-00015090: 6574 7572 6e22 3a0a 2020 2020 2020 2020  eturn":.        
-000150a0: 2020 2020 652e 7374 6f70 5072 6f70 6167      e.stopPropag
-000150b0: 6174 696f 6e28 290a 2020 2020 2020 2020  ation().        
-000150c0: 2020 2020 652e 7072 6576 656e 7444 6566      e.preventDef
-000150d0: 6175 6c74 2829 0a20 2020 2020 2020 2020  ault().         
-000150e0: 2020 2073 656c 662e 5f6f 6e5f 6e61 6d65     self._on_name
-000150f0: 325f 646f 6e65 2829 0a20 2020 2020 2020  2_done().       
-00015100: 2020 2020 2073 656c 662e 5f72 6570 6c61       self._repla
-00015110: 6365 5f61 6c6c 2829 0a0a 2020 2020 6465  ce_all()..    de
-00015120: 6620 5f66 696e 645f 7265 636f 7264 7328  f _find_records(
-00015130: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
-00015140: 6563 6f72 6473 203d 205b 5d0a 0a20 2020  ecords = []..   
-00015150: 2020 2020 2023 2045 6172 6c79 2065 7869       # Early exi
-00015160: 743f 0a20 2020 2020 2020 2069 6620 6e6f  t?.        if no
-00015170: 7420 7365 6c66 2e5f 7461 6773 313a 0a20  t self._tags1:. 
-00015180: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00015190: 5f72 6563 6f72 6473 203d 205b 5d0a 2020  _records = [].  
-000151a0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000151b0: 0a20 2020 2020 2020 2023 2047 6574 206c  .        # Get l
-000151c0: 6973 7420 6f66 2072 6563 6f72 6473 0a20  ist of records. 
-000151d0: 2020 2020 2020 2066 6f72 2072 6563 6f72         for recor
-000151e0: 6420 696e 2077 696e 646f 772e 7374 6f72  d in window.stor
-000151f0: 652e 7265 636f 7264 732e 6765 745f 6475  e.records.get_du
-00015200: 6d70 2829 3a0a 2020 2020 2020 2020 2020  mp():.          
-00015210: 2020 7461 6773 203d 2077 696e 646f 772e    tags = window.
-00015220: 7374 6f72 652e 7265 636f 7264 732e 7461  store.records.ta
-00015230: 6773 5f66 726f 6d5f 7265 636f 7264 2872  gs_from_record(r
-00015240: 6563 6f72 6429 2020 2320 616c 736f 2023  ecord)  # also #
-00015250: 756e 7461 6767 6564 0a20 2020 2020 2020  untagged.       
-00015260: 2020 2020 2061 6c6c 5f6f 6b20 3d20 5472       all_ok = Tr
-00015270: 7565 0a20 2020 2020 2020 2020 2020 2066  ue.            f
-00015280: 6f72 2074 6167 2069 6e20 7365 6c66 2e5f  or tag in self._
-00015290: 7461 6773 313a 0a20 2020 2020 2020 2020  tags1:.         
-000152a0: 2020 2020 2020 2069 6620 7461 6720 6e6f         if tag no
-000152b0: 7420 696e 2074 6167 733a 0a20 2020 2020  t in tags:.     
-000152c0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-000152d0: 6c6c 5f6f 6b20 3d20 4661 6c73 650a 2020  ll_ok = False.  
-000152e0: 2020 2020 2020 2020 2020 6966 2061 6c6c            if all
-000152f0: 5f6f 6b3a 0a20 2020 2020 2020 2020 2020  _ok:.           
-00015300: 2020 2020 2072 6563 6f72 6473 2e70 7573       records.pus
-00015310: 6828 5b72 6563 6f72 642e 7431 2c20 7265  h([record.t1, re
-00015320: 636f 7264 2e6b 6579 5d29 0a0a 2020 2020  cord.key])..    
-00015330: 2020 2020 7265 636f 7264 732e 736f 7274      records.sort
-00015340: 286b 6579 3d6c 616d 6264 6120 783a 2078  (key=lambda x: x
-00015350: 5b30 5d29 0a20 2020 2020 2020 2073 656c  [0]).        sel
-00015360: 662e 5f72 6563 6f72 6473 203d 205b 785b  f._records = [x[
-00015370: 315d 2066 6f72 2078 2069 6e20 7265 636f  1] for x in reco
-00015380: 7264 735d 0a0a 2020 2020 6465 6620 5f72  rds]..    def _r
-00015390: 6570 6c61 6365 5f61 6c6c 2873 656c 6629  eplace_all(self)
-000153a0: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
-000153b0: 6669 6e64 5f72 6563 6f72 6473 2829 0a20  find_records(). 
-000153c0: 2020 2020 2020 2074 6167 776f 7264 203d         tagword =
-000153d0: 2022 7461 6722 2069 6620 6c65 6e28 7365   "tag" if len(se
-000153e0: 6c66 2e5f 7461 6773 3129 203d 3d20 3120  lf._tags1) == 1 
-000153f0: 656c 7365 2022 7461 6773 220a 0a20 2020  else "tags"..   
-00015400: 2020 2020 206e 203d 206c 656e 2873 656c       n = len(sel
-00015410: 662e 5f72 6563 6f72 6473 290a 2020 2020  f._records).    
-00015420: 2020 2020 6966 206e 203d 3d20 303a 0a20      if n == 0:. 
-00015430: 2020 2020 2020 2020 2020 2074 6578 7420             text 
-00015440: 3d20 6622 4e6f 2072 6563 6f72 6473 2066  = f"No records f
-00015450: 6f75 6e64 220a 2020 2020 2020 2020 2020  ound".          
-00015460: 2020 6469 7361 626c 6564 203d 2054 7275    disabled = Tru
-00015470: 650a 2020 2020 2020 2020 656c 6966 206c  e.        elif l
-00015480: 656e 2873 656c 662e 5f74 6167 7332 293a  en(self._tags2):
-00015490: 0a20 2020 2020 2020 2020 2020 2074 6578  .            tex
-000154a0: 7420 3d20 6622 436f 6e66 6972 6d20 7265  t = f"Confirm re
-000154b0: 706c 6163 696e 6720 7b74 6167 776f 7264  placing {tagword
-000154c0: 7d20 696e 207b 6e7d 2072 6563 6f72 6473  } in {n} records
-000154d0: 220a 2020 2020 2020 2020 2020 2020 6469  ".            di
-000154e0: 7361 626c 6564 203d 2046 616c 7365 0a20  sabled = False. 
-000154f0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00015500: 2020 2020 2020 2020 2074 6578 7420 3d20           text = 
-00015510: 6622 436f 6e66 6972 6d20 7265 6d6f 7669  f"Confirm removi
-00015520: 6e67 207b 7461 6777 6f72 647d 2069 6e20  ng {tagword} in 
-00015530: 7b6e 7d20 7265 636f 7264 7322 0a20 2020  {n} records".   
-00015540: 2020 2020 2020 2020 2064 6973 6162 6c65           disable
-00015550: 6420 3d20 4661 6c73 650a 0a20 2020 2020  d = False..     
-00015560: 2020 2073 656c 662e 5f62 7574 746f 6e5f     self._button_
-00015570: 7265 706c 6163 655f 636f 6d66 6972 6d2e  replace_comfirm.
-00015580: 696e 6e65 7254 6578 7420 3d20 7465 7874  innerText = text
-00015590: 0a20 2020 2020 2020 2073 656c 662e 5f62  .        self._b
-000155a0: 7574 746f 6e5f 7265 706c 6163 655f 636f  utton_replace_co
-000155b0: 6d66 6972 6d2e 6469 7361 626c 6564 203d  mfirm.disabled =
-000155c0: 2064 6973 6162 6c65 640a 2020 2020 2020   disabled.      
-000155d0: 2020 7365 6c66 2e5f 6275 7474 6f6e 5f72    self._button_r
-000155e0: 6570 6c61 6365 5f63 6f6d 6669 726d 2e73  eplace_comfirm.s
-000155f0: 7479 6c65 2e76 6973 6962 696c 6974 7920  tyle.visibility 
-00015600: 3d20 2276 6973 6962 6c65 220a 0a20 2020  = "visible"..   
-00015610: 2064 6566 205f 7265 616c 6c79 5f72 6570   def _really_rep
-00015620: 6c61 6365 5f61 6c6c 2873 656c 6629 3a0a  lace_all(self):.
-00015630: 2020 2020 2020 2020 7365 6172 6368 5f74          search_t
-00015640: 6167 7320 3d20 7365 6c66 2e5f 7461 6773  ags = self._tags
-00015650: 310a 2020 2020 2020 2020 7265 706c 6163  1.        replac
-00015660: 656d 656e 745f 7461 6773 203d 2073 656c  ement_tags = sel
-00015670: 662e 5f74 6167 7332 0a0a 2020 2020 2020  f._tags2..      
-00015680: 2020 666f 7220 6b65 7920 696e 2073 656c    for key in sel
-00015690: 662e 5f72 6563 6f72 6473 3a0a 2020 2020  f._records:.    
-000156a0: 2020 2020 2020 2020 7265 636f 7264 203d          record =
-000156b0: 2077 696e 646f 772e 7374 6f72 652e 7265   window.store.re
-000156c0: 636f 7264 732e 6765 745f 6279 5f6b 6579  cords.get_by_key
-000156d0: 286b 6579 290a 2020 2020 2020 2020 2020  (key).          
-000156e0: 2020 5f2c 2070 6172 7473 203d 2075 7469    _, parts = uti
-000156f0: 6c73 2e67 6574 5f74 6167 735f 616e 645f  ls.get_tags_and_
-00015700: 7061 7274 735f 6672 6f6d 5f73 7472 696e  parts_from_strin
-00015710: 6728 7265 636f 7264 2e64 7329 0a20 2020  g(record.ds).   
-00015720: 2020 2020 2020 2020 2023 2047 6574 2075           # Get u
-00015730: 7064 6174 6564 2070 6172 7473 0a20 2020  pdated parts.   
-00015740: 2020 2020 2020 2020 206e 6577 5f70 6172           new_par
-00015750: 7473 203d 205b 5d0a 2020 2020 2020 2020  ts = [].        
-00015760: 2020 2020 7265 706c 6163 656d 656e 745f      replacement_
-00015770: 6d61 6465 203d 2046 616c 7365 0a20 2020  made = False.   
-00015780: 2020 2020 2020 2020 2066 6f72 2070 6172           for par
-00015790: 7420 696e 2070 6172 7473 3a0a 2020 2020  t in parts:.    
-000157a0: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-000157b0: 6172 742e 7374 6172 7473 7769 7468 2822  art.startswith("
-000157c0: 2322 2920 616e 6420 280a 2020 2020 2020  #") and (.      
-000157d0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-000157e0: 7274 2069 6e20 7365 6172 6368 5f74 6167  rt in search_tag
-000157f0: 7320 6f72 2070 6172 7420 696e 2072 6570  s or part in rep
-00015800: 6c61 6365 6d65 6e74 5f74 6167 730a 2020  lacement_tags.  
-00015810: 2020 2020 2020 2020 2020 2020 2020 293a                ):
-00015820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015830: 2020 2020 2069 6620 6e6f 7420 7265 706c       if not repl
-00015840: 6163 656d 656e 745f 6d61 6465 3a0a 2020  acement_made:.  
-00015850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015860: 2020 2020 2020 7265 706c 6163 656d 656e        replacemen
-00015870: 745f 6d61 6465 203d 2054 7275 650a 2020  t_made = True.  
-00015880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015890: 2020 2020 2020 6e65 775f 7061 7274 732e        new_parts.
-000158a0: 7075 7368 2822 2022 2e6a 6f69 6e28 7265  push(" ".join(re
-000158b0: 706c 6163 656d 656e 745f 7461 6773 2929  placement_tags))
-000158c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000158d0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000158e0: 2020 2020 2020 2020 2020 206e 6577 5f70             new_p
-000158f0: 6172 7473 2e70 7573 6828 7061 7274 290a  arts.push(part).
-00015900: 2020 2020 2020 2020 2020 2020 2320 5375              # Su
-00015910: 626d 6974 0a20 2020 2020 2020 2020 2020  bmit.           
-00015920: 2072 6563 6f72 642e 6473 203d 2022 222e   record.ds = "".
-00015930: 6a6f 696e 286e 6577 5f70 6172 7473 290a  join(new_parts).
-00015940: 2020 2020 2020 2020 2020 2020 7769 6e64              wind
-00015950: 6f77 2e73 746f 7265 2e72 6563 6f72 6473  ow.store.records
-00015960: 2e70 7574 2872 6563 6f72 6429 0a0a 2020  .put(record)..  
-00015970: 2020 2020 2020 2320 416c 736f 2075 7064        # Also upd
-00015980: 6174 6520 7461 6720 696e 666f 0a20 2020  ate tag info.   
-00015990: 2020 2020 2069 6620 6c65 6e28 7365 6172       if len(sear
-000159a0: 6368 5f74 6167 7329 203d 3d20 3120 616e  ch_tags) == 1 an
-000159b0: 6420 6c65 6e28 7265 706c 6163 656d 656e  d len(replacemen
-000159c0: 745f 7461 6773 2920 3d3d 2031 3a0a 2020  t_tags) == 1:.  
-000159d0: 2020 2020 2020 2020 2020 7461 6731 2c20            tag1, 
-000159e0: 7461 6732 203d 2073 6561 7263 685f 7461  tag2 = search_ta
-000159f0: 6773 5b30 5d2c 2072 6570 6c61 6365 6d65  gs[0], replaceme
-00015a00: 6e74 5f74 6167 735b 305d 0a20 2020 2020  nt_tags[0].     
-00015a10: 2020 2020 2020 2069 6e66 6f20 3d20 7769         info = wi
-00015a20: 6e64 6f77 2e73 746f 7265 2e73 6574 7469  ndow.store.setti
-00015a30: 6e67 732e 6765 745f 7461 675f 696e 666f  ngs.get_tag_info
-00015a40: 2874 6167 3129 0a20 2020 2020 2020 2020  (tag1).         
-00015a50: 2020 2077 696e 646f 772e 7374 6f72 652e     window.store.
-00015a60: 7365 7474 696e 6773 2e73 6574 5f74 6167  settings.set_tag
-00015a70: 5f69 6e66 6f28 7461 6731 2c20 7b7d 290a  _info(tag1, {}).
-00015a80: 2020 2020 2020 2020 2020 2020 7769 6e64              wind
-00015a90: 6f77 2e73 746f 7265 2e73 6574 7469 6e67  ow.store.setting
-00015aa0: 732e 7365 745f 7461 675f 696e 666f 2874  s.set_tag_info(t
-00015ab0: 6167 322c 2069 6e66 6f29 0a0a 2020 2020  ag2, info)..    
-00015ac0: 2020 2020 2320 4665 6564 6261 636b 0a20      # Feedback. 
-00015ad0: 2020 2020 2020 2073 656c 662e 5f62 7574         self._but
-00015ae0: 746f 6e5f 7265 706c 6163 655f 636f 6d66  ton_replace_comf
-00015af0: 6972 6d2e 696e 6e65 7254 6578 7420 3d20  irm.innerText = 
-00015b00: 2244 6f6e 6522 0a20 2020 2020 2020 2073  "Done".        s
-00015b10: 656c 662e 5f62 7574 746f 6e5f 7265 706c  elf._button_repl
-00015b20: 6163 655f 636f 6d66 6972 6d2e 6469 7361  ace_comfirm.disa
-00015b30: 626c 6564 203d 2054 7275 650a 2020 2020  bled = True.    
-00015b40: 2020 2020 7769 6e64 6f77 2e73 6574 5469      window.setTi
-00015b50: 6d65 6f75 7428 7365 6c66 2e5f 6869 6465  meout(self._hide
-00015b60: 5f63 6f6e 6669 726d 5f62 7574 746f 6e2c  _confirm_button,
-00015b70: 2035 3030 290a 0a0a 636c 6173 7320 5365   500)...class Se
-00015b80: 6172 6368 4469 616c 6f67 2842 6173 6544  archDialog(BaseD
-00015b90: 6961 6c6f 6729 3a0a 2020 2020 2222 2244  ialog):.    """D
-00015ba0: 6961 6c6f 6720 746f 2073 6561 7263 6820  ialog to search 
-00015bb0: 666f 7220 7265 636f 7264 7320 616e 6420  for records and 
-00015bc0: 7461 6773 2e22 2222 0a0a 2020 2020 6465  tags."""..    de
-00015bd0: 6620 6f70 656e 2873 656c 6629 3a0a 2020  f open(self):.  
-00015be0: 2020 2020 2020 7365 6c66 2e6d 6169 6e64        self.maind
-00015bf0: 6976 2e69 6e6e 6572 4854 4d4c 203d 2022  iv.innerHTML = "
-00015c00: 2222 0a20 2020 2020 2020 2020 2020 203c  "".            <
-00015c10: 6831 3e3c 6920 636c 6173 733d 2766 6173  h1><i class='fas
-00015c20: 273e 5c75 6630 3032 3c2f 693e 266e 6273  '>\uf002</i>&nbs
-00015c30: 703b 266e 6273 703b 5365 6172 6368 2072  p;&nbsp;Search r
-00015c40: 6563 6f72 6473 2061 6e64 2074 6167 730a  ecords and tags.
-00015c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015c60: 3c62 7574 746f 6e20 7479 7065 3d27 6275  <button type='bu
-00015c70: 7474 6f6e 273e 3c69 2063 6c61 7373 3d27  tton'><i class='
-00015c80: 6661 7327 3e5c 7566 3030 643c 2f69 3e3c  fas'>\uf00d</i><
-00015c90: 2f62 7574 746f 6e3e 0a20 2020 2020 2020  /button>.       
-00015ca0: 2020 2020 2020 2020 203c 2f68 313e 0a20           </h1>. 
-00015cb0: 2020 2020 2020 2020 2020 203c 703e 5468             <p>Th
-00015cc0: 6973 2074 6f6f 6c20 616c 6c6f 7773 2079  is tool allows y
-00015cd0: 6f75 2074 6f20 7365 6172 6368 2072 6563  ou to search rec
-00015ce0: 6f72 6473 2062 7920 7461 6773 2061 6e64  ords by tags and
-00015cf0: 2070 6c61 696e 2074 6578 742e 0a20 2020   plain text..   
-00015d00: 2020 2020 2020 2020 2050 7265 7065 6e64           Prepend
-00015d10: 2074 6167 732f 776f 7264 7320 7769 7468   tags/words with
-00015d20: 2022 2122 2074 6f20 6578 636c 7564 6520   "!" to exclude 
-00015d30: 7265 636f 7264 7320 7468 6174 206d 6174  records that mat
-00015d40: 6368 2069 742e 0a20 2020 2020 2020 2020  ch it..         
-00015d50: 2020 203c 6272 3e3c 6272 3e0a 2020 2020     <br><br>.    
-00015d60: 2020 2020 2020 2020 3c2f 703e 0a20 2020          </p>.   
-00015d70: 2020 2020 2020 2020 203c 6469 7620 636c           <div cl
-00015d80: 6173 733d 2763 6f6e 7461 696e 6572 2720  ass='container' 
-00015d90: 7374 796c 653d 2770 6f73 6974 696f 6e3a  style='position:
-00015da0: 2072 656c 6174 6976 653b 273e 0a20 2020   relative;'>.   
-00015db0: 2020 2020 2020 2020 2020 2020 203c 696e               <in
-00015dc0: 7075 7420 7479 7065 3d27 7465 7874 2720  put type='text' 
-00015dd0: 7374 796c 653d 2777 6964 7468 3a31 3030  style='width:100
-00015de0: 253b 2720 7370 656c 6c63 6865 636b 3d27  %;' spellcheck='
-00015df0: 6661 6c73 6527 202f 3e0a 2020 2020 2020  false' />.      
-00015e00: 2020 2020 2020 2020 2020 3c64 6976 2063            <div c
-00015e10: 6c61 7373 3d27 7461 672d 7375 6767 6573  lass='tag-sugges
-00015e20: 7469 6f6e 732d 6175 746f 636f 6d70 273e  tions-autocomp'>
-00015e30: 3c2f 6469 763e 0a20 2020 2020 2020 2020  </div>.         
-00015e40: 2020 203c 2f64 6976 3e0a 2020 2020 2020     </div>.      
-00015e50: 2020 2020 2020 3c64 6976 2073 7479 6c65        <div style
-00015e60: 3d27 666f 6e74 2d73 697a 653a 2073 6d61  ='font-size: sma
-00015e70: 6c6c 6572 3b27 3e3c 2f64 6976 3e0a 2020  ller;'></div>.  
-00015e80: 2020 2020 2020 2020 2020 3c62 723e 0a20            <br>. 
-00015e90: 2020 2020 2020 2020 2020 203c 6275 7474             <butt
-00015ea0: 6f6e 2074 7970 653d 2762 7574 746f 6e27  on type='button'
-00015eb0: 3e53 6561 7263 683c 2f62 7574 746f 6e3e  >Search</button>
-00015ec0: 0a20 2020 2020 2020 2020 2020 203c 6275  .            <bu
-00015ed0: 7474 6f6e 2074 7970 653d 2762 7574 746f  tton type='butto
-00015ee0: 6e27 3e4d 616e 6167 6520 7461 6773 3c2f  n'>Manage tags</
-00015ef0: 6275 7474 6f6e 3e0a 2020 2020 2020 2020  button>.        
-00015f00: 2020 2020 3c68 7220 2f3e 0a20 2020 2020      <hr />.     
-00015f10: 2020 2020 2020 203c 6469 7620 636c 6173         <div clas
-00015f20: 733d 2772 6563 6f72 645f 6772 6964 2720  s='record_grid' 
-00015f30: 7374 796c 653d 276d 696e 2d68 6569 6768  style='min-heigh
-00015f40: 743a 3130 3070 7827 3e3c 2f64 6976 3e0a  t:100px'></div>.
-00015f50: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-00015f60: 2020 2020 2063 6c6f 7365 5f62 7574 203d       close_but =
-00015f70: 2073 656c 662e 6d61 696e 6469 762e 6368   self.maindiv.ch
-00015f80: 696c 6472 656e 5b30 5d2e 6368 696c 6472  ildren[0].childr
-00015f90: 656e 5b2d 315d 0a20 2020 2020 2020 2063  en[-1].        c
-00015fa0: 6c6f 7365 5f62 7574 2e6f 6e63 6c69 636b  lose_but.onclick
-00015fb0: 203d 2073 656c 662e 636c 6f73 650a 0a20   = self.close.. 
-00015fc0: 2020 2020 2020 2073 656c 662e 5f72 6563         self._rec
-00015fd0: 6f72 6473 5f6e 6f64 6520 3d20 7365 6c66  ords_node = self
-00015fe0: 2e6d 6169 6e64 6976 2e63 6869 6c64 7265  .maindiv.childre
-00015ff0: 6e5b 2d31 5d0a 0a20 2020 2020 2020 2028  n[-1]..        (
-00016000: 0a20 2020 2020 2020 2020 2020 205f 2c20  .            _, 
-00016010: 2023 2068 310a 2020 2020 2020 2020 2020   # h1.          
-00016020: 2020 5f2c 2020 2320 700a 2020 2020 2020    _,  # p.      
-00016030: 2020 2020 2020 7365 6172 6368 5f63 6f6e        search_con
-00016040: 7461 696e 6572 2c0a 2020 2020 2020 2020  tainer,.        
-00016050: 2020 2020 7365 6c66 2e5f 696e 666f 5f64      self._info_d
-00016060: 6976 2c0a 2020 2020 2020 2020 2020 2020  iv,.            
-00016070: 5f2c 2020 2320 6272 0a20 2020 2020 2020  _,  # br.       
-00016080: 2020 2020 2073 656c 662e 5f73 6561 7263       self._searc
-00016090: 685f 6275 742c 0a20 2020 2020 2020 2020  h_but,.         
-000160a0: 2020 2073 656c 662e 5f74 6167 6d61 6e61     self._tagmana
-000160b0: 6765 5f62 7574 2c0a 2020 2020 2020 2020  ge_but,.        
-000160c0: 2920 3d20 7365 6c66 2e6d 6169 6e64 6976  ) = self.maindiv
-000160d0: 2e63 6869 6c64 7265 6e0a 0a20 2020 2020  .children..     
-000160e0: 2020 2073 656c 662e 5f73 6561 7263 685f     self._search_
-000160f0: 696e 7075 742c 2073 656c 662e 5f61 7574  input, self._aut
-00016100: 6f63 6f6d 706c 6574 6572 5f64 6976 203d  ocompleter_div =
-00016110: 2073 6561 7263 685f 636f 6e74 6169 6e65   search_containe
-00016120: 722e 6368 696c 6472 656e 0a20 2020 2020  r.children.     
-00016130: 2020 2073 656c 662e 5f73 6561 7263 685f     self._search_
-00016140: 696e 7075 742e 706c 6163 6568 6f6c 6465  input.placeholde
-00016150: 7220 3d20 2254 6167 7320 6f72 2074 6578  r = "Tags or tex
-00016160: 7420 746f 2073 6561 7263 6820 666f 7220  t to search for 
-00016170: 2e2e 2e22 0a0a 2020 2020 2020 2020 7365  ..."..        se
-00016180: 6c66 2e5f 7365 6172 6368 5f69 6e70 7574  lf._search_input
-00016190: 2e6f 6e69 6e70 7574 203d 2073 656c 662e  .oninput = self.
-000161a0: 5f6f 6e5f 7573 6572 5f65 6469 740a 2020  _on_user_edit.  
-000161b0: 2020 2020 2020 7365 6c66 2e5f 7365 6172        self._sear
-000161c0: 6368 5f69 6e70 7574 2e6f 6e63 6861 6e67  ch_input.onchang
-000161d0: 6520 3d20 7365 6c66 2e5f 6f6e 5f75 7365  e = self._on_use
-000161e0: 725f 6564 6974 5f64 6f6e 650a 2020 2020  r_edit_done.    
-000161f0: 2020 2020 7365 6c66 2e5f 7365 6172 6368      self._search
-00016200: 5f69 6e70 7574 2e6f 6e6b 6579 646f 776e  _input.onkeydown
-00016210: 203d 2073 656c 662e 5f6f 6e5f 6b65 790a   = self._on_key.
-00016220: 0a20 2020 2020 2020 2073 656c 662e 5f73  .        self._s
-00016230: 6561 7263 685f 6275 742e 6f6e 636c 6963  earch_but.onclic
-00016240: 6b20 3d20 7365 6c66 2e5f 6669 6e64 5f72  k = self._find_r
-00016250: 6563 6f72 6473 0a20 2020 2020 2020 2073  ecords.        s
-00016260: 656c 662e 5f74 6167 6d61 6e61 6765 5f62  elf._tagmanage_b
-00016270: 7574 2e6f 6e63 6c69 636b 203d 2073 656c  ut.onclick = sel
-00016280: 662e 5f6f 7065 6e5f 7461 675f 6469 616c  f._open_tag_dial
-00016290: 6f67 0a0a 2020 2020 2020 2020 7365 6c66  og..        self
-000162a0: 2e5f 7365 6172 6368 5f62 7574 2e64 6973  ._search_but.dis
-000162b0: 6162 6c65 6420 3d20 5472 7565 0a20 2020  abled = True.   
-000162c0: 2020 2020 2073 656c 662e 5f74 6167 6d61       self._tagma
-000162d0: 6e61 6765 5f62 7574 2e64 6973 6162 6c65  nage_but.disable
-000162e0: 6420 3d20 5472 7565 0a0a 2020 2020 2020  d = True..      
-000162f0: 2020 7365 6c66 2e5f 6175 746f 636f 6d70    self._autocomp
-00016300: 6c65 7465 7220 3d20 4175 746f 636f 6d70  leter = Autocomp
-00016310: 6c65 7465 7228 0a20 2020 2020 2020 2020  leter(.         
-00016320: 2020 2073 656c 662e 5f61 7574 6f63 6f6d     self._autocom
-00016330: 706c 6574 6572 5f64 6976 2c20 7365 6c66  pleter_div, self
-00016340: 2e5f 7365 6172 6368 5f69 6e70 7574 2c20  ._search_input, 
-00016350: 7365 6c66 2e5f 6175 746f 636f 6d70 5f66  self._autocomp_f
-00016360: 696e 6973 6865 642c 2031 0a20 2020 2020  inished, 1.     
-00016370: 2020 2029 0a0a 2020 2020 2020 2020 7769     )..        wi
-00016380: 6e64 6f77 2e5f 7365 6172 6368 5f64 6961  ndow._search_dia
-00016390: 6c6f 675f 6f70 656e 5f72 6563 6f72 6420  log_open_record 
-000163a0: 3d20 7365 6c66 2e5f 6f70 656e 5f72 6563  = self._open_rec
-000163b0: 6f72 640a 2020 2020 2020 2020 7365 6c66  ord.        self
-000163c0: 2e5f 7265 636f 7264 7320 3d20 5b5d 0a0a  ._records = []..
-000163d0: 2020 2020 2020 2020 7365 6c66 2e5f 6375          self._cu
-000163e0: 7272 656e 745f 706f 735f 7461 6773 203d  rrent_pos_tags =
-000163f0: 205b 5d0a 2020 2020 2020 2020 7365 6c66   [].        self
-00016400: 2e5f 6375 7272 656e 745f 6e65 675f 7461  ._current_neg_ta
-00016410: 6773 203d 205b 5d0a 2020 2020 2020 2020  gs = [].        
-00016420: 7365 6c66 2e5f 6375 7272 656e 745f 706f  self._current_po
-00016430: 735f 776f 7264 7320 3d20 5b5d 0a20 2020  s_words = [].   
-00016440: 2020 2020 2073 656c 662e 5f63 7572 7265       self._curre
-00016450: 6e74 5f6e 6567 5f77 6f72 6473 203d 205b  nt_neg_words = [
-00016460: 5d0a 0a20 2020 2020 2020 2073 7570 6572  ]..        super
-00016470: 2829 2e6f 7065 6e28 4e6f 6e65 290a 2020  ().open(None).  
-00016480: 2020 2020 2020 7365 6c66 2e5f 6368 6563        self._chec
-00016490: 6b5f 6e61 6d65 7328 290a 2020 2020 2020  k_names().      
-000164a0: 2020 6966 2075 7469 6c73 2e6c 6f6f 6b73    if utils.looks
-000164b0: 5f6c 696b 655f 6465 736b 746f 7028 293a  _like_desktop():
-000164c0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000164d0: 662e 5f73 6561 7263 685f 696e 7075 742e  f._search_input.
-000164e0: 666f 6375 7328 290a 0a20 2020 2064 6566  focus()..    def
-000164f0: 2063 6c6f 7365 2873 656c 6629 3a0a 2020   close(self):.  
-00016500: 2020 2020 2020 7365 6c66 2e5f 6175 746f        self._auto
-00016510: 636f 6d70 6c65 7465 722e 636c 6f73 6528  completer.close(
-00016520: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
-00016530: 7265 636f 7264 7320 3d20 5b5d 0a20 2020  records = [].   
-00016540: 2020 2020 2073 7570 6572 2829 2e63 6c6f       super().clo
-00016550: 7365 2829 0a0a 2020 2020 6465 6620 5f61  se()..    def _a
-00016560: 7574 6f63 6f6d 705f 6669 6e69 7368 6564  utocomp_finished
-00016570: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00016580: 7365 6c66 2e5f 6368 6563 6b5f 6e61 6d65  self._check_name
-00016590: 7328 290a 0a20 2020 2064 6566 205f 6f6e  s()..    def _on
-000165a0: 5f75 7365 725f 6564 6974 2873 656c 6629  _user_edit(self)
-000165b0: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
-000165c0: 6175 746f 636f 6d70 6c65 7465 722e 696e  autocompleter.in
-000165d0: 6974 2829 0a20 2020 2020 2020 2073 656c  it().        sel
-000165e0: 662e 5f63 6865 636b 5f6e 616d 6573 2829  f._check_names()
-000165f0: 0a0a 2020 2020 6465 6620 5f6f 6e5f 7573  ..    def _on_us
-00016600: 6572 5f65 6469 745f 646f 6e65 2873 656c  er_edit_done(sel
-00016610: 6629 3a0a 2020 2020 2020 2020 7365 6c66  f):.        self
-00016620: 2e5f 6175 746f 636f 6d70 6c65 7465 722e  ._autocompleter.
-00016630: 636c 6561 7228 290a 0a20 2020 2064 6566  clear()..    def
-00016640: 205f 6368 6563 6b5f 6e61 6d65 7328 7365   _check_names(se
-00016650: 6c66 293a 0a20 2020 2020 2020 2074 6578  lf):.        tex
-00016660: 7420 3d20 7365 6c66 2e5f 7365 6172 6368  t = self._search
-00016670: 5f69 6e70 7574 2e76 616c 7565 2e6c 6f77  _input.value.low
-00016680: 6572 2829 0a0a 2020 2020 2020 2020 5f2c  er()..        _,
-00016690: 2070 6172 7473 203d 2075 7469 6c73 2e67   parts = utils.g
-000166a0: 6574 5f74 6167 735f 616e 645f 7061 7274  et_tags_and_part
-000166b0: 735f 6672 6f6d 5f73 7472 696e 6728 7465  s_from_string(te
-000166c0: 7874 290a 0a20 2020 2020 2020 2070 6f73  xt)..        pos
-000166d0: 5f74 6167 7320 3d20 5b5d 0a20 2020 2020  _tags = [].     
-000166e0: 2020 206e 6567 5f74 6167 7320 3d20 5b5d     neg_tags = []
-000166f0: 0a20 2020 2020 2020 2070 6f73 5f77 6f72  .        pos_wor
-00016700: 6473 203d 205b 5d0a 2020 2020 2020 2020  ds = [].        
-00016710: 6e65 675f 776f 7264 7320 3d20 5b5d 0a0a  neg_words = []..
-00016720: 2020 2020 2020 2020 6e65 785f 7461 675f          nex_tag_
-00016730: 6973 5f6e 6567 203d 2046 616c 7365 0a20  is_neg = False. 
-00016740: 2020 2020 2020 2066 6f72 2070 6172 7420         for part 
-00016750: 696e 2070 6172 7473 3a0a 2020 2020 2020  in parts:.      
-00016760: 2020 2020 2020 7468 6973 5f74 6167 5f69        this_tag_i
-00016770: 735f 6e65 6720 3d20 6e65 785f 7461 675f  s_neg = nex_tag_
-00016780: 6973 5f6e 6567 0a20 2020 2020 2020 2020  is_neg.         
-00016790: 2020 206e 6578 5f74 6167 5f69 735f 6e65     nex_tag_is_ne
-000167a0: 6720 3d20 4661 6c73 650a 2020 2020 2020  g = False.      
-000167b0: 2020 2020 2020 6966 2070 6172 742e 7374        if part.st
-000167c0: 6172 7473 7769 7468 2822 2322 293a 0a20  artswith("#"):. 
-000167d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000167e0: 6620 7468 6973 5f74 6167 5f69 735f 6e65  f this_tag_is_ne
-000167f0: 673a 0a20 2020 2020 2020 2020 2020 2020  g:.             
-00016800: 2020 2020 2020 206e 6567 5f74 6167 732e         neg_tags.
-00016810: 6170 7065 6e64 2870 6172 742e 6c6f 7765  append(part.lowe
-00016820: 7228 2929 0a20 2020 2020 2020 2020 2020  r()).           
-00016830: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00016840: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00016850: 6f73 5f74 6167 732e 6170 7065 6e64 2870  os_tags.append(p
-00016860: 6172 742e 6c6f 7765 7228 2929 0a20 2020  art.lower()).   
-00016870: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00016880: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00016890: 6f72 2077 6f72 6420 696e 2070 6172 742e  or word in part.
-000168a0: 7370 6c69 7428 2220 2229 3a0a 2020 2020  split(" "):.    
-000168b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000168c0: 776f 7264 203d 2077 6f72 642e 7374 7269  word = word.stri
-000168d0: 7028 290a 2020 2020 2020 2020 2020 2020  p().            
-000168e0: 2020 2020 2020 2020 6966 206e 6f74 2077          if not w
-000168f0: 6f72 643a 0a20 2020 2020 2020 2020 2020  ord:.           
-00016900: 2020 2020 2020 2020 2020 2020 2070 6173               pas
-00016910: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00016920: 2020 2020 2020 656c 6966 2077 6f72 6420        elif word 
-00016930: 3d3d 2022 2122 3a0a 2020 2020 2020 2020  == "!":.        
-00016940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016950: 6e65 785f 7461 675f 6973 5f6e 6567 203d  nex_tag_is_neg =
-00016960: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-00016970: 2020 2020 2020 2020 2020 656c 6966 2077            elif w
-00016980: 6f72 642e 7374 6172 7473 7769 7468 2822  ord.startswith("
-00016990: 2122 293a 0a20 2020 2020 2020 2020 2020  !"):.           
-000169a0: 2020 2020 2020 2020 2020 2020 206e 6567               neg
-000169b0: 5f77 6f72 6473 2e61 7070 656e 6428 776f  _words.append(wo
-000169c0: 7264 5b31 3a5d 290a 2020 2020 2020 2020  rd[1:]).        
-000169d0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000169e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000169f0: 2020 2020 2020 2020 2020 706f 735f 776f            pos_wo
-00016a00: 7264 732e 6170 7065 6e64 2877 6f72 6429  rds.append(word)
-00016a10: 0a0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-00016a20: 6375 7272 656e 745f 706f 735f 7461 6773  current_pos_tags
-00016a30: 203d 2070 6f73 5f74 6167 730a 2020 2020   = pos_tags.    
-00016a40: 2020 2020 7365 6c66 2e5f 6375 7272 656e      self._curren
-00016a50: 745f 6e65 675f 7461 6773 203d 206e 6567  t_neg_tags = neg
-00016a60: 5f74 6167 730a 2020 2020 2020 2020 7365  _tags.        se
-00016a70: 6c66 2e5f 6375 7272 656e 745f 706f 735f  lf._current_pos_
-00016a80: 776f 7264 7320 3d20 706f 735f 776f 7264  words = pos_word
-00016a90: 730a 2020 2020 2020 2020 7365 6c66 2e5f  s.        self._
-00016aa0: 6375 7272 656e 745f 6e65 675f 776f 7264  current_neg_word
-00016ab0: 7320 3d20 6e65 675f 776f 7264 730a 0a20  s = neg_words.. 
-00016ac0: 2020 2020 2020 2023 2050 726f 6365 7373         # Process
-00016ad0: 2073 6561 7263 6820 6275 7474 6f6e 0a20   search button. 
-00016ae0: 2020 2020 2020 2069 6620 706f 735f 7461         if pos_ta
-00016af0: 6773 206f 7220 6e65 675f 7461 6773 206f  gs or neg_tags o
-00016b00: 7220 706f 735f 776f 7264 7320 6f72 206e  r pos_words or n
-00016b10: 6567 5f77 6f72 6473 3a0a 2020 2020 2020  eg_words:.      
-00016b20: 2020 2020 2020 7365 6c66 2e5f 7365 6172        self._sear
-00016b30: 6368 5f62 7574 2e64 6973 6162 6c65 6420  ch_but.disabled 
-00016b40: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-00016b50: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00016b60: 2020 7365 6c66 2e5f 7365 6172 6368 5f62    self._search_b
-00016b70: 7574 2e64 6973 6162 6c65 6420 3d20 5472  ut.disabled = Tr
-00016b80: 7565 0a0a 2020 2020 2020 2020 2320 5072  ue..        # Pr
-00016b90: 6f63 6573 7320 7461 6773 2062 7574 746f  ocess tags butto
-00016ba0: 6e0a 2020 2020 2020 2020 6966 206c 656e  n.        if len
-00016bb0: 2870 6f73 5f74 6167 7329 203e 2030 3a0a  (pos_tags) > 0:.
-00016bc0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00016bd0: 656e 2870 6f73 5f74 6167 7329 203d 3d20  en(pos_tags) == 
-00016be0: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
-00016bf0: 2020 2069 636f 6e20 3d20 223c 6920 636c     icon = "<i cl
-00016c00: 6173 733d 2766 6173 273e 5c75 6630 3262  ass='fas'>\uf02b
-00016c10: 3c2f 693e 266e 6273 703b 266e 6273 703b  </i>&nbsp;&nbsp;
-00016c20: 220a 2020 2020 2020 2020 2020 2020 656c  ".            el
-00016c30: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00016c40: 2020 2020 6963 6f6e 203d 2022 3c69 2063      icon = "<i c
-00016c50: 6c61 7373 3d27 6661 7327 3e5c 7566 3032  lass='fas'>\uf02
-00016c60: 633c 2f69 3e26 6e62 7370 3b26 6e62 7370  c</i>&nbsp;&nbsp
-00016c70: 3b22 0a20 2020 2020 2020 2020 2020 2073  ;".            s
-00016c80: 656c 662e 5f74 6167 6d61 6e61 6765 5f62  elf._tagmanage_b
-00016c90: 7574 2e69 6e6e 6572 4854 4d4c 203d 2066  ut.innerHTML = f
-00016ca0: 227b 6963 6f6e 7d20 4d61 6e61 6765 207b  "{icon} Manage {
-00016cb0: 706f 735f 7461 6773 2e6a 6f69 6e28 2720  pos_tags.join(' 
-00016cc0: 2729 7d22 0a20 2020 2020 2020 2020 2020  ')}".           
-00016cd0: 2073 656c 662e 5f74 6167 6d61 6e61 6765   self._tagmanage
-00016ce0: 5f62 7574 2e64 6973 6162 6c65 6420 3d20  _but.disabled = 
-00016cf0: 4661 6c73 650a 2020 2020 2020 2020 656c  False.        el
-00016d00: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00016d10: 7365 6c66 2e5f 7461 676d 616e 6167 655f  self._tagmanage_
-00016d20: 6275 742e 696e 6e65 7248 544d 4c20 3d20  but.innerHTML = 
-00016d30: 224d 616e 6167 6520 7461 6773 220a 2020  "Manage tags".  
-00016d40: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00016d50: 7461 676d 616e 6167 655f 6275 742e 6469  tagmanage_but.di
-00016d60: 7361 626c 6564 203d 2054 7275 650a 0a20  sabled = True.. 
-00016d70: 2020 2020 2020 2073 656c 662e 5f73 686f         self._sho
-00016d80: 775f 7768 6174 5f77 6f75 6c64 5f62 655f  w_what_would_be_
-00016d90: 7365 6172 6368 6564 2829 0a0a 2020 2020  searched()..    
-00016da0: 6465 6620 5f6f 6e5f 6b65 7928 7365 6c66  def _on_key(self
-00016db0: 2c20 6529 3a0a 2020 2020 2020 2020 6b65  , e):.        ke
-00016dc0: 7920 3d20 652e 6b65 792e 6c6f 7765 7228  y = e.key.lower(
-00016dd0: 290a 2020 2020 2020 2020 6966 2073 656c  ).        if sel
-00016de0: 662e 5f61 7574 6f63 6f6d 706c 6574 6572  f._autocompleter
-00016df0: 2e6f 6e5f 6b65 7928 6529 3a0a 2020 2020  .on_key(e):.    
-00016e00: 2020 2020 2020 2020 652e 7374 6f70 5072          e.stopPr
-00016e10: 6f70 6167 6174 696f 6e28 290a 2020 2020  opagation().    
-00016e20: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
-00016e30: 2020 2020 2020 2065 6c69 6620 6b65 7920         elif key 
-00016e40: 3d3d 2022 656e 7465 7222 206f 7220 6b65  == "enter" or ke
-00016e50: 7920 3d3d 2022 7265 7475 726e 223a 0a20  y == "return":. 
-00016e60: 2020 2020 2020 2020 2020 2065 2e73 746f             e.sto
-00016e70: 7050 726f 7061 6761 7469 6f6e 2829 0a20  pPropagation(). 
-00016e80: 2020 2020 2020 2020 2020 2065 2e70 7265             e.pre
-00016e90: 7665 6e74 4465 6661 756c 7428 290a 2020  ventDefault().  
-00016ea0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00016eb0: 6669 6e64 5f72 6563 6f72 6473 2829 0a20  find_records(). 
-00016ec0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00016ed0: 2020 2020 2020 2020 2073 7570 6572 2829           super()
-00016ee0: 2e5f 6f6e 5f6b 6579 2865 290a 0a20 2020  ._on_key(e)..   
-00016ef0: 2064 6566 205f 6669 6e64 5f72 6563 6f72   def _find_recor
-00016f00: 6473 2873 656c 6629 3a0a 2020 2020 2020  ds(self):.      
-00016f10: 2020 7265 636f 7264 7320 3d20 5b5d 0a0a    records = []..
-00016f20: 2020 2020 2020 2020 706f 735f 7461 6773          pos_tags
-00016f30: 203d 2073 656c 662e 5f63 7572 7265 6e74   = self._current
-00016f40: 5f70 6f73 5f74 6167 730a 2020 2020 2020  _pos_tags.      
-00016f50: 2020 6e65 675f 7461 6773 203d 2073 656c    neg_tags = sel
-00016f60: 662e 5f63 7572 7265 6e74 5f6e 6567 5f74  f._current_neg_t
-00016f70: 6167 730a 2020 2020 2020 2020 706f 735f  ags.        pos_
-00016f80: 776f 7264 7320 3d20 7365 6c66 2e5f 6375  words = self._cu
-00016f90: 7272 656e 745f 706f 735f 776f 7264 730a  rrent_pos_words.
-00016fa0: 2020 2020 2020 2020 6e65 675f 776f 7264          neg_word
-00016fb0: 7320 3d20 7365 6c66 2e5f 6375 7272 656e  s = self._curren
-00016fc0: 745f 6e65 675f 776f 7264 730a 0a20 2020  t_neg_words..   
-00016fd0: 2020 2020 2069 735f 6869 6464 656e 203d       is_hidden =
-00016fe0: 2077 696e 646f 772e 7374 6f72 6573 2e69   window.stores.i
-00016ff0: 735f 6869 6464 656e 0a0a 2020 2020 2020  s_hidden..      
-00017000: 2020 6966 2028 0a20 2020 2020 2020 2020    if (.         
-00017010: 2020 206c 656e 2870 6f73 5f74 6167 7329     len(pos_tags)
-00017020: 203e 2030 0a20 2020 2020 2020 2020 2020   > 0.           
-00017030: 206f 7220 6c65 6e28 6e65 675f 7461 6773   or len(neg_tags
-00017040: 2920 3e20 300a 2020 2020 2020 2020 2020  ) > 0.          
-00017050: 2020 6f72 206c 656e 2870 6f73 5f77 6f72    or len(pos_wor
-00017060: 6473 2920 3e20 300a 2020 2020 2020 2020  ds) > 0.        
-00017070: 2020 2020 6f72 206c 656e 286e 6567 5f77      or len(neg_w
-00017080: 6f72 6473 2920 3e20 300a 2020 2020 2020  ords) > 0.      
-00017090: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
-000170a0: 2023 2047 6574 206c 6973 7420 6f66 2072   # Get list of r
-000170b0: 6563 6f72 6473 0a20 2020 2020 2020 2020  ecords.         
-000170c0: 2020 2066 6f72 2072 6563 6f72 6420 696e     for record in
-000170d0: 2077 696e 646f 772e 7374 6f72 652e 7265   window.store.re
-000170e0: 636f 7264 732e 6765 745f 6475 6d70 2829  cords.get_dump()
-000170f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00017100: 2020 6966 2069 735f 6869 6464 656e 2872    if is_hidden(r
-00017110: 6563 6f72 6429 3a0a 2020 2020 2020 2020  ecord):.        
-00017120: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00017130: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
-00017140: 2020 2020 2023 2043 6865 636b 2074 6167       # Check tag
-00017150: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00017160: 2020 7461 6773 203d 2077 696e 646f 772e    tags = window.
-00017170: 7374 6f72 652e 7265 636f 7264 732e 7461  store.records.ta
-00017180: 6773 5f66 726f 6d5f 7265 636f 7264 2872  gs_from_record(r
-00017190: 6563 6f72 6429 2020 2320 616c 736f 2023  ecord)  # also #
-000171a0: 756e 7461 6767 6564 0a20 2020 2020 2020  untagged.       
-000171b0: 2020 2020 2020 2020 2061 6c6c 5f74 6167           all_tag
-000171c0: 735f 6f6b 203d 2054 7275 650a 2020 2020  s_ok = True.    
-000171d0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000171e0: 7461 6720 696e 2070 6f73 5f74 6167 733a  tag in pos_tags:
-000171f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017200: 2020 2020 2069 6620 7461 6720 6e6f 7420       if tag not 
-00017210: 696e 2074 6167 733a 0a20 2020 2020 2020  in tags:.       
-00017220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017230: 2061 6c6c 5f74 6167 735f 6f6b 203d 2046   all_tags_ok = F
-00017240: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-00017250: 2020 2020 2020 2020 2020 2020 2062 7265               bre
-00017260: 616b 0a20 2020 2020 2020 2020 2020 2020  ak.             
-00017270: 2020 2066 6f72 2074 6167 2069 6e20 6e65     for tag in ne
-00017280: 675f 7461 6773 3a0a 2020 2020 2020 2020  g_tags:.        
-00017290: 2020 2020 2020 2020 2020 2020 6966 2074              if t
-000172a0: 6167 2069 6e20 7461 6773 3a0a 2020 2020  ag in tags:.    
-000172b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000172c0: 2020 2020 616c 6c5f 7461 6773 5f6f 6b20      all_tags_ok 
-000172d0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-000172e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000172f0: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
-00017300: 2020 2020 2020 6966 206e 6f74 2061 6c6c        if not all
-00017310: 5f74 6167 735f 6f6b 3a0a 2020 2020 2020  _tags_ok:.      
-00017320: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00017330: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
-00017340: 2020 2020 2020 2023 2043 6865 636b 2073         # Check s
-00017350: 7472 696e 6773 0a20 2020 2020 2020 2020  trings.         
-00017360: 2020 2020 2020 2064 7320 3d20 2872 6563         ds = (rec
-00017370: 6f72 642e 6473 206f 7220 2222 292e 6c6f  ord.ds or "").lo
-00017380: 7765 7228 290a 2020 2020 2020 2020 2020  wer().          
-00017390: 2020 2020 2020 616c 6c5f 7374 7269 6e67        all_string
-000173a0: 735f 6f6b 203d 2054 7275 650a 2020 2020  s_ok = True.    
-000173b0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000173c0: 776f 7264 2069 6e20 706f 735f 776f 7264  word in pos_word
-000173d0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-000173e0: 2020 2020 2020 2069 6620 776f 7264 206e         if word n
-000173f0: 6f74 2069 6e20 6473 3a0a 2020 2020 2020  ot in ds:.      
-00017400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017410: 2020 616c 6c5f 7374 7269 6e67 735f 6f6b    all_strings_ok
-00017420: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-00017430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017440: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
-00017450: 2020 2020 2020 2066 6f72 2077 6f72 6420         for word 
-00017460: 696e 206e 6567 5f77 6f72 6473 3a0a 2020  in neg_words:.  
-00017470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017480: 2020 6966 2077 6f72 6420 696e 2064 733a    if word in ds:
-00017490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000174a0: 2020 2020 2020 2020 2061 6c6c 5f73 7472           all_str
-000174b0: 696e 6773 5f6f 6b20 3d20 4661 6c73 650a  ings_ok = False.
-000174c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000174d0: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
-000174e0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000174f0: 206e 6f74 2061 6c6c 5f73 7472 696e 6773   not all_strings
-00017500: 5f6f 6b3a 0a20 2020 2020 2020 2020 2020  _ok:.           
-00017510: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-00017520: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00017530: 2020 2320 416c 6c20 6368 6563 6b73 2070    # All checks p
-00017540: 6173 7365 640a 2020 2020 2020 2020 2020  assed.          
-00017550: 2020 2020 2020 7265 636f 7264 732e 7075        records.pu
-00017560: 7368 285b 7265 636f 7264 2e74 312c 2072  sh([record.t1, r
-00017570: 6563 6f72 642e 6b65 795d 290a 0a20 2020  ecord.key])..   
-00017580: 2020 2020 2072 6563 6f72 6473 2e73 6f72       records.sor
-00017590: 7428 6b65 793d 6c61 6d62 6461 2078 3a20  t(key=lambda x: 
-000175a0: 2d78 5b30 5d29 0a20 2020 2020 2020 2073  -x[0]).        s
-000175b0: 656c 662e 5f72 6563 6f72 6473 203d 205b  elf._records = [
-000175c0: 785b 315d 2066 6f72 2078 2069 6e20 7265  x[1] for x in re
-000175d0: 636f 7264 735d 0a20 2020 2020 2020 2073  cords].        s
-000175e0: 656c 662e 5f73 686f 775f 7265 636f 7264  elf._show_record
-000175f0: 7328 290a 2020 2020 2020 2020 7365 6c66  s().        self
-00017600: 2e5f 6368 6563 6b5f 6e61 6d65 7328 290a  ._check_names().
-00017610: 0a20 2020 2064 6566 205f 7368 6f77 5f77  .    def _show_w
-00017620: 6861 745f 776f 756c 645f 6265 5f73 6561  hat_would_be_sea
-00017630: 7263 6865 6428 7365 6c66 293a 0a20 2020  rched(self):.   
-00017640: 2020 2020 2061 6e79 203d 2046 616c 7365       any = False
-00017650: 0a20 2020 2020 2020 2066 696e 645f 6874  .        find_ht
-00017660: 6d6c 203d 2066 2253 6561 7263 6820 7275  ml = f"Search ru
-00017670: 6c65 733a 3c75 6c3e 220a 2020 2020 2020  les:<ul>".      
-00017680: 2020 6966 206c 656e 2873 656c 662e 5f63    if len(self._c
-00017690: 7572 7265 6e74 5f70 6f73 5f74 6167 7329  urrent_pos_tags)
-000176a0: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
-000176b0: 2020 616e 7920 3d20 5472 7565 0a20 2020    any = True.   
-000176c0: 2020 2020 2020 2020 2062 6f6c 645f 7461           bold_ta
-000176d0: 6773 203d 205b 6622 3c62 3e7b 7461 677d  gs = [f"<b>{tag}
-000176e0: 3c2f 623e 2220 666f 7220 7461 6720 696e  </b>" for tag in
-000176f0: 2073 656c 662e 5f63 7572 7265 6e74 5f70   self._current_p
-00017700: 6f73 5f74 6167 735d 0a20 2020 2020 2020  os_tags].       
-00017710: 2020 2020 2066 696e 645f 6874 6d6c 202b       find_html +
-00017720: 3d20 223c 6c69 3e49 6e63 6c75 6469 6e67  = "<li>Including
-00017730: 2074 6167 2220 2b20 280a 2020 2020 2020   tag" + (.      
-00017740: 2020 2020 2020 2020 2020 2273 2220 6966            "s" if
-00017750: 206c 656e 2873 656c 662e 5f63 7572 7265   len(self._curre
-00017760: 6e74 5f70 6f73 5f74 6167 7329 203e 2031  nt_pos_tags) > 1
-00017770: 2065 6c73 6520 2222 0a20 2020 2020 2020   else "".       
-00017780: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00017790: 2020 2066 696e 645f 6874 6d6c 202b 3d20     find_html += 
-000177a0: 2220 2220 2b20 222c 2022 2e6a 6f69 6e28  " " + ", ".join(
-000177b0: 626f 6c64 5f74 6167 7329 202b 2022 3c2f  bold_tags) + "</
-000177c0: 6c69 3e22 0a20 2020 2020 2020 2069 6620  li>".        if 
-000177d0: 6c65 6e28 7365 6c66 2e5f 6375 7272 656e  len(self._curren
-000177e0: 745f 6e65 675f 7461 6773 2920 3e20 303a  t_neg_tags) > 0:
-000177f0: 0a20 2020 2020 2020 2020 2020 2061 6e79  .            any
-00017800: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-00017810: 2020 2020 626f 6c64 5f74 6167 7320 3d20      bold_tags = 
-00017820: 5b66 223c 623e 7b74 6167 7d3c 2f62 3e22  [f"<b>{tag}</b>"
-00017830: 2066 6f72 2074 6167 2069 6e20 7365 6c66   for tag in self
-00017840: 2e5f 6375 7272 656e 745f 6e65 675f 7461  ._current_neg_ta
-00017850: 6773 5d0a 2020 2020 2020 2020 2020 2020  gs].            
-00017860: 6669 6e64 5f68 746d 6c20 2b3d 2022 3c6c  find_html += "<l
-00017870: 693e 4578 636c 7564 696e 6720 7461 6722  i>Excluding tag"
-00017880: 202b 2028 0a20 2020 2020 2020 2020 2020   + (.           
-00017890: 2020 2020 2022 7322 2069 6620 6c65 6e28       "s" if len(
-000178a0: 7365 6c66 2e5f 6375 7272 656e 745f 6e65  self._current_ne
-000178b0: 675f 7461 6773 2920 3e20 3120 656c 7365  g_tags) > 1 else
-000178c0: 2022 220a 2020 2020 2020 2020 2020 2020   "".            
-000178d0: 290a 2020 2020 2020 2020 2020 2020 6669  ).            fi
-000178e0: 6e64 5f68 746d 6c20 2b3d 2022 2022 202b  nd_html += " " +
-000178f0: 2022 2c20 222e 6a6f 696e 2862 6f6c 645f   ", ".join(bold_
-00017900: 7461 6773 2920 2b20 223c 2f6c 693e 220a  tags) + "</li>".
-00017910: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
-00017920: 656c 662e 5f63 7572 7265 6e74 5f70 6f73  elf._current_pos
-00017930: 5f77 6f72 6473 2920 3e20 303a 0a20 2020  _words) > 0:.   
-00017940: 2020 2020 2020 2020 2061 6e79 203d 2054           any = T
-00017950: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-00017960: 6974 616c 6963 5f77 6f72 6473 203d 205b  italic_words = [
-00017970: 6622 3c69 3e27 7b77 6f72 647d 273c 2f69  f"<i>'{word}'</i
-00017980: 3e22 2066 6f72 2077 6f72 6420 696e 2073  >" for word in s
-00017990: 656c 662e 5f63 7572 7265 6e74 5f70 6f73  elf._current_pos
-000179a0: 5f77 6f72 6473 5d0a 2020 2020 2020 2020  _words].        
-000179b0: 2020 2020 6669 6e64 5f68 746d 6c20 2b3d      find_html +=
-000179c0: 2022 203c 6c69 3e49 6e63 6c75 6469 6e67   " <li>Including
-000179d0: 2077 6f72 6422 202b 2028 0a20 2020 2020   word" + (.     
-000179e0: 2020 2020 2020 2020 2020 2022 7322 2069             "s" i
-000179f0: 6620 6c65 6e28 7365 6c66 2e5f 6375 7272  f len(self._curr
-00017a00: 656e 745f 706f 735f 776f 7264 7329 203e  ent_pos_words) >
-00017a10: 2031 2065 6c73 6520 2222 0a20 2020 2020   1 else "".     
-00017a20: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00017a30: 2020 2020 2066 696e 645f 6874 6d6c 202b       find_html +
-00017a40: 3d20 2220 2220 2b20 222c 2022 2e6a 6f69  = " " + ", ".joi
-00017a50: 6e28 6974 616c 6963 5f77 6f72 6473 2920  n(italic_words) 
-00017a60: 2b20 223c 2f6c 693e 220a 2020 2020 2020  + "</li>".      
-00017a70: 2020 6966 206c 656e 2873 656c 662e 5f63    if len(self._c
-00017a80: 7572 7265 6e74 5f6e 6567 5f77 6f72 6473  urrent_neg_words
-00017a90: 2920 3e20 303a 0a20 2020 2020 2020 2020  ) > 0:.         
-00017aa0: 2020 2061 6e79 203d 2054 7275 650a 2020     any = True.  
-00017ab0: 2020 2020 2020 2020 2020 6974 616c 6963            italic
-00017ac0: 5f77 6f72 6473 203d 205b 6622 3c69 3e27  _words = [f"<i>'
-00017ad0: 7b77 6f72 647d 273c 2f69 3e22 2066 6f72  {word}'</i>" for
-00017ae0: 2077 6f72 6420 696e 2073 656c 662e 5f63   word in self._c
-00017af0: 7572 7265 6e74 5f6e 6567 5f77 6f72 6473  urrent_neg_words
-00017b00: 5d0a 2020 2020 2020 2020 2020 2020 6669  ].            fi
-00017b10: 6e64 5f68 746d 6c20 2b3d 2022 203c 6c69  nd_html += " <li
-00017b20: 3e45 7863 6c75 6469 6e67 2077 6f72 6422  >Excluding word"
-00017b30: 202b 2028 0a20 2020 2020 2020 2020 2020   + (.           
-00017b40: 2020 2020 2022 7322 2069 6620 6c65 6e28       "s" if len(
-00017b50: 7365 6c66 2e5f 6375 7272 656e 745f 6e65  self._current_ne
-00017b60: 675f 776f 7264 7329 203e 2031 2065 6c73  g_words) > 1 els
-00017b70: 6520 2222 0a20 2020 2020 2020 2020 2020  e "".           
-00017b80: 2029 0a20 2020 2020 2020 2020 2020 2066   ).            f
-00017b90: 696e 645f 6874 6d6c 202b 3d20 2220 2220  ind_html += " " 
-00017ba0: 2b20 222c 2022 2e6a 6f69 6e28 6974 616c  + ", ".join(ital
-00017bb0: 6963 5f77 6f72 6473 2920 2b20 223c 2f6c  ic_words) + "</l
-00017bc0: 693e 220a 2020 2020 2020 2020 6669 6e64  i>".        find
-00017bd0: 5f68 746d 6c20 2b3d 2022 3c2f 756c 3e22  _html += "</ul>"
-00017be0: 0a20 2020 2020 2020 2073 656c 662e 5f69  .        self._i
-00017bf0: 6e66 6f5f 6469 762e 696e 6e65 7248 544d  nfo_div.innerHTM
-00017c00: 4c20 3d20 6669 6e64 5f68 746d 6c20 6966  L = find_html if
-00017c10: 2061 6e79 2065 6c73 6520 2222 0a0a 2020   any else ""..  
-00017c20: 2020 6465 6620 5f73 686f 775f 7265 636f    def _show_reco
-00017c30: 7264 7328 7365 6c66 293a 0a20 2020 2020  rds(self):.     
-00017c40: 2020 206c 696e 6573 203d 205b 6622 466f     lines = [f"Fo
-00017c50: 756e 6420 7b73 656c 662e 5f72 6563 6f72  und {self._recor
-00017c60: 6473 2e6c 656e 6774 687d 2072 6563 6f72  ds.length} recor
-00017c70: 6473 3a3c 6272 3e22 5d0a 2020 2020 2020  ds:<br>"].      
-00017c80: 2020 666f 7220 6b65 7920 696e 2073 656c    for key in sel
-00017c90: 662e 5f72 6563 6f72 6473 3a0a 2020 2020  f._records:.    
-00017ca0: 2020 2020 2020 2020 7265 636f 7264 203d          record =
-00017cb0: 2077 696e 646f 772e 7374 6f72 652e 7265   window.store.re
-00017cc0: 636f 7264 732e 6765 745f 6279 5f6b 6579  cords.get_by_key
-00017cd0: 286b 6579 290a 2020 2020 2020 2020 2020  (key).          
-00017ce0: 2020 6473 203d 2072 6563 6f72 642e 6473    ds = record.ds
-00017cf0: 206f 7220 2222 0a20 2020 2020 2020 2020   or "".         
-00017d00: 2020 2064 6174 6520 3d20 6474 2e74 696d     date = dt.tim
-00017d10: 6532 7374 7228 7265 636f 7264 2e74 3129  e2str(record.t1)
-00017d20: 2e73 706c 6974 2822 5422 295b 305d 0a20  .split("T")[0]. 
-00017d30: 2020 2020 2020 2020 2020 206c 696e 6573             lines
-00017d40: 2e61 7070 656e 6428 0a20 2020 2020 2020  .append(.       
-00017d50: 2020 2020 2020 2020 2066 2222 220a 2020           f""".  
-00017d60: 2020 2020 2020 2020 2020 2020 2020 3c61                <a
-00017d70: 2068 7265 663d 2723 6461 7465 3d7b 6461   href='#date={da
-00017d80: 7465 7d27 0a20 2020 2020 2020 2020 2020  te}'.           
-00017d90: 2020 2020 2020 2020 2073 7479 6c65 3d27           style='
-00017da0: 6375 7273 6f72 3a20 706f 696e 7465 723b  cursor: pointer;
-00017db0: 273e 0a20 2020 2020 2020 2020 2020 2020  '>.             
-00017dc0: 2020 2020 2020 203c 7370 616e 3e7b 6461         <span>{da
-00017dd0: 7465 7d3c 2f73 7061 6e3e 0a20 2020 2020  te}</span>.     
-00017de0: 2020 2020 2020 2020 2020 203c 2f61 3e26             </a>&
-00017df0: 6e62 7370 3b26 6e62 7370 3b0a 2020 2020  nbsp;&nbsp;.    
-00017e00: 2020 2020 2020 2020 2020 2020 3c61 206f              <a o
-00017e10: 6e63 6c69 636b 3d27 7769 6e64 6f77 2e5f  nclick='window._
-00017e20: 7365 6172 6368 5f64 6961 6c6f 675f 6f70  search_dialog_op
-00017e30: 656e 5f72 6563 6f72 6428 227b 6b65 797d  en_record("{key}
-00017e40: 2229 270a 2020 2020 2020 2020 2020 2020  ")'.            
-00017e50: 2020 2020 2020 2020 7374 796c 653d 2763          style='c
-00017e60: 7572 736f 723a 2070 6f69 6e74 6572 3b27  ursor: pointer;'
-00017e70: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
-00017e80: 2020 2020 2020 3c69 2063 6c61 7373 3d27        <i class='
-00017e90: 6661 7327 3e5c 7566 3638 323c 2f69 3e0a  fas'>\uf682</i>.
-00017ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017eb0: 2020 2020 3c73 7061 6e3e 7b64 737d 3c2f      <span>{ds}</
-00017ec0: 7370 616e 3e0a 2020 2020 2020 2020 2020  span>.          
-00017ed0: 2020 2020 2020 3c2f 613e 0a20 2020 2020        </a>.     
-00017ee0: 2020 2020 2020 2020 2020 2022 2222 0a20             """. 
-00017ef0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00017f00: 2020 2020 2073 656c 662e 5f72 6563 6f72       self._recor
-00017f10: 6473 5f6e 6f64 652e 696e 6e65 7248 544d  ds_node.innerHTM
-00017f20: 4c20 3d20 223c 6272 202f 3e5c 6e22 2e6a  L = "<br />\n".j
-00017f30: 6f69 6e28 6c69 6e65 7329 0a0a 2020 2020  oin(lines)..    
-00017f40: 6465 6620 5f6f 7065 6e5f 7265 636f 7264  def _open_record
-00017f50: 2873 656c 662c 206b 6579 293a 0a20 2020  (self, key):.   
-00017f60: 2020 2020 2072 6563 6f72 6420 3d20 7769       record = wi
-00017f70: 6e64 6f77 2e73 746f 7265 2e72 6563 6f72  ndow.store.recor
-00017f80: 6473 2e67 6574 5f62 795f 6b65 7928 6b65  ds.get_by_key(ke
-00017f90: 7929 0a20 2020 2020 2020 2073 656c 662e  y).        self.
-00017fa0: 5f63 616e 7661 732e 7265 636f 7264 5f64  _canvas.record_d
-00017fb0: 6961 6c6f 672e 6f70 656e 2822 4564 6974  ialog.open("Edit
-00017fc0: 222c 2072 6563 6f72 642c 2073 656c 662e  ", record, self.
-00017fd0: 5f73 686f 775f 7265 636f 7264 7329 0a0a  _show_records)..
-00017fe0: 2020 2020 6465 6620 5f6f 7065 6e5f 7461      def _open_ta
-00017ff0: 675f 6469 616c 6f67 2873 656c 6629 3a0a  g_dialog(self):.
-00018000: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
-00018010: 656c 662e 5f63 7572 7265 6e74 5f70 6f73  elf._current_pos
-00018020: 5f74 6167 7329 203d 3d20 313a 0a20 2020  _tags) == 1:.   
-00018030: 2020 2020 2020 2020 2074 6167 7a20 3d20           tagz = 
-00018040: 7365 6c66 2e5f 6375 7272 656e 745f 706f  self._current_po
-00018050: 735f 7461 6773 5b30 5d0a 2020 2020 2020  s_tags[0].      
-00018060: 2020 2020 2020 7365 6c66 2e5f 6361 6e76        self._canv
-00018070: 6173 2e74 6167 5f64 6961 6c6f 672e 6f70  as.tag_dialog.op
-00018080: 656e 2874 6167 7a2c 2073 656c 662e 5f73  en(tagz, self._s
-00018090: 686f 775f 7265 636f 7264 7329 0a20 2020  how_records).   
-000180a0: 2020 2020 2065 6c69 6620 6c65 6e28 7365       elif len(se
-000180b0: 6c66 2e5f 6375 7272 656e 745f 706f 735f  lf._current_pos_
-000180c0: 7461 6773 2920 3e20 313a 0a20 2020 2020  tags) > 1:.     
-000180d0: 2020 2020 2020 2074 6167 7a20 3d20 2220         tagz = " 
-000180e0: 222e 6a6f 696e 2873 656c 662e 5f63 7572  ".join(self._cur
-000180f0: 7265 6e74 5f70 6f73 5f74 6167 7329 0a20  rent_pos_tags). 
-00018100: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00018110: 5f63 616e 7661 732e 7461 675f 636f 6d62  _canvas.tag_comb
-00018120: 6f5f 6469 616c 6f67 2e6f 7065 6e28 7461  o_dialog.open(ta
-00018130: 677a 2c20 7365 6c66 2e5f 7368 6f77 5f72  gz, self._show_r
-00018140: 6563 6f72 6473 290a 0a0a 636c 6173 7320  ecords)...class 
-00018150: 5265 706f 7274 4469 616c 6f67 2842 6173  ReportDialog(Bas
-00018160: 6544 6961 6c6f 6729 3a0a 2020 2020 2222  eDialog):.    ""
-00018170: 2241 2064 6961 6c6f 6720 7468 6174 2073  "A dialog that s
-00018180: 686f 7773 2061 2072 6570 6f72 7420 6f66  hows a report of
-00018190: 2072 6563 6f72 6473 2c20 616e 6420 616c   records, and al
-000181a0: 6c6f 7773 2065 7870 6f72 7469 6e67 2e22  lows exporting."
-000181b0: 2222 0a0a 2020 2020 6465 6620 6f70 656e  ""..    def open
-000181c0: 2873 656c 662c 2074 313d 4e6f 6e65 2c20  (self, t1=None, 
-000181d0: 7432 3d4e 6f6e 652c 2074 6167 733d 4e6f  t2=None, tags=No
-000181e0: 6e65 293a 0a20 2020 2020 2020 2022 2222  ne):.        """
-000181f0: 5368 6f77 2f6f 7065 6e20 7468 6520 6469  Show/open the di
-00018200: 616c 6f67 202e 2222 220a 0a20 2020 2020  alog ."""..     
-00018210: 2020 2069 6620 7431 2069 7320 4e6f 6e65     if t1 is None
-00018220: 206f 7220 7432 2069 7320 4e6f 6e65 3a0a   or t2 is None:.
-00018230: 2020 2020 2020 2020 2020 2020 7431 2c20              t1, 
-00018240: 7432 203d 2073 656c 662e 5f63 616e 7661  t2 = self._canva
-00018250: 732e 7261 6e67 652e 6765 745f 7461 7267  s.range.get_targ
-00018260: 6574 5f72 616e 6765 2829 0a20 2020 2020  et_range().     
-00018270: 2020 2069 6620 7461 6773 2069 7320 4e6f     if tags is No
-00018280: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00018290: 7461 6773 203d 2073 656c 662e 5f63 616e  tags = self._can
-000182a0: 7661 732e 7769 6467 6574 732e 416e 616c  vas.widgets.Anal
-000182b0: 7974 6963 7357 6964 6765 742e 7365 6c65  yticsWidget.sele
-000182c0: 6374 6564 5f74 6167 730a 0a20 2020 2020  cted_tags..     
-000182d0: 2020 2073 656c 662e 5f74 6167 7320 3d20     self._tags = 
-000182e0: 7461 6773 206f 7220 5b5d 0a0a 2020 2020  tags or []..    
-000182f0: 2020 2020 2320 5472 616e 7366 6f72 6d20      # Transform 
-00018300: 7469 6d65 2069 6e74 2074 6f20 6461 7465  time int to date
-00018310: 732e 0a20 2020 2020 2020 2074 315f 6461  s..        t1_da
-00018320: 7465 203d 2064 742e 7469 6d65 326c 6f63  te = dt.time2loc
-00018330: 616c 7374 7228 6474 2e72 6f75 6e64 2874  alstr(dt.round(t
-00018340: 312c 2022 3144 2229 292e 7370 6c69 7428  1, "1D")).split(
-00018350: 2220 2229 5b30 5d0a 2020 2020 2020 2020  " ")[0].        
-00018360: 7432 5f64 6174 6520 3d20 6474 2e74 696d  t2_date = dt.tim
-00018370: 6532 6c6f 6361 6c73 7472 2864 742e 726f  e2localstr(dt.ro
-00018380: 756e 6428 7432 2c20 2231 4422 2929 2e73  und(t2, "1D")).s
-00018390: 706c 6974 2822 2022 295b 305d 0a20 2020  plit(" ")[0].   
-000183a0: 2020 2020 2069 6620 7431 5f64 6174 6520       if t1_date 
-000183b0: 213d 2074 325f 6461 7465 3a0a 2020 2020  != t2_date:.    
-000183c0: 2020 2020 2020 2020 2320 5468 6520 6461          # The da
-000183d0: 7465 2072 616e 6765 2069 7320 696e 636c  te range is incl
-000183e0: 7573 6976 6520 2861 6e64 2077 6520 6164  usive (and we ad
-000183f0: 6420 3144 206c 6174 6572 293a 206d 6f76  d 1D later): mov
-00018400: 6520 6261 636b 206f 6e65 2064 6179 0a20  e back one day. 
-00018410: 2020 2020 2020 2020 2020 2074 325f 6461             t2_da
-00018420: 7465 203d 2064 742e 7469 6d65 326c 6f63  te = dt.time2loc
-00018430: 616c 7374 7228 6474 2e61 6464 2864 742e  alstr(dt.add(dt.
-00018440: 726f 756e 6428 7432 2c20 2231 4422 292c  round(t2, "1D"),
-00018450: 2022 2d31 4422 2929 2e73 706c 6974 2822   "-1D")).split("
-00018460: 2022 295b 305d 0a20 2020 2020 2020 2073   ")[0].        s
-00018470: 656c 662e 5f74 315f 6461 7465 203d 2074  elf._t1_date = t
-00018480: 315f 6461 7465 0a20 2020 2020 2020 2073  1_date.        s
-00018490: 656c 662e 5f74 325f 6461 7465 203d 2074  elf._t2_date = t
-000184a0: 325f 6461 7465 0a0a 2020 2020 2020 2020  2_date..        
-000184b0: 2320 4765 6e65 7261 7465 2070 7265 616d  # Generate pream
-000184c0: 626c 650a 2020 2020 2020 2020 6966 2073  ble.        if s
-000184d0: 656c 662e 5f74 6167 733a 0a20 2020 2020  elf._tags:.     
-000184e0: 2020 2020 2020 2066 696c 7465 7274 6578         filtertex
-000184f0: 7420 3d20 7365 6c66 2e5f 7461 6773 2e6a  t = self._tags.j
-00018500: 6f69 6e28 2220 2229 0a20 2020 2020 2020  oin(" ").       
-00018510: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00018520: 2020 2066 696c 7465 7274 6578 7420 3d20     filtertext = 
-00018530: 223c 736d 616c 6c3e 5365 6c65 6374 2074  "<small>Select t
-00018540: 6167 7320 696e 206f 7665 7276 6965 7720  ags in overview 
-00018550: 7061 6e65 6c3c 2f73 6d61 6c6c 3e22 0a20  panel</small>". 
-00018560: 2020 2020 2020 2073 656c 662e 5f63 6f70         self._cop
-00018570: 7962 7574 7465 7874 203d 2022 436f 7079  ybuttext = "Copy
-00018580: 2074 6162 6c65 220a 2020 2020 2020 2020   table".        
-00018590: 6874 6d6c 203d 2066 2222 220a 2020 2020  html = f""".    
-000185a0: 2020 2020 2020 2020 3c68 313e 3c69 2063          <h1><i c
-000185b0: 6c61 7373 3d27 6661 7327 3e5c 7566 3135  lass='fas'>\uf15
-000185c0: 633c 2f69 3e26 6e62 7370 3b26 6e62 7370  c</i>&nbsp;&nbsp
-000185d0: 3b52 6570 6f72 740a 2020 2020 2020 2020  ;Report.        
-000185e0: 2020 2020 2020 2020 3c62 7574 746f 6e20          <button 
-000185f0: 7479 7065 3d27 6275 7474 6f6e 273e 3c69  type='button'><i
-00018600: 2063 6c61 7373 3d27 6661 7327 3e5c 7566   class='fas'>\uf
-00018610: 3030 643c 2f69 3e3c 2f62 7574 746f 6e3e  00d</i></button>
-00018620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018630: 203c 2f68 313e 0a20 2020 2020 2020 2020   </h1>.         
-00018640: 2020 203c 6469 7620 636c 6173 733d 2766     <div class='f
-00018650: 6f72 6d6c 6179 6f75 7427 3e0a 2020 2020  ormlayout'>.    
-00018660: 2020 2020 2020 2020 2020 2020 3c64 6976              <div
-00018670: 3e54 6167 733a 3c2f 6469 763e 203c 6469  >Tags:</div> <di
-00018680: 763e 7b66 696c 7465 7274 6578 747d 3c2f  v>{filtertext}</
-00018690: 6469 763e 0a20 2020 2020 2020 2020 2020  div>.           
-000186a0: 2020 2020 203c 6469 763e 4461 7465 2072       <div>Date r
-000186b0: 616e 6765 3a3c 2f64 6976 3e20 3c64 6976  ange:</div> <div
-000186c0: 2073 7479 6c65 3d27 666f 6e74 2d73 697a   style='font-siz
-000186d0: 653a 736d 616c 6c65 723b 273e 3c2f 6469  e:smaller;'></di
-000186e0: 763e 0a20 2020 2020 2020 2020 2020 2020  v>.             
-000186f0: 2020 203c 6469 763e 4772 6f75 7069 6e67     <div>Grouping
-00018700: 3a3c 2f64 6976 3e20 3c73 656c 6563 743e  :</div> <select>
-00018710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018730: 2020 2020 2020 2020 203c 6f70 7469 6f6e           <option
-00018740: 2076 616c 7565 3d27 6e6f 6e65 273e 6e6f   value='none'>no
-00018750: 6e65 3c2f 6f70 7469 6f6e 3e0a 2020 2020  ne</option>.    
-00018760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018780: 2020 2020 3c6f 7074 696f 6e20 7661 6c75      <option valu
-00018790: 653d 2774 6167 7a27 3e74 6167 733c 2f6f  e='tagz'>tags</o
-000187a0: 7074 696f 6e3e 0a20 2020 2020 2020 2020  ption>.         
-000187b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000187c0: 2020 2020 2020 2020 2020 2020 2020 203c                 <
-000187d0: 6f70 7469 6f6e 2076 616c 7565 3d27 6473  option value='ds
-000187e0: 273e 6465 7363 7269 7074 696f 6e3c 2f6f  '>description</o
-000187f0: 7074 696f 6e3e 0a20 2020 2020 2020 2020  ption>.         
-00018800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018810: 2020 2020 2020 2020 2020 2020 3c2f 7365              </se
-00018820: 6c65 6374 3e0a 2020 2020 2020 2020 2020  lect>.          
-00018830: 2020 2020 2020 3c64 6976 3e47 726f 7570        <div>Group
-00018840: 2062 7920 7065 7269 6f64 3a3c 2f64 6976   by period:</div
-00018850: 3e20 3c73 656c 6563 743e 0a20 2020 2020  > <select>.     
-00018860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018880: 2020 203c 6f70 7469 6f6e 2076 616c 7565     <option value
-00018890: 3d27 6e6f 6e65 273e 6e6f 6e65 3c2f 6f70  ='none'>none</op
-000188a0: 7469 6f6e 3e0a 2020 2020 2020 2020 2020  tion>.          
-000188b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000188c0: 2020 2020 2020 2020 2020 2020 2020 3c6f                <o
-000188d0: 7074 696f 6e20 7661 6c75 653d 2764 6179  ption value='day
-000188e0: 273e 6461 793c 2f6f 7074 696f 6e3e 0a20  '>day</option>. 
-000188f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018910: 2020 2020 2020 203c 6f70 7469 6f6e 2076         <option v
-00018920: 616c 7565 3d27 7765 656b 273e 7765 656b  alue='week'>week
-00018930: 3c2f 6f70 7469 6f6e 3e0a 2020 2020 2020  </option>.      
-00018940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018960: 2020 3c6f 7074 696f 6e20 7661 6c75 653d    <option value=
-00018970: 276d 6f6e 7468 273e 6d6f 6e74 683c 2f6f  'month'>month</o
-00018980: 7074 696f 6e3e 0a20 2020 2020 2020 2020  ption>.         
-00018990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000189a0: 2020 2020 2020 2020 2020 2020 2020 203c                 <
-000189b0: 6f70 7469 6f6e 2076 616c 7565 3d27 7175  option value='qu
-000189c0: 6172 7465 7227 3e71 7561 7274 6572 3c2f  arter'>quarter</
-000189d0: 6f70 7469 6f6e 3e0a 2020 2020 2020 2020  option>.        
-000189e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000189f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018a00: 3c6f 7074 696f 6e20 7661 6c75 653d 2779  <option value='y
-00018a10: 6561 7227 3e79 6561 723c 2f6f 7074 696f  ear'>year</optio
-00018a20: 6e3e 0a20 2020 2020 2020 2020 2020 2020  n>.             
-00018a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018a40: 2020 2020 2020 2020 3c2f 7365 6c65 6374          </select
-00018a50: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
-00018a60: 2020 3c64 6976 3e54 6167 206f 7264 6572    <div>Tag order
-00018a70: 3a3c 2f64 6976 3e20 3c6c 6162 656c 3e3c  :</div> <label><
-00018a80: 696e 7075 7420 7479 7065 3d27 6368 6563  input type='chec
-00018a90: 6b62 6f78 2720 2f3e 2048 6964 6520 7365  kbox' /> Hide se
-00018aa0: 636f 6e64 6172 7920 7461 6773 3c2f 6c61  condary tags</la
-00018ab0: 6265 6c3e 0a20 2020 2020 2020 2020 2020  bel>.           
-00018ac0: 2020 2020 203c 6469 763e 466f 726d 6174       <div>Format
-00018ad0: 3a3c 2f64 6976 3e20 3c6c 6162 656c 3e3c  :</div> <label><
-00018ae0: 696e 7075 7420 7479 7065 3d27 6368 6563  input type='chec
-00018af0: 6b62 6f78 2720 2f3e 2048 6f75 7273 2069  kbox' /> Hours i
-00018b00: 6e20 6465 6369 6d61 6c73 3c2f 6c61 6265  n decimals</labe
-00018b10: 6c3e 0a20 2020 2020 2020 2020 2020 2020  l>.             
-00018b20: 2020 203c 6469 763e 4465 7461 696c 733a     <div>Details:
-00018b30: 3c2f 6469 763e 203c 6c61 6265 6c3e 3c69  </div> <label><i
-00018b40: 6e70 7574 2074 7970 653d 2763 6865 636b  nput type='check
-00018b50: 626f 7827 2063 6865 636b 6564 202f 3e20  box' checked /> 
-00018b60: 5368 6f77 2072 6563 6f72 6473 3c2f 6c61  Show records</la
-00018b70: 6265 6c3e 0a20 2020 2020 2020 2020 2020  bel>.           
-00018b80: 2020 2020 203c 6275 7474 6f6e 2074 7970       <button typ
-00018b90: 653d 2762 7574 746f 6e27 3e3c 6920 636c  e='button'><i cl
-00018ba0: 6173 733d 2766 6173 273e 5c75 6633 3238  ass='fas'>\uf328
-00018bb0: 3c2f 693e 266e 6273 703b 266e 6273 703b  </i>&nbsp;&nbsp;
-00018bc0: 7b73 656c 662e 5f63 6f70 7962 7574 7465  {self._copybutte
-00018bd0: 7874 7d3c 2f62 7574 746f 6e3e 0a20 2020  xt}</button>.   
-00018be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018bf0: 203c 6469 763e 7061 7374 6520 696e 2061   <div>paste in a
-00018c00: 2073 7072 6561 6473 6865 6574 3c2f 6469   spreadsheet</di
-00018c10: 763e 0a20 2020 2020 2020 2020 2020 2020  v>.             
-00018c20: 2020 203c 6275 7474 6f6e 2074 7970 653d     <button type=
-00018c30: 2762 7574 746f 6e27 3e3c 6920 636c 6173  'button'><i clas
-00018c40: 733d 2766 6173 273e 5c75 6630 6365 3c2f  s='fas'>\uf0ce</
-00018c50: 693e 266e 6273 703b 266e 6273 703b 5361  i>&nbsp;&nbsp;Sa
-00018c60: 7665 2043 5356 3c2f 6275 7474 6f6e 3e0a  ve CSV</button>.
+0000b150: 2020 7375 6767 6573 7469 6f6e 732e 7075    suggestions.pu
+0000b160: 7368 2828 6473 2c20 6874 6d6c 2c20 5472  sh((ds, html, Tr
+0000b170: 7565 2929 0a20 2020 2020 2020 2020 2020  ue)).           
+0000b180: 2066 6f72 2064 732c 2064 735f 7432 2069   for ds, ds_t2 i
+0000b190: 6e20 7365 6c66 2e5f 7375 6767 6573 7465  n self._suggeste
+0000b1a0: 645f 6473 5f72 6563 656e 743a 0a20 2020  d_ds_recent:.   
+0000b1b0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+0000b1c0: 6520 3d20 6461 7973 5f61 676f 2864 735f  e = days_ago(ds_
+0000b1d0: 7432 290a 2020 2020 2020 2020 2020 2020  t2).            
+0000b1e0: 2020 2020 6461 7465 203d 207b 303a 2022      date = {0: "
+0000b1f0: 746f 6461 7922 2c20 313a 2022 7965 7374  today", 1: "yest
+0000b200: 6572 6461 7922 7d2e 6765 7428 6461 7465  erday"}.get(date
+0000b210: 2c20 6461 7465 202b 2022 2064 6179 7320  , date + " days 
+0000b220: 6167 6f22 290a 2020 2020 2020 2020 2020  ago").          
+0000b230: 2020 2020 2020 6874 6d6c 203d 2064 7320        html = ds 
+0000b240: 2b20 223c 7370 616e 2063 6c61 7373 3d27  + "<span class='
+0000b250: 6d65 7461 273e 7265 6365 6e74 3a20 2220  meta'>recent: " 
+0000b260: 2b20 6461 7465 202b 2022 3c73 7061 6e3e  + date + "<span>
+0000b270: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0000b280: 2020 7375 6767 6573 7469 6f6e 732e 7075    suggestions.pu
+0000b290: 7368 2828 6473 2c20 6874 6d6c 2c20 5472  sh((ds, html, Tr
+0000b2a0: 7565 2929 0a20 2020 2020 2020 2023 2043  ue)).        # C
+0000b2b0: 6f6c 6c65 6374 2070 7265 7365 7473 0a20  ollect presets. 
+0000b2c0: 2020 2020 2020 2069 6620 2270 7265 7365         if "prese
+0000b2d0: 7473 2220 696e 206b 696e 643a 0a20 2020  ts" in kind:.   
+0000b2e0: 2020 2020 2020 2020 2074 7970 6573 2e70           types.p
+0000b2f0: 7573 6828 2250 7265 7365 7473 2229 0a20  ush("Presets"). 
+0000b300: 2020 2020 2020 2020 2020 2070 7265 7365             prese
+0000b310: 7473 203d 2073 656c 662e 5f67 6574 5f73  ts = self._get_s
+0000b320: 7567 6765 7374 6564 5f74 6167 735f 7072  uggested_tags_pr
+0000b330: 6573 6574 7328 290a 2020 2020 2020 2020  esets().        
+0000b340: 2020 2020 6966 2073 6561 7263 685f 776f      if search_wo
+0000b350: 7264 3a0a 2020 2020 2020 2020 2020 2020  rd:.            
+0000b360: 2020 2020 666f 7220 7072 6573 6574 2069      for preset i
+0000b370: 6e20 7072 6573 6574 733a 0a20 2020 2020  n presets:.     
+0000b380: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000b390: 6620 7365 6172 6368 5f77 6f72 6420 696e  f search_word in
+0000b3a0: 2070 7265 7365 743a 0a20 2020 2020 2020   preset:.       
+0000b3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b3c0: 2068 746d 6c20 3d20 223c 623e 2220 2b20   html = "<b>" + 
+0000b3d0: 7072 6573 6574 202b 2022 3c2f 623e 3c73  preset + "</b><s
+0000b3e0: 7061 6e20 636c 6173 733d 276d 6574 6127  pan class='meta'
+0000b3f0: 3e6d 6174 6368 3c73 7061 6e3e 220a 2020  >match<span>".  
+0000b400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b410: 2020 2020 2020 7375 6767 6573 7469 6f6e        suggestion
+0000b420: 732e 7075 7368 2828 7072 6573 6574 2c20  s.push((preset, 
+0000b430: 6874 6d6c 2c20 5472 7565 2929 0a20 2020  html, True)).   
+0000b440: 2020 2020 2020 2020 2066 6f72 2070 7265           for pre
+0000b450: 7365 7420 696e 2070 7265 7365 7473 3a0a  set in presets:.
+0000b460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b470: 6874 6d6c 203d 2070 7265 7365 7420 2b20  html = preset + 
+0000b480: 223c 7370 616e 2063 6c61 7373 3d27 6d65  "<span class='me
+0000b490: 7461 273e 7072 6573 6574 3c73 7061 6e3e  ta'>preset<span>
+0000b4a0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0000b4b0: 2020 7375 6767 6573 7469 6f6e 732e 7075    suggestions.pu
+0000b4c0: 7368 2828 7072 6573 6574 2c20 6874 6d6c  sh((preset, html
+0000b4d0: 2c20 4661 6c73 6529 290a 2020 2020 2020  , False)).      
+0000b4e0: 2020 2320 436f 6c6c 6563 7420 7461 6773    # Collect tags
+0000b4f0: 0a20 2020 2020 2020 2069 6620 2274 6167  .        if "tag
+0000b500: 7322 2069 6e20 6b69 6e64 3a0a 2020 2020  s" in kind:.    
+0000b510: 2020 2020 2020 2020 7479 7065 732e 7075          types.pu
+0000b520: 7368 2822 5265 6365 6e74 2074 6167 7322  sh("Recent tags"
+0000b530: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0000b540: 2073 6561 7263 685f 776f 7264 3a0a 2020   search_word:.  
+0000b550: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0000b560: 7220 7461 672c 2074 6167 5f74 3220 696e  r tag, tag_t2 in
+0000b570: 2073 656c 662e 5f73 7567 6765 7374 6564   self._suggested
+0000b580: 5f74 6167 735f 7265 6365 6e74 3a0a 2020  _tags_recent:.  
+0000b590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b5a0: 2020 6966 2073 6561 7263 685f 776f 7264    if search_word
+0000b5b0: 2069 6e20 7461 673a 0a20 2020 2020 2020   in tag:.       
+0000b5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b5d0: 2068 746d 6c20 3d20 223c 623e 2220 2b20   html = "<b>" + 
+0000b5e0: 7461 6720 2b20 223c 2f62 3e3c 7370 616e  tag + "</b><span
+0000b5f0: 2063 6c61 7373 3d27 6d65 7461 273e 6d61   class='meta'>ma
+0000b600: 7463 683c 7370 616e 3e22 0a20 2020 2020  tch<span>".     
+0000b610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b620: 2020 2073 7567 6765 7374 696f 6e73 2e70     suggestions.p
+0000b630: 7573 6828 2874 6167 2c20 6874 6d6c 2c20  ush((tag, html, 
+0000b640: 5472 7565 2929 0a20 2020 2020 2020 2020  True)).         
+0000b650: 2020 2066 6f72 2074 6167 2c20 7461 675f     for tag, tag_
+0000b660: 7432 2069 6e20 7365 6c66 2e5f 7375 6767  t2 in self._sugg
+0000b670: 6573 7465 645f 7461 6773 5f72 6563 656e  ested_tags_recen
+0000b680: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+0000b690: 2020 2064 6174 6520 3d20 6461 7973 5f61     date = days_a
+0000b6a0: 676f 2874 6167 5f74 3229 0a20 2020 2020  go(tag_t2).     
+0000b6b0: 2020 2020 2020 2020 2020 2064 6174 6520             date 
+0000b6c0: 3d20 7b30 3a20 2274 6f64 6179 222c 2031  = {0: "today", 1
+0000b6d0: 3a20 2279 6573 7465 7264 6179 227d 2e67  : "yesterday"}.g
+0000b6e0: 6574 2864 6174 652c 2064 6174 6520 2b20  et(date, date + 
+0000b6f0: 2220 6461 7973 2061 676f 2229 0a20 2020  " days ago").   
+0000b700: 2020 2020 2020 2020 2020 2020 2068 746d               htm
+0000b710: 6c20 3d20 7461 6720 2b20 223c 7370 616e  l = tag + "<span
+0000b720: 2063 6c61 7373 3d27 6d65 7461 273e 7265   class='meta'>re
+0000b730: 6365 6e74 3a20 2220 2b20 6461 7465 202b  cent: " + date +
+0000b740: 2022 3c73 7061 6e3e 220a 2020 2020 2020   "<span>".      
+0000b750: 2020 2020 2020 2020 2020 7375 6767 6573            sugges
+0000b760: 7469 6f6e 732e 7075 7368 2828 7461 672c  tions.push((tag,
+0000b770: 2068 746d 6c2c 2046 616c 7365 2929 0a20   html, False)). 
+0000b780: 2020 2020 2020 2023 2053 686f 770a 2020         # Show.  
+0000b790: 2020 2020 2020 6966 206e 6f74 2074 7970        if not typ
+0000b7a0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+0000b7b0: 7365 6c66 2e63 6c65 6172 2829 0a20 2020  self.clear().   
+0000b7c0: 2020 2020 2065 6c69 6620 7375 6767 6573       elif sugges
+0000b7d0: 7469 6f6e 733a 0a20 2020 2020 2020 2020  tions:.         
+0000b7e0: 2020 2073 656c 662e 5f73 7461 7465 203d     self._state =
+0000b7f0: 2073 656c 662e 5f67 6574 5f73 7461 7465   self._get_state
+0000b800: 2829 0a20 2020 2020 2020 2020 2020 2073  ().            s
+0000b810: 656c 662e 5f73 686f 7728 7479 7065 732e  elf._show(types.
+0000b820: 6a6f 696e 2822 2026 2022 2920 2b20 223a  join(" & ") + ":
+0000b830: 222c 2073 7567 6765 7374 696f 6e73 2c20  ", suggestions, 
+0000b840: 4661 6c73 6529 0a20 2020 2020 2020 2065  False).        e
+0000b850: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000b860: 2073 656c 662e 5f73 686f 7728 224e 6f20   self._show("No 
+0000b870: 2220 2b20 7479 7065 732e 6a6f 696e 2822  " + types.join("
+0000b880: 206f 7220 2229 202b 2022 202e 2e2e 222c   or ") + " ...",
+0000b890: 205b 5d2c 2046 616c 7365 290a 0a20 2020   [], False)..   
+0000b8a0: 2064 6566 206f 6e5f 6b65 7928 7365 6c66   def on_key(self
+0000b8b0: 2c20 6529 3a0a 2020 2020 2020 2020 6966  , e):.        if
+0000b8c0: 206e 6f74 2073 656c 662e 5f64 6976 2e68   not self._div.h
+0000b8d0: 6964 6465 6e3a 0a20 2020 2020 2020 2020  idden:.         
+0000b8e0: 2020 206b 6579 203d 2065 2e6b 6579 2e6c     key = e.key.l
+0000b8f0: 6f77 6572 2829 0a20 2020 2020 2020 2020  ower().         
+0000b900: 2020 2069 6620 6b65 7920 3d3d 2022 656e     if key == "en
+0000b910: 7465 7222 206f 7220 6b65 7920 3d3d 2022  ter" or key == "
+0000b920: 7265 7475 726e 2220 6f72 206b 6579 203d  return" or key =
+0000b930: 3d20 2274 6162 223a 0a20 2020 2020 2020  = "tab":.       
+0000b940: 2020 2020 2020 2020 2073 656c 662e 5f66           self._f
+0000b950: 696e 6973 6828 7365 6c66 2e5f 6163 7469  inish(self._acti
+0000b960: 7665 5f73 7567 6765 7374 696f 6e29 0a20  ve_suggestion). 
+0000b970: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000b980: 2e70 7265 7665 6e74 4465 6661 756c 7428  .preventDefault(
+0000b990: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000b9a0: 2020 7265 7475 726e 2054 7275 650a 2020    return True.  
+0000b9b0: 2020 2020 2020 2020 2020 656c 6966 206b            elif k
+0000b9c0: 6579 203d 3d20 2265 7363 6170 6522 3a0a  ey == "escape":.
+0000b9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b9e0: 7365 6c66 2e63 6c65 6172 2829 0a20 2020  self.clear().   
+0000b9f0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000ba00: 7572 6e20 5472 7565 0a20 2020 2020 2020  urn True.       
+0000ba10: 2020 2020 2065 6c69 6620 6b65 7920 3d3d       elif key ==
+0000ba20: 2022 6172 726f 7764 6f77 6e22 3a0a 2020   "arrowdown":.  
+0000ba30: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000ba40: 6c66 2e5f 6d61 6b65 5f61 6374 6976 6528  lf._make_active(
+0000ba50: 7365 6c66 2e5f 696e 6465 7820 2b20 3129  self._index + 1)
+0000ba60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ba70: 2065 2e70 7265 7665 6e74 4465 6661 756c   e.preventDefaul
+0000ba80: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
+0000ba90: 2020 2020 7265 7475 726e 2054 7275 650a      return True.
+0000baa0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+0000bab0: 206b 6579 203d 3d20 2261 7272 6f77 7570   key == "arrowup
+0000bac0: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+0000bad0: 2020 2073 656c 662e 5f6d 616b 655f 6163     self._make_ac
+0000bae0: 7469 7665 2873 656c 662e 5f69 6e64 6578  tive(self._index
+0000baf0: 202d 2031 290a 2020 2020 2020 2020 2020   - 1).          
+0000bb00: 2020 2020 2020 652e 7072 6576 656e 7444        e.preventD
+0000bb10: 6566 6175 6c74 2829 0a20 2020 2020 2020  efault().       
+0000bb20: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000bb30: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+0000bb40: 2065 6c69 6620 6b65 7920 3d3d 2022 2322   elif key == "#"
+0000bb50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000bb60: 2020 2320 546f 6767 6c65 2062 6574 7765    # Toggle betwe
+0000bb70: 656e 2070 7265 7365 742f 7461 6773 2062  en preset/tags b
+0000bb80: 7920 696e 7365 7274 696e 672f 7265 6d6f  y inserting/remo
+0000bb90: 7669 6e67 2061 2027 2327 0a20 2020 2020  ving a '#'.     
+0000bba0: 2020 2020 2020 2020 2020 2076 616c 2c20             val, 
+0000bbb0: 6931 2c20 6932 203d 2073 656c 662e 5f73  i1, i2 = self._s
+0000bbc0: 7461 7465 0a20 2020 2020 2020 2020 2020  tate.           
+0000bbd0: 2020 2020 2069 6620 6932 203e 2069 313a       if i2 > i1:
+0000bbe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bbf0: 2020 2020 2069 735f 646f 7562 6c65 203d       is_double =
+0000bc00: 2069 3120 3e20 3020 616e 6420 7661 6c5b   i1 > 0 and val[
+0000bc10: 6931 202d 2031 5d20 3d3d 2022 2322 0a20  i1 - 1] == "#". 
+0000bc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc30: 2020 2069 6620 2873 656c 662e 5f6d 6f64     if (self._mod
+0000bc40: 655f 6d61 736b 2026 2034 2920 3d3d 2030  e_mask & 4) == 0
+0000bc50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000bc60: 2020 2020 2020 2020 2020 6966 2069 735f            if is_
+0000bc70: 646f 7562 6c65 3a0a 2020 2020 2020 2020  double:.        
+0000bc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc90: 2020 2020 6e65 775f 7661 6c20 3d20 7661      new_val = va
+0000bca0: 6c5b 3a69 315d 202b 2076 616c 5b69 3120  l[:i1] + val[i1 
+0000bcb0: 2b20 3120 3a5d 0a20 2020 2020 2020 2020  + 1 :].         
+0000bcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bcd0: 2020 206e 6577 5f69 203d 2069 3220 2d20     new_i = i2 - 
+0000bce0: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+0000bcf0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000bd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd10: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+0000bd20: 7661 6c20 3d20 7661 6c0a 2020 2020 2020  val = val.      
+0000bd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd40: 2020 2020 2020 6e65 775f 6920 3d20 6932        new_i = i2
+0000bd50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bd60: 2020 2020 2065 6c69 6620 6973 5f64 6f75       elif is_dou
+0000bd70: 626c 653a 0a20 2020 2020 2020 2020 2020  ble:.           
+0000bd80: 2020 2020 2020 2020 2020 2020 206e 6577               new
+0000bd90: 5f76 616c 203d 2076 616c 5b3a 6931 5d20  _val = val[:i1] 
+0000bda0: 2b20 7661 6c5b 6931 202b 2031 203a 5d0a  + val[i1 + 1 :].
+0000bdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bdc0: 2020 2020 2020 2020 6e65 775f 6920 3d20          new_i = 
+0000bdd0: 6932 202d 2031 0a20 2020 2020 2020 2020  i2 - 1.         
+0000bde0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0000bdf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000be00: 2020 2020 2020 2020 206e 6577 5f76 616c           new_val
+0000be10: 203d 2076 616c 5b3a 6931 5d20 2b20 2223   = val[:i1] + "#
+0000be20: 2220 2b20 7661 6c5b 6931 3a5d 0a20 2020  " + val[i1:].   
+0000be30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000be40: 2020 2020 206e 6577 5f69 203d 2069 3220       new_i = i2 
+0000be50: 2b20 310a 2020 2020 2020 2020 2020 2020  + 1.            
+0000be60: 2020 2020 2020 2020 7365 6c66 2e5f 696e          self._in
+0000be70: 7075 742e 7661 6c75 6520 3d20 6e65 775f  put.value = new_
+0000be80: 7661 6c0a 2020 2020 2020 2020 2020 2020  val.            
+0000be90: 2020 2020 2020 2020 7365 6c66 2e5f 696e          self._in
+0000bea0: 7075 742e 7365 6c65 6374 696f 6e53 7461  put.selectionSta
+0000beb0: 7274 203d 2073 656c 662e 5f69 6e70 7574  rt = self._input
+0000bec0: 2e73 656c 6563 7469 6f6e 456e 6420 3d20  .selectionEnd = 
+0000bed0: 6e65 775f 690a 2020 2020 2020 2020 2020  new_i.          
+0000bee0: 2020 2020 2020 2020 2020 652e 7072 6576            e.prev
+0000bef0: 656e 7444 6566 6175 6c74 2829 0a20 2020  entDefault().   
+0000bf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf10: 2073 656c 662e 696e 6974 2829 0a20 2020   self.init().   
+0000bf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf30: 2072 6574 7572 6e20 5472 7565 0a0a 2020   return True..  
+0000bf40: 2020 6465 6620 6861 735f 7265 6365 6e74    def has_recent
+0000bf50: 5f74 6167 7328 7365 6c66 293a 0a20 2020  _tags(self):.   
+0000bf60: 2020 2020 2072 6574 7572 6e20 6c65 6e28       return len(
+0000bf70: 7365 6c66 2e5f 7375 6767 6573 7465 645f  self._suggested_
+0000bf80: 7461 6773 5f72 6563 656e 7429 203e 2030  tags_recent) > 0
+0000bf90: 0a0a 2020 2020 6465 6620 5f73 686f 7728  ..    def _show(
+0000bfa0: 7365 6c66 2c20 6865 6164 6c69 6e65 2c20  self, headline, 
+0000bfb0: 7375 6767 6573 7469 6f6e 732c 2073 686f  suggestions, sho
+0000bfc0: 775f 746f 6767 6c65 3d54 7275 6529 3a0a  w_toggle=True):.
+0000bfd0: 2020 2020 2020 2020 7365 6c66 2e63 6c65          self.cle
+0000bfe0: 6172 2829 0a20 2020 2020 2020 2023 2041  ar().        # A
+0000bff0: 6464 2074 6974 6c65 0a20 2020 2020 2020  dd title.       
+0000c000: 2068 696e 745f 6874 6d6c 203d 2022 220a   hint_html = "".
+0000c010: 2020 2020 2020 2020 6966 2073 686f 775f          if show_
+0000c020: 746f 6767 6c65 2061 6e64 2073 656c 662e  toggle and self.
+0000c030: 5f6d 6f64 655f 6d61 736b 2026 2033 2061  _mode_mask & 3 a
+0000c040: 6e64 2073 656c 662e 5f6d 6f64 655f 6d61  nd self._mode_ma
+0000c050: 736b 2026 2034 3a0a 2020 2020 2020 2020  sk & 4:.        
+0000c060: 2020 2020 6869 6e74 203d 2022 2874 7970      hint = "(typ
+0000c070: 6520 2723 2720 6167 6169 6e20 746f 2074  e '#' again to t
+0000c080: 6f67 676c 6520 7461 6773 202f 2070 7265  oggle tags / pre
+0000c090: 7365 7473 2922 0a20 2020 2020 2020 2020  sets)".         
+0000c0a0: 2020 2068 696e 745f 6874 6d6c 203d 2022     hint_html = "
+0000c0b0: 3c73 7061 6e20 7374 796c 653d 2763 6f6c  <span style='col
+0000c0c0: 6f72 3a23 3939 393b 273e 2220 2b20 6869  or:#999;'>" + hi
+0000c0d0: 6e74 202b 2022 3c2f 7370 616e 3e22 0a20  nt + "</span>". 
+0000c0e0: 2020 2020 2020 2069 7465 6d20 3d20 646f         item = do
+0000c0f0: 6375 6d65 6e74 2e63 7265 6174 6545 6c65  cument.createEle
+0000c100: 6d65 6e74 2822 6469 7622 290a 2020 2020  ment("div").    
+0000c110: 2020 2020 6974 656d 2e63 6c61 7373 4c69      item.classLi
+0000c120: 7374 2e61 6464 2822 6d65 7461 2229 0a20  st.add("meta"). 
+0000c130: 2020 2020 2020 2069 7465 6d2e 696e 6e65         item.inne
+0000c140: 7248 544d 4c20 3d20 6865 6164 6c69 6e65  rHTML = headline
+0000c150: 202b 2022 2026 6e62 7370 3b26 6e62 7370   + " &nbsp;&nbsp
+0000c160: 3b26 6e62 7370 3b22 202b 2068 696e 745f  ;&nbsp;" + hint_
+0000c170: 6874 6d6c 0a20 2020 2020 2020 2073 656c  html.        sel
+0000c180: 662e 5f64 6976 2e61 7070 656e 6443 6869  f._div.appendChi
+0000c190: 6c64 2869 7465 6d29 0a20 2020 2020 2020  ld(item).       
+0000c1a0: 2023 2041 6464 2073 7567 6765 7374 696f   # Add suggestio
+0000c1b0: 6e73 0a20 2020 2020 2020 2073 656c 662e  ns.        self.
+0000c1c0: 5f73 7567 6765 7374 6564 5f74 6167 735f  _suggested_tags_
+0000c1d0: 696e 5f61 7574 6f63 6f6d 7020 3d20 5b5d  in_autocomp = []
+0000c1e0: 0a20 2020 2020 2020 2066 6f72 2074 6578  .        for tex
+0000c1f0: 742c 2068 746d 6c2c 2073 656c 6563 745f  t, html, select_
+0000c200: 646f 6573 5f72 6570 6c61 6365 2069 6e20  does_replace in 
+0000c210: 7375 6767 6573 7469 6f6e 733a 2020 2320  suggestions:  # 
+0000c220: 7465 7874 2069 7320 6120 7461 6720 6f72  text is a tag or
+0000c230: 2061 2070 7265 7365 740a 2020 2020 2020   a preset.      
+0000c240: 2020 2020 2020 7365 6c66 2e5f 7375 6767        self._sugg
+0000c250: 6573 7465 645f 7461 6773 5f69 6e5f 6175  ested_tags_in_au
+0000c260: 746f 636f 6d70 2e70 7573 6828 2874 6578  tocomp.push((tex
+0000c270: 742c 2073 656c 6563 745f 646f 6573 5f72  t, select_does_r
+0000c280: 6570 6c61 6365 2929 0a20 2020 2020 2020  eplace)).       
+0000c290: 2020 2020 2069 203d 206c 656e 2873 656c       i = len(sel
+0000c2a0: 662e 5f73 7567 6765 7374 6564 5f74 6167  f._suggested_tag
+0000c2b0: 735f 696e 5f61 7574 6f63 6f6d 7029 202d  s_in_autocomp) -
+0000c2c0: 2031 0a20 2020 2020 2020 2020 2020 2069   1.            i
+0000c2d0: 7465 6d20 3d20 646f 6375 6d65 6e74 2e63  tem = document.c
+0000c2e0: 7265 6174 6545 6c65 6d65 6e74 2822 6469  reateElement("di
+0000c2f0: 7622 290a 2020 2020 2020 2020 2020 2020  v").            
+0000c300: 6974 656d 2e63 6c61 7373 4c69 7374 2e61  item.classList.a
+0000c310: 6464 2822 7461 672d 7375 6767 6573 7469  dd("tag-suggesti
+0000c320: 6f6e 2229 0a20 2020 2020 2020 2020 2020  on").           
+0000c330: 2069 7465 6d2e 696e 6e65 7248 544d 4c20   item.innerHTML 
+0000c340: 3d20 6874 6d6c 0a20 2020 2020 2020 2020  = html.         
+0000c350: 2020 206f 6e63 6c69 636b 203d 2066 2277     onclick = f"w
+0000c360: 696e 646f 772e 5f61 7574 6f63 6f6d 705f  indow._autocomp_
+0000c370: 6669 6e69 7368 2865 7665 6e74 2c20 7b69  finish(event, {i
+0000c380: 7d29 3b22 0a20 2020 2020 2020 2020 2020  });".           
+0000c390: 2069 7465 6d2e 7365 7441 7474 7269 6275   item.setAttribu
+0000c3a0: 7465 2822 6f6e 6d6f 7573 6564 6f77 6e22  te("onmousedown"
+0000c3b0: 2c20 6f6e 636c 6963 6b29 0a20 2020 2020  , onclick).     
+0000c3c0: 2020 2020 2020 2073 656c 662e 5f64 6976         self._div
+0000c3d0: 2e61 7070 656e 6443 6869 6c64 2869 7465  .appendChild(ite
+0000c3e0: 6d29 0a20 2020 2020 2020 2023 2053 686f  m).        # Sho
+0000c3f0: 770a 2020 2020 2020 2020 7365 6c66 2e5f  w.        self._
+0000c400: 6469 762e 6869 6464 656e 203d 2046 616c  div.hidden = Fal
+0000c410: 7365 0a20 2020 2020 2020 2073 656c 662e  se.        self.
+0000c420: 5f6d 616b 655f 6163 7469 7665 2830 290a  _make_active(0).
+0000c430: 0a20 2020 2064 6566 205f 6d61 6b65 5f61  .    def _make_a
+0000c440: 6374 6976 6528 7365 6c66 2c20 696e 6465  ctive(self, inde
+0000c450: 7829 3a0a 2020 2020 2020 2020 6175 746f  x):.        auto
+0000c460: 636f 6d70 5f63 6f75 6e74 203d 206c 656e  comp_count = len
+0000c470: 2873 656c 662e 5f73 7567 6765 7374 6564  (self._suggested
+0000c480: 5f74 6167 735f 696e 5f61 7574 6f63 6f6d  _tags_in_autocom
+0000c490: 7029 0a20 2020 2020 2020 2023 2043 6f72  p).        # Cor
+0000c4a0: 7265 6374 2069 6e64 6578 2028 7772 6170  rect index (wrap
+0000c4b0: 2061 726f 756e 6429 0a20 2020 2020 2020   around).       
+0000c4c0: 2077 6869 6c65 2069 6e64 6578 203c 2030   while index < 0
+0000c4d0: 3a0a 2020 2020 2020 2020 2020 2020 696e  :.            in
+0000c4e0: 6465 7820 2b3d 2061 7574 6f63 6f6d 705f  dex += autocomp_
+0000c4f0: 636f 756e 740a 2020 2020 2020 2020 7365  count.        se
+0000c500: 6c66 2e5f 696e 6465 7820 3d20 696e 6465  lf._index = inde
+0000c510: 7820 2520 6175 746f 636f 6d70 5f63 6f75  x % autocomp_cou
+0000c520: 6e74 0a20 2020 2020 2020 2069 6620 6e6f  nt.        if no
+0000c530: 7420 6175 746f 636f 6d70 5f63 6f75 6e74  t autocomp_count
+0000c540: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000c550: 7475 726e 0a20 2020 2020 2020 2023 2041  turn.        # A
+0000c560: 7070 6c79 0a20 2020 2020 2020 2073 656c  pply.        sel
+0000c570: 662e 5f61 6374 6976 655f 7375 6767 6573  f._active_sugges
+0000c580: 7469 6f6e 203d 2073 656c 662e 5f73 7567  tion = self._sug
+0000c590: 6765 7374 6564 5f74 6167 735f 696e 5f61  gested_tags_in_a
+0000c5a0: 7574 6f63 6f6d 705b 7365 6c66 2e5f 696e  utocomp[self._in
+0000c5b0: 6465 785d 0a20 2020 2020 2020 2023 2046  dex].        # F
+0000c5c0: 6978 2063 7373 2063 6c61 7373 0a20 2020  ix css class.   
+0000c5d0: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
+0000c5e0: 6e67 6528 7365 6c66 2e5f 6469 762e 6368  nge(self._div.ch
+0000c5f0: 696c 6472 656e 2e6c 656e 6774 6829 3a0a  ildren.length):.
+0000c600: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000c610: 2e5f 6469 762e 6368 696c 6472 656e 5b69  ._div.children[i
+0000c620: 5d2e 636c 6173 734c 6973 742e 7265 6d6f  ].classList.remo
+0000c630: 7665 2822 6163 7469 7665 2229 0a20 2020  ve("active").   
+0000c640: 2020 2020 2063 6869 6c64 5f69 6e64 6578       child_index
+0000c650: 203d 2073 656c 662e 5f69 6e64 6578 202b   = self._index +
+0000c660: 2031 0a20 2020 2020 2020 2061 6374 6976   1.        activ
+0000c670: 655f 6368 696c 6420 3d20 7365 6c66 2e5f  e_child = self._
+0000c680: 6469 762e 6368 696c 6472 656e 5b63 6869  div.children[chi
+0000c690: 6c64 5f69 6e64 6578 5d0a 2020 2020 2020  ld_index].      
+0000c6a0: 2020 6163 7469 7665 5f63 6869 6c64 2e63    active_child.c
+0000c6b0: 6c61 7373 4c69 7374 2e61 6464 2822 6163  lassList.add("ac
+0000c6c0: 7469 7665 2229 0a20 2020 2020 2020 2023  tive").        #
+0000c6d0: 204d 616b 6520 636f 7272 6573 706f 6e64   Make correspond
+0000c6e0: 696e 6720 6974 656d 2076 6973 6962 6c65  ing item visible
+0000c6f0: 0a20 2020 2020 2020 2061 6374 6976 655f  .        active_
+0000c700: 6368 696c 642e 7363 726f 6c6c 496e 746f  child.scrollInto
+0000c710: 5669 6577 287b 2262 6c6f 636b 223a 2022  View({"block": "
+0000c720: 6e65 6172 6573 7422 7d29 0a0a 2020 2020  nearest"})..    
+0000c730: 6465 6620 5f66 696e 6973 685f 6362 2873  def _finish_cb(s
+0000c740: 656c 662c 2065 2c20 6929 3a0a 2020 2020  elf, e, i):.    
+0000c750: 2020 2020 2320 4361 6c6c 6564 2077 6865      # Called whe
+0000c760: 6e20 7468 6520 6175 746f 636f 6d70 2069  n the autocomp i
+0000c770: 7465 6d20 6973 2063 6c69 636b 6564 0a20  tem is clicked. 
+0000c780: 2020 2020 2020 2073 656c 662e 5f66 696e         self._fin
+0000c790: 6973 6828 7365 6c66 2e5f 7375 6767 6573  ish(self._sugges
+0000c7a0: 7465 645f 7461 6773 5f69 6e5f 6175 746f  ted_tags_in_auto
+0000c7b0: 636f 6d70 5b69 5d29 0a20 2020 2020 2020  comp[i]).       
+0000c7c0: 2069 6620 6520 616e 6420 652e 7374 6f70   if e and e.stop
+0000c7d0: 5072 6f70 6167 6174 696f 6e3a 0a20 2020  Propagation:.   
+0000c7e0: 2020 2020 2020 2020 2065 2e73 746f 7050           e.stopP
+0000c7f0: 726f 7061 6761 7469 6f6e 2829 0a20 2020  ropagation().   
+0000c800: 2020 2020 2020 2020 2065 2e70 7265 7665           e.preve
+0000c810: 6e74 4465 6661 756c 7428 290a 0a20 2020  ntDefault()..   
+0000c820: 2064 6566 205f 6669 6e69 7368 2873 656c   def _finish(sel
+0000c830: 662c 2074 6578 7429 3a0a 2020 2020 2020  f, text):.      
+0000c840: 2020 7365 6c66 2e63 6c65 6172 2829 0a20    self.clear(). 
+0000c850: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+0000c860: 616e 6365 2874 6578 742c 2073 7472 293a  ance(text, str):
+0000c870: 0a20 2020 2020 2020 2020 2020 2074 6578  .            tex
+0000c880: 7420 3d20 7465 7874 0a20 2020 2020 2020  t = text.       
+0000c890: 2020 2020 2073 656c 6563 745f 646f 6573       select_does
+0000c8a0: 5f72 6570 6c61 6365 203d 2046 616c 7365  _replace = False
+0000c8b0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0000c8c0: 2020 2020 2020 2020 2020 2074 6578 742c             text,
+0000c8d0: 2073 656c 6563 745f 646f 6573 5f72 6570   select_does_rep
+0000c8e0: 6c61 6365 203d 2074 6578 740a 2020 2020  lace = text.    
+0000c8f0: 2020 2020 6966 2074 6578 743a 0a20 2020      if text:.   
+0000c900: 2020 2020 2020 2020 2069 6620 7365 6c65           if sele
+0000c910: 6374 5f64 6f65 735f 7265 706c 6163 653a  ct_does_replace:
+0000c920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c930: 2023 2052 6563 656e 7420 6473 2c20 6a75   # Recent ds, ju
+0000c940: 7374 2072 6570 6c61 6365 2074 6865 2077  st replace the w
+0000c950: 686f 6c65 2074 6869 6e67 0a20 2020 2020  hole thing.     
+0000c960: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000c970: 5f69 6e70 7574 2e76 616c 7565 203d 2074  _input.value = t
+0000c980: 6578 740a 2020 2020 2020 2020 2020 2020  ext.            
+0000c990: 2020 2020 7365 6c66 2e5f 696e 7075 742e      self._input.
+0000c9a0: 7365 6c65 6374 696f 6e53 7461 7274 203d  selectionStart =
+0000c9b0: 2073 656c 662e 5f69 6e70 7574 2e73 656c   self._input.sel
+0000c9c0: 6563 7469 6f6e 456e 6420 3d20 6c65 6e28  ectionEnd = len(
+0000c9d0: 7465 7874 290a 2020 2020 2020 2020 2020  text).          
+0000c9e0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000c9f0: 2020 2020 2020 2020 2320 4170 7065 6e64          # Append
+0000ca00: 2f69 6e73 6572 7420 7468 6520 7461 672f  /insert the tag/
+0000ca10: 7072 6573 6574 0a20 2020 2020 2020 2020  preset.         
+0000ca20: 2020 2020 2020 2023 2047 6574 2070 7265         # Get pre
+0000ca30: 2061 6e64 2070 6f73 7420 7061 7274 2c20   and post part, 
+0000ca40: 696e 2062 6574 7765 656e 2077 6869 6368  in between which
+0000ca50: 2077 6520 7075 7420 7468 6520 6e65 7720   we put the new 
+0000ca60: 7465 7874 0a20 2020 2020 2020 2020 2020  text.           
+0000ca70: 2020 2020 2076 616c 2c20 6931 2c20 6932       val, i1, i2
+0000ca80: 203d 2073 656c 662e 5f73 7461 7465 0a20   = self._state. 
+0000ca90: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000caa0: 7265 203d 2076 616c 5b3a 6931 5d2e 7273  re = val[:i1].rs
+0000cab0: 7472 6970 2822 2322 292e 7273 7472 6970  trip("#").rstrip
+0000cac0: 2822 2022 290a 2020 2020 2020 2020 2020  (" ").          
+0000cad0: 2020 2020 2020 706f 7374 203d 2076 616c        post = val
+0000cae0: 5b69 323a 5d2e 6c73 7472 6970 2822 2022  [i2:].lstrip(" "
+0000caf0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000cb00: 2020 6966 2070 7265 3a0a 2020 2020 2020    if pre:.      
+0000cb10: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0000cb20: 6520 3d20 7072 6520 2b20 2220 220a 2020  e = pre + " ".  
+0000cb30: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000cb40: 436f 6d70 6f73 6520 6e65 7720 7661 6c75  Compose new valu
+0000cb50: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0000cb60: 2020 7365 6c66 2e5f 696e 7075 742e 7661    self._input.va
+0000cb70: 6c75 6520 3d20 7072 6520 2b20 7465 7874  lue = pre + text
+0000cb80: 202b 2022 2022 202b 2070 6f73 740a 2020   + " " + post.  
+0000cb90: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000cba0: 5075 7420 7365 6c65 6374 696f 6e20 6174  Put selection at
+0000cbb0: 2074 6865 2065 6e64 206f 6620 7468 6520   the end of the 
+0000cbc0: 696e 7365 7274 6564 2074 6578 740a 2020  inserted text.  
+0000cbd0: 2020 2020 2020 2020 2020 2020 2020 6375                cu
+0000cbe0: 7273 6f72 5f70 6f73 203d 206c 656e 2870  rsor_pos = len(p
+0000cbf0: 7265 2920 2b20 6c65 6e28 7465 7874 2920  re) + len(text) 
+0000cc00: 2b20 310a 2020 2020 2020 2020 2020 2020  + 1.            
+0000cc10: 2020 2020 7365 6c66 2e5f 696e 7075 742e      self._input.
+0000cc20: 7365 6c65 6374 696f 6e53 7461 7274 203d  selectionStart =
+0000cc30: 2073 656c 662e 5f69 6e70 7574 2e73 656c   self._input.sel
+0000cc40: 6563 7469 6f6e 456e 6420 3d20 6375 7273  ectionEnd = curs
+0000cc50: 6f72 5f70 6f73 0a20 2020 2020 2020 2020  or_pos.         
+0000cc60: 2020 2069 6620 7574 696c 732e 6c6f 6f6b     if utils.look
+0000cc70: 735f 6c69 6b65 5f64 6573 6b74 6f70 2829  s_like_desktop()
+0000cc80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000cc90: 2020 7365 6c66 2e5f 696e 7075 742e 666f    self._input.fo
+0000cca0: 6375 7328 290a 2020 2020 2020 2020 7365  cus().        se
+0000ccb0: 6c66 2e5f 6361 6c6c 6261 636b 2829 0a0a  lf._callback()..
+0000ccc0: 2020 2020 6465 6620 5f67 6574 5f73 7461      def _get_sta
+0000ccd0: 7465 2873 656c 6629 3a0a 2020 2020 2020  te(self):.      
+0000cce0: 2020 2222 2247 6574 2074 6865 2070 6172    """Get the par
+0000ccf0: 7469 616c 2074 6167 2074 6861 7420 6973  tial tag that is
+0000cd00: 2062 6569 6e67 2077 7269 7474 656e 2e22   being written."
+0000cd10: 2222 0a20 2020 2020 2020 2023 2047 6574  "".        # Get
+0000cd20: 2076 616c 7565 2061 6e64 2070 6f73 6974   value and posit
+0000cd30: 696f 6e0a 2020 2020 2020 2020 7661 6c20  ion.        val 
+0000cd40: 3d20 7365 6c66 2e5f 696e 7075 742e 7661  = self._input.va
+0000cd50: 6c75 650a 2020 2020 2020 2020 6932 203d  lue.        i2 =
+0000cd60: 2073 656c 662e 5f69 6e70 7574 2e73 656c   self._input.sel
+0000cd70: 6563 7469 6f6e 5374 6172 740a 2020 2020  ectionStart.    
+0000cd80: 2020 2020 2320 4966 2074 6865 2069 6e70      # If the inp
+0000cd90: 7574 2065 6c65 6d65 6e74 2064 6f65 7320  ut element does 
+0000cda0: 6e6f 7420 6861 7665 2066 6f63 7573 2c20  not have focus, 
+0000cdb0: 7468 6973 2069 7320 616c 6c20 7765 206e  this is all we n
+0000cdc0: 6565 640a 2020 2020 2020 2020 6966 2077  eed.        if w
+0000cdd0: 696e 646f 772e 646f 6375 6d65 6e74 2e61  indow.document.a
+0000cde0: 6374 6976 6545 6c65 6d65 6e74 2069 7320  ctiveElement is 
+0000cdf0: 6e6f 7420 7365 6c66 2e5f 696e 7075 743a  not self._input:
+0000ce00: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000ce10: 7572 6e20 7661 6c2c 2069 322c 2069 320a  urn val, i2, i2.
+0000ce20: 2020 2020 2020 2020 2320 4f74 6865 7277          # Otherw
+0000ce30: 6973 6520 7765 2074 7279 2074 6f20 6669  ise we try to fi
+0000ce40: 6e64 2074 6865 2073 7461 7274 206f 6620  nd the start of 
+0000ce50: 7468 6520 7772 6974 7465 6e20 7461 670a  the written tag.
+0000ce60: 2020 2020 2020 2020 6920 3d20 6932 202d          i = i2 -
+0000ce70: 2031 0a20 2020 2020 2020 2077 6869 6c65   1.        while
+0000ce80: 2069 203e 3d20 303a 0a20 2020 2020 2020   i >= 0:.       
+0000ce90: 2020 2020 2063 203d 2076 616c 5b69 5d0a       c = val[i].
+0000cea0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+0000ceb0: 203d 3d20 2223 223a 0a20 2020 2020 2020   == "#":.       
+0000cec0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000ced0: 7661 6c2c 2069 2c20 6932 0a20 2020 2020  val, i, i2.     
+0000cee0: 2020 2020 2020 2065 6c69 6620 6e6f 7420         elif not 
+0000cef0: 7574 696c 732e 6973 5f76 616c 6964 5f74  utils.is_valid_t
+0000cf00: 6167 5f63 6861 7263 6f64 6528 6f72 6428  ag_charcode(ord(
+0000cf10: 6329 293a 0a20 2020 2020 2020 2020 2020  c)):.           
+0000cf20: 2020 2020 2072 6574 7572 6e20 7661 6c2c       return val,
+0000cf30: 2069 322c 2069 320a 2020 2020 2020 2020   i2, i2.        
+0000cf40: 2020 2020 6920 2d3d 2031 0a20 2020 2020      i -= 1.     
+0000cf50: 2020 2072 6574 7572 6e20 7661 6c2c 2069     return val, i
+0000cf60: 322c 2069 320a 0a20 2020 2064 6566 205f  2, i2..    def _
+0000cf70: 6765 745f 7375 6767 6573 7465 645f 7461  get_suggested_ta
+0000cf80: 6773 5f70 7265 7365 7473 2873 656c 6629  gs_presets(self)
+0000cf90: 3a0a 2020 2020 2020 2020 2222 2247 6574  :.        """Get
+0000cfa0: 2073 7567 6765 7374 6564 2074 6167 7320   suggested tags 
+0000cfb0: 6261 7365 6420 6f6e 2074 6865 2070 7265  based on the pre
+0000cfc0: 7365 7473 2e22 2222 0a20 2020 2020 2020  sets.""".       
+0000cfd0: 2069 7465 6d20 3d20 7769 6e64 6f77 2e73   item = window.s
+0000cfe0: 746f 7265 2e73 6574 7469 6e67 732e 6765  tore.settings.ge
+0000cff0: 745f 6279 5f6b 6579 2822 7461 675f 7072  t_by_key("tag_pr
+0000d000: 6573 6574 7322 290a 2020 2020 2020 2020  esets").        
+0000d010: 7072 6573 6574 7320 3d20 284e 6f6e 6520  presets = (None 
+0000d020: 6966 2069 7465 6d20 6973 204e 6f6e 6520  if item is None 
+0000d030: 656c 7365 2069 7465 6d2e 7661 6c75 6529  else item.value)
+0000d040: 206f 7220 5b5d 0a20 2020 2020 2020 2072   or [].        r
+0000d050: 6574 7572 6e20 5b70 7265 7365 7420 666f  eturn [preset fo
+0000d060: 7220 7072 6573 6574 2069 6e20 7072 6573  r preset in pres
+0000d070: 6574 7320 6966 2070 7265 7365 745d 0a0a  ets if preset]..
+0000d080: 2020 2020 6465 6620 5f67 6574 5f73 7567      def _get_sug
+0000d090: 6765 7374 6564 5f74 6167 735f 616c 6c5f  gested_tags_all_
+0000d0a0: 6469 6374 2873 656c 662c 2066 6f72 6365  dict(self, force
+0000d0b0: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
+0000d0c0: 2022 2222 4765 7420 2a61 6c6c 2a20 7461   """Get *all* ta
+0000d0d0: 6773 2065 7665 7220 7573 6564 2e22 2222  gs ever used."""
+0000d0e0: 0a20 2020 2020 2020 2050 5343 5249 5054  .        PSCRIPT
+0000d0f0: 5f4f 5645 524c 4f41 4420 3d20 4661 6c73  _OVERLOAD = Fals
+0000d100: 6520 2023 206e 6f71 610a 2020 2020 2020  e  # noqa.      
+0000d110: 2020 676c 6f62 616c 2063 6f6d 706c 6574    global complet
+0000d120: 6572 5f61 6c6c 5f74 6167 730a 2020 2020  er_all_tags.    
+0000d130: 2020 2020 6966 2066 6f72 6365 206f 7220      if force or 
+0000d140: 636f 6d70 6c65 7465 725f 616c 6c5f 7461  completer_all_ta
+0000d150: 6773 2069 7320 4e6f 6e65 3a0a 2020 2020  gs is None:.    
+0000d160: 2020 2020 2020 2020 7375 6767 6573 7465          suggeste
+0000d170: 645f 7461 6773 203d 207b 7d0a 2020 2020  d_tags = {}.    
+0000d180: 2020 2020 2020 2020 666f 7220 7220 696e          for r in
+0000d190: 2077 696e 646f 772e 7374 6f72 652e 7265   window.store.re
+0000d1a0: 636f 7264 732e 6765 745f 6475 6d70 2829  cords.get_dump()
+0000d1b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000d1c0: 2020 7461 6773 2c20 5f20 3d20 7574 696c    tags, _ = util
+0000d1d0: 732e 6765 745f 7461 6773 5f61 6e64 5f70  s.get_tags_and_p
+0000d1e0: 6172 7473 5f66 726f 6d5f 7374 7269 6e67  arts_from_string
+0000d1f0: 2872 2e64 7329 0a20 2020 2020 2020 2020  (r.ds).         
+0000d200: 2020 2020 2020 2066 6f72 2074 6167 2069         for tag i
+0000d210: 6e20 7461 6773 3a0a 2020 2020 2020 2020  n tags:.        
+0000d220: 2020 2020 2020 2020 2020 2020 7375 6767              sugg
+0000d230: 6573 7465 645f 7461 6773 5b74 6167 5d20  ested_tags[tag] 
+0000d240: 3d20 6d61 7828 722e 7432 2c20 7375 6767  = max(r.t2, sugg
+0000d250: 6573 7465 645f 7461 6773 5b74 6167 5d20  ested_tags[tag] 
+0000d260: 7c20 3029 0a20 2020 2020 2020 2020 2020  | 0).           
+0000d270: 2063 6f6d 706c 6574 6572 5f61 6c6c 5f74   completer_all_t
+0000d280: 6167 7320 3d20 7375 6767 6573 7465 645f  ags = suggested_
+0000d290: 7461 6773 0a20 2020 2020 2020 2072 6574  tags.        ret
+0000d2a0: 7572 6e20 636f 6d70 6c65 7465 725f 616c  urn completer_al
+0000d2b0: 6c5f 7461 6773 0a0a 2020 2020 6465 6620  l_tags..    def 
+0000d2c0: 5f67 6574 5f73 7567 6765 7374 6564 5f72  _get_suggested_r
+0000d2d0: 6563 656e 7473 2873 656c 6629 3a0a 2020  ecents(self):.  
+0000d2e0: 2020 2020 2020 2222 2247 6574 2072 6563        """Get rec
+0000d2f0: 656e 7420 7461 6773 2061 6e64 206f 7264  ent tags and ord
+0000d300: 6572 2062 7920 7468 6569 7220 7573 6167  er by their usag
+0000d310: 652f 7265 6365 6e74 2d6e 6573 732e 2222  e/recent-ness.""
+0000d320: 220a 2020 2020 2020 2020 2320 4765 7420  ".        # Get 
+0000d330: 6869 7374 6f72 7920 6f66 2073 6f6d 6577  history of somew
+0000d340: 6861 7420 7265 6365 6e74 2072 6563 6f72  hat recent recor
+0000d350: 6473 0a20 2020 2020 2020 2074 3220 3d20  ds.        t2 = 
+0000d360: 6474 2e6e 6f77 2829 0a20 2020 2020 2020  dt.now().       
+0000d370: 2074 3120 3d20 7432 202d 2031 3220 2a20   t1 = t2 - 12 * 
+0000d380: 3720 2a20 3234 202a 2033 3630 3020 2023  7 * 24 * 3600  #
+0000d390: 2031 3220 7765 656b 732c 2061 626f 7574   12 weeks, about
+0000d3a0: 2061 2071 7561 7274 6572 2079 6561 720a   a quarter year.
+0000d3b0: 2020 2020 2020 2020 7265 636f 7264 7320          records 
+0000d3c0: 3d20 7769 6e64 6f77 2e73 746f 7265 2e72  = window.store.r
+0000d3d0: 6563 6f72 6473 2e67 6574 5f72 6563 6f72  ecords.get_recor
+0000d3e0: 6473 2874 312c 2074 3229 0a20 2020 2020  ds(t1, t2).     
+0000d3f0: 2020 2023 2041 7070 6c79 2053 636f 7265     # Apply Score
+0000d400: 0a20 2020 2020 2020 2074 6167 735f 746f  .        tags_to
+0000d410: 5f73 636f 7265 7320 3d20 7b7d 0a20 2020  _scores = {}.   
+0000d420: 2020 2020 2074 6167 735f 746f 5f74 3220       tags_to_t2 
+0000d430: 3d20 7b7d 0a20 2020 2020 2020 2064 6573  = {}.        des
+0000d440: 6372 6970 7469 6f6e 7320 3d20 7b7d 0a20  criptions = {}. 
+0000d450: 2020 2020 2020 2066 6f72 2072 2069 6e20         for r in 
+0000d460: 7265 636f 7264 732e 7661 6c75 6573 2829  records.values()
+0000d470: 3a0a 2020 2020 2020 2020 2020 2020 6465  :.            de
+0000d480: 7363 7269 7074 696f 6e73 5b72 2e64 735d  scriptions[r.ds]
+0000d490: 203d 206d 6178 2872 2e74 322c 2064 6573   = max(r.t2, des
+0000d4a0: 6372 6970 7469 6f6e 735b 722e 6473 5d20  criptions[r.ds] 
+0000d4b0: 7c20 3029 0a20 2020 2020 2020 2020 2020  | 0).           
+0000d4c0: 2074 6167 732c 205f 203d 2075 7469 6c73   tags, _ = utils
+0000d4d0: 2e67 6574 5f74 6167 735f 616e 645f 7061  .get_tags_and_pa
+0000d4e0: 7274 735f 6672 6f6d 5f73 7472 696e 6728  rts_from_string(
+0000d4f0: 722e 6473 290a 2020 2020 2020 2020 2020  r.ds).          
+0000d500: 2020 7363 6f72 6520 3d20 3120 2f20 2874    score = 1 / (t
+0000d510: 3220 2d20 722e 7431 290a 2020 2020 2020  2 - r.t1).      
+0000d520: 2020 2020 2020 666f 7220 7461 6720 696e        for tag in
+0000d530: 2074 6167 733a 0a20 2020 2020 2020 2020   tags:.         
+0000d540: 2020 2020 2020 2074 6167 735f 746f 5f74         tags_to_t
+0000d550: 325b 7461 675d 203d 206d 6178 2872 2e74  2[tag] = max(r.t
+0000d560: 322c 2074 6167 735f 746f 5f74 325b 7461  2, tags_to_t2[ta
+0000d570: 675d 207c 2030 290a 2020 2020 2020 2020  g] | 0).        
+0000d580: 2020 2020 2020 2020 7461 6773 5f74 6f5f          tags_to_
+0000d590: 7363 6f72 6573 5b74 6167 5d20 3d20 2874  scores[tag] = (t
+0000d5a0: 6167 735f 746f 5f73 636f 7265 735b 7461  ags_to_scores[ta
+0000d5b0: 675d 207c 2030 2920 2b20 7363 6f72 650a  g] | 0) + score.
+0000d5c0: 2020 2020 2020 2020 2320 5075 7420 6473          # Put ds
+0000d5d0: 2069 6e20 6120 6c69 7374 0a20 2020 2020   in a list.     
+0000d5e0: 2020 2064 735f 6c69 7374 203d 206c 6973     ds_list = lis
+0000d5f0: 7428 6465 7363 7269 7074 696f 6e73 2e69  t(descriptions.i
+0000d600: 7465 6d73 2829 290a 2020 2020 2020 2020  tems()).        
+0000d610: 6473 5f6c 6973 742e 736f 7274 286b 6579  ds_list.sort(key
+0000d620: 3d6c 616d 6264 6120 783a 202d 785b 315d  =lambda x: -x[1]
+0000d630: 290a 2020 2020 2020 2020 2320 5075 7420  ).        # Put 
+0000d640: 7461 6773 2069 6e20 6120 6c69 7374 0a20  tags in a list. 
+0000d650: 2020 2020 2020 2073 636f 7265 5f74 6167         score_tag
+0000d660: 5f6c 6973 7420 3d20 5b5d 0a20 2020 2020  _list = [].     
+0000d670: 2020 2066 6f72 2074 6167 2069 6e20 7461     for tag in ta
+0000d680: 6773 5f74 6f5f 7363 6f72 6573 2e6b 6579  gs_to_scores.key
+0000d690: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+0000d6a0: 2069 6620 7461 6720 3d3d 2022 2375 6e74   if tag == "#unt
+0000d6b0: 6167 6765 6422 3a0a 2020 2020 2020 2020  agged":.        
+0000d6c0: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+0000d6d0: 0a20 2020 2020 2020 2020 2020 2073 636f  .            sco
+0000d6e0: 7265 5f74 6167 5f6c 6973 742e 7075 7368  re_tag_list.push
+0000d6f0: 2828 7461 672c 2074 6167 735f 746f 5f74  ((tag, tags_to_t
+0000d700: 325b 7461 675d 2c20 7461 6773 5f74 6f5f  2[tag], tags_to_
+0000d710: 7363 6f72 6573 5b74 6167 5d29 290a 2020  scores[tag])).  
+0000d720: 2020 2020 2020 2320 536f 7274 2062 7920        # Sort by 
+0000d730: 7363 6f72 6520 616e 6420 7472 696d 206e  score and trim n
+0000d740: 616d 6573 0a20 2020 2020 2020 2073 636f  ames.        sco
+0000d750: 7265 5f74 6167 5f6c 6973 742e 736f 7274  re_tag_list.sort
+0000d760: 286b 6579 3d6c 616d 6264 6120 783a 202d  (key=lambda x: -
+0000d770: 785b 325d 290a 2020 2020 2020 2020 7461  x[2]).        ta
+0000d780: 675f 6c69 7374 203d 205b 7363 6f72 655f  g_list = [score_
+0000d790: 7461 675b 3a32 5d20 666f 7220 7363 6f72  tag[:2] for scor
+0000d7a0: 655f 7461 6720 696e 2073 636f 7265 5f74  e_tag in score_t
+0000d7b0: 6167 5f6c 6973 745d 0a20 2020 2020 2020  ag_list].       
+0000d7c0: 2072 6574 7572 6e20 6473 5f6c 6973 742c   return ds_list,
+0000d7d0: 2074 6167 5f6c 6973 740a 0a20 2020 2064   tag_list..    d
+0000d7e0: 6566 205f 6765 745f 7375 6767 6573 7465  ef _get_suggeste
+0000d7f0: 645f 7461 6773 5f63 6f6d 6269 6e65 6428  d_tags_combined(
+0000d800: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+0000d810: 2222 436f 6d62 696e 6520 7468 6520 6675  ""Combine the fu
+0000d820: 6c6c 2074 6167 2064 6963 7420 7769 7468  ll tag dict with
+0000d830: 2074 6865 206d 6f72 6520 7265 6365 6e74   the more recent
+0000d840: 2074 6167 732e 2222 220a 2020 2020 2020   tags.""".      
+0000d850: 2020 2320 436f 6c6c 6563 740a 2020 2020    # Collect.    
+0000d860: 2020 2020 7461 6773 5f64 6963 7420 3d20      tags_dict = 
+0000d870: 7b7d 0a20 2020 2020 2020 206e 6577 5f74  {}.        new_t
+0000d880: 6167 7320 3d20 5b5d 0a20 2020 2020 2020  ags = [].       
+0000d890: 2069 6620 7365 6c66 2e5f 6d6f 6465 5f6d   if self._mode_m
+0000d8a0: 6173 6b20 2620 313a 0a20 2020 2020 2020  ask & 1:.       
+0000d8b0: 2020 2020 2074 6167 735f 6469 6374 203d       tags_dict =
+0000d8c0: 2073 656c 662e 5f67 6574 5f73 7567 6765   self._get_sugge
+0000d8d0: 7374 6564 5f74 6167 735f 616c 6c5f 6469  sted_tags_all_di
+0000d8e0: 6374 2873 656c 662e 5f6d 6f64 655f 6d61  ct(self._mode_ma
+0000d8f0: 736b 203d 3d20 3129 2e63 6f70 7928 290a  sk == 1).copy().
+0000d900: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000d910: 5f6d 6f64 655f 6d61 736b 2026 2032 3a0a  _mode_mask & 2:.
+0000d920: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+0000d930: 7461 6773 203d 2073 656c 662e 5f73 7567  tags = self._sug
+0000d940: 6765 7374 6564 5f74 6167 735f 7265 6365  gested_tags_rece
+0000d950: 6e74 0a20 2020 2020 2020 2023 2043 6f6d  nt.        # Com
+0000d960: 6269 6e65 0a20 2020 2020 2020 2066 6f72  bine.        for
+0000d970: 2074 6167 2c20 7461 675f 7432 2069 6e20   tag, tag_t2 in 
+0000d980: 6e65 775f 7461 6773 3a0a 2020 2020 2020  new_tags:.      
+0000d990: 2020 2020 2020 7461 6773 5f64 6963 745b        tags_dict[
+0000d9a0: 7461 675d 203d 2074 6167 5f74 320a 2020  tag] = tag_t2.  
+0000d9b0: 2020 2020 2020 2320 436f 6d70 6f73 6520        # Compose 
+0000d9c0: 6675 6c6c 2074 6167 2073 7567 6765 7374  full tag suggest
+0000d9d0: 696f 6e73 206c 6973 740a 2020 2020 2020  ions list.      
+0000d9e0: 2020 7461 675f 6c69 7374 203d 205b 5d0a    tag_list = [].
+0000d9f0: 2020 2020 2020 2020 666f 7220 7461 672c          for tag,
+0000da00: 2074 6167 5f74 3220 696e 2074 6167 735f   tag_t2 in tags_
+0000da10: 6469 6374 2e69 7465 6d73 2829 3a0a 2020  dict.items():.  
+0000da20: 2020 2020 2020 2020 2020 7461 675f 6c69            tag_li
+0000da30: 7374 2e70 7573 6828 2874 6167 2c20 7461  st.push((tag, ta
+0000da40: 675f 7432 2929 0a20 2020 2020 2020 2074  g_t2)).        t
+0000da50: 6167 5f6c 6973 742e 736f 7274 286b 6579  ag_list.sort(key
+0000da60: 3d6c 616d 6264 6120 783a 2078 5b30 5d29  =lambda x: x[0])
+0000da70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000da80: 7461 675f 6c69 7374 0a0a 0a63 6c61 7373  tag_list...class
+0000da90: 2052 6563 6f72 6444 6961 6c6f 6728 4261   RecordDialog(Ba
+0000daa0: 7365 4469 616c 6f67 293a 0a20 2020 2022  seDialog):.    "
+0000dab0: 2222 4469 616c 6f67 2074 6f20 616c 6c6f  ""Dialog to allo
+0000dac0: 7720 6d6f 6469 6679 696e 6720 6120 7265  w modifying a re
+0000dad0: 636f 7264 2028 7365 7474 696e 6720 6465  cord (setting de
+0000dae0: 7363 7269 7074 696f 6e20 616e 6420 7469  scription and ti
+0000daf0: 6d65 7329 2e22 2222 0a0a 2020 2020 6465  mes)."""..    de
+0000db00: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+0000db10: 2063 616e 7661 7329 3a0a 2020 2020 2020   canvas):.      
+0000db20: 2020 7375 7065 7228 292e 5f5f 696e 6974    super().__init
+0000db30: 5f5f 2863 616e 7661 7329 0a20 2020 2020  __(canvas).     
+0000db40: 2020 2073 656c 662e 5f72 6563 6f72 6420     self._record 
+0000db50: 3d20 4e6f 6e65 0a20 2020 2020 2020 2073  = None.        s
+0000db60: 656c 662e 5f6e 6f5f 7573 6572 5f65 6469  elf._no_user_edi
+0000db70: 745f 7965 7420 3d20 5472 7565 0a0a 2020  t_yet = True..  
+0000db80: 2020 2020 2020 2320 456e 6162 6c65 2073        # Enable s
+0000db90: 746f 7070 696e 6720 6120 7265 636f 7264  topping a record
+0000dba0: 2076 6961 2074 6865 206e 6f74 6966 6963   via the notific
+0000dbb0: 6174 696f 6e0a 2020 2020 2020 2020 6966  ation.        if
+0000dbc0: 2077 696e 646f 772e 6e61 7669 6761 746f   window.navigato
+0000dbd0: 722e 7365 7276 6963 6557 6f72 6b65 723a  r.serviceWorker:
+0000dbe0: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
+0000dbf0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000dc00: 2020 7769 6e64 6f77 2e6e 6176 6967 6174    window.navigat
+0000dc10: 6f72 2e73 6572 7669 6365 576f 726b 6572  or.serviceWorker
+0000dc20: 2e61 6464 4576 656e 744c 6973 7465 6e65  .addEventListene
+0000dc30: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+0000dc40: 2020 2020 2020 2022 6d65 7373 6167 6522         "message"
+0000dc50: 2c20 7365 6c66 2e6f 6e5f 6e6f 7469 6669  , self.on_notifi
+0000dc60: 6361 7469 6f6e 636c 6963 6b0a 2020 2020  cationclick.    
+0000dc70: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0000dc80: 2020 2020 2020 2020 2020 6578 6365 7074            except
+0000dc90: 2045 7863 6570 7469 6f6e 3a0a 2020 2020   Exception:.    
+0000dca0: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+0000dcb0: 0a0a 2020 2020 6465 6620 6f70 656e 2873  ..    def open(s
+0000dcc0: 656c 662c 206d 6f64 652c 2072 6563 6f72  elf, mode, recor
+0000dcd0: 642c 2063 616c 6c62 6163 6b3d 4e6f 6e65  d, callback=None
+0000dce0: 293a 0a20 2020 2020 2020 2022 2222 5368  ):.        """Sh
+0000dcf0: 6f77 2f6f 7065 6e20 7468 6520 6469 616c  ow/open the dial
+0000dd00: 6f67 2066 6f72 2074 6865 2067 6976 656e  og for the given
+0000dd10: 2072 6563 6f72 642e 204f 6e20 7375 626d   record. On subm
+0000dd20: 6974 2c20 7468 650a 2020 2020 2020 2020  it, the.        
+0000dd30: 7265 636f 7264 2077 696c 6c20 6265 2070  record will be p
+0000dd40: 7573 6865 6420 746f 2074 6865 2073 746f  ushed to the sto
+0000dd50: 7265 2061 6e64 2063 616c 6c62 6163 6b20  re and callback 
+0000dd60: 2869 6620 6769 7665 6e29 2077 696c 6c0a  (if given) will.
+0000dd70: 2020 2020 2020 2020 6265 2063 616c 6c65          be calle
+0000dd80: 6420 7769 7468 2074 6865 2072 6563 6f72  d with the recor
+0000dd90: 642e 204f 6e20 636c 6f73 652f 6361 6e63  d. On close/canc
+0000dda0: 656c 2c20 7468 6520 6361 6c6c 6261 636b  el, the callback
+0000ddb0: 2077 696c 6c0a 2020 2020 2020 2020 6265   will.        be
+0000ddc0: 2063 616c 6c65 6420 7769 7468 6f75 7420   called without 
+0000ddd0: 6172 6775 6d65 6e74 732e 0a20 2020 2020  arguments..     
+0000dde0: 2020 2022 2222 0a20 2020 2020 2020 2073     """.        s
+0000ddf0: 656c 662e 5f72 6563 6f72 6420 3d20 7265  elf._record = re
+0000de00: 636f 7264 2e63 6f70 7928 290a 2020 2020  cord.copy().    
+0000de10: 2020 2020 6173 7365 7274 206d 6f64 652e      assert mode.
+0000de20: 6c6f 7765 7228 2920 696e 2028 2273 7461  lower() in ("sta
+0000de30: 7274 222c 2022 6e65 7722 2c20 2265 6469  rt", "new", "edi
+0000de40: 7422 2c20 2273 746f 7022 290a 0a20 2020  t", "stop")..   
+0000de50: 2020 2020 2068 746d 6c20 3d20 6622 2222       html = f"""
+0000de60: 0a20 2020 2020 2020 2020 2020 203c 6831  .            <h1
+0000de70: 3e3c 6920 636c 6173 733d 2766 6173 273e  ><i class='fas'>
+0000de80: 5c75 6636 3832 3c2f 693e 266e 6273 703b  \uf682</i>&nbsp;
+0000de90: 266e 6273 703b 3c73 7061 6e3e 5265 636f  &nbsp;<span>Reco
+0000dea0: 7264 3c2f 7370 616e 3e0a 2020 2020 2020  rd</span>.      
+0000deb0: 2020 2020 2020 2020 2020 3c62 7574 746f            <butto
+0000dec0: 6e20 7479 7065 3d27 6275 7474 6f6e 273e  n type='button'>
+0000ded0: 3c69 2063 6c61 7373 3d27 6661 7327 3e5c  <i class='fas'>\
+0000dee0: 7566 3030 643c 2f69 3e3c 2f62 7574 746f  uf00d</i></butto
+0000def0: 6e3e 0a20 2020 2020 2020 2020 2020 203c  n>.            <
+0000df00: 2f68 313e 0a20 2020 2020 2020 2020 2020  /h1>.           
+0000df10: 203c 6832 3e3c 6920 636c 6173 733d 2766   <h2><i class='f
+0000df20: 6173 273e 5c75 6633 3035 3c2f 693e 266e  as'>\uf305</i>&n
+0000df30: 6273 703b 266e 6273 703b 4465 7363 7269  bsp;&nbsp;Descri
+0000df40: 7074 696f 6e3c 2f68 323e 0a20 2020 2020  ption</h2>.     
+0000df50: 2020 2020 2020 203c 6469 7620 636c 6173         <div clas
+0000df60: 733d 2763 6f6e 7461 696e 6572 2720 7374  s='container' st
+0000df70: 796c 653d 2770 6f73 6974 696f 6e3a 2072  yle='position: r
+0000df80: 656c 6174 6976 653b 273e 0a20 2020 2020  elative;'>.     
+0000df90: 2020 2020 2020 2020 2020 203c 696e 7075             <inpu
+0000dfa0: 7420 7479 7065 3d27 7465 7874 2720 7374  t type='text' st
+0000dfb0: 796c 653d 2777 6964 7468 3a31 3030 253b  yle='width:100%;
+0000dfc0: 2720 7370 656c 6c63 6865 636b 3d27 7472  ' spellcheck='tr
+0000dfd0: 7565 2720 2f3e 0a20 2020 2020 2020 2020  ue' />.         
+0000dfe0: 2020 2020 2020 203c 6469 7620 636c 6173         <div clas
+0000dff0: 733d 2774 6167 2d73 7567 6765 7374 696f  s='tag-suggestio
+0000e000: 6e73 2d61 7574 6f63 6f6d 7027 3e3c 2f64  ns-autocomp'></d
+0000e010: 6976 3e0a 2020 2020 2020 2020 2020 2020  iv>.            
+0000e020: 3c2f 6469 763e 0a20 2020 2020 2020 2020  </div>.         
+0000e030: 2020 203c 6469 7620 636c 6173 733d 2763     <div class='c
+0000e040: 6f6e 7461 696e 6572 2720 7374 796c 653d  ontainer' style=
+0000e050: 276d 696e 2d68 6569 6768 743a 3230 7078  'min-height:20px
+0000e060: 3b27 3e0a 2020 2020 2020 2020 2020 2020  ;'>.            
+0000e070: 2020 2020 3c62 7574 746f 6e20 7479 7065      <button type
+0000e080: 3d27 6275 7474 6f6e 2720 7374 796c 653d  ='button' style=
+0000e090: 2766 6c6f 6174 3a72 6967 6874 3b20 666f  'float:right; fo
+0000e0a0: 6e74 2d73 697a 653a 3735 253b 206d 6172  nt-size:75%; mar
+0000e0b0: 6769 6e2d 746f 703a 2d34 7078 3b27 3e0a  gin-top:-4px;'>.
+0000e0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e0d0: 2020 2020 3c69 2063 6c61 7373 3d27 6661      <i class='fa
+0000e0e0: 7327 3e5c 7566 3034 343c 2f69 3e3c 2f62  s'>\uf044</i></b
+0000e0f0: 7574 746f 6e3e 0a20 2020 2020 2020 2020  utton>.         
+0000e100: 2020 2020 2020 203c 6275 7474 6f6e 2074         <button t
+0000e110: 7970 653d 2762 7574 746f 6e27 2073 7479  ype='button' sty
+0000e120: 6c65 3d27 666c 6f61 743a 7269 6768 743b  le='float:right;
+0000e130: 2066 6f6e 742d 7369 7a65 3a37 3525 3b20   font-size:75%; 
+0000e140: 6d61 7267 696e 2d74 6f70 3a2d 3470 783b  margin-top:-4px;
+0000e150: 273e 0a20 2020 2020 2020 2020 2020 2020  '>.             
+0000e160: 2020 2020 2020 2050 7265 7365 7473 203c         Presets <
+0000e170: 6920 636c 6173 733d 2766 6173 273e 5c75  i class='fas'>\u
+0000e180: 6630 6437 3c2f 693e 3c2f 6275 7474 6f6e  f0d7</i></button
+0000e190: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
+0000e1a0: 2020 3c62 7574 746f 6e20 7479 7065 3d27    <button type='
+0000e1b0: 6275 7474 6f6e 2720 7374 796c 653d 2766  button' style='f
+0000e1c0: 6c6f 6174 3a72 6967 6874 3b20 666f 6e74  loat:right; font
+0000e1d0: 2d73 697a 653a 3735 253b 206d 6172 6769  -size:75%; margi
+0000e1e0: 6e2d 746f 703a 2d34 7078 3b27 3e0a 2020  n-top:-4px;'>.  
+0000e1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e200: 2020 5461 6773 203c 6920 636c 6173 733d    Tags <i class=
+0000e210: 2766 6173 273e 5c75 6630 6437 3c2f 693e  'fas'>\uf0d7</i>
+0000e220: 3c2f 6275 7474 6f6e 3e0a 2020 2020 2020  </button>.      
+0000e230: 2020 2020 2020 2020 2020 3c62 7574 746f            <butto
+0000e240: 6e20 7479 7065 3d27 6275 7474 6f6e 2720  n type='button' 
+0000e250: 7374 796c 653d 2766 6c6f 6174 3a72 6967  style='float:rig
+0000e260: 6874 3b20 666f 6e74 2d73 697a 653a 3735  ht; font-size:75
+0000e270: 253b 206d 6172 6769 6e2d 746f 703a 2d34  %; margin-top:-4
+0000e280: 7078 3b27 3e0a 2020 2020 2020 2020 2020  px;'>.          
+0000e290: 2020 2020 2020 2020 2020 5265 6365 6e74            Recent
+0000e2a0: 203c 6920 636c 6173 733d 2766 6173 273e   <i class='fas'>
+0000e2b0: 5c75 6630 6437 3c2f 693e 3c2f 6275 7474  \uf0d7</i></butt
+0000e2c0: 6f6e 3e0a 2020 2020 2020 2020 2020 2020  on>.            
+0000e2d0: 3c2f 6469 763e 0a20 2020 2020 2020 2020  </div>.         
+0000e2e0: 2020 203c 6469 763e 3c2f 6469 763e 0a20     <div></div>. 
+0000e2f0: 2020 2020 2020 2020 2020 203c 6469 7620             <div 
+0000e300: 7374 796c 653d 2763 6f6c 6f72 3a23 3737  style='color:#77
+0000e310: 373b 273e 3c2f 6469 763e 0a20 2020 2020  7;'></div>.     
+0000e320: 2020 2020 2020 203c 6832 3e3c 6920 636c         <h2><i cl
+0000e330: 6173 733d 2766 6173 273e 5c75 6630 3137  ass='fas'>\uf017
+0000e340: 3c2f 693e 266e 6273 703b 266e 6273 703b  </i>&nbsp;&nbsp;
+0000e350: 5469 6d65 3c2f 6832 3e0a 2020 2020 2020  Time</h2>.      
+0000e360: 2020 2020 2020 3c64 6976 3e3c 2f64 6976        <div></div
+0000e370: 3e0a 2020 2020 2020 2020 2020 2020 3c64  >.            <d
+0000e380: 6976 2073 7479 6c65 3d27 6d61 7267 696e  iv style='margin
+0000e390: 2d74 6f70 3a32 656d 3b27 3e3c 2f64 6976  -top:2em;'></div
+0000e3a0: 3e0a 2020 2020 2020 2020 2020 2020 3c64  >.            <d
+0000e3b0: 6976 2073 7479 6c65 3d27 6469 7370 6c61  iv style='displa
+0000e3c0: 793a 2066 6c65 783b 6a75 7374 6966 792d  y: flex;justify-
+0000e3d0: 636f 6e74 656e 743a 2066 6c65 782d 656e  content: flex-en
+0000e3e0: 643b 273e 0a20 2020 2020 2020 2020 2020  d;'>.           
+0000e3f0: 2020 2020 203c 6275 7474 6f6e 2074 7970       <button typ
+0000e400: 653d 2762 7574 746f 6e27 2063 6c61 7373  e='button' class
+0000e410: 3d27 6163 7469 6f6e 6275 7474 6f6e 273e  ='actionbutton'>
+0000e420: 3c69 2063 6c61 7373 3d27 6661 7327 3e5c  <i class='fas'>\
+0000e430: 7566 3030 643c 2f69 3e26 6e62 7370 3b26  uf00d</i>&nbsp;&
+0000e440: 6e62 7370 3b43 616e 6365 6c3c 2f62 7574  nbsp;Cancel</but
+0000e450: 746f 6e3e 0a20 2020 2020 2020 2020 2020  ton>.           
+0000e460: 2020 2020 203c 6275 7474 6f6e 2074 7970       <button typ
+0000e470: 653d 2762 7574 746f 6e27 2063 6c61 7373  e='button' class
+0000e480: 3d27 6163 7469 6f6e 6275 7474 6f6e 273e  ='actionbutton'>
+0000e490: 3c69 2063 6c61 7373 3d27 6661 7327 3e5c  <i class='fas'>\
+0000e4a0: 7566 3166 383c 2f69 3e26 6e62 7370 3b26  uf1f8</i>&nbsp;&
+0000e4b0: 6e62 7370 3b44 656c 6574 653c 2f62 7574  nbsp;Delete</but
+0000e4c0: 746f 6e3e 0a20 2020 2020 2020 2020 2020  ton>.           
+0000e4d0: 2020 2020 203c 6275 7474 6f6e 2074 7970       <button typ
+0000e4e0: 653d 2762 7574 746f 6e27 2063 6c61 7373  e='button' class
+0000e4f0: 3d27 6163 7469 6f6e 6275 7474 6f6e 273e  ='actionbutton'>
+0000e500: 3c69 2063 6c61 7373 3d27 6661 7327 3e5c  <i class='fas'>\
+0000e510: 7566 3234 643c 2f69 3e26 6e62 7370 3b26  uf24d</i>&nbsp;&
+0000e520: 6e62 7370 3b52 6573 756d 653c 2f62 7574  nbsp;Resume</but
+0000e530: 746f 6e3e 0a20 2020 2020 2020 2020 2020  ton>.           
+0000e540: 2020 2020 203c 6275 7474 6f6e 2074 7970       <button typ
+0000e550: 653d 2762 7574 746f 6e27 2063 6c61 7373  e='button' class
+0000e560: 3d27 6163 7469 6f6e 6275 7474 6f6e 2073  ='actionbutton s
+0000e570: 7562 6d69 7427 3e53 7562 6d69 743c 2f62  ubmit'>Submit</b
+0000e580: 7574 746f 6e3e 0a20 2020 2020 2020 2020  utton>.         
+0000e590: 2020 203c 2f64 6976 3e0a 2020 2020 2020     </div>.      
+0000e5a0: 2020 2020 2020 3c62 7574 746f 6e20 7479        <button ty
+0000e5b0: 7065 3d27 6275 7474 6f6e 2720 7374 796c  pe='button' styl
+0000e5c0: 653d 2766 6c6f 6174 3a72 6967 6874 3b27  e='float:right;'
+0000e5d0: 2063 6c61 7373 3d27 6163 7469 6f6e 6275   class='actionbu
+0000e5e0: 7474 6f6e 273e 436f 6e66 6972 6d20 6465  tton'>Confirm de
+0000e5f0: 6c65 7469 6e67 2074 6869 7320 7265 636f  leting this reco
+0000e600: 7264 3c2f 6275 7474 6f6e 3e0a 2020 2020  rd</button>.    
+0000e610: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000e620: 7365 6c66 2e6d 6169 6e64 6976 2e69 6e6e  self.maindiv.inn
+0000e630: 6572 4854 4d4c 203d 2068 746d 6c0a 0a20  erHTML = html.. 
+0000e640: 2020 2020 2020 2023 2055 6e70 6163 6b20         # Unpack 
+0000e650: 736f 2077 6520 6861 7665 2061 6c6c 2074  so we have all t
+0000e660: 6865 2063 6f6d 706f 6e65 6e74 730a 2020  he components.  
+0000e670: 2020 2020 2020 280a 2020 2020 2020 2020        (.        
+0000e680: 2020 2020 6831 2c20 2023 2044 6961 6c6f      h1,  # Dialo
+0000e690: 6720 7469 746c 650a 2020 2020 2020 2020  g title.        
+0000e6a0: 2020 2020 7365 6c66 2e5f 6473 5f68 6561      self._ds_hea
+0000e6b0: 6465 722c 0a20 2020 2020 2020 2020 2020  der,.           
+0000e6c0: 2073 656c 662e 5f64 735f 636f 6e74 6169   self._ds_contai
+0000e6d0: 6e65 722c 0a20 2020 2020 2020 2020 2020  ner,.           
+0000e6e0: 2073 656c 662e 5f70 7265 7365 745f 636f   self._preset_co
+0000e6f0: 6e74 6169 6e65 722c 0a20 2020 2020 2020  ntainer,.       
+0000e700: 2020 2020 2073 656c 662e 5f74 6167 735f       self._tags_
+0000e710: 6469 762c 0a20 2020 2020 2020 2020 2020  div,.           
+0000e720: 2073 656c 662e 5f74 6167 5f68 696e 7473   self._tag_hints
+0000e730: 5f64 6976 2c0a 2020 2020 2020 2020 2020  _div,.          
+0000e740: 2020 5f2c 2020 2320 5469 6d65 2068 6561    _,  # Time hea
+0000e750: 6465 720a 2020 2020 2020 2020 2020 2020  der.            
+0000e760: 7365 6c66 2e5f 7469 6d65 5f6e 6f64 652c  self._time_node,
+0000e770: 0a20 2020 2020 2020 2020 2020 205f 2c20  .            _, 
+0000e780: 2023 2053 706c 6974 7465 720a 2020 2020   # Splitter.    
+0000e790: 2020 2020 2020 2020 7365 6c66 2e5f 6275          self._bu
+0000e7a0: 7474 6f6e 732c 0a20 2020 2020 2020 2020  ttons,.         
+0000e7b0: 2020 2073 656c 662e 5f64 656c 6574 655f     self._delete_
+0000e7c0: 6275 7432 2c0a 2020 2020 2020 2020 2920  but2,.        ) 
+0000e7d0: 3d20 7365 6c66 2e6d 6169 6e64 6976 2e63  = self.maindiv.c
+0000e7e0: 6869 6c64 7265 6e0a 2020 2020 2020 2020  hildren.        
+0000e7f0: 230a 2020 2020 2020 2020 7365 6c66 2e5f  #.        self._
+0000e800: 6473 5f69 6e70 7574 203d 2073 656c 662e  ds_input = self.
+0000e810: 5f64 735f 636f 6e74 6169 6e65 722e 6368  _ds_container.ch
+0000e820: 696c 6472 656e 5b30 5d0a 2020 2020 2020  ildren[0].      
+0000e830: 2020 7365 6c66 2e5f 6175 746f 636f 6d70    self._autocomp
+0000e840: 6c65 7465 725f 6469 7620 3d20 7365 6c66  leter_div = self
+0000e850: 2e5f 6473 5f63 6f6e 7461 696e 6572 2e63  ._ds_container.c
+0000e860: 6869 6c64 7265 6e5b 315d 0a20 2020 2020  hildren[1].     
+0000e870: 2020 2073 656c 662e 5f72 6563 656e 745f     self._recent_
+0000e880: 6275 7420 3d20 7365 6c66 2e5f 7072 6573  but = self._pres
+0000e890: 6574 5f63 6f6e 7461 696e 6572 2e63 6869  et_container.chi
+0000e8a0: 6c64 7265 6e5b 335d 0a20 2020 2020 2020  ldren[3].       
+0000e8b0: 2073 656c 662e 5f74 6167 735f 6275 7420   self._tags_but 
+0000e8c0: 3d20 7365 6c66 2e5f 7072 6573 6574 5f63  = self._preset_c
+0000e8d0: 6f6e 7461 696e 6572 2e63 6869 6c64 7265  ontainer.childre
+0000e8e0: 6e5b 325d 0a20 2020 2020 2020 2073 656c  n[2].        sel
+0000e8f0: 662e 5f70 7265 7365 745f 6275 7420 3d20  f._preset_but = 
+0000e900: 7365 6c66 2e5f 7072 6573 6574 5f63 6f6e  self._preset_con
+0000e910: 7461 696e 6572 2e63 6869 6c64 7265 6e5b  tainer.children[
+0000e920: 315d 0a20 2020 2020 2020 2073 656c 662e  1].        self.
+0000e930: 5f70 7265 7365 745f 6564 6974 203d 2073  _preset_edit = s
+0000e940: 656c 662e 5f70 7265 7365 745f 636f 6e74  elf._preset_cont
+0000e950: 6169 6e65 722e 6368 696c 6472 656e 5b30  ainer.children[0
+0000e960: 5d0a 2020 2020 2020 2020 7365 6c66 2e5f  ].        self._
+0000e970: 7469 746c 655f 6469 7620 3d20 6831 2e63  title_div = h1.c
+0000e980: 6869 6c64 7265 6e5b 315d 0a20 2020 2020  hildren[1].     
+0000e990: 2020 2073 656c 662e 5f63 616e 6365 6c5f     self._cancel_
+0000e9a0: 6275 7431 203d 2073 656c 662e 6d61 696e  but1 = self.main
+0000e9b0: 6469 762e 6368 696c 6472 656e 5b30 5d2e  div.children[0].
+0000e9c0: 6368 696c 6472 656e 5b2d 315d 0a20 2020  children[-1].   
+0000e9d0: 2020 2020 2028 0a20 2020 2020 2020 2020       (.         
+0000e9e0: 2020 2073 656c 662e 5f63 616e 6365 6c5f     self._cancel_
+0000e9f0: 6275 7432 2c0a 2020 2020 2020 2020 2020  but2,.          
+0000ea00: 2020 7365 6c66 2e5f 6465 6c65 7465 5f62    self._delete_b
+0000ea10: 7574 312c 0a20 2020 2020 2020 2020 2020  ut1,.           
+0000ea20: 2073 656c 662e 5f72 6573 756d 655f 6275   self._resume_bu
+0000ea30: 742c 0a20 2020 2020 2020 2020 2020 2073  t,.            s
+0000ea40: 656c 662e 5f73 7562 6d69 745f 6275 742c  elf._submit_but,
+0000ea50: 0a20 2020 2020 2020 2029 203d 2073 656c  .        ) = sel
+0000ea60: 662e 5f62 7574 746f 6e73 2e63 6869 6c64  f._buttons.child
+0000ea70: 7265 6e0a 0a20 2020 2020 2020 2023 2043  ren..        # C
+0000ea80: 7265 6174 6520 7468 6520 7374 6172 7473  reate the starts
+0000ea90: 746f 702d 6564 6974 0a20 2020 2020 2020  top-edit.       
+0000eaa0: 2073 656c 662e 5f74 696d 655f 6564 6974   self._time_edit
+0000eab0: 203d 2053 7461 7274 5374 6f70 4564 6974   = StartStopEdit
+0000eac0: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
+0000ead0: 6c66 2e5f 7469 6d65 5f6e 6f64 652c 2073  lf._time_node, s
+0000eae0: 656c 662e 5f6f 6e5f 7469 6d65 735f 6368  elf._on_times_ch
+0000eaf0: 616e 6765 2c20 7265 636f 7264 2e74 312c  ange, record.t1,
+0000eb00: 2072 6563 6f72 642e 7432 2c20 6d6f 6465   record.t2, mode
+0000eb10: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+0000eb20: 2020 2020 2320 5072 6570 6172 6520 6175      # Prepare au
+0000eb30: 746f 636f 6d70 6c65 7469 6f6e 0a20 2020  tocompletion.   
+0000eb40: 2020 2020 2073 656c 662e 5f61 7574 6f63       self._autoc
+0000eb50: 6f6d 706c 6574 6572 203d 2041 7574 6f63  ompleter = Autoc
+0000eb60: 6f6d 706c 6574 6572 280a 2020 2020 2020  ompleter(.      
+0000eb70: 2020 2020 2020 7365 6c66 2e5f 6175 746f        self._auto
+0000eb80: 636f 6d70 6c65 7465 725f 6469 762c 2073  completer_div, s
+0000eb90: 656c 662e 5f64 735f 696e 7075 742c 2073  elf._ds_input, s
+0000eba0: 656c 662e 5f61 7574 6f63 6f6d 705f 6669  elf._autocomp_fi
+0000ebb0: 6e69 7368 6564 0a20 2020 2020 2020 2029  nished.        )
+0000ebc0: 0a0a 2020 2020 2020 2020 2320 5365 7420  ..        # Set 
+0000ebd0: 736f 6d65 2069 6e69 7469 616c 2076 616c  some initial val
+0000ebe0: 7565 730a 2020 2020 2020 2020 7365 6c66  ues.        self
+0000ebf0: 2e5f 6473 5f69 6e70 7574 2e76 616c 7565  ._ds_input.value
+0000ec00: 203d 2072 6563 6f72 642e 6765 7428 2264   = record.get("d
+0000ec10: 7322 2c20 2222 290a 2020 2020 2020 2020  s", "").        
+0000ec20: 7365 6c66 2e5f 7368 6f77 5f74 6167 735f  self._show_tags_
+0000ec30: 6672 6f6d 5f64 7328 290a 2020 2020 2020  from_ds().      
+0000ec40: 2020 7365 6c66 2e5f 6465 6c65 7465 5f62    self._delete_b
+0000ec50: 7574 322e 7374 796c 652e 6469 7370 6c61  ut2.style.displa
+0000ec60: 7920 3d20 226e 6f6e 6522 0a20 2020 2020  y = "none".     
+0000ec70: 2020 2073 656c 662e 5f6e 6f5f 7573 6572     self._no_user
+0000ec80: 5f65 6469 745f 7965 7420 3d20 5472 7565  _edit_yet = True
+0000ec90: 0a0a 2020 2020 2020 2020 2320 5368 6f77  ..        # Show
+0000eca0: 2074 6865 2072 6967 6874 2062 7574 746f   the right butto
+0000ecb0: 6e73 0a20 2020 2020 2020 2073 656c 662e  ns.        self.
+0000ecc0: 5f73 6574 5f6d 6f64 6528 6d6f 6465 290a  _set_mode(mode).
+0000ecd0: 0a20 2020 2020 2020 2023 2043 6f6e 6e65  .        # Conne
+0000ece0: 6374 2074 6869 6e67 7320 7570 0a20 2020  ct things up.   
+0000ecf0: 2020 2020 2073 656c 662e 5f63 616e 6365       self._cance
+0000ed00: 6c5f 6275 7431 2e6f 6e63 6c69 636b 203d  l_but1.onclick =
+0000ed10: 2073 656c 662e 636c 6f73 650a 2020 2020   self.close.    
+0000ed20: 2020 2020 7365 6c66 2e5f 6361 6e63 656c      self._cancel
+0000ed30: 5f62 7574 322e 6f6e 636c 6963 6b20 3d20  _but2.onclick = 
+0000ed40: 7365 6c66 2e63 6c6f 7365 0a20 2020 2020  self.close.     
+0000ed50: 2020 2073 656c 662e 5f73 7562 6d69 745f     self._submit_
+0000ed60: 6275 742e 6f6e 636c 6963 6b20 3d20 7365  but.onclick = se
+0000ed70: 6c66 2e73 7562 6d69 745f 736f 6f6e 0a20  lf.submit_soon. 
+0000ed80: 2020 2020 2020 2073 656c 662e 5f72 6573         self._res
+0000ed90: 756d 655f 6275 742e 6f6e 636c 6963 6b20  ume_but.onclick 
+0000eda0: 3d20 7365 6c66 2e72 6573 756d 655f 7265  = self.resume_re
+0000edb0: 636f 7264 0a20 2020 2020 2020 2073 656c  cord.        sel
+0000edc0: 662e 5f64 735f 696e 7075 742e 6f6e 696e  f._ds_input.onin
+0000edd0: 7075 7420 3d20 7365 6c66 2e5f 6f6e 5f75  put = self._on_u
+0000ede0: 7365 725f 6564 6974 0a20 2020 2020 2020  ser_edit.       
+0000edf0: 2073 656c 662e 5f64 735f 696e 7075 742e   self._ds_input.
+0000ee00: 6f6e 626c 7572 203d 2073 656c 662e 5f6f  onblur = self._o
+0000ee10: 6e5f 7573 6572 5f65 6469 745f 646f 6e65  n_user_edit_done
+0000ee20: 0a20 2020 2020 2020 2073 656c 662e 5f72  .        self._r
+0000ee30: 6563 656e 745f 6275 742e 6f6e 636c 6963  ecent_but.onclic
+0000ee40: 6b20 3d20 7365 6c66 2e73 686f 775f 7265  k = self.show_re
+0000ee50: 6365 6e74 5f64 6573 6372 6970 7469 6f6e  cent_description
+0000ee60: 730a 2020 2020 2020 2020 7365 6c66 2e5f  s.        self._
+0000ee70: 7461 6773 5f62 7574 2e6f 6e63 6c69 636b  tags_but.onclick
+0000ee80: 203d 2073 656c 662e 7368 6f77 5f72 6563   = self.show_rec
+0000ee90: 656e 745f 7461 6773 0a20 2020 2020 2020  ent_tags.       
+0000eea0: 2073 656c 662e 5f70 7265 7365 745f 6275   self._preset_bu
+0000eeb0: 742e 6f6e 636c 6963 6b20 3d20 7365 6c66  t.onclick = self
+0000eec0: 2e73 686f 775f 7072 6573 6574 730a 2020  .show_presets.  
+0000eed0: 2020 2020 2020 7365 6c66 2e5f 7072 6573        self._pres
+0000eee0: 6574 5f65 6469 742e 6f6e 636c 6963 6b20  et_edit.onclick 
+0000eef0: 3d20 6c61 6d62 6461 3a20 7365 6c66 2e5f  = lambda: self._
+0000ef00: 6361 6e76 6173 2e74 6167 5f70 7265 7365  canvas.tag_prese
+0000ef10: 745f 6469 616c 6f67 2e6f 7065 6e28 290a  t_dialog.open().
+0000ef20: 2020 2020 2020 2020 7365 6c66 2e5f 6465          self._de
+0000ef30: 6c65 7465 5f62 7574 312e 6f6e 636c 6963  lete_but1.onclic
+0000ef40: 6b20 3d20 7365 6c66 2e5f 6465 6c65 7465  k = self._delete
+0000ef50: 310a 2020 2020 2020 2020 7365 6c66 2e5f  1.        self._
+0000ef60: 6465 6c65 7465 5f62 7574 322e 6f6e 636c  delete_but2.oncl
+0000ef70: 6963 6b20 3d20 7365 6c66 2e5f 6465 6c65  ick = self._dele
+0000ef80: 7465 320a 2020 2020 2020 2020 7365 6c66  te2.        self
+0000ef90: 2e6d 6169 6e64 6976 2e61 6464 4576 656e  .maindiv.addEven
+0000efa0: 744c 6973 7465 6e65 7228 2263 6c69 636b  tListener("click
+0000efb0: 222c 2073 656c 662e 5f61 7574 6f63 6f6d  ", self._autocom
+0000efc0: 706c 6574 6572 2e63 6c65 6172 290a 0a20  pleter.clear).. 
+0000efd0: 2020 2020 2020 2023 2045 6e61 626c 6520         # Enable 
+0000efe0: 666f 7220 736f 6d65 206d 6f72 6520 696e  for some more in
+0000eff0: 666f 2028 652e 672e 2064 7572 696e 6720  fo (e.g. during 
+0000f000: 6465 7629 0a20 2020 2020 2020 2069 6620  dev).        if 
+0000f010: 4661 6c73 653a 0a20 2020 2020 2020 2020  False:.         
+0000f020: 2020 2066 6f72 2078 2069 6e20 5b66 2249     for x in [f"I
+0000f030: 443a 207b 7265 636f 7264 2e6b 6579 7d22  D: {record.key}"
+0000f040: 2c20 6622 4d6f 6469 6669 6564 3a20 7b64  , f"Modified: {d
+0000f050: 742e 7469 6d65 326c 6f63 616c 7374 7228  t.time2localstr(
+0000f060: 7265 636f 7264 2e6d 7429 7d22 5d3a 0a20  record.mt)}"]:. 
+0000f070: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000f080: 6c20 3d20 646f 6375 6d65 6e74 2e63 7265  l = document.cre
+0000f090: 6174 6545 6c65 6d65 6e74 2822 6469 7622  ateElement("div"
+0000f0a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000f0b0: 2020 656c 2e69 6e6e 6572 5465 7874 203d    el.innerText =
+0000f0c0: 2078 0a20 2020 2020 2020 2020 2020 2020   x.             
+0000f0d0: 2020 2073 656c 662e 6d61 696e 6469 762e     self.maindiv.
+0000f0e0: 6170 7065 6e64 4368 696c 6428 656c 290a  appendChild(el).
+0000f0f0: 0a20 2020 2020 2020 2023 2041 6c6d 6f73  .        # Almos
+0000f100: 7420 646f 6e65 2e20 466f 6375 7320 6f6e  t done. Focus on
+0000f110: 2064 7320 6966 2074 6869 7320 6c6f 6f6b   ds if this look
+0000f120: 7320 6c69 6b65 2064 6573 6b74 6f70 3b20  s like desktop; 
+0000f130: 6974 2773 2061 6e6f 7969 6e67 206f 6e20  it's anoying on 
+0000f140: 6d6f 6269 6c65 0a20 2020 2020 2020 2073  mobile.        s
+0000f150: 7570 6572 2829 2e6f 7065 6e28 6361 6c6c  uper().open(call
+0000f160: 6261 636b 290a 2020 2020 2020 2020 6966  back).        if
+0000f170: 2075 7469 6c73 2e6c 6f6f 6b73 5f6c 696b   utils.looks_lik
+0000f180: 655f 6465 736b 746f 7028 293a 0a20 2020  e_desktop():.   
+0000f190: 2020 2020 2020 2020 2073 656c 662e 5f64           self._d
+0000f1a0: 735f 696e 7075 742e 666f 6375 7328 290a  s_input.focus().
+0000f1b0: 0a20 2020 2064 6566 205f 6175 746f 636f  .    def _autoco
+0000f1c0: 6d70 5f66 696e 6973 6865 6428 7365 6c66  mp_finished(self
+0000f1d0: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
+0000f1e0: 5f73 686f 775f 7461 6773 5f66 726f 6d5f  _show_tags_from_
+0000f1f0: 6473 2829 0a20 2020 2020 2020 2073 656c  ds().        sel
+0000f200: 662e 5f6d 6172 6b5f 6173 5f65 6469 7465  f._mark_as_edite
+0000f210: 6428 290a 0a20 2020 2064 6566 205f 7365  d()..    def _se
+0000f220: 745f 6d6f 6465 2873 656c 662c 206d 6f64  t_mode(self, mod
+0000f230: 6529 3a0a 2020 2020 2020 2020 7365 6c66  e):.        self
+0000f240: 2e5f 6c6d 6f64 6520 3d20 6c6d 6f64 6520  ._lmode = lmode 
+0000f250: 3d20 6d6f 6465 2e6c 6f77 6572 2829 0a20  = mode.lower(). 
+0000f260: 2020 2020 2020 2073 656c 662e 5f74 6974         self._tit
+0000f270: 6c65 5f64 6976 2e69 6e6e 6572 5465 7874  le_div.innerText
+0000f280: 203d 2066 227b 6d6f 6465 7d20 7265 636f   = f"{mode} reco
+0000f290: 7264 220a 2020 2020 2020 2020 6973 5f72  rd".        is_r
+0000f2a0: 756e 6e69 6e67 203d 2073 656c 662e 5f72  unning = self._r
+0000f2b0: 6563 6f72 642e 7431 203d 3d20 7365 6c66  ecord.t1 == self
+0000f2c0: 2e5f 7265 636f 7264 2e74 320a 2020 2020  ._record.t2.    
+0000f2d0: 2020 2020 2320 6861 735f 7275 6e6e 696e      # has_runnin
+0000f2e0: 6720 3d20 6c65 6e28 7769 6e64 6f77 2e73  g = len(window.s
+0000f2f0: 746f 7265 2e72 6563 6f72 6473 2e67 6574  tore.records.get
+0000f300: 5f72 756e 6e69 6e67 5f72 6563 6f72 6473  _running_records
+0000f310: 2829 2920 3e20 300a 2020 2020 2020 2020  ()) > 0.        
+0000f320: 2320 5365 7420 6465 7363 7269 7074 696f  # Set descriptio
+0000f330: 6e20 706c 6163 6568 6f6c 6465 720a 2020  n placeholder.  
+0000f340: 2020 2020 2020 6966 206c 6d6f 6465 203d        if lmode =
+0000f350: 3d20 2273 7461 7274 223a 0a20 2020 2020  = "start":.     
+0000f360: 2020 2020 2020 2073 656c 662e 5f64 735f         self._ds_
+0000f370: 696e 7075 742e 7365 7441 7474 7269 6275  input.setAttribu
+0000f380: 7465 2822 706c 6163 6568 6f6c 6465 7222  te("placeholder"
+0000f390: 2c20 2257 6861 7420 6172 6520 796f 7520  , "What are you 
+0000f3a0: 676f 696e 6720 746f 2064 6f3f 2229 0a20  going to do?"). 
+0000f3b0: 2020 2020 2020 2065 6c69 6620 6c6d 6f64         elif lmod
+0000f3c0: 6520 3d3d 2022 6e65 7722 3a0a 2020 2020  e == "new":.    
+0000f3d0: 2020 2020 2020 2020 7365 6c66 2e5f 6473          self._ds
+0000f3e0: 5f69 6e70 7574 2e73 6574 4174 7472 6962  _input.setAttrib
+0000f3f0: 7574 6528 2270 6c61 6365 686f 6c64 6572  ute("placeholder
+0000f400: 222c 2022 5768 6174 2068 6176 6520 796f  ", "What have yo
+0000f410: 7520 646f 6e65 3f22 290a 2020 2020 2020  u done?").      
+0000f420: 2020 656c 6966 206c 6d6f 6465 203d 3d20    elif lmode == 
+0000f430: 2273 746f 7022 3a0a 2020 2020 2020 2020  "stop":.        
+0000f440: 2020 2020 7365 6c66 2e5f 6473 5f69 6e70      self._ds_inp
+0000f450: 7574 2e73 6574 4174 7472 6962 7574 6528  ut.setAttribute(
+0000f460: 2270 6c61 6365 686f 6c64 6572 222c 2022  "placeholder", "
+0000f470: 5768 6174 2064 6964 2079 6f75 206a 7573  What did you jus
+0000f480: 7420 646f 3f22 290a 2020 2020 2020 2020  t do?").        
+0000f490: 656c 6966 2069 735f 7275 6e6e 696e 673a  elif is_running:
+0000f4a0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000f4b0: 662e 5f64 735f 696e 7075 742e 7365 7441  f._ds_input.setA
+0000f4c0: 7474 7269 6275 7465 2822 706c 6163 6568  ttribute("placeh
+0000f4d0: 6f6c 6465 7222 2c20 2257 6861 7420 6172  older", "What ar
+0000f4e0: 6520 796f 7520 646f 696e 673f 2229 0a20  e you doing?"). 
+0000f4f0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000f500: 2020 2020 2020 2020 2073 656c 662e 5f64           self._d
+0000f510: 735f 696e 7075 742e 7365 7441 7474 7269  s_input.setAttri
+0000f520: 6275 7465 2822 706c 6163 6568 6f6c 6465  bute("placeholde
+0000f530: 7222 2c20 2257 6861 7420 6861 7320 6265  r", "What has be
+0000f540: 656e 2064 6f6e 653f 2229 0a20 2020 2020  en done?").     
+0000f550: 2020 2023 2054 7765 616b 2074 6865 2062     # Tweak the b
+0000f560: 7574 746f 6e73 2061 7420 7468 6520 626f  uttons at the bo
+0000f570: 7474 6f6d 0a20 2020 2020 2020 2069 6620  ttom.        if 
+0000f580: 6c6d 6f64 6520 3d3d 2022 7374 6172 7422  lmode == "start"
+0000f590: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+0000f5a0: 6c66 2e5f 7375 626d 6974 5f62 7574 2e69  lf._submit_but.i
+0000f5b0: 6e6e 6572 4854 4d4c 203d 2022 3c69 2063  nnerHTML = "<i c
+0000f5c0: 6c61 7373 3d27 6661 7327 3e5c 7566 3034  lass='fas'>\uf04
+0000f5d0: 623c 2f69 3e26 6e62 7370 3b26 6e62 7370  b</i>&nbsp;&nbsp
+0000f5e0: 3b53 7461 7274 220a 2020 2020 2020 2020  ;Start".        
+0000f5f0: 2020 2020 7365 6c66 2e5f 7265 7375 6d65      self._resume
+0000f600: 5f62 7574 2e73 7479 6c65 2e64 6973 706c  _but.style.displ
+0000f610: 6179 203d 2022 6e6f 6e65 220a 2020 2020  ay = "none".    
+0000f620: 2020 2020 2020 2020 7365 6c66 2e5f 6465          self._de
+0000f630: 6c65 7465 5f62 7574 312e 7374 796c 652e  lete_but1.style.
+0000f640: 6469 7370 6c61 7920 3d20 226e 6f6e 6522  display = "none"
+0000f650: 0a20 2020 2020 2020 2065 6c69 6620 6c6d  .        elif lm
+0000f660: 6f64 6520 3d3d 2022 6e65 7722 3a0a 2020  ode == "new":.  
+0000f670: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+0000f680: 7375 626d 6974 5f62 7574 2e69 6e6e 6572  submit_but.inner
+0000f690: 4854 4d4c 203d 2022 3c69 2063 6c61 7373  HTML = "<i class
+0000f6a0: 3d27 6661 7327 3e5c 7566 3036 373c 2f69  ='fas'>\uf067</i
+0000f6b0: 3e26 6e62 7370 3b26 6e62 7370 3b43 7265  >&nbsp;&nbsp;Cre
+0000f6c0: 6174 6522 0a20 2020 2020 2020 2020 2020  ate".           
+0000f6d0: 2073 656c 662e 5f72 6573 756d 655f 6275   self._resume_bu
+0000f6e0: 742e 7374 796c 652e 6469 7370 6c61 7920  t.style.display 
+0000f6f0: 3d20 226e 6f6e 6522 0a20 2020 2020 2020  = "none".       
+0000f700: 2020 2020 2073 656c 662e 5f64 656c 6574       self._delet
+0000f710: 655f 6275 7431 2e73 7479 6c65 2e64 6973  e_but1.style.dis
+0000f720: 706c 6179 203d 2022 6e6f 6e65 220a 2020  play = "none".  
+0000f730: 2020 2020 2020 656c 6966 206c 6d6f 6465        elif lmode
+0000f740: 203d 3d20 2265 6469 7422 3a0a 2020 2020   == "edit":.    
+0000f750: 2020 2020 2020 2020 7365 6c66 2e5f 7375          self._su
+0000f760: 626d 6974 5f62 7574 2e69 6e6e 6572 4854  bmit_but.innerHT
+0000f770: 4d4c 203d 2022 3c69 2063 6c61 7373 3d27  ML = "<i class='
+0000f780: 6661 7327 3e5c 7566 3330 343c 2f69 3e26  fas'>\uf304</i>&
+0000f790: 6e62 7370 3b26 6e62 7370 3b53 6176 6522  nbsp;&nbsp;Save"
+0000f7a0: 0a20 2020 2020 2020 2020 2020 2074 6974  .            tit
+0000f7b0: 6c65 5f6d 6f64 6520 3d20 2245 6469 7420  le_mode = "Edit 
+0000f7c0: 7275 6e6e 696e 6722 2069 6620 6973 5f72  running" if is_r
+0000f7d0: 756e 6e69 6e67 2065 6c73 6520 2245 6469  unning else "Edi
+0000f7e0: 7422 0a20 2020 2020 2020 2020 2020 2073  t".            s
+0000f7f0: 656c 662e 5f74 6974 6c65 5f64 6976 2e69  elf._title_div.i
+0000f800: 6e6e 6572 5465 7874 203d 2066 227b 7469  nnerText = f"{ti
+0000f810: 746c 655f 6d6f 6465 7d20 7265 636f 7264  tle_mode} record
+0000f820: 220a 2020 2020 2020 2020 2020 2020 7365  ".            se
+0000f830: 6c66 2e5f 7375 626d 6974 5f62 7574 2e64  lf._submit_but.d
+0000f840: 6973 6162 6c65 6420 3d20 7365 6c66 2e5f  isabled = self._
+0000f850: 6e6f 5f75 7365 725f 6564 6974 5f79 6574  no_user_edit_yet
+0000f860: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000f870: 662e 5f72 6573 756d 655f 6275 742e 7374  f._resume_but.st
+0000f880: 796c 652e 6469 7370 6c61 7920 3d20 226e  yle.display = "n
+0000f890: 6f6e 6522 2069 6620 6973 5f72 756e 6e69  one" if is_runni
+0000f8a0: 6e67 2065 6c73 6520 2262 6c6f 636b 220a  ng else "block".
+0000f8b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000f8c0: 2e5f 6465 6c65 7465 5f62 7574 312e 7374  ._delete_but1.st
+0000f8d0: 796c 652e 6469 7370 6c61 7920 3d20 2262  yle.display = "b
+0000f8e0: 6c6f 636b 220a 2020 2020 2020 2020 656c  lock".        el
+0000f8f0: 6966 206c 6d6f 6465 203d 3d20 2273 746f  if lmode == "sto
+0000f900: 7022 3a0a 2020 2020 2020 2020 2020 2020  p":.            
+0000f910: 7365 6c66 2e5f 7375 626d 6974 5f62 7574  self._submit_but
+0000f920: 2e69 6e6e 6572 4854 4d4c 203d 2022 3c69  .innerHTML = "<i
+0000f930: 2063 6c61 7373 3d27 6661 7327 3e5c 7566   class='fas'>\uf
+0000f940: 3034 643c 2f69 3e26 6e62 7370 3b26 6e62  04d</i>&nbsp;&nb
+0000f950: 7370 3b53 6176 6522 0a20 2020 2020 2020  sp;Save".       
+0000f960: 2020 2020 2073 656c 662e 5f72 6573 756d       self._resum
+0000f970: 655f 6275 742e 7374 796c 652e 6469 7370  e_but.style.disp
+0000f980: 6c61 7920 3d20 226e 6f6e 6522 0a20 2020  lay = "none".   
+0000f990: 2020 2020 2020 2020 2073 656c 662e 5f64           self._d
+0000f9a0: 656c 6574 655f 6275 7431 2e73 7479 6c65  elete_but1.style
+0000f9b0: 2e64 6973 706c 6179 203d 2022 626c 6f63  .display = "bloc
+0000f9c0: 6b22 0a20 2020 2020 2020 2065 6c73 653a  k".        else:
+0000f9d0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+0000f9e0: 736f 6c65 2e77 6172 6e28 2255 6e65 7870  sole.warn("Unexp
+0000f9f0: 6563 7465 6420 7265 636f 7264 2064 6961  ected record dia
+0000fa00: 6c6f 6720 6d6f 6465 2022 202b 206d 6f64  log mode " + mod
+0000fa10: 6529 0a0a 2020 2020 6465 6620 5f6d 6172  e)..    def _mar
+0000fa20: 6b5f 6173 5f65 6469 7465 6428 7365 6c66  k_as_edited(self
+0000fa30: 293a 0a20 2020 2020 2020 2069 6620 7365  ):.        if se
+0000fa40: 6c66 2e5f 6e6f 5f75 7365 725f 6564 6974  lf._no_user_edit
+0000fa50: 5f79 6574 3a0a 2020 2020 2020 2020 2020  _yet:.          
+0000fa60: 2020 7365 6c66 2e5f 6e6f 5f75 7365 725f    self._no_user_
+0000fa70: 6564 6974 5f79 6574 203d 2046 616c 7365  edit_yet = False
+0000fa80: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000fa90: 662e 5f73 7562 6d69 745f 6275 742e 6469  f._submit_but.di
+0000faa0: 7361 626c 6564 203d 2046 616c 7365 0a0a  sabled = False..
+0000fab0: 2020 2020 6465 6620 5f6f 6e5f 7573 6572      def _on_user
+0000fac0: 5f65 6469 7428 7365 6c66 293a 0a20 2020  _edit(self):.   
+0000fad0: 2020 2020 2073 656c 662e 5f6d 6172 6b5f       self._mark_
+0000fae0: 6173 5f65 6469 7465 6428 290a 2020 2020  as_edited().    
+0000faf0: 2020 2020 7365 6c66 2e5f 6175 746f 636f      self._autoco
+0000fb00: 6d70 6c65 7465 722e 696e 6974 2829 0a20  mpleter.init(). 
+0000fb10: 2020 2020 2020 2073 656c 662e 5f73 686f         self._sho
+0000fb20: 775f 7461 6773 5f66 726f 6d5f 6473 2829  w_tags_from_ds()
+0000fb30: 0a20 2020 2020 2020 2023 2049 6620 7468  .        # If th
+0000fb40: 6520 7374 7220 6973 2074 6f6f 206c 6f6e  e str is too lon
+0000fb50: 672c 206c 696d 6974 2069 740a 2020 2020  g, limit it.    
+0000fb60: 2020 2020 6966 206c 656e 2873 656c 662e      if len(self.
+0000fb70: 5f64 735f 696e 7075 742e 7661 6c75 6529  _ds_input.value)
+0000fb80: 203e 3d20 7374 6f72 6573 2e53 5452 5f4d   >= stores.STR_M
+0000fb90: 4158 3a0a 2020 2020 2020 2020 2020 2020  AX:.            
+0000fba0: 7365 6c66 2e5f 6473 5f69 6e70 7574 2e76  self._ds_input.v
+0000fbb0: 616c 7565 203d 2073 656c 662e 5f64 735f  alue = self._ds_
+0000fbc0: 696e 7075 742e 7661 6c75 652e 736c 6963  input.value.slic
+0000fbd0: 6528 302c 2073 746f 7265 732e 5354 525f  e(0, stores.STR_
+0000fbe0: 4d41 5829 0a20 2020 2020 2020 2020 2020  MAX).           
+0000fbf0: 2069 6620 226d 6178 2220 6e6f 7420 696e   if "max" not in
+0000fc00: 2073 656c 662e 5f64 735f 6865 6164 6572   self._ds_header
+0000fc10: 2e69 6e6e 6572 4854 4d4c 3a0a 2020 2020  .innerHTML:.    
+0000fc20: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000fc30: 2e5f 6473 5f68 6561 6465 722e 696e 6e65  ._ds_header.inne
+0000fc40: 7248 544d 4c20 2b3d 2028 0a20 2020 2020  rHTML += (.     
+0000fc50: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000fc60: 2220 3c73 6d61 6c6c 3e28 6d61 7820 7b73  " <small>(max {s
+0000fc70: 746f 7265 732e 5354 525f 4d41 582d 317d  tores.STR_MAX-1}
+0000fc80: 2063 6861 7273 293c 2f73 6d61 6c6c 3e22   chars)</small>"
+0000fc90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fca0: 2029 0a20 2020 2020 2020 2020 2020 2073   ).            s
+0000fcb0: 656c 662e 5f64 735f 696e 7075 742e 7374  elf._ds_input.st
+0000fcc0: 796c 652e 7365 7450 726f 7065 7274 7928  yle.setProperty(
+0000fcd0: 226f 7574 6c69 6e65 222c 2022 6461 7368  "outline", "dash
+0000fce0: 6564 2032 7078 2072 6564 2229 0a20 2020  ed 2px red").   
+0000fcf0: 2020 2020 2020 2020 2072 6573 6574 203d           reset =
+0000fd00: 206c 616d 6264 613a 2073 656c 662e 5f64   lambda: self._d
+0000fd10: 735f 696e 7075 742e 7374 796c 652e 7365  s_input.style.se
+0000fd20: 7450 726f 7065 7274 7928 226f 7574 6c69  tProperty("outli
+0000fd30: 6e65 222c 2022 2229 0a20 2020 2020 2020  ne", "").       
+0000fd40: 2020 2020 2077 696e 646f 772e 7365 7454       window.setT
+0000fd50: 696d 656f 7574 2872 6573 6574 2c20 3230  imeout(reset, 20
+0000fd60: 3030 290a 0a20 2020 2064 6566 2073 686f  00)..    def sho
+0000fd70: 775f 7072 6573 6574 7328 7365 6c66 2c20  w_presets(self, 
+0000fd80: 6529 3a0a 2020 2020 2020 2020 2320 5072  e):.        # Pr
+0000fd90: 6576 656e 7420 7468 6174 2074 6865 2063  event that the c
+0000fda0: 6c69 636b 2077 696c 6c20 6869 6465 2074  lick will hide t
+0000fdb0: 6865 2061 7574 6f63 6f6d 700a 2020 2020  he autocomp.    
+0000fdc0: 2020 2020 6966 2065 2061 6e64 2065 2e73      if e and e.s
+0000fdd0: 746f 7050 726f 7061 6761 7469 6f6e 3a0a  topPropagation:.
+0000fde0: 2020 2020 2020 2020 2020 2020 652e 7374              e.st
+0000fdf0: 6f70 5072 6f70 6167 6174 696f 6e28 290a  opPropagation().
+0000fe00: 2020 2020 2020 2020 7365 6c66 2e5f 6175          self._au
+0000fe10: 746f 636f 6d70 6c65 7465 722e 7368 6f77  tocompleter.show
+0000fe20: 5f73 7567 6765 7374 696f 6e73 2822 7072  _suggestions("pr
+0000fe30: 6573 6574 7322 290a 2020 2020 2020 2020  esets").        
+0000fe40: 2320 4e6f 7465 3a20 646f 6e27 7420 6769  # Note: don't gi
+0000fe50: 7665 2064 735f 696e 7075 7420 666f 6375  ve ds_input focu
+0000fe60: 732c 2062 6563 6175 7365 2074 6861 7420  s, because that 
+0000fe70: 7769 6c6c 2070 6f70 2075 7020 7468 650a  will pop up the.
+0000fe80: 2020 2020 2020 2020 2320 6b65 7962 6f61          # keyboa
+0000fe90: 7264 206f 6e20 6d6f 6269 6c65 2064 6576  rd on mobile dev
+0000fea0: 6963 6573 0a0a 2020 2020 6465 6620 7368  ices..    def sh
+0000feb0: 6f77 5f72 6563 656e 745f 7461 6773 2873  ow_recent_tags(s
+0000fec0: 656c 662c 2065 293a 0a20 2020 2020 2020  elf, e):.       
+0000fed0: 2023 2050 7265 7665 6e74 2074 6861 7420   # Prevent that 
+0000fee0: 7468 6520 636c 6963 6b20 7769 6c6c 2068  the click will h
+0000fef0: 6964 6520 7468 6520 6175 746f 636f 6d70  ide the autocomp
+0000ff00: 0a20 2020 2020 2020 2069 6620 6520 616e  .        if e an
+0000ff10: 6420 652e 7374 6f70 5072 6f70 6167 6174  d e.stopPropagat
+0000ff20: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
+0000ff30: 2065 2e73 746f 7050 726f 7061 6761 7469   e.stopPropagati
+0000ff40: 6f6e 2829 0a20 2020 2020 2020 2073 656c  on().        sel
+0000ff50: 662e 5f61 7574 6f63 6f6d 706c 6574 6572  f._autocompleter
+0000ff60: 2e73 686f 775f 7375 6767 6573 7469 6f6e  .show_suggestion
+0000ff70: 7328 2274 6167 7322 290a 0a20 2020 2064  s("tags")..    d
+0000ff80: 6566 2073 686f 775f 7265 6365 6e74 5f64  ef show_recent_d
+0000ff90: 6573 6372 6970 7469 6f6e 7328 7365 6c66  escriptions(self
+0000ffa0: 2c20 6529 3a0a 2020 2020 2020 2020 6966  , e):.        if
+0000ffb0: 2065 2061 6e64 2065 2e73 746f 7050 726f   e and e.stopPro
+0000ffc0: 7061 6761 7469 6f6e 3a0a 2020 2020 2020  pagation:.      
+0000ffd0: 2020 2020 2020 652e 7374 6f70 5072 6f70        e.stopProp
+0000ffe0: 6167 6174 696f 6e28 290a 2020 2020 2020  agation().      
+0000fff0: 2020 7365 6c66 2e5f 6175 746f 636f 6d70    self._autocomp
+00010000: 6c65 7465 722e 7368 6f77 5f73 7567 6765  leter.show_sugge
+00010010: 7374 696f 6e73 2822 6465 7363 7269 7074  stions("descript
+00010020: 696f 6e73 2229 0a0a 2020 2020 6465 6620  ions")..    def 
+00010030: 5f61 6464 5f74 6167 2873 656c 662c 2074  _add_tag(self, t
+00010040: 6167 293a 0a20 2020 2020 2020 2073 656c  ag):.        sel
+00010050: 662e 5f64 735f 696e 7075 742e 7661 6c75  f._ds_input.valu
+00010060: 6520 3d20 7365 6c66 2e5f 6473 5f69 6e70  e = self._ds_inp
+00010070: 7574 2e76 616c 7565 2e72 7374 7269 7028  ut.value.rstrip(
+00010080: 2920 2b20 2220 2220 2b20 7461 6720 2b20  ) + " " + tag + 
+00010090: 2220 220a 2020 2020 2020 2020 7365 6c66  " ".        self
+000100a0: 2e5f 6f6e 5f75 7365 725f 6564 6974 2829  ._on_user_edit()
+000100b0: 0a20 2020 2020 2020 2069 6620 7574 696c  .        if util
+000100c0: 732e 6c6f 6f6b 735f 6c69 6b65 5f64 6573  s.looks_like_des
+000100d0: 6b74 6f70 2829 3a0a 2020 2020 2020 2020  ktop():.        
+000100e0: 2020 2020 7365 6c66 2e5f 6473 5f69 6e70      self._ds_inp
+000100f0: 7574 2e66 6f63 7573 2829 0a0a 2020 2020  ut.focus()..    
+00010100: 6465 6620 5f6f 6e5f 7573 6572 5f65 6469  def _on_user_edi
+00010110: 745f 646f 6e65 2873 656c 6629 3a0a 2020  t_done(self):.  
+00010120: 2020 2020 2020 7365 6c66 2e5f 6175 746f        self._auto
+00010130: 636f 6d70 6c65 7465 722e 636c 6561 7228  completer.clear(
+00010140: 290a 2020 2020 2020 2020 6473 203d 2074  ).        ds = t
+00010150: 6f5f 7374 7228 7365 6c66 2e5f 6473 5f69  o_str(self._ds_i
+00010160: 6e70 7574 2e76 616c 7565 290a 2020 2020  nput.value).    
+00010170: 2020 2020 5f2c 2070 6172 7473 203d 2075      _, parts = u
+00010180: 7469 6c73 2e67 6574 5f74 6167 735f 616e  tils.get_tags_an
+00010190: 645f 7061 7274 735f 6672 6f6d 5f73 7472  d_parts_from_str
+000101a0: 696e 6728 6473 290a 2020 2020 2020 2020  ing(ds).        
+000101b0: 7365 6c66 2e5f 6473 5f69 6e70 7574 2e76  self._ds_input.v
+000101c0: 616c 7565 203d 2070 6172 7473 2e6a 6f69  alue = parts.joi
+000101d0: 6e28 2222 292e 7374 7269 7028 290a 2020  n("").strip().  
+000101e0: 2020 2020 2020 7365 6c66 2e5f 7368 6f77        self._show
+000101f0: 5f74 6167 735f 6672 6f6d 5f64 7328 290a  _tags_from_ds().
+00010200: 0a20 2020 2064 6566 205f 6f6e 5f74 696d  .    def _on_tim
+00010210: 6573 5f63 6861 6e67 6528 7365 6c66 293a  es_change(self):
+00010220: 0a20 2020 2020 2020 2077 6173 5f72 756e  .        was_run
+00010230: 6e69 6e67 203d 2073 656c 662e 5f72 6563  ning = self._rec
+00010240: 6f72 642e 7431 203d 3d20 7365 6c66 2e5f  ord.t1 == self._
+00010250: 7265 636f 7264 2e74 320a 2020 2020 2020  record.t2.      
+00010260: 2020 7365 6c66 2e5f 7265 636f 7264 2e74    self._record.t
+00010270: 3120 3d20 7365 6c66 2e5f 7469 6d65 5f65  1 = self._time_e
+00010280: 6469 742e 7431 0a20 2020 2020 2020 2073  dit.t1.        s
+00010290: 656c 662e 5f72 6563 6f72 642e 7432 203d  elf._record.t2 =
+000102a0: 2073 656c 662e 5f74 696d 655f 6564 6974   self._time_edit
+000102b0: 2e74 320a 2020 2020 2020 2020 6973 5f72  .t2.        is_r
+000102c0: 756e 6e69 6e67 203d 2073 656c 662e 5f72  unning = self._r
+000102d0: 6563 6f72 642e 7431 203d 3d20 7365 6c66  ecord.t1 == self
+000102e0: 2e5f 7265 636f 7264 2e74 320a 2020 2020  ._record.t2.    
+000102f0: 2020 2020 7365 6c66 2e5f 6d61 726b 5f61      self._mark_a
+00010300: 735f 6564 6974 6564 2829 0a20 2020 2020  s_edited().     
+00010310: 2020 2023 2053 7761 7020 6d6f 6465 3f0a     # Swap mode?.
+00010320: 2020 2020 2020 2020 6966 2077 6173 5f72          if was_r
+00010330: 756e 6e69 6e67 2061 6e64 206e 6f74 2069  unning and not i
+00010340: 735f 7275 6e6e 696e 673a 0a20 2020 2020  s_running:.     
+00010350: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
+00010360: 6c6d 6f64 6520 3d3d 2022 7374 6172 7422  lmode == "start"
+00010370: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00010380: 2020 7365 6c66 2e5f 7365 745f 6d6f 6465    self._set_mode
+00010390: 2822 4e65 7722 290a 2020 2020 2020 2020  ("New").        
+000103a0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000103b0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+000103c0: 7365 745f 6d6f 6465 2822 5374 6f70 2229  set_mode("Stop")
+000103d0: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
+000103e0: 5f72 756e 6e69 6e67 2061 6e64 206e 6f74  _running and not
+000103f0: 2077 6173 5f72 756e 6e69 6e67 3a0a 2020   was_running:.  
+00010400: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00010410: 662e 5f6c 6d6f 6465 203d 3d20 226e 6577  f._lmode == "new
+00010420: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+00010430: 2020 2073 656c 662e 5f73 6574 5f6d 6f64     self._set_mod
+00010440: 6528 2253 7461 7274 2229 0a20 2020 2020  e("Start").     
+00010450: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00010460: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00010470: 662e 5f73 6574 5f6d 6f64 6528 2245 6469  f._set_mode("Edi
+00010480: 7422 290a 0a20 2020 2064 6566 205f 7368  t")..    def _sh
+00010490: 6f77 5f74 6167 735f 6672 6f6d 5f64 7328  ow_tags_from_ds(
+000104a0: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+000104b0: 2222 4765 7420 616c 6c20 6375 7272 656e  ""Get all curren
+000104c0: 7420 7461 6773 2e20 4966 2064 6966 6665  t tags. If diffe
+000104d0: 7265 6e74 2c20 7570 6461 7465 2073 7567  rent, update sug
+000104e0: 6765 7374 696f 6e73 2e22 2222 0a20 2020  gestions.""".   
+000104f0: 2020 2020 2023 2053 686f 7720 696e 666f       # Show info
+00010500: 2061 626f 7574 2063 7572 7265 6e74 2074   about current t
+00010510: 6167 7320 696e 2064 6573 6372 6970 7469  ags in descripti
+00010520: 6f6e 0a20 2020 2020 2020 2074 6167 732c  on.        tags,
+00010530: 2070 6172 7473 203d 2075 7469 6c73 2e67   parts = utils.g
+00010540: 6574 5f74 6167 735f 616e 645f 7061 7274  et_tags_and_part
+00010550: 735f 6672 6f6d 5f73 7472 696e 6728 7365  s_from_string(se
+00010560: 6c66 2e5f 6473 5f69 6e70 7574 2e76 616c  lf._ds_input.val
+00010570: 7565 290a 2020 2020 2020 2020 7461 6773  ue).        tags
+00010580: 5f68 746d 6c20 3d20 2254 6167 733a 266e  _html = "Tags:&n
+00010590: 6273 703b 2026 6e62 7370 3b22 0a20 2020  bsp; &nbsp;".   
+000105a0: 2020 2020 2069 6620 6c65 6e28 7461 6773       if len(tags
+000105b0: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
+000105c0: 2020 2020 7461 6773 203d 205b 2223 756e      tags = ["#un
+000105d0: 7461 6767 6564 225d 0a20 2020 2020 2020  tagged"].       
+000105e0: 2074 6167 735f 6c69 7374 203d 205b 5d0a   tags_list = [].
+000105f0: 2020 2020 2020 2020 666f 7220 7461 6720          for tag 
+00010600: 696e 2074 6167 733a 0a20 2020 2020 2020  in tags:.       
+00010610: 2020 2020 2063 6c72 203d 2077 696e 646f       clr = windo
+00010620: 772e 7374 6f72 652e 7365 7474 696e 6773  w.store.settings
+00010630: 2e67 6574 5f63 6f6c 6f72 5f66 6f72 5f74  .get_color_for_t
+00010640: 6167 2874 6167 290a 2020 2020 2020 2020  ag(tag).        
+00010650: 2020 2020 7461 6773 5f6c 6973 742e 6170      tags_list.ap
+00010660: 7065 6e64 2866 223c 6220 7374 796c 653d  pend(f"<b style=
+00010670: 2763 6f6c 6f72 3a7b 636c 727d 3b27 3e23  'color:{clr};'>#
+00010680: 3c2f 623e 7b74 6167 5b31 3a5d 7d22 290a  </b>{tag[1:]}").
+00010690: 2020 2020 2020 2020 7461 6773 5f68 746d          tags_htm
+000106a0: 6c20 2b3d 2022 266e 6273 703b 2026 6e62  l += "&nbsp; &nb
+000106b0: 7370 3b22 2e6a 6f69 6e28 7461 6773 5f6c  sp;".join(tags_l
+000106c0: 6973 7429 0a20 2020 2020 2020 2023 2047  ist).        # G
+000106d0: 6574 2068 696e 7473 0a20 2020 2020 2020  et hints.       
+000106e0: 2068 696e 745f 6874 6d6c 203d 2022 220a   hint_html = "".
+000106f0: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+00010700: 656c 662e 5f61 7574 6f63 6f6d 706c 6574  elf._autocomplet
+00010710: 6572 2e68 6173 5f72 6563 656e 745f 7461  er.has_recent_ta
+00010720: 6773 2829 3a0a 2020 2020 2020 2020 2020  gs():.          
+00010730: 2020 6869 6e74 5f68 746d 6c20 3d20 2255    hint_html = "U
+00010740: 7365 2065 2e67 2e20 2726 2333 353b 6d65  se e.g. '&#35;me
+00010750: 6574 696e 6727 2074 6f20 6164 6420 6f6e  eting' to add on
+00010760: 6520 6f72 206d 6f72 6520 7461 6773 2e22  e or more tags."
+00010770: 0a20 2020 2020 2020 2023 2044 6574 6563  .        # Detec
+00010780: 7420 6475 706c 6963 6174 6520 7461 6773  t duplicate tags
+00010790: 0a20 2020 2020 2020 2074 6167 5f63 6f75  .        tag_cou
+000107a0: 6e74 7320 3d20 7b7d 0a20 2020 2020 2020  nts = {}.       
+000107b0: 2066 6f72 2070 6172 7420 696e 2070 6172   for part in par
+000107c0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+000107d0: 6966 2070 6172 742e 7374 6172 7473 7769  if part.startswi
+000107e0: 7468 2822 2322 293a 0a20 2020 2020 2020  th("#"):.       
+000107f0: 2020 2020 2020 2020 2074 6167 5f63 6f75           tag_cou
+00010800: 6e74 735b 7061 7274 5d20 3d20 7461 675f  nts[part] = tag_
+00010810: 636f 756e 7473 2e67 6574 2870 6172 742c  counts.get(part,
+00010820: 2030 2920 2b20 310a 2020 2020 2020 2020   0) + 1.        
+00010830: 6475 706c 6963 6174 6573 203d 205b 7461  duplicates = [ta
+00010840: 6720 666f 7220 7461 672c 2063 6f75 6e74  g for tag, count
+00010850: 2069 6e20 7461 675f 636f 756e 7473 2e69   in tag_counts.i
+00010860: 7465 6d73 2829 2069 6620 636f 756e 7420  tems() if count 
+00010870: 3e20 315d 0a20 2020 2020 2020 2069 6620  > 1].        if 
+00010880: 6c65 6e28 6475 706c 6963 6174 6573 293a  len(duplicates):
+00010890: 0a20 2020 2020 2020 2020 2020 2068 696e  .            hin
+000108a0: 745f 6874 6d6c 202b 3d20 223c 6272 3e44  t_html += "<br>D
+000108b0: 7570 6c69 6361 7465 2074 6167 733a 2022  uplicate tags: "
+000108c0: 202b 2064 7570 6c69 6361 7465 732e 6a6f   + duplicates.jo
+000108d0: 696e 2822 2022 290a 2020 2020 2020 2020  in(" ").        
+000108e0: 2320 4465 7465 6374 2055 524c 2773 0a20  # Detect URL's. 
+000108f0: 2020 2020 2020 2075 726c 7320 3d20 5b5d         urls = []
+00010900: 0a20 2020 2020 2020 2066 6f72 2070 6172  .        for par
+00010910: 7420 696e 2070 6172 7473 3a0a 2020 2020  t in parts:.    
+00010920: 2020 2020 2020 2020 666f 7220 776f 7264          for word
+00010930: 2069 6e20 7061 7274 2e73 706c 6974 2829   in part.split()
+00010940: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00010950: 2020 6966 2077 6f72 642e 7374 6172 7473    if word.starts
+00010960: 5769 7468 2822 6874 7470 3a2f 2f22 2920  With("http://") 
+00010970: 6f72 2077 6f72 642e 7374 6172 7473 5769  or word.startsWi
+00010980: 7468 2822 6874 7470 733a 2f2f 2229 3a0a  th("https://"):.
+00010990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000109a0: 2020 2020 7572 6c73 2e61 7070 656e 6428      urls.append(
+000109b0: 776f 7264 2e73 7472 6970 2822 2722 292e  word.strip("'").
+000109c0: 7374 7269 7028 2722 2729 290a 2020 2020  strip('"')).    
+000109d0: 2020 2020 6966 2075 726c 733a 0a20 2020      if urls:.   
+000109e0: 2020 2020 2020 2020 2068 696e 745f 6874           hint_ht
+000109f0: 6d6c 202b 3d20 223c 6272 3e4c 696e 6b73  ml += "<br>Links
+00010a00: 3a22 0a20 2020 2020 2020 2020 2020 2066  :".            f
+00010a10: 6f72 2075 726c 2069 6e20 7572 6c73 3a0a  or url in urls:.
+00010a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010a30: 6869 6e74 5f68 746d 6c20 2b3d 2066 223c  hint_html += f"<
+00010a40: 6272 3e3c 6120 7374 796c 653d 2766 6f6e  br><a style='fon
+00010a50: 742d 7369 7a65 3a73 6d61 6c6c 6572 3b27  t-size:smaller;'
+00010a60: 2068 7265 663d 277b 7572 6c7d 2720 7461   href='{url}' ta
+00010a70: 7267 6574 3d27 5f62 6c61 6e6b 273e 7b75  rget='_blank'>{u
+00010a80: 726c 7d3c 2f61 3e22 0a20 2020 2020 2020  rl}</a>".       
+00010a90: 2023 2041 7070 6c79 0a20 2020 2020 2020   # Apply.       
+00010aa0: 2073 656c 662e 5f74 6167 5f68 696e 7473   self._tag_hints
+00010ab0: 5f64 6976 2e69 6e6e 6572 4854 4d4c 203d  _div.innerHTML =
+00010ac0: 2068 696e 745f 6874 6d6c 0a20 2020 2020   hint_html.     
+00010ad0: 2020 2073 656c 662e 5f74 6167 735f 6469     self._tags_di
+00010ae0: 762e 696e 6e65 7248 544d 4c20 3d20 7461  v.innerHTML = ta
+00010af0: 6773 5f68 746d 6c0a 0a20 2020 2064 6566  gs_html..    def
+00010b00: 2063 6c6f 7365 2873 656c 662c 2065 3d4e   close(self, e=N
+00010b10: 6f6e 6529 3a0a 2020 2020 2020 2020 7365  one):.        se
+00010b20: 6c66 2e5f 7469 6d65 5f65 6469 742e 636c  lf._time_edit.cl
+00010b30: 6f73 6528 290a 2020 2020 2020 2020 7365  ose().        se
+00010b40: 6c66 2e5f 6175 746f 636f 6d70 6c65 7465  lf._autocomplete
+00010b50: 722e 636c 6f73 6528 290a 2020 2020 2020  r.close().      
+00010b60: 2020 7375 7065 7228 292e 636c 6f73 6528    super().close(
+00010b70: 6529 0a0a 2020 2020 6465 6620 5f6f 6e5f  e)..    def _on_
+00010b80: 6b65 7928 7365 6c66 2c20 6529 3a0a 2020  key(self, e):.  
+00010b90: 2020 2020 2020 6b65 7920 3d20 652e 6b65        key = e.ke
+00010ba0: 792e 6c6f 7765 7228 290a 2020 2020 2020  y.lower().      
+00010bb0: 2020 6966 2073 656c 662e 5f61 7574 6f63    if self._autoc
+00010bc0: 6f6d 706c 6574 6572 2e6f 6e5f 6b65 7928  ompleter.on_key(
+00010bd0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+00010be0: 652e 7374 6f70 5072 6f70 6167 6174 696f  e.stopPropagatio
+00010bf0: 6e28 290a 2020 2020 2020 2020 2020 2020  n().            
+00010c00: 7265 7475 726e 0a20 2020 2020 2020 2065  return.        e
+00010c10: 6c69 6620 6b65 7920 3d3d 2022 656e 7465  lif key == "ente
+00010c20: 7222 206f 7220 6b65 7920 3d3d 2022 7265  r" or key == "re
+00010c30: 7475 726e 223a 0a20 2020 2020 2020 2020  turn":.         
+00010c40: 2020 2073 656c 662e 7375 626d 6974 5f73     self.submit_s
+00010c50: 6f6f 6e28 290a 2020 2020 2020 2020 656c  oon().        el
+00010c60: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00010c70: 7375 7065 7228 292e 5f6f 6e5f 6b65 7928  super()._on_key(
+00010c80: 6529 0a0a 2020 2020 6465 6620 5f64 656c  e)..    def _del
+00010c90: 6574 6531 2873 656c 6629 3a0a 2020 2020  ete1(self):.    
+00010ca0: 2020 2020 7365 6c66 2e5f 6465 6c65 7465      self._delete
+00010cb0: 5f62 7574 322e 7374 796c 652e 6469 7370  _but2.style.disp
+00010cc0: 6c61 7920 3d20 2262 6c6f 636b 220a 0a20  lay = "block".. 
+00010cd0: 2020 2064 6566 205f 6465 6c65 7465 3228     def _delete2(
+00010ce0: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
+00010cf0: 6563 6f72 6420 3d20 7365 6c66 2e5f 7265  ecord = self._re
+00010d00: 636f 7264 0a20 2020 2020 2020 2077 696e  cord.        win
+00010d10: 646f 772e 7374 6f72 6573 2e6d 616b 655f  dow.stores.make_
+00010d20: 6869 6464 656e 2872 6563 6f72 6429 2020  hidden(record)  
+00010d30: 2320 5365 7473 2074 6865 2064 6573 6372  # Sets the descr
+00010d40: 6970 7469 6f6e 0a20 2020 2020 2020 2072  iption.        r
+00010d50: 6563 6f72 642e 7432 203d 2072 6563 6f72  ecord.t2 = recor
+00010d60: 642e 7431 202b 2031 2020 2320 5365 7420  d.t1 + 1  # Set 
+00010d70: 6475 7261 7469 6f6e 2074 6f20 3173 2028  duration to 1s (
+00010d80: 7431 203d 3d20 7432 206d 6561 6e73 2072  t1 == t2 means r
+00010d90: 756e 6e69 6e67 290a 2020 2020 2020 2020  unning).        
+00010da0: 7769 6e64 6f77 2e73 746f 7265 2e72 6563  window.store.rec
+00010db0: 6f72 6473 2e70 7574 2872 6563 6f72 6429  ords.put(record)
+00010dc0: 0a20 2020 2020 2020 2073 656c 662e 636c  .        self.cl
+00010dd0: 6f73 6528 7265 636f 7264 290a 0a20 2020  ose(record)..   
+00010de0: 2064 6566 205f 7374 6f70 5f61 6c6c 5f72   def _stop_all_r
+00010df0: 756e 6e69 6e67 5f72 6563 6f72 6473 2873  unning_records(s
+00010e00: 656c 662c 2074 323d 4e6f 6e65 293a 0a20  elf, t2=None):. 
+00010e10: 2020 2020 2020 2072 6563 6f72 6473 203d         records =
+00010e20: 2077 696e 646f 772e 7374 6f72 652e 7265   window.store.re
+00010e30: 636f 7264 732e 6765 745f 7275 6e6e 696e  cords.get_runnin
+00010e40: 675f 7265 636f 7264 7328 290a 2020 2020  g_records().    
+00010e50: 2020 2020 6966 2074 3220 6973 204e 6f6e      if t2 is Non
+00010e60: 653a 0a20 2020 2020 2020 2020 2020 2074  e:.            t
+00010e70: 3220 3d20 6474 2e6e 6f77 2829 0a20 2020  2 = dt.now().   
+00010e80: 2020 2020 2066 6f72 2072 6563 6f72 6420       for record 
+00010e90: 696e 2072 6563 6f72 6473 3a0a 2020 2020  in records:.    
+00010ea0: 2020 2020 2020 2020 7265 636f 7264 2e74          record.t
+00010eb0: 3220 3d20 6d61 7828 7265 636f 7264 2e74  2 = max(record.t
+00010ec0: 3120 2b20 322c 2074 3229 0a20 2020 2020  1 + 2, t2).     
+00010ed0: 2020 2020 2020 2077 696e 646f 772e 7374         window.st
+00010ee0: 6f72 652e 7265 636f 7264 732e 7075 7428  ore.records.put(
+00010ef0: 7265 636f 7264 290a 0a20 2020 2064 6566  record)..    def
+00010f00: 2073 7562 6d69 7428 7365 6c66 293a 0a20   submit(self):. 
+00010f10: 2020 2020 2020 2022 2222 5375 626d 6974         """Submit
+00010f20: 2074 6865 2072 6563 6f72 6420 746f 2074   the record to t
+00010f30: 6865 2073 746f 7265 2e22 2222 0a20 2020  he store.""".   
+00010f40: 2020 2020 2023 2053 7562 6d69 7420 6d65       # Submit me
+00010f50: 616e 7320 636c 6f73 6520 6966 2074 6865  ans close if the
+00010f60: 7265 2077 6173 206e 6f74 6869 6e67 2074  re was nothing t
+00010f70: 6f20 7375 626d 6974 0a20 2020 2020 2020  o submit.       
+00010f80: 2069 6620 7365 6c66 2e5f 7375 626d 6974   if self._submit
+00010f90: 5f62 7574 2e64 6973 6162 6c65 643a 0a20  _but.disabled:. 
+00010fa0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00010fb0: 6e20 7365 6c66 2e63 6c6f 7365 2829 0a20  n self.close(). 
+00010fc0: 2020 2020 2020 2023 2053 6574 2072 6563         # Set rec
+00010fd0: 6f72 642e 6473 0a20 2020 2020 2020 205f  ord.ds.        _
+00010fe0: 2c20 7061 7274 7320 3d20 7574 696c 732e  , parts = utils.
+00010ff0: 6765 745f 7461 6773 5f61 6e64 5f70 6172  get_tags_and_par
+00011000: 7473 5f66 726f 6d5f 7374 7269 6e67 2874  ts_from_string(t
+00011010: 6f5f 7374 7228 7365 6c66 2e5f 6473 5f69  o_str(self._ds_i
+00011020: 6e70 7574 2e76 616c 7565 2929 0a20 2020  nput.value)).   
+00011030: 2020 2020 2073 656c 662e 5f72 6563 6f72       self._recor
+00011040: 642e 6473 203d 2070 6172 7473 2e6a 6f69  d.ds = parts.joi
+00011050: 6e28 2222 290a 2020 2020 2020 2020 6966  n("").        if
+00011060: 206e 6f74 2073 656c 662e 5f72 6563 6f72   not self._recor
+00011070: 642e 6473 3a0a 2020 2020 2020 2020 2020  d.ds:.          
+00011080: 2020 7365 6c66 2e5f 7265 636f 7264 2e70    self._record.p
+00011090: 6f70 2822 6473 222c 204e 6f6e 6529 0a20  op("ds", None). 
+000110a0: 2020 2020 2020 2023 2050 7265 7665 6e74         # Prevent
+000110b0: 206d 756c 7469 706c 6520 7469 6d65 7273   multiple timers
+000110c0: 2061 7420 6f6e 6365 0a20 2020 2020 2020   at once.       
+000110d0: 2069 6620 7365 6c66 2e5f 7265 636f 7264   if self._record
+000110e0: 2e74 3120 3d3d 2073 656c 662e 5f72 6563  .t1 == self._rec
+000110f0: 6f72 642e 7432 3a0a 2020 2020 2020 2020  ord.t2:.        
+00011100: 2020 2020 7365 6c66 2e5f 7374 6f70 5f61      self._stop_a
+00011110: 6c6c 5f72 756e 6e69 6e67 5f72 6563 6f72  ll_running_recor
+00011120: 6473 2873 656c 662e 5f72 6563 6f72 642e  ds(self._record.
+00011130: 7431 290a 2020 2020 2020 2020 2320 4170  t1).        # Ap
+00011140: 706c 790a 2020 2020 2020 2020 7769 6e64  ply.        wind
+00011150: 6f77 2e73 746f 7265 2e72 6563 6f72 6473  ow.store.records
+00011160: 2e70 7574 2873 656c 662e 5f72 6563 6f72  .put(self._recor
+00011170: 6429 0a20 2020 2020 2020 2073 7570 6572  d).        super
+00011180: 2829 2e73 7562 6d69 7428 7365 6c66 2e5f  ().submit(self._
+00011190: 7265 636f 7264 290a 2020 2020 2020 2020  record).        
+000111a0: 2320 4e6f 7469 6679 0a20 2020 2020 2020  # Notify.       
+000111b0: 2069 6620 7365 6c66 2e5f 6c6d 6f64 6520   if self._lmode 
+000111c0: 3d3d 2022 7374 6172 7422 3a0a 2020 2020  == "start":.    
+000111d0: 2020 2020 2020 2020 7365 6c66 2e73 656e          self.sen
+000111e0: 645f 6e6f 7469 6669 6361 7469 6f6e 2873  d_notification(s
+000111f0: 656c 662e 5f72 6563 6f72 6429 0a20 2020  elf._record).   
+00011200: 2020 2020 2023 2053 7461 7274 2070 6f6d       # Start pom
+00011210: 6f3f 0a20 2020 2020 2020 2069 6620 7769  o?.        if wi
+00011220: 6e64 6f77 2e73 696d 706c 6573 6574 7469  ndow.simplesetti
+00011230: 6e67 732e 6765 7428 2270 6f6d 6f64 6f72  ngs.get("pomodor
+00011240: 6f5f 656e 6162 6c65 6422 293a 0a20 2020  o_enabled"):.   
+00011250: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00011260: 2e5f 6c6d 6f64 6520 3d3d 2022 7374 6172  ._lmode == "star
+00011270: 7422 3a0a 2020 2020 2020 2020 2020 2020  t":.            
+00011280: 2020 2020 7365 6c66 2e5f 6361 6e76 6173      self._canvas
+00011290: 2e70 6f6d 6f64 6f72 6f5f 6469 616c 6f67  .pomodoro_dialog
+000112a0: 2e73 7461 7274 5f77 6f72 6b28 290a 2020  .start_work().  
+000112b0: 2020 2020 2020 2020 2020 656c 6966 2073            elif s
+000112c0: 656c 662e 5f6c 6d6f 6465 203d 3d20 2273  elf._lmode == "s
+000112d0: 746f 7022 3a0a 2020 2020 2020 2020 2020  top":.          
+000112e0: 2020 2020 2020 7365 6c66 2e5f 6361 6e76        self._canv
+000112f0: 6173 2e70 6f6d 6f64 6f72 6f5f 6469 616c  as.pomodoro_dial
+00011300: 6f67 2e73 746f 7028 290a 0a20 2020 2064  og.stop()..    d
+00011310: 6566 2072 6573 756d 655f 7265 636f 7264  ef resume_record
+00011320: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00011330: 2222 2253 7461 7274 2061 206e 6577 2072  """Start a new r
+00011340: 6563 6f72 6420 7769 7468 2074 6865 2073  ecord with the s
+00011350: 616d 6520 6465 7363 7269 7074 696f 6e2e  ame description.
+00011360: 2222 220a 2020 2020 2020 2020 2320 5468  """.        # Th
+00011370: 6520 7265 7375 6d65 2062 7574 746f 6e20  e resume button 
+00011380: 7368 6f75 6c64 206f 6e6c 7920 6265 2076  should only be v
+00011390: 6973 6962 6c65 2066 6f72 206e 6f6e 2d72  isible for non-r
+000113a0: 756e 6e69 6e67 2072 6563 6f72 6473 2c20  unning records, 
+000113b0: 6275 740a 2020 2020 2020 2020 2320 6966  but.        # if
+000113c0: 2028 666f 7220 7768 6174 6576 6572 2072   (for whatever r
+000113d0: 6561 736f 6e29 2074 6869 7320 6765 7473  eason) this gets
+000113e0: 2063 616c 6c65 642c 2072 6573 756d 6520   called, resume 
+000113f0: 7769 6c6c 206d 6561 6e20 6c65 6176 6520  will mean leave 
+00011400: 7275 6e6e 696e 672e 0a20 2020 2020 2020  running..       
+00011410: 2069 6620 7365 6c66 2e5f 7265 636f 7264   if self._record
+00011420: 2e74 3120 3d3d 2073 656c 662e 5f72 6563  .t1 == self._rec
+00011430: 6f72 642e 7432 3a0a 2020 2020 2020 2020  ord.t2:.        
+00011440: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00011450: 7375 626d 6974 2829 0a20 2020 2020 2020  submit().       
+00011460: 2023 2049 6e20 6361 7365 206f 7468 6572   # In case other
+00011470: 2074 696d 6572 7320 6172 6520 7275 6e6e   timers are runn
+00011480: 6e69 6e67 2c20 7374 6f70 2074 6865 7365  ning, stop these
+00011490: 210a 2020 2020 2020 2020 7365 6c66 2e5f  !.        self._
+000114a0: 7374 6f70 5f61 6c6c 5f72 756e 6e69 6e67  stop_all_running
+000114b0: 5f72 6563 6f72 6473 2829 0a20 2020 2020  _records().     
+000114c0: 2020 2023 2043 7265 6174 6520 6e65 7720     # Create new 
+000114d0: 7265 636f 7264 2077 6974 6820 6375 7272  record with curr
+000114e0: 656e 7420 6465 7363 7269 7074 696f 6e0a  ent description.
+000114f0: 2020 2020 2020 2020 6e6f 7720 3d20 6474          now = dt
+00011500: 2e6e 6f77 2829 0a20 2020 2020 2020 2072  .now().        r
+00011510: 6563 6f72 6420 3d20 7769 6e64 6f77 2e73  ecord = window.s
+00011520: 746f 7265 2e72 6563 6f72 6473 2e63 7265  tore.records.cre
+00011530: 6174 6528 6e6f 772c 206e 6f77 290a 2020  ate(now, now).  
+00011540: 2020 2020 2020 5f2c 2070 6172 7473 203d        _, parts =
+00011550: 2075 7469 6c73 2e67 6574 5f74 6167 735f   utils.get_tags_
+00011560: 616e 645f 7061 7274 735f 6672 6f6d 5f73  and_parts_from_s
+00011570: 7472 696e 6728 746f 5f73 7472 2873 656c  tring(to_str(sel
+00011580: 662e 5f64 735f 696e 7075 742e 7661 6c75  f._ds_input.valu
+00011590: 6529 290a 2020 2020 2020 2020 7265 636f  e)).        reco
+000115a0: 7264 2e64 7320 3d20 7061 7274 732e 6a6f  rd.ds = parts.jo
+000115b0: 696e 2822 2229 0a20 2020 2020 2020 2077  in("").        w
+000115c0: 696e 646f 772e 7374 6f72 652e 7265 636f  indow.store.reco
+000115d0: 7264 732e 7075 7428 7265 636f 7264 290a  rds.put(record).
+000115e0: 2020 2020 2020 2020 2320 436c 6f73 6520          # Close 
+000115f0: 7468 6520 6469 616c 6f67 202d 2064 6f6e  the dialog - don
+00011600: 2774 2061 7070 6c79 206c 6f63 616c 2063  't apply local c
+00011610: 6861 6e67 6573 0a20 2020 2020 2020 2073  hanges.        s
+00011620: 656c 662e 636c 6f73 6528 290a 2020 2020  elf.close().    
+00011630: 2020 2020 2320 4d6f 7665 2074 6f20 746f      # Move to to
+00011640: 6461 792c 2069 6620 6e65 6564 6564 0a20  day, if needed. 
+00011650: 2020 2020 2020 2074 312c 2074 3220 3d20         t1, t2 = 
+00011660: 7365 6c66 2e5f 6361 6e76 6173 2e72 616e  self._canvas.ran
+00011670: 6765 2e67 6574 5f74 6172 6765 745f 7261  ge.get_target_ra
+00011680: 6e67 6528 290a 2020 2020 2020 2020 6966  nge().        if
+00011690: 206e 6f74 2028 7431 203c 206e 6f77 203c   not (t1 < now <
+000116a0: 2074 3229 3a0a 2020 2020 2020 2020 2020   t2):.          
+000116b0: 2020 7431 2c20 7432 203d 2073 656c 662e    t1, t2 = self.
+000116c0: 5f63 616e 7661 732e 7261 6e67 652e 6765  _canvas.range.ge
+000116d0: 745f 746f 6461 795f 7261 6e67 6528 290a  t_today_range().
+000116e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000116f0: 2e5f 6361 6e76 6173 2e72 616e 6765 2e61  ._canvas.range.a
+00011700: 6e69 6d61 7465 5f72 616e 6765 2874 312c  nimate_range(t1,
+00011710: 2074 3229 0a20 2020 2020 2020 2023 204e   t2).        # N
+00011720: 6f74 6966 790a 2020 2020 2020 2020 7365  otify.        se
+00011730: 6c66 2e73 656e 645f 6e6f 7469 6669 6361  lf.send_notifica
+00011740: 7469 6f6e 2872 6563 6f72 6429 0a20 2020  tion(record).   
+00011750: 2020 2020 2023 2053 7461 7274 2070 6f6d       # Start pom
+00011760: 6f3f 0a20 2020 2020 2020 2069 6620 7769  o?.        if wi
+00011770: 6e64 6f77 2e73 696d 706c 6573 6574 7469  ndow.simplesetti
+00011780: 6e67 732e 6765 7428 2270 6f6d 6f64 6f72  ngs.get("pomodor
+00011790: 6f5f 656e 6162 6c65 6422 293a 0a20 2020  o_enabled"):.   
+000117a0: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
+000117b0: 616e 7661 732e 706f 6d6f 646f 726f 5f64  anvas.pomodoro_d
+000117c0: 6961 6c6f 672e 7374 6172 745f 776f 726b  ialog.start_work
+000117d0: 2829 0a0a 2020 2020 6465 6620 7365 6e64  ()..    def send
+000117e0: 5f6e 6f74 6966 6963 6174 696f 6e28 7365  _notification(se
+000117f0: 6c66 2c20 7265 636f 7264 293a 0a20 2020  lf, record):.   
+00011800: 2020 2020 2069 6620 6e6f 7420 7769 6e64       if not wind
+00011810: 6f77 2e73 696d 706c 6573 6574 7469 6e67  ow.simplesetting
+00011820: 732e 6765 7428 226e 6f74 6966 6963 6174  s.get("notificat
+00011830: 696f 6e73 2229 3a0a 2020 2020 2020 2020  ions"):.        
+00011840: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
+00011850: 2020 2069 6620 7769 6e64 6f77 2e4e 6f74     if window.Not
+00011860: 6966 6963 6174 696f 6e20 616e 6420 4e6f  ification and No
+00011870: 7469 6669 6361 7469 6f6e 2e70 6572 6d69  tification.permi
+00011880: 7373 696f 6e20 213d 2022 6772 616e 7465  ssion != "grante
+00011890: 6422 3a0a 2020 2020 2020 2020 2020 2020  d":.            
+000118a0: 7265 7475 726e 0a0a 2020 2020 2020 2020  return..        
+000118b0: 7469 746c 6520 3d20 2254 696d 6554 6167  title = "TimeTag
+000118c0: 6765 7220 6973 2074 7261 636b 696e 6720  ger is tracking 
+000118d0: 7469 6d65 220a 2020 2020 2020 2020 6163  time".        ac
+000118e0: 7469 6f6e 7320 3d20 5b0a 2020 2020 2020  tions = [.      
+000118f0: 2020 2020 2020 7b22 6163 7469 6f6e 223a        {"action":
+00011900: 2022 7374 6f70 222c 2022 7469 746c 6522   "stop", "title"
+00011910: 3a20 2253 746f 7022 7d2c 0a20 2020 2020  : "Stop"},.     
+00011920: 2020 205d 0a20 2020 2020 2020 206f 7074     ].        opt
+00011930: 696f 6e73 203d 207b 0a20 2020 2020 2020  ions = {.       
+00011940: 2020 2020 2022 6963 6f6e 223a 2022 7469       "icon": "ti
+00011950: 6d65 7461 6767 6572 3139 325f 7366 2e70  metagger192_sf.p
+00011960: 6e67 222c 0a20 2020 2020 2020 2020 2020  ng",.           
+00011970: 2022 626f 6479 223a 2072 6563 6f72 642e   "body": record.
+00011980: 6473 206f 7220 2222 2c0a 2020 2020 2020  ds or "",.      
+00011990: 2020 2020 2020 2272 6571 7569 7265 496e        "requireIn
+000119a0: 7465 7261 6374 696f 6e22 3a20 5472 7565  teraction": True
+000119b0: 2c0a 2020 2020 2020 2020 2020 2020 2274  ,.            "t
+000119c0: 6167 223a 2022 7469 6d65 7461 6767 6572  ag": "timetagger
+000119d0: 2d72 756e 6e69 6e67 222c 2020 2320 7265  -running",  # re
+000119e0: 706c 6163 6520 7072 6576 696f 7573 206e  place previous n
+000119f0: 6f74 6966 6963 6174 696f 6e73 0a20 2020  otifications.   
+00011a00: 2020 2020 207d 0a20 2020 2020 2020 2023       }.        #
+00011a10: 2049 6620 7765 2073 686f 7720 7468 6520   If we show the 
+00011a20: 6e6f 7469 6669 6361 7469 6f6e 2076 6961  notification via
+00011a30: 2074 6865 2073 6572 7669 6365 2077 6f72   the service wor
+00011a40: 6b65 722c 2077 650a 2020 2020 2020 2020  ker, we.        
+00011a50: 2320 6361 6e20 7368 6f77 2061 6374 696f  # can show actio
+00011a60: 6e73 2c20 6d61 6b69 6e67 2074 6865 2066  ns, making the f
+00011a70: 6c6f 7720 6561 7369 6572 2066 6f72 2075  low easier for u
+00011a80: 7365 7273 2e0a 2020 2020 2020 2020 6966  sers..        if
+00011a90: 2077 696e 646f 772e 7077 6120 616e 6420   window.pwa and 
+00011aa0: 7769 6e64 6f77 2e70 7761 2e73 775f 7265  window.pwa.sw_re
+00011ab0: 673a 0a20 2020 2020 2020 2020 2020 206f  g:.            o
+00011ac0: 7074 696f 6e73 2e61 6374 696f 6e73 203d  ptions.actions =
+00011ad0: 2061 6374 696f 6e73 0a20 2020 2020 2020   actions.       
+00011ae0: 2020 2020 2077 696e 646f 772e 7077 612e       window.pwa.
+00011af0: 7377 5f72 6567 2e73 686f 774e 6f74 6966  sw_reg.showNotif
+00011b00: 6963 6174 696f 6e28 7469 746c 652c 206f  ication(title, o
+00011b10: 7074 696f 6e73 290a 2020 2020 2020 2020  ptions).        
+00011b20: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00011b30: 2020 4e6f 7469 6669 6361 7469 6f6e 2874    Notification(t
+00011b40: 6974 6c65 2c20 6f70 7469 6f6e 7329 0a0a  itle, options)..
+00011b50: 2020 2020 6465 6620 6f6e 5f6e 6f74 6966      def on_notif
+00011b60: 6963 6174 696f 6e63 6c69 636b 2873 656c  icationclick(sel
+00011b70: 662c 206d 6573 7361 6765 5f65 7665 6e74  f, message_event
+00011b80: 293a 0a20 2020 2020 2020 2065 7665 6e74  ):.        event
+00011b90: 203d 206d 6573 7361 6765 5f65 7665 6e74   = message_event
+00011ba0: 2e64 6174 610a 2020 2020 2020 2020 6966  .data.        if
+00011bb0: 2065 7665 6e74 2e74 7970 6520 213d 2022   event.type != "
+00011bc0: 6e6f 7469 6669 6361 7469 6f6e 636c 6963  notificationclic
+00011bd0: 6b22 3a0a 2020 2020 2020 2020 2020 2020  k":.            
+00011be0: 7265 7475 726e 0a20 2020 2020 2020 2069  return.        i
+00011bf0: 6620 6576 656e 742e 6163 7469 6f6e 203d  f event.action =
+00011c00: 3d20 2273 746f 7022 3a0a 2020 2020 2020  = "stop":.      
+00011c10: 2020 2020 2020 7365 6c66 2e5f 7374 6f70        self._stop
+00011c20: 5f61 6c6c 5f72 756e 6e69 6e67 5f72 6563  _all_running_rec
+00011c30: 6f72 6473 2829 0a0a 0a63 6c61 7373 2054  ords()...class T
+00011c40: 6172 6765 7448 656c 7065 723a 0a20 2020  argetHelper:.   
+00011c50: 2022 2222 4120 6c69 7474 6c65 2063 6c61   """A little cla
+00011c60: 7373 2074 6f20 6865 6c70 2077 6974 6820  ss to help with 
+00011c70: 7461 7267 6574 732e 2042 6563 6175 7365  targets. Because
+00011c80: 2074 6172 6765 7473 206f 6363 7572 2069   targets occur i
+00011c90: 6e20 7477 6f20 6469 616c 6f67 732e 2222  n two dialogs.""
+00011ca0: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
+00011cb0: 745f 5f28 7365 6c66 2c20 7461 677a 2c20  t__(self, tagz, 
+00011cc0: 6469 7629 3a0a 2020 2020 2020 2020 7365  div):.        se
+00011cd0: 6c66 2e5f 7461 677a 203d 2074 6167 7a0a  lf._tagz = tagz.
+00011ce0: 0a20 2020 2020 2020 2064 6976 2e69 6e6e  .        div.inn
+00011cf0: 6572 4854 4d4c 203d 2066 2222 220a 2020  erHTML = f""".  
+00011d00: 2020 2020 2020 2020 2020 3c69 6e70 7574            <input
+00011d10: 2074 7970 653d 276e 756d 6265 7227 206d   type='number' m
+00011d20: 696e 3d31 2076 616c 7565 3d31 2073 7479  in=1 value=1 sty
+00011d30: 6c65 3d27 7769 6474 683a 3565 6d3b 2720  le='width:5em;' 
+00011d40: 2f3e 0a20 2020 2020 2020 2020 2020 203c  />.            <
+00011d50: 7370 616e 2073 7479 6c65 3d27 7061 6464  span style='padd
+00011d60: 696e 673a 2030 2031 656d 3b27 3e68 6f75  ing: 0 1em;'>hou
+00011d70: 7273 2070 6572 3c2f 7370 616e 3e0a 2020  rs per</span>.  
+00011d80: 2020 2020 2020 2020 2020 3c73 656c 6563            <selec
+00011d90: 743e 0a20 2020 2020 2020 2020 2020 2020  t>.             
+00011da0: 2020 203c 6f70 7469 6f6e 2076 616c 7565     <option value
+00011db0: 3d27 6e6f 6e65 273e 4e6f 2074 6172 6765  ='none'>No targe
+00011dc0: 743c 2f6f 7074 696f 6e3e 0a20 2020 2020  t</option>.     
+00011dd0: 2020 2020 2020 2020 2020 203c 6f70 7469             <opti
+00011de0: 6f6e 2076 616c 7565 3d27 6461 7927 3e44  on value='day'>D
+00011df0: 6179 3c2f 6f70 7469 6f6e 3e0a 2020 2020  ay</option>.    
+00011e00: 2020 2020 2020 2020 2020 2020 3c6f 7074              <opt
+00011e10: 696f 6e20 7661 6c75 653d 2777 6565 6b27  ion value='week'
+00011e20: 3e57 6565 6b3c 2f6f 7074 696f 6e3e 0a20  >Week</option>. 
+00011e30: 2020 2020 2020 2020 2020 2020 2020 203c                 <
+00011e40: 6f70 7469 6f6e 2076 616c 7565 3d27 6d6f  option value='mo
+00011e50: 6e74 6827 3e4d 6f6e 7468 3c2f 6f70 7469  nth'>Month</opti
+00011e60: 6f6e 3e0a 2020 2020 2020 2020 2020 2020  on>.            
+00011e70: 2020 2020 3c6f 7074 696f 6e20 7661 6c75      <option valu
+00011e80: 653d 2779 6561 7227 3e59 6561 723c 2f6f  e='year'>Year</o
+00011e90: 7074 696f 6e3e 0a20 2020 2020 2020 2020  ption>.         
+00011ea0: 2020 203c 2f73 656c 6563 743e 0a20 2020     </select>.   
+00011eb0: 2020 2020 2020 2020 2022 2222 0a0a 2020           """..  
+00011ec0: 2020 2020 2020 7365 6c66 2e5f 686f 7572        self._hour
+00011ed0: 5f69 6e70 7574 2c20 5f2c 2073 656c 662e  _input, _, self.
+00011ee0: 5f70 6572 696f 645f 7365 6c65 6374 203d  _period_select =
+00011ef0: 2064 6976 2e63 6869 6c64 7265 6e0a 0a20   div.children.. 
+00011f00: 2020 2064 6566 206c 6f61 645f 6672 6f6d     def load_from
+00011f10: 5f69 6e66 6f28 7365 6c66 2c20 696e 666f  _info(self, info
+00011f20: 293a 0a20 2020 2020 2020 2074 6172 6765  ):.        targe
+00011f30: 7473 203d 2069 6e66 6f2e 6765 7428 2274  ts = info.get("t
+00011f40: 6172 6765 7473 222c 204e 6f6e 6529 206f  argets", None) o
+00011f50: 7220 7b7d 0a20 2020 2020 2020 2066 6f72  r {}.        for
+00011f60: 2070 6572 696f 642c 2068 6f75 7273 2069   period, hours i
+00011f70: 6e20 7461 7267 6574 732e 6974 656d 7328  n targets.items(
+00011f80: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
+00011f90: 6620 7065 7269 6f64 2061 6e64 2068 6f75  f period and hou
+00011fa0: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
+00011fb0: 2020 2020 7365 6c66 2e5f 686f 7572 5f69      self._hour_i
+00011fc0: 6e70 7574 2e76 616c 7565 203d 2068 6f75  nput.value = hou
+00011fd0: 7273 206f 7220 310a 2020 2020 2020 2020  rs or 1.        
+00011fe0: 2020 2020 2020 2020 7365 6c66 2e5f 7065          self._pe
+00011ff0: 7269 6f64 5f73 656c 6563 742e 7661 6c75  riod_select.valu
+00012000: 6520 3d20 7065 7269 6f64 206f 7220 226e  e = period or "n
+00012010: 6f6e 6522 0a20 2020 2020 2020 2020 2020  one".           
+00012020: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
+00012030: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00012040: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00012050: 662e 5f68 6f75 725f 696e 7075 742e 7661  f._hour_input.va
+00012060: 6c75 6520 3d20 300a 2020 2020 2020 2020  lue = 0.        
+00012070: 2020 2020 2020 2020 7365 6c66 2e5f 7065          self._pe
+00012080: 7269 6f64 5f73 656c 6563 742e 7661 6c75  riod_select.valu
+00012090: 6520 3d20 226e 6f6e 6522 0a0a 2020 2020  e = "none"..    
+000120a0: 6465 6620 7772 6974 655f 746f 5f69 6e66  def write_to_inf
+000120b0: 6f28 7365 6c66 2c20 696e 666f 293a 0a20  o(self, info):. 
+000120c0: 2020 2020 2020 2074 6172 6765 7473 203d         targets =
+000120d0: 207b 7d0a 0a20 2020 2020 2020 2068 6f75   {}..        hou
+000120e0: 7273 203d 2066 6c6f 6174 2873 656c 662e  rs = float(self.
+000120f0: 5f68 6f75 725f 696e 7075 742e 7661 6c75  _hour_input.valu
+00012100: 6529 0a20 2020 2020 2020 2070 6572 696f  e).        perio
+00012110: 6420 3d20 7365 6c66 2e5f 7065 7269 6f64  d = self._period
+00012120: 5f73 656c 6563 742e 7661 6c75 650a 2020  _select.value.  
+00012130: 2020 2020 2020 6966 2068 6f75 7273 203e        if hours >
+00012140: 2030 2061 6e64 2070 6572 696f 6420 616e   0 and period an
+00012150: 6420 7065 7269 6f64 2021 3d20 226e 6f6e  d period != "non
+00012160: 6522 3a0a 2020 2020 2020 2020 2020 2020  e":.            
+00012170: 7461 7267 6574 735b 7065 7269 6f64 5d20  targets[period] 
+00012180: 3d20 686f 7572 730a 0a20 2020 2020 2020  = hours..       
+00012190: 2069 6e66 6f2e 7461 7267 6574 7320 3d20   info.targets = 
+000121a0: 7461 7267 6574 730a 0a0a 636c 6173 7320  targets...class 
+000121b0: 5461 6743 6f6d 626f 4469 616c 6f67 2842  TagComboDialog(B
+000121c0: 6173 6544 6961 6c6f 6729 3a0a 2020 2020  aseDialog):.    
+000121d0: 2222 2244 6961 6c6f 6720 746f 2063 6f6e  """Dialog to con
+000121e0: 6669 6775 7265 2061 2063 6f6d 6269 6e61  figure a combina
+000121f0: 7469 6f6e 206f 6620 7461 6773 2e22 2222  tion of tags."""
+00012200: 0a0a 2020 2020 6465 6620 6f70 656e 2873  ..    def open(s
+00012210: 656c 662c 2074 6167 732c 2063 616c 6c62  elf, tags, callb
+00012220: 6163 6b29 3a0a 2020 2020 2020 2020 2320  ack):.        # 
+00012230: 5075 7420 696e 2064 6574 6572 6d69 6e69  Put in determini
+00012240: 7374 6963 206f 7264 6572 0a20 2020 2020  stic order.     
+00012250: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00012260: 2874 6167 732c 2073 7472 293a 0a20 2020  (tags, str):.   
+00012270: 2020 2020 2020 2020 2074 6167 7320 3d20           tags = 
+00012280: 7461 6773 2e73 706c 6974 2822 2022 290a  tags.split(" ").
+00012290: 2020 2020 2020 2020 7461 6773 2e73 6f72          tags.sor
+000122a0: 7428 290a 2020 2020 2020 2020 7365 6c66  t().        self
+000122b0: 2e5f 7461 677a 203d 2074 6167 7a20 3d20  ._tagz = tagz = 
+000122c0: 7461 6773 2e6a 6f69 6e28 2220 2229 0a0a  tags.join(" ")..
+000122d0: 2020 2020 2020 2020 7365 6c66 2e6d 6169          self.mai
+000122e0: 6e64 6976 2e69 6e6e 6572 4854 4d4c 203d  ndiv.innerHTML =
+000122f0: 2066 2222 220a 2020 2020 2020 2020 2020   f""".          
+00012300: 2020 3c68 313e 3c69 2063 6c61 7373 3d27    <h1><i class='
+00012310: 6661 7327 3e5c 7566 3032 633c 2f69 3e26  fas'>\uf02c</i>&
+00012320: 6e62 7370 3b26 6e62 7370 3b54 6167 2063  nbsp;&nbsp;Tag c
+00012330: 6f6d 626f 207b 7461 677a 7d0a 2020 2020  ombo {tagz}.    
+00012340: 2020 2020 2020 2020 2020 2020 3c62 7574              <but
+00012350: 746f 6e20 7479 7065 3d27 6275 7474 6f6e  ton type='button
+00012360: 273e 3c69 2063 6c61 7373 3d27 6661 7327  '><i class='fas'
+00012370: 3e5c 7566 3030 643c 2f69 3e3c 2f62 7574  >\uf00d</i></but
+00012380: 746f 6e3e 0a20 2020 2020 2020 2020 2020  ton>.           
+00012390: 2020 2020 203c 2f68 313e 0a20 2020 2020       </h1>.     
+000123a0: 2020 2020 2020 203c 6832 3e3c 6920 636c         <h2><i cl
+000123b0: 6173 733d 2766 6173 273e 5c75 6630 3263  ass='fas'>\uf02c
+000123c0: 3c2f 693e 266e 6273 703b 266e 6273 703b  </i>&nbsp;&nbsp;
+000123d0: 5461 6773 3c2f 6832 3e0a 2020 2020 2020  Tags</h2>.      
+000123e0: 2020 2020 2020 3c64 6976 3e62 7574 746f        <div>butto
+000123f0: 6e73 2066 6f72 2074 6167 7320 676f 2068  ns for tags go h
+00012400: 6572 653c 2f64 6976 3e0a 2020 2020 2020  ere</div>.      
+00012410: 2020 2020 2020 3c68 323e 3c69 2063 6c61        <h2><i cla
+00012420: 7373 3d27 6661 7327 3e5c 7566 3134 303c  ss='fas'>\uf140<
+00012430: 2f69 3e26 6e62 7370 3b26 6e62 7370 3b54  /i>&nbsp;&nbsp;T
+00012440: 6172 6765 743c 2f68 323e 0a20 2020 2020  arget</h2>.     
+00012450: 2020 2020 2020 203c 6469 763e 7461 7267         <div>targ
+00012460: 6574 2067 6f65 7320 6865 7265 3c2f 6469  et goes here</di
+00012470: 763e 0a20 2020 2020 2020 2020 2020 203c  v>.            <
+00012480: 6469 7620 7374 796c 653d 276d 6172 6769  div style='margi
+00012490: 6e2d 746f 703a 3265 6d3b 273e 3c2f 6469  n-top:2em;'></di
+000124a0: 763e 0a20 2020 2020 2020 2020 2020 203c  v>.            <
+000124b0: 6469 7620 7374 796c 653d 2764 6973 706c  div style='displ
+000124c0: 6179 3a20 666c 6578 3b6a 7573 7469 6679  ay: flex;justify
+000124d0: 2d63 6f6e 7465 6e74 3a20 666c 6578 2d65  -content: flex-e
+000124e0: 6e64 3b27 3e0a 2020 2020 2020 2020 2020  nd;'>.          
+000124f0: 2020 2020 2020 3c62 7574 746f 6e20 7479        <button ty
+00012500: 7065 3d27 6275 7474 6f6e 2720 636c 6173  pe='button' clas
+00012510: 733d 2761 6374 696f 6e62 7574 746f 6e27  s='actionbutton'
+00012520: 3e3c 6920 636c 6173 733d 2766 6173 273e  ><i class='fas'>
+00012530: 5c75 6633 3034 3c2f 693e 266e 6273 703b  \uf304</i>&nbsp;
+00012540: 266e 6273 703b 5265 6e61 6d65 3c2f 6275  &nbsp;Rename</bu
+00012550: 7474 6f6e 3e0a 2020 2020 2020 2020 2020  tton>.          
+00012560: 2020 2020 2020 3c62 7574 746f 6e20 7479        <button ty
+00012570: 7065 3d27 6275 7474 6f6e 2720 636c 6173  pe='button' clas
+00012580: 733d 2761 6374 696f 6e62 7574 746f 6e27  s='actionbutton'
+00012590: 3e3c 6920 636c 6173 733d 2766 6173 273e  ><i class='fas'>
+000125a0: 5c75 6630 3064 3c2f 693e 266e 6273 703b  \uf00d</i>&nbsp;
+000125b0: 266e 6273 703b 4361 6e63 656c 3c2f 6275  &nbsp;Cancel</bu
+000125c0: 7474 6f6e 3e0a 2020 2020 2020 2020 2020  tton>.          
+000125d0: 2020 2020 2020 3c62 7574 746f 6e20 7479        <button ty
+000125e0: 7065 3d27 6275 7474 6f6e 2720 636c 6173  pe='button' clas
+000125f0: 733d 2761 6374 696f 6e62 7574 746f 6e20  s='actionbutton 
+00012600: 7375 626d 6974 273e 3c69 2063 6c61 7373  submit'><i class
+00012610: 3d27 6661 7327 3e5c 7566 3030 633c 2f69  ='fas'>\uf00c</i
+00012620: 3e26 6e62 7370 3b26 6e62 7370 3b41 7070  >&nbsp;&nbsp;App
+00012630: 6c79 3c2f 6275 7474 6f6e 3e0a 2020 2020  ly</button>.    
+00012640: 2020 2020 2020 2020 3c2f 6469 763e 0a20          </div>. 
+00012650: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+00012660: 2020 2020 636c 6f73 655f 6275 7420 3d20      close_but = 
+00012670: 7365 6c66 2e6d 6169 6e64 6976 2e63 6869  self.maindiv.chi
+00012680: 6c64 7265 6e5b 305d 2e63 6869 6c64 7265  ldren[0].childre
+00012690: 6e5b 2d31 5d0a 2020 2020 2020 2020 280a  n[-1].        (.
+000126a0: 2020 2020 2020 2020 2020 2020 5f2c 0a20              _,. 
+000126b0: 2020 2020 2020 2020 2020 205f 2c20 2023             _,  #
+000126c0: 2062 7574 746f 6e20 6865 6164 6572 0a20   button header. 
+000126d0: 2020 2020 2020 2020 2020 2062 7574 746f             butto
+000126e0: 6e5f 6469 762c 0a20 2020 2020 2020 2020  n_div,.         
+000126f0: 2020 205f 2c20 2023 2074 6172 6765 7420     _,  # target 
+00012700: 6865 6164 6572 0a20 2020 2020 2020 2020  header.         
+00012710: 2020 2074 6172 6765 745f 6469 762c 0a20     target_div,. 
+00012720: 2020 2020 2020 2020 2020 205f 2c20 2023             _,  #
+00012730: 206d 6172 6769 6e0a 2020 2020 2020 2020   margin.        
+00012740: 2020 2020 6669 6e69 7368 5f62 7574 746f      finish_butto
+00012750: 6e73 2c0a 2020 2020 2020 2020 2920 3d20  ns,.        ) = 
+00012760: 7365 6c66 2e6d 6169 6e64 6976 2e63 6869  self.maindiv.chi
+00012770: 6c64 7265 6e0a 2020 2020 2020 2020 636c  ldren.        cl
+00012780: 6f73 655f 6275 742e 6f6e 636c 6963 6b20  ose_but.onclick 
+00012790: 3d20 7365 6c66 2e63 6c6f 7365 0a0a 2020  = self.close..  
+000127a0: 2020 2020 2020 6275 7474 6f6e 5f64 6976        button_div
+000127b0: 2e69 6e6e 6572 4854 4d4c 203d 2022 220a  .innerHTML = "".
+000127c0: 2020 2020 2020 2020 666f 7220 7461 6720          for tag 
+000127d0: 696e 2074 6167 733a 0a20 2020 2020 2020  in tags:.       
+000127e0: 2020 2020 2063 6c72 203d 2077 696e 646f       clr = windo
+000127f0: 772e 7374 6f72 652e 7365 7474 696e 6773  w.store.settings
+00012800: 2e67 6574 5f63 6f6c 6f72 5f66 6f72 5f74  .get_color_for_t
+00012810: 6167 2874 6167 290a 2020 2020 2020 2020  ag(tag).        
+00012820: 2020 2020 656c 203d 2064 6f63 756d 656e      el = documen
+00012830: 742e 6372 6561 7465 456c 656d 656e 7428  t.createElement(
+00012840: 2262 7574 746f 6e22 290a 2020 2020 2020  "button").      
+00012850: 2020 2020 2020 656c 2e73 6574 4174 7472        el.setAttr
+00012860: 6962 7574 6528 2274 7970 6522 2c20 2262  ibute("type", "b
+00012870: 7574 746f 6e22 290a 2020 2020 2020 2020  utton").        
+00012880: 2020 2020 656c 2e73 7479 6c65 2e6d 6172      el.style.mar
+00012890: 6769 6e52 6967 6874 203d 2022 3370 7822  ginRight = "3px"
+000128a0: 0a20 2020 2020 2020 2020 2020 2065 6c2e  .            el.
+000128b0: 696e 6e65 7248 544d 4c20 3d20 6622 3c62  innerHTML = f"<b
+000128c0: 2073 7479 6c65 3d27 636f 6c6f 723a 7b63   style='color:{c
+000128d0: 6c72 7d3b 273e 233c 2f62 3e22 202b 2074  lr};'>#</b>" + t
+000128e0: 6167 5b31 3a5d 0a20 2020 2020 2020 2020  ag[1:].         
+000128f0: 2020 2065 6c2e 6f6e 636c 6963 6b20 3d20     el.onclick = 
+00012900: 7365 6c66 2e5f 6d61 6b65 5f63 6c69 636b  self._make_click
+00012910: 5f68 616e 646c 6572 2874 6167 2c20 6361  _handler(tag, ca
+00012920: 6c6c 6261 636b 290a 2020 2020 2020 2020  llback).        
+00012930: 2020 2020 6275 7474 6f6e 5f64 6976 2e61      button_div.a
+00012940: 7070 656e 6443 6869 6c64 2865 6c29 0a0a  ppendChild(el)..
+00012950: 2020 2020 2020 2020 7365 6c66 2e5f 7461          self._ta
+00012960: 7267 6574 203d 2054 6172 6765 7448 656c  rget = TargetHel
+00012970: 7065 7228 7461 6773 2c20 7461 7267 6574  per(tags, target
+00012980: 5f64 6976 290a 2020 2020 2020 2020 6669  _div).        fi
+00012990: 6e69 7368 5f62 7574 746f 6e73 2e63 6869  nish_buttons.chi
+000129a0: 6c64 7265 6e5b 305d 2e6f 6e63 6c69 636b  ldren[0].onclick
+000129b0: 203d 2073 656c 662e 7265 6e61 6d65 0a20   = self.rename. 
+000129c0: 2020 2020 2020 2066 696e 6973 685f 6275         finish_bu
+000129d0: 7474 6f6e 732e 6368 696c 6472 656e 5b31  ttons.children[1
+000129e0: 5d2e 6f6e 636c 6963 6b20 3d20 7365 6c66  ].onclick = self
+000129f0: 2e63 6c6f 7365 0a20 2020 2020 2020 2066  .close.        f
+00012a00: 696e 6973 685f 6275 7474 6f6e 732e 6368  inish_buttons.ch
+00012a10: 696c 6472 656e 5b32 5d2e 6f6e 636c 6963  ildren[2].onclic
+00012a20: 6b20 3d20 7365 6c66 2e73 7562 6d69 740a  k = self.submit.
+00012a30: 0a20 2020 2020 2020 2073 7570 6572 2829  .        super()
+00012a40: 2e6f 7065 6e28 4e6f 6e65 290a 2020 2020  .open(None).    
+00012a50: 2020 2020 7365 6c66 2e5f 6c6f 6164 5f63      self._load_c
+00012a60: 7572 7265 6e74 2829 0a0a 2020 2020 6465  urrent()..    de
+00012a70: 6620 5f6d 616b 655f 636c 6963 6b5f 6861  f _make_click_ha
+00012a80: 6e64 6c65 7228 7365 6c66 2c20 7461 672c  ndler(self, tag,
+00012a90: 2063 616c 6c62 6163 6b29 3a0a 2020 2020   callback):.    
+00012aa0: 2020 2020 6465 6620 6861 6e64 6c65 7228      def handler(
+00012ab0: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
+00012ac0: 656c 662e 636c 6f73 6528 290a 2020 2020  elf.close().    
+00012ad0: 2020 2020 2020 2020 7365 6c66 2e5f 6361          self._ca
+00012ae0: 6e76 6173 2e74 6167 5f64 6961 6c6f 672e  nvas.tag_dialog.
+00012af0: 6f70 656e 2874 6167 2c20 6361 6c6c 6261  open(tag, callba
+00012b00: 636b 292c 0a0a 2020 2020 2020 2020 7265  ck),..        re
+00012b10: 7475 726e 2068 616e 646c 6572 0a0a 2020  turn handler..  
+00012b20: 2020 6465 6620 5f6c 6f61 645f 6375 7272    def _load_curr
+00012b30: 656e 7428 7365 6c66 293a 0a20 2020 2020  ent(self):.     
+00012b40: 2020 2069 6e66 6f20 3d20 7769 6e64 6f77     info = window
+00012b50: 2e73 746f 7265 2e73 6574 7469 6e67 732e  .store.settings.
+00012b60: 6765 745f 7461 675f 696e 666f 2873 656c  get_tag_info(sel
+00012b70: 662e 5f74 6167 7a29 0a20 2020 2020 2020  f._tagz).       
+00012b80: 2073 656c 662e 5f74 6172 6765 742e 6c6f   self._target.lo
+00012b90: 6164 5f66 726f 6d5f 696e 666f 2869 6e66  ad_from_info(inf
+00012ba0: 6f29 0a0a 2020 2020 6465 6620 7375 626d  o)..    def subm
+00012bb0: 6974 2873 656c 6629 3a0a 2020 2020 2020  it(self):.      
+00012bc0: 2020 696e 666f 203d 207b 7d0a 2020 2020    info = {}.    
+00012bd0: 2020 2020 7365 6c66 2e5f 7461 7267 6574      self._target
+00012be0: 2e77 7269 7465 5f74 6f5f 696e 666f 2869  .write_to_info(i
+00012bf0: 6e66 6f29 0a20 2020 2020 2020 2077 696e  nfo).        win
+00012c00: 646f 772e 7374 6f72 652e 7365 7474 696e  dow.store.settin
+00012c10: 6773 2e73 6574 5f74 6167 5f69 6e66 6f28  gs.set_tag_info(
+00012c20: 7365 6c66 2e5f 7461 677a 2c20 696e 666f  self._tagz, info
+00012c30: 290a 2020 2020 2020 2020 7375 7065 7228  ).        super(
+00012c40: 292e 7375 626d 6974 2829 0a0a 2020 2020  ).submit()..    
+00012c50: 6465 6620 7265 6e61 6d65 2873 656c 6629  def rename(self)
+00012c60: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
+00012c70: 6361 6e76 6173 2e74 6167 5f72 656e 616d  canvas.tag_renam
+00012c80: 655f 6469 616c 6f67 2e6f 7065 6e28 7365  e_dialog.open(se
+00012c90: 6c66 2e5f 7461 677a 2e73 706c 6974 2822  lf._tagz.split("
+00012ca0: 2022 292c 2073 656c 662e 636c 6f73 6529   "), self.close)
+00012cb0: 0a0a 0a63 6c61 7373 2054 6167 4469 616c  ...class TagDial
+00012cc0: 6f67 2842 6173 6544 6961 6c6f 6729 3a0a  og(BaseDialog):.
+00012cd0: 2020 2020 2222 2244 6961 6c6f 6720 746f      """Dialog to
+00012ce0: 2063 6f6e 6669 6775 7265 2061 2073 696e   configure a sin
+00012cf0: 676c 6574 6f6e 2074 6167 2e22 2222 0a0a  gleton tag."""..
+00012d00: 2020 2020 6465 6620 6f70 656e 2873 656c      def open(sel
+00012d10: 662c 2074 6167 732c 2063 616c 6c62 6163  f, tags, callbac
+00012d20: 6b3d 4e6f 6e65 293a 0a20 2020 2020 2020  k=None):.       
+00012d30: 2023 2050 7574 2069 6e20 6465 7465 726d   # Put in determ
+00012d40: 696e 6973 7469 6320 6f72 6465 720a 2020  inistic order.  
+00012d50: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00012d60: 6e63 6528 7461 6773 2c20 7374 7229 3a0a  nce(tags, str):.
+00012d70: 2020 2020 2020 2020 2020 2020 7461 6773              tags
+00012d80: 203d 2074 6167 732e 7370 6c69 7428 2220   = tags.split(" 
+00012d90: 2229 0a20 2020 2020 2020 2074 6167 732e  ").        tags.
+00012da0: 736f 7274 2829 0a20 2020 2020 2020 2073  sort().        s
+00012db0: 656c 662e 5f74 6167 7a20 3d20 7461 677a  elf._tagz = tagz
+00012dc0: 203d 2074 6167 732e 6a6f 696e 2822 2022   = tags.join(" "
+00012dd0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00012de0: 5f64 6566 6175 6c74 5f63 6f6c 6f72 203d  _default_color =
+00012df0: 2077 696e 646f 772e 6672 6f6e 742e 434f   window.front.CO
+00012e00: 4c4f 5253 2e61 6363 5f63 6c72 0a20 2020  LORS.acc_clr.   
+00012e10: 2020 2020 2023 2073 656c 662e 5f64 6566       # self._def
+00012e20: 6175 6c74 5f63 6f6c 6f72 203d 2075 7469  ault_color = uti
+00012e30: 6c73 2e63 6f6c 6f72 5f66 726f 6d5f 6e61  ls.color_from_na
+00012e40: 6d65 2873 656c 662e 5f74 6167 7a29 0a0a  me(self._tagz)..
+00012e50: 2020 2020 2020 2020 7365 6c66 2e6d 6169          self.mai
+00012e60: 6e64 6976 2e69 6e6e 6572 4854 4d4c 203d  ndiv.innerHTML =
+00012e70: 2066 2222 220a 2020 2020 2020 2020 2020   f""".          
+00012e80: 2020 3c68 313e 3c69 2063 6c61 7373 3d27    <h1><i class='
+00012e90: 6661 7327 3e5c 7566 3032 623c 2f69 3e26  fas'>\uf02b</i>&
+00012ea0: 6e62 7370 3b26 6e62 7370 3b43 6f6e 6669  nbsp;&nbsp;Confi
+00012eb0: 6775 7265 2074 6167 207b 7461 677a 7d0a  gure tag {tagz}.
+00012ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ed0: 3c62 7574 746f 6e20 7479 7065 3d27 6275  <button type='bu
+00012ee0: 7474 6f6e 273e 3c69 2063 6c61 7373 3d27  tton'><i class='
+00012ef0: 6661 7327 3e5c 7566 3030 643c 2f69 3e3c  fas'>\uf00d</i><
+00012f00: 2f62 7574 746f 6e3e 0a20 2020 2020 2020  /button>.       
+00012f10: 2020 2020 2020 2020 203c 2f68 313e 0a20           </h1>. 
+00012f20: 2020 2020 2020 2020 2020 203c 6832 3e3c             <h2><
+00012f30: 6920 636c 6173 733d 2766 6173 273e 5c75  i class='fas'>\u
+00012f40: 6631 3430 3c2f 693e 266e 6273 703b 266e  f140</i>&nbsp;&n
+00012f50: 6273 703b 5461 7267 6574 3c2f 6832 3e0a  bsp;Target</h2>.
+00012f60: 2020 2020 2020 2020 2020 2020 3c64 6976              <div
+00012f70: 3e74 6172 6765 7420 676f 6573 2068 6572  >target goes her
+00012f80: 653c 2f64 6976 3e0a 2020 2020 2020 2020  e</div>.        
+00012f90: 2020 2020 3c68 323e 3c69 2063 6c61 7373      <h2><i class
+00012fa0: 3d27 6661 7327 3e5c 7566 3037 343c 2f69  ='fas'>\uf074</i
+00012fb0: 3e26 6e62 7370 3b26 6e62 7370 3b50 7269  >&nbsp;&nbsp;Pri
+00012fc0: 6f72 6974 793c 2f68 323e 0a20 2020 2020  ority</h2>.     
+00012fd0: 2020 2020 2020 203c 7365 6c65 6374 3e0a         <select>.
+00012fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ff0: 3c6f 7074 696f 6e20 7661 6c75 653d 2731  <option value='1
+00013000: 273e 5072 696d 6172 7920 2864 6566 6175  '>Primary (defau
+00013010: 6c74 293c 2f6f 7074 696f 6e3e 0a20 2020  lt)</option>.   
+00013020: 2020 2020 2020 2020 2020 2020 203c 6f70               <op
+00013030: 7469 6f6e 2076 616c 7565 3d27 3227 3e53  tion value='2'>S
+00013040: 6563 6f6e 6461 7279 2028 666f 7220 2265  econdary (for "e
+00013050: 7874 7261 2220 7461 6773 293c 2f6f 7074  xtra" tags)</opt
+00013060: 696f 6e3e 0a20 2020 2020 2020 2020 2020  ion>.           
+00013070: 203c 2f73 656c 6563 743e 0a20 2020 2020   </select>.     
+00013080: 2020 2020 2020 203c 6832 3e3c 6920 636c         <h2><i cl
+00013090: 6173 733d 2766 6173 273e 5c75 6635 3366  ass='fas'>\uf53f
+000130a0: 3c2f 693e 266e 6273 703b 266e 6273 703b  </i>&nbsp;&nbsp;
+000130b0: 436f 6c6f 723c 2f68 323e 0a20 2020 2020  Color</h2>.     
+000130c0: 2020 2020 2020 203c 696e 7075 7420 7479         <input ty
+000130d0: 7065 3d27 7465 7874 2720 7374 796c 653d  pe='text' style=
+000130e0: 2777 6964 7468 3a20 3130 3070 783b 2062  'width: 100px; b
+000130f0: 6f72 6465 723a 2035 7078 2073 6f6c 6964  order: 5px solid
+00013100: 2023 6565 6527 2073 7065 6c6c 6368 6563   #eee' spellchec
+00013110: 6b3d 2766 616c 7365 2720 2f3e 0a20 2020  k='false' />.   
+00013120: 2020 2020 2020 2020 203c 6275 7474 6f6e           <button
+00013130: 2074 7970 653d 2762 7574 746f 6e27 2073   type='button' s
+00013140: 7479 6c65 3d27 6d61 7267 696e 2d6c 6566  tyle='margin-lef
+00013150: 743a 2032 7078 273e 3c69 2063 6c61 7373  t: 2px'><i class
+00013160: 3d27 6661 7327 3e5c 7566 3132 643c 2f69  ='fas'>\uf12d</i
+00013170: 3e20 4465 6661 756c 743c 2f62 7574 746f  > Default</butto
+00013180: 6e3e 0a20 2020 2020 2020 2020 2020 203c  n>.            <
+00013190: 6275 7474 6f6e 2074 7970 653d 2762 7574  button type='but
+000131a0: 746f 6e27 2073 7479 6c65 3d27 6d61 7267  ton' style='marg
+000131b0: 696e 2d6c 6566 743a 2032 7078 273e 3c69  in-left: 2px'><i
+000131c0: 2063 6c61 7373 3d27 6661 7327 3e5c 7566   class='fas'>\uf
+000131d0: 3266 313c 2f69 3e20 5261 6e64 6f6d 3c2f  2f1</i> Random</
+000131e0: 6275 7474 6f6e 3e0a 2020 2020 2020 2020  button>.        
+000131f0: 2020 2020 3c62 723e 0a20 2020 2020 2020      <br>.       
+00013200: 2020 2020 203c 6469 7620 7374 796c 653d       <div style=
+00013210: 2764 6973 706c 6179 3a20 696e 6c69 6e65  'display: inline
+00013220: 2d67 7269 643b 2067 7269 642d 6761 703a  -grid; grid-gap:
+00013230: 2032 7078 3b27 3e3c 2f64 6976 3e0a 2020   2px;'></div>.  
+00013240: 2020 2020 2020 2020 2020 3c64 6976 2073            <div s
+00013250: 7479 6c65 3d27 6d61 7267 696e 2d74 6f70  tyle='margin-top
+00013260: 3a32 656d 3b27 3e3c 2f64 6976 3e0a 2020  :2em;'></div>.  
+00013270: 2020 2020 2020 2020 2020 3c64 6976 2073            <div s
+00013280: 7479 6c65 3d27 6469 7370 6c61 793a 2066  tyle='display: f
+00013290: 6c65 783b 6a75 7374 6966 792d 636f 6e74  lex;justify-cont
+000132a0: 656e 743a 2066 6c65 782d 656e 643b 273e  ent: flex-end;'>
+000132b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000132c0: 203c 6275 7474 6f6e 2074 7970 653d 2762   <button type='b
+000132d0: 7574 746f 6e27 2063 6c61 7373 3d27 6163  utton' class='ac
+000132e0: 7469 6f6e 6275 7474 6f6e 273e 3c69 2063  tionbutton'><i c
+000132f0: 6c61 7373 3d27 6661 7327 3e5c 7566 3330  lass='fas'>\uf30
+00013300: 343c 2f69 3e26 6e62 7370 3b26 6e62 7370  4</i>&nbsp;&nbsp
+00013310: 3b52 656e 616d 653c 2f62 7574 746f 6e3e  ;Rename</button>
+00013320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013330: 203c 6275 7474 6f6e 2074 7970 653d 2762   <button type='b
+00013340: 7574 746f 6e27 2063 6c61 7373 3d27 6163  utton' class='ac
+00013350: 7469 6f6e 6275 7474 6f6e 273e 3c69 2063  tionbutton'><i c
+00013360: 6c61 7373 3d27 6661 7327 3e5c 7566 3030  lass='fas'>\uf00
+00013370: 643c 2f69 3e26 6e62 7370 3b26 6e62 7370  d</i>&nbsp;&nbsp
+00013380: 3b43 616e 6365 6c3c 2f62 7574 746f 6e3e  ;Cancel</button>
+00013390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000133a0: 203c 6275 7474 6f6e 2074 7970 653d 2762   <button type='b
+000133b0: 7574 746f 6e27 2063 6c61 7373 3d27 6163  utton' class='ac
+000133c0: 7469 6f6e 6275 7474 6f6e 2073 7562 6d69  tionbutton submi
+000133d0: 7427 3e3c 6920 636c 6173 733d 2766 6173  t'><i class='fas
+000133e0: 273e 5c75 6630 3063 3c2f 693e 266e 6273  '>\uf00c</i>&nbs
+000133f0: 703b 266e 6273 703b 4170 706c 793c 2f62  p;&nbsp;Apply</b
+00013400: 7574 746f 6e3e 0a20 2020 2020 2020 2020  utton>.         
+00013410: 2020 203c 2f64 6976 3e0a 2020 2020 2020     </div>.      
+00013420: 2020 2222 220a 0a20 2020 2020 2020 2063    """..        c
+00013430: 6c6f 7365 5f62 7574 203d 2073 656c 662e  lose_but = self.
+00013440: 6d61 696e 6469 762e 6368 696c 6472 656e  maindiv.children
+00013450: 5b30 5d2e 6368 696c 6472 656e 5b2d 315d  [0].children[-1]
+00013460: 0a0a 2020 2020 2020 2020 280a 2020 2020  ..        (.    
+00013470: 2020 2020 2020 2020 5f2c 2020 2320 6831          _,  # h1
+00013480: 0a20 2020 2020 2020 2020 2020 205f 2c20  .            _, 
+00013490: 2023 2074 6172 6765 7420 6865 6164 6572   # target header
+000134a0: 0a20 2020 2020 2020 2020 2020 2074 6172  .            tar
+000134b0: 6765 745f 6469 762c 0a20 2020 2020 2020  get_div,.       
+000134c0: 2020 2020 205f 2c20 2023 2070 7269 6f72       _,  # prior
+000134d0: 6974 7920 6865 6164 6572 0a20 2020 2020  ity header.     
+000134e0: 2020 2020 2020 2073 656c 662e 5f70 7269         self._pri
+000134f0: 6f72 6974 795f 7365 6c65 6374 2c0a 2020  ority_select,.  
+00013500: 2020 2020 2020 2020 2020 5f2c 2020 2320            _,  # 
+00013510: 636f 6c6f 7220 6865 6164 6572 0a20 2020  color header.   
+00013520: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
+00013530: 6f6c 6f72 5f69 6e70 7574 2c0a 2020 2020  olor_input,.    
+00013540: 2020 2020 2020 2020 7365 6c66 2e5f 636f          self._co
+00013550: 6c6f 725f 6465 6661 756c 745f 6275 7474  lor_default_butt
+00013560: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
+00013570: 7365 6c66 2e5f 636f 6c6f 725f 7261 6e64  self._color_rand
+00013580: 6f6d 5f62 7574 746f 6e2c 0a20 2020 2020  om_button,.     
+00013590: 2020 2020 2020 205f 2c20 2023 2062 720a         _,  # br.
+000135a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000135b0: 2e5f 636f 6c6f 725f 6772 6964 2c0a 2020  ._color_grid,.  
+000135c0: 2020 2020 2020 2020 2020 5f2c 2020 2320            _,  # 
+000135d0: 6761 700a 2020 2020 2020 2020 2020 2020  gap.            
+000135e0: 6669 6e69 7368 5f62 7574 746f 6e73 2c0a  finish_buttons,.
+000135f0: 2020 2020 2020 2020 2920 3d20 7365 6c66          ) = self
+00013600: 2e6d 6169 6e64 6976 2e63 6869 6c64 7265  .maindiv.childre
+00013610: 6e0a 0a20 2020 2020 2020 2073 656c 662e  n..        self.
+00013620: 5f74 6172 6765 7420 3d20 5461 7267 6574  _target = Target
+00013630: 4865 6c70 6572 2874 6167 732c 2074 6172  Helper(tags, tar
+00013640: 6765 745f 6469 7629 0a0a 2020 2020 2020  get_div)..      
+00013650: 2020 2320 436f 6e6e 6563 7420 7468 696e    # Connect thin
+00013660: 6773 2075 700a 2020 2020 2020 2020 636c  gs up.        cl
+00013670: 6f73 655f 6275 742e 6f6e 636c 6963 6b20  ose_but.onclick 
+00013680: 3d20 7365 6c66 2e63 6c6f 7365 0a20 2020  = self.close.   
+00013690: 2020 2020 2066 696e 6973 685f 6275 7474       finish_butt
+000136a0: 6f6e 732e 6368 696c 6472 656e 5b30 5d2e  ons.children[0].
+000136b0: 6f6e 636c 6963 6b20 3d20 7365 6c66 2e72  onclick = self.r
+000136c0: 656e 616d 650a 2020 2020 2020 2020 6669  ename.        fi
+000136d0: 6e69 7368 5f62 7574 746f 6e73 2e63 6869  nish_buttons.chi
+000136e0: 6c64 7265 6e5b 315d 2e6f 6e63 6c69 636b  ldren[1].onclick
+000136f0: 203d 2073 656c 662e 636c 6f73 650a 2020   = self.close.  
+00013700: 2020 2020 2020 6669 6e69 7368 5f62 7574        finish_but
+00013710: 746f 6e73 2e63 6869 6c64 7265 6e5b 325d  tons.children[2]
+00013720: 2e6f 6e63 6c69 636b 203d 2073 656c 662e  .onclick = self.
+00013730: 7375 626d 6974 0a0a 2020 2020 2020 2020  submit..        
+00013740: 7365 6c66 2e5f 636f 6c6f 725f 696e 7075  self._color_inpu
+00013750: 742e 6f6e 6368 616e 6765 203d 206c 616d  t.onchange = lam
+00013760: 6264 613a 2073 656c 662e 5f73 6574 5f63  bda: self._set_c
+00013770: 6f6c 6f72 2873 656c 662e 5f63 6f6c 6f72  olor(self._color
+00013780: 5f69 6e70 7574 2e76 616c 7565 290a 2020  _input.value).  
+00013790: 2020 2020 2020 7365 6c66 2e5f 636f 6c6f        self._colo
+000137a0: 725f 6465 6661 756c 745f 6275 7474 6f6e  r_default_button
+000137b0: 2e6f 6e63 6c69 636b 203d 2073 656c 662e  .onclick = self.
+000137c0: 5f73 6574 5f64 6566 6175 6c74 5f63 6f6c  _set_default_col
+000137d0: 6f72 0a20 2020 2020 2020 2073 656c 662e  or.        self.
+000137e0: 5f63 6f6c 6f72 5f72 616e 646f 6d5f 6275  _color_random_bu
+000137f0: 7474 6f6e 2e6f 6e63 6c69 636b 203d 2073  tton.onclick = s
+00013800: 656c 662e 5f73 6574 5f72 616e 646f 6d5f  elf._set_random_
+00013810: 636f 6c6f 720a 0a20 2020 2020 2020 2023  color..        #
+00013820: 2047 656e 6572 6174 6520 7061 6c65 7474   Generate palett
+00013830: 650a 2020 2020 2020 2020 7365 6c66 2e5f  e.        self._
+00013840: 636f 6c6f 725f 6772 6964 2e73 7479 6c65  color_grid.style
+00013850: 2e67 7269 6454 656d 706c 6174 6543 6f6c  .gridTemplateCol
+00013860: 756d 6e73 203d 2022 6175 746f 2022 2e72  umns = "auto ".r
+00013870: 6570 6561 7428 7574 696c 732e 5041 4c45  epeat(utils.PALE
+00013880: 5454 455f 434f 4c53 290a 2020 2020 2020  TTE_COLS).      
+00013890: 2020 666f 7220 6865 7820 696e 2075 7469    for hex in uti
+000138a0: 6c73 2e50 414c 4554 5445 323a 0a20 2020  ls.PALETTE2:.   
+000138b0: 2020 2020 2020 2020 2065 6c20 3d20 646f           el = do
+000138c0: 6375 6d65 6e74 2e63 7265 6174 6545 6c65  cument.createEle
+000138d0: 6d65 6e74 2822 7370 616e 2229 0a20 2020  ment("span").   
+000138e0: 2020 2020 2020 2020 2065 6c2e 7374 796c           el.styl
+000138f0: 652e 6261 636b 6772 6f75 6e64 203d 2068  e.background = h
+00013900: 6578 0a20 2020 2020 2020 2020 2020 2065  ex.            e
+00013910: 6c2e 7374 796c 652e 7769 6474 6820 3d20  l.style.width = 
+00013920: 2233 3070 7822 0a20 2020 2020 2020 2020  "30px".         
+00013930: 2020 2065 6c2e 7374 796c 652e 6865 6967     el.style.heig
+00013940: 6874 203d 2022 3330 7078 220a 2020 2020  ht = "30px".    
+00013950: 2020 2020 2020 2020 7365 6c66 2e5f 6d61          self._ma
+00013960: 6b65 5f63 6c69 636b 6162 6c65 2865 6c2c  ke_clickable(el,
+00013970: 2068 6578 290a 2020 2020 2020 2020 2020   hex).          
+00013980: 2020 7365 6c66 2e5f 636f 6c6f 725f 6772    self._color_gr
+00013990: 6964 2e61 7070 656e 6443 6869 6c64 2865  id.appendChild(e
+000139a0: 6c29 0a0a 2020 2020 2020 2020 7375 7065  l)..        supe
+000139b0: 7228 292e 6f70 656e 2863 616c 6c62 6163  r().open(callbac
+000139c0: 6b29 0a20 2020 2020 2020 2073 656c 662e  k).        self.
+000139d0: 5f6c 6f61 645f 6375 7272 656e 7428 290a  _load_current().
+000139e0: 2020 2020 2020 2020 6966 2075 7469 6c73          if utils
+000139f0: 2e6c 6f6f 6b73 5f6c 696b 655f 6465 736b  .looks_like_desk
+00013a00: 746f 7028 293a 0a20 2020 2020 2020 2020  top():.         
+00013a10: 2020 2073 656c 662e 5f63 6f6c 6f72 5f69     self._color_i
+00013a20: 6e70 7574 2e66 6f63 7573 2829 0a20 2020  nput.focus().   
+00013a30: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
+00013a40: 6f6c 6f72 5f69 6e70 7574 2e73 656c 6563  olor_input.selec
+00013a50: 7428 290a 0a20 2020 2064 6566 205f 6f6e  t()..    def _on
+00013a60: 5f6b 6579 2873 656c 662c 2065 293a 0a20  _key(self, e):. 
+00013a70: 2020 2020 2020 206b 6579 203d 2065 2e6b         key = e.k
+00013a80: 6579 2e6c 6f77 6572 2829 0a20 2020 2020  ey.lower().     
+00013a90: 2020 2069 6620 6b65 7920 3d3d 2022 656e     if key == "en
+00013aa0: 7465 7222 206f 7220 6b65 7920 3d3d 2022  ter" or key == "
+00013ab0: 7265 7475 726e 223a 0a20 2020 2020 2020  return":.       
+00013ac0: 2020 2020 2065 2e70 7265 7665 6e74 4465       e.preventDe
+00013ad0: 6661 756c 7428 290a 2020 2020 2020 2020  fault().        
+00013ae0: 2020 2020 7365 6c66 2e73 7562 6d69 7428      self.submit(
+00013af0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+00013b00: 2020 2020 2020 2020 2020 2020 7375 7065              supe
+00013b10: 7228 292e 5f6f 6e5f 6b65 7928 6529 0a0a  r()._on_key(e)..
+00013b20: 2020 2020 6465 6620 5f6d 616b 655f 636c      def _make_cl
+00013b30: 6963 6b61 626c 6528 7365 6c66 2c20 656c  ickable(self, el
+00013b40: 2c20 6865 7829 3a0a 2020 2020 2020 2020  , hex):.        
+00013b50: 2320 6465 6620 636c 6963 6b63 616c 6c62  # def clickcallb
+00013b60: 6163 6b28 293a 0a20 2020 2020 2020 2023  ack():.        #
+00013b70: 2020 2020 2073 656c 662e 5f63 6f6c 6f72       self._color
+00013b80: 5f69 6e70 7574 2e76 616c 7565 203d 2068  _input.value = h
+00013b90: 6578 0a20 2020 2020 2020 2065 6c2e 6f6e  ex.        el.on
+00013ba0: 636c 6963 6b20 3d20 6c61 6d62 6461 3a20  click = lambda: 
+00013bb0: 7365 6c66 2e5f 7365 745f 636f 6c6f 7228  self._set_color(
+00013bc0: 6865 7829 0a0a 2020 2020 6465 6620 5f73  hex)..    def _s
+00013bd0: 6574 5f64 6566 6175 6c74 5f63 6f6c 6f72  et_default_color
+00013be0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00013bf0: 7365 6c66 2e5f 7365 745f 636f 6c6f 7228  self._set_color(
+00013c00: 7365 6c66 2e5f 6465 6661 756c 745f 636f  self._default_co
+00013c10: 6c6f 7229 0a0a 2020 2020 6465 6620 5f73  lor)..    def _s
+00013c20: 6574 5f72 616e 646f 6d5f 636f 6c6f 7228  et_random_color(
+00013c30: 7365 6c66 293a 0a20 2020 2020 2020 2063  self):.        c
+00013c40: 6c72 203d 2022 2322 202b 204d 6174 682e  lr = "#" + Math.
+00013c50: 666c 6f6f 7228 4d61 7468 2e72 616e 646f  floor(Math.rando
+00013c60: 6d28 2920 2a20 3136 3737 3732 3135 292e  m() * 16777215).
+00013c70: 746f 5374 7269 6e67 2831 3629 0a20 2020  toString(16).   
+00013c80: 2020 2020 2073 656c 662e 5f73 6574 5f63       self._set_c
+00013c90: 6f6c 6f72 2863 6c72 290a 0a20 2020 2064  olor(clr)..    d
+00013ca0: 6566 205f 7365 745f 636f 6c6f 7228 7365  ef _set_color(se
+00013cb0: 6c66 2c20 636c 7229 3a0a 2020 2020 2020  lf, clr):.      
+00013cc0: 2020 6966 206e 6f74 2063 6c72 206f 7220    if not clr or 
+00013cd0: 636c 722e 6c6f 7765 7228 2920 696e 205b  clr.lower() in [
+00013ce0: 2261 7574 6f22 2c20 2275 6e64 6566 696e  "auto", "undefin
+00013cf0: 6564 222c 2022 6e75 6c6c 225d 3a0a 2020  ed", "null"]:.  
+00013d00: 2020 2020 2020 2020 2020 636c 7220 3d20            clr = 
+00013d10: 7365 6c66 2e5f 6465 6661 756c 745f 636f  self._default_co
+00013d20: 6c6f 720a 2020 2020 2020 2020 6966 2063  lor.        if c
+00013d30: 6c72 2021 3d20 7365 6c66 2e5f 636f 6c6f  lr != self._colo
+00013d40: 725f 696e 7075 742e 7661 6c75 653a 0a20  r_input.value:. 
+00013d50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00013d60: 5f63 6f6c 6f72 5f69 6e70 7574 2e76 616c  _color_input.val
+00013d70: 7565 203d 2063 6c72 0a20 2020 2020 2020  ue = clr.       
+00013d80: 2073 656c 662e 5f63 6f6c 6f72 5f69 6e70   self._color_inp
+00013d90: 7574 2e73 7479 6c65 2e62 6f72 6465 7243  ut.style.borderC
+00013da0: 6f6c 6f72 203d 2022 7267 6261 2830 2c20  olor = "rgba(0, 
+00013db0: 302c 2030 2c20 3029 220a 2020 2020 2020  0, 0, 0)".      
+00013dc0: 2020 7365 6c66 2e5f 636f 6c6f 725f 696e    self._color_in
+00013dd0: 7075 742e 7374 796c 652e 626f 7264 6572  put.style.border
+00013de0: 436f 6c6f 7220 3d20 636c 720a 0a20 2020  Color = clr..   
+00013df0: 2064 6566 205f 6c6f 6164 5f63 7572 7265   def _load_curre
+00013e00: 6e74 2873 656c 6629 3a0a 2020 2020 2020  nt(self):.      
+00013e10: 2020 696e 666f 203d 2077 696e 646f 772e    info = window.
+00013e20: 7374 6f72 652e 7365 7474 696e 6773 2e67  store.settings.g
+00013e30: 6574 5f74 6167 5f69 6e66 6f28 7365 6c66  et_tag_info(self
+00013e40: 2e5f 7461 677a 290a 2020 2020 2020 2020  ._tagz).        
+00013e50: 7365 6c66 2e5f 7461 7267 6574 2e6c 6f61  self._target.loa
+00013e60: 645f 6672 6f6d 5f69 6e66 6f28 696e 666f  d_from_info(info
+00013e70: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
+00013e80: 7072 696f 7269 7479 5f73 656c 6563 742e  priority_select.
+00013e90: 7661 6c75 6520 3d20 696e 666f 2e67 6574  value = info.get
+00013ea0: 2822 7072 696f 7269 7479 222c 2030 2920  ("priority", 0) 
+00013eb0: 6f72 2031 0a20 2020 2020 2020 2073 656c  or 1.        sel
+00013ec0: 662e 5f73 6574 5f63 6f6c 6f72 2869 6e66  f._set_color(inf
+00013ed0: 6f2e 6765 7428 2263 6f6c 6f72 222c 2022  o.get("color", "
+00013ee0: 2229 290a 0a20 2020 2064 6566 2073 7562  "))..    def sub
+00013ef0: 6d69 7428 7365 6c66 293a 0a20 2020 2020  mit(self):.     
+00013f00: 2020 2069 6e66 6f20 3d20 7b7d 0a20 2020     info = {}.   
+00013f10: 2020 2020 2023 2053 6574 2074 6172 6765       # Set targe
+00013f20: 740a 2020 2020 2020 2020 7365 6c66 2e5f  t.        self._
+00013f30: 7461 7267 6574 2e77 7269 7465 5f74 6f5f  target.write_to_
+00013f40: 696e 666f 2869 6e66 6f29 0a20 2020 2020  info(info).     
+00013f50: 2020 2023 2053 6574 2070 7269 6f72 6974     # Set priorit
+00013f60: 790a 2020 2020 2020 2020 7072 696f 203d  y.        prio =
+00013f70: 2069 6e74 2873 656c 662e 5f70 7269 6f72   int(self._prior
+00013f80: 6974 795f 7365 6c65 6374 2e76 616c 7565  ity_select.value
+00013f90: 290a 2020 2020 2020 2020 696e 666f 5b22  ).        info["
+00013fa0: 7072 696f 7269 7479 225d 203d 2030 2069  priority"] = 0 i
+00013fb0: 6620 7072 696f 203d 3d20 3120 656c 7365  f prio == 1 else
+00013fc0: 2070 7269 6f0a 2020 2020 2020 2020 2320   prio.        # 
+00013fd0: 5365 7420 636f 6c6f 720a 2020 2020 2020  Set color.      
+00013fe0: 2020 636c 7220 3d20 7365 6c66 2e5f 636f    clr = self._co
+00013ff0: 6c6f 725f 696e 7075 742e 7661 6c75 650a  lor_input.value.
+00014000: 2020 2020 2020 2020 696e 666f 5b22 636f          info["co
+00014010: 6c6f 7222 5d20 3d20 2222 2069 6620 636c  lor"] = "" if cl
+00014020: 7220 3d3d 2073 656c 662e 5f64 6566 6175  r == self._defau
+00014030: 6c74 5f63 6f6c 6f72 2065 6c73 6520 636c  lt_color else cl
+00014040: 720a 2020 2020 2020 2020 2320 5374 6f72  r.        # Stor
+00014050: 650a 2020 2020 2020 2020 7769 6e64 6f77  e.        window
+00014060: 2e73 746f 7265 2e73 6574 7469 6e67 732e  .store.settings.
+00014070: 7365 745f 7461 675f 696e 666f 2873 656c  set_tag_info(sel
+00014080: 662e 5f74 6167 7a2c 2069 6e66 6f29 0a20  f._tagz, info). 
+00014090: 2020 2020 2020 2073 7570 6572 2829 2e73         super().s
+000140a0: 7562 6d69 7428 290a 0a20 2020 2064 6566  ubmit()..    def
+000140b0: 2072 656e 616d 6528 7365 6c66 293a 0a20   rename(self):. 
+000140c0: 2020 2020 2020 2073 656c 662e 5f63 616e         self._can
+000140d0: 7661 732e 7461 675f 7265 6e61 6d65 5f64  vas.tag_rename_d
+000140e0: 6961 6c6f 672e 6f70 656e 2873 656c 662e  ialog.open(self.
+000140f0: 5f74 6167 7a2e 7370 6c69 7428 2220 2229  _tagz.split(" ")
+00014100: 2c20 7365 6c66 2e63 6c6f 7365 290a 0a0a  , self.close)...
+00014110: 636c 6173 7320 5461 6750 7265 7365 7473  class TagPresets
+00014120: 4469 616c 6f67 2842 6173 6544 6961 6c6f  Dialog(BaseDialo
+00014130: 6729 3a0a 2020 2020 2222 2244 6961 6c6f  g):.    """Dialo
+00014140: 6720 746f 2064 6566 696e 6520 7461 6720  g to define tag 
+00014150: 7072 6573 6574 732e 2222 220a 0a20 2020  presets."""..   
+00014160: 2064 6566 206f 7065 6e28 7365 6c66 2c20   def open(self, 
+00014170: 6361 6c6c 6261 636b 3d4e 6f6e 6529 3a0a  callback=None):.
+00014180: 2020 2020 2020 2020 7365 6c66 2e6d 6169          self.mai
+00014190: 6e64 6976 2e69 6e6e 6572 4854 4d4c 203d  ndiv.innerHTML =
+000141a0: 2066 2222 220a 2020 2020 2020 2020 2020   f""".          
+000141b0: 2020 3c68 313e 3c69 2063 6c61 7373 3d27    <h1><i class='
+000141c0: 6661 7327 3e5c 7566 3034 343c 2f69 3e26  fas'>\uf044</i>&
+000141d0: 6e62 7370 3b26 6e62 7370 3b54 6167 2070  nbsp;&nbsp;Tag p
+000141e0: 7265 7365 7473 0a20 2020 2020 2020 2020  resets.         
+000141f0: 2020 2020 2020 203c 6275 7474 6f6e 2074         <button t
+00014200: 7970 653d 2762 7574 746f 6e27 3e3c 6920  ype='button'><i 
+00014210: 636c 6173 733d 2766 6173 273e 5c75 6630  class='fas'>\uf0
+00014220: 3064 3c2f 693e 3c2f 6275 7474 6f6e 3e0a  0d</i></button>.
+00014230: 2020 2020 2020 2020 2020 2020 3c2f 6831              </h1
+00014240: 3e0a 2020 2020 2020 2020 2020 2020 3c70  >.            <p
+00014250: 3e0a 2020 2020 2020 2020 2020 2020 5573  >.            Us
+00014260: 6520 7468 6520 7465 7874 2066 6965 6c64  e the text field
+00014270: 2062 656c 6f77 2074 6f20 6465 6669 6e65   below to define
+00014280: 2074 6167 2070 7265 7365 7473 2c20 6f6e   tag presets, on
+00014290: 6520 7065 7220 6c69 6e65 2e0a 2020 2020  e per line..    
+000142a0: 2020 2020 2020 2020 4561 6368 206c 696e          Each lin
+000142b0: 6520 6d61 7920 636f 6e74 6169 6e20 6f6e  e may contain on
+000142c0: 6520 6f72 206d 6f72 6520 7461 6773 2e0a  e or more tags..
+000142d0: 2020 2020 2020 2020 2020 2020 596f 7520              You 
+000142e0: 6361 6e20 616c 736f 2064 7261 672d 616e  can also drag-an
+000142f0: 642d 6472 6f70 2061 2074 6578 7420 6669  d-drop a text fi
+00014300: 6c65 2077 6974 6820 7072 6573 6574 732e  le with presets.
+00014310: 0a20 2020 2020 2020 2020 2020 203c 2f70  .            </p
+00014320: 3e0a 2020 2020 2020 2020 2020 2020 3c62  >.            <b
+00014330: 7574 746f 6e20 7479 7065 3d27 6275 7474  utton type='butt
+00014340: 6f6e 273e 4368 6563 6b20 2620 5361 7665  on'>Check & Save
+00014350: 3c2f 6275 7474 6f6e 3e0a 2020 2020 2020  </button>.      
+00014360: 2020 2020 2020 3c64 6976 3e3c 2f64 6976        <div></div
+00014370: 3e0a 2020 2020 2020 2020 2020 2020 3c74  >.            <t
+00014380: 6578 7461 7265 6120 726f 7773 3d27 3132  extarea rows='12
+00014390: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+000143a0: 2020 7374 796c 653d 2762 6163 6b67 726f    style='backgro
+000143b0: 756e 643a 2023 6666 663b 2064 6973 706c  und: #fff; displ
+000143c0: 6179 3a20 626c 6f63 6b3b 206d 6172 6769  ay: block; margi
+000143d0: 6e3a 2030 2e35 656d 3b20 7769 6474 683a  n: 0.5em; width:
+000143e0: 2063 616c 6328 3130 3025 202d 2031 2e35   calc(100% - 1.5
+000143f0: 656d 293b 273e 0a20 2020 2020 2020 2020  em);'>.         
+00014400: 2020 203c 2f74 6578 7461 7265 613e 0a20     </textarea>. 
+00014410: 2020 2020 2020 2020 2020 2022 2222 0a0a             """..
+00014420: 2020 2020 2020 2020 7365 6c66 2e5f 696e          self._in
+00014430: 7075 745f 656c 656d 656e 7420 3d20 7365  put_element = se
+00014440: 6c66 2e6d 6169 6e64 6976 2e63 6869 6c64  lf.maindiv.child
+00014450: 7265 6e5b 2d31 5d0a 2020 2020 2020 2020  ren[-1].        
+00014460: 7365 6c66 2e5f 696e 7075 745f 656c 656d  self._input_elem
+00014470: 656e 742e 7661 6c75 6520 3d20 2222 0a20  ent.value = "". 
+00014480: 2020 2020 2020 2073 656c 662e 5f69 6e70         self._inp
+00014490: 7574 5f65 6c65 6d65 6e74 2e6f 6e64 7261  ut_element.ondra
+000144a0: 6765 7869 7420 3d20 7365 6c66 2e5f 6f6e  gexit = self._on
+000144b0: 5f64 726f 705f 7374 6f70 0a20 2020 2020  _drop_stop.     
+000144c0: 2020 2073 656c 662e 5f69 6e70 7574 5f65     self._input_e
+000144d0: 6c65 6d65 6e74 2e6f 6e64 7261 676f 7665  lement.ondragove
+000144e0: 7220 3d20 7365 6c66 2e5f 6f6e 5f64 726f  r = self._on_dro
+000144f0: 705f 6f76 6572 0a20 2020 2020 2020 2073  p_over.        s
+00014500: 656c 662e 5f69 6e70 7574 5f65 6c65 6d65  elf._input_eleme
+00014510: 6e74 2e6f 6e64 726f 7020 3d20 7365 6c66  nt.ondrop = self
+00014520: 2e5f 6f6e 5f64 726f 700a 2020 2020 2020  ._on_drop.      
+00014530: 2020 7365 6c66 2e5f 696e 7075 745f 656c    self._input_el
+00014540: 656d 656e 742e 6f6e 696e 7075 7420 3d20  ement.oninput = 
+00014550: 7365 6c66 2e5f 6f6e 5f65 6469 740a 2020  self._on_edit.  
+00014560: 2020 2020 2020 7365 6c66 2e5f 696e 7075        self._inpu
+00014570: 745f 656c 656d 656e 742e 6f6e 6368 616e  t_element.onchan
+00014580: 6765 203d 2073 656c 662e 5f6f 6e5f 6564  ge = self._on_ed
+00014590: 6974 0a0a 2020 2020 2020 2020 7365 6c66  it..        self
+000145a0: 2e5f 616e 616c 7973 6973 5f6f 7574 203d  ._analysis_out =
+000145b0: 2073 656c 662e 6d61 696e 6469 762e 6368   self.maindiv.ch
+000145c0: 696c 6472 656e 5b2d 325d 0a0a 2020 2020  ildren[-2]..    
+000145d0: 2020 2020 7365 6c66 2e5f 6170 706c 795f      self._apply_
+000145e0: 6275 7420 3d20 7365 6c66 2e6d 6169 6e64  but = self.maind
+000145f0: 6976 2e63 6869 6c64 7265 6e5b 325d 0a20  iv.children[2]. 
+00014600: 2020 2020 2020 2073 656c 662e 5f61 7070         self._app
+00014610: 6c79 5f62 7574 2e6f 6e63 6c69 636b 203d  ly_but.onclick =
+00014620: 2073 656c 662e 646f 5f61 7070 6c79 0a0a   self.do_apply..
+00014630: 2020 2020 2020 2020 7365 6c66 2e5f 6361          self._ca
+00014640: 6e63 656c 5f62 7574 203d 2073 656c 662e  ncel_but = self.
+00014650: 6d61 696e 6469 762e 6368 696c 6472 656e  maindiv.children
+00014660: 5b30 5d2e 6368 696c 6472 656e 5b2d 315d  [0].children[-1]
+00014670: 0a20 2020 2020 2020 2073 656c 662e 5f63  .        self._c
+00014680: 616e 6365 6c5f 6275 742e 6f6e 636c 6963  ancel_but.onclic
+00014690: 6b20 3d20 7365 6c66 2e63 6c6f 7365 0a20  k = self.close. 
+000146a0: 2020 2020 2020 2073 7570 6572 2829 2e6f         super().o
+000146b0: 7065 6e28 6361 6c6c 6261 636b 290a 2020  pen(callback).  
+000146c0: 2020 2020 2020 7365 6c66 2e5f 6c6f 6164        self._load
+000146d0: 5f63 7572 7265 6e74 2829 0a0a 2020 2020  _current()..    
+000146e0: 6465 6620 5f6f 6e5f 6472 6f70 5f73 746f  def _on_drop_sto
+000146f0: 7028 7365 6c66 2c20 6576 293a 0a20 2020  p(self, ev):.   
+00014700: 2020 2020 2073 656c 662e 5f69 6e70 7574       self._input
+00014710: 5f65 6c65 6d65 6e74 2e73 7479 6c65 2e62  _element.style.b
+00014720: 6163 6b67 726f 756e 6420 3d20 4e6f 6e65  ackground = None
+00014730: 0a0a 2020 2020 6465 6620 5f6f 6e5f 6472  ..    def _on_dr
+00014740: 6f70 5f6f 7665 7228 7365 6c66 2c20 6576  op_over(self, ev
+00014750: 293a 0a20 2020 2020 2020 2065 762e 7072  ):.        ev.pr
+00014760: 6576 656e 7444 6566 6175 6c74 2829 0a20  eventDefault(). 
+00014770: 2020 2020 2020 2073 656c 662e 5f69 6e70         self._inp
+00014780: 7574 5f65 6c65 6d65 6e74 2e73 7479 6c65  ut_element.style
+00014790: 2e62 6163 6b67 726f 756e 6420 3d20 2223  .background = "#
+000147a0: 4446 4422 0a0a 2020 2020 6465 6620 5f6f  DFD"..    def _o
+000147b0: 6e5f 6472 6f70 2873 656c 662c 2065 7629  n_drop(self, ev)
+000147c0: 3a0a 2020 2020 2020 2020 6576 2e70 7265  :.        ev.pre
+000147d0: 7665 6e74 4465 6661 756c 7428 290a 2020  ventDefault().  
+000147e0: 2020 2020 2020 7365 6c66 2e5f 6f6e 5f64        self._on_d
+000147f0: 726f 705f 7374 6f70 2829 0a0a 2020 2020  rop_stop()..    
+00014800: 2020 2020 6465 6620 6170 706c 795f 7465      def apply_te
+00014810: 7874 2873 293a 0a20 2020 2020 2020 2020  xt(s):.         
+00014820: 2020 2073 656c 662e 5f69 6e70 7574 5f65     self._input_e
+00014830: 6c65 6d65 6e74 2e76 616c 7565 203d 2073  lement.value = s
+00014840: 0a0a 2020 2020 2020 2020 6966 2065 762e  ..        if ev.
+00014850: 6461 7461 5472 616e 7366 6572 2e69 7465  dataTransfer.ite
+00014860: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
+00014870: 666f 7220 6920 696e 2072 616e 6765 286c  for i in range(l
+00014880: 656e 2865 762e 6461 7461 5472 616e 7366  en(ev.dataTransf
+00014890: 6572 2e69 7465 6d73 2929 3a0a 2020 2020  er.items)):.    
+000148a0: 2020 2020 2020 2020 2020 2020 6966 2065              if e
+000148b0: 762e 6461 7461 5472 616e 7366 6572 2e69  v.dataTransfer.i
+000148c0: 7465 6d73 5b69 5d2e 6b69 6e64 203d 3d20  tems[i].kind == 
+000148d0: 2266 696c 6522 3a0a 2020 2020 2020 2020  "file":.        
+000148e0: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+000148f0: 203d 2065 762e 6461 7461 5472 616e 7366   = ev.dataTransf
+00014900: 6572 2e69 7465 6d73 5b69 5d2e 6765 7441  er.items[i].getA
+00014910: 7346 696c 6528 290a 2020 2020 2020 2020  sFile().        
+00014920: 2020 2020 2020 2020 2020 2020 6578 7420              ext 
+00014930: 3d20 6669 6c65 2e6e 616d 652e 6c6f 7765  = file.name.lowe
+00014940: 7228 292e 7370 6c69 7428 222e 2229 5b2d  r().split(".")[-
+00014950: 315d 0a20 2020 2020 2020 2020 2020 2020  1].             
+00014960: 2020 2020 2020 2069 6620 6578 7420 696e         if ext in
+00014970: 2028 2278 6c73 222c 2022 786c 7378 222c   ("xls", "xlsx",
+00014980: 2022 786c 736d 222c 2022 7064 6622 293a   "xlsm", "pdf"):
+00014990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000149a0: 2020 2020 2020 2020 2073 656c 662e 5f61           self._a
+000149b0: 6e61 6c79 7369 735f 6f75 742e 696e 6e65  nalysis_out.inne
+000149c0: 7248 544d 4c20 3d20 280a 2020 2020 2020  rHTML = (.      
+000149d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000149e0: 2020 2020 2020 6622 4361 6e6e 6f74 2070        f"Cannot p
+000149f0: 726f 6365 7373 203c 753e 7b66 696c 652e  rocess <u>{file.
+00014a00: 6e61 6d65 7d3c 2f75 3e2e 2044 726f 7020  name}</u>. Drop 
+00014a10: 6120 2e63 7376 2066 696c 6520 6f72 2022  a .csv file or "
+00014a20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014a30: 2020 2020 2020 2020 2020 2020 202b 2066               + f
+00014a40: 2263 6f70 7920 7468 6520 636f 6c75 6d6e  "copy the column
+00014a50: 7320 696e 2045 7863 656c 2061 6e64 2070  s in Excel and p
+00014a60: 6173 7465 2068 6572 652e 220a 2020 2020  aste here.".    
+00014a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014a80: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00014a90: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00014aa0: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
+00014ab0: 2020 2020 2020 2020 2020 2072 6561 6465             reade
+00014ac0: 7220 3d20 7769 6e64 6f77 2e46 696c 6552  r = window.FileR
+00014ad0: 6561 6465 7228 290a 2020 2020 2020 2020  eader().        
+00014ae0: 2020 2020 2020 2020 2020 2020 7265 6164              read
+00014af0: 6572 2e6f 6e6c 6f61 6420 3d20 6c61 6d62  er.onload = lamb
+00014b00: 6461 3a20 6170 706c 795f 7465 7874 2872  da: apply_text(r
+00014b10: 6561 6465 722e 7265 7375 6c74 290a 2020  eader.result).  
+00014b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014b30: 2020 7265 6164 6572 2e72 6561 6441 7354    reader.readAsT
+00014b40: 6578 7428 6669 6c65 290a 2020 2020 2020  ext(file).      
+00014b50: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00014b60: 6c66 2e5f 616e 616c 7973 6973 5f6f 7574  lf._analysis_out
+00014b70: 2e69 6e6e 6572 4854 4d4c 203d 2066 2252  .innerHTML = f"R
+00014b80: 6561 6420 6672 6f6d 203c 753e 7b66 696c  ead from <u>{fil
+00014b90: 652e 6e61 6d65 7d3c 2f75 3e22 0a20 2020  e.name}</u>".   
+00014ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014bb0: 2062 7265 616b 2020 2320 6f6e 6c79 2070   break  # only p
+00014bc0: 726f 6365 7373 2066 6972 7374 206f 6e65  rocess first one
+00014bd0: 0a0a 2020 2020 6465 6620 5f6f 6e5f 6564  ..    def _on_ed
+00014be0: 6974 2873 656c 6629 3a0a 2020 2020 2020  it(self):.      
+00014bf0: 2020 2320 5468 6973 206c 656e 6774 6820    # This length 
+00014c00: 6573 7469 6d61 7465 2069 7320 6f6e 6c79  estimate is only
+00014c10: 2063 6f72 7265 6374 2069 6620 7468 6520   correct if the 
+00014c20: 7461 6773 2061 7265 2066 6f72 6d61 7474  tags are formatt
+00014c30: 6564 0a20 2020 2020 2020 2023 2063 6f72  ed.        # cor
+00014c40: 7265 6374 6c79 2c20 692e 652e 206e 6f20  rectly, i.e. no 
+00014c50: 7768 6974 6573 7061 6365 206f 7220 6e6f  whitespace or no
+00014c60: 6e2d 7461 6720 776f 7264 732e 2054 6865  n-tag words. The
+00014c70: 2061 6374 7561 6c0a 2020 2020 2020 2020   actual.        
+00014c80: 2320 6c65 6e67 7468 2063 616e 206f 6e6c  # length can onl
+00014c90: 7920 7265 616c 6c79 2062 6520 6f62 7461  y really be obta
+00014ca0: 696e 6564 2062 7920 636f 6c6c 6563 7469  ined by collecti
+00014cb0: 6e67 2061 6c6c 2074 6167 730a 2020 2020  ng all tags.    
+00014cc0: 2020 2020 2320 6672 6f6d 2074 6865 2074      # from the t
+00014cd0: 6578 7420 616e 6420 7374 7269 6e67 6966  ext and stringif
+00014ce0: 7969 6e67 2069 7420 7769 7468 206a 736f  ying it with jso
+00014cf0: 6e2c 2062 7574 2074 6861 7420 776f 756c  n, but that woul
+00014d00: 640a 2020 2020 2020 2020 2320 6265 2074  d.        # be t
+00014d10: 6f6f 2073 6c6f 7720 746f 2064 6f20 6f6e  oo slow to do on
+00014d20: 2065 6163 6820 6b65 7920 7072 6573 7320   each key press 
+00014d30: 2874 6865 7265 2063 616e 2062 6520 4d41  (there can be MA
+00014d40: 4e59 206c 696e 6573 292e 0a20 2020 2020  NY lines)..     
+00014d50: 2020 2023 2057 6520 7461 6b65 2074 6865     # We take the
+00014d60: 206e 6f72 6d61 6c20 6c65 6e67 7468 2c20   normal length, 
+00014d70: 706c 7573 2032 2070 6572 206c 696e 6520  plus 2 per line 
+00014d80: 666f 7220 7175 6f74 6573 2c20 616e 6420  for quotes, and 
+00014d90: 3420 666f 7220 6272 6163 6573 2e0a 2020  4 for braces..  
+00014da0: 2020 2020 2020 6c65 6e67 7468 5f65 7374        length_est
+00014db0: 203d 2073 656c 662e 5f69 6e70 7574 5f65   = self._input_e
+00014dc0: 6c65 6d65 6e74 2e76 616c 7565 2e6c 656e  lement.value.len
+00014dd0: 6774 680a 2020 2020 2020 2020 6c65 6e67  gth.        leng
+00014de0: 7468 5f65 7374 202b 3d20 7365 6c66 2e5f  th_est += self._
+00014df0: 696e 7075 745f 656c 656d 656e 742e 7661  input_element.va
+00014e00: 6c75 652e 636f 756e 7428 225c 6e22 2920  lue.count("\n") 
+00014e10: 2a20 3220 2b20 340a 2020 2020 2020 2020  * 2 + 4.        
+00014e20: 6966 206c 656e 6774 685f 6573 7420 3e3d  if length_est >=
+00014e30: 2073 746f 7265 732e 4a53 4f4e 5f4d 4158   stores.JSON_MAX
+00014e40: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00014e50: 6c66 2e5f 696e 7075 745f 656c 656d 656e  lf._input_elemen
+00014e60: 742e 7374 796c 652e 7365 7450 726f 7065  t.style.setPrope
+00014e70: 7274 7928 226f 7574 6c69 6e65 222c 2022  rty("outline", "
+00014e80: 6461 7368 6564 2032 7078 2072 6564 2229  dashed 2px red")
+00014e90: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00014ea0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00014eb0: 5f69 6e70 7574 5f65 6c65 6d65 6e74 2e73  _input_element.s
+00014ec0: 7479 6c65 2e73 6574 5072 6f70 6572 7479  tyle.setProperty
+00014ed0: 2822 6f75 746c 696e 6522 2c20 2222 290a  ("outline", "").
+00014ee0: 0a20 2020 2064 6566 205f 6c6f 6164 5f63  .    def _load_c
+00014ef0: 7572 7265 6e74 2873 656c 6629 3a0a 2020  urrent(self):.  
+00014f00: 2020 2020 2020 6974 656d 203d 2077 696e        item = win
+00014f10: 646f 772e 7374 6f72 652e 7365 7474 696e  dow.store.settin
+00014f20: 6773 2e67 6574 5f62 795f 6b65 7928 2274  gs.get_by_key("t
+00014f30: 6167 5f70 7265 7365 7473 2229 0a20 2020  ag_presets").   
+00014f40: 2020 2020 206c 696e 6573 203d 2028 4e6f       lines = (No
+00014f50: 6e65 2069 6620 6974 656d 2069 7320 4e6f  ne if item is No
+00014f60: 6e65 2065 6c73 6520 6974 656d 2e76 616c  ne else item.val
+00014f70: 7565 2920 6f72 205b 5d0a 2020 2020 2020  ue) or [].      
+00014f80: 2020 7465 7874 203d 2022 5c6e 222e 6a6f    text = "\n".jo
+00014f90: 696e 286c 696e 6573 290a 2020 2020 2020  in(lines).      
+00014fa0: 2020 6966 2074 6578 743a 0a20 2020 2020    if text:.     
+00014fb0: 2020 2020 2020 2074 6578 7420 2b3d 2022         text += "
+00014fc0: 5c6e 220a 2020 2020 2020 2020 7365 6c66  \n".        self
+00014fd0: 2e5f 696e 7075 745f 656c 656d 656e 742e  ._input_element.
+00014fe0: 7661 6c75 6520 3d20 7465 7874 0a0a 2020  value = text..  
+00014ff0: 2020 6465 6620 646f 5f61 7070 6c79 2873    def do_apply(s
+00015000: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+00015010: 224e 6f72 6d61 6c69 7a65 2074 6167 7322  "Normalize tags"
+00015020: 2222 0a20 2020 2020 2020 2023 2050 726f  "".        # Pro
+00015030: 6365 7373 0a20 2020 2020 2020 2073 656c  cess.        sel
+00015040: 662e 5f61 6e61 6c79 7369 735f 6f75 742e  f._analysis_out.
+00015050: 696e 6e65 7248 544d 4c20 3d20 2250 726f  innerHTML = "Pro
+00015060: 6365 7373 696e 6720 2e2e 2e22 0a20 2020  cessing ...".   
+00015070: 2020 2020 206c 696e 6573 3120 3d20 7365       lines1 = se
+00015080: 6c66 2e5f 696e 7075 745f 656c 656d 656e  lf._input_elemen
+00015090: 742e 7661 6c75 652e 6c73 7472 6970 2829  t.value.lstrip()
+000150a0: 2e73 706c 6974 6c69 6e65 7328 290a 2020  .splitlines().  
+000150b0: 2020 2020 2020 6c69 6e65 7332 203d 205b        lines2 = [
+000150c0: 5d0a 2020 2020 2020 2020 666f 756e 645f  ].        found_
+000150d0: 7461 6773 203d 207b 7d0a 2020 2020 2020  tags = {}.      
+000150e0: 2020 666f 7220 6c69 6e65 2069 6e20 6c69    for line in li
+000150f0: 6e65 7331 3a0a 2020 2020 2020 2020 2020  nes1:.          
+00015100: 2020 6c69 6e65 203d 206c 696e 652e 7374    line = line.st
+00015110: 7269 7028 290a 2020 2020 2020 2020 2020  rip().          
+00015120: 2020 6966 206c 696e 653a 0a20 2020 2020    if line:.     
+00015130: 2020 2020 2020 2020 2020 2074 6167 732c             tags,
+00015140: 205f 203d 2075 7469 6c73 2e67 6574 5f74   _ = utils.get_t
+00015150: 6167 735f 616e 645f 7061 7274 735f 6672  ags_and_parts_fr
+00015160: 6f6d 5f73 7472 696e 6728 746f 5f73 7472  om_string(to_str
+00015170: 286c 696e 6529 2c20 4661 6c73 6529 0a20  (line), False). 
+00015180: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00015190: 6f72 2074 6167 2069 6e20 7461 6773 3a0a  or tag in tags:.
+000151a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000151b0: 2020 2020 666f 756e 645f 7461 6773 5b74      found_tags[t
+000151c0: 6167 5d20 3d20 7461 670a 2020 2020 2020  ag] = tag.      
+000151d0: 2020 2020 2020 2020 2020 6c69 6e65 203d            line =
+000151e0: 2074 6167 732e 6a6f 696e 2822 2022 290a   tags.join(" ").
+000151f0: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
+00015200: 7332 2e61 7070 656e 6428 6c69 6e65 290a  s2.append(line).
+00015210: 0a20 2020 2020 2020 2023 2043 6865 636b  .        # Check
+00015220: 2073 697a 650a 2020 2020 2020 2020 6c65   size.        le
+00015230: 6e67 7468 203d 204a 534f 4e2e 7374 7269  ngth = JSON.stri
+00015240: 6e67 6966 7928 6c69 6e65 7332 292e 6c65  ngify(lines2).le
+00015250: 6e67 7468 0a20 2020 2020 2020 2069 6620  ngth.        if 
+00015260: 6c65 6e67 7468 203e 3d20 7374 6f72 6573  length >= stores
+00015270: 2e4a 534f 4e5f 4d41 583a 0a20 2020 2020  .JSON_MAX:.     
+00015280: 2020 2020 2020 2073 656c 662e 5f69 6e70         self._inp
+00015290: 7574 5f65 6c65 6d65 6e74 2e73 7479 6c65  ut_element.style
+000152a0: 2e73 6574 5072 6f70 6572 7479 2822 6f75  .setProperty("ou
+000152b0: 746c 696e 6522 2c20 2264 6173 6865 6420  tline", "dashed 
+000152c0: 3270 7820 7265 6422 290a 2020 2020 2020  2px red").      
+000152d0: 2020 2020 2020 7365 6c66 2e5f 616e 616c        self._anal
+000152e0: 7973 6973 5f6f 7574 2e69 6e6e 6572 4854  ysis_out.innerHT
+000152f0: 4d4c 203d 2028 0a20 2020 2020 2020 2020  ML = (.         
+00015300: 2020 2020 2020 2066 2253 6f72 7279 2c20         f"Sorry, 
+00015310: 7573 6564 207b 6c65 6e67 7468 7d20 6f66  used {length} of
+00015320: 206d 6178 207b 7374 6f72 6573 2e4a 534f   max {stores.JSO
+00015330: 4e5f 4d41 582d 317d 2063 6861 7273 2e22  N_MAX-1} chars."
+00015340: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00015350: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00015360: 6e0a 0a20 2020 2020 2020 2023 2053 6176  n..        # Sav
+00015370: 650a 2020 2020 2020 2020 6974 656d 203d  e.        item =
+00015380: 2077 696e 646f 772e 7374 6f72 652e 7365   window.store.se
+00015390: 7474 696e 6773 2e63 7265 6174 6528 2274  ttings.create("t
+000153a0: 6167 5f70 7265 7365 7473 222c 206c 696e  ag_presets", lin
+000153b0: 6573 3229 0a20 2020 2020 2020 2077 696e  es2).        win
+000153c0: 646f 772e 7374 6f72 652e 7365 7474 696e  dow.store.settin
+000153d0: 6773 2e70 7574 2869 7465 6d29 0a0a 2020  gs.put(item)..  
+000153e0: 2020 2020 2020 2320 5265 706f 7274 0a20        # Report. 
+000153f0: 2020 2020 2020 2073 656c 662e 5f6c 6f61         self._loa
+00015400: 645f 6375 7272 656e 7428 290a 2020 2020  d_current().    
+00015410: 2020 2020 6e74 6167 7320 3d20 6c65 6e28      ntags = len(
+00015420: 666f 756e 645f 7461 6773 2e6b 6579 7328  found_tags.keys(
+00015430: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
+00015440: 5f61 6e61 6c79 7369 735f 6f75 742e 696e  _analysis_out.in
+00015450: 6e65 7248 544d 4c20 3d20 280a 2020 2020  nerHTML = (.    
+00015460: 2020 2020 2020 2020 223c 6920 636c 6173          "<i clas
+00015470: 733d 2766 6173 273e 5c75 6630 3063 3c2f  s='fas'>\uf00c</
+00015480: 693e 2053 6176 6564 2022 0a20 2020 2020  i> Saved ".     
+00015490: 2020 2020 2020 202b 206c 656e 286c 696e         + len(lin
+000154a0: 6573 3229 0a20 2020 2020 2020 2020 2020  es2).           
+000154b0: 202b 2022 2070 7265 7365 7473 2c20 7769   + " presets, wi
+000154c0: 7468 2022 0a20 2020 2020 2020 2020 2020  th ".           
+000154d0: 202b 206e 7461 6773 0a20 2020 2020 2020   + ntags.       
+000154e0: 2020 2020 202b 2022 2075 6e69 7175 6520       + " unique 
+000154f0: 7461 6773 2e22 0a20 2020 2020 2020 2029  tags.".        )
+00015500: 0a0a 0a63 6c61 7373 2054 6167 5265 6e61  ...class TagRena
+00015510: 6d65 4469 616c 6f67 2842 6173 6544 6961  meDialog(BaseDia
+00015520: 6c6f 6729 3a0a 2020 2020 2222 2244 6961  log):.    """Dia
+00015530: 6c6f 6720 746f 2072 656e 616d 6520 7461  log to rename ta
+00015540: 6773 2e22 2222 0a0a 2020 2020 6465 6620  gs."""..    def 
+00015550: 6f70 656e 2873 656c 662c 2074 6167 732c  open(self, tags,
+00015560: 2063 616c 6c62 6163 6b3d 4e6f 6e65 293a   callback=None):
+00015570: 0a20 2020 2020 2020 2023 2050 7574 2069  .        # Put i
+00015580: 6e20 6465 7465 726d 696e 6973 7469 6320  n deterministic 
+00015590: 6f72 6465 720a 2020 2020 2020 2020 6966  order.        if
+000155a0: 2069 7369 6e73 7461 6e63 6528 7461 6773   isinstance(tags
+000155b0: 2c20 7374 7229 3a0a 2020 2020 2020 2020  , str):.        
+000155c0: 2020 2020 7461 6773 203d 2074 6167 732e      tags = tags.
+000155d0: 7370 6c69 7428 2220 2229 0a20 2020 2020  split(" ").     
+000155e0: 2020 2074 6167 732e 736f 7274 2829 0a20     tags.sort(). 
+000155f0: 2020 2020 2020 2073 656c 662e 5f74 6167         self._tag
+00015600: 7a20 3d20 7461 677a 203d 2074 6167 732e  z = tagz = tags.
+00015610: 6a6f 696e 2822 2022 290a 0a20 2020 2020  join(" ")..     
+00015620: 2020 2073 656c 662e 5f74 6167 7331 203d     self._tags1 =
+00015630: 2074 6167 730a 2020 2020 2020 2020 7365   tags.        se
+00015640: 6c66 2e5f 7461 6773 3220 3d20 5b5d 0a0a  lf._tags2 = []..
+00015650: 2020 2020 2020 2020 6966 206c 656e 2874          if len(t
+00015660: 6167 7329 203d 3d20 313a 0a20 2020 2020  ags) == 1:.     
+00015670: 2020 2020 2020 2074 6974 6c65 203d 2022         title = "
+00015680: 4375 7272 656e 7420 7461 6720 6e61 6d65  Current tag name
+00015690: 220a 2020 2020 2020 2020 2020 2020 7461  ".            ta
+000156a0: 6777 6f72 6420 3d20 2274 6167 220a 2020  gword = "tag".  
+000156b0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000156c0: 2020 2020 2020 2020 7469 746c 6520 3d20          title = 
+000156d0: 2254 6167 2063 6f6d 6269 2074 6f20 7265  "Tag combi to re
+000156e0: 6e61 6d65 220a 2020 2020 2020 2020 2020  name".          
+000156f0: 2020 7461 6777 6f72 6420 3d20 2274 6167    tagword = "tag
+00015700: 7322 0a0a 2020 2020 2020 2020 7365 6c66  s"..        self
+00015710: 2e6d 6169 6e64 6976 2e69 6e6e 6572 4854  .maindiv.innerHT
+00015720: 4d4c 203d 2066 2222 220a 2020 2020 2020  ML = f""".      
+00015730: 2020 2020 2020 3c68 313e 3c69 2063 6c61        <h1><i cla
+00015740: 7373 3d27 6661 7327 3e5c 7566 3032 623c  ss='fas'>\uf02b<
+00015750: 2f69 3e26 6e62 7370 3b26 6e62 7370 3b52  /i>&nbsp;&nbsp;R
+00015760: 656e 616d 6520 7b74 6167 776f 7264 7d0a  ename {tagword}.
+00015770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015780: 3c62 7574 746f 6e20 7479 7065 3d27 6275  <button type='bu
+00015790: 7474 6f6e 273e 3c69 2063 6c61 7373 3d27  tton'><i class='
+000157a0: 6661 7327 3e5c 7566 3030 643c 2f69 3e3c  fas'>\uf00d</i><
+000157b0: 2f62 7574 746f 6e3e 0a20 2020 2020 2020  /button>.       
+000157c0: 2020 2020 2020 2020 203c 2f68 313e 0a20           </h1>. 
+000157d0: 2020 2020 2020 2020 2020 203c 6469 7620             <div 
+000157e0: 636c 6173 733d 2766 6f72 6d6c 6179 6f75  class='formlayou
+000157f0: 7427 3e0a 2020 2020 2020 2020 2020 2020  t'>.            
+00015800: 2020 2020 3c64 6976 3e7b 7469 746c 657d      <div>{title}
+00015810: 3a3c 2f64 6976 3e0a 2020 2020 2020 2020  :</div>.        
+00015820: 2020 2020 2020 2020 3c64 6976 3e7b 7461          <div>{ta
+00015830: 677a 7d3c 2f64 6976 3e0a 2020 2020 2020  gz}</div>.      
+00015840: 2020 2020 2020 2020 2020 3c64 6976 3e4e            <div>N
+00015850: 6577 2074 6167 2873 293a 3c2f 6469 763e  ew tag(s):</div>
+00015860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015870: 203c 696e 7075 7420 7479 7065 3d27 7465   <input type='te
+00015880: 7874 2720 7370 656c 6c63 6865 636b 3d27  xt' spellcheck='
+00015890: 6661 6c73 6527 202f 3e0a 2020 2020 2020  false' />.      
+000158a0: 2020 2020 2020 2020 2020 3c64 6976 3e3c            <div><
+000158b0: 2f64 6976 3e0a 2020 2020 2020 2020 2020  /div>.          
+000158c0: 2020 2020 2020 3c62 7574 746f 6e20 7479        <button ty
+000158d0: 7065 3d27 6275 7474 6f6e 273e 5072 6570  pe='button'>Prep
+000158e0: 6172 6520 7265 6e61 6d69 6e67 202e 2e2e  are renaming ...
+000158f0: 3c2f 6275 7474 6f6e 3e0a 2020 2020 2020  </button>.      
+00015900: 2020 2020 2020 2020 2020 3c64 6976 3e3c            <div><
+00015910: 2f64 6976 3e0a 2020 2020 2020 2020 2020  /div>.          
+00015920: 2020 2020 2020 3c62 7574 746f 6e20 7479        <button ty
+00015930: 7065 3d27 6275 7474 6f6e 273e 436f 6e66  pe='button'>Conf
+00015940: 6972 6d3c 2f62 7574 746f 6e3e 0a20 2020  irm</button>.   
+00015950: 2020 2020 2020 2020 203c 2f64 6976 3e0a           </div>.
+00015960: 2020 2020 2020 2020 2020 2020 3c64 6976              <div
+00015970: 2073 7479 6c65 3d27 6d61 7267 696e 2d74   style='margin-t
+00015980: 6f70 3a32 656d 3b27 3e3c 2f64 6976 3e0a  op:2em;'></div>.
+00015990: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+000159a0: 2020 2020 2063 6c6f 7365 5f62 7574 203d       close_but =
+000159b0: 2073 656c 662e 6d61 696e 6469 762e 6368   self.maindiv.ch
+000159c0: 696c 6472 656e 5b30 5d2e 6368 696c 6472  ildren[0].childr
+000159d0: 656e 5b2d 315d 0a20 2020 2020 2020 2063  en[-1].        c
+000159e0: 6c6f 7365 5f62 7574 2e6f 6e63 6c69 636b  lose_but.onclick
+000159f0: 203d 2073 656c 662e 636c 6f73 650a 0a20   = self.close.. 
+00015a00: 2020 2020 2020 2066 6f72 6d64 6976 203d         formdiv =
+00015a10: 2073 656c 662e 6d61 696e 6469 762e 6368   self.maindiv.ch
+00015a20: 696c 6472 656e 5b31 5d0a 2020 2020 2020  ildren[1].      
+00015a30: 2020 7365 6c66 2e5f 7461 676e 616d 6532    self._tagname2
+00015a40: 203d 2066 6f72 6d64 6976 2e63 6869 6c64   = formdiv.child
+00015a50: 7265 6e5b 335d 0a20 2020 2020 2020 2073  ren[3].        s
+00015a60: 656c 662e 5f62 7574 746f 6e5f 7265 706c  elf._button_repl
+00015a70: 6163 6520 3d20 666f 726d 6469 762e 6368  ace = formdiv.ch
+00015a80: 696c 6472 656e 5b35 5d0a 2020 2020 2020  ildren[5].      
+00015a90: 2020 7365 6c66 2e5f 6275 7474 6f6e 5f72    self._button_r
+00015aa0: 6570 6c61 6365 5f63 6f6d 6669 726d 203d  eplace_comfirm =
+00015ab0: 2066 6f72 6d64 6976 2e63 6869 6c64 7265   formdiv.childre
+00015ac0: 6e5b 375d 0a0a 2020 2020 2020 2020 7365  n[7]..        se
+00015ad0: 6c66 2e5f 7461 676e 616d 6532 2e6f 6e69  lf._tagname2.oni
+00015ae0: 6e70 7574 203d 2073 656c 662e 5f68 6964  nput = self._hid
+00015af0: 655f 636f 6e66 6972 6d5f 6275 7474 6f6e  e_confirm_button
+00015b00: 0a20 2020 2020 2020 2073 656c 662e 5f74  .        self._t
+00015b10: 6167 6e61 6d65 322e 6f6e 6368 616e 6765  agname2.onchange
+00015b20: 203d 2073 656c 662e 5f6f 6e5f 6e61 6d65   = self._on_name
+00015b30: 325f 646f 6e65 0a20 2020 2020 2020 2073  2_done.        s
+00015b40: 656c 662e 5f74 6167 6e61 6d65 322e 6f6e  elf._tagname2.on
+00015b50: 6b65 7964 6f77 6e20 3d20 7365 6c66 2e5f  keydown = self._
+00015b60: 6f6e 5f6b 6579 320a 0a20 2020 2020 2020  on_key2..       
+00015b70: 2073 656c 662e 5f62 7574 746f 6e5f 7265   self._button_re
+00015b80: 706c 6163 652e 6f6e 636c 6963 6b20 3d20  place.onclick = 
+00015b90: 7365 6c66 2e5f 7265 706c 6163 655f 616c  self._replace_al
+00015ba0: 6c0a 2020 2020 2020 2020 7365 6c66 2e5f  l.        self._
+00015bb0: 6275 7474 6f6e 5f72 6570 6c61 6365 5f63  button_replace_c
+00015bc0: 6f6d 6669 726d 2e6f 6e63 6c69 636b 203d  omfirm.onclick =
+00015bd0: 2073 656c 662e 5f72 6561 6c6c 795f 7265   self._really_re
+00015be0: 706c 6163 655f 616c 6c0a 0a20 2020 2020  place_all..     
+00015bf0: 2020 2073 656c 662e 5f62 7574 746f 6e5f     self._button_
+00015c00: 7265 706c 6163 655f 636f 6d66 6972 6d2e  replace_comfirm.
+00015c10: 6469 7361 626c 6564 203d 2054 7275 650a  disabled = True.
+00015c20: 2020 2020 2020 2020 7365 6c66 2e5f 6275          self._bu
+00015c30: 7474 6f6e 5f72 6570 6c61 6365 5f63 6f6d  tton_replace_com
+00015c40: 6669 726d 2e73 7479 6c65 2e76 6973 6962  firm.style.visib
+00015c50: 696c 6974 7920 3d20 2268 6964 6465 6e22  ility = "hidden"
+00015c60: 0a0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
+00015c70: 7265 636f 7264 7320 3d20 5b5d 0a0a 2020  records = []..  
+00015c80: 2020 2020 2020 7375 7065 7228 292e 6f70        super().op
+00015c90: 656e 2863 616c 6c62 6163 6b29 0a20 2020  en(callback).   
+00015ca0: 2020 2020 2069 6620 7574 696c 732e 6c6f       if utils.lo
+00015cb0: 6f6b 735f 6c69 6b65 5f64 6573 6b74 6f70  oks_like_desktop
+00015cc0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00015cd0: 7365 6c66 2e5f 7461 676e 616d 6532 2e66  self._tagname2.f
+00015ce0: 6f63 7573 2829 0a0a 2020 2020 6465 6620  ocus()..    def 
+00015cf0: 636c 6f73 6528 7365 6c66 293a 0a20 2020  close(self):.   
+00015d00: 2020 2020 2073 656c 662e 5f72 6563 6f72       self._recor
+00015d10: 6473 203d 205b 5d0a 2020 2020 2020 2020  ds = [].        
+00015d20: 7375 7065 7228 292e 636c 6f73 6528 290a  super().close().
+00015d30: 0a20 2020 2064 6566 205f 6869 6465 5f63  .    def _hide_c
+00015d40: 6f6e 6669 726d 5f62 7574 746f 6e28 7365  onfirm_button(se
+00015d50: 6c66 293a 0a20 2020 2020 2020 2073 656c  lf):.        sel
+00015d60: 662e 5f62 7574 746f 6e5f 7265 706c 6163  f._button_replac
+00015d70: 655f 636f 6d66 6972 6d2e 6469 7361 626c  e_comfirm.disabl
+00015d80: 6564 203d 2054 7275 650a 2020 2020 2020  ed = True.      
+00015d90: 2020 7365 6c66 2e5f 6275 7474 6f6e 5f72    self._button_r
+00015da0: 6570 6c61 6365 5f63 6f6d 6669 726d 2e73  eplace_comfirm.s
+00015db0: 7479 6c65 2e76 6973 6962 696c 6974 7920  tyle.visibility 
+00015dc0: 3d20 2268 6964 6465 6e22 0a20 2020 2020  = "hidden".     
+00015dd0: 2020 2073 656c 662e 5f62 7574 746f 6e5f     self._button_
+00015de0: 7265 706c 6163 655f 636f 6d66 6972 6d2e  replace_comfirm.
+00015df0: 696e 6e65 7254 6578 7420 3d20 2243 6f6e  innerText = "Con
+00015e00: 6669 726d 220a 0a20 2020 2064 6566 205f  firm"..    def _
+00015e10: 6f6e 5f6e 616d 6532 5f64 6f6e 6528 7365  on_name2_done(se
+00015e20: 6c66 293a 0a20 2020 2020 2020 2072 6177  lf):.        raw
+00015e30: 5f70 6172 7473 203d 2073 656c 662e 5f74  _parts = self._t
+00015e40: 6167 6e61 6d65 322e 7661 6c75 652e 7370  agname2.value.sp
+00015e50: 6c69 7428 2220 2229 0a20 2020 2020 2020  lit(" ").       
+00015e60: 2074 6578 7432 203d 205b 2223 2220 2b20   text2 = ["#" + 
+00015e70: 7020 666f 7220 7020 696e 2072 6177 5f70  p for p in raw_p
+00015e80: 6172 7473 5d2e 6a6f 696e 2822 2022 290a  arts].join(" ").
+00015e90: 2020 2020 2020 2020 7461 6773 322c 205f          tags2, _
+00015ea0: 203d 2075 7469 6c73 2e67 6574 5f74 6167   = utils.get_tag
+00015eb0: 735f 616e 645f 7061 7274 735f 6672 6f6d  s_and_parts_from
+00015ec0: 5f73 7472 696e 6728 7465 7874 3229 0a20  _string(text2). 
+00015ed0: 2020 2020 2020 2073 656c 662e 5f74 6167         self._tag
+00015ee0: 7332 203d 2074 6167 7332 0a20 2020 2020  s2 = tags2.     
+00015ef0: 2020 2073 656c 662e 5f74 6167 6e61 6d65     self._tagname
+00015f00: 322e 7661 6c75 6520 3d20 2220 222e 6a6f  2.value = " ".jo
+00015f10: 696e 2874 6167 7332 290a 0a20 2020 2064  in(tags2)..    d
+00015f20: 6566 205f 6f6e 5f6b 6579 3228 7365 6c66  ef _on_key2(self
+00015f30: 2c20 6529 3a0a 2020 2020 2020 2020 6b65  , e):.        ke
+00015f40: 7920 3d20 652e 6b65 792e 6c6f 7765 7228  y = e.key.lower(
+00015f50: 290a 2020 2020 2020 2020 6966 206b 6579  ).        if key
+00015f60: 203d 3d20 2265 6e74 6572 2220 6f72 206b   == "enter" or k
+00015f70: 6579 203d 3d20 2272 6574 7572 6e22 3a0a  ey == "return":.
+00015f80: 2020 2020 2020 2020 2020 2020 652e 7374              e.st
+00015f90: 6f70 5072 6f70 6167 6174 696f 6e28 290a  opPropagation().
+00015fa0: 2020 2020 2020 2020 2020 2020 652e 7072              e.pr
+00015fb0: 6576 656e 7444 6566 6175 6c74 2829 0a20  eventDefault(). 
+00015fc0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00015fd0: 5f6f 6e5f 6e61 6d65 325f 646f 6e65 2829  _on_name2_done()
+00015fe0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00015ff0: 662e 5f72 6570 6c61 6365 5f61 6c6c 2829  f._replace_all()
+00016000: 0a0a 2020 2020 6465 6620 5f66 696e 645f  ..    def _find_
+00016010: 7265 636f 7264 7328 7365 6c66 293a 0a20  records(self):. 
+00016020: 2020 2020 2020 2072 6563 6f72 6473 203d         records =
+00016030: 205b 5d0a 0a20 2020 2020 2020 2023 2045   []..        # E
+00016040: 6172 6c79 2065 7869 743f 0a20 2020 2020  arly exit?.     
+00016050: 2020 2069 6620 6e6f 7420 7365 6c66 2e5f     if not self._
+00016060: 7461 6773 313a 0a20 2020 2020 2020 2020  tags1:.         
+00016070: 2020 2073 656c 662e 5f72 6563 6f72 6473     self._records
+00016080: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
+00016090: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
+000160a0: 2023 2047 6574 206c 6973 7420 6f66 2072   # Get list of r
+000160b0: 6563 6f72 6473 0a20 2020 2020 2020 2066  ecords.        f
+000160c0: 6f72 2072 6563 6f72 6420 696e 2077 696e  or record in win
+000160d0: 646f 772e 7374 6f72 652e 7265 636f 7264  dow.store.record
+000160e0: 732e 6765 745f 6475 6d70 2829 3a0a 2020  s.get_dump():.  
+000160f0: 2020 2020 2020 2020 2020 7461 6773 203d            tags =
+00016100: 2077 696e 646f 772e 7374 6f72 652e 7265   window.store.re
+00016110: 636f 7264 732e 7461 6773 5f66 726f 6d5f  cords.tags_from_
+00016120: 7265 636f 7264 2872 6563 6f72 6429 2020  record(record)  
+00016130: 2320 616c 736f 2023 756e 7461 6767 6564  # also #untagged
+00016140: 0a20 2020 2020 2020 2020 2020 2061 6c6c  .            all
+00016150: 5f6f 6b20 3d20 5472 7565 0a20 2020 2020  _ok = True.     
+00016160: 2020 2020 2020 2066 6f72 2074 6167 2069         for tag i
+00016170: 6e20 7365 6c66 2e5f 7461 6773 313a 0a20  n self._tags1:. 
+00016180: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00016190: 6620 7461 6720 6e6f 7420 696e 2074 6167  f tag not in tag
+000161a0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+000161b0: 2020 2020 2020 2061 6c6c 5f6f 6b20 3d20         all_ok = 
+000161c0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+000161d0: 2020 6966 2061 6c6c 5f6f 6b3a 0a20 2020    if all_ok:.   
+000161e0: 2020 2020 2020 2020 2020 2020 2072 6563               rec
+000161f0: 6f72 6473 2e70 7573 6828 5b72 6563 6f72  ords.push([recor
+00016200: 642e 7431 2c20 7265 636f 7264 2e6b 6579  d.t1, record.key
+00016210: 5d29 0a0a 2020 2020 2020 2020 7265 636f  ])..        reco
+00016220: 7264 732e 736f 7274 286b 6579 3d6c 616d  rds.sort(key=lam
+00016230: 6264 6120 783a 2078 5b30 5d29 0a20 2020  bda x: x[0]).   
+00016240: 2020 2020 2073 656c 662e 5f72 6563 6f72       self._recor
+00016250: 6473 203d 205b 785b 315d 2066 6f72 2078  ds = [x[1] for x
+00016260: 2069 6e20 7265 636f 7264 735d 0a0a 2020   in records]..  
+00016270: 2020 6465 6620 5f72 6570 6c61 6365 5f61    def _replace_a
+00016280: 6c6c 2873 656c 6629 3a0a 2020 2020 2020  ll(self):.      
+00016290: 2020 7365 6c66 2e5f 6669 6e64 5f72 6563    self._find_rec
+000162a0: 6f72 6473 2829 0a20 2020 2020 2020 2074  ords().        t
+000162b0: 6167 776f 7264 203d 2022 7461 6722 2069  agword = "tag" i
+000162c0: 6620 6c65 6e28 7365 6c66 2e5f 7461 6773  f len(self._tags
+000162d0: 3129 203d 3d20 3120 656c 7365 2022 7461  1) == 1 else "ta
+000162e0: 6773 220a 0a20 2020 2020 2020 206e 203d  gs"..        n =
+000162f0: 206c 656e 2873 656c 662e 5f72 6563 6f72   len(self._recor
+00016300: 6473 290a 2020 2020 2020 2020 6966 206e  ds).        if n
+00016310: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+00016320: 2020 2074 6578 7420 3d20 6622 4e6f 2072     text = f"No r
+00016330: 6563 6f72 6473 2066 6f75 6e64 220a 2020  ecords found".  
+00016340: 2020 2020 2020 2020 2020 6469 7361 626c            disabl
+00016350: 6564 203d 2054 7275 650a 2020 2020 2020  ed = True.      
+00016360: 2020 656c 6966 206c 656e 2873 656c 662e    elif len(self.
+00016370: 5f74 6167 7332 293a 0a20 2020 2020 2020  _tags2):.       
+00016380: 2020 2020 2074 6578 7420 3d20 6622 436f       text = f"Co
+00016390: 6e66 6972 6d20 7265 706c 6163 696e 6720  nfirm replacing 
+000163a0: 7b74 6167 776f 7264 7d20 696e 207b 6e7d  {tagword} in {n}
+000163b0: 2072 6563 6f72 6473 220a 2020 2020 2020   records".      
+000163c0: 2020 2020 2020 6469 7361 626c 6564 203d        disabled =
+000163d0: 2046 616c 7365 0a20 2020 2020 2020 2065   False.        e
+000163e0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000163f0: 2074 6578 7420 3d20 6622 436f 6e66 6972   text = f"Confir
+00016400: 6d20 7265 6d6f 7669 6e67 207b 7461 6777  m removing {tagw
+00016410: 6f72 647d 2069 6e20 7b6e 7d20 7265 636f  ord} in {n} reco
+00016420: 7264 7322 0a20 2020 2020 2020 2020 2020  rds".           
+00016430: 2064 6973 6162 6c65 6420 3d20 4661 6c73   disabled = Fals
+00016440: 650a 0a20 2020 2020 2020 2073 656c 662e  e..        self.
+00016450: 5f62 7574 746f 6e5f 7265 706c 6163 655f  _button_replace_
+00016460: 636f 6d66 6972 6d2e 696e 6e65 7254 6578  comfirm.innerTex
+00016470: 7420 3d20 7465 7874 0a20 2020 2020 2020  t = text.       
+00016480: 2073 656c 662e 5f62 7574 746f 6e5f 7265   self._button_re
+00016490: 706c 6163 655f 636f 6d66 6972 6d2e 6469  place_comfirm.di
+000164a0: 7361 626c 6564 203d 2064 6973 6162 6c65  sabled = disable
+000164b0: 640a 2020 2020 2020 2020 7365 6c66 2e5f  d.        self._
+000164c0: 6275 7474 6f6e 5f72 6570 6c61 6365 5f63  button_replace_c
+000164d0: 6f6d 6669 726d 2e73 7479 6c65 2e76 6973  omfirm.style.vis
+000164e0: 6962 696c 6974 7920 3d20 2276 6973 6962  ibility = "visib
+000164f0: 6c65 220a 0a20 2020 2064 6566 205f 7265  le"..    def _re
+00016500: 616c 6c79 5f72 6570 6c61 6365 5f61 6c6c  ally_replace_all
+00016510: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00016520: 7365 6172 6368 5f74 6167 7320 3d20 7365  search_tags = se
+00016530: 6c66 2e5f 7461 6773 310a 2020 2020 2020  lf._tags1.      
+00016540: 2020 7265 706c 6163 656d 656e 745f 7461    replacement_ta
+00016550: 6773 203d 2073 656c 662e 5f74 6167 7332  gs = self._tags2
+00016560: 0a0a 2020 2020 2020 2020 666f 7220 6b65  ..        for ke
+00016570: 7920 696e 2073 656c 662e 5f72 6563 6f72  y in self._recor
+00016580: 6473 3a0a 2020 2020 2020 2020 2020 2020  ds:.            
+00016590: 7265 636f 7264 203d 2077 696e 646f 772e  record = window.
+000165a0: 7374 6f72 652e 7265 636f 7264 732e 6765  store.records.ge
+000165b0: 745f 6279 5f6b 6579 286b 6579 290a 2020  t_by_key(key).  
+000165c0: 2020 2020 2020 2020 2020 5f2c 2070 6172            _, par
+000165d0: 7473 203d 2075 7469 6c73 2e67 6574 5f74  ts = utils.get_t
+000165e0: 6167 735f 616e 645f 7061 7274 735f 6672  ags_and_parts_fr
+000165f0: 6f6d 5f73 7472 696e 6728 7265 636f 7264  om_string(record
+00016600: 2e64 7329 0a20 2020 2020 2020 2020 2020  .ds).           
+00016610: 2023 2047 6574 2075 7064 6174 6564 2070   # Get updated p
+00016620: 6172 7473 0a20 2020 2020 2020 2020 2020  arts.           
+00016630: 206e 6577 5f70 6172 7473 203d 205b 5d0a   new_parts = [].
+00016640: 2020 2020 2020 2020 2020 2020 7265 706c              repl
+00016650: 6163 656d 656e 745f 6d61 6465 203d 2046  acement_made = F
+00016660: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+00016670: 2066 6f72 2070 6172 7420 696e 2070 6172   for part in par
+00016680: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+00016690: 2020 2020 6966 2070 6172 742e 7374 6172      if part.star
+000166a0: 7473 7769 7468 2822 2322 2920 616e 6420  tswith("#") and 
+000166b0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000166c0: 2020 2020 2020 7061 7274 2069 6e20 7365        part in se
+000166d0: 6172 6368 5f74 6167 7320 6f72 2070 6172  arch_tags or par
+000166e0: 7420 696e 2072 6570 6c61 6365 6d65 6e74  t in replacement
+000166f0: 5f74 6167 730a 2020 2020 2020 2020 2020  _tags.          
+00016700: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
+00016710: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00016720: 6e6f 7420 7265 706c 6163 656d 656e 745f  not replacement_
+00016730: 6d61 6465 3a0a 2020 2020 2020 2020 2020  made:.          
+00016740: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00016750: 706c 6163 656d 656e 745f 6d61 6465 203d  placement_made =
+00016760: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
+00016770: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+00016780: 775f 7061 7274 732e 7075 7368 2822 2022  w_parts.push(" "
+00016790: 2e6a 6f69 6e28 7265 706c 6163 656d 656e  .join(replacemen
+000167a0: 745f 7461 6773 2929 0a20 2020 2020 2020  t_tags)).       
+000167b0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+000167c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000167d0: 2020 206e 6577 5f70 6172 7473 2e70 7573     new_parts.pus
+000167e0: 6828 7061 7274 290a 2020 2020 2020 2020  h(part).        
+000167f0: 2020 2020 2320 5375 626d 6974 0a20 2020      # Submit.   
+00016800: 2020 2020 2020 2020 2072 6563 6f72 642e           record.
+00016810: 6473 203d 2022 222e 6a6f 696e 286e 6577  ds = "".join(new
+00016820: 5f70 6172 7473 290a 2020 2020 2020 2020  _parts).        
+00016830: 2020 2020 7769 6e64 6f77 2e73 746f 7265      window.store
+00016840: 2e72 6563 6f72 6473 2e70 7574 2872 6563  .records.put(rec
+00016850: 6f72 6429 0a0a 2020 2020 2020 2020 2320  ord)..        # 
+00016860: 416c 736f 2075 7064 6174 6520 7461 6720  Also update tag 
+00016870: 696e 666f 0a20 2020 2020 2020 2069 6620  info.        if 
+00016880: 6c65 6e28 7365 6172 6368 5f74 6167 7329  len(search_tags)
+00016890: 203d 3d20 3120 616e 6420 6c65 6e28 7265   == 1 and len(re
+000168a0: 706c 6163 656d 656e 745f 7461 6773 2920  placement_tags) 
+000168b0: 3d3d 2031 3a0a 2020 2020 2020 2020 2020  == 1:.          
+000168c0: 2020 7461 6731 2c20 7461 6732 203d 2073    tag1, tag2 = s
+000168d0: 6561 7263 685f 7461 6773 5b30 5d2c 2072  earch_tags[0], r
+000168e0: 6570 6c61 6365 6d65 6e74 5f74 6167 735b  eplacement_tags[
+000168f0: 305d 0a20 2020 2020 2020 2020 2020 2069  0].            i
+00016900: 6e66 6f20 3d20 7769 6e64 6f77 2e73 746f  nfo = window.sto
+00016910: 7265 2e73 6574 7469 6e67 732e 6765 745f  re.settings.get_
+00016920: 7461 675f 696e 666f 2874 6167 3129 0a20  tag_info(tag1). 
+00016930: 2020 2020 2020 2020 2020 2077 696e 646f             windo
+00016940: 772e 7374 6f72 652e 7365 7474 696e 6773  w.store.settings
+00016950: 2e73 6574 5f74 6167 5f69 6e66 6f28 7461  .set_tag_info(ta
+00016960: 6731 2c20 7b7d 290a 2020 2020 2020 2020  g1, {}).        
+00016970: 2020 2020 7769 6e64 6f77 2e73 746f 7265      window.store
+00016980: 2e73 6574 7469 6e67 732e 7365 745f 7461  .settings.set_ta
+00016990: 675f 696e 666f 2874 6167 322c 2069 6e66  g_info(tag2, inf
+000169a0: 6f29 0a0a 2020 2020 2020 2020 2320 4665  o)..        # Fe
+000169b0: 6564 6261 636b 0a20 2020 2020 2020 2073  edback.        s
+000169c0: 656c 662e 5f62 7574 746f 6e5f 7265 706c  elf._button_repl
+000169d0: 6163 655f 636f 6d66 6972 6d2e 696e 6e65  ace_comfirm.inne
+000169e0: 7254 6578 7420 3d20 2244 6f6e 6522 0a20  rText = "Done". 
+000169f0: 2020 2020 2020 2073 656c 662e 5f62 7574         self._but
+00016a00: 746f 6e5f 7265 706c 6163 655f 636f 6d66  ton_replace_comf
+00016a10: 6972 6d2e 6469 7361 626c 6564 203d 2054  irm.disabled = T
+00016a20: 7275 650a 2020 2020 2020 2020 7769 6e64  rue.        wind
+00016a30: 6f77 2e73 6574 5469 6d65 6f75 7428 7365  ow.setTimeout(se
+00016a40: 6c66 2e5f 6869 6465 5f63 6f6e 6669 726d  lf._hide_confirm
+00016a50: 5f62 7574 746f 6e2c 2035 3030 290a 0a0a  _button, 500)...
+00016a60: 636c 6173 7320 5365 6172 6368 4469 616c  class SearchDial
+00016a70: 6f67 2842 6173 6544 6961 6c6f 6729 3a0a  og(BaseDialog):.
+00016a80: 2020 2020 2222 2244 6961 6c6f 6720 746f      """Dialog to
+00016a90: 2073 6561 7263 6820 666f 7220 7265 636f   search for reco
+00016aa0: 7264 7320 616e 6420 7461 6773 2e22 2222  rds and tags."""
+00016ab0: 0a0a 2020 2020 6465 6620 6f70 656e 2873  ..    def open(s
+00016ac0: 656c 6629 3a0a 2020 2020 2020 2020 7365  elf):.        se
+00016ad0: 6c66 2e6d 6169 6e64 6976 2e69 6e6e 6572  lf.maindiv.inner
+00016ae0: 4854 4d4c 203d 2022 2222 0a20 2020 2020  HTML = """.     
+00016af0: 2020 2020 2020 203c 6831 3e3c 6920 636c         <h1><i cl
+00016b00: 6173 733d 2766 6173 273e 5c75 6630 3032  ass='fas'>\uf002
+00016b10: 3c2f 693e 266e 6273 703b 266e 6273 703b  </i>&nbsp;&nbsp;
+00016b20: 5365 6172 6368 2072 6563 6f72 6473 2061  Search records a
+00016b30: 6e64 2074 6167 730a 2020 2020 2020 2020  nd tags.        
+00016b40: 2020 2020 2020 2020 3c62 7574 746f 6e20          <button 
+00016b50: 7479 7065 3d27 6275 7474 6f6e 273e 3c69  type='button'><i
+00016b60: 2063 6c61 7373 3d27 6661 7327 3e5c 7566   class='fas'>\uf
+00016b70: 3030 643c 2f69 3e3c 2f62 7574 746f 6e3e  00d</i></button>
+00016b80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016b90: 203c 2f68 313e 0a20 2020 2020 2020 2020   </h1>.         
+00016ba0: 2020 203c 703e 5468 6973 2074 6f6f 6c20     <p>This tool 
+00016bb0: 616c 6c6f 7773 2079 6f75 2074 6f20 7365  allows you to se
+00016bc0: 6172 6368 2072 6563 6f72 6473 2062 7920  arch records by 
+00016bd0: 7461 6773 2061 6e64 2070 6c61 696e 2074  tags and plain t
+00016be0: 6578 742e 0a20 2020 2020 2020 2020 2020  ext..           
+00016bf0: 2050 7265 7065 6e64 2074 6167 732f 776f   Prepend tags/wo
+00016c00: 7264 7320 7769 7468 2022 2122 2074 6f20  rds with "!" to 
+00016c10: 6578 636c 7564 6520 7265 636f 7264 7320  exclude records 
+00016c20: 7468 6174 206d 6174 6368 2069 742e 0a20  that match it.. 
+00016c30: 2020 2020 2020 2020 2020 203c 6272 3e3c             <br><
+00016c40: 6272 3e0a 2020 2020 2020 2020 2020 2020  br>.            
+00016c50: 3c2f 703e 0a20 2020 2020 2020 2020 2020  </p>.           
+00016c60: 203c 6469 7620 636c 6173 733d 2763 6f6e   <div class='con
+00016c70: 7461 696e 6572 2720 7374 796c 653d 2770  tainer' style='p
+00016c80: 6f73 6974 696f 6e3a 2072 656c 6174 6976  osition: relativ
+00016c90: 653b 273e 0a20 2020 2020 2020 2020 2020  e;'>.           
+00016ca0: 2020 2020 203c 696e 7075 7420 7479 7065       <input type
+00016cb0: 3d27 7465 7874 2720 7374 796c 653d 2777  ='text' style='w
+00016cc0: 6964 7468 3a31 3030 253b 2720 7370 656c  idth:100%;' spel
+00016cd0: 6c63 6865 636b 3d27 6661 6c73 6527 202f  lcheck='false' /
+00016ce0: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
+00016cf0: 2020 3c64 6976 2063 6c61 7373 3d27 7461    <div class='ta
+00016d00: 672d 7375 6767 6573 7469 6f6e 732d 6175  g-suggestions-au
+00016d10: 746f 636f 6d70 273e 3c2f 6469 763e 0a20  tocomp'></div>. 
+00016d20: 2020 2020 2020 2020 2020 203c 2f64 6976             </div
+00016d30: 3e0a 2020 2020 2020 2020 2020 2020 3c64  >.            <d
+00016d40: 6976 2073 7479 6c65 3d27 666f 6e74 2d73  iv style='font-s
+00016d50: 697a 653a 2073 6d61 6c6c 6572 3b27 3e3c  ize: smaller;'><
+00016d60: 2f64 6976 3e0a 2020 2020 2020 2020 2020  /div>.          
+00016d70: 2020 3c62 723e 0a20 2020 2020 2020 2020    <br>.         
+00016d80: 2020 203c 6275 7474 6f6e 2074 7970 653d     <button type=
+00016d90: 2762 7574 746f 6e27 3e53 6561 7263 683c  'button'>Search<
+00016da0: 2f62 7574 746f 6e3e 0a20 2020 2020 2020  /button>.       
+00016db0: 2020 2020 203c 6275 7474 6f6e 2074 7970       <button typ
+00016dc0: 653d 2762 7574 746f 6e27 3e4d 616e 6167  e='button'>Manag
+00016dd0: 6520 7461 6773 3c2f 6275 7474 6f6e 3e0a  e tags</button>.
+00016de0: 2020 2020 2020 2020 2020 2020 3c68 7220              <hr 
+00016df0: 2f3e 0a20 2020 2020 2020 2020 2020 203c  />.            <
+00016e00: 6469 7620 636c 6173 733d 2772 6563 6f72  div class='recor
+00016e10: 645f 6772 6964 2720 7374 796c 653d 276d  d_grid' style='m
+00016e20: 696e 2d68 6569 6768 743a 3130 3070 7827  in-height:100px'
+00016e30: 3e3c 2f64 6976 3e0a 2020 2020 2020 2020  ></div>.        
+00016e40: 2222 220a 0a20 2020 2020 2020 2063 6c6f  """..        clo
+00016e50: 7365 5f62 7574 203d 2073 656c 662e 6d61  se_but = self.ma
+00016e60: 696e 6469 762e 6368 696c 6472 656e 5b30  indiv.children[0
+00016e70: 5d2e 6368 696c 6472 656e 5b2d 315d 0a20  ].children[-1]. 
+00016e80: 2020 2020 2020 2063 6c6f 7365 5f62 7574         close_but
+00016e90: 2e6f 6e63 6c69 636b 203d 2073 656c 662e  .onclick = self.
+00016ea0: 636c 6f73 650a 0a20 2020 2020 2020 2073  close..        s
+00016eb0: 656c 662e 5f72 6563 6f72 6473 5f6e 6f64  elf._records_nod
+00016ec0: 6520 3d20 7365 6c66 2e6d 6169 6e64 6976  e = self.maindiv
+00016ed0: 2e63 6869 6c64 7265 6e5b 2d31 5d0a 0a20  .children[-1].. 
+00016ee0: 2020 2020 2020 2028 0a20 2020 2020 2020         (.       
+00016ef0: 2020 2020 205f 2c20 2023 2068 310a 2020       _,  # h1.  
+00016f00: 2020 2020 2020 2020 2020 5f2c 2020 2320            _,  # 
+00016f10: 700a 2020 2020 2020 2020 2020 2020 7365  p.            se
+00016f20: 6172 6368 5f63 6f6e 7461 696e 6572 2c0a  arch_container,.
+00016f30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00016f40: 2e5f 696e 666f 5f64 6976 2c0a 2020 2020  ._info_div,.    
+00016f50: 2020 2020 2020 2020 5f2c 2020 2320 6272          _,  # br
+00016f60: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00016f70: 662e 5f73 6561 7263 685f 6275 742c 0a20  f._search_but,. 
+00016f80: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00016f90: 5f74 6167 6d61 6e61 6765 5f62 7574 2c0a  _tagmanage_but,.
+00016fa0: 2020 2020 2020 2020 2920 3d20 7365 6c66          ) = self
+00016fb0: 2e6d 6169 6e64 6976 2e63 6869 6c64 7265  .maindiv.childre
+00016fc0: 6e0a 0a20 2020 2020 2020 2073 656c 662e  n..        self.
+00016fd0: 5f73 6561 7263 685f 696e 7075 742c 2073  _search_input, s
+00016fe0: 656c 662e 5f61 7574 6f63 6f6d 706c 6574  elf._autocomplet
+00016ff0: 6572 5f64 6976 203d 2073 6561 7263 685f  er_div = search_
+00017000: 636f 6e74 6169 6e65 722e 6368 696c 6472  container.childr
+00017010: 656e 0a20 2020 2020 2020 2073 656c 662e  en.        self.
+00017020: 5f73 6561 7263 685f 696e 7075 742e 706c  _search_input.pl
+00017030: 6163 6568 6f6c 6465 7220 3d20 2254 6167  aceholder = "Tag
+00017040: 7320 6f72 2074 6578 7420 746f 2073 6561  s or text to sea
+00017050: 7263 6820 666f 7220 2e2e 2e22 0a0a 2020  rch for ..."..  
+00017060: 2020 2020 2020 7365 6c66 2e5f 7365 6172        self._sear
+00017070: 6368 5f69 6e70 7574 2e6f 6e69 6e70 7574  ch_input.oninput
+00017080: 203d 2073 656c 662e 5f6f 6e5f 7573 6572   = self._on_user
+00017090: 5f65 6469 740a 2020 2020 2020 2020 7365  _edit.        se
+000170a0: 6c66 2e5f 7365 6172 6368 5f69 6e70 7574  lf._search_input
+000170b0: 2e6f 6e63 6861 6e67 6520 3d20 7365 6c66  .onchange = self
+000170c0: 2e5f 6f6e 5f75 7365 725f 6564 6974 5f64  ._on_user_edit_d
+000170d0: 6f6e 650a 2020 2020 2020 2020 7365 6c66  one.        self
+000170e0: 2e5f 7365 6172 6368 5f69 6e70 7574 2e6f  ._search_input.o
+000170f0: 6e6b 6579 646f 776e 203d 2073 656c 662e  nkeydown = self.
+00017100: 5f6f 6e5f 6b65 790a 0a20 2020 2020 2020  _on_key..       
+00017110: 2073 656c 662e 5f73 6561 7263 685f 6275   self._search_bu
+00017120: 742e 6f6e 636c 6963 6b20 3d20 7365 6c66  t.onclick = self
+00017130: 2e5f 6669 6e64 5f72 6563 6f72 6473 0a20  ._find_records. 
+00017140: 2020 2020 2020 2073 656c 662e 5f74 6167         self._tag
+00017150: 6d61 6e61 6765 5f62 7574 2e6f 6e63 6c69  manage_but.oncli
+00017160: 636b 203d 2073 656c 662e 5f6f 7065 6e5f  ck = self._open_
+00017170: 7461 675f 6469 616c 6f67 0a0a 2020 2020  tag_dialog..    
+00017180: 2020 2020 7365 6c66 2e5f 7365 6172 6368      self._search
+00017190: 5f62 7574 2e64 6973 6162 6c65 6420 3d20  _but.disabled = 
+000171a0: 5472 7565 0a20 2020 2020 2020 2073 656c  True.        sel
+000171b0: 662e 5f74 6167 6d61 6e61 6765 5f62 7574  f._tagmanage_but
+000171c0: 2e64 6973 6162 6c65 6420 3d20 5472 7565  .disabled = True
+000171d0: 0a0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
+000171e0: 6175 746f 636f 6d70 6c65 7465 7220 3d20  autocompleter = 
+000171f0: 4175 746f 636f 6d70 6c65 7465 7228 0a20  Autocompleter(. 
+00017200: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00017210: 5f61 7574 6f63 6f6d 706c 6574 6572 5f64  _autocompleter_d
+00017220: 6976 2c20 7365 6c66 2e5f 7365 6172 6368  iv, self._search
+00017230: 5f69 6e70 7574 2c20 7365 6c66 2e5f 6175  _input, self._au
+00017240: 746f 636f 6d70 5f66 696e 6973 6865 642c  tocomp_finished,
+00017250: 2031 0a20 2020 2020 2020 2029 0a0a 2020   1.        )..  
+00017260: 2020 2020 2020 7769 6e64 6f77 2e5f 7365        window._se
+00017270: 6172 6368 5f64 6961 6c6f 675f 6f70 656e  arch_dialog_open
+00017280: 5f72 6563 6f72 6420 3d20 7365 6c66 2e5f  _record = self._
+00017290: 6f70 656e 5f72 6563 6f72 640a 2020 2020  open_record.    
+000172a0: 2020 2020 7365 6c66 2e5f 7265 636f 7264      self._record
+000172b0: 7320 3d20 5b5d 0a0a 2020 2020 2020 2020  s = []..        
+000172c0: 7365 6c66 2e5f 6375 7272 656e 745f 706f  self._current_po
+000172d0: 735f 7461 6773 203d 205b 5d0a 2020 2020  s_tags = [].    
+000172e0: 2020 2020 7365 6c66 2e5f 6375 7272 656e      self._curren
+000172f0: 745f 6e65 675f 7461 6773 203d 205b 5d0a  t_neg_tags = [].
+00017300: 2020 2020 2020 2020 7365 6c66 2e5f 6375          self._cu
+00017310: 7272 656e 745f 706f 735f 776f 7264 7320  rrent_pos_words 
+00017320: 3d20 5b5d 0a20 2020 2020 2020 2073 656c  = [].        sel
+00017330: 662e 5f63 7572 7265 6e74 5f6e 6567 5f77  f._current_neg_w
+00017340: 6f72 6473 203d 205b 5d0a 0a20 2020 2020  ords = []..     
+00017350: 2020 2073 7570 6572 2829 2e6f 7065 6e28     super().open(
+00017360: 4e6f 6e65 290a 2020 2020 2020 2020 7365  None).        se
+00017370: 6c66 2e5f 6368 6563 6b5f 6e61 6d65 7328  lf._check_names(
+00017380: 290a 2020 2020 2020 2020 6966 2075 7469  ).        if uti
+00017390: 6c73 2e6c 6f6f 6b73 5f6c 696b 655f 6465  ls.looks_like_de
+000173a0: 736b 746f 7028 293a 0a20 2020 2020 2020  sktop():.       
+000173b0: 2020 2020 2073 656c 662e 5f73 6561 7263       self._searc
+000173c0: 685f 696e 7075 742e 666f 6375 7328 290a  h_input.focus().
+000173d0: 0a20 2020 2064 6566 2063 6c6f 7365 2873  .    def close(s
+000173e0: 656c 6629 3a0a 2020 2020 2020 2020 7365  elf):.        se
+000173f0: 6c66 2e5f 6175 746f 636f 6d70 6c65 7465  lf._autocomplete
+00017400: 722e 636c 6f73 6528 290a 2020 2020 2020  r.close().      
+00017410: 2020 7365 6c66 2e5f 7265 636f 7264 7320    self._records 
+00017420: 3d20 5b5d 0a20 2020 2020 2020 2073 7570  = [].        sup
+00017430: 6572 2829 2e63 6c6f 7365 2829 0a0a 2020  er().close()..  
+00017440: 2020 6465 6620 5f61 7574 6f63 6f6d 705f    def _autocomp_
+00017450: 6669 6e69 7368 6564 2873 656c 6629 3a0a  finished(self):.
+00017460: 2020 2020 2020 2020 7365 6c66 2e5f 6368          self._ch
+00017470: 6563 6b5f 6e61 6d65 7328 290a 0a20 2020  eck_names()..   
+00017480: 2064 6566 205f 6f6e 5f75 7365 725f 6564   def _on_user_ed
+00017490: 6974 2873 656c 6629 3a0a 2020 2020 2020  it(self):.      
+000174a0: 2020 7365 6c66 2e5f 6175 746f 636f 6d70    self._autocomp
+000174b0: 6c65 7465 722e 696e 6974 2829 0a20 2020  leter.init().   
+000174c0: 2020 2020 2073 656c 662e 5f63 6865 636b       self._check
+000174d0: 5f6e 616d 6573 2829 0a0a 2020 2020 6465  _names()..    de
+000174e0: 6620 5f6f 6e5f 7573 6572 5f65 6469 745f  f _on_user_edit_
+000174f0: 646f 6e65 2873 656c 6629 3a0a 2020 2020  done(self):.    
+00017500: 2020 2020 7365 6c66 2e5f 6175 746f 636f      self._autoco
+00017510: 6d70 6c65 7465 722e 636c 6561 7228 290a  mpleter.clear().
+00017520: 0a20 2020 2064 6566 205f 6368 6563 6b5f  .    def _check_
+00017530: 6e61 6d65 7328 7365 6c66 293a 0a20 2020  names(self):.   
+00017540: 2020 2020 2074 6578 7420 3d20 7365 6c66       text = self
+00017550: 2e5f 7365 6172 6368 5f69 6e70 7574 2e76  ._search_input.v
+00017560: 616c 7565 2e6c 6f77 6572 2829 0a0a 2020  alue.lower()..  
+00017570: 2020 2020 2020 5f2c 2070 6172 7473 203d        _, parts =
+00017580: 2075 7469 6c73 2e67 6574 5f74 6167 735f   utils.get_tags_
+00017590: 616e 645f 7061 7274 735f 6672 6f6d 5f73  and_parts_from_s
+000175a0: 7472 696e 6728 7465 7874 290a 0a20 2020  tring(text)..   
+000175b0: 2020 2020 2070 6f73 5f74 6167 7320 3d20       pos_tags = 
+000175c0: 5b5d 0a20 2020 2020 2020 206e 6567 5f74  [].        neg_t
+000175d0: 6167 7320 3d20 5b5d 0a20 2020 2020 2020  ags = [].       
+000175e0: 2070 6f73 5f77 6f72 6473 203d 205b 5d0a   pos_words = [].
+000175f0: 2020 2020 2020 2020 6e65 675f 776f 7264          neg_word
+00017600: 7320 3d20 5b5d 0a0a 2020 2020 2020 2020  s = []..        
+00017610: 6e65 785f 7461 675f 6973 5f6e 6567 203d  nex_tag_is_neg =
+00017620: 2046 616c 7365 0a20 2020 2020 2020 2066   False.        f
+00017630: 6f72 2070 6172 7420 696e 2070 6172 7473  or part in parts
+00017640: 3a0a 2020 2020 2020 2020 2020 2020 7468  :.            th
+00017650: 6973 5f74 6167 5f69 735f 6e65 6720 3d20  is_tag_is_neg = 
+00017660: 6e65 785f 7461 675f 6973 5f6e 6567 0a20  nex_tag_is_neg. 
+00017670: 2020 2020 2020 2020 2020 206e 6578 5f74             nex_t
+00017680: 6167 5f69 735f 6e65 6720 3d20 4661 6c73  ag_is_neg = Fals
+00017690: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
+000176a0: 2070 6172 742e 7374 6172 7473 7769 7468   part.startswith
+000176b0: 2822 2322 293a 0a20 2020 2020 2020 2020  ("#"):.         
+000176c0: 2020 2020 2020 2069 6620 7468 6973 5f74         if this_t
+000176d0: 6167 5f69 735f 6e65 673a 0a20 2020 2020  ag_is_neg:.     
+000176e0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+000176f0: 6567 5f74 6167 732e 6170 7065 6e64 2870  eg_tags.append(p
+00017700: 6172 742e 6c6f 7765 7228 2929 0a20 2020  art.lower()).   
+00017710: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00017720: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00017730: 2020 2020 2020 2070 6f73 5f74 6167 732e         pos_tags.
+00017740: 6170 7065 6e64 2870 6172 742e 6c6f 7765  append(part.lowe
+00017750: 7228 2929 0a20 2020 2020 2020 2020 2020  r()).           
+00017760: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00017770: 2020 2020 2020 2066 6f72 2077 6f72 6420         for word 
+00017780: 696e 2070 6172 742e 7370 6c69 7428 2220  in part.split(" 
+00017790: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
+000177a0: 2020 2020 2020 2020 776f 7264 203d 2077          word = w
+000177b0: 6f72 642e 7374 7269 7028 290a 2020 2020  ord.strip().    
+000177c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000177d0: 6966 206e 6f74 2077 6f72 643a 0a20 2020  if not word:.   
+000177e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000177f0: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
+00017800: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00017810: 6966 2077 6f72 6420 3d3d 2022 2122 3a0a  if word == "!":.
+00017820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017830: 2020 2020 2020 2020 6e65 785f 7461 675f          nex_tag_
+00017840: 6973 5f6e 6567 203d 2054 7275 650a 2020  is_neg = True.  
+00017850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017860: 2020 656c 6966 2077 6f72 642e 7374 6172    elif word.star
+00017870: 7473 7769 7468 2822 2122 293a 0a20 2020  tswith("!"):.   
+00017880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017890: 2020 2020 206e 6567 5f77 6f72 6473 2e61       neg_words.a
+000178a0: 7070 656e 6428 776f 7264 5b31 3a5d 290a  ppend(word[1:]).
+000178b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000178c0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000178d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000178e0: 2020 706f 735f 776f 7264 732e 6170 7065    pos_words.appe
+000178f0: 6e64 2877 6f72 6429 0a0a 2020 2020 2020  nd(word)..      
+00017900: 2020 7365 6c66 2e5f 6375 7272 656e 745f    self._current_
+00017910: 706f 735f 7461 6773 203d 2070 6f73 5f74  pos_tags = pos_t
+00017920: 6167 730a 2020 2020 2020 2020 7365 6c66  ags.        self
+00017930: 2e5f 6375 7272 656e 745f 6e65 675f 7461  ._current_neg_ta
+00017940: 6773 203d 206e 6567 5f74 6167 730a 2020  gs = neg_tags.  
+00017950: 2020 2020 2020 7365 6c66 2e5f 6375 7272        self._curr
+00017960: 656e 745f 706f 735f 776f 7264 7320 3d20  ent_pos_words = 
+00017970: 706f 735f 776f 7264 730a 2020 2020 2020  pos_words.      
+00017980: 2020 7365 6c66 2e5f 6375 7272 656e 745f    self._current_
+00017990: 6e65 675f 776f 7264 7320 3d20 6e65 675f  neg_words = neg_
+000179a0: 776f 7264 730a 0a20 2020 2020 2020 2023  words..        #
+000179b0: 2050 726f 6365 7373 2073 6561 7263 6820   Process search 
+000179c0: 6275 7474 6f6e 0a20 2020 2020 2020 2069  button.        i
+000179d0: 6620 706f 735f 7461 6773 206f 7220 6e65  f pos_tags or ne
+000179e0: 675f 7461 6773 206f 7220 706f 735f 776f  g_tags or pos_wo
+000179f0: 7264 7320 6f72 206e 6567 5f77 6f72 6473  rds or neg_words
+00017a00: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00017a10: 6c66 2e5f 7365 6172 6368 5f62 7574 2e64  lf._search_but.d
+00017a20: 6973 6162 6c65 6420 3d20 4661 6c73 650a  isabled = False.
+00017a30: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00017a40: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00017a50: 7365 6172 6368 5f62 7574 2e64 6973 6162  search_but.disab
+00017a60: 6c65 6420 3d20 5472 7565 0a0a 2020 2020  led = True..    
+00017a70: 2020 2020 2320 5072 6f63 6573 7320 7461      # Process ta
+00017a80: 6773 2062 7574 746f 6e0a 2020 2020 2020  gs button.      
+00017a90: 2020 6966 206c 656e 2870 6f73 5f74 6167    if len(pos_tag
+00017aa0: 7329 203e 2030 3a0a 2020 2020 2020 2020  s) > 0:.        
+00017ab0: 2020 2020 6966 206c 656e 2870 6f73 5f74      if len(pos_t
+00017ac0: 6167 7329 203d 3d20 313a 0a20 2020 2020  ags) == 1:.     
+00017ad0: 2020 2020 2020 2020 2020 2069 636f 6e20             icon 
+00017ae0: 3d20 223c 6920 636c 6173 733d 2766 6173  = "<i class='fas
+00017af0: 273e 5c75 6630 3262 3c2f 693e 266e 6273  '>\uf02b</i>&nbs
+00017b00: 703b 266e 6273 703b 220a 2020 2020 2020  p;&nbsp;".      
+00017b10: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00017b20: 2020 2020 2020 2020 2020 2020 6963 6f6e              icon
+00017b30: 203d 2022 3c69 2063 6c61 7373 3d27 6661   = "<i class='fa
+00017b40: 7327 3e5c 7566 3032 633c 2f69 3e26 6e62  s'>\uf02c</i>&nb
+00017b50: 7370 3b26 6e62 7370 3b22 0a20 2020 2020  sp;&nbsp;".     
+00017b60: 2020 2020 2020 2073 656c 662e 5f74 6167         self._tag
+00017b70: 6d61 6e61 6765 5f62 7574 2e69 6e6e 6572  manage_but.inner
+00017b80: 4854 4d4c 203d 2066 227b 6963 6f6e 7d20  HTML = f"{icon} 
+00017b90: 4d61 6e61 6765 207b 706f 735f 7461 6773  Manage {pos_tags
+00017ba0: 2e6a 6f69 6e28 2720 2729 7d22 0a20 2020  .join(' ')}".   
+00017bb0: 2020 2020 2020 2020 2073 656c 662e 5f74           self._t
+00017bc0: 6167 6d61 6e61 6765 5f62 7574 2e64 6973  agmanage_but.dis
+00017bd0: 6162 6c65 6420 3d20 4661 6c73 650a 2020  abled = False.  
+00017be0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00017bf0: 2020 2020 2020 2020 7365 6c66 2e5f 7461          self._ta
+00017c00: 676d 616e 6167 655f 6275 742e 696e 6e65  gmanage_but.inne
+00017c10: 7248 544d 4c20 3d20 224d 616e 6167 6520  rHTML = "Manage 
+00017c20: 7461 6773 220a 2020 2020 2020 2020 2020  tags".          
+00017c30: 2020 7365 6c66 2e5f 7461 676d 616e 6167    self._tagmanag
+00017c40: 655f 6275 742e 6469 7361 626c 6564 203d  e_but.disabled =
+00017c50: 2054 7275 650a 0a20 2020 2020 2020 2073   True..        s
+00017c60: 656c 662e 5f73 686f 775f 7768 6174 5f77  elf._show_what_w
+00017c70: 6f75 6c64 5f62 655f 7365 6172 6368 6564  ould_be_searched
+00017c80: 2829 0a0a 2020 2020 6465 6620 5f6f 6e5f  ()..    def _on_
+00017c90: 6b65 7928 7365 6c66 2c20 6529 3a0a 2020  key(self, e):.  
+00017ca0: 2020 2020 2020 6b65 7920 3d20 652e 6b65        key = e.ke
+00017cb0: 792e 6c6f 7765 7228 290a 2020 2020 2020  y.lower().      
+00017cc0: 2020 6966 2073 656c 662e 5f61 7574 6f63    if self._autoc
+00017cd0: 6f6d 706c 6574 6572 2e6f 6e5f 6b65 7928  ompleter.on_key(
+00017ce0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+00017cf0: 652e 7374 6f70 5072 6f70 6167 6174 696f  e.stopPropagatio
+00017d00: 6e28 290a 2020 2020 2020 2020 2020 2020  n().            
+00017d10: 7265 7475 726e 0a20 2020 2020 2020 2065  return.        e
+00017d20: 6c69 6620 6b65 7920 3d3d 2022 656e 7465  lif key == "ente
+00017d30: 7222 206f 7220 6b65 7920 3d3d 2022 7265  r" or key == "re
+00017d40: 7475 726e 223a 0a20 2020 2020 2020 2020  turn":.         
+00017d50: 2020 2065 2e73 746f 7050 726f 7061 6761     e.stopPropaga
+00017d60: 7469 6f6e 2829 0a20 2020 2020 2020 2020  tion().         
+00017d70: 2020 2065 2e70 7265 7665 6e74 4465 6661     e.preventDefa
+00017d80: 756c 7428 290a 2020 2020 2020 2020 2020  ult().          
+00017d90: 2020 7365 6c66 2e5f 6669 6e64 5f72 6563    self._find_rec
+00017da0: 6f72 6473 2829 0a20 2020 2020 2020 2065  ords().        e
+00017db0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00017dc0: 2073 7570 6572 2829 2e5f 6f6e 5f6b 6579   super()._on_key
+00017dd0: 2865 290a 0a20 2020 2064 6566 205f 6669  (e)..    def _fi
+00017de0: 6e64 5f72 6563 6f72 6473 2873 656c 6629  nd_records(self)
+00017df0: 3a0a 2020 2020 2020 2020 7265 636f 7264  :.        record
+00017e00: 7320 3d20 5b5d 0a0a 2020 2020 2020 2020  s = []..        
+00017e10: 706f 735f 7461 6773 203d 2073 656c 662e  pos_tags = self.
+00017e20: 5f63 7572 7265 6e74 5f70 6f73 5f74 6167  _current_pos_tag
+00017e30: 730a 2020 2020 2020 2020 6e65 675f 7461  s.        neg_ta
+00017e40: 6773 203d 2073 656c 662e 5f63 7572 7265  gs = self._curre
+00017e50: 6e74 5f6e 6567 5f74 6167 730a 2020 2020  nt_neg_tags.    
+00017e60: 2020 2020 706f 735f 776f 7264 7320 3d20      pos_words = 
+00017e70: 7365 6c66 2e5f 6375 7272 656e 745f 706f  self._current_po
+00017e80: 735f 776f 7264 730a 2020 2020 2020 2020  s_words.        
+00017e90: 6e65 675f 776f 7264 7320 3d20 7365 6c66  neg_words = self
+00017ea0: 2e5f 6375 7272 656e 745f 6e65 675f 776f  ._current_neg_wo
+00017eb0: 7264 730a 0a20 2020 2020 2020 2069 735f  rds..        is_
+00017ec0: 6869 6464 656e 203d 2077 696e 646f 772e  hidden = window.
+00017ed0: 7374 6f72 6573 2e69 735f 6869 6464 656e  stores.is_hidden
+00017ee0: 0a0a 2020 2020 2020 2020 6966 2028 0a20  ..        if (. 
+00017ef0: 2020 2020 2020 2020 2020 206c 656e 2870             len(p
+00017f00: 6f73 5f74 6167 7329 203e 2030 0a20 2020  os_tags) > 0.   
+00017f10: 2020 2020 2020 2020 206f 7220 6c65 6e28           or len(
+00017f20: 6e65 675f 7461 6773 2920 3e20 300a 2020  neg_tags) > 0.  
+00017f30: 2020 2020 2020 2020 2020 6f72 206c 656e            or len
+00017f40: 2870 6f73 5f77 6f72 6473 2920 3e20 300a  (pos_words) > 0.
+00017f50: 2020 2020 2020 2020 2020 2020 6f72 206c              or l
+00017f60: 656e 286e 6567 5f77 6f72 6473 2920 3e20  en(neg_words) > 
+00017f70: 300a 2020 2020 2020 2020 293a 0a20 2020  0.        ):.   
+00017f80: 2020 2020 2020 2020 2023 2047 6574 206c           # Get l
+00017f90: 6973 7420 6f66 2072 6563 6f72 6473 0a20  ist of records. 
+00017fa0: 2020 2020 2020 2020 2020 2066 6f72 2072             for r
+00017fb0: 6563 6f72 6420 696e 2077 696e 646f 772e  ecord in window.
+00017fc0: 7374 6f72 652e 7265 636f 7264 732e 6765  store.records.ge
+00017fd0: 745f 6475 6d70 2829 3a0a 2020 2020 2020  t_dump():.      
+00017fe0: 2020 2020 2020 2020 2020 6966 2069 735f            if is_
+00017ff0: 6869 6464 656e 2872 6563 6f72 6429 3a0a  hidden(record):.
+00018000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018010: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
+00018020: 2020 2020 2020 2020 2020 2020 2023 2043               # C
+00018030: 6865 636b 2074 6167 730a 2020 2020 2020  heck tags.      
+00018040: 2020 2020 2020 2020 2020 7461 6773 203d            tags =
+00018050: 2077 696e 646f 772e 7374 6f72 652e 7265   window.store.re
+00018060: 636f 7264 732e 7461 6773 5f66 726f 6d5f  cords.tags_from_
+00018070: 7265 636f 7264 2872 6563 6f72 6429 2020  record(record)  
+00018080: 2320 616c 736f 2023 756e 7461 6767 6564  # also #untagged
+00018090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000180a0: 2061 6c6c 5f74 6167 735f 6f6b 203d 2054   all_tags_ok = T
+000180b0: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+000180c0: 2020 2020 666f 7220 7461 6720 696e 2070      for tag in p
+000180d0: 6f73 5f74 6167 733a 0a20 2020 2020 2020  os_tags:.       
+000180e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000180f0: 7461 6720 6e6f 7420 696e 2074 6167 733a  tag not in tags:
+00018100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018110: 2020 2020 2020 2020 2061 6c6c 5f74 6167           all_tag
+00018120: 735f 6f6b 203d 2046 616c 7365 0a20 2020  s_ok = False.   
+00018130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018140: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
+00018150: 2020 2020 2020 2020 2020 2066 6f72 2074             for t
+00018160: 6167 2069 6e20 6e65 675f 7461 6773 3a0a  ag in neg_tags:.
+00018170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018180: 2020 2020 6966 2074 6167 2069 6e20 7461      if tag in ta
+00018190: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
+000181a0: 2020 2020 2020 2020 2020 2020 616c 6c5f              all_
+000181b0: 7461 6773 5f6f 6b20 3d20 4661 6c73 650a  tags_ok = False.
+000181c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000181d0: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
+000181e0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000181f0: 206e 6f74 2061 6c6c 5f74 6167 735f 6f6b   not all_tags_ok
+00018200: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00018210: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
+00018220: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00018230: 2043 6865 636b 2073 7472 696e 6773 0a20   Check strings. 
+00018240: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00018250: 7320 3d20 2872 6563 6f72 642e 6473 206f  s = (record.ds o
+00018260: 7220 2222 292e 6c6f 7765 7228 290a 2020  r "").lower().  
+00018270: 2020 2020 2020 2020 2020 2020 2020 616c                al
+00018280: 6c5f 7374 7269 6e67 735f 6f6b 203d 2054  l_strings_ok = T
+00018290: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+000182a0: 2020 2020 666f 7220 776f 7264 2069 6e20      for word in 
+000182b0: 706f 735f 776f 7264 733a 0a20 2020 2020  pos_words:.     
+000182c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000182d0: 6620 776f 7264 206e 6f74 2069 6e20 6473  f word not in ds
+000182e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000182f0: 2020 2020 2020 2020 2020 616c 6c5f 7374            all_st
+00018300: 7269 6e67 735f 6f6b 203d 2046 616c 7365  rings_ok = False
+00018310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018320: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
+00018330: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00018340: 6f72 2077 6f72 6420 696e 206e 6567 5f77  or word in neg_w
+00018350: 6f72 6473 3a0a 2020 2020 2020 2020 2020  ords:.          
+00018360: 2020 2020 2020 2020 2020 6966 2077 6f72            if wor
+00018370: 6420 696e 2064 733a 0a20 2020 2020 2020  d in ds:.       
+00018380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018390: 2061 6c6c 5f73 7472 696e 6773 5f6f 6b20   all_strings_ok 
+000183a0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+000183b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000183c0: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
+000183d0: 2020 2020 2020 6966 206e 6f74 2061 6c6c        if not all
+000183e0: 5f73 7472 696e 6773 5f6f 6b3a 0a20 2020  _strings_ok:.   
+000183f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018400: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
+00018410: 2020 2020 2020 2020 2020 2320 416c 6c20            # All 
+00018420: 6368 6563 6b73 2070 6173 7365 640a 2020  checks passed.  
+00018430: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00018440: 636f 7264 732e 7075 7368 285b 7265 636f  cords.push([reco
+00018450: 7264 2e74 312c 2072 6563 6f72 642e 6b65  rd.t1, record.ke
+00018460: 795d 290a 0a20 2020 2020 2020 2072 6563  y])..        rec
+00018470: 6f72 6473 2e73 6f72 7428 6b65 793d 6c61  ords.sort(key=la
+00018480: 6d62 6461 2078 3a20 2d78 5b30 5d29 0a20  mbda x: -x[0]). 
+00018490: 2020 2020 2020 2073 656c 662e 5f72 6563         self._rec
+000184a0: 6f72 6473 203d 205b 785b 315d 2066 6f72  ords = [x[1] for
+000184b0: 2078 2069 6e20 7265 636f 7264 735d 0a20   x in records]. 
+000184c0: 2020 2020 2020 2073 656c 662e 5f73 686f         self._sho
+000184d0: 775f 7265 636f 7264 7328 290a 2020 2020  w_records().    
+000184e0: 2020 2020 7365 6c66 2e5f 6368 6563 6b5f      self._check_
+000184f0: 6e61 6d65 7328 290a 0a20 2020 2064 6566  names()..    def
+00018500: 205f 7368 6f77 5f77 6861 745f 776f 756c   _show_what_woul
+00018510: 645f 6265 5f73 6561 7263 6865 6428 7365  d_be_searched(se
+00018520: 6c66 293a 0a20 2020 2020 2020 2061 6e79  lf):.        any
+00018530: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+00018540: 2066 696e 645f 6874 6d6c 203d 2066 2253   find_html = f"S
+00018550: 6561 7263 6820 7275 6c65 733a 3c75 6c3e  earch rules:<ul>
+00018560: 220a 2020 2020 2020 2020 6966 206c 656e  ".        if len
+00018570: 2873 656c 662e 5f63 7572 7265 6e74 5f70  (self._current_p
+00018580: 6f73 5f74 6167 7329 203e 2030 3a0a 2020  os_tags) > 0:.  
+00018590: 2020 2020 2020 2020 2020 616e 7920 3d20            any = 
+000185a0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+000185b0: 2062 6f6c 645f 7461 6773 203d 205b 6622   bold_tags = [f"
+000185c0: 3c62 3e7b 7461 677d 3c2f 623e 2220 666f  <b>{tag}</b>" fo
+000185d0: 7220 7461 6720 696e 2073 656c 662e 5f63  r tag in self._c
+000185e0: 7572 7265 6e74 5f70 6f73 5f74 6167 735d  urrent_pos_tags]
+000185f0: 0a20 2020 2020 2020 2020 2020 2066 696e  .            fin
+00018600: 645f 6874 6d6c 202b 3d20 223c 6c69 3e49  d_html += "<li>I
+00018610: 6e63 6c75 6469 6e67 2074 6167 2220 2b20  ncluding tag" + 
+00018620: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00018630: 2020 2273 2220 6966 206c 656e 2873 656c    "s" if len(sel
+00018640: 662e 5f63 7572 7265 6e74 5f70 6f73 5f74  f._current_pos_t
+00018650: 6167 7329 203e 2031 2065 6c73 6520 2222  ags) > 1 else ""
+00018660: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00018670: 2020 2020 2020 2020 2020 2066 696e 645f             find_
+00018680: 6874 6d6c 202b 3d20 2220 2220 2b20 222c  html += " " + ",
+00018690: 2022 2e6a 6f69 6e28 626f 6c64 5f74 6167   ".join(bold_tag
+000186a0: 7329 202b 2022 3c2f 6c69 3e22 0a20 2020  s) + "</li>".   
+000186b0: 2020 2020 2069 6620 6c65 6e28 7365 6c66       if len(self
+000186c0: 2e5f 6375 7272 656e 745f 6e65 675f 7461  ._current_neg_ta
+000186d0: 6773 2920 3e20 303a 0a20 2020 2020 2020  gs) > 0:.       
+000186e0: 2020 2020 2061 6e79 203d 2054 7275 650a       any = True.
+000186f0: 2020 2020 2020 2020 2020 2020 626f 6c64              bold
+00018700: 5f74 6167 7320 3d20 5b66 223c 623e 7b74  _tags = [f"<b>{t
+00018710: 6167 7d3c 2f62 3e22 2066 6f72 2074 6167  ag}</b>" for tag
+00018720: 2069 6e20 7365 6c66 2e5f 6375 7272 656e   in self._curren
+00018730: 745f 6e65 675f 7461 6773 5d0a 2020 2020  t_neg_tags].    
+00018740: 2020 2020 2020 2020 6669 6e64 5f68 746d          find_htm
+00018750: 6c20 2b3d 2022 3c6c 693e 4578 636c 7564  l += "<li>Exclud
+00018760: 696e 6720 7461 6722 202b 2028 0a20 2020  ing tag" + (.   
+00018770: 2020 2020 2020 2020 2020 2020 2022 7322               "s"
+00018780: 2069 6620 6c65 6e28 7365 6c66 2e5f 6375   if len(self._cu
+00018790: 7272 656e 745f 6e65 675f 7461 6773 2920  rrent_neg_tags) 
+000187a0: 3e20 3120 656c 7365 2022 220a 2020 2020  > 1 else "".    
+000187b0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000187c0: 2020 2020 2020 6669 6e64 5f68 746d 6c20        find_html 
+000187d0: 2b3d 2022 2022 202b 2022 2c20 222e 6a6f  += " " + ", ".jo
+000187e0: 696e 2862 6f6c 645f 7461 6773 2920 2b20  in(bold_tags) + 
+000187f0: 223c 2f6c 693e 220a 2020 2020 2020 2020  "</li>".        
+00018800: 6966 206c 656e 2873 656c 662e 5f63 7572  if len(self._cur
+00018810: 7265 6e74 5f70 6f73 5f77 6f72 6473 2920  rent_pos_words) 
+00018820: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
+00018830: 2061 6e79 203d 2054 7275 650a 2020 2020   any = True.    
+00018840: 2020 2020 2020 2020 6974 616c 6963 5f77          italic_w
+00018850: 6f72 6473 203d 205b 6622 3c69 3e27 7b77  ords = [f"<i>'{w
+00018860: 6f72 647d 273c 2f69 3e22 2066 6f72 2077  ord}'</i>" for w
+00018870: 6f72 6420 696e 2073 656c 662e 5f63 7572  ord in self._cur
+00018880: 7265 6e74 5f70 6f73 5f77 6f72 6473 5d0a  rent_pos_words].
+00018890: 2020 2020 2020 2020 2020 2020 6669 6e64              find
+000188a0: 5f68 746d 6c20 2b3d 2022 203c 6c69 3e49  _html += " <li>I
+000188b0: 6e63 6c75 6469 6e67 2077 6f72 6422 202b  ncluding word" +
+000188c0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+000188d0: 2020 2022 7322 2069 6620 6c65 6e28 7365     "s" if len(se
+000188e0: 6c66 2e5f 6375 7272 656e 745f 706f 735f  lf._current_pos_
+000188f0: 776f 7264 7329 203e 2031 2065 6c73 6520  words) > 1 else 
+00018900: 2222 0a20 2020 2020 2020 2020 2020 2029  "".            )
+00018910: 0a20 2020 2020 2020 2020 2020 2066 696e  .            fin
+00018920: 645f 6874 6d6c 202b 3d20 2220 2220 2b20  d_html += " " + 
+00018930: 222c 2022 2e6a 6f69 6e28 6974 616c 6963  ", ".join(italic
+00018940: 5f77 6f72 6473 2920 2b20 223c 2f6c 693e  _words) + "</li>
+00018950: 220a 2020 2020 2020 2020 6966 206c 656e  ".        if len
+00018960: 2873 656c 662e 5f63 7572 7265 6e74 5f6e  (self._current_n
+00018970: 6567 5f77 6f72 6473 2920 3e20 303a 0a20  eg_words) > 0:. 
+00018980: 2020 2020 2020 2020 2020 2061 6e79 203d             any =
+00018990: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
+000189a0: 2020 6974 616c 6963 5f77 6f72 6473 203d    italic_words =
+000189b0: 205b 6622 3c69 3e27 7b77 6f72 647d 273c   [f"<i>'{word}'<
+000189c0: 2f69 3e22 2066 6f72 2077 6f72 6420 696e  /i>" for word in
+000189d0: 2073 656c 662e 5f63 7572 7265 6e74 5f6e   self._current_n
+000189e0: 6567 5f77 6f72 6473 5d0a 2020 2020 2020  eg_words].      
+000189f0: 2020 2020 2020 6669 6e64 5f68 746d 6c20        find_html 
+00018a00: 2b3d 2022 203c 6c69 3e45 7863 6c75 6469  += " <li>Excludi
+00018a10: 6e67 2077 6f72 6422 202b 2028 0a20 2020  ng word" + (.   
+00018a20: 2020 2020 2020 2020 2020 2020 2022 7322               "s"
+00018a30: 2069 6620 6c65 6e28 7365 6c66 2e5f 6375   if len(self._cu
+00018a40: 7272 656e 745f 6e65 675f 776f 7264 7329  rrent_neg_words)
+00018a50: 203e 2031 2065 6c73 6520 2222 0a20 2020   > 1 else "".   
+00018a60: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00018a70: 2020 2020 2020 2066 696e 645f 6874 6d6c         find_html
+00018a80: 202b 3d20 2220 2220 2b20 222c 2022 2e6a   += " " + ", ".j
+00018a90: 6f69 6e28 6974 616c 6963 5f77 6f72 6473  oin(italic_words
+00018aa0: 2920 2b20 223c 2f6c 693e 220a 2020 2020  ) + "</li>".    
+00018ab0: 2020 2020 6669 6e64 5f68 746d 6c20 2b3d      find_html +=
+00018ac0: 2022 3c2f 756c 3e22 0a20 2020 2020 2020   "</ul>".       
+00018ad0: 2073 656c 662e 5f69 6e66 6f5f 6469 762e   self._info_div.
+00018ae0: 696e 6e65 7248 544d 4c20 3d20 6669 6e64  innerHTML = find
+00018af0: 5f68 746d 6c20 6966 2061 6e79 2065 6c73  _html if any els
+00018b00: 6520 2222 0a0a 2020 2020 6465 6620 5f73  e ""..    def _s
+00018b10: 686f 775f 7265 636f 7264 7328 7365 6c66  how_records(self
+00018b20: 293a 0a20 2020 2020 2020 206c 696e 6573  ):.        lines
+00018b30: 203d 205b 6622 466f 756e 6420 7b73 656c   = [f"Found {sel
+00018b40: 662e 5f72 6563 6f72 6473 2e6c 656e 6774  f._records.lengt
+00018b50: 687d 2072 6563 6f72 6473 3a3c 6272 3e22  h} records:<br>"
+00018b60: 5d0a 2020 2020 2020 2020 666f 7220 6b65  ].        for ke
+00018b70: 7920 696e 2073 656c 662e 5f72 6563 6f72  y in self._recor
+00018b80: 6473 3a0a 2020 2020 2020 2020 2020 2020  ds:.            
+00018b90: 7265 636f 7264 203d 2077 696e 646f 772e  record = window.
+00018ba0: 7374 6f72 652e 7265 636f 7264 732e 6765  store.records.ge
+00018bb0: 745f 6279 5f6b 6579 286b 6579 290a 2020  t_by_key(key).  
+00018bc0: 2020 2020 2020 2020 2020 6473 203d 2072            ds = r
+00018bd0: 6563 6f72 642e 6473 206f 7220 2222 0a20  ecord.ds or "". 
+00018be0: 2020 2020 2020 2020 2020 2064 6174 6520             date 
+00018bf0: 3d20 6474 2e74 696d 6532 7374 7228 7265  = dt.time2str(re
+00018c00: 636f 7264 2e74 3129 2e73 706c 6974 2822  cord.t1).split("
+00018c10: 5422 295b 305d 0a20 2020 2020 2020 2020  T")[0].         
+00018c20: 2020 206c 696e 6573 2e61 7070 656e 6428     lines.append(
+00018c30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018c40: 2066 2222 220a 2020 2020 2020 2020 2020   f""".          
+00018c50: 2020 2020 2020 3c61 2068 7265 663d 2723        <a href='#
+00018c60: 6461 7465 3d7b 6461 7465 7d27 0a20 2020  date={date}'.   
 00018c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018c80: 2020 2020 3c64 6976 3e73 6176 6520 7370      <div>save sp
-00018c90: 7265 6164 7368 6565 7420 286d 6f72 6520  readsheet (more 
-00018ca0: 6465 7461 696c 7329 3c2f 6469 763e 0a20  details)</div>. 
-00018cb0: 2020 2020 2020 2020 2020 2020 2020 203c                 <
-00018cc0: 6275 7474 6f6e 2074 7970 653d 2762 7574  button type='but
-00018cd0: 746f 6e27 3e3c 6920 636c 6173 733d 2766  ton'><i class='f
-00018ce0: 6173 273e 5c75 6631 6331 3c2f 693e 266e  as'>\uf1c1</i>&n
-00018cf0: 6273 703b 266e 6273 703b 5361 7665 2050  bsp;&nbsp;Save P
-00018d00: 4446 3c2f 6275 7474 6f6e 3e0a 2020 2020  DF</button>.    
-00018d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018d20: 3c64 6976 3e61 7263 6869 7665 206f 7220  <div>archive or 
-00018d30: 7365 6e64 2074 6f20 6120 636c 6965 6e74  send to a client
-00018d40: 3c2f 6469 763e 0a20 2020 2020 2020 2020  </div>.         
-00018d50: 2020 203c 2f64 6976 3e0a 2020 2020 2020     </div>.      
-00018d60: 2020 2020 2020 3c68 7220 2f3e 0a20 2020        <hr />.   
-00018d70: 2020 2020 2020 2020 203c 7461 626c 6520           <table 
-00018d80: 6964 3d27 7265 706f 7274 5f74 6162 6c65  id='report_table
-00018d90: 273e 3c2f 7461 626c 653e 0a20 2020 2020  '></table>.     
-00018da0: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-00018db0: 7365 6c66 2e6d 6169 6e64 6976 2e69 6e6e  self.maindiv.inn
-00018dc0: 6572 4854 4d4c 203d 2068 746d 6c0a 2020  erHTML = html.  
-00018dd0: 2020 2020 2020 7365 6c66 2e5f 7461 626c        self._tabl
-00018de0: 655f 656c 656d 656e 7420 3d20 7365 6c66  e_element = self
-00018df0: 2e6d 6169 6e64 6976 2e63 6869 6c64 7265  .maindiv.childre
-00018e00: 6e5b 2d31 5d0a 2020 2020 2020 2020 666f  n[-1].        fo
-00018e10: 726d 203d 2073 656c 662e 6d61 696e 6469  rm = self.maindi
-00018e20: 762e 6368 696c 6472 656e 5b31 5d0a 0a20  v.children[1].. 
-00018e30: 2020 2020 2020 2023 2066 696c 7465 7220         # filter 
-00018e40: 7465 7874 203d 2066 6f72 6d2e 6368 696c  text = form.chil
-00018e50: 6472 656e 5b31 5d0a 2020 2020 2020 2020  dren[1].        
-00018e60: 7365 6c66 2e5f 6461 7465 5f72 616e 6765  self._date_range
-00018e70: 203d 2066 6f72 6d2e 6368 696c 6472 656e   = form.children
-00018e80: 5b33 5d0a 2020 2020 2020 2020 7365 6c66  [3].        self
-00018e90: 2e5f 6772 6f75 7069 6e67 5f73 656c 6563  ._grouping_selec
-00018ea0: 7420 3d20 666f 726d 2e63 6869 6c64 7265  t = form.childre
-00018eb0: 6e5b 355d 0a20 2020 2020 2020 2073 656c  n[5].        sel
-00018ec0: 662e 5f67 726f 7570 7065 7269 6f64 5f73  f._groupperiod_s
-00018ed0: 656c 6563 7420 3d20 666f 726d 2e63 6869  elect = form.chi
-00018ee0: 6c64 7265 6e5b 375d 0a20 2020 2020 2020  ldren[7].       
-00018ef0: 2073 656c 662e 5f68 6964 6573 6563 6f6e   self._hidesecon
-00018f00: 6461 7279 5f62 7574 203d 2066 6f72 6d2e  dary_but = form.
-00018f10: 6368 696c 6472 656e 5b39 5d2e 6368 696c  children[9].chil
-00018f20: 6472 656e 5b30 5d20 2023 2069 6e73 6964  dren[0]  # insid
-00018f30: 6520 6c61 6265 6c0a 2020 2020 2020 2020  e label.        
-00018f40: 7365 6c66 2e5f 686f 7572 6465 6369 6d61  self._hourdecima
-00018f50: 6c73 5f62 7574 203d 2066 6f72 6d2e 6368  ls_but = form.ch
-00018f60: 696c 6472 656e 5b31 315d 2e63 6869 6c64  ildren[11].child
-00018f70: 7265 6e5b 305d 2020 2320 696e 7369 6465  ren[0]  # inside
-00018f80: 206c 6162 656c 0a20 2020 2020 2020 2073   label.        s
-00018f90: 656c 662e 5f73 686f 7772 6563 6f72 6473  elf._showrecords
-00018fa0: 5f62 7574 203d 2066 6f72 6d2e 6368 696c  _but = form.chil
-00018fb0: 6472 656e 5b31 335d 2e63 6869 6c64 7265  dren[13].childre
-00018fc0: 6e5b 305d 2020 2320 696e 7369 6465 206c  n[0]  # inside l
-00018fd0: 6162 656c 0a20 2020 2020 2020 2073 656c  abel.        sel
-00018fe0: 662e 5f63 6f70 795f 6275 7420 3d20 666f  f._copy_but = fo
-00018ff0: 726d 2e63 6869 6c64 7265 6e5b 3134 5d0a  rm.children[14].
-00019000: 2020 2020 2020 2020 7365 6c66 2e5f 7361          self._sa
-00019010: 7665 6373 765f 6275 7420 3d20 666f 726d  vecsv_but = form
-00019020: 2e63 6869 6c64 7265 6e5b 3136 5d0a 2020  .children[16].  
-00019030: 2020 2020 2020 7365 6c66 2e5f 7361 7665        self._save
-00019040: 7064 665f 6275 7420 3d20 666f 726d 2e63  pdf_but = form.c
-00019050: 6869 6c64 7265 6e5b 3138 5d0a 0a20 2020  hildren[18]..   
-00019060: 2020 2020 2023 2043 6f6e 6e65 6374 2069       # Connect i
-00019070: 6e70 7574 2065 6c65 6d65 6e74 730a 2020  nput elements.  
-00019080: 2020 2020 2020 636c 6f73 655f 6275 7420        close_but 
-00019090: 3d20 7365 6c66 2e6d 6169 6e64 6976 2e63  = self.maindiv.c
-000190a0: 6869 6c64 7265 6e5b 305d 2e63 6869 6c64  hildren[0].child
-000190b0: 7265 6e5b 2d31 5d0a 2020 2020 2020 2020  ren[-1].        
-000190c0: 636c 6f73 655f 6275 742e 6f6e 636c 6963  close_but.onclic
-000190d0: 6b20 3d20 7365 6c66 2e63 6c6f 7365 0a20  k = self.close. 
-000190e0: 2020 2020 2020 2073 656c 662e 5f64 6174         self._dat
-000190f0: 655f 7261 6e67 652e 696e 6e65 7248 544d  e_range.innerHTM
-00019100: 4c20 3d20 280a 2020 2020 2020 2020 2020  L = (.          
-00019110: 2020 7431 5f64 6174 6520 2b20 2226 6e62    t1_date + "&nb
-00019120: 7370 3b26 6e62 7370 3b26 6e64 6173 683b  sp;&nbsp;&ndash;
-00019130: 266e 6273 703b 266e 6273 703b 2220 2b20  &nbsp;&nbsp;" + 
-00019140: 7432 5f64 6174 650a 2020 2020 2020 2020  t2_date.        
-00019150: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
-00019160: 6461 7465 5f72 616e 6765 2e69 6e6e 6572  date_range.inner
-00019170: 4854 4d4c 202b 3d20 280a 2020 2020 2020  HTML += (.      
-00019180: 2020 2020 2020 2226 6e62 7370 3b26 6e62        "&nbsp;&nb
-00019190: 7370 3b3c 6275 7474 6f6e 2074 7970 653d  sp;<button type=
-000191a0: 2762 7574 746f 6e27 3e3c 6920 636c 6173  'button'><i clas
-000191b0: 733d 2766 6173 273e 5c75 6630 3733 3c2f  s='fas'>\uf073</
-000191c0: 693e 3c2f 6275 7474 6f6e 3e22 0a20 2020  i></button>".   
-000191d0: 2020 2020 2029 0a20 2020 2020 2020 2064       ).        d
-000191e0: 6174 655f 6275 7474 6f6e 203d 2073 656c  ate_button = sel
-000191f0: 662e 5f64 6174 655f 7261 6e67 652e 6368  f._date_range.ch
-00019200: 696c 6472 656e 5b30 5d0a 2020 2020 2020  ildren[0].      
-00019210: 2020 6461 7465 5f62 7574 746f 6e2e 6f6e    date_button.on
-00019220: 636c 6963 6b20 3d20 7365 6c66 2e5f 7573  click = self._us
-00019230: 6572 5f63 686f 7365 5f64 6174 650a 2020  er_chose_date.  
-00019240: 2020 2020 2020 230a 2020 2020 2020 2020        #.        
-00019250: 6772 6f75 7069 6e67 203d 2077 696e 646f  grouping = windo
-00019260: 772e 7369 6d70 6c65 7365 7474 696e 6773  w.simplesettings
-00019270: 2e67 6574 2822 7265 706f 7274 5f67 726f  .get("report_gro
-00019280: 7570 696e 6722 290a 2020 2020 2020 2020  uping").        
-00019290: 7365 6c66 2e5f 6772 6f75 7069 6e67 5f73  self._grouping_s
-000192a0: 656c 6563 742e 7661 6c75 6520 3d20 6772  elect.value = gr
-000192b0: 6f75 7069 6e67 0a20 2020 2020 2020 2067  ouping.        g
-000192c0: 726f 7570 7065 7269 6f64 203d 2077 696e  roupperiod = win
-000192d0: 646f 772e 7369 6d70 6c65 7365 7474 696e  dow.simplesettin
-000192e0: 6773 2e67 6574 2822 7265 706f 7274 5f67  gs.get("report_g
-000192f0: 726f 7570 7065 7269 6f64 2229 0a20 2020  roupperiod").   
-00019300: 2020 2020 2073 656c 662e 5f67 726f 7570       self._group
-00019310: 7065 7269 6f64 5f73 656c 6563 742e 7661  period_select.va
-00019320: 6c75 6520 3d20 6772 6f75 7070 6572 696f  lue = groupperio
-00019330: 640a 2020 2020 2020 2020 6869 6465 7365  d.        hidese
-00019340: 636f 6e64 6172 7920 3d20 7769 6e64 6f77  condary = window
-00019350: 2e73 696d 706c 6573 6574 7469 6e67 732e  .simplesettings.
-00019360: 6765 7428 2272 6570 6f72 745f 6869 6465  get("report_hide
-00019370: 7365 636f 6e64 6172 7922 290a 2020 2020  secondary").    
-00019380: 2020 2020 7365 6c66 2e5f 6869 6465 7365      self._hidese
-00019390: 636f 6e64 6172 795f 6275 742e 6368 6563  condary_but.chec
-000193a0: 6b65 6420 3d20 6869 6465 7365 636f 6e64  ked = hidesecond
-000193b0: 6172 790a 2020 2020 2020 2020 686f 7572  ary.        hour
-000193c0: 6465 6369 6d61 6c73 203d 2077 696e 646f  decimals = windo
-000193d0: 772e 7369 6d70 6c65 7365 7474 696e 6773  w.simplesettings
-000193e0: 2e67 6574 2822 7265 706f 7274 5f68 6f75  .get("report_hou
-000193f0: 7264 6563 696d 616c 7322 290a 2020 2020  rdecimals").    
-00019400: 2020 2020 7365 6c66 2e5f 686f 7572 6465      self._hourde
-00019410: 6369 6d61 6c73 5f62 7574 2e63 6865 636b  cimals_but.check
-00019420: 6564 203d 2068 6f75 7264 6563 696d 616c  ed = hourdecimal
-00019430: 730a 2020 2020 2020 2020 7368 6f77 7265  s.        showre
-00019440: 636f 7264 7320 3d20 7769 6e64 6f77 2e73  cords = window.s
-00019450: 696d 706c 6573 6574 7469 6e67 732e 6765  implesettings.ge
-00019460: 7428 2272 6570 6f72 745f 7368 6f77 7265  t("report_showre
-00019470: 636f 7264 7322 290a 2020 2020 2020 2020  cords").        
-00019480: 7365 6c66 2e5f 7368 6f77 7265 636f 7264  self._showrecord
-00019490: 735f 6275 742e 6368 6563 6b65 6420 3d20  s_but.checked = 
-000194a0: 7368 6f77 7265 636f 7264 730a 2020 2020  showrecords.    
-000194b0: 2020 2020 230a 2020 2020 2020 2020 7365      #.        se
-000194c0: 6c66 2e5f 6772 6f75 7069 6e67 5f73 656c  lf._grouping_sel
-000194d0: 6563 742e 6f6e 6368 616e 6765 203d 2073  ect.onchange = s
-000194e0: 656c 662e 5f6f 6e5f 7365 7474 696e 675f  elf._on_setting_
-000194f0: 6368 616e 6765 640a 2020 2020 2020 2020  changed.        
-00019500: 7365 6c66 2e5f 6772 6f75 7070 6572 696f  self._groupperio
-00019510: 645f 7365 6c65 6374 2e6f 6e63 6861 6e67  d_select.onchang
-00019520: 6520 3d20 7365 6c66 2e5f 6f6e 5f73 6574  e = self._on_set
-00019530: 7469 6e67 5f63 6861 6e67 6564 0a20 2020  ting_changed.   
-00019540: 2020 2020 2073 656c 662e 5f68 6964 6573       self._hides
-00019550: 6563 6f6e 6461 7279 5f62 7574 2e6f 6e69  econdary_but.oni
-00019560: 6e70 7574 203d 2073 656c 662e 5f6f 6e5f  nput = self._on_
-00019570: 7365 7474 696e 675f 6368 616e 6765 640a  setting_changed.
-00019580: 2020 2020 2020 2020 7365 6c66 2e5f 686f          self._ho
-00019590: 7572 6465 6369 6d61 6c73 5f62 7574 2e6f  urdecimals_but.o
-000195a0: 6e69 6e70 7574 203d 2073 656c 662e 5f6f  ninput = self._o
-000195b0: 6e5f 7365 7474 696e 675f 6368 616e 6765  n_setting_change
-000195c0: 640a 2020 2020 2020 2020 7365 6c66 2e5f  d.        self._
-000195d0: 7368 6f77 7265 636f 7264 735f 6275 742e  showrecords_but.
-000195e0: 6f6e 696e 7075 7420 3d20 7365 6c66 2e5f  oninput = self._
-000195f0: 6f6e 5f73 6574 7469 6e67 5f63 6861 6e67  on_setting_chang
-00019600: 6564 0a20 2020 2020 2020 2023 0a20 2020  ed.        #.   
-00019610: 2020 2020 2073 656c 662e 5f63 6f70 795f       self._copy_
-00019620: 6275 742e 6f6e 636c 6963 6b20 3d20 7365  but.onclick = se
-00019630: 6c66 2e5f 636f 7079 5f63 6c69 7062 6f61  lf._copy_clipboa
-00019640: 7264 0a20 2020 2020 2020 2073 656c 662e  rd.        self.
-00019650: 5f73 6176 6563 7376 5f62 7574 2e6f 6e63  _savecsv_but.onc
-00019660: 6c69 636b 203d 2073 656c 662e 5f73 6176  lick = self._sav
-00019670: 655f 6173 5f63 7376 0a20 2020 2020 2020  e_as_csv.       
-00019680: 2073 656c 662e 5f73 6176 6570 6466 5f62   self._savepdf_b
-00019690: 7574 2e6f 6e63 6c69 636b 203d 2073 656c  ut.onclick = sel
-000196a0: 662e 5f73 6176 655f 6173 5f70 6466 0a0a  f._save_as_pdf..
-000196b0: 2020 2020 2020 2020 7769 6e64 6f77 2e73          window.s
-000196c0: 6574 5469 6d65 6f75 7428 7365 6c66 2e5f  etTimeout(self._
-000196d0: 7570 6461 7465 5f74 6162 6c65 290a 2020  update_table).  
-000196e0: 2020 2020 2020 7375 7065 7228 292e 6f70        super().op
-000196f0: 656e 284e 6f6e 6529 0a0a 2020 2020 6465  en(None)..    de
-00019700: 6620 5f75 7365 725f 6368 6f73 655f 6461  f _user_chose_da
-00019710: 7465 2873 656c 6629 3a0a 2020 2020 2020  te(self):.      
-00019720: 2020 7365 6c66 2e63 6c6f 7365 2829 0a20    self.close(). 
-00019730: 2020 2020 2020 2073 656c 662e 5f63 616e         self._can
-00019740: 7661 732e 7469 6d65 7365 6c65 6374 696f  vas.timeselectio
-00019750: 6e5f 6469 616c 6f67 2e6f 7065 6e28 7365  n_dialog.open(se
-00019760: 6c66 2e6f 7065 6e29 0a0a 2020 2020 6465  lf.open)..    de
-00019770: 6620 5f6f 6e5f 7365 7474 696e 675f 6368  f _on_setting_ch
-00019780: 616e 6765 6428 7365 6c66 293a 0a20 2020  anged(self):.   
-00019790: 2020 2020 2077 696e 646f 772e 7369 6d70       window.simp
-000197a0: 6c65 7365 7474 696e 6773 2e73 6574 2822  lesettings.set("
-000197b0: 7265 706f 7274 5f67 726f 7570 696e 6722  report_grouping"
-000197c0: 2c20 7365 6c66 2e5f 6772 6f75 7069 6e67  , self._grouping
-000197d0: 5f73 656c 6563 742e 7661 6c75 6529 0a20  _select.value). 
-000197e0: 2020 2020 2020 2077 696e 646f 772e 7369         window.si
-000197f0: 6d70 6c65 7365 7474 696e 6773 2e73 6574  mplesettings.set
-00019800: 2822 7265 706f 7274 5f67 726f 7570 7065  ("report_grouppe
-00019810: 7269 6f64 222c 2073 656c 662e 5f67 726f  riod", self._gro
-00019820: 7570 7065 7269 6f64 5f73 656c 6563 742e  upperiod_select.
-00019830: 7661 6c75 6529 0a20 2020 2020 2020 2077  value).        w
-00019840: 696e 646f 772e 7369 6d70 6c65 7365 7474  indow.simplesett
-00019850: 696e 6773 2e73 6574 280a 2020 2020 2020  ings.set(.      
-00019860: 2020 2020 2020 2272 6570 6f72 745f 6869        "report_hi
-00019870: 6465 7365 636f 6e64 6172 7922 2c20 7365  desecondary", se
-00019880: 6c66 2e5f 6869 6465 7365 636f 6e64 6172  lf._hidesecondar
-00019890: 795f 6275 742e 6368 6563 6b65 640a 2020  y_but.checked.  
-000198a0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000198b0: 7769 6e64 6f77 2e73 696d 706c 6573 6574  window.simpleset
-000198c0: 7469 6e67 732e 7365 7428 2272 6570 6f72  tings.set("repor
-000198d0: 745f 686f 7572 6465 6369 6d61 6c73 222c  t_hourdecimals",
-000198e0: 2073 656c 662e 5f68 6f75 7264 6563 696d   self._hourdecim
-000198f0: 616c 735f 6275 742e 6368 6563 6b65 6429  als_but.checked)
-00019900: 0a20 2020 2020 2020 2077 696e 646f 772e  .        window.
-00019910: 7369 6d70 6c65 7365 7474 696e 6773 2e73  simplesettings.s
-00019920: 6574 2822 7265 706f 7274 5f73 686f 7772  et("report_showr
-00019930: 6563 6f72 6473 222c 2073 656c 662e 5f73  ecords", self._s
-00019940: 686f 7772 6563 6f72 6473 5f62 7574 2e63  howrecords_but.c
-00019950: 6865 636b 6564 290a 2020 2020 2020 2020  hecked).        
-00019960: 7365 6c66 2e5f 7570 6461 7465 5f74 6162  self._update_tab
-00019970: 6c65 2829 0a0a 2020 2020 6465 6620 5f75  le()..    def _u
-00019980: 7064 6174 655f 7461 626c 6528 7365 6c66  pdate_table(self
-00019990: 293a 0a20 2020 2020 2020 2074 315f 6461  ):.        t1_da
-000199a0: 7465 203d 2073 656c 662e 5f74 315f 6461  te = self._t1_da
-000199b0: 7465 0a20 2020 2020 2020 2074 325f 6461  te.        t2_da
-000199c0: 7465 203d 2073 656c 662e 5f74 325f 6461  te = self._t2_da
-000199d0: 7465 0a20 2020 2020 2020 2069 6620 6e6f  te.        if no
-000199e0: 7420 666c 6f61 7428 7431 5f64 6174 652e  t float(t1_date.
-000199f0: 7370 6c69 7428 222d 2229 5b30 5d29 203e  split("-")[0]) >
-00019a00: 2031 3839 393a 0a20 2020 2020 2020 2020   1899:.         
-00019a10: 2020 2073 656c 662e 5f74 6162 6c65 5f65     self._table_e
-00019a20: 6c65 6d65 6e74 2e69 6e6e 6572 4854 4d4c  lement.innerHTML
-00019a30: 203d 2022 220a 2020 2020 2020 2020 2020   = "".          
-00019a40: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
-00019a50: 2065 6c69 6620 6e6f 7420 666c 6f61 7428   elif not float(
-00019a60: 7432 5f64 6174 652e 7370 6c69 7428 222d  t2_date.split("-
-00019a70: 2229 5b30 5d29 203e 2031 3839 393a 0a20  ")[0]) > 1899:. 
-00019a80: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00019a90: 5f74 6162 6c65 5f65 6c65 6d65 6e74 2e69  _table_element.i
-00019aa0: 6e6e 6572 4854 4d4c 203d 2022 220a 2020  nnerHTML = "".  
-00019ab0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00019ac0: 0a0a 2020 2020 2020 2020 7431 203d 2073  ..        t1 = s
-00019ad0: 7472 5f64 6174 655f 746f 5f74 696d 655f  tr_date_to_time_
-00019ae0: 696e 7428 7431 5f64 6174 6529 0a20 2020  int(t1_date).   
-00019af0: 2020 2020 2074 3220 3d20 7374 725f 6461       t2 = str_da
-00019b00: 7465 5f74 6f5f 7469 6d65 5f69 6e74 2874  te_to_time_int(t
-00019b10: 325f 6461 7465 290a 2020 2020 2020 2020  2_date).        
-00019b20: 7432 203d 2064 742e 6164 6428 7432 2c20  t2 = dt.add(t2, 
-00019b30: 2231 4422 2920 2023 206c 6f6f 6b20 756e  "1D")  # look un
-00019b40: 7469 6c20 7468 6520 656e 6420 6f66 2074  til the end of t
-00019b50: 6865 2064 6179 0a0a 2020 2020 2020 2020  he day..        
-00019b60: 7365 6c66 2e5f 6c61 7374 5f74 312c 2073  self._last_t1, s
-00019b70: 656c 662e 5f6c 6173 745f 7432 203d 2074  elf._last_t2 = t
-00019b80: 312c 2074 320a 2020 2020 2020 2020 6874  1, t2.        ht
-00019b90: 6d6c 203d 2073 656c 662e 5f67 656e 6572  ml = self._gener
-00019ba0: 6174 655f 7461 626c 655f 6874 6d6c 2873  ate_table_html(s
-00019bb0: 656c 662e 5f67 656e 6572 6174 655f 7461  elf._generate_ta
-00019bc0: 626c 655f 726f 7773 2874 312c 2074 3229  ble_rows(t1, t2)
-00019bd0: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
-00019be0: 7461 626c 655f 656c 656d 656e 742e 696e  table_element.in
-00019bf0: 6e65 7248 544d 4c20 3d20 6874 6d6c 0a0a  nerHTML = html..
-00019c00: 2020 2020 2020 2020 2320 436f 6e66 6967          # Config
-00019c10: 7572 6520 7468 6520 7461 626c 6520 2e2e  ure the table ..
-00019c20: 2e0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-00019c30: 662e 5f73 686f 7772 6563 6f72 6473 5f62  f._showrecords_b
-00019c40: 7574 2e63 6865 636b 6564 3a0a 2020 2020  ut.checked:.    
-00019c50: 2020 2020 2020 2020 7365 6c66 2e5f 7461          self._ta
-00019c60: 626c 655f 656c 656d 656e 742e 636c 6173  ble_element.clas
-00019c70: 734c 6973 742e 6164 6428 2264 6172 6b68  sList.add("darkh
-00019c80: 6561 6465 7273 2229 0a20 2020 2020 2020  eaders").       
-00019c90: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00019ca0: 2020 2073 656c 662e 5f74 6162 6c65 5f65     self._table_e
-00019cb0: 6c65 6d65 6e74 2e63 6c61 7373 4c69 7374  lement.classList
-00019cc0: 2e72 656d 6f76 6528 2264 6172 6b68 6561  .remove("darkhea
-00019cd0: 6465 7273 2229 0a0a 2020 2020 2020 2020  ders")..        
-00019ce0: 2320 416c 736f 2061 7070 6c79 2069 6e20  # Also apply in 
-00019cf0: 7468 6520 6170 7020 6974 7365 6c66 210a  the app itself!.
-00019d00: 2020 2020 2020 2020 7769 6e64 6f77 2e63          window.c
-00019d10: 616e 7661 732e 7261 6e67 652e 616e 696d  anvas.range.anim
-00019d20: 6174 655f 7261 6e67 6528 7431 2c20 7432  ate_range(t1, t2
-00019d30: 2c20 4e6f 6e65 2c20 4661 6c73 6529 2020  , None, False)  
-00019d40: 2320 7769 7468 6f75 7420 736e 6170 0a0a  # without snap..
-00019d50: 2020 2020 6465 6620 5f67 656e 6572 6174      def _generat
-00019d60: 655f 7461 626c 655f 726f 7773 2873 656c  e_table_rows(sel
-00019d70: 662c 2074 312c 2074 3229 3a0a 2020 2020  f, t1, t2):.    
-00019d80: 2020 2020 7368 6f77 7265 636f 7264 7320      showrecords 
-00019d90: 3d20 7365 6c66 2e5f 7368 6f77 7265 636f  = self._showreco
-00019da0: 7264 735f 6275 742e 6368 6563 6b65 640a  rds_but.checked.
-00019db0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00019dc0: 2e5f 686f 7572 6465 6369 6d61 6c73 5f62  ._hourdecimals_b
-00019dd0: 7574 2e63 6865 636b 6564 3a0a 2020 2020  ut.checked:.    
-00019de0: 2020 2020 2020 2020 6475 7261 7469 6f6e          duration
-00019df0: 3273 7472 203d 206c 616d 6264 6120 743a  2str = lambda t:
-00019e00: 2066 227b 7420 2f20 3336 3030 3a30 2e32   f"{t / 3600:0.2
-00019e10: 667d 220a 2020 2020 2020 2020 656c 7365  f}".        else
-00019e20: 3a0a 2020 2020 2020 2020 2020 2020 6475  :.            du
-00019e30: 7261 7469 6f6e 3273 7472 203d 206c 616d  ration2str = lam
-00019e40: 6264 6120 743a 2064 742e 6475 7261 7469  bda t: dt.durati
-00019e50: 6f6e 5f73 7472 696e 675f 636f 6c6f 6e28  on_string_colon(
-00019e60: 742c 2046 616c 7365 290a 0a20 2020 2020  t, False)..     
-00019e70: 2020 2023 2047 6574 2073 7461 7473 2061     # Get stats a
-00019e80: 6e64 2073 6f72 7465 6420 7265 636f 7264  nd sorted record
-00019e90: 732c 2074 6869 7320 616c 7265 6164 7920  s, this already 
-00019ea0: 6578 636c 7564 6573 2068 6964 6465 6e20  excludes hidden 
-00019eb0: 7265 636f 7264 730a 2020 2020 2020 2020  records.        
-00019ec0: 7374 6174 7320 3d20 7769 6e64 6f77 2e73  stats = window.s
-00019ed0: 746f 7265 2e72 6563 6f72 6473 2e67 6574  tore.records.get
-00019ee0: 5f73 7461 7473 2874 312c 2074 3229 2e63  _stats(t1, t2).c
-00019ef0: 6f70 7928 290a 2020 2020 2020 2020 7265  opy().        re
-00019f00: 636f 7264 7320 3d20 7769 6e64 6f77 2e73  cords = window.s
-00019f10: 746f 7265 2e72 6563 6f72 6473 2e67 6574  tore.records.get
-00019f20: 5f72 6563 6f72 6473 2874 312c 2074 3229  _records(t1, t2)
-00019f30: 2e76 616c 7565 7328 290a 2020 2020 2020  .values().      
-00019f40: 2020 7265 636f 7264 732e 736f 7274 286b    records.sort(k
-00019f50: 6579 3d6c 616d 6264 6120 7265 636f 7264  ey=lambda record
-00019f60: 3a20 7265 636f 7264 2e74 3129 0a0a 2020  : record.t1)..  
-00019f70: 2020 2020 2020 2320 4465 7465 726d 696e        # Determin
-00019f80: 6520 7072 696f 7269 7469 6573 0a20 2020  e priorities.   
-00019f90: 2020 2020 2070 7269 6f72 6974 6965 7320       priorities 
-00019fa0: 3d20 7b7d 0a20 2020 2020 2020 2066 6f72  = {}.        for
-00019fb0: 2074 6167 7a20 696e 2073 7461 7473 2e6b   tagz in stats.k
-00019fc0: 6579 7328 293a 0a20 2020 2020 2020 2020  eys():.         
-00019fd0: 2020 2074 6167 7320 3d20 7461 677a 2e73     tags = tagz.s
-00019fe0: 706c 6974 2822 2022 290a 2020 2020 2020  plit(" ").      
-00019ff0: 2020 2020 2020 666f 7220 7461 6720 696e        for tag in
-0001a000: 2074 6167 733a 0a20 2020 2020 2020 2020   tags:.         
-0001a010: 2020 2020 2020 2069 6e66 6f20 3d20 7769         info = wi
-0001a020: 6e64 6f77 2e73 746f 7265 2e73 6574 7469  ndow.store.setti
-0001a030: 6e67 732e 6765 745f 7461 675f 696e 666f  ngs.get_tag_info
-0001a040: 2874 6167 290a 2020 2020 2020 2020 2020  (tag).          
-0001a050: 2020 2020 2020 7072 696f 7269 7469 6573        priorities
-0001a060: 5b74 6167 5d20 3d20 696e 666f 2e67 6574  [tag] = info.get
-0001a070: 2822 7072 696f 7269 7479 222c 2030 2920  ("priority", 0) 
-0001a080: 6f72 2031 0a0a 2020 2020 2020 2020 2320  or 1..        # 
-0001a090: 4765 7420 6265 7474 6572 206e 616d 6573  Get better names
-0001a0a0: 0a20 2020 2020 2020 206e 616d 655f 6d61  .        name_ma
-0001a0b0: 7020 3d20 7574 696c 732e 6765 745f 6265  p = utils.get_be
-0001a0c0: 7474 6572 5f74 6167 5f6f 7264 6572 5f66  tter_tag_order_f
-0001a0d0: 726f 6d5f 7374 6174 7328 0a20 2020 2020  rom_stats(.     
-0001a0e0: 2020 2020 2020 2073 7461 7473 2c20 7365         stats, se
-0001a0f0: 6c66 2e5f 7461 6773 2c20 5472 7565 2c20  lf._tags, True, 
-0001a100: 7072 696f 7269 7469 6573 0a20 2020 2020  priorities.     
-0001a110: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
-0001a120: 4869 6465 2073 6563 6f6e 6461 7279 2074  Hide secondary t
-0001a130: 6167 7320 6279 2072 656d 6f76 696e 6720  ags by removing 
-0001a140: 7468 656d 2066 726f 6d20 7468 6520 6d61  them from the ma
-0001a150: 7070 696e 672e 0a20 2020 2020 2020 2023  pping..        #
-0001a160: 204e 6f74 6520 7468 6174 2074 6869 7320   Note that this 
-0001a170: 6d65 616e 7320 7468 6174 2064 6966 6665  means that diffe
-0001a180: 7265 6e74 206b 6579 7320 6e6f 7720 6d61  rent keys now ma
-0001a190: 7020 746f 2074 6865 2073 616d 6520 7661  p to the same va
-0001a1a0: 6c75 652e 0a20 2020 2020 2020 2069 6620  lue..        if 
-0001a1b0: 7365 6c66 2e5f 6869 6465 7365 636f 6e64  self._hidesecond
-0001a1c0: 6172 795f 6275 742e 6368 6563 6b65 643a  ary_but.checked:
-0001a1d0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0001a1e0: 2074 6167 7a31 2c20 7461 677a 3220 696e   tagz1, tagz2 in
-0001a1f0: 206e 616d 655f 6d61 702e 6974 656d 7328   name_map.items(
-0001a200: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0001a210: 2020 2074 6167 7320 3d20 7461 677a 322e     tags = tagz2.
-0001a220: 7370 6c69 7428 2220 2229 0a20 2020 2020  split(" ").     
-0001a230: 2020 2020 2020 2020 2020 2074 6167 7320             tags 
-0001a240: 3d20 5b74 6167 2066 6f72 2074 6167 2069  = [tag for tag i
-0001a250: 6e20 7461 6773 2069 6620 7072 696f 7269  n tags if priori
-0001a260: 7469 6573 5b74 6167 5d20 3c3d 2031 5d0a  ties[tag] <= 1].
-0001a270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a280: 7461 677a 3220 3d20 7461 6773 2e6a 6f69  tagz2 = tags.joi
-0001a290: 6e28 2220 2229 0a20 2020 2020 2020 2020  n(" ").         
-0001a2a0: 2020 2020 2020 206e 616d 655f 6d61 705b         name_map[
-0001a2b0: 7461 677a 315d 203d 2074 6167 7a32 0a0a  tagz1] = tagz2..
-0001a2c0: 2020 2020 2020 2020 2320 4372 6561 7465          # Create
-0001a2d0: 206c 6973 7420 6f66 2070 6169 7273 206f   list of pairs o
-0001a2e0: 6620 7374 6174 2d6e 616d 652c 2073 7461  f stat-name, sta
-0001a2f0: 742d 6b65 792c 2061 6e64 2073 6f72 742e  t-key, and sort.
-0001a300: 0a20 2020 2020 2020 2023 2054 6869 7320  .        # This 
-0001a310: 6973 2074 6865 2072 6566 6572 656e 6365  is the reference
-0001a320: 206f 7264 6572 2066 6f72 2074 6167 7a2e   order for tagz.
-0001a330: 0a20 2020 2020 2020 2073 7461 746f 626a  .        statobj
-0001a340: 6563 7473 203d 207b 7d0a 2020 2020 2020  ects = {}.      
-0001a350: 2020 666f 7220 7461 677a 312c 2074 6167    for tagz1, tag
-0001a360: 7a32 2069 6e20 6e61 6d65 5f6d 6170 2e69  z2 in name_map.i
-0001a370: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
-0001a380: 2020 2020 7420 3d20 7374 6174 6f62 6a65      t = statobje
-0001a390: 6374 732e 6765 7428 7461 677a 322c 207b  cts.get(tagz2, {
-0001a3a0: 7d29 2e67 6574 2822 7422 2c20 3029 202b  }).get("t", 0) +
-0001a3b0: 2073 7461 7473 5b74 6167 7a31 5d0a 2020   stats[tagz1].  
-0001a3c0: 2020 2020 2020 2020 2020 7374 6174 6f62            statob
-0001a3d0: 6a65 6374 735b 7461 677a 325d 203d 207b  jects[tagz2] = {
-0001a3e0: 2274 6167 7a22 3a20 7461 677a 322c 2022  "tagz": tagz2, "
-0001a3f0: 7422 3a20 747d 0a20 2020 2020 2020 2073  t": t}.        s
-0001a400: 7461 746f 626a 6563 7473 203d 2073 7461  tatobjects = sta
-0001a410: 746f 626a 6563 7473 2e76 616c 7565 7328  tobjects.values(
-0001a420: 290a 2020 2020 2020 2020 7574 696c 732e  ).        utils.
-0001a430: 6f72 6465 725f 7374 6174 735f 6279 5f64  order_stats_by_d
-0001a440: 7572 6174 696f 6e5f 616e 645f 6e61 6d65  uration_and_name
-0001a450: 2873 7461 746f 626a 6563 7473 290a 0a20  (statobjects).. 
-0001a460: 2020 2020 2020 2023 2047 6574 2068 6f77         # Get how
-0001a470: 2074 6f20 6772 6f75 7020 7468 6520 7265   to group the re
-0001a480: 636f 7264 730a 2020 2020 2020 2020 6772  cords.        gr
-0001a490: 6f75 705f 6d65 7468 6f64 203d 2073 656c  oup_method = sel
-0001a4a0: 662e 5f67 726f 7570 696e 675f 7365 6c65  f._grouping_sele
-0001a4b0: 6374 2e76 616c 7565 0a20 2020 2020 2020  ct.value.       
-0001a4c0: 2067 726f 7570 5f70 6572 696f 6420 3d20   group_period = 
-0001a4d0: 7365 6c66 2e5f 6772 6f75 7070 6572 696f  self._groupperio
-0001a4e0: 645f 7365 6c65 6374 2e76 616c 7565 0a20  d_select.value. 
-0001a4f0: 2020 2020 2020 2065 6d70 7479 5f74 6974         empty_tit
-0001a500: 6c65 203d 2022 4765 6e65 7261 6c22 0a0a  le = "General"..
-0001a510: 2020 2020 2020 2020 2320 5065 7266 6f72          # Perfor
-0001a520: 6d20 7072 696d 6172 7920 6772 6f75 7069  m primary groupi
-0001a530: 6e67 202e 2e2e 0a20 2020 2020 2020 2069  ng ....        i
-0001a540: 6620 6772 6f75 705f 6d65 7468 6f64 203d  f group_method =
-0001a550: 3d20 2274 6167 7a22 3a0a 2020 2020 2020  = "tagz":.      
-0001a560: 2020 2020 2020 6772 6f75 7073 203d 207b        groups = {
-0001a570: 7d0a 2020 2020 2020 2020 2020 2020 666f  }.            fo
-0001a580: 7220 6f62 6a20 696e 2073 7461 746f 626a  r obj in statobj
-0001a590: 6563 7473 3a0a 2020 2020 2020 2020 2020  ects:.          
-0001a5a0: 2020 2020 2020 6772 6f75 7073 5b6f 626a        groups[obj
-0001a5b0: 2e74 6167 7a5d 203d 207b 0a20 2020 2020  .tagz] = {.     
-0001a5c0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0001a5d0: 7469 746c 6522 3a20 6f62 6a2e 7461 677a  title": obj.tagz
-0001a5e0: 206f 7220 656d 7074 795f 7469 746c 652c   or empty_title,
-0001a5f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a600: 2020 2020 2022 7422 3a20 302c 0a20 2020       "t": 0,.   
-0001a610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a620: 2022 7265 636f 7264 7322 3a20 5b5d 2c0a   "records": [],.
-0001a630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a640: 7d0a 2020 2020 2020 2020 2020 2020 666f  }.            fo
-0001a650: 7220 6920 696e 2072 616e 6765 286c 656e  r i in range(len
-0001a660: 2872 6563 6f72 6473 2929 3a0a 2020 2020  (records)):.    
-0001a670: 2020 2020 2020 2020 2020 2020 7265 636f              reco
-0001a680: 7264 203d 2072 6563 6f72 6473 5b69 5d0a  rd = records[i].
-0001a690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a6a0: 7461 677a 3120 3d20 7769 6e64 6f77 2e73  tagz1 = window.s
-0001a6b0: 746f 7265 2e72 6563 6f72 6473 2e74 6167  tore.records.tag
-0001a6c0: 735f 6672 6f6d 5f72 6563 6f72 6428 7265  s_from_record(re
-0001a6d0: 636f 7264 292e 6a6f 696e 2822 2022 290a  cord).join(" ").
-0001a6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a6f0: 6966 2074 6167 7a31 206e 6f74 2069 6e20  if tagz1 not in 
-0001a700: 6e61 6d65 5f6d 6170 3a0a 2020 2020 2020  name_map:.      
-0001a710: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0001a720: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
-0001a730: 2020 2020 2020 2074 6167 7a32 203d 206e         tagz2 = n
-0001a740: 616d 655f 6d61 705b 7461 677a 315d 0a20  ame_map[tagz1]. 
-0001a750: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-0001a760: 726f 7570 203d 2067 726f 7570 735b 7461  roup = groups[ta
-0001a770: 677a 325d 0a20 2020 2020 2020 2020 2020  gz2].           
-0001a780: 2020 2020 2067 726f 7570 2e72 6563 6f72       group.recor
-0001a790: 6473 2e70 7573 6828 7265 636f 7264 290a  ds.push(record).
-0001a7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a7b0: 6772 6f75 702e 7420 2b3d 2072 6563 6f72  group.t += recor
-0001a7c0: 642e 7432 202d 2072 6563 6f72 642e 7431  d.t2 - record.t1
-0001a7d0: 0a20 2020 2020 2020 2020 2020 2067 726f  .            gro
-0001a7e0: 7570 5f6c 6973 7431 203d 2067 726f 7570  up_list1 = group
-0001a7f0: 732e 7661 6c75 6573 2829 0a0a 2020 2020  s.values()..    
-0001a800: 2020 2020 656c 6966 2067 726f 7570 5f6d      elif group_m
-0001a810: 6574 686f 6420 3d3d 2022 6473 223a 0a20  ethod == "ds":. 
-0001a820: 2020 2020 2020 2020 2020 2067 726f 7570             group
-0001a830: 7320 3d20 7b7d 0a20 2020 2020 2020 2020  s = {}.         
-0001a840: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-0001a850: 6528 6c65 6e28 7265 636f 7264 7329 293a  e(len(records)):
-0001a860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a870: 2072 6563 6f72 6420 3d20 7265 636f 7264   record = record
-0001a880: 735b 695d 0a20 2020 2020 2020 2020 2020  s[i].           
-0001a890: 2020 2020 2074 6167 7a31 203d 2077 696e       tagz1 = win
-0001a8a0: 646f 772e 7374 6f72 652e 7265 636f 7264  dow.store.record
-0001a8b0: 732e 7461 6773 5f66 726f 6d5f 7265 636f  s.tags_from_reco
-0001a8c0: 7264 2872 6563 6f72 6429 2e6a 6f69 6e28  rd(record).join(
-0001a8d0: 2220 2229 0a20 2020 2020 2020 2020 2020  " ").           
-0001a8e0: 2020 2020 2069 6620 7461 677a 3120 6e6f       if tagz1 no
-0001a8f0: 7420 696e 206e 616d 655f 6d61 703a 0a20  t in name_map:. 
-0001a900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a910: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
-0001a920: 2020 2020 2020 2020 2020 2020 6473 203d              ds =
-0001a930: 2072 6563 6f72 642e 6473 0a20 2020 2020   record.ds.     
-0001a940: 2020 2020 2020 2020 2020 2069 6620 6473             if ds
-0001a950: 206e 6f74 2069 6e20 6772 6f75 7073 3a0a   not in groups:.
-0001a960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a970: 2020 2020 6772 6f75 7073 5b64 735d 203d      groups[ds] =
-0001a980: 207b 2274 6974 6c65 223a 2064 732c 2022   {"title": ds, "
-0001a990: 7422 3a20 302c 2022 7265 636f 7264 7322  t": 0, "records"
-0001a9a0: 3a20 5b5d 7d0a 2020 2020 2020 2020 2020  : []}.          
-0001a9b0: 2020 2020 2020 6772 6f75 7020 3d20 6772        group = gr
-0001a9c0: 6f75 7073 5b64 735d 0a20 2020 2020 2020  oups[ds].       
-0001a9d0: 2020 2020 2020 2020 2067 726f 7570 2e72           group.r
-0001a9e0: 6563 6f72 6473 2e70 7573 6828 7265 636f  ecords.push(reco
-0001a9f0: 7264 290a 2020 2020 2020 2020 2020 2020  rd).            
-0001aa00: 2020 2020 6772 6f75 702e 7420 2b3d 2072      group.t += r
-0001aa10: 6563 6f72 642e 7432 202d 2072 6563 6f72  ecord.t2 - recor
-0001aa20: 642e 7431 0a20 2020 2020 2020 2020 2020  d.t1.           
-0001aa30: 2067 726f 7570 5f6c 6973 7431 203d 2067   group_list1 = g
-0001aa40: 726f 7570 732e 7661 6c75 6573 2829 0a20  roups.values(). 
-0001aa50: 2020 2020 2020 2020 2020 2067 726f 7570             group
-0001aa60: 5f6c 6973 7431 2e73 6f72 7428 6b65 793d  _list1.sort(key=
-0001aa70: 6c61 6d62 6461 2078 3a20 782e 7469 746c  lambda x: x.titl
-0001aa80: 652e 6c6f 7765 7228 2929 0a0a 2020 2020  e.lower())..    
-0001aa90: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001aaa0: 2020 2020 2020 6772 6f75 7020 3d20 7b22        group = {"
-0001aab0: 7469 746c 6522 3a20 2268 6964 6465 6e22  title": "hidden"
-0001aac0: 2c20 2274 223a 2030 2c20 2272 6563 6f72  , "t": 0, "recor
-0001aad0: 6473 223a 205b 5d7d 0a20 2020 2020 2020  ds": []}.       
-0001aae0: 2020 2020 2067 726f 7570 5f6c 6973 7431       group_list1
-0001aaf0: 203d 205b 6772 6f75 705d 0a20 2020 2020   = [group].     
-0001ab00: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-0001ab10: 7261 6e67 6528 6c65 6e28 7265 636f 7264  range(len(record
-0001ab20: 7329 293a 0a20 2020 2020 2020 2020 2020  s)):.           
-0001ab30: 2020 2020 2072 6563 6f72 6420 3d20 7265       record = re
-0001ab40: 636f 7264 735b 695d 0a20 2020 2020 2020  cords[i].       
-0001ab50: 2020 2020 2020 2020 2074 6167 7a31 203d           tagz1 =
-0001ab60: 2077 696e 646f 772e 7374 6f72 652e 7265   window.store.re
-0001ab70: 636f 7264 732e 7461 6773 5f66 726f 6d5f  cords.tags_from_
-0001ab80: 7265 636f 7264 2872 6563 6f72 6429 2e6a  record(record).j
-0001ab90: 6f69 6e28 2220 2229 0a20 2020 2020 2020  oin(" ").       
-0001aba0: 2020 2020 2020 2020 2069 6620 7461 677a           if tagz
-0001abb0: 3120 6e6f 7420 696e 206e 616d 655f 6d61  1 not in name_ma
-0001abc0: 703a 0a20 2020 2020 2020 2020 2020 2020  p:.             
-0001abd0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-0001abe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001abf0: 6772 6f75 702e 7265 636f 7264 732e 7075  group.records.pu
-0001ac00: 7368 2872 6563 6f72 6429 0a0a 2020 2020  sh(record)..    
-0001ac10: 2020 2020 2320 5065 7266 6f72 6d20 6772      # Perform gr
-0001ac20: 6f75 7069 6e67 2066 6f72 2074 696d 6520  ouping for time 
-0001ac30: 2e2e 2e0a 2020 2020 2020 2020 6966 2067  ....        if g
-0001ac40: 726f 7570 5f70 6572 696f 6420 3d3d 2022  roup_period == "
-0001ac50: 6e6f 6e65 223a 0a20 2020 2020 2020 2020  none":.         
-0001ac60: 2020 2067 726f 7570 5f6c 6973 7432 203d     group_list2 =
-0001ac70: 2067 726f 7570 5f6c 6973 7431 0a20 2020   group_list1.   
-0001ac80: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0001ac90: 2020 2020 2020 2067 726f 7570 7320 3d20         groups = 
-0001aca0: 7b7d 0a20 2020 2020 2020 2020 2020 2066  {}.            f
-0001acb0: 6f72 2067 726f 7570 5f69 6e64 6578 2069  or group_index i
-0001acc0: 6e20 7261 6e67 6528 6c65 6e28 6772 6f75  n range(len(grou
-0001acd0: 705f 6c69 7374 3129 293a 0a20 2020 2020  p_list1)):.     
-0001ace0: 2020 2020 2020 2020 2020 2067 726f 7570             group
-0001acf0: 5f74 6974 6c65 203d 2067 726f 7570 5f6c  _title = group_l
-0001ad00: 6973 7431 5b67 726f 7570 5f69 6e64 6578  ist1[group_index
-0001ad10: 5d2e 7469 746c 650a 2020 2020 2020 2020  ].title.        
-0001ad20: 2020 2020 2020 2020 666f 7220 7265 636f          for reco
-0001ad30: 7264 2069 6e20 6772 6f75 705f 6c69 7374  rd in group_list
-0001ad40: 315b 6772 6f75 705f 696e 6465 785d 2e72  1[group_index].r
-0001ad50: 6563 6f72 6473 3a0a 2020 2020 2020 2020  ecords:.        
-0001ad60: 2020 2020 2020 2020 2020 2020 2320 4765              # Ge
-0001ad70: 7420 7065 7269 6f64 2073 7472 696e 670a  t period string.
-0001ad80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad90: 2020 2020 6461 7465 203d 2064 742e 7469      date = dt.ti
-0001ada0: 6d65 326c 6f63 616c 7374 7228 7265 636f  me2localstr(reco
-0001adb0: 7264 2e74 3129 2e73 706c 6974 2822 2022  rd.t1).split(" "
-0001adc0: 295b 305d 0a20 2020 2020 2020 2020 2020  )[0].           
-0001add0: 2020 2020 2020 2020 2079 6561 7220 3d20           year = 
-0001ade0: 696e 7428 6461 7465 2e73 706c 6974 2822  int(date.split("
-0001adf0: 2d22 295b 305d 290a 2020 2020 2020 2020  -")[0]).        
-0001ae00: 2020 2020 2020 2020 2020 2020 6966 2067              if g
-0001ae10: 726f 7570 5f70 6572 696f 6420 3d3d 2022  roup_period == "
-0001ae20: 6461 7922 3a0a 2020 2020 2020 2020 2020  day":.          
-0001ae30: 2020 2020 2020 2020 2020 2020 2020 7065                pe
-0001ae40: 7269 6f64 203d 2022 2d22 2e6a 6f69 6e28  riod = "-".join(
-0001ae50: 7265 7665 7273 6564 2864 6174 652e 7370  reversed(date.sp
-0001ae60: 6c69 7428 222d 2229 2929 0a20 2020 2020  lit("-"))).     
-0001ae70: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0001ae80: 6c69 6620 6772 6f75 705f 7065 7269 6f64  lif group_period
-0001ae90: 203d 3d20 2277 6565 6b22 3a0a 2020 2020   == "week":.    
-0001aea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aeb0: 2020 2020 7765 656b 203d 2064 742e 6765      week = dt.ge
-0001aec0: 745f 7765 656b 6e75 6d62 6572 2872 6563  t_weeknumber(rec
-0001aed0: 6f72 642e 7431 290a 2020 2020 2020 2020  ord.t1).        
-0001aee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aef0: 7065 7269 6f64 203d 2066 227b 7965 6172  period = f"{year
-0001af00: 7d57 7b77 6565 6b7d 220a 2020 2020 2020  }W{week}".      
-0001af10: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0001af20: 6966 2067 726f 7570 5f70 6572 696f 6420  if group_period 
-0001af30: 3d3d 2022 6d6f 6e74 6822 3a0a 2020 2020  == "month":.    
-0001af40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001af50: 2020 2020 6d6f 6e74 6820 3d20 696e 7428      month = int(
-0001af60: 6461 7465 2e73 706c 6974 2822 2d22 295b  date.split("-")[
-0001af70: 315d 290a 2020 2020 2020 2020 2020 2020  1]).            
-0001af80: 2020 2020 2020 2020 2020 2020 7065 7269              peri
-0001af90: 6f64 203d 2064 742e 4d4f 4e54 4853 5f53  od = dt.MONTHS_S
-0001afa0: 484f 5254 5b6d 6f6e 7468 202d 2031 5d20  HORT[month - 1] 
-0001afb0: 2b20 6622 207b 7965 6172 7d22 0a20 2020  + f" {year}".   
-0001afc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001afd0: 2065 6c69 6620 6772 6f75 705f 7065 7269   elif group_peri
-0001afe0: 6f64 203d 3d20 2271 7561 7274 6572 223a  od == "quarter":
-0001aff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b000: 2020 2020 2020 2020 206d 6f6e 7468 203d           month =
-0001b010: 2069 6e74 2864 6174 652e 7370 6c69 7428   int(date.split(
-0001b020: 222d 2229 5b31 5d29 0a20 2020 2020 2020  "-")[1]).       
-0001b030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b040: 2071 203d 2022 3131 3132 3232 3333 3334   q = "1112223334
-0001b050: 3434 225b 6d6f 6e74 6820 2d20 315d 0a20  44"[month - 1]. 
-0001b060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b070: 2020 2020 2020 2070 6572 696f 6420 3d20         period = 
-0001b080: 6622 7b79 6561 727d 517b 717d 220a 2020  f"{year}Q{q}".  
-0001b090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b0a0: 2020 656c 6966 2067 726f 7570 5f70 6572    elif group_per
-0001b0b0: 696f 6420 3d3d 2022 7965 6172 223a 0a20  iod == "year":. 
-0001b0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b0d0: 2020 2020 2020 2070 6572 696f 6420 3d20         period = 
-0001b0e0: 6622 7b79 6561 727d 220a 2020 2020 2020  f"{year}".      
-0001b0f0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0001b100: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0001b110: 2020 2020 2020 2020 2020 2020 7065 7269              peri
-0001b120: 6f64 203d 2064 6174 6520 2023 2066 616c  od = date  # fal
-0001b130: 6c62 6163 6b0a 2020 2020 2020 2020 2020  lback.          
-0001b140: 2020 2020 2020 2020 2020 2320 4e65 7720            # New 
-0001b150: 7469 746c 650a 2020 2020 2020 2020 2020  title.          
-0001b160: 2020 2020 2020 2020 2020 2320 4e6f 7465            # Note
-0001b170: 3a20 6361 6e20 7475 726e 2061 726f 756e  : can turn aroun
-0001b180: 6420 7469 746c 6520 616e 6420 736f 7274  d title and sort
-0001b190: 6b65 7920 746f 206d 616b 6520 7468 6520  key to make the 
-0001b1a0: 7065 7269 6f64 2074 6865 2073 6563 6f6e  period the secon
-0001b1b0: 6461 7279 2067 726f 7570 0a20 2020 2020  dary group.     
-0001b1c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001b1d0: 6620 6772 6f75 705f 7469 746c 6520 3d3d  f group_title ==
-0001b1e0: 2022 6869 6464 656e 223a 0a20 2020 2020   "hidden":.     
-0001b1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b200: 2020 2074 6974 6c65 203d 2070 6572 696f     title = perio
-0001b210: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
-0001b220: 2020 2020 2020 2020 2020 736f 7274 6b65            sortke
-0001b230: 7920 3d20 6461 7465 0a20 2020 2020 2020  y = date.       
-0001b240: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0001b250: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001b260: 2020 2020 2020 2020 2020 2074 6974 6c65             title
-0001b270: 203d 2070 6572 696f 6420 2b20 2220 2f20   = period + " / 
-0001b280: 2220 2b20 6772 6f75 705f 7469 746c 650a  " + group_title.
-0001b290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b2a0: 2020 2020 2020 2020 736f 7274 6b65 7920          sortkey 
-0001b2b0: 3d20 6461 7465 202b 2073 7472 2831 3030  = date + str(100
-0001b2c0: 3030 3030 202b 2067 726f 7570 5f69 6e64  0000 + group_ind
-0001b2d0: 6578 290a 2020 2020 2020 2020 2020 2020  ex).            
-0001b2e0: 2020 2020 2020 2020 6966 2074 6974 6c65          if title
-0001b2f0: 206e 6f74 2069 6e20 6772 6f75 7073 3a0a   not in groups:.
-0001b300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b310: 2020 2020 2020 2020 6772 6f75 7073 5b74          groups[t
-0001b320: 6974 6c65 5d20 3d20 7b0a 2020 2020 2020  itle] = {.      
-0001b330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b340: 2020 2020 2020 2274 6974 6c65 223a 2074        "title": t
-0001b350: 6974 6c65 2c0a 2020 2020 2020 2020 2020  itle,.          
-0001b360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b370: 2020 2274 223a 2030 2c0a 2020 2020 2020    "t": 0,.      
-0001b380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b390: 2020 2020 2020 2272 6563 6f72 6473 223a        "records":
-0001b3a0: 205b 5d2c 0a20 2020 2020 2020 2020 2020   [],.           
-0001b3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b3c0: 2022 736f 7274 6b65 7922 3a20 736f 7274   "sortkey": sort
-0001b3d0: 6b65 792c 0a20 2020 2020 2020 2020 2020  key,.           
-0001b3e0: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
-0001b3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b400: 2020 2023 2041 7070 656e 640a 2020 2020     # Append.    
-0001b410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b420: 6772 6f75 7020 3d20 6772 6f75 7073 5b74  group = groups[t
-0001b430: 6974 6c65 5d0a 2020 2020 2020 2020 2020  itle].          
-0001b440: 2020 2020 2020 2020 2020 6772 6f75 702e            group.
-0001b450: 7265 636f 7264 732e 7075 7368 2872 6563  records.push(rec
-0001b460: 6f72 6429 0a20 2020 2020 2020 2020 2020  ord).           
-0001b470: 2020 2020 2020 2020 2067 726f 7570 2e74           group.t
-0001b480: 202b 3d20 7265 636f 7264 2e74 3220 2d20   += record.t2 - 
-0001b490: 7265 636f 7264 2e74 310a 0a20 2020 2020  record.t1..     
-0001b4a0: 2020 2020 2020 2023 2047 6574 206e 6577         # Get new
-0001b4b0: 2067 726f 7570 732c 2073 6f72 7465 6420   groups, sorted 
-0001b4c0: 6279 2070 6572 696f 640a 2020 2020 2020  by period.      
-0001b4d0: 2020 2020 2020 6772 6f75 705f 6c69 7374        group_list
-0001b4e0: 3220 3d20 6772 6f75 7073 2e76 616c 7565  2 = groups.value
-0001b4f0: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
-0001b500: 6772 6f75 705f 6c69 7374 322e 736f 7274  group_list2.sort
-0001b510: 286b 6579 3d6c 616d 6264 6120 783a 2078  (key=lambda x: x
-0001b520: 2e73 6f72 746b 6579 290a 0a20 2020 2020  .sortkey)..     
-0001b530: 2020 2023 2047 656e 6572 6174 6520 726f     # Generate ro
-0001b540: 7773 0a20 2020 2020 2020 2072 6f77 7320  ws.        rows 
-0001b550: 3d20 5b5d 0a0a 2020 2020 2020 2020 2320  = []..        # 
-0001b560: 496e 636c 7564 6520 746f 7461 6c0a 2020  Include total.  
-0001b570: 2020 2020 2020 746f 7461 6c20 3d20 300a        total = 0.
-0001b580: 2020 2020 2020 2020 666f 7220 7461 677a          for tagz
-0001b590: 2069 6e20 6e61 6d65 5f6d 6170 2e6b 6579   in name_map.key
-0001b5a0: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-0001b5b0: 2074 6f74 616c 202b 3d20 7374 6174 735b   total += stats[
-0001b5c0: 7461 677a 5d0a 2020 2020 2020 2020 726f  tagz].        ro
-0001b5d0: 7773 2e61 7070 656e 6428 5b22 6865 6164  ws.append(["head
-0001b5e0: 222c 2064 7572 6174 696f 6e32 7374 7228  ", duration2str(
-0001b5f0: 746f 7461 6c29 2c20 2254 6f74 616c 222c  total), "Total",
-0001b600: 2030 5d29 0a0a 2020 2020 2020 2020 666f   0])..        fo
-0001b610: 7220 6772 6f75 7020 696e 2067 726f 7570  r group in group
-0001b620: 5f6c 6973 7432 3a0a 2020 2020 2020 2020  _list2:.        
-0001b630: 2020 2020 2320 4164 6420 726f 7720 666f      # Add row fo
-0001b640: 7220 746f 7461 6c20 6f66 2074 6869 7320  r total of this 
-0001b650: 7461 6720 636f 6d62 690a 2020 2020 2020  tag combi.      
-0001b660: 2020 2020 2020 6475 7261 7469 6f6e 203d        duration =
-0001b670: 2064 7572 6174 696f 6e32 7374 7228 6772   duration2str(gr
-0001b680: 6f75 702e 7429 0a20 2020 2020 2020 2020  oup.t).         
-0001b690: 2020 2070 6164 203d 2031 0a20 2020 2020     pad = 1.     
-0001b6a0: 2020 2020 2020 2069 6620 7368 6f77 7265         if showre
-0001b6b0: 636f 7264 733a 0a20 2020 2020 2020 2020  cords:.         
-0001b6c0: 2020 2020 2020 2072 6f77 732e 6170 7065         rows.appe
-0001b6d0: 6e64 285b 2262 6c61 6e6b 225d 290a 2020  nd(["blank"]).  
-0001b6e0: 2020 2020 2020 2020 2020 6966 2067 726f            if gro
-0001b6f0: 7570 2e74 6974 6c65 2021 3d20 2268 6964  up.title != "hid
-0001b700: 6465 6e22 3a0a 2020 2020 2020 2020 2020  den":.          
-0001b710: 2020 2020 2020 726f 7773 2e61 7070 656e        rows.appen
-0001b720: 6428 5b22 6865 6164 222c 2064 7572 6174  d(["head", durat
-0001b730: 696f 6e2c 2067 726f 7570 2e74 6974 6c65  ion, group.title
-0001b740: 2c20 7061 645d 290a 0a20 2020 2020 2020  , pad])..       
-0001b750: 2020 2020 2023 2041 6464 2072 6f77 2066       # Add row f
-0001b760: 6f72 2065 6163 6820 7265 636f 7264 0a20  or each record. 
-0001b770: 2020 2020 2020 2020 2020 2069 6620 7368             if sh
-0001b780: 6f77 7265 636f 7264 733a 0a20 2020 2020  owrecords:.     
-0001b790: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
-0001b7a0: 6473 203d 2067 726f 7570 2e72 6563 6f72  ds = group.recor
-0001b7b0: 6473 0a20 2020 2020 2020 2020 2020 2020  ds.             
-0001b7c0: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-0001b7d0: 6528 6c65 6e28 7265 636f 7264 7329 293a  e(len(records)):
-0001b7e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b7f0: 2020 2020 2072 6563 6f72 6420 3d20 7265       record = re
-0001b800: 636f 7264 735b 695d 0a20 2020 2020 2020  cords[i].       
-0001b810: 2020 2020 2020 2020 2020 2020 2073 6431               sd1
-0001b820: 2c20 7374 3120 3d20 6474 2e74 696d 6532  , st1 = dt.time2
-0001b830: 6c6f 6361 6c73 7472 2872 6563 6f72 642e  localstr(record.
-0001b840: 7431 292e 7370 6c69 7428 2220 2229 0a20  t1).split(" "). 
-0001b850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b860: 2020 2073 6432 2c20 7374 3220 3d20 6474     sd2, st2 = dt
-0001b870: 2e74 696d 6532 6c6f 6361 6c73 7472 2872  .time2localstr(r
-0001b880: 6563 6f72 642e 7432 292e 7370 6c69 7428  ecord.t2).split(
-0001b890: 2220 2229 0a20 2020 2020 2020 2020 2020  " ").           
-0001b8a0: 2020 2020 2020 2020 2069 6620 5472 7565           if True
-0001b8b0: 3a20 2023 2073 7431 2e65 6e64 7357 6974  :  # st1.endsWit
-0001b8c0: 6828 223a 3030 2229 3a0a 2020 2020 2020  h(":00"):.      
-0001b8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b8e0: 2020 7374 3120 3d20 7374 315b 3a2d 335d    st1 = st1[:-3]
-0001b8f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b900: 2020 2020 2069 6620 5472 7565 3a20 2023       if True:  #
-0001b910: 2073 7432 2e65 6e64 7357 6974 6828 223a   st2.endsWith(":
-0001b920: 3030 2229 3a0a 2020 2020 2020 2020 2020  00"):.          
-0001b930: 2020 2020 2020 2020 2020 2020 2020 7374                st
-0001b940: 3220 3d20 7374 325b 3a2d 335d 0a20 2020  2 = st2[:-3].   
-0001b950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b960: 2064 7572 6174 696f 6e20 3d20 6475 7261   duration = dura
-0001b970: 7469 6f6e 3273 7472 286d 696e 2874 322c  tion2str(min(t2,
-0001b980: 2072 6563 6f72 642e 7432 2920 2d20 6d61   record.t2) - ma
-0001b990: 7828 7431 2c20 7265 636f 7264 2e74 3129  x(t1, record.t1)
-0001b9a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001b9b0: 2020 2020 2020 726f 7773 2e61 7070 656e        rows.appen
-0001b9c0: 6428 0a20 2020 2020 2020 2020 2020 2020  d(.             
-0001b9d0: 2020 2020 2020 2020 2020 205b 0a20 2020             [.   
-0001b9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b9f0: 2020 2020 2020 2020 2022 7265 636f 7264           "record
-0001ba00: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-0001ba10: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0001ba20: 6563 6f72 642e 6b65 792c 0a20 2020 2020  ecord.key,.     
-0001ba30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ba40: 2020 2020 2020 2064 7572 6174 696f 6e2c         duration,
-0001ba50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ba60: 2020 2020 2020 2020 2020 2020 2073 6431               sd1
-0001ba70: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001ba80: 2020 2020 2020 2020 2020 2020 2020 7374                st
-0001ba90: 312c 0a20 2020 2020 2020 2020 2020 2020  1,.             
-0001baa0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001bab0: 7432 2c0a 2020 2020 2020 2020 2020 2020  t2,.            
-0001bac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bad0: 746f 5f73 7472 2872 6563 6f72 642e 6765  to_str(record.ge
-0001bae0: 7428 2264 7322 2c20 2222 2929 2c20 2023  t("ds", "")),  #
-0001baf0: 2073 7472 6970 2074 6162 7320 616e 6420   strip tabs and 
-0001bb00: 6e65 776c 696e 6573 0a20 2020 2020 2020  newlines.       
-0001bb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bb20: 2020 2020 2077 696e 646f 772e 7374 6f72       window.stor
-0001bb30: 652e 7265 636f 7264 732e 7461 6773 5f66  e.records.tags_f
-0001bb40: 726f 6d5f 7265 636f 7264 2872 6563 6f72  rom_record(recor
-0001bb50: 6429 2e6a 6f69 6e28 2220 2229 2c0a 2020  d).join(" "),.  
-0001bb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bb70: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
-0001bb80: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-0001bb90: 2020 2020 2020 2072 6574 7572 6e20 726f         return ro
-0001bba0: 7773 0a0a 2020 2020 6465 6620 5f67 656e  ws..    def _gen
-0001bbb0: 6572 6174 655f 7461 626c 655f 6874 6d6c  erate_table_html
-0001bbc0: 2873 656c 662c 2072 6f77 7329 3a0a 2020  (self, rows):.  
-0001bbd0: 2020 2020 2020 7769 6e64 6f77 2e5f 6f70        window._op
-0001bbe0: 656e 5f72 6563 6f72 645f 6469 616c 6f67  en_record_dialog
-0001bbf0: 203d 2073 656c 662e 5f6f 7065 6e5f 7265   = self._open_re
-0001bc00: 636f 7264 0a20 2020 2020 2020 2062 6c61  cord.        bla
-0001bc10: 6e6b 5f72 6f77 203d 2022 3c74 7220 636c  nk_row = "<tr cl
-0001bc20: 6173 733d 2762 6c61 6e6b 5f72 6f77 273e  ass='blank_row'>
-0001bc30: 3c74 643e 3c2f 7464 3e3c 7464 3e3c 2f74  <td></td><td></t
-0001bc40: 643e 3c74 643e 3c2f 7464 3e3c 7464 3e3c  d><td></td><td><
-0001bc50: 2f74 643e 3c74 643e 3c2f 7464 3e3c 7464  /td><td></td><td
-0001bc60: 3e3c 2f74 643e 3c74 643e 3c2f 7464 3e3c  ></td><td></td><
-0001bc70: 2f74 723e 220a 2020 2020 2020 2020 6c69  /tr>".        li
-0001bc80: 6e65 7320 3d20 5b5d 0a20 2020 2020 2020  nes = [].       
-0001bc90: 2066 6f72 2072 6f77 2069 6e20 726f 7773   for row in rows
-0001bca0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0001bcb0: 2072 6f77 5b30 5d20 3d3d 2022 626c 616e   row[0] == "blan
-0001bcc0: 6b22 3a0a 2020 2020 2020 2020 2020 2020  k":.            
-0001bcd0: 2020 2020 6c69 6e65 732e 6170 7065 6e64      lines.append
-0001bce0: 2862 6c61 6e6b 5f72 6f77 290a 2020 2020  (blank_row).    
-0001bcf0: 2020 2020 2020 2020 656c 6966 2072 6f77          elif row
-0001bd00: 5b30 5d20 3d3d 2022 6865 6164 223a 0a20  [0] == "head":. 
-0001bd10: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0001bd20: 696e 6573 2e61 7070 656e 6428 0a20 2020  ines.append(.   
-0001bd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bd40: 2066 223c 7472 3e3c 7468 3e7b 726f 775b   f"<tr><th>{row[
-0001bd50: 315d 7d3c 2f74 683e 3c74 6820 636c 6173  1]}</th><th clas
-0001bd60: 733d 2770 6164 7b72 6f77 5b33 5d7d 273e  s='pad{row[3]}'>
-0001bd70: 7b72 6f77 5b32 5d7d 3c2f 7468 3e3c 7468  {row[2]}</th><th
-0001bd80: 3e3c 2f74 683e 220a 2020 2020 2020 2020  ></th>".        
-0001bd90: 2020 2020 2020 2020 2020 2020 2b20 223c              + "<
-0001bda0: 7468 3e3c 2f74 683e 3c74 683e 3c2f 7468  th></th><th></th
-0001bdb0: 3e3c 7468 3e3c 2f74 683e 3c74 683e 3c2f  ><th></th><th></
-0001bdc0: 7468 3e3c 2f74 723e 220a 2020 2020 2020  th></tr>".      
-0001bdd0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0001bde0: 2020 2020 2020 2020 656c 6966 2072 6f77          elif row
-0001bdf0: 5b30 5d20 3d3d 2022 7265 636f 7264 223a  [0] == "record":
-0001be00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001be10: 205f 2c20 6b65 792c 2064 7572 6174 696f   _, key, duratio
-0001be20: 6e2c 2073 6431 2c20 7374 312c 2073 7432  n, sd1, st1, st2
-0001be30: 2c20 6473 2c20 7461 677a 203d 2072 6f77  , ds, tagz = row
-0001be40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001be50: 206c 696e 6573 2e61 7070 656e 6428 0a20   lines.append(. 
-0001be60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be70: 2020 2066 223c 7472 3e3c 7464 3e3c 2f74     f"<tr><td></t
-0001be80: 643e 3c74 643e 3c2f 7464 3e3c 7464 3e7b  d><td></td><td>{
-0001be90: 6475 7261 7469 6f6e 7d3c 2f74 643e 220a  duration}</td>".
-0001bea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001beb0: 2020 2020 2b20 6622 3c74 643e 7b73 6431      + f"<td>{sd1
-0001bec0: 7d3c 2f74 643e 3c74 6420 636c 6173 733d  }</td><td class=
-0001bed0: 2774 3127 3e7b 7374 317d 3c2f 7464 3e3c  't1'>{st1}</td><
-0001bee0: 7464 2063 6c61 7373 3d27 7432 273e 7b73  td class='t2'>{s
-0001bef0: 7432 7d3c 2f74 643e 220a 2020 2020 2020  t2}</td>".      
-0001bf00: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-0001bf10: 6622 3c74 643e 3c61 206f 6e63 6c69 636b  f"<td><a onclick
-0001bf20: 3d27 7769 6e64 6f77 2e5f 6f70 656e 5f72  ='window._open_r
-0001bf30: 6563 6f72 645f 6469 616c 6f67 285c 227b  ecord_dialog(\"{
-0001bf40: 6b65 797d 5c22 2927 2073 7479 6c65 3d27  key}\")' style='
-0001bf50: 6375 7273 6f72 3a70 6f69 6e74 6572 3b27  cursor:pointer;'
-0001bf60: 3e22 0a20 2020 2020 2020 2020 2020 2020  >".             
-0001bf70: 2020 2020 2020 202b 2066 227b 6473 206f         + f"{ds o
-0001bf80: 7220 2726 6e62 7370 3b2d 266e 6273 703b  r '&nbsp;-&nbsp;
-0001bf90: 277d 3c2f 613e 3c2f 7464 3e3c 2f74 723e  '}</a></td></tr>
-0001bfa0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0001bfb0: 2020 290a 2020 2020 2020 2020 7265 7475    ).        retu
-0001bfc0: 726e 206c 696e 6573 2e6a 6f69 6e28 2222  rn lines.join(""
-0001bfd0: 290a 0a20 2020 2064 6566 205f 6f70 656e  )..    def _open
-0001bfe0: 5f72 6563 6f72 6428 7365 6c66 2c20 6b65  _record(self, ke
-0001bff0: 7929 3a0a 2020 2020 2020 2020 7265 636f  y):.        reco
-0001c000: 7264 203d 2077 696e 646f 772e 7374 6f72  rd = window.stor
-0001c010: 652e 7265 636f 7264 732e 6765 745f 6279  e.records.get_by
-0001c020: 5f6b 6579 286b 6579 290a 2020 2020 2020  _key(key).      
-0001c030: 2020 7365 6c66 2e5f 6361 6e76 6173 2e72    self._canvas.r
-0001c040: 6563 6f72 645f 6469 616c 6f67 2e6f 7065  ecord_dialog.ope
-0001c050: 6e28 2245 6469 7422 2c20 7265 636f 7264  n("Edit", record
-0001c060: 2c20 7365 6c66 2e5f 7570 6461 7465 5f74  , self._update_t
-0001c070: 6162 6c65 290a 0a20 2020 2064 6566 205f  able)..    def _
-0001c080: 636f 7079 5f63 6c69 7062 6f61 7264 2873  copy_clipboard(s
-0001c090: 656c 6629 3a0a 2020 2020 2020 2020 746f  elf):.        to
-0001c0a0: 6f6c 732e 636f 7079 5f64 6f6d 5f6e 6f64  ols.copy_dom_nod
-0001c0b0: 6528 7365 6c66 2e5f 7461 626c 655f 656c  e(self._table_el
-0001c0c0: 656d 656e 7429 0a20 2020 2020 2020 2073  ement).        s
-0001c0d0: 656c 662e 5f63 6f70 795f 6275 742e 696e  elf._copy_but.in
-0001c0e0: 6e65 7248 544d 4c20 3d20 280a 2020 2020  nerHTML = (.    
-0001c0f0: 2020 2020 2020 2020 6622 3c69 2063 6c61          f"<i cla
-0001c100: 7373 3d27 6661 7327 3e5c 7566 3436 633c  ss='fas'>\uf46c<
-0001c110: 2f69 3e26 6e62 7370 3b26 6e62 7370 3b7b  /i>&nbsp;&nbsp;{
-0001c120: 7365 6c66 2e5f 636f 7079 6275 7474 6578  self._copybuttex
-0001c130: 747d 220a 2020 2020 2020 2020 290a 2020  t}".        ).  
-0001c140: 2020 2020 2020 7769 6e64 6f77 2e73 6574        window.set
-0001c150: 5469 6d65 6f75 7428 7365 6c66 2e5f 7265  Timeout(self._re
-0001c160: 7365 745f 636f 7079 5f62 7574 5f74 6578  set_copy_but_tex
-0001c170: 742c 2038 3030 290a 0a20 2020 2064 6566  t, 800)..    def
-0001c180: 205f 7265 7365 745f 636f 7079 5f62 7574   _reset_copy_but
-0001c190: 5f74 6578 7428 7365 6c66 293a 0a20 2020  _text(self):.   
-0001c1a0: 2020 2020 2073 656c 662e 5f63 6f70 795f       self._copy_
-0001c1b0: 6275 742e 696e 6e65 7248 544d 4c20 3d20  but.innerHTML = 
-0001c1c0: 280a 2020 2020 2020 2020 2020 2020 6622  (.            f"
-0001c1d0: 3c69 2063 6c61 7373 3d27 6661 7327 3e5c  <i class='fas'>\
-0001c1e0: 7566 3332 383c 2f69 3e26 6e62 7370 3b26  uf328</i>&nbsp;&
-0001c1f0: 6e62 7370 3b7b 7365 6c66 2e5f 636f 7079  nbsp;{self._copy
-0001c200: 6275 7474 6578 747d 220a 2020 2020 2020  buttext}".      
-0001c210: 2020 290a 0a20 2020 2064 6566 205f 6765    )..    def _ge
-0001c220: 745f 6578 706f 7274 5f66 696c 656e 616d  t_export_filenam
-0001c230: 6528 7365 6c66 2c20 6578 7429 3a0a 2020  e(self, ext):.  
-0001c240: 2020 2020 2020 6461 7465 3120 3d20 7365        date1 = se
-0001c250: 6c66 2e5f 7431 5f64 6174 652e 7265 706c  lf._t1_date.repl
-0001c260: 6163 6528 222d 222c 2022 2229 0a20 2020  ace("-", "").   
-0001c270: 2020 2020 2064 6174 6532 203d 2073 656c       date2 = sel
-0001c280: 662e 5f74 325f 6461 7465 2e72 6570 6c61  f._t2_date.repla
-0001c290: 6365 2822 2d22 2c20 2222 290a 2020 2020  ce("-", "").    
-0001c2a0: 2020 2020 6966 2064 6174 6531 203d 3d20      if date1 == 
-0001c2b0: 6461 7465 323a 0a20 2020 2020 2020 2020  date2:.         
-0001c2c0: 2020 2072 6574 7572 6e20 6622 7469 6d65     return f"time
-0001c2d0: 7461 6767 6572 2d7b 6461 7465 317d 2e7b  tagger-{date1}.{
-0001c2e0: 6578 747d 220a 2020 2020 2020 2020 656c  ext}".        el
-0001c2f0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0001c300: 7265 7475 726e 2066 2274 696d 6574 6167  return f"timetag
-0001c310: 6765 722d 7b64 6174 6531 7d2d 7b64 6174  ger-{date1}-{dat
-0001c320: 6532 7d2e 7b65 7874 7d22 0a0a 2020 2020  e2}.{ext}"..    
-0001c330: 6465 6620 5f73 6176 655f 6173 5f63 7376  def _save_as_csv
-0001c340: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0001c350: 2320 5468 6973 2069 7320 616c 6c20 7072  # This is all pr
-0001c360: 6574 7479 2073 7472 6169 6768 7466 6f72  etty straightfor
-0001c370: 7761 7264 2e20 5468 6520 6d6f 7374 2074  ward. The most t
-0001c380: 7269 636b 7920 6269 7420 6974 0a20 2020  ricky bit it.   
-0001c390: 2020 2020 2023 2074 6865 2064 7320 2864       # the ds (d
-0001c3a0: 6573 6372 6970 7469 6f6e 292e 2049 7420  escription). It 
-0001c3b0: 6361 6e20 6861 7665 2061 6e79 2055 6e69  can have any Uni
-0001c3c0: 636f 6465 2c20 736f 2069 7420 7368 6f75  code, so it shou
-0001c3d0: 6c64 0a20 2020 2020 2020 2023 2073 7572  ld.        # sur
-0001c3e0: 726f 756e 6465 6420 6279 2064 6f75 626c  rounded by doubl
-0001c3f0: 6520 7175 6f74 6573 2e20 416e 7920 646f  e quotes. Any do
-0001c400: 7562 6c65 2d71 756f 7465 7320 696e 7369  uble-quotes insi
-0001c410: 6465 2074 6865 2064 730a 2020 2020 2020  de the ds.      
-0001c420: 2020 2320 6d75 7374 2062 6520 6573 6361    # must be esca
-0001c430: 7065 6420 6279 2064 6f75 626c 696e 6720  ped by doubling 
-0001c440: 7468 656d 2e20 416e 6420 6669 6e61 6c6c  them. And finall
-0001c450: 792c 2064 6f6e 2774 2070 7574 2073 7061  y, don't put spa
-0001c460: 6365 0a20 2020 2020 2020 2023 2061 6674  ce.        # aft
-0001c470: 6572 2063 6f6d 6d61 2773 2c20 6f72 2074  er comma's, or t
-0001c480: 6f6f 6c73 206c 696b 6520 4578 6365 6c20  ools like Excel 
-0001c490: 6d61 7920 6e6f 7420 6265 2061 626c 6520  may not be able 
-0001c4a0: 746f 2070 6172 7365 0a20 2020 2020 2020  to parse.       
-0001c4b0: 2023 2074 6865 2071 756f 7465 6420 7374   # the quoted st
-0001c4c0: 7269 6e67 2063 6f72 7265 6374 6c79 2e20  ring correctly. 
-0001c4d0: 4e6f 7465 2074 6861 7420 696e 205f 6765  Note that in _ge
-0001c4e0: 6e65 7261 7465 5f74 6162 6c65 5f72 6f77  nerate_table_row
-0001c4f0: 730a 2020 2020 2020 2020 2320 7468 6520  s.        # the 
-0001c500: 6473 2069 7320 7374 6970 7065 6420 6672  ds is stipped fr
-0001c510: 6f6d 205c 745c 725c 6e2e 0a0a 2020 2020  om \t\r\n...    
-0001c520: 2020 2020 726f 7773 203d 2073 656c 662e      rows = self.
-0001c530: 5f67 656e 6572 6174 655f 7461 626c 655f  _generate_table_
-0001c540: 726f 7773 2873 656c 662e 5f6c 6173 745f  rows(self._last_
-0001c550: 7431 2c20 7365 6c66 2e5f 6c61 7374 5f74  t1, self._last_t
-0001c560: 3229 0a0a 2020 2020 2020 2020 6c69 6e65  2)..        line
-0001c570: 7320 3d20 5b5d 0a20 2020 2020 2020 206c  s = [].        l
-0001c580: 696e 6573 2e61 7070 656e 6428 0a20 2020  ines.append(.   
-0001c590: 2020 2020 2020 2020 2022 7375 6274 6f74           "subtot
-0001c5a0: 616c 732c 7461 675f 6772 6f75 7073 2c64  als,tag_groups,d
-0001c5b0: 7572 6174 696f 6e2c 6461 7465 2c73 7461  uration,date,sta
-0001c5c0: 7274 2c73 746f 702c 6465 7363 7269 7074  rt,stop,descript
-0001c5d0: 696f 6e2c 7573 6572 2c74 6167 7322 0a20  ion,user,tags". 
-0001c5e0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0001c5f0: 206c 696e 6573 2e61 7070 656e 6428 2222   lines.append(""
-0001c600: 290a 0a20 2020 2020 2020 2075 7365 7220  )..        user 
-0001c610: 3d20 2222 2020 2320 6e6f 7161 0a20 2020  = ""  # noqa.   
-0001c620: 2020 2020 2069 6620 7769 6e64 6f77 2e73       if window.s
-0001c630: 746f 7265 2e67 6574 5f61 7574 683a 0a20  tore.get_auth:. 
-0001c640: 2020 2020 2020 2020 2020 2061 7574 6820             auth 
-0001c650: 3d20 7769 6e64 6f77 2e73 746f 7265 2e67  = window.store.g
-0001c660: 6574 5f61 7574 6828 290a 2020 2020 2020  et_auth().      
-0001c670: 2020 2020 2020 6966 2061 7574 683a 0a20        if auth:. 
-0001c680: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-0001c690: 7365 7220 3d20 6175 7468 2e75 7365 726e  ser = auth.usern
-0001c6a0: 616d 6520 2023 206e 6f71 610a 0a20 2020  ame  # noqa..   
-0001c6b0: 2020 2020 2066 6f72 2072 6f77 2069 6e20       for row in 
-0001c6c0: 726f 7773 3a0a 2020 2020 2020 2020 2020  rows:.          
-0001c6d0: 2020 6966 2072 6f77 5b30 5d20 3d3d 2022    if row[0] == "
-0001c6e0: 626c 616e 6b22 3a0a 2020 2020 2020 2020  blank":.        
-0001c6f0: 2020 2020 2020 2020 6c69 6e65 732e 6170          lines.ap
-0001c700: 7065 6e64 2822 2c2c 2c2c 2c2c 2c2c 2229  pend(",,,,,,,,")
-0001c710: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-0001c720: 6620 726f 775b 305d 203d 3d20 2268 6561  f row[0] == "hea
-0001c730: 6422 3a0a 2020 2020 2020 2020 2020 2020  d":.            
-0001c740: 2020 2020 6c69 6e65 732e 6170 7065 6e64      lines.append
-0001c750: 2852 6177 4a53 2827 726f 775b 315d 202b  (RawJS('row[1] +
-0001c760: 2022 2c22 202b 2072 6f77 5b32 5d20 2b20   "," + row[2] + 
-0001c770: 222c 2c2c 2c2c 2c2c 2227 2929 0a20 2020  ",,,,,,,"')).   
-0001c780: 2020 2020 2020 2020 2065 6c69 6620 726f           elif ro
-0001c790: 775b 305d 203d 3d20 2272 6563 6f72 6422  w[0] == "record"
-0001c7a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001c7b0: 2020 5f2c 206b 6579 2c20 6475 7261 7469    _, key, durati
-0001c7c0: 6f6e 2c20 7364 312c 2073 7431 2c20 7374  on, sd1, st1, st
-0001c7d0: 322c 2064 732c 2074 6167 7a20 3d20 726f  2, ds, tagz = ro
-0001c7e0: 770a 2020 2020 2020 2020 2020 2020 2020  w.              
-0001c7f0: 2020 6473 203d 2027 2227 202b 2064 732e    ds = '"' + ds.
-0001c800: 7265 706c 6163 6528 2722 272c 2027 2222  replace('"', '""
-0001c810: 2729 202b 2027 2227 0a20 2020 2020 2020  ') + '"'.       
-0001c820: 2020 2020 2020 2020 206c 696e 6573 2e61           lines.a
-0001c830: 7070 656e 6428 0a20 2020 2020 2020 2020  ppend(.         
-0001c840: 2020 2020 2020 2020 2020 2052 6177 4a53             RawJS
-0001c850: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001c860: 2020 2020 2020 2020 2020 2222 2227 2c2c            """',,
-0001c870: 2720 2b20 6475 7261 7469 6f6e 202b 2027  ' + duration + '
-0001c880: 2c27 202b 2073 6431 202b 2027 2c27 202b  ,' + sd1 + ',' +
-0001c890: 2073 7431 202b 2027 2c27 202b 2073 7432   st1 + ',' + st2
-0001c8a0: 202b 2027 2c27 202b 2064 7320 2b20 272c   + ',' + ds + ',
-0001c8b0: 2720 2b20 7573 6572 202b 2027 2c27 202b  ' + user + ',' +
-0001c8c0: 2074 6167 7a22 2222 0a20 2020 2020 2020   tagz""".       
-0001c8d0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-0001c8e0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0001c8f0: 0a0a 2020 2020 2020 2020 2320 4765 7420  ..        # Get 
-0001c900: 626c 6f62 2077 7261 7070 6564 2069 6e20  blob wrapped in 
-0001c910: 616e 206f 626a 6563 7420 7572 6c0a 2020  an object url.  
-0001c920: 2020 2020 2020 6f62 6a5f 7572 6c20 3d20        obj_url = 
-0001c930: 7769 6e64 6f77 2e55 524c 2e63 7265 6174  window.URL.creat
-0001c940: 654f 626a 6563 7455 524c 280a 2020 2020  eObjectURL(.    
-0001c950: 2020 2020 2020 2020 7769 6e64 6f77 2e42          window.B
-0001c960: 6c6f 6228 5b22 5c72 5c6e 222e 6a6f 696e  lob(["\r\n".join
-0001c970: 286c 696e 6573 295d 2c20 7b22 7479 7065  (lines)], {"type
-0001c980: 223a 2022 7465 7874 2f63 7376 227d 290a  ": "text/csv"}).
-0001c990: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0001c9a0: 2020 2320 4372 6561 7465 2061 2065 6c65    # Create a ele
-0001c9b0: 6d65 6e74 2074 6f20 6174 7461 6368 2074  ment to attach t
-0001c9c0: 6865 2064 6f77 6e6c 6f61 6420 746f 0a20  he download to. 
-0001c9d0: 2020 2020 2020 2061 203d 2064 6f63 756d         a = docum
-0001c9e0: 656e 742e 6372 6561 7465 456c 656d 656e  ent.createElemen
-0001c9f0: 7428 2261 2229 0a20 2020 2020 2020 2061  t("a").        a
-0001ca00: 2e73 7479 6c65 2e64 6973 706c 6179 203d  .style.display =
-0001ca10: 2022 6e6f 6e65 220a 2020 2020 2020 2020   "none".        
-0001ca20: 612e 7365 7441 7474 7269 6275 7465 2822  a.setAttribute("
-0001ca30: 646f 776e 6c6f 6164 222c 2073 656c 662e  download", self.
-0001ca40: 5f67 6574 5f65 7870 6f72 745f 6669 6c65  _get_export_file
-0001ca50: 6e61 6d65 2822 6373 7622 2929 0a20 2020  name("csv")).   
-0001ca60: 2020 2020 2061 2e68 7265 6620 3d20 6f62       a.href = ob
-0001ca70: 6a5f 7572 6c0a 2020 2020 2020 2020 646f  j_url.        do
-0001ca80: 6375 6d65 6e74 2e62 6f64 792e 6170 7065  cument.body.appe
-0001ca90: 6e64 4368 696c 6428 6129 0a20 2020 2020  ndChild(a).     
-0001caa0: 2020 2023 2054 7269 6767 6572 2074 6865     # Trigger the
-0001cab0: 2064 6f77 6e6c 6f61 6420 6279 2073 696d   download by sim
-0001cac0: 756c 6174 696e 6720 636c 6963 6b0a 2020  ulating click.  
-0001cad0: 2020 2020 2020 612e 636c 6963 6b28 290a        a.click().
-0001cae0: 2020 2020 2020 2020 2320 436c 6561 6e75          # Cleanu
-0001caf0: 700a 2020 2020 2020 2020 7769 6e64 6f77  p.        window
-0001cb00: 2e55 524c 2e72 6576 6f6b 654f 626a 6563  .URL.revokeObjec
-0001cb10: 7455 524c 2861 2e68 7265 6629 0a20 2020  tURL(a.href).   
-0001cb20: 2020 2020 2064 6f63 756d 656e 742e 626f       document.bo
-0001cb30: 6479 2e72 656d 6f76 6543 6869 6c64 2861  dy.removeChild(a
-0001cb40: 290a 0a20 2020 2064 6566 205f 7361 7665  )..    def _save
-0001cb50: 5f61 735f 7064 6628 7365 6c66 293a 0a20  _as_pdf(self):. 
-0001cb60: 2020 2020 2020 2023 2043 6f6e 6669 6775         # Configu
-0001cb70: 7265 0a20 2020 2020 2020 2077 6964 7468  re.        width
-0001cb80: 2c20 6865 6967 6874 203d 2032 3130 2c20  , height = 210, 
-0001cb90: 3239 3720 2023 2041 340a 2020 2020 2020  297  # A4.      
-0001cba0: 2020 6d61 7267 696e 203d 2032 3020 2023    margin = 20  #
-0001cbb0: 206d 6d0a 2020 2020 2020 2020 7368 6f77   mm.        show
-0001cbc0: 7265 636f 7264 7320 3d20 7365 6c66 2e5f  records = self._
-0001cbd0: 7368 6f77 7265 636f 7264 735f 6275 742e  showrecords_but.
-0001cbe0: 6368 6563 6b65 640a 2020 2020 2020 2020  checked.        
-0001cbf0: 726f 7768 6569 6768 7420 3d20 360a 2020  rowheight = 6.  
-0001cc00: 2020 2020 2020 726f 7768 6569 6768 7432        rowheight2
-0001cc10: 203d 2072 6f77 6865 6967 6874 202f 2032   = rowheight / 2
-0001cc20: 0a20 2020 2020 2020 2072 6f77 736b 6970  .        rowskip
-0001cc30: 203d 2033 0a20 2020 2020 2020 2063 6f6c   = 3.        col
-0001cc40: 6f66 6673 6574 7320 3d20 3135 2c20 342c  offsets = 15, 4,
-0001cc50: 2031 372c 2031 302c 2031 300a 0a20 2020   17, 10, 10..   
-0001cc60: 2020 2020 2023 2047 6574 2072 6f77 2064       # Get row d
-0001cc70: 6174 6120 616e 6420 6469 7669 6465 2069  ata and divide i
-0001cc80: 6e20 6368 756e 6b73 2e20 5468 6973 2069  n chunks. This i
-0001cc90: 7320 646f 6e65 2073 6f20 7468 6174 2077  s done so that w
-0001cca0: 650a 2020 2020 2020 2020 2320 6361 6e20  e.        # can 
-0001ccb0: 6272 6561 6b20 7061 6765 7320 6561 726c  break pages earl
-0001ccc0: 6965 7220 746f 2061 766f 6964 2062 7265  ier to avoid bre
-0001ccd0: 616b 696e 6720 6368 756e 6b73 2e0a 2020  aking chunks..  
-0001cce0: 2020 2020 2020 726f 7773 203d 2073 656c        rows = sel
-0001ccf0: 662e 5f67 656e 6572 6174 655f 7461 626c  f._generate_tabl
-0001cd00: 655f 726f 7773 2873 656c 662e 5f6c 6173  e_rows(self._las
-0001cd10: 745f 7431 2c20 7365 6c66 2e5f 6c61 7374  t_t1, self._last
-0001cd20: 5f74 3229 0a20 2020 2020 2020 2063 6875  _t2).        chu
-0001cd30: 6e6b 7320 3d20 5b5b 5d5d 0a20 2020 2020  nks = [[]].     
-0001cd40: 2020 2066 6f72 2072 6f77 2069 6e20 726f     for row in ro
-0001cd50: 7773 3a0a 2020 2020 2020 2020 2020 2020  ws:.            
-0001cd60: 6966 2072 6f77 5b30 5d20 3d3d 2022 626c  if row[0] == "bl
-0001cd70: 616e 6b22 3a0a 2020 2020 2020 2020 2020  ank":.          
-0001cd80: 2020 2020 2020 6368 756e 6b73 2e61 7070        chunks.app
-0001cd90: 656e 6428 5b5d 290a 2020 2020 2020 2020  end([]).        
-0001cda0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001cdb0: 2020 2020 2020 2020 2020 6368 756e 6b73            chunks
-0001cdc0: 5b2d 315d 2e61 7070 656e 6428 726f 7729  [-1].append(row)
-0001cdd0: 0a0a 2020 2020 2020 2020 2320 496e 6974  ..        # Init
-0001cde0: 6961 6c69 7a65 2074 6865 2064 6f63 756d  ialize the docum
-0001cdf0: 656e 740a 2020 2020 2020 2020 646f 6320  ent.        doc 
-0001ce00: 3d20 7769 6e64 6f77 2e6a 7350 4446 2829  = window.jsPDF()
-0001ce10: 0a20 2020 2020 2020 2064 6f63 2e73 6574  .        doc.set
-0001ce20: 466f 6e74 2822 5562 756e 7475 2d43 2229  Font("Ubuntu-C")
-0001ce30: 0a0a 2020 2020 2020 2020 2320 4472 6177  ..        # Draw
-0001ce40: 2070 7265 616d 626c 650a 2020 2020 2020   preamble.      
-0001ce50: 2020 646f 632e 7365 7446 6f6e 7453 697a    doc.setFontSiz
-0001ce60: 6528 3234 290a 2020 2020 2020 2020 646f  e(24).        do
-0001ce70: 632e 7465 7874 2822 5469 6d65 2072 6563  c.text("Time rec
-0001ce80: 6f72 6420 7265 706f 7274 222c 206d 6172  ord report", mar
-0001ce90: 6769 6e2c 206d 6172 6769 6e2c 207b 2262  gin, margin, {"b
-0001cea0: 6173 656c 696e 6522 3a20 2274 6f70 227d  aseline": "top"}
-0001ceb0: 290a 2020 2020 2020 2020 696d 6720 3d20  ).        img = 
-0001cec0: 646f 6375 6d65 6e74 2e67 6574 456c 656d  document.getElem
-0001ced0: 656e 7442 7949 6428 2274 746c 6f67 6f5f  entById("ttlogo_
-0001cee0: 6264 2229 0a20 2020 2020 2020 2064 6f63  bd").        doc
-0001cef0: 2e61 6464 496d 6167 6528 696d 672c 2022  .addImage(img, "
-0001cf00: 504e 4722 2c20 7769 6474 6820 2d20 6d61  PNG", width - ma
-0001cf10: 7267 696e 202d 2033 302c 206d 6172 6769  rgin - 30, margi
-0001cf20: 6e2c 2033 302c 2033 3029 0a20 2020 2020  n, 30, 30).     
-0001cf30: 2020 2023 2064 6f63 2e73 6574 466f 6e74     # doc.setFont
-0001cf40: 5369 7a65 2831 3229 0a20 2020 2020 2020  Size(12).       
-0001cf50: 2023 2064 6f63 2e74 6578 7428 0a20 2020   # doc.text(.   
-0001cf60: 2020 2020 2023 2020 2020 2022 5469 6d65       #     "Time
-0001cf70: 5461 6767 6572 222c 0a20 2020 2020 2020  Tagger",.       
-0001cf80: 2023 2020 2020 2077 6964 7468 202d 206d   #     width - m
-0001cf90: 6172 6769 6e2c 0a20 2020 2020 2020 2023  argin,.        #
-0001cfa0: 2020 2020 206d 6172 6769 6e20 2b20 3232       margin + 22
-0001cfb0: 2c0a 2020 2020 2020 2020 2320 2020 2020  ,.        #     
-0001cfc0: 7b22 616c 6967 6e22 3a20 2272 6967 6874  {"align": "right
-0001cfd0: 222c 2022 6261 7365 6c69 6e65 223a 2022  ", "baseline": "
-0001cfe0: 746f 7022 7d2c 0a20 2020 2020 2020 2023  top"},.        #
-0001cff0: 2029 0a0a 2020 2020 2020 2020 7461 676e   )..        tagn
-0001d000: 616d 6520 3d20 7365 6c66 2e5f 7461 6773  ame = self._tags
-0001d010: 2e6a 6f69 6e28 2220 2229 2069 6620 7365  .join(" ") if se
-0001d020: 6c66 2e5f 7461 6773 2065 6c73 6520 2261  lf._tags else "a
-0001d030: 6c6c 220a 2020 2020 2020 2020 6431 203d  ll".        d1 =
-0001d040: 2072 6576 6572 7365 6428 7365 6c66 2e5f   reversed(self._
-0001d050: 7431 5f64 6174 652e 7370 6c69 7428 222d  t1_date.split("-
-0001d060: 2229 292e 6a6f 696e 2822 2d22 290a 2020  ")).join("-").  
-0001d070: 2020 2020 2020 6432 203d 2072 6576 6572        d2 = rever
-0001d080: 7365 6428 7365 6c66 2e5f 7432 5f64 6174  sed(self._t2_dat
-0001d090: 652e 7370 6c69 7428 222d 2229 292e 6a6f  e.split("-")).jo
-0001d0a0: 696e 2822 2d22 290a 2020 2020 2020 2020  in("-").        
-0001d0b0: 646f 632e 7365 7446 6f6e 7453 697a 6528  doc.setFontSize(
-0001d0c0: 3131 290a 2020 2020 2020 2020 646f 632e  11).        doc.
-0001d0d0: 7465 7874 2822 5461 6773 3a20 2022 2c20  text("Tags:  ", 
-0001d0e0: 6d61 7267 696e 202b 2032 302c 206d 6172  margin + 20, mar
-0001d0f0: 6769 6e20 2b20 3135 2c20 7b22 616c 6967  gin + 15, {"alig
-0001d100: 6e22 3a20 2272 6967 6874 227d 290a 2020  n": "right"}).  
-0001d110: 2020 2020 2020 646f 632e 7465 7874 2874        doc.text(t
-0001d120: 6167 6e61 6d65 2c20 6d61 7267 696e 202b  agname, margin +
-0001d130: 2032 302c 206d 6172 6769 6e20 2b20 3135   20, margin + 15
-0001d140: 290a 2020 2020 2020 2020 646f 632e 7465  ).        doc.te
-0001d150: 7874 2822 4672 6f6d 3a20 2022 2c20 6d61  xt("From:  ", ma
-0001d160: 7267 696e 202b 2032 302c 206d 6172 6769  rgin + 20, margi
-0001d170: 6e20 2b20 3230 2c20 7b22 616c 6967 6e22  n + 20, {"align"
-0001d180: 3a20 2272 6967 6874 227d 290a 2020 2020  : "right"}).    
-0001d190: 2020 2020 646f 632e 7465 7874 2864 312c      doc.text(d1,
-0001d1a0: 206d 6172 6769 6e20 2b20 3230 2c20 6d61   margin + 20, ma
-0001d1b0: 7267 696e 202b 2032 3029 0a20 2020 2020  rgin + 20).     
-0001d1c0: 2020 2064 6f63 2e74 6578 7428 2255 6e74     doc.text("Unt
-0001d1d0: 696c 3a20 2022 2c20 6d61 7267 696e 202b  il:  ", margin +
-0001d1e0: 2032 302c 206d 6172 6769 6e20 2b20 3235   20, margin + 25
-0001d1f0: 2c20 7b22 616c 6967 6e22 3a20 2272 6967  , {"align": "rig
-0001d200: 6874 227d 290a 2020 2020 2020 2020 646f  ht"}).        do
-0001d210: 632e 7465 7874 2864 322c 206d 6172 6769  c.text(d2, margi
-0001d220: 6e20 2b20 3230 2c20 6d61 7267 696e 202b  n + 20, margin +
-0001d230: 2032 3529 0a0a 2020 2020 2020 2020 2320   25)..        # 
-0001d240: 5072 6570 6172 6520 6472 6177 696e 6720  Prepare drawing 
-0001d250: 7461 626c 650a 2020 2020 2020 2020 646f  table.        do
-0001d260: 632e 7365 7446 6f6e 7453 697a 6528 3130  c.setFontSize(10
-0001d270: 290a 2020 2020 2020 2020 6c65 6674 5f6d  ).        left_m
-0001d280: 6964 646c 6520 3d20 7b22 616c 6967 6e22  iddle = {"align"
-0001d290: 3a20 226c 6566 7422 2c20 2262 6173 656c  : "left", "basel
-0001d2a0: 696e 6522 3a20 226d 6964 646c 6522 7d0a  ine": "middle"}.
-0001d2b0: 2020 2020 2020 2020 7269 6768 745f 6d69          right_mi
-0001d2c0: 6464 6c65 203d 207b 2261 6c69 676e 223a  ddle = {"align":
-0001d2d0: 2022 7269 6768 7422 2c20 2262 6173 656c   "right", "basel
-0001d2e0: 696e 6522 3a20 226d 6964 646c 6522 7d0a  ine": "middle"}.
-0001d2f0: 2020 2020 2020 2020 7920 3d20 6d61 7267          y = marg
-0001d300: 696e 202b 2033 350a 0a20 2020 2020 2020  in + 35..       
-0001d310: 2023 2044 7261 7720 7461 626c 650a 2020   # Draw table.  
-0001d320: 2020 2020 2020 6e70 6167 6573 203d 2031        npages = 1
-0001d330: 0a20 2020 2020 2020 2066 6f72 2063 6875  .        for chu
-0001d340: 6e6b 6e72 2069 6e20 7261 6e67 6528 6c65  nknr in range(le
-0001d350: 6e28 6368 756e 6b73 2929 3a0a 2020 2020  n(chunks)):.    
-0001d360: 2020 2020 2020 2020 2320 4d61 7962 6520          # Maybe 
-0001d370: 696e 7365 7274 2061 2070 6167 6520 6272  insert a page br
-0001d380: 6561 6b20 6561 726c 7920 746f 2070 7265  eak early to pre
-0001d390: 7365 7276 6520 7768 6f6c 6520 6368 756e  serve whole chun
-0001d3a0: 6b73 0a20 2020 2020 2020 2020 2020 2073  ks.            s
-0001d3b0: 7061 6365 5f75 7365 6420 3d20 7920 2d20  pace_used = y - 
-0001d3c0: 6d61 7267 696e 0a20 2020 2020 2020 2020  margin.         
-0001d3d0: 2020 2073 7061 6365 5f74 6f74 616c 203d     space_total =
-0001d3e0: 2068 6569 6768 7420 2d20 3220 2a20 6d61   height - 2 * ma
-0001d3f0: 7267 696e 0a20 2020 2020 2020 2020 2020  rgin.           
-0001d400: 2069 6620 7370 6163 655f 7573 6564 203e   if space_used >
-0001d410: 2030 2e39 202a 2073 7061 6365 5f74 6f74   0.9 * space_tot
-0001d420: 616c 3a0a 2020 2020 2020 2020 2020 2020  al:.            
-0001d430: 2020 2020 726f 7773 6c65 6674 203d 2073      rowsleft = s
-0001d440: 756d 285b 6c65 6e28 6368 756e 6b29 2066  um([len(chunk) f
-0001d450: 6f72 2063 6875 6e6b 2069 6e20 6368 756e  or chunk in chun
-0001d460: 6b73 5b63 6875 6e6b 6e72 3a5d 5d29 0a20  ks[chunknr:]]). 
-0001d470: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001d480: 7061 6365 5f6e 6565 6465 6420 3d20 726f  pace_needed = ro
-0001d490: 7773 6c65 6674 202a 2072 6f77 6865 6967  wsleft * rowheig
-0001d4a0: 6874 0a20 2020 2020 2020 2020 2020 2020  ht.             
-0001d4b0: 2020 2073 7061 6365 5f6e 6565 6465 6420     space_needed 
-0001d4c0: 2b3d 2028 6c65 6e28 6368 756e 6b73 2920  += (len(chunks) 
-0001d4d0: 2d20 6368 756e 6b6e 7229 202a 2072 6f77  - chunknr) * row
-0001d4e0: 736b 6970 0a20 2020 2020 2020 2020 2020  skip.           
-0001d4f0: 2020 2020 2069 6620 7370 6163 655f 6e65       if space_ne
-0001d500: 6564 6564 203e 2073 7061 6365 5f74 6f74  eded > space_tot
-0001d510: 616c 202d 2073 7061 6365 5f75 7365 643a  al - space_used:
-0001d520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d530: 2020 2020 2064 6f63 2e61 6464 5061 6765       doc.addPage
-0001d540: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-0001d550: 2020 2020 2020 206e 7061 6765 7320 2b3d         npages +=
-0001d560: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
-0001d570: 2020 2020 2020 2079 203d 206d 6172 6769         y = margi
-0001d580: 6e0a 0a20 2020 2020 2020 2020 2020 2066  n..            f
-0001d590: 6f72 2072 6f77 6e72 2c20 726f 7720 696e  or rownr, row in
-0001d5a0: 2065 6e75 6d65 7261 7465 2863 6875 6e6b   enumerate(chunk
-0001d5b0: 735b 6368 756e 6b6e 725d 293a 0a20 2020  s[chunknr]):.   
-0001d5c0: 2020 2020 2020 2020 2020 2020 2023 2041               # A
-0001d5d0: 6464 2070 6167 6520 6272 6561 6b3f 0a20  dd page break?. 
-0001d5e0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001d5f0: 6620 2879 202b 2072 6f77 6865 6967 6874  f (y + rowheight
-0001d600: 2920 3e20 2868 6569 6768 7420 2d20 6d61  ) > (height - ma
-0001d610: 7267 696e 293a 0a20 2020 2020 2020 2020  rgin):.         
-0001d620: 2020 2020 2020 2020 2020 2064 6f63 2e61             doc.a
-0001d630: 6464 5061 6765 2829 0a20 2020 2020 2020  ddPage().       
-0001d640: 2020 2020 2020 2020 2020 2020 206e 7061               npa
-0001d650: 6765 7320 2b3d 2031 0a20 2020 2020 2020  ges += 1.       
-0001d660: 2020 2020 2020 2020 2020 2020 2079 203d               y =
-0001d670: 206d 6172 6769 6e0a 0a20 2020 2020 2020   margin..       
-0001d680: 2020 2020 2020 2020 2069 6620 726f 775b           if row[
-0001d690: 305d 203d 3d20 2268 6561 6422 3a0a 2020  0] == "head":.  
-0001d6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d6b0: 2020 6966 2073 686f 7772 6563 6f72 6473    if showrecords
-0001d6c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001d6d0: 2020 2020 2020 2020 2020 646f 632e 7365            doc.se
-0001d6e0: 7446 696c 6c43 6f6c 6f72 2822 2363 6363  tFillColor("#ccc
-0001d6f0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0001d700: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0001d710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d720: 2020 2020 2064 6f63 2e73 6574 4669 6c6c       doc.setFill
-0001d730: 436f 6c6f 7228 2223 6633 6633 6633 2220  Color("#f3f3f3" 
-0001d740: 6966 2072 6f77 6e72 2025 2032 2065 6c73  if rownr % 2 els
-0001d750: 6520 2223 6561 6561 6561 2229 0a20 2020  e "#eaeaea").   
-0001d760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d770: 2064 6f63 2e72 6563 7428 6d61 7267 696e   doc.rect(margin
-0001d780: 2c20 792c 2077 6964 7468 202d 2032 202a  , y, width - 2 *
-0001d790: 206d 6172 6769 6e2c 2072 6f77 6865 6967   margin, rowheig
-0001d7a0: 6874 2c20 2246 2229 0a20 2020 2020 2020  ht, "F").       
-0001d7b0: 2020 2020 2020 2020 2020 2020 2023 2044               # D
-0001d7c0: 7572 6174 696f 6e0a 2020 2020 2020 2020  uration.        
-0001d7d0: 2020 2020 2020 2020 2020 2020 646f 632e              doc.
-0001d7e0: 7365 7454 6578 7443 6f6c 6f72 2822 2330  setTextColor("#0
-0001d7f0: 3030 2229 0a20 2020 2020 2020 2020 2020  00").           
-0001d800: 2020 2020 2020 2020 2078 203d 206d 6172           x = mar
-0001d810: 6769 6e20 2b20 636f 6c6f 6666 7365 7473  gin + coloffsets
-0001d820: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
-0001d830: 2020 2020 2020 2020 646f 632e 7465 7874          doc.text
-0001d840: 2872 6f77 5b31 5d2c 2078 2c20 7920 2b20  (row[1], x, y + 
-0001d850: 726f 7768 6569 6768 7432 2c20 7269 6768  rowheight2, righ
-0001d860: 745f 6d69 6464 6c65 2920 2023 2064 7572  t_middle)  # dur
-0001d870: 6174 696f 6e0a 2020 2020 2020 2020 2020  ation.          
-0001d880: 2020 2020 2020 2020 2020 2320 5461 6720            # Tag 
-0001d890: 6e61 6d65 732c 2061 6464 2073 7472 7563  names, add struc
-0001d8a0: 7475 7265 2076 6961 2063 6f6c 6f72 2c20  ture via color, 
-0001d8b0: 6e6f 2070 6164 6469 6e67 0a20 2020 2020  no padding.     
-0001d8c0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0001d8d0: 6173 656e 616d 652c 206c 6173 746e 616d  asename, lastnam
-0001d8e0: 6520 3d20 2222 2c20 726f 775b 325d 0a20  e = "", row[2]. 
-0001d8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d900: 2020 2064 6f63 2e73 6574 5465 7874 436f     doc.setTextCo
-0001d910: 6c6f 7228 2223 3535 3522 290a 2020 2020  lor("#555").    
-0001d920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d930: 7820 2b3d 2063 6f6c 6f66 6673 6574 735b  x += coloffsets[
-0001d940: 315d 0a20 2020 2020 2020 2020 2020 2020  1].             
-0001d950: 2020 2020 2020 2064 6f63 2e74 6578 7428         doc.text(
-0001d960: 6261 7365 6e61 6d65 2c20 782c 2079 202b  basename, x, y +
-0001d970: 2072 6f77 6865 6967 6874 322c 206c 6566   rowheight2, lef
-0001d980: 745f 6d69 6464 6c65 290a 2020 2020 2020  t_middle).      
-0001d990: 2020 2020 2020 2020 2020 2020 2020 646f                do
-0001d9a0: 632e 7365 7454 6578 7443 6f6c 6f72 2822  c.setTextColor("
-0001d9b0: 2330 3030 2229 0a20 2020 2020 2020 2020  #000").         
-0001d9c0: 2020 2020 2020 2020 2020 2078 202b 3d20             x += 
-0001d9d0: 646f 632e 6765 7454 6578 7457 6964 7468  doc.getTextWidth
-0001d9e0: 2862 6173 656e 616d 6529 0a20 2020 2020  (basename).     
-0001d9f0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0001da00: 6f63 2e74 6578 7428 6c61 7374 6e61 6d65  oc.text(lastname
-0001da10: 2c20 782c 2079 202b 2072 6f77 6865 6967  , x, y + rowheig
-0001da20: 6874 322c 206c 6566 745f 6d69 6464 6c65  ht2, left_middle
-0001da30: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-0001da40: 2020 2065 6c69 6620 726f 775b 305d 203d     elif row[0] =
-0001da50: 3d20 2272 6563 6f72 6422 3a0a 2020 2020  = "record":.    
-0001da60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001da70: 646f 632e 7365 7446 696c 6c43 6f6c 6f72  doc.setFillColor
-0001da80: 2822 2366 3366 3366 3322 2069 6620 726f  ("#f3f3f3" if ro
-0001da90: 776e 7220 2520 3220 656c 7365 2022 2365  wnr % 2 else "#e
-0001daa0: 6165 6165 6122 290a 2020 2020 2020 2020  aeaea").        
-0001dab0: 2020 2020 2020 2020 2020 2020 646f 632e              doc.
-0001dac0: 7265 6374 286d 6172 6769 6e2c 2079 2c20  rect(margin, y, 
-0001dad0: 7769 6474 6820 2d20 3220 2a20 6d61 7267  width - 2 * marg
-0001dae0: 696e 2c20 726f 7768 6569 6768 742c 2022  in, rowheight, "
-0001daf0: 4622 290a 2020 2020 2020 2020 2020 2020  F").            
-0001db00: 2020 2020 2020 2020 646f 632e 7365 7454          doc.setT
-0001db10: 6578 7443 6f6c 6f72 2822 2330 3030 2229  extColor("#000")
-0001db20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001db30: 2020 2020 2023 205f 2c20 6b65 792c 2064       # _, key, d
-0001db40: 7572 6174 696f 6e2c 2073 6431 2c20 7374  uration, sd1, st
-0001db50: 312c 2073 7432 2c20 6473 2c20 7461 677a  1, st2, ds, tagz
-0001db60: 203d 2072 6f77 0a20 2020 2020 2020 2020   = row.         
-0001db70: 2020 2020 2020 2020 2020 2023 2054 6865             # The
-0001db80: 2064 7572 6174 696f 6e20 6973 2072 6967   duration is rig
-0001db90: 6874 2d61 6c69 676e 6564 0a20 2020 2020  ht-aligned.     
-0001dba0: 2020 2020 2020 2020 2020 2020 2020 2078                 x
-0001dbb0: 203d 206d 6172 6769 6e20 2b20 636f 6c6f   = margin + colo
-0001dbc0: 6666 7365 7473 5b30 5d0a 2020 2020 2020  ffsets[0].      
-0001dbd0: 2020 2020 2020 2020 2020 2020 2020 646f                do
-0001dbe0: 632e 7465 7874 2872 6f77 5b32 5d2c 2078  c.text(row[2], x
-0001dbf0: 2c20 7920 2b20 726f 7768 6569 6768 7432  , y + rowheight2
-0001dc00: 2c20 7269 6768 745f 6d69 6464 6c65 290a  , right_middle).
-0001dc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dc20: 2020 2020 2320 5468 6520 7265 7374 2028      # The rest (
-0001dc30: 7364 312c 2073 7431 2c20 7374 3229 2069  sd1, st1, st2) i
-0001dc40: 7320 6c65 6674 2d61 6c69 676e 6564 0a20  s left-aligned. 
-0001dc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dc60: 2020 2066 6f72 2069 2069 6e20 2831 2c20     for i in (1, 
-0001dc70: 322c 2033 293a 0a20 2020 2020 2020 2020  2, 3):.         
-0001dc80: 2020 2020 2020 2020 2020 2020 2020 2078                 x
-0001dc90: 202b 3d20 636f 6c6f 6666 7365 7473 5b69   += coloffsets[i
-0001dca0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0001dcb0: 2020 2020 2020 2020 2020 7320 3d20 726f            s = ro
-0001dcc0: 775b 6920 2b20 325d 0a20 2020 2020 2020  w[i + 2].       
-0001dcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dce0: 2069 6620 6920 3d3d 2033 3a20 2023 2073   if i == 3:  # s
-0001dcf0: 7432 0a20 2020 2020 2020 2020 2020 2020  t2.             
-0001dd00: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0001dd10: 6f63 2e74 6578 7428 222d 222c 2078 202d  oc.text("-", x -
-0001dd20: 2031 2c20 7920 2b20 726f 7768 6569 6768   1, y + rowheigh
-0001dd30: 7432 2c20 7269 6768 745f 6d69 6464 6c65  t2, right_middle
-0001dd40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001dd50: 2020 2020 2020 2020 2020 646f 632e 7465            doc.te
-0001dd60: 7874 2873 2c20 782c 2079 202b 2072 6f77  xt(s, x, y + row
-0001dd70: 6865 6967 6874 322c 206c 6566 745f 6d69  height2, left_mi
-0001dd80: 6464 6c65 290a 2020 2020 2020 2020 2020  ddle).          
-0001dd90: 2020 2020 2020 2020 2020 2320 5468 6520            # The 
-0001dda0: 6465 7363 7269 7074 696f 6e20 6d61 7920  description may 
-0001ddb0: 6265 2073 6f20 6c6f 6e67 2077 6520 6e65  be so long we ne
-0001ddc0: 6564 2074 6f20 7370 6c69 7420 6974 0a20  ed to split it. 
-0001ddd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dde0: 2020 2078 202b 3d20 636f 6c6f 6666 7365     x += coloffse
-0001ddf0: 7473 5b34 5d0a 2020 2020 2020 2020 2020  ts[4].          
-0001de00: 2020 2020 2020 2020 2020 6d69 6e5f 7820            min_x 
-0001de10: 3d20 780a 2020 2020 2020 2020 2020 2020  = x.            
-0001de20: 2020 2020 2020 2020 6d61 785f 7820 3d20          max_x = 
-0001de30: 7769 6474 6820 2d20 6d61 7267 696e 0a20  width - margin. 
-0001de40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001de50: 2020 2064 7320 3d20 726f 775b 365d 0a20     ds = row[6]. 
-0001de60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001de70: 2020 2069 6620 7820 2b20 646f 632e 6765     if x + doc.ge
-0001de80: 7454 6578 7457 6964 7468 2864 7329 203c  tTextWidth(ds) <
-0001de90: 3d20 6d61 785f 783a 0a20 2020 2020 2020  = max_x:.       
-0001dea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001deb0: 2064 6f63 2e74 6578 7428 6473 2c20 782c   doc.text(ds, x,
-0001dec0: 2079 202b 2072 6f77 6865 6967 6874 322c   y + rowheight2,
-0001ded0: 206c 6566 745f 6d69 6464 6c65 290a 2020   left_middle).  
-0001dee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001def0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0001df00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001df10: 775f 7370 6163 6520 3d20 646f 632e 6765  w_space = doc.ge
-0001df20: 7454 6578 7457 6964 7468 2822 2022 290a  tTextWidth(" ").
-0001df30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001df40: 2020 2020 2020 2020 666f 7220 776f 7264          for word
-0001df50: 2069 6e20 6473 2e73 706c 6974 2822 2022   in ds.split(" "
-0001df60: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0001df70: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0001df80: 203d 2064 6f63 2e67 6574 5465 7874 5769   = doc.getTextWi
-0001df90: 6474 6828 776f 7264 290a 2020 2020 2020  dth(word).      
-0001dfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dfb0: 2020 2020 2020 6966 2078 202b 2077 203e        if x + w >
-0001dfc0: 206d 6178 5f78 3a20 2023 206e 6565 6420   max_x:  # need 
-0001dfd0: 6e65 7720 6c69 6e65 0a20 2020 2020 2020  new line.       
-0001dfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dff0: 2020 2020 2020 2020 2078 203d 206d 696e           x = min
-0001e000: 5f78 0a20 2020 2020 2020 2020 2020 2020  _x.             
-0001e010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e020: 2020 2079 202b 3d20 726f 7768 6569 6768     y += rowheigh
-0001e030: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-0001e040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e050: 2020 646f 632e 7365 7446 696c 6c43 6f6c    doc.setFillCol
-0001e060: 6f72 2822 2366 3366 3366 3322 2069 6620  or("#f3f3f3" if 
-0001e070: 726f 776e 7220 2520 3220 656c 7365 2022  rownr % 2 else "
-0001e080: 2365 6165 6165 6122 290a 2020 2020 2020  #eaeaea").      
-0001e090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e0a0: 2020 2020 2020 2020 2020 646f 632e 7265            doc.re
-0001e0b0: 6374 286d 6172 6769 6e2c 2079 2c20 7769  ct(margin, y, wi
-0001e0c0: 6474 6820 2d20 3220 2a20 6d61 7267 696e  dth - 2 * margin
-0001e0d0: 2c20 726f 7768 6569 6768 742c 2022 4622  , rowheight, "F"
-0001e0e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001e0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e100: 2020 646f 632e 7365 7454 6578 7443 6f6c    doc.setTextCol
-0001e110: 6f72 2822 2330 3030 2229 0a20 2020 2020  or("#000").     
-0001e120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e130: 2020 2020 2020 2064 6f63 2e74 6578 7428         doc.text(
-0001e140: 776f 7264 2c20 782c 2079 202b 2072 6f77  word, x, y + row
-0001e150: 6865 6967 6874 322c 206c 6566 745f 6d69  height2, left_mi
-0001e160: 6464 6c65 290a 2020 2020 2020 2020 2020  ddle).          
-0001e170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e180: 2020 7820 2b3d 2077 202b 2077 5f73 7061    x += w + w_spa
-0001e190: 6365 0a20 2020 2020 2020 2020 2020 2020  ce.             
-0001e1a0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0001e1b0: 2020 2020 2020 2020 2020 2020 2064 6f63               doc
-0001e1c0: 2e73 6574 4669 6c6c 436f 6c6f 7228 2223  .setFillColor("#
-0001e1d0: 6666 6565 6565 2229 0a20 2020 2020 2020  ffeeee").       
-0001e1e0: 2020 2020 2020 2020 2020 2020 2064 6f63               doc
-0001e1f0: 2e72 6563 7428 6d61 7267 696e 2c20 792c  .rect(margin, y,
-0001e200: 2077 6964 7468 202d 2032 202a 206d 6172   width - 2 * mar
-0001e210: 6769 6e2c 2072 6f77 6865 6967 6874 2c20  gin, rowheight, 
-0001e220: 2246 2229 0a0a 2020 2020 2020 2020 2020  "F")..          
-0001e230: 2020 2020 2020 7920 2b3d 2072 6f77 6865        y += rowhe
-0001e240: 6967 6874 0a20 2020 2020 2020 2020 2020  ight.           
-0001e250: 2079 202b 3d20 726f 7773 6b69 700a 0a20   y += rowskip.. 
-0001e260: 2020 2020 2020 2023 2041 6464 2070 6167         # Add pag
-0001e270: 696e 6174 696f 6e0a 2020 2020 2020 2020  ination.        
-0001e280: 646f 632e 7365 7446 6f6e 7453 697a 6528  doc.setFontSize(
-0001e290: 3829 0a20 2020 2020 2020 2064 6f63 2e73  8).        doc.s
-0001e2a0: 6574 5465 7874 436f 6c6f 7228 2223 3535  etTextColor("#55
-0001e2b0: 3522 290a 2020 2020 2020 2020 666f 7220  5").        for 
-0001e2c0: 6920 696e 2072 616e 6765 286e 7061 6765  i in range(npage
-0001e2d0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-0001e2e0: 7061 6765 6e72 203d 2069 202b 2031 0a20  pagenr = i + 1. 
-0001e2f0: 2020 2020 2020 2020 2020 2064 6f63 2e73             doc.s
-0001e300: 6574 5061 6765 2870 6167 656e 7229 0a20  etPage(pagenr). 
-0001e310: 2020 2020 2020 2020 2020 2078 2c20 7920             x, y 
-0001e320: 3d20 7769 6474 6820 2d20 302e 3520 2a20  = width - 0.5 * 
-0001e330: 6d61 7267 696e 2c20 302e 3520 2a20 6d61  margin, 0.5 * ma
-0001e340: 7267 696e 0a20 2020 2020 2020 2020 2020  rgin.           
-0001e350: 2064 6f63 2e74 6578 7428 6622 7b70 6167   doc.text(f"{pag
-0001e360: 656e 727d 2f7b 6e70 6167 6573 7d22 2c20  enr}/{npages}", 
-0001e370: 782c 2079 2c20 7b22 616c 6967 6e22 3a20  x, y, {"align": 
-0001e380: 2272 6967 6874 222c 2022 6261 7365 6c69  "right", "baseli
-0001e390: 6e65 223a 2022 746f 7022 7d29 0a0a 2020  ne": "top"})..  
-0001e3a0: 2020 2020 2020 646f 632e 7361 7665 2873        doc.save(s
-0001e3b0: 656c 662e 5f67 6574 5f65 7870 6f72 745f  elf._get_export_
-0001e3c0: 6669 6c65 6e61 6d65 2822 7064 6622 2929  filename("pdf"))
-0001e3d0: 0a20 2020 2020 2020 2023 2064 6f63 2e6f  .        # doc.o
-0001e3e0: 7574 7075 7428 2764 6174 6175 726c 6e65  utput('dataurlne
-0001e3f0: 7777 696e 646f 7727 2920 2023 2068 616e  wwindow')  # han
-0001e400: 6479 2064 7572 696e 6720 6465 760a 0a0a  dy during dev...
-0001e410: 636c 6173 7320 4578 706f 7274 4469 616c  class ExportDial
-0001e420: 6f67 2842 6173 6544 6961 6c6f 6729 3a0a  og(BaseDialog):.
-0001e430: 2020 2020 2222 2244 6961 6c6f 6720 746f      """Dialog to
-0001e440: 2065 7870 6f72 7420 6461 7461 2e22 2222   export data."""
-0001e450: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
-0001e460: 5f5f 2873 656c 662c 2063 616e 7661 7329  __(self, canvas)
-0001e470: 3a0a 2020 2020 2020 2020 7375 7065 7228  :.        super(
-0001e480: 292e 5f5f 696e 6974 5f5f 2863 616e 7661  ).__init__(canva
-0001e490: 7329 0a20 2020 2020 2020 2073 656c 662e  s).        self.
-0001e4a0: 5f64 7466 6f72 6d61 7420 3d20 226c 6f63  _dtformat = "loc
-0001e4b0: 616c 220a 2020 2020 2020 2020 7365 6c66  al".        self
-0001e4c0: 2e5f 776f 726b 696e 6720 3d20 300a 0a20  ._working = 0.. 
-0001e4d0: 2020 2064 6566 206f 7065 6e28 7365 6c66     def open(self
-0001e4e0: 2c20 6361 6c6c 6261 636b 3d4e 6f6e 6529  , callback=None)
-0001e4f0: 3a0a 2020 2020 2020 2020 7365 6c66 2e6d  :.        self.m
-0001e500: 6169 6e64 6976 2e69 6e6e 6572 4854 4d4c  aindiv.innerHTML
-0001e510: 203d 2066 2222 220a 2020 2020 2020 2020   = f""".        
-0001e520: 2020 2020 3c68 313e 3c69 2063 6c61 7373      <h1><i class
-0001e530: 3d27 6661 7327 3e5c 7566 3536 653c 2f69  ='fas'>\uf56e</i
-0001e540: 3e26 6e62 7370 3b26 6e62 7370 3b45 7870  >&nbsp;&nbsp;Exp
-0001e550: 6f72 740a 2020 2020 2020 2020 2020 2020  ort.            
-0001e560: 2020 2020 3c62 7574 746f 6e20 7479 7065      <button type
-0001e570: 3d27 6275 7474 6f6e 273e 3c69 2063 6c61  ='button'><i cla
-0001e580: 7373 3d27 6661 7327 3e5c 7566 3030 643c  ss='fas'>\uf00d<
-0001e590: 2f69 3e3c 2f62 7574 746f 6e3e 0a20 2020  /i></button>.   
-0001e5a0: 2020 2020 2020 2020 203c 2f68 313e 0a20           </h1>. 
-0001e5b0: 2020 2020 2020 2020 2020 203c 703e 0a20             <p>. 
-0001e5c0: 2020 2020 2020 2020 2020 2054 6865 2074             The t
-0001e5d0: 6162 6c65 2062 656c 6f77 2063 6f6e 7461  able below conta
-0001e5e0: 696e 7320 616c 6c20 796f 7572 2072 6563  ins all your rec
-0001e5f0: 6f72 6473 2e20 5468 6973 2063 616e 2062  ords. This can b
-0001e600: 650a 2020 2020 2020 2020 2020 2020 7573  e.            us
-0001e610: 6566 756c 2066 6f72 2062 6163 6b75 7073  eful for backups
-0001e620: 2c20 7072 6f63 6573 7369 6e67 2c20 6f72  , processing, or
-0001e630: 2074 6f20 6d6f 7665 2079 6f75 7220 6461   to move your da
-0001e640: 7461 0a20 2020 2020 2020 2020 2020 2065  ta.            e
-0001e650: 6c73 6577 6865 7265 2e0a 2020 2020 2020  lsewhere..      
-0001e660: 2020 2020 2020 3c2f 703e 3c70 3e26 6e62        </p><p>&nb
-0001e670: 7370 3b3c 2f70 3e0a 2020 2020 2020 2020  sp;</p>.        
-0001e680: 2020 2020 3c64 6976 3e0a 2020 2020 2020      <div>.      
-0001e690: 2020 2020 2020 2020 2020 3c73 7061 6e3e            <span>
-0001e6a0: 4461 7465 2d74 696d 6520 666f 726d 6174  Date-time format
-0001e6b0: 3a3c 2f73 7061 6e3e 0a20 2020 2020 2020  :</span>.       
-0001e6c0: 2020 2020 2020 2020 2026 6e62 7370 3b3c           &nbsp;<
-0001e6d0: 696e 7075 7420 7479 7065 3d22 7261 6469  input type="radi
-0001e6e0: 6f22 206e 616d 653d 2264 7466 6f72 6d61  o" name="dtforma
-0001e6f0: 7422 2076 616c 7565 3d22 6c6f 6361 6c22  t" value="local"
-0001e700: 2063 6865 636b 6564 3e20 4c6f 6361 6c3c   checked> Local<
-0001e710: 2f69 6e70 7574 3e0a 2020 2020 2020 2020  /input>.        
-0001e720: 2020 2020 2020 2020 266e 6273 703b 3c69          &nbsp;<i
-0001e730: 6e70 7574 2074 7970 653d 2272 6164 696f  nput type="radio
-0001e740: 2220 6e61 6d65 3d22 6474 666f 726d 6174  " name="dtformat
-0001e750: 2220 7661 6c75 653d 2275 6e69 7822 3e20  " value="unix"> 
-0001e760: 556e 6978 3c2f 696e 7075 743e 0a20 2020  Unix</input>.   
-0001e770: 2020 2020 2020 2020 2020 2020 2026 6e62               &nb
-0001e780: 7370 3b3c 696e 7075 7420 7479 7065 3d22  sp;<input type="
-0001e790: 7261 6469 6f22 206e 616d 653d 2264 7466  radio" name="dtf
-0001e7a0: 6f72 6d61 7422 2076 616c 7565 3d22 6973  ormat" value="is
-0001e7b0: 6f22 3e20 4953 4f20 3836 3031 3c2f 696e  o"> ISO 8601</in
-0001e7c0: 7075 743e 0a20 2020 2020 2020 2020 2020  put>.           
-0001e7d0: 203c 2f64 6976 3e0a 2020 2020 2020 2020   </div>.        
-0001e7e0: 2020 2020 3c62 7574 746f 6e20 7479 7065      <button type
-0001e7f0: 3d27 6275 7474 6f6e 273e 436f 7079 3c2f  ='button'>Copy</
-0001e800: 6275 7474 6f6e 3e0a 2020 2020 2020 2020  button>.        
-0001e810: 2020 2020 3c68 7220 2f3e 0a20 2020 2020      <hr />.     
-0001e820: 2020 2020 2020 203c 7461 626c 6520 6964         <table id
-0001e830: 3d27 6578 706f 7274 5f74 6162 6c65 273e  ='export_table'>
-0001e840: 3c2f 7461 626c 653e 0a20 2020 2020 2020  </table>.       
-0001e850: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-0001e860: 2020 7365 6c66 2e5f 7461 626c 655f 656c    self._table_el
-0001e870: 656d 656e 7420 3d20 7365 6c66 2e6d 6169  ement = self.mai
-0001e880: 6e64 6976 2e63 6869 6c64 7265 6e5b 2d31  ndiv.children[-1
-0001e890: 5d0a 2020 2020 2020 2020 7365 6c66 2e5f  ].        self._
-0001e8a0: 7461 626c 655f 656c 656d 656e 742e 636c  table_element.cl
-0001e8b0: 6173 734c 6973 742e 6164 6428 2264 6172  assList.add("dar
-0001e8c0: 6b68 6561 6465 7273 2229 0a0a 2020 2020  kheaders")..    
-0001e8d0: 2020 2020 7365 6c66 2e5f 636f 7079 5f62      self._copy_b
-0001e8e0: 7574 203d 2073 656c 662e 6d61 696e 6469  ut = self.maindi
-0001e8f0: 762e 6368 696c 6472 656e 5b2d 335d 0a20  v.children[-3]. 
-0001e900: 2020 2020 2020 2073 656c 662e 5f63 6f70         self._cop
-0001e910: 795f 6275 742e 6f6e 636c 6963 6b20 3d20  y_but.onclick = 
-0001e920: 7365 6c66 2e5f 636f 7079 5f63 6c69 7062  self._copy_clipb
-0001e930: 6f61 7264 0a20 2020 2020 2020 2073 656c  oard.        sel
-0001e940: 662e 5f63 6f70 795f 6275 742e 6469 7361  f._copy_but.disa
-0001e950: 626c 6564 203d 2054 7275 650a 0a20 2020  bled = True..   
-0001e960: 2020 2020 2072 6164 696f 5f62 7574 746f       radio_butto
-0001e970: 6e73 203d 2073 656c 662e 6d61 696e 6469  ns = self.maindi
-0001e980: 762e 6368 696c 6472 656e 5b2d 345d 2e63  v.children[-4].c
-0001e990: 6869 6c64 7265 6e0a 2020 2020 2020 2020  hildren.        
-0001e9a0: 666f 7220 6920 696e 2072 616e 6765 2831  for i in range(1
-0001e9b0: 2c20 6c65 6e28 7261 6469 6f5f 6275 7474  , len(radio_butt
-0001e9c0: 6f6e 7329 293a 0a20 2020 2020 2020 2020  ons)):.         
-0001e9d0: 2020 2062 7574 203d 2072 6164 696f 5f62     but = radio_b
-0001e9e0: 7574 746f 6e73 5b69 5d0a 2020 2020 2020  uttons[i].      
-0001e9f0: 2020 2020 2020 6275 742e 6f6e 6368 616e        but.onchan
-0001ea00: 6765 203d 2073 656c 662e 5f6f 6e5f 6474  ge = self._on_dt
-0001ea10: 666f 726d 6174 0a0a 2020 2020 2020 2020  format..        
-0001ea20: 7365 6c66 2e5f 6361 6e63 656c 5f62 7574  self._cancel_but
-0001ea30: 203d 2073 656c 662e 6d61 696e 6469 762e   = self.maindiv.
-0001ea40: 6368 696c 6472 656e 5b30 5d2e 6368 696c  children[0].chil
-0001ea50: 6472 656e 5b2d 315d 0a20 2020 2020 2020  dren[-1].       
-0001ea60: 2073 656c 662e 5f63 616e 6365 6c5f 6275   self._cancel_bu
-0001ea70: 742e 6f6e 636c 6963 6b20 3d20 7365 6c66  t.onclick = self
-0001ea80: 2e63 6c6f 7365 0a20 2020 2020 2020 2073  .close.        s
-0001ea90: 7570 6572 2829 2e6f 7065 6e28 6361 6c6c  uper().open(call
-0001eaa0: 6261 636b 290a 0a20 2020 2020 2020 2073  back)..        s
-0001eab0: 656c 662e 6669 6c6c 5f72 6563 6f72 6473  elf.fill_records
-0001eac0: 2829 0a0a 2020 2020 6465 6620 5f6f 6e5f  ()..    def _on_
-0001ead0: 6474 666f 726d 6174 2873 656c 662c 2065  dtformat(self, e
-0001eae0: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
-0001eaf0: 5f64 7466 6f72 6d61 7420 3d20 652e 7461  _dtformat = e.ta
-0001eb00: 7267 6574 2e76 616c 7565 0a20 2020 2020  rget.value.     
-0001eb10: 2020 2073 656c 662e 6669 6c6c 5f72 6563     self.fill_rec
-0001eb20: 6f72 6473 2829 0a0a 2020 2020 6173 796e  ords()..    asyn
-0001eb30: 6320 6465 6620 6669 6c6c 5f72 6563 6f72  c def fill_recor
-0001eb40: 6473 2873 656c 6629 3a0a 2020 2020 2020  ds(self):.      
-0001eb50: 2020 7365 6c66 2e5f 776f 726b 696e 6720    self._working 
-0001eb60: 2b3d 2031 0a20 2020 2020 2020 2077 6f72  += 1.        wor
-0001eb70: 6b69 6e67 203d 2073 656c 662e 5f77 6f72  king = self._wor
-0001eb80: 6b69 6e67 0a20 2020 2020 2020 2061 7761  king.        awa
-0001eb90: 6974 2077 696e 646f 772e 746f 6f6c 732e  it window.tools.
-0001eba0: 736c 6565 706d 7328 3130 3029 0a0a 2020  sleepms(100)..  
-0001ebb0: 2020 2020 2020 2320 5072 6570 6172 650a        # Prepare.
-0001ebc0: 2020 2020 2020 2020 7365 6c66 2e5f 636f          self._co
-0001ebd0: 7079 5f62 7574 2e64 6973 6162 6c65 6420  py_but.disabled 
-0001ebe0: 3d20 5472 7565 0a20 2020 2020 2020 2069  = True.        i
-0001ebf0: 7465 6d73 6469 6374 203d 2077 696e 646f  temsdict = windo
-0001ec00: 772e 7374 6f72 652e 7265 636f 7264 732e  w.store.records.
-0001ec10: 5f69 7465 6d73 0a20 2020 2020 2020 206c  _items.        l
-0001ec20: 696e 6573 203d 205b 5d0a 0a20 2020 2020  ines = []..     
-0001ec30: 2020 2023 2041 6464 2068 6561 6465 720a     # Add header.
-0001ec40: 2020 2020 2020 2020 6c69 6e65 7061 7274          linepart
-0001ec50: 7320 3d20 5b22 6b65 7922 2c20 2273 7461  s = ["key", "sta
-0001ec60: 7274 222c 2022 7374 6f70 222c 2022 7461  rt", "stop", "ta
-0001ec70: 6773 222c 2022 6465 7363 7269 7074 696f  gs", "descriptio
-0001ec80: 6e22 5d0a 2020 2020 2020 2020 6c69 6e65  n"].        line
-0001ec90: 732e 6170 7065 6e64 2822 3c74 723e 3c74  s.append("<tr><t
-0001eca0: 683e 2220 2b20 6c69 6e65 7061 7274 732e  h>" + lineparts.
-0001ecb0: 6a6f 696e 2822 3c2f 7468 3e3c 7468 3e22  join("</th><th>"
-0001ecc0: 2920 2b20 223c 2f74 683e 3c2f 7472 3e22  ) + "</th></tr>"
-0001ecd0: 290a 0a20 2020 2020 2020 2023 2050 6172  )..        # Par
-0001ece0: 7365 2061 6c6c 2069 7465 6d73 0a20 2020  se all items.   
-0001ecf0: 2020 2020 2023 2054 616b 6520 6361 7265       # Take care
-0001ed00: 2074 6861 7420 6465 7363 7269 7074 696f   that descriptio
-0001ed10: 6e20 646f 6573 206e 6f74 2068 6176 6520  n does not have 
-0001ed20: 6e65 776c 696e 6573 206f 7220 7461 6273  newlines or tabs
-0001ed30: 2c20 7573 696e 6720 746f 5f73 7472 0a20  , using to_str. 
-0001ed40: 2020 2020 2020 2023 2057 6974 6820 7461         # With ta
-0001ed50: 622d 7365 7061 7261 7465 6420 7661 6c75  b-separated valu
-0001ed60: 6573 2069 7420 6973 206e 6f74 2063 6f6d  es it is not com
-0001ed70: 6d6f 6e20 746f 2073 7572 726f 756e 6420  mon to surround 
-0001ed80: 7661 6c75 6573 2069 6e20 7175 6f74 6573  values in quotes
-0001ed90: 2e0a 2020 2020 2020 2020 666f 7220 6b65  ..        for ke
-0001eda0: 7920 696e 2069 7465 6d73 6469 6374 2e6b  y in itemsdict.k
-0001edb0: 6579 7328 293a 0a20 2020 2020 2020 2020  eys():.         
-0001edc0: 2020 2069 7465 6d20 3d20 6974 656d 7364     item = itemsd
-0001edd0: 6963 745b 6b65 795d 0a20 2020 2020 2020  ict[key].       
-0001ede0: 2020 2020 2069 6620 6e6f 7420 7769 6e64       if not wind
-0001edf0: 6f77 2e73 746f 7265 732e 6973 5f68 6964  ow.stores.is_hid
-0001ee00: 6465 6e28 6974 656d 293a 0a20 2020 2020  den(item):.     
-0001ee10: 2020 2020 2020 2020 2020 2074 312c 2074             t1, t
-0001ee20: 3220 3d20 6974 656d 2e74 312c 2069 7465  2 = item.t1, ite
-0001ee30: 6d2e 7432 0a20 2020 2020 2020 2020 2020  m.t2.           
-0001ee40: 2020 2020 2069 6620 7365 6c66 2e5f 6474       if self._dt
-0001ee50: 666f 726d 6174 203d 3d20 226c 6f63 616c  format == "local
-0001ee60: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-0001ee70: 2020 2020 2020 2074 312c 2074 3220 3d20         t1, t2 = 
-0001ee80: 6474 2e74 696d 6532 6c6f 6361 6c73 7472  dt.time2localstr
-0001ee90: 2874 3129 2c20 6474 2e74 696d 6532 6c6f  (t1), dt.time2lo
-0001eea0: 6361 6c73 7472 2874 3229 0a20 2020 2020  calstr(t2).     
-0001eeb0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-0001eec0: 7365 6c66 2e5f 6474 666f 726d 6174 203d  self._dtformat =
-0001eed0: 3d20 2269 736f 223a 0a20 2020 2020 2020  = "iso":.       
-0001eee0: 2020 2020 2020 2020 2020 2020 2074 312c               t1,
-0001eef0: 2074 3220 3d20 6474 2e74 696d 6532 7374   t2 = dt.time2st
-0001ef00: 7228 7431 2c20 3029 2c20 6474 2e74 696d  r(t1, 0), dt.tim
-0001ef10: 6532 7374 7228 7432 2c20 3029 0a20 2020  e2str(t2, 0).   
-0001ef20: 2020 2020 2020 2020 2020 2020 206c 696e               lin
-0001ef30: 6570 6172 7473 203d 205b 0a20 2020 2020  eparts = [.     
-0001ef40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001ef50: 7465 6d2e 6b65 792c 0a20 2020 2020 2020  tem.key,.       
-0001ef60: 2020 2020 2020 2020 2020 2020 2074 312c               t1,
-0001ef70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ef80: 2020 2020 2074 322c 0a20 2020 2020 2020       t2,.       
-0001ef90: 2020 2020 2020 2020 2020 2020 2075 7469               uti
-0001efa0: 6c73 2e67 6574 5f74 6167 735f 616e 645f  ls.get_tags_and_
-0001efb0: 7061 7274 735f 6672 6f6d 5f73 7472 696e  parts_from_strin
-0001efc0: 6728 6974 656d 2e64 7329 5b30 5d2e 6a6f  g(item.ds)[0].jo
-0001efd0: 696e 2822 2022 292c 0a20 2020 2020 2020  in(" "),.       
-0001efe0: 2020 2020 2020 2020 2020 2020 2074 6f5f               to_
-0001eff0: 7374 7228 6974 656d 2e67 6574 2822 6473  str(item.get("ds
-0001f000: 222c 2022 2229 292c 0a20 2020 2020 2020  ", "")),.       
-0001f010: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
-0001f020: 2020 2020 2020 2020 2020 206c 696e 6573             lines
-0001f030: 2e61 7070 656e 6428 223c 7472 3e3c 7464  .append("<tr><td
-0001f040: 3e22 202b 206c 696e 6570 6172 7473 2e6a  >" + lineparts.j
-0001f050: 6f69 6e28 223c 2f74 643e 3c74 643e 2229  oin("</td><td>")
-0001f060: 202b 2022 3c2f 7464 3e3c 2f74 723e 2229   + "</td></tr>")
-0001f070: 0a20 2020 2020 2020 2020 2020 2023 2047  .            # G
-0001f080: 6976 6520 6665 6564 6261 636b 2077 6869  ive feedback whi
-0001f090: 6c65 2070 726f 6365 7373 696e 670a 2020  le processing.  
-0001f0a0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-0001f0b0: 286c 696e 6573 2920 2520 3235 3620 3d3d  (lines) % 256 ==
-0001f0c0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-0001f0d0: 2020 2020 7365 6c66 2e5f 636f 7079 5f62      self._copy_b
-0001f0e0: 7574 2e69 6e6e 6572 4854 4d4c 203d 2022  ut.innerHTML = "
-0001f0f0: 466f 756e 6420 2220 2b20 6c65 6e28 6c69  Found " + len(li
-0001f100: 6e65 7329 202b 2022 2072 6563 6f72 6473  nes) + " records
-0001f110: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0001f120: 2020 2320 7365 6c66 2e5f 7461 626c 655f    # self._table_
-0001f130: 656c 656d 656e 742e 696e 6e65 7248 544d  element.innerHTM
-0001f140: 4c20 3d20 6c69 6e65 732e 6a6f 696e 2822  L = lines.join("
-0001f150: 5c6e 2229 0a20 2020 2020 2020 2020 2020  \n").           
-0001f160: 2020 2020 2061 7761 6974 2077 696e 646f       await windo
-0001f170: 772e 746f 6f6c 732e 736c 6565 706d 7328  w.tools.sleepms(
-0001f180: 3129 0a20 2020 2020 2020 2020 2020 2069  1).            i
-0001f190: 6620 776f 726b 696e 6720 213d 2073 656c  f working != sel
-0001f1a0: 662e 5f77 6f72 6b69 6e67 3a0a 2020 2020  f._working:.    
-0001f1b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001f1c0: 726e 0a0a 2020 2020 2020 2020 2320 446f  rn..        # Do
-0001f1d0: 6e65 0a20 2020 2020 2020 2073 656c 662e  ne.        self.
-0001f1e0: 5f63 6f70 795f 6275 742e 696e 6e65 7248  _copy_but.innerH
-0001f1f0: 544d 4c20 3d20 2243 6f70 7920 6578 706f  TML = "Copy expo
-0001f200: 7274 2d74 6162 6c65 203c 6920 636c 6173  rt-table <i clas
-0001f210: 733d 2766 6173 273e 5c75 6630 6561 3c2f  s='fas'>\uf0ea</
-0001f220: 693e 220a 2020 2020 2020 2020 7365 6c66  i>".        self
-0001f230: 2e5f 7461 626c 655f 656c 656d 656e 742e  ._table_element.
-0001f240: 696e 6e65 7248 544d 4c20 3d20 6c69 6e65  innerHTML = line
-0001f250: 732e 6a6f 696e 2822 5c6e 2229 0a20 2020  s.join("\n").   
-0001f260: 2020 2020 2073 656c 662e 5f63 6f70 795f       self._copy_
-0001f270: 6275 742e 6469 7361 626c 6564 203d 2046  but.disabled = F
-0001f280: 616c 7365 0a0a 2020 2020 6465 6620 5f63  alse..    def _c
-0001f290: 6f70 795f 636c 6970 626f 6172 6428 7365  opy_clipboard(se
-0001f2a0: 6c66 293a 0a20 2020 2020 2020 2074 6162  lf):.        tab
-0001f2b0: 6c65 203d 2073 656c 662e 6d61 696e 6469  le = self.maindi
-0001f2c0: 762e 6368 696c 6472 656e 5b2d 315d 0a20  v.children[-1]. 
-0001f2d0: 2020 2020 2020 2074 6f6f 6c73 2e63 6f70         tools.cop
-0001f2e0: 795f 646f 6d5f 6e6f 6465 2874 6162 6c65  y_dom_node(table
-0001f2f0: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
-0001f300: 636f 7079 5f62 7574 2e69 6e6e 6572 4854  copy_but.innerHT
-0001f310: 4d4c 203d 2022 436f 7079 2065 7870 6f72  ML = "Copy expor
-0001f320: 742d 7461 626c 6520 3c69 2063 6c61 7373  t-table <i class
-0001f330: 3d27 6661 7327 3e5c 7566 3436 633c 2f69  ='fas'>\uf46c</i
-0001f340: 3e22 0a20 2020 2020 2020 2077 696e 646f  >".        windo
-0001f350: 772e 7365 7454 696d 656f 7574 2873 656c  w.setTimeout(sel
-0001f360: 662e 5f72 6573 6574 5f63 6f70 795f 6275  f._reset_copy_bu
-0001f370: 745f 7465 7874 2c20 3830 3029 0a0a 2020  t_text, 800)..  
-0001f380: 2020 6465 6620 5f72 6573 6574 5f63 6f70    def _reset_cop
-0001f390: 795f 6275 745f 7465 7874 2873 656c 6629  y_but_text(self)
-0001f3a0: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
-0001f3b0: 636f 7079 5f62 7574 2e69 6e6e 6572 4854  copy_but.innerHT
-0001f3c0: 4d4c 203d 2022 436f 7079 2065 7870 6f72  ML = "Copy expor
-0001f3d0: 742d 7461 626c 6520 3c69 2063 6c61 7373  t-table <i class
-0001f3e0: 3d27 6661 7327 3e5c 7566 3065 613c 2f69  ='fas'>\uf0ea</i
-0001f3f0: 3e22 0a0a 0a63 6c61 7373 2049 6d70 6f72  >"...class Impor
-0001f400: 7444 6961 6c6f 6728 4261 7365 4469 616c  tDialog(BaseDial
-0001f410: 6f67 293a 0a20 2020 2022 2222 4469 616c  og):.    """Dial
-0001f420: 6f67 2074 6f20 696d 706f 7274 2064 6174  og to import dat
-0001f430: 612e 2222 220a 0a20 2020 2064 6566 205f  a."""..    def _
-0001f440: 5f69 6e69 745f 5f28 7365 6c66 2c20 6361  _init__(self, ca
-0001f450: 6e76 6173 293a 0a20 2020 2020 2020 2073  nvas):.        s
-0001f460: 7570 6572 2829 2e5f 5f69 6e69 745f 5f28  uper().__init__(
-0001f470: 6361 6e76 6173 290a 0a20 2020 2064 6566  canvas)..    def
-0001f480: 206f 7065 6e28 7365 6c66 2c20 6361 6c6c   open(self, call
-0001f490: 6261 636b 3d4e 6f6e 6529 3a0a 2020 2020  back=None):.    
-0001f4a0: 2020 2020 7365 6c66 2e6d 6169 6e64 6976      self.maindiv
-0001f4b0: 2e69 6e6e 6572 4854 4d4c 203d 2066 2222  .innerHTML = f""
-0001f4c0: 220a 2020 2020 2020 2020 2020 2020 3c68  ".            <h
-0001f4d0: 313e 3c69 2063 6c61 7373 3d27 6661 7327  1><i class='fas'
-0001f4e0: 3e5c 7566 3536 663c 2f69 3e26 6e62 7370  >\uf56f</i>&nbsp
-0001f4f0: 3b26 6e62 7370 3b49 6d70 6f72 740a 2020  ;&nbsp;Import.  
-0001f500: 2020 2020 2020 2020 2020 2020 2020 3c62                <b
-0001f510: 7574 746f 6e20 7479 7065 3d27 6275 7474  utton type='butt
-0001f520: 6f6e 273e 3c69 2063 6c61 7373 3d27 6661  on'><i class='fa
-0001f530: 7327 3e5c 7566 3030 643c 2f69 3e3c 2f62  s'>\uf00d</i></b
-0001f540: 7574 746f 6e3e 0a20 2020 2020 2020 2020  utton>.         
-0001f550: 2020 203c 2f68 313e 0a20 2020 2020 2020     </h1>.       
-0001f560: 2020 2020 203c 703e 0a20 2020 2020 2020       <p>.       
-0001f570: 2020 2020 2043 6f70 7920 796f 7572 2074       Copy your t
-0001f580: 6162 6c65 2064 6174 6120 2866 726f 6d20  able data (from 
-0001f590: 652e 672e 2061 2043 5356 2066 696c 652c  e.g. a CSV file,
-0001f5a0: 2061 2074 6578 7420 6669 6c65 2c20 6f72   a text file, or
-0001f5b0: 0a20 2020 2020 2020 2020 2020 2064 6972  .            dir
-0001f5c0: 6563 746c 7920 6672 6f6d 2045 7863 656c  ectly from Excel
-0001f5d0: 2920 616e 6420 7061 7374 6520 6974 2069  ) and paste it i
-0001f5e0: 6e20 7468 6520 7465 7874 2066 6965 6c64  n the text field
-0001f5f0: 2062 656c 6f77 2e0a 2020 2020 2020 2020   below..        
-0001f600: 2020 2020 4353 5620 6669 6c65 7320 6361      CSV files ca
-0001f610: 6e20 6265 2064 7261 6767 6564 2069 6e74  n be dragged int
-0001f620: 6f20 7468 6520 7465 7874 2066 6965 6c64  o the text field
-0001f630: 2e0a 2020 2020 2020 2020 2020 2020 5365  ..            Se
-0001f640: 6520 3c61 2068 7265 663d 2768 7474 7073  e <a href='https
-0001f650: 3a2f 2f74 696d 6574 6167 6765 722e 6170  ://timetagger.ap
-0001f660: 702f 6172 7469 636c 6573 2f69 6d70 6f72  p/articles/impor
-0001f670: 7469 6e67 2f27 3e74 6869 7320 6172 7469  ting/'>this arti
-0001f680: 636c 653c 2f61 3e0a 2020 2020 2020 2020  cle</a>.        
-0001f690: 2020 2020 666f 7220 6465 7461 696c 732e      for details.
-0001f6a0: 0a20 2020 2020 2020 2020 2020 203c 2f70  .            </p
-0001f6b0: 3e3c 703e 266e 6273 703b 3c2f 703e 0a20  ><p>&nbsp;</p>. 
-0001f6c0: 2020 2020 2020 2020 2020 203c 6275 7474             <butt
-0001f6d0: 6f6e 2074 7970 653d 2762 7574 746f 6e27  on type='button'
-0001f6e0: 3e41 6e61 6c79 7365 3c2f 6275 7474 6f6e  >Analyse</button
-0001f6f0: 3e0a 2020 2020 2020 2020 2020 2020 3c62  >.            <b
-0001f700: 7574 746f 6e20 7479 7065 3d27 6275 7474  utton type='butt
-0001f710: 6f6e 273e 496d 706f 7274 3c2f 6275 7474  on'>Import</butt
-0001f720: 6f6e 3e0a 2020 2020 2020 2020 2020 2020  on>.            
-0001f730: 3c68 7220 2f3e 0a20 2020 2020 2020 2020  <hr />.         
-0001f740: 2020 203c 6469 763e 3c2f 6469 763e 0a20     <div></div>. 
-0001f750: 2020 2020 2020 2020 2020 203c 7465 7874             <text
-0001f760: 6172 6561 2072 6f77 733d 2731 3227 0a20  area rows='12'. 
-0001f770: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001f780: 7479 6c65 3d27 6261 636b 6772 6f75 6e64  tyle='background
-0001f790: 3a20 2366 6666 3b20 6469 7370 6c61 793a  : #fff; display:
-0001f7a0: 2062 6c6f 636b 3b20 6d61 7267 696e 3a20   block; margin: 
-0001f7b0: 302e 3565 6d3b 2077 6964 7468 3a20 6361  0.5em; width: ca
-0001f7c0: 6c63 2831 3030 2520 2d20 312e 3565 6d29  lc(100% - 1.5em)
-0001f7d0: 3b27 3e0a 2020 2020 2020 2020 2020 2020  ;'>.            
-0001f7e0: 3c2f 7465 7874 6172 6561 3e0a 2020 2020  </textarea>.    
-0001f7f0: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-0001f800: 2020 2020 2073 656c 662e 5f69 6e70 7574       self._input
-0001f810: 5f65 6c65 6d65 6e74 203d 2073 656c 662e  _element = self.
-0001f820: 6d61 696e 6469 762e 6368 696c 6472 656e  maindiv.children
-0001f830: 5b2d 315d 0a20 2020 2020 2020 2073 656c  [-1].        sel
-0001f840: 662e 5f69 6e70 7574 5f65 6c65 6d65 6e74  f._input_element
-0001f850: 2e76 616c 7565 203d 2022 220a 2020 2020  .value = "".    
-0001f860: 2020 2020 7365 6c66 2e5f 696e 7075 745f      self._input_
-0001f870: 656c 656d 656e 742e 6f6e 6472 6167 6578  element.ondragex
-0001f880: 6974 203d 2073 656c 662e 5f6f 6e5f 6472  it = self._on_dr
-0001f890: 6f70 5f73 746f 700a 2020 2020 2020 2020  op_stop.        
-0001f8a0: 7365 6c66 2e5f 696e 7075 745f 656c 656d  self._input_elem
-0001f8b0: 656e 742e 6f6e 6472 6167 6f76 6572 203d  ent.ondragover =
-0001f8c0: 2073 656c 662e 5f6f 6e5f 6472 6f70 5f6f   self._on_drop_o
-0001f8d0: 7665 720a 2020 2020 2020 2020 7365 6c66  ver.        self
-0001f8e0: 2e5f 696e 7075 745f 656c 656d 656e 742e  ._input_element.
-0001f8f0: 6f6e 6472 6f70 203d 2073 656c 662e 5f6f  ondrop = self._o
-0001f900: 6e5f 6472 6f70 0a0a 2020 2020 2020 2020  n_drop..        
-0001f910: 6966 206e 6f74 2028 0a20 2020 2020 2020  if not (.       
-0001f920: 2020 2020 2077 696e 646f 772e 7374 6f72       window.stor
-0001f930: 652e 5f5f 6e61 6d65 5f5f 2e73 7461 7274  e.__name__.start
-0001f940: 7377 6974 6828 2244 656d 6f22 290a 2020  swith("Demo").  
-0001f950: 2020 2020 2020 2020 2020 6f72 2077 696e            or win
-0001f960: 646f 772e 7374 6f72 652e 5f5f 6e61 6d65  dow.store.__name
-0001f970: 5f5f 2e73 7461 7274 7377 6974 6828 2253  __.startswith("S
-0001f980: 616e 6462 6f78 2229 0a20 2020 2020 2020  andbox").       
-0001f990: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
-0001f9a0: 6d61 696e 7465 7874 203d 2073 656c 662e  maintext = self.
-0001f9b0: 6d61 696e 6469 762e 6368 696c 6472 656e  maindiv.children
-0001f9c0: 5b32 5d0a 2020 2020 2020 2020 2020 2020  [2].            
-0001f9d0: 6d61 696e 7465 7874 2e69 6e6e 6572 4854  maintext.innerHT
-0001f9e0: 4d4c 202b 3d20 2222 220a 2020 2020 2020  ML += """.      
-0001f9f0: 2020 2020 2020 2020 2020 436f 6e73 6964            Consid
-0001fa00: 6572 2069 6d70 6f72 7469 6e67 2069 6e74  er importing int
-0001fa10: 6f20 7468 650a 2020 2020 2020 2020 2020  o the.          
-0001fa20: 2020 2020 2020 3c61 2074 6172 6765 743d        <a target=
-0001fa30: 276e 6577 2720 6872 6566 3d27 7361 6e64  'new' href='sand
-0001fa40: 626f 7827 3e53 616e 6462 6f78 3c2f 613e  box'>Sandbox</a>
-0001fa50: 2066 6972 7374 2e0a 2020 2020 2020 2020   first..        
-0001fa60: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-0001fa70: 2020 2020 2073 656c 662e 5f61 6e61 6c79       self._analy
-0001fa80: 7369 735f 6f75 7420 3d20 7365 6c66 2e6d  sis_out = self.m
-0001fa90: 6169 6e64 6976 2e63 6869 6c64 7265 6e5b  aindiv.children[
-0001faa0: 2d32 5d0a 0a20 2020 2020 2020 2073 656c  -2]..        sel
-0001fab0: 662e 5f61 6e61 6c79 7365 5f62 7574 203d  f._analyse_but =
-0001fac0: 2073 656c 662e 6d61 696e 6469 762e 6368   self.maindiv.ch
-0001fad0: 696c 6472 656e 5b33 5d0a 2020 2020 2020  ildren[3].      
-0001fae0: 2020 7365 6c66 2e5f 616e 616c 7973 655f    self._analyse_
-0001faf0: 6275 742e 6f6e 636c 6963 6b20 3d20 7365  but.onclick = se
-0001fb00: 6c66 2e64 6f5f 616e 616c 7973 650a 2020  lf.do_analyse.  
-0001fb10: 2020 2020 2020 7365 6c66 2e5f 696d 706f        self._impo
-0001fb20: 7274 5f62 7574 203d 2073 656c 662e 6d61  rt_but = self.ma
-0001fb30: 696e 6469 762e 6368 696c 6472 656e 5b34  indiv.children[4
-0001fb40: 5d0a 2020 2020 2020 2020 7365 6c66 2e5f  ].        self._
-0001fb50: 696d 706f 7274 5f62 7574 2e6f 6e63 6c69  import_but.oncli
-0001fb60: 636b 203d 2073 656c 662e 646f 5f69 6d70  ck = self.do_imp
-0001fb70: 6f72 740a 2020 2020 2020 2020 7365 6c66  ort.        self
-0001fb80: 2e5f 696d 706f 7274 5f62 7574 2e64 6973  ._import_but.dis
-0001fb90: 6162 6c65 6420 3d20 5472 7565 0a0a 2020  abled = True..  
-0001fba0: 2020 2020 2020 7365 6c66 2e5f 6361 6e63        self._canc
-0001fbb0: 656c 5f62 7574 203d 2073 656c 662e 6d61  el_but = self.ma
-0001fbc0: 696e 6469 762e 6368 696c 6472 656e 5b30  indiv.children[0
-0001fbd0: 5d2e 6368 696c 6472 656e 5b2d 315d 0a20  ].children[-1]. 
-0001fbe0: 2020 2020 2020 2073 656c 662e 5f63 616e         self._can
-0001fbf0: 6365 6c5f 6275 742e 6f6e 636c 6963 6b20  cel_but.onclick 
-0001fc00: 3d20 7365 6c66 2e63 6c6f 7365 0a20 2020  = self.close.   
-0001fc10: 2020 2020 2073 7570 6572 2829 2e6f 7065       super().ope
-0001fc20: 6e28 6361 6c6c 6261 636b 290a 0a20 2020  n(callback)..   
-0001fc30: 2064 6566 205f 6f6e 5f64 726f 705f 7374   def _on_drop_st
-0001fc40: 6f70 2873 656c 662c 2065 7629 3a0a 2020  op(self, ev):.  
-0001fc50: 2020 2020 2020 7365 6c66 2e5f 696e 7075        self._inpu
-0001fc60: 745f 656c 656d 656e 742e 7374 796c 652e  t_element.style.
-0001fc70: 6261 636b 6772 6f75 6e64 203d 204e 6f6e  background = Non
-0001fc80: 650a 0a20 2020 2064 6566 205f 6f6e 5f64  e..    def _on_d
-0001fc90: 726f 705f 6f76 6572 2873 656c 662c 2065  rop_over(self, e
-0001fca0: 7629 3a0a 2020 2020 2020 2020 6576 2e70  v):.        ev.p
-0001fcb0: 7265 7665 6e74 4465 6661 756c 7428 290a  reventDefault().
-0001fcc0: 2020 2020 2020 2020 7365 6c66 2e5f 696e          self._in
-0001fcd0: 7075 745f 656c 656d 656e 742e 7374 796c  put_element.styl
-0001fce0: 652e 6261 636b 6772 6f75 6e64 203d 2022  e.background = "
-0001fcf0: 2344 4644 220a 0a20 2020 2064 6566 205f  #DFD"..    def _
-0001fd00: 6f6e 5f64 726f 7028 7365 6c66 2c20 6576  on_drop(self, ev
-0001fd10: 293a 0a20 2020 2020 2020 2065 762e 7072  ):.        ev.pr
-0001fd20: 6576 656e 7444 6566 6175 6c74 2829 0a20  eventDefault(). 
-0001fd30: 2020 2020 2020 2073 656c 662e 5f6f 6e5f         self._on_
-0001fd40: 6472 6f70 5f73 746f 7028 290a 0a20 2020  drop_stop()..   
-0001fd50: 2020 2020 2064 6566 2061 7070 6c79 5f74       def apply_t
-0001fd60: 6578 7428 7329 3a0a 2020 2020 2020 2020  ext(s):.        
-0001fd70: 2020 2020 7365 6c66 2e5f 696e 7075 745f      self._input_
-0001fd80: 656c 656d 656e 742e 7661 6c75 6520 3d20  element.value = 
-0001fd90: 730a 0a20 2020 2020 2020 2069 6620 6576  s..        if ev
-0001fda0: 2e64 6174 6154 7261 6e73 6665 722e 6974  .dataTransfer.it
-0001fdb0: 656d 733a 0a20 2020 2020 2020 2020 2020  ems:.           
-0001fdc0: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-0001fdd0: 6c65 6e28 6576 2e64 6174 6154 7261 6e73  len(ev.dataTrans
-0001fde0: 6665 722e 6974 656d 7329 293a 0a20 2020  fer.items)):.   
-0001fdf0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001fe00: 6576 2e64 6174 6154 7261 6e73 6665 722e  ev.dataTransfer.
-0001fe10: 6974 656d 735b 695d 2e6b 696e 6420 3d3d  items[i].kind ==
-0001fe20: 2022 6669 6c65 223a 0a20 2020 2020 2020   "file":.       
-0001fe30: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-0001fe40: 6520 3d20 6576 2e64 6174 6154 7261 6e73  e = ev.dataTrans
-0001fe50: 6665 722e 6974 656d 735b 695d 2e67 6574  fer.items[i].get
-0001fe60: 4173 4669 6c65 2829 0a20 2020 2020 2020  AsFile().       
-0001fe70: 2020 2020 2020 2020 2020 2020 2065 7874               ext
-0001fe80: 203d 2066 696c 652e 6e61 6d65 2e6c 6f77   = file.name.low
-0001fe90: 6572 2829 2e73 706c 6974 2822 2e22 295b  er().split(".")[
-0001fea0: 2d31 5d0a 2020 2020 2020 2020 2020 2020  -1].            
-0001feb0: 2020 2020 2020 2020 6966 2065 7874 2069          if ext i
-0001fec0: 6e20 2822 786c 7322 2c20 2278 6c73 7822  n ("xls", "xlsx"
-0001fed0: 2c20 2278 6c73 6d22 2c20 2270 6466 2229  , "xlsm", "pdf")
-0001fee0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001fef0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0001ff00: 616e 616c 7973 6973 5f6f 7574 2e69 6e6e  analysis_out.inn
-0001ff10: 6572 4854 4d4c 203d 2028 0a20 2020 2020  erHTML = (.     
-0001ff20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ff30: 2020 2020 2020 2066 2243 616e 6e6f 7420         f"Cannot 
-0001ff40: 7072 6f63 6573 7320 3c75 3e7b 6669 6c65  process <u>{file
-0001ff50: 2e6e 616d 657d 3c2f 753e 2e20 4472 6f70  .name}</u>. Drop
-0001ff60: 2061 202e 6373 7620 6669 6c65 206f 7220   a .csv file or 
-0001ff70: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0001ff80: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-0001ff90: 6622 636f 7079 2074 6865 2063 6f6c 756d  f"copy the colum
-0001ffa0: 6e73 2069 6e20 4578 6365 6c20 616e 6420  ns in Excel and 
-0001ffb0: 7061 7374 6520 6865 7265 2e22 0a20 2020  paste here.".   
-0001ffc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ffd0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0001ffe0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0001fff0: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
-00020000: 2020 2020 2020 2020 2020 2020 7265 6164              read
-00020010: 6572 203d 2077 696e 646f 772e 4669 6c65  er = window.File
-00020020: 5265 6164 6572 2829 0a20 2020 2020 2020  Reader().       
-00020030: 2020 2020 2020 2020 2020 2020 2072 6561               rea
-00020040: 6465 722e 6f6e 6c6f 6164 203d 206c 616d  der.onload = lam
-00020050: 6264 613a 2061 7070 6c79 5f74 6578 7428  bda: apply_text(
-00020060: 7265 6164 6572 2e72 6573 756c 7429 0a20  reader.result). 
-00020070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020080: 2020 2072 6561 6465 722e 7265 6164 4173     reader.readAs
-00020090: 5465 7874 2866 696c 6529 0a20 2020 2020  Text(file).     
-000200a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000200b0: 656c 662e 5f61 6e61 6c79 7369 735f 6f75  elf._analysis_ou
-000200c0: 742e 696e 6e65 7248 544d 4c20 3d20 6622  t.innerHTML = f"
-000200d0: 5265 6164 2066 726f 6d20 3c75 3e7b 6669  Read from <u>{fi
-000200e0: 6c65 2e6e 616d 657d 3c2f 753e 220a 2020  le.name}</u>".  
-000200f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020100: 2020 6272 6561 6b20 2023 206f 6e6c 7920    break  # only 
-00020110: 7072 6f63 6573 7320 6669 7273 7420 6f6e  process first on
-00020120: 650a 0a20 2020 2061 7379 6e63 2064 6566  e..    async def
-00020130: 2064 6f5f 616e 616c 7973 6528 7365 6c66   do_analyse(self
-00020140: 293a 0a20 2020 2020 2020 2022 2222 416e  ):.        """An
-00020150: 616c 797a 6520 696e 636f 6d69 6e67 2064  alyze incoming d
-00020160: 6174 6120 2e2e 2e22 2222 0a20 2020 2020  ata ...""".     
-00020170: 2020 2069 6620 7365 6c66 2e5f 616e 616c     if self._anal
-00020180: 797a 696e 673a 0a20 2020 2020 2020 2020  yzing:.         
-00020190: 2020 2072 6574 7572 6e0a 0a20 2020 2020     return..     
-000201a0: 2020 2023 2050 7265 7061 7265 0a20 2020     # Prepare.   
-000201b0: 2020 2020 2073 656c 662e 5f61 6e61 6c79       self._analy
-000201c0: 7a69 6e67 203d 2054 7275 650a 2020 2020  zing = True.    
-000201d0: 2020 2020 7365 6c66 2e5f 696d 706f 7274      self._import
-000201e0: 5f62 7574 2e64 6973 6162 6c65 6420 3d20  _but.disabled = 
-000201f0: 5472 7565 0a20 2020 2020 2020 2073 656c  True.        sel
-00020200: 662e 5f69 6d70 6f72 745f 6275 742e 696e  f._import_but.in
-00020210: 6e65 7248 544d 4c20 3d20 2249 6d70 6f72  nerHTML = "Impor
-00020220: 7422 0a20 2020 2020 2020 2073 656c 662e  t".        self.
-00020230: 5f72 6563 6f72 6473 3269 6d70 6f72 7420  _records2import 
-00020240: 3d20 5b5d 0a20 2020 2020 2020 2023 2052  = [].        # R
-00020250: 756e 0a20 2020 2020 2020 2074 7279 3a0a  un.        try:.
-00020260: 2020 2020 2020 2020 2020 2020 6177 6169              awai
-00020270: 7420 7365 6c66 2e5f 646f 5f61 6e61 6c79  t self._do_analy
-00020280: 7365 2829 0a20 2020 2020 2020 2065 7863  se().        exc
-00020290: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
-000202a0: 2065 7272 3a0a 2020 2020 2020 2020 2020   err:.          
-000202b0: 2020 636f 6e73 6f6c 652e 7761 726e 2873    console.warn(s
-000202c0: 7472 2865 7272 2929 0a20 2020 2020 2020  tr(err)).       
-000202d0: 2023 2052 6573 746f 7265 0a20 2020 2020   # Restore.     
-000202e0: 2020 2073 656c 662e 5f61 6e61 6c79 7a69     self._analyzi
-000202f0: 6e67 203d 2046 616c 7365 0a20 2020 2020  ng = False.     
-00020300: 2020 2073 656c 662e 5f69 6d70 6f72 745f     self._import_
-00020310: 6275 742e 696e 6e65 7248 544d 4c20 3d20  but.innerHTML = 
-00020320: 2249 6d70 6f72 7422 0a20 2020 2020 2020  "Import".       
-00020330: 2069 6620 6c65 6e28 7365 6c66 2e5f 7265   if len(self._re
-00020340: 636f 7264 7332 696d 706f 7274 2920 3e20  cords2import) > 
-00020350: 303a 0a20 2020 2020 2020 2020 2020 2073  0:.            s
-00020360: 656c 662e 5f69 6d70 6f72 745f 6275 742e  elf._import_but.
-00020370: 6469 7361 626c 6564 203d 2046 616c 7365  disabled = False
-00020380: 0a0a 2020 2020 6173 796e 6320 6465 6620  ..    async def 
-00020390: 5f64 6f5f 616e 616c 7973 6528 7365 6c66  _do_analyse(self
-000203a0: 293a 0a20 2020 2020 2020 2067 6c6f 6261  ):.        globa
-000203b0: 6c20 4a53 4f4e 0a0a 2020 2020 2020 2020  l JSON..        
-000203c0: 6465 6620 6c6f 6728 7329 3a0a 2020 2020  def log(s):.    
-000203d0: 2020 2020 2020 2020 7365 6c66 2e5f 616e          self._an
-000203e0: 616c 7973 6973 5f6f 7574 2e69 6e6e 6572  alysis_out.inner
-000203f0: 4854 4d4c 202b 3d20 7320 2b20 223c 6272  HTML += s + "<br
-00020400: 202f 3e22 0a0a 2020 2020 2020 2020 2320   />"..        # 
-00020410: 496e 6974 0a20 2020 2020 2020 2073 656c  Init.        sel
-00020420: 662e 5f61 6e61 6c79 7369 735f 6f75 742e  f._analysis_out.
-00020430: 696e 6e65 7248 544d 4c20 3d20 2222 0a20  innerHTML = "". 
-00020440: 2020 2020 2020 2074 6578 7420 3d20 7365         text = se
-00020450: 6c66 2e5f 696e 7075 745f 656c 656d 656e  lf._input_elemen
-00020460: 742e 7661 6c75 652e 6c73 7472 6970 2829  t.value.lstrip()
-00020470: 0a20 2020 2020 2020 2068 6561 6465 722c  .        header,
-00020480: 2074 6578 7420 3d20 7465 7874 2e6c 7374   text = text.lst
-00020490: 7269 7028 292e 7370 6c69 7428 225c 6e22  rip().split("\n"
-000204a0: 2c20 3129 0a20 2020 2020 2020 2068 6561  , 1).        hea
-000204b0: 6465 7220 3d20 6865 6164 6572 2e73 7472  der = header.str
-000204c0: 6970 2829 0a20 2020 2020 2020 2074 6578  ip().        tex
-000204d0: 7420 3d20 7465 7874 206f 7220 2222 0a0a  t = text or ""..
-000204e0: 2020 2020 2020 2020 2320 5061 7273 6520          # Parse 
-000204f0: 6865 6164 6572 2074 6f20 6765 7420 7365  header to get se
-00020500: 7061 746f 720a 2020 2020 2020 2020 7365  pator.        se
-00020510: 702c 2073 6570 6e61 6d65 2c20 7365 7063  p, sepname, sepc
-00020520: 6f75 6e74 203d 2022 222c 2022 222c 2030  ount = "", "", 0
-00020530: 0a20 2020 2020 2020 2066 6f72 2078 2c20  .        for x, 
-00020540: 6e61 6d65 2069 6e20 5b28 225c 7422 2c20  name in [("\t", 
-00020550: 2274 6162 2229 2c20 2822 2c22 2c20 2263  "tab"), (",", "c
-00020560: 6f6d 6d61 2229 2c20 2822 3b22 2c20 2273  omma"), (";", "s
-00020570: 656d 6963 6f6c 6f6e 2229 5d3a 0a20 2020  emicolon")]:.   
-00020580: 2020 2020 2020 2020 2069 6620 6865 6164           if head
-00020590: 6572 2e63 6f75 6e74 2878 2920 3e20 7365  er.count(x) > se
-000205a0: 7063 6f75 6e74 3a0a 2020 2020 2020 2020  pcount:.        
-000205b0: 2020 2020 2020 2020 7365 702c 2073 6570          sep, sep
-000205c0: 6e61 6d65 2c20 7365 7063 6f75 6e74 203d  name, sepcount =
-000205d0: 2078 2c20 6e61 6d65 2c20 6865 6164 6572   x, name, header
-000205e0: 2e63 6f75 6e74 2878 290a 2020 2020 2020  .count(x).      
-000205f0: 2020 6966 206e 6f74 2068 6561 6465 723a    if not header:
-00020600: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
-00020610: 2822 4e6f 2064 6174 6122 290a 2020 2020  ("No data").    
-00020620: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
-00020630: 2020 2020 2020 2065 6c69 6620 6e6f 7420         elif not 
-00020640: 7365 7063 6f75 6e74 206f 7220 6e6f 7420  sepcount or not 
-00020650: 7365 703a 0a20 2020 2020 2020 2020 2020  sep:.           
-00020660: 206c 6f67 2822 436f 756c 6420 6e6f 7420   log("Could not 
-00020670: 6465 7465 726d 696e 6520 7365 7061 7261  determine separa
-00020680: 746f 7220 2874 7269 6564 2074 6162 2c20  tor (tried tab, 
-00020690: 636f 6d6d 612c 2073 656d 6963 6f6c 6f6e  comma, semicolon
-000206a0: 2922 290a 2020 2020 2020 2020 2020 2020  )").            
-000206b0: 7265 7475 726e 0a20 2020 2020 2020 2065  return.        e
-000206c0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000206d0: 206c 6f67 2822 4c6f 6f6b 7320 6c69 6b65   log("Looks like
-000206e0: 2074 6865 2073 6570 6172 6174 6f72 2069   the separator i
-000206f0: 7320 2220 2b20 7365 706e 616d 6529 0a0a  s " + sepname)..
-00020700: 2020 2020 2020 2020 2320 4765 7420 6d61          # Get ma
-00020710: 7070 696e 6720 746f 2070 6172 7365 2068  pping to parse h
-00020720: 6561 6465 7220 6e61 6d65 730a 2020 2020  eader names.    
-00020730: 2020 2020 4d20 3d20 7b0a 2020 2020 2020      M = {.      
-00020740: 2020 2020 2020 226b 6579 223a 205b 2269        "key": ["i
-00020750: 6422 2c20 2269 6465 6e74 6966 6965 7222  d", "identifier"
-00020760: 5d2c 0a20 2020 2020 2020 2020 2020 2022  ],.            "
-00020770: 7072 6f6a 6563 746b 6579 223a 205b 2270  projectkey": ["p
-00020780: 726f 6a65 6374 206b 6579 222c 2022 7072  roject key", "pr
-00020790: 6f6a 6563 7420 6964 225d 2c0a 2020 2020  oject id"],.    
-000207a0: 2020 2020 2020 2020 2270 726f 6a65 6374          "project
-000207b0: 6e61 6d65 223a 205b 2270 726f 6a65 6374  name": ["project
-000207c0: 222c 2022 7072 222c 2022 7072 6f6a 222c  ", "pr", "proj",
-000207d0: 2022 7072 6f6a 6563 7420 6e61 6d65 225d   "project name"]
-000207e0: 2c0a 2020 2020 2020 2020 2020 2020 2274  ,.            "t
-000207f0: 6167 7322 3a20 5b22 7461 6773 222c 2022  ags": ["tags", "
-00020800: 7461 6722 5d2c 0a20 2020 2020 2020 2020  tag"],.         
-00020810: 2020 2022 7431 223a 205b 2273 7461 7274     "t1": ["start
-00020820: 222c 2022 6265 6769 6e22 2c20 2273 7461  ", "begin", "sta
-00020830: 7274 2074 696d 6522 2c20 2262 6567 696e  rt time", "begin
-00020840: 2074 696d 6522 5d2c 0a20 2020 2020 2020   time"],.       
-00020850: 2020 2020 2022 7432 223a 205b 2273 746f       "t2": ["sto
-00020860: 7022 2c20 2265 6e64 222c 2022 7374 6f70  p", "end", "stop
-00020870: 2074 696d 6522 2c20 2265 6e64 2074 696d   time", "end tim
-00020880: 6522 5d2c 0a20 2020 2020 2020 2020 2020  e"],.           
-00020890: 2022 6465 7363 7269 7074 696f 6e22 3a20   "description": 
-000208a0: 5b22 7375 6d6d 6172 7922 2c20 2263 6f6d  ["summary", "com
-000208b0: 6d65 6e74 222c 2022 7469 746c 6522 2c20  ment", "title", 
-000208c0: 2264 7322 5d2c 0a20 2020 2020 2020 2020  "ds"],.         
-000208d0: 2020 2022 7072 6f6a 6563 7470 6174 6822     "projectpath"
-000208e0: 3a20 5b22 7072 6f6a 6563 7420 7061 7468  : ["project path
-000208f0: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
-00020900: 2264 6174 6522 3a20 5b5d 2c0a 2020 2020  "date": [],.    
-00020910: 2020 2020 2020 2020 2264 7572 6174 696f          "duratio
-00020920: 6e22 3a20 5b0a 2020 2020 2020 2020 2020  n": [.          
-00020930: 2020 2020 2020 2264 7572 6174 696f 6e20        "duration 
-00020940: 683a 6d22 2c0a 2020 2020 2020 2020 2020  h:m",.          
-00020950: 2020 2020 2020 2264 7572 6174 696f 6e20        "duration 
-00020960: 683a 6d3a 7322 2c0a 2020 2020 2020 2020  h:m:s",.        
-00020970: 2020 2020 2020 2020 2264 7572 6174 696f          "duratio
-00020980: 6e20 6868 3a6d 6d22 2c0a 2020 2020 2020  n hh:mm",.      
-00020990: 2020 2020 2020 2020 2020 2264 7572 6174            "durat
-000209a0: 696f 6e20 6868 3a6d 6d3a 7373 222c 0a20  ion hh:mm:ss",. 
-000209b0: 2020 2020 2020 2020 2020 205d 2c0a 2020             ],.  
-000209c0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-000209d0: 6e61 6d65 6d61 7020 3d20 7b7d 0a20 2020  namemap = {}.   
-000209e0: 2020 2020 2066 6f72 206b 6579 2c20 6f70       for key, op
-000209f0: 7469 6f6e 7320 696e 204d 2e69 7465 6d73  tions in M.items
-00020a00: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00020a10: 6e61 6d65 6d61 705b 6b65 795d 203d 206b  namemap[key] = k
-00020a20: 6579 0a20 2020 2020 2020 2020 2020 2066  ey.            f
-00020a30: 6f72 2078 2069 6e20 6f70 7469 6f6e 733a  or x in options:
-00020a40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020a50: 206e 616d 656d 6170 5b78 5d20 3d20 6b65   namemap[x] = ke
-00020a60: 790a 0a20 2020 2020 2020 2023 2050 6172  y..        # Par
-00020a70: 7365 2068 6561 6465 7220 746f 2067 6574  se header to get
-00020a80: 206e 616d 6573 0a20 2020 2020 2020 2068   names.        h
-00020a90: 6561 6465 7270 6172 7473 3120 3d20 6373  eaderparts1 = cs
-00020aa0: 7673 706c 6974 2868 6561 6465 722c 2073  vsplit(header, s
-00020ab0: 6570 295b 305d 0a20 2020 2020 2020 2068  ep)[0].        h
-00020ac0: 6561 6465 7270 6172 7473 3220 3d20 5b5d  eaderparts2 = []
-00020ad0: 0a20 2020 2020 2020 2068 6561 6465 7270  .        headerp
-00020ae0: 6172 7473 5f75 6e6b 6e6f 776e 203d 205b  arts_unknown = [
-00020af0: 5d0a 2020 2020 2020 2020 666f 7220 6e61  ].        for na
-00020b00: 6d65 2069 6e20 6865 6164 6572 7061 7274  me in headerpart
-00020b10: 7331 3a0a 2020 2020 2020 2020 2020 2020  s1:.            
-00020b20: 6e61 6d65 203d 206e 616d 652e 6c6f 7765  name = name.lowe
-00020b30: 7228 292e 7265 706c 6163 6528 222d 222c  r().replace("-",
-00020b40: 2022 2022 292e 7265 706c 6163 6528 225f   " ").replace("_
-00020b50: 222c 2022 2022 290a 2020 2020 2020 2020  ", " ").        
-00020b60: 2020 2020 6966 206e 616d 6520 696e 206e      if name in n
-00020b70: 616d 656d 6170 3a0a 2020 2020 2020 2020  amemap:.        
-00020b80: 2020 2020 2020 2020 6865 6164 6572 7061          headerpa
-00020b90: 7274 7332 2e61 7070 656e 6428 6e61 6d65  rts2.append(name
-00020ba0: 6d61 705b 6e61 6d65 5d29 0a20 2020 2020  map[name]).     
-00020bb0: 2020 2020 2020 2065 6c69 6620 6e6f 7420         elif not 
-00020bc0: 6e61 6d65 3a0a 2020 2020 2020 2020 2020  name:.          
-00020bd0: 2020 2020 2020 6865 6164 6572 7061 7274        headerpart
-00020be0: 7332 2e61 7070 656e 6428 4e6f 6e65 290a  s2.append(None).
-00020bf0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00020c00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00020c10: 2020 6865 6164 6572 7061 7274 735f 756e    headerparts_un
-00020c20: 6b6e 6f77 6e2e 6170 7065 6e64 286e 616d  known.append(nam
-00020c30: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00020c40: 2020 2068 6561 6465 7270 6172 7473 322e     headerparts2.
-00020c50: 6170 7065 6e64 284e 6f6e 6529 0a20 2020  append(None).   
-00020c60: 2020 2020 2077 6869 6c65 2068 6561 6465       while heade
-00020c70: 7270 6172 7473 3220 616e 6420 6865 6164  rparts2 and head
-00020c80: 6572 7061 7274 7332 5b2d 315d 2069 7320  erparts2[-1] is 
-00020c90: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00020ca0: 2020 6865 6164 6572 7061 7274 7332 2e70    headerparts2.p
-00020cb0: 6f70 282d 3129 0a20 2020 2020 2020 2069  op(-1).        i
-00020cc0: 6620 6865 6164 6572 7061 7274 735f 756e  f headerparts_un
-00020cd0: 6b6e 6f77 6e3a 0a20 2020 2020 2020 2020  known:.         
-00020ce0: 2020 206c 6f67 2822 4967 6e6f 7269 6e67     log("Ignoring
-00020cf0: 2073 6f6d 6520 6865 6164 6572 733a 2022   some headers: "
-00020d00: 202b 2068 6561 6465 7270 6172 7473 5f75   + headerparts_u
-00020d10: 6e6b 6e6f 776e 2e6a 6f69 6e28 222c 2022  nknown.join(", "
-00020d20: 2929 0a20 2020 2020 2020 2065 6c73 653a  )).        else:
-00020d30: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
-00020d40: 2822 416c 6c20 6865 6164 6572 7320 6e61  ("All headers na
-00020d50: 6d65 7320 7265 636f 676e 697a 6564 2229  mes recognized")
-00020d60: 0a0a 2020 2020 2020 2020 2320 416c 6c20  ..        # All 
-00020d70: 7265 7175 6972 6564 206e 616d 6573 2068  required names h
-00020d80: 6561 6465 7273 2070 7265 7365 6e74 3f0a  eaders present?.
-00020d90: 2020 2020 2020 2020 6966 2022 7431 2220          if "t1" 
-00020da0: 6e6f 7420 696e 2068 6561 6465 7270 6172  not in headerpar
-00020db0: 7473 323a 0a20 2020 2020 2020 2020 2020  ts2:.           
-00020dc0: 206c 6f67 2822 4d69 7373 696e 6720 7265   log("Missing re
-00020dd0: 7175 6972 6564 2068 6561 6465 7220 666f  quired header fo
-00020de0: 7220 7374 6172 7420 7469 6d65 2e22 290a  r start time.").
-00020df0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00020e00: 726e 0a20 2020 2020 2020 2065 6c69 6620  rn.        elif 
-00020e10: 2274 3222 206e 6f74 2069 6e20 6865 6164  "t2" not in head
-00020e20: 6572 7061 7274 7332 2061 6e64 2022 6475  erparts2 and "du
-00020e30: 7261 7469 6f6e 2220 6e6f 7420 696e 2068  ration" not in h
-00020e40: 6561 6465 7270 6172 7473 323a 0a20 2020  eaderparts2:.   
-00020e50: 2020 2020 2020 2020 206c 6f67 2822 4d69           log("Mi
-00020e60: 7373 696e 6720 7265 7175 6972 6564 2068  ssing required h
-00020e70: 6561 6465 7220 666f 7220 7374 6f70 2074  eader for stop t
-00020e80: 696d 6520 6f72 2064 7572 6174 696f 6e2e  ime or duration.
-00020e90: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
-00020ea0: 6574 7572 6e0a 0a20 2020 2020 2020 2023  eturn..        #
-00020eb0: 2047 6574 2064 6963 7420 746f 206d 6170   Get dict to map
-00020ec0: 2028 7431 2c20 7432 2920 746f 2072 6563   (t1, t2) to rec
-00020ed0: 6f72 6420 6b65 790a 2020 2020 2020 2020  ord key.        
-00020ee0: 7469 6d65 6d61 7020 3d20 7b7d 2020 2320  timemap = {}  # 
-00020ef0: 7431 5f74 3220 2d3e 206b 6579 0a20 2020  t1_t2 -> key.   
-00020f00: 2020 2020 2066 6f72 206b 6579 2c20 7265       for key, re
-00020f10: 636f 7264 2069 6e20 7769 6e64 6f77 2e73  cord in window.s
-00020f20: 746f 7265 2e72 6563 6f72 6473 2e5f 6974  tore.records._it
-00020f30: 656d 732e 6974 656d 7328 293a 0a20 2020  ems.items():.   
-00020f40: 2020 2020 2020 2020 2074 696d 656d 6170           timemap
-00020f50: 5b72 6563 6f72 642e 7431 202b 2022 5f22  [record.t1 + "_"
-00020f60: 202b 2072 6563 6f72 642e 7432 5d20 3d20   + record.t2] = 
-00020f70: 6b65 790a 0a20 2020 2020 2020 2023 204e  key..        # N
-00020f80: 6f77 2070 6172 7365 210a 2020 2020 2020  ow parse!.      
-00020f90: 2020 7965 6172 5f70 6173 745f 6570 6f63    year_past_epoc
-00020fa0: 6820 3d20 3331 3533 3630 3030 2020 2320  h = 31536000  # 
-00020fb0: 536f 2077 6520 6361 6e20 7465 7374 2074  So we can test t
-00020fc0: 6861 7420 6120 7469 6d65 7374 616d 7020  hat a timestamp 
-00020fd0: 6973 206e 6f74 2061 2068 682e 6d6d 0a20  is not a hh.mm. 
-00020fe0: 2020 2020 2020 2072 6563 6f72 6473 203d         records =
-00020ff0: 205b 5d0a 2020 2020 2020 2020 6e65 775f   [].        new_
-00021000: 7265 636f 7264 5f63 6f75 6e74 203d 2030  record_count = 0
-00021010: 0a20 2020 2020 2020 2069 6e64 6578 203d  .        index =
-00021020: 2030 0a20 2020 2020 2020 2072 6f77 203d   0.        row =
-00021030: 2030 0a20 2020 2020 2020 2077 6869 6c65   0.        while
-00021040: 2069 6e64 6578 203c 206c 656e 2874 6578   index < len(tex
-00021050: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-00021060: 726f 7720 2b3d 2031 0a20 2020 2020 2020  row += 1.       
-00021070: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00021080: 2020 2020 2020 2020 2020 2320 4765 7420            # Get 
-00021090: 7061 7274 7320 6f6e 2074 6869 7320 726f  parts on this ro
-000210a0: 770a 2020 2020 2020 2020 2020 2020 2020  w.              
-000210b0: 2020 6c69 6e65 7061 7274 732c 2069 6e64    lineparts, ind
-000210c0: 6578 203d 2063 7376 7370 6c69 7428 7465  ex = csvsplit(te
-000210d0: 7874 2c20 7365 702c 2069 6e64 6578 290a  xt, sep, index).
-000210e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000210f0: 6966 206c 656e 2822 222e 6a6f 696e 286c  if len("".join(l
-00021100: 696e 6570 6172 7473 292e 7472 696d 2829  ineparts).trim()
-00021110: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
-00021120: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00021130: 696e 7565 2020 2320 736b 6970 2065 6d70  inue  # skip emp
-00021140: 7479 2072 6f77 730a 2020 2020 2020 2020  ty rows.        
-00021150: 2020 2020 2020 2020 2320 4275 696c 6420          # Build 
-00021160: 7261 7720 6f62 6a65 6374 0a20 2020 2020  raw object.     
-00021170: 2020 2020 2020 2020 2020 2072 6177 203d             raw =
-00021180: 207b 7d0a 2020 2020 2020 2020 2020 2020   {}.            
-00021190: 2020 2020 666f 7220 6a20 696e 2072 616e      for j in ran
-000211a0: 6765 286d 696e 286c 656e 286c 696e 6570  ge(min(len(linep
-000211b0: 6172 7473 292c 206c 656e 2868 6561 6465  arts), len(heade
-000211c0: 7270 6172 7473 3229 2929 3a0a 2020 2020  rparts2))):.    
-000211d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000211e0: 6b65 7920 3d20 6865 6164 6572 7061 7274  key = headerpart
-000211f0: 7332 5b6a 5d0a 2020 2020 2020 2020 2020  s2[j].          
-00021200: 2020 2020 2020 2020 2020 6966 206b 6579            if key
-00021210: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00021220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021230: 2020 2020 2020 7261 775b 6b65 795d 203d        raw[key] =
-00021240: 206c 696e 6570 6172 7473 5b6a 5d2e 7374   lineparts[j].st
-00021250: 7269 7028 290a 2020 2020 2020 2020 2020  rip().          
-00021260: 2020 2020 2020 7261 772e 6d6f 7265 203d        raw.more =
-00021270: 206c 696e 6570 6172 7473 5b6c 656e 2868   lineparts[len(h
-00021280: 6561 6465 7270 6172 7473 3229 203a 5d0a  eaderparts2) :].
-00021290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000212a0: 2320 4275 696c 6420 7265 636f 7264 0a20  # Build record. 
-000212b0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000212c0: 6563 6f72 6420 3d20 7769 6e64 6f77 2e73  ecord = window.s
-000212d0: 746f 7265 2e72 6563 6f72 6473 2e63 7265  tore.records.cre
-000212e0: 6174 6528 302c 2030 290a 2020 2020 2020  ate(0, 0).      
-000212f0: 2020 2020 2020 2020 2020 7265 636f 7264            record
-00021300: 5f6b 6579 203d 204e 6f6e 650a 2020 2020  _key = None.    
-00021310: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-00021320: 6177 2e6b 6579 3a0a 2020 2020 2020 2020  aw.key:.        
-00021330: 2020 2020 2020 2020 2020 2020 7265 636f              reco
-00021340: 7264 5f6b 6579 203d 2072 6177 2e6b 6579  rd_key = raw.key
-00021350: 2020 2320 646f 6e74 2073 746f 7265 2061    # dont store a
-00021360: 7420 7265 636f 7264 2079 6574 0a20 2020  t record yet.   
-00021370: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00021380: 7261 772e 6461 7465 3a0a 2020 2020 2020  raw.date:.      
-00021390: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-000213a0: 5072 6570 2064 6174 652e 2053 7570 706f  Prep date. Suppo
-000213b0: 7274 2062 6f74 6820 6464 2d6d 6d2d 7979  rt both dd-mm-yy
-000213c0: 7979 2061 6e64 2079 7979 2d6d 6d2d 6464  yy and yyy-mm-dd
-000213d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000213e0: 2020 2020 2064 6174 6520 3d20 7261 772e       date = raw.
-000213f0: 6461 7465 2e72 6570 6c61 6365 2822 2e22  date.replace("."
-00021400: 2c20 222d 2229 2020 2320 536f 6d65 2074  , "-")  # Some t
-00021410: 6f6f 6c73 2075 7365 2064 6f74 730a 2020  ools use dots.  
-00021420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021430: 2020 6966 206c 656e 2864 6174 6529 203d    if len(date) =
-00021440: 3d20 3130 2061 6e64 2064 6174 652e 636f  = 10 and date.co
-00021450: 756e 7428 222d 2229 203d 3d20 323a 0a20  unt("-") == 2:. 
+00018c80: 2073 7479 6c65 3d27 6375 7273 6f72 3a20   style='cursor: 
+00018c90: 706f 696e 7465 723b 273e 0a20 2020 2020  pointer;'>.     
+00018ca0: 2020 2020 2020 2020 2020 2020 2020 203c                 <
+00018cb0: 7370 616e 3e7b 6461 7465 7d3c 2f73 7061  span>{date}</spa
+00018cc0: 6e3e 0a20 2020 2020 2020 2020 2020 2020  n>.             
+00018cd0: 2020 203c 2f61 3e26 6e62 7370 3b26 6e62     </a>&nbsp;&nb
+00018ce0: 7370 3b0a 2020 2020 2020 2020 2020 2020  sp;.            
+00018cf0: 2020 2020 3c61 206f 6e63 6c69 636b 3d27      <a onclick='
+00018d00: 7769 6e64 6f77 2e5f 7365 6172 6368 5f64  window._search_d
+00018d10: 6961 6c6f 675f 6f70 656e 5f72 6563 6f72  ialog_open_recor
+00018d20: 6428 227b 6b65 797d 2229 270a 2020 2020  d("{key}")'.    
+00018d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018d40: 7374 796c 653d 2763 7572 736f 723a 2070  style='cursor: p
+00018d50: 6f69 6e74 6572 3b27 3e0a 2020 2020 2020  ointer;'>.      
+00018d60: 2020 2020 2020 2020 2020 2020 2020 3c69                <i
+00018d70: 2063 6c61 7373 3d27 6661 7327 3e5c 7566   class='fas'>\uf
+00018d80: 3638 323c 2f69 3e0a 2020 2020 2020 2020  682</i>.        
+00018d90: 2020 2020 2020 2020 2020 2020 3c73 7061              <spa
+00018da0: 6e3e 7b64 737d 3c2f 7370 616e 3e0a 2020  n>{ds}</span>.  
+00018db0: 2020 2020 2020 2020 2020 2020 2020 3c2f                </
+00018dc0: 613e 0a20 2020 2020 2020 2020 2020 2020  a>.             
+00018dd0: 2020 2022 2222 0a20 2020 2020 2020 2020     """.         
+00018de0: 2020 2029 0a20 2020 2020 2020 2073 656c     ).        sel
+00018df0: 662e 5f72 6563 6f72 6473 5f6e 6f64 652e  f._records_node.
+00018e00: 696e 6e65 7248 544d 4c20 3d20 223c 6272  innerHTML = "<br
+00018e10: 202f 3e5c 6e22 2e6a 6f69 6e28 6c69 6e65   />\n".join(line
+00018e20: 7329 0a0a 2020 2020 6465 6620 5f6f 7065  s)..    def _ope
+00018e30: 6e5f 7265 636f 7264 2873 656c 662c 206b  n_record(self, k
+00018e40: 6579 293a 0a20 2020 2020 2020 2072 6563  ey):.        rec
+00018e50: 6f72 6420 3d20 7769 6e64 6f77 2e73 746f  ord = window.sto
+00018e60: 7265 2e72 6563 6f72 6473 2e67 6574 5f62  re.records.get_b
+00018e70: 795f 6b65 7928 6b65 7929 0a20 2020 2020  y_key(key).     
+00018e80: 2020 2073 656c 662e 5f63 616e 7661 732e     self._canvas.
+00018e90: 7265 636f 7264 5f64 6961 6c6f 672e 6f70  record_dialog.op
+00018ea0: 656e 2822 4564 6974 222c 2072 6563 6f72  en("Edit", recor
+00018eb0: 642c 2073 656c 662e 5f73 686f 775f 7265  d, self._show_re
+00018ec0: 636f 7264 7329 0a0a 2020 2020 6465 6620  cords)..    def 
+00018ed0: 5f6f 7065 6e5f 7461 675f 6469 616c 6f67  _open_tag_dialog
+00018ee0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00018ef0: 6966 206c 656e 2873 656c 662e 5f63 7572  if len(self._cur
+00018f00: 7265 6e74 5f70 6f73 5f74 6167 7329 203d  rent_pos_tags) =
+00018f10: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
+00018f20: 2074 6167 7a20 3d20 7365 6c66 2e5f 6375   tagz = self._cu
+00018f30: 7272 656e 745f 706f 735f 7461 6773 5b30  rrent_pos_tags[0
+00018f40: 5d0a 2020 2020 2020 2020 2020 2020 7365  ].            se
+00018f50: 6c66 2e5f 6361 6e76 6173 2e74 6167 5f64  lf._canvas.tag_d
+00018f60: 6961 6c6f 672e 6f70 656e 2874 6167 7a2c  ialog.open(tagz,
+00018f70: 2073 656c 662e 5f73 686f 775f 7265 636f   self._show_reco
+00018f80: 7264 7329 0a20 2020 2020 2020 2065 6c69  rds).        eli
+00018f90: 6620 6c65 6e28 7365 6c66 2e5f 6375 7272  f len(self._curr
+00018fa0: 656e 745f 706f 735f 7461 6773 2920 3e20  ent_pos_tags) > 
+00018fb0: 313a 0a20 2020 2020 2020 2020 2020 2074  1:.            t
+00018fc0: 6167 7a20 3d20 2220 222e 6a6f 696e 2873  agz = " ".join(s
+00018fd0: 656c 662e 5f63 7572 7265 6e74 5f70 6f73  elf._current_pos
+00018fe0: 5f74 6167 7329 0a20 2020 2020 2020 2020  _tags).         
+00018ff0: 2020 2073 656c 662e 5f63 616e 7661 732e     self._canvas.
+00019000: 7461 675f 636f 6d62 6f5f 6469 616c 6f67  tag_combo_dialog
+00019010: 2e6f 7065 6e28 7461 677a 2c20 7365 6c66  .open(tagz, self
+00019020: 2e5f 7368 6f77 5f72 6563 6f72 6473 290a  ._show_records).
+00019030: 0a0a 636c 6173 7320 5265 706f 7274 4469  ..class ReportDi
+00019040: 616c 6f67 2842 6173 6544 6961 6c6f 6729  alog(BaseDialog)
+00019050: 3a0a 2020 2020 2222 2241 2064 6961 6c6f  :.    """A dialo
+00019060: 6720 7468 6174 2073 686f 7773 2061 2072  g that shows a r
+00019070: 6570 6f72 7420 6f66 2072 6563 6f72 6473  eport of records
+00019080: 2c20 616e 6420 616c 6c6f 7773 2065 7870  , and allows exp
+00019090: 6f72 7469 6e67 2e22 2222 0a0a 2020 2020  orting."""..    
+000190a0: 6465 6620 6f70 656e 2873 656c 662c 2074  def open(self, t
+000190b0: 313d 4e6f 6e65 2c20 7432 3d4e 6f6e 652c  1=None, t2=None,
+000190c0: 2074 6167 733d 4e6f 6e65 293a 0a20 2020   tags=None):.   
+000190d0: 2020 2020 2022 2222 5368 6f77 2f6f 7065       """Show/ope
+000190e0: 6e20 7468 6520 6469 616c 6f67 202e 2222  n the dialog .""
+000190f0: 220a 0a20 2020 2020 2020 2069 6620 7431  "..        if t1
+00019100: 2069 7320 4e6f 6e65 206f 7220 7432 2069   is None or t2 i
+00019110: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00019120: 2020 2020 7431 2c20 7432 203d 2073 656c      t1, t2 = sel
+00019130: 662e 5f63 616e 7661 732e 7261 6e67 652e  f._canvas.range.
+00019140: 6765 745f 7461 7267 6574 5f72 616e 6765  get_target_range
+00019150: 2829 0a20 2020 2020 2020 2069 6620 7461  ().        if ta
+00019160: 6773 2069 7320 4e6f 6e65 3a0a 2020 2020  gs is None:.    
+00019170: 2020 2020 2020 2020 7461 6773 203d 2073          tags = s
+00019180: 656c 662e 5f63 616e 7661 732e 7769 6467  elf._canvas.widg
+00019190: 6574 732e 416e 616c 7974 6963 7357 6964  ets.AnalyticsWid
+000191a0: 6765 742e 7365 6c65 6374 6564 5f74 6167  get.selected_tag
+000191b0: 730a 0a20 2020 2020 2020 2073 656c 662e  s..        self.
+000191c0: 5f74 6167 7320 3d20 7461 6773 206f 7220  _tags = tags or 
+000191d0: 5b5d 0a0a 2020 2020 2020 2020 2320 5472  []..        # Tr
+000191e0: 616e 7366 6f72 6d20 7469 6d65 2069 6e74  ansform time int
+000191f0: 2074 6f20 6461 7465 732e 0a20 2020 2020   to dates..     
+00019200: 2020 2074 315f 6461 7465 203d 2064 742e     t1_date = dt.
+00019210: 7469 6d65 326c 6f63 616c 7374 7228 6474  time2localstr(dt
+00019220: 2e72 6f75 6e64 2874 312c 2022 3144 2229  .round(t1, "1D")
+00019230: 292e 7370 6c69 7428 2220 2229 5b30 5d0a  ).split(" ")[0].
+00019240: 2020 2020 2020 2020 7432 5f64 6174 6520          t2_date 
+00019250: 3d20 6474 2e74 696d 6532 6c6f 6361 6c73  = dt.time2locals
+00019260: 7472 2864 742e 726f 756e 6428 7432 2c20  tr(dt.round(t2, 
+00019270: 2231 4422 2929 2e73 706c 6974 2822 2022  "1D")).split(" "
+00019280: 295b 305d 0a20 2020 2020 2020 2069 6620  )[0].        if 
+00019290: 7431 5f64 6174 6520 213d 2074 325f 6461  t1_date != t2_da
+000192a0: 7465 3a0a 2020 2020 2020 2020 2020 2020  te:.            
+000192b0: 2320 5468 6520 6461 7465 2072 616e 6765  # The date range
+000192c0: 2069 7320 696e 636c 7573 6976 6520 2861   is inclusive (a
+000192d0: 6e64 2077 6520 6164 6420 3144 206c 6174  nd we add 1D lat
+000192e0: 6572 293a 206d 6f76 6520 6261 636b 206f  er): move back o
+000192f0: 6e65 2064 6179 0a20 2020 2020 2020 2020  ne day.         
+00019300: 2020 2074 325f 6461 7465 203d 2064 742e     t2_date = dt.
+00019310: 7469 6d65 326c 6f63 616c 7374 7228 6474  time2localstr(dt
+00019320: 2e61 6464 2864 742e 726f 756e 6428 7432  .add(dt.round(t2
+00019330: 2c20 2231 4422 292c 2022 2d31 4422 2929  , "1D"), "-1D"))
+00019340: 2e73 706c 6974 2822 2022 295b 305d 0a20  .split(" ")[0]. 
+00019350: 2020 2020 2020 2073 656c 662e 5f74 315f         self._t1_
+00019360: 6461 7465 203d 2074 315f 6461 7465 0a20  date = t1_date. 
+00019370: 2020 2020 2020 2073 656c 662e 5f74 325f         self._t2_
+00019380: 6461 7465 203d 2074 325f 6461 7465 0a0a  date = t2_date..
+00019390: 2020 2020 2020 2020 2320 4765 6e65 7261          # Genera
+000193a0: 7465 2070 7265 616d 626c 650a 2020 2020  te preamble.    
+000193b0: 2020 2020 6966 2073 656c 662e 5f74 6167      if self._tag
+000193c0: 733a 0a20 2020 2020 2020 2020 2020 2066  s:.            f
+000193d0: 696c 7465 7274 6578 7420 3d20 7365 6c66  iltertext = self
+000193e0: 2e5f 7461 6773 2e6a 6f69 6e28 2220 2229  ._tags.join(" ")
+000193f0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00019400: 2020 2020 2020 2020 2020 2066 696c 7465             filte
+00019410: 7274 6578 7420 3d20 223c 736d 616c 6c3e  rtext = "<small>
+00019420: 5365 6c65 6374 2074 6167 7320 696e 206f  Select tags in o
+00019430: 7665 7276 6965 7720 7061 6e65 6c3c 2f73  verview panel</s
+00019440: 6d61 6c6c 3e22 0a20 2020 2020 2020 2073  mall>".        s
+00019450: 656c 662e 5f63 6f70 7962 7574 7465 7874  elf._copybuttext
+00019460: 203d 2022 436f 7079 2074 6162 6c65 220a   = "Copy table".
+00019470: 2020 2020 2020 2020 6874 6d6c 203d 2066          html = f
+00019480: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
+00019490: 3c68 313e 3c69 2063 6c61 7373 3d27 6661  <h1><i class='fa
+000194a0: 7327 3e5c 7566 3135 633c 2f69 3e26 6e62  s'>\uf15c</i>&nb
+000194b0: 7370 3b26 6e62 7370 3b52 6570 6f72 740a  sp;&nbsp;Report.
+000194c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000194d0: 3c62 7574 746f 6e20 7479 7065 3d27 6275  <button type='bu
+000194e0: 7474 6f6e 273e 3c69 2063 6c61 7373 3d27  tton'><i class='
+000194f0: 6661 7327 3e5c 7566 3030 643c 2f69 3e3c  fas'>\uf00d</i><
+00019500: 2f62 7574 746f 6e3e 0a20 2020 2020 2020  /button>.       
+00019510: 2020 2020 2020 2020 203c 2f68 313e 0a20           </h1>. 
+00019520: 2020 2020 2020 2020 2020 203c 6469 7620             <div 
+00019530: 636c 6173 733d 2766 6f72 6d6c 6179 6f75  class='formlayou
+00019540: 7427 3e0a 2020 2020 2020 2020 2020 2020  t'>.            
+00019550: 2020 2020 3c64 6976 3e54 6167 733a 3c2f      <div>Tags:</
+00019560: 6469 763e 203c 6469 763e 7b66 696c 7465  div> <div>{filte
+00019570: 7274 6578 747d 3c2f 6469 763e 0a20 2020  rtext}</div>.   
+00019580: 2020 2020 2020 2020 2020 2020 203c 6469               <di
+00019590: 763e 4461 7465 2072 616e 6765 3a3c 2f64  v>Date range:</d
+000195a0: 6976 3e20 3c64 6976 2073 7479 6c65 3d27  iv> <div style='
+000195b0: 666f 6e74 2d73 697a 653a 736d 616c 6c65  font-size:smalle
+000195c0: 723b 273e 3c2f 6469 763e 0a20 2020 2020  r;'></div>.     
+000195d0: 2020 2020 2020 2020 2020 203c 6469 763e             <div>
+000195e0: 4772 6f75 7069 6e67 3a3c 2f64 6976 3e20  Grouping:</div> 
+000195f0: 3c73 656c 6563 743e 0a20 2020 2020 2020  <select>.       
+00019600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019620: 203c 6f70 7469 6f6e 2076 616c 7565 3d27   <option value='
+00019630: 6e6f 6e65 273e 6e6f 6e65 3c2f 6f70 7469  none'>none</opti
+00019640: 6f6e 3e0a 2020 2020 2020 2020 2020 2020  on>.            
+00019650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019660: 2020 2020 2020 2020 2020 2020 3c6f 7074              <opt
+00019670: 696f 6e20 7661 6c75 653d 2774 6167 7a27  ion value='tagz'
+00019680: 3e74 6167 733c 2f6f 7074 696f 6e3e 0a20  >tags</option>. 
+00019690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000196a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000196b0: 2020 2020 2020 203c 6f70 7469 6f6e 2076         <option v
+000196c0: 616c 7565 3d27 6473 273e 6465 7363 7269  alue='ds'>descri
+000196d0: 7074 696f 6e3c 2f6f 7074 696f 6e3e 0a20  ption</option>. 
+000196e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000196f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019700: 2020 2020 3c2f 7365 6c65 6374 3e0a 2020      </select>.  
+00019710: 2020 2020 2020 2020 2020 2020 2020 3c64                <d
+00019720: 6976 3e47 726f 7570 2062 7920 7065 7269  iv>Group by peri
+00019730: 6f64 3a3c 2f64 6976 3e20 3c73 656c 6563  od:</div> <selec
+00019740: 743e 0a20 2020 2020 2020 2020 2020 2020  t>.             
+00019750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019760: 2020 2020 2020 2020 2020 203c 6f70 7469             <opti
+00019770: 6f6e 2076 616c 7565 3d27 6e6f 6e65 273e  on value='none'>
+00019780: 6e6f 6e65 3c2f 6f70 7469 6f6e 3e0a 2020  none</option>.  
+00019790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000197a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000197b0: 2020 2020 2020 3c6f 7074 696f 6e20 7661        <option va
+000197c0: 6c75 653d 2764 6179 273e 6461 793c 2f6f  lue='day'>day</o
+000197d0: 7074 696f 6e3e 0a20 2020 2020 2020 2020  ption>.         
+000197e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000197f0: 2020 2020 2020 2020 2020 2020 2020 203c                 <
+00019800: 6f70 7469 6f6e 2076 616c 7565 3d27 7765  option value='we
+00019810: 656b 273e 7765 656b 3c2f 6f70 7469 6f6e  ek'>week</option
+00019820: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
+00019830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019840: 2020 2020 2020 2020 2020 3c6f 7074 696f            <optio
+00019850: 6e20 7661 6c75 653d 276d 6f6e 7468 273e  n value='month'>
+00019860: 6d6f 6e74 683c 2f6f 7074 696f 6e3e 0a20  month</option>. 
+00019870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019890: 2020 2020 2020 203c 6f70 7469 6f6e 2076         <option v
+000198a0: 616c 7565 3d27 7175 6172 7465 7227 3e71  alue='quarter'>q
+000198b0: 7561 7274 6572 3c2f 6f70 7469 6f6e 3e0a  uarter</option>.
+000198c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000198d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000198e0: 2020 2020 2020 2020 3c6f 7074 696f 6e20          <option 
+000198f0: 7661 6c75 653d 2779 6561 7227 3e79 6561  value='year'>yea
+00019900: 723c 2f6f 7074 696f 6e3e 0a20 2020 2020  r</option>.     
+00019910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019930: 3c2f 7365 6c65 6374 3e0a 2020 2020 2020  </select>.      
+00019940: 2020 2020 2020 2020 2020 3c64 6976 3e54            <div>T
+00019950: 6167 206f 7264 6572 3a3c 2f64 6976 3e20  ag order:</div> 
+00019960: 3c6c 6162 656c 3e3c 696e 7075 7420 7479  <label><input ty
+00019970: 7065 3d27 6368 6563 6b62 6f78 2720 2f3e  pe='checkbox' />
+00019980: 2048 6964 6520 7365 636f 6e64 6172 7920   Hide secondary 
+00019990: 7461 6773 3c2f 6c61 6265 6c3e 0a20 2020  tags</label>.   
+000199a0: 2020 2020 2020 2020 2020 2020 203c 6469               <di
+000199b0: 763e 4475 7261 7469 6f6e 2066 6f72 6d61  v>Duration forma
+000199c0: 743a 3c2f 6469 763e 203c 7365 6c65 6374  t:</div> <select
+000199d0: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
+000199e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000199f0: 2020 2020 2020 2020 2020 3c6f 7074 696f            <optio
+00019a00: 6e20 7661 6c75 653d 2768 3027 3e39 3c2f  n value='h0'>9</
+00019a10: 6f70 7469 6f6e 3e0a 2020 2020 2020 2020  option>.        
+00019a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019a40: 3c6f 7074 696f 6e20 7661 6c75 653d 2768  <option value='h
+00019a50: 6d27 3e39 3a30 373c 2f6f 7074 696f 6e3e  m'>9:07</option>
+00019a60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019a80: 2020 2020 2020 2020 203c 6f70 7469 6f6e           <option
+00019a90: 2076 616c 7565 3d27 686d 7327 3e39 3a30   value='hms'>9:0
+00019aa0: 373a 3234 3c2f 6f70 7469 6f6e 3e0a 2020  7:24</option>.  
+00019ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ad0: 2020 2020 2020 3c6f 7074 696f 6e20 7661        <option va
+00019ae0: 6c75 653d 2768 3127 3e39 2e31 3c2f 6f70  lue='h1'>9.1</op
+00019af0: 7469 6f6e 3e0a 2020 2020 2020 2020 2020  tion>.          
+00019b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019b10: 2020 2020 2020 2020 2020 2020 2020 3c6f                <o
+00019b20: 7074 696f 6e20 7661 6c75 653d 2768 3227  ption value='h2'
+00019b30: 3e39 2e31 323c 2f6f 7074 696f 6e3e 0a20  >9.12</option>. 
+00019b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019b60: 2020 2020 2020 203c 6f70 7469 6f6e 2076         <option v
+00019b70: 616c 7565 3d27 6833 273e 392e 3132 333c  alue='h3'>9.123<
+00019b80: 2f6f 7074 696f 6e3e 0a20 2020 2020 2020  /option>.       
+00019b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ba0: 2020 2020 2020 2020 2020 2020 2020 3c2f                </
+00019bb0: 7365 6c65 6374 3e0a 2020 2020 2020 2020  select>.        
+00019bc0: 2020 2020 2020 2020 3c64 6976 3e44 6574          <div>Det
+00019bd0: 6169 6c73 3a3c 2f64 6976 3e20 3c6c 6162  ails:</div> <lab
+00019be0: 656c 3e3c 696e 7075 7420 7479 7065 3d27  el><input type='
+00019bf0: 6368 6563 6b62 6f78 2720 6368 6563 6b65  checkbox' checke
+00019c00: 6420 2f3e 2053 686f 7720 7265 636f 7264  d /> Show record
+00019c10: 733c 2f6c 6162 656c 3e0a 2020 2020 2020  s</label>.      
+00019c20: 2020 2020 2020 2020 2020 3c62 7574 746f            <butto
+00019c30: 6e20 7479 7065 3d27 6275 7474 6f6e 273e  n type='button'>
+00019c40: 3c69 2063 6c61 7373 3d27 6661 7327 3e5c  <i class='fas'>\
+00019c50: 7566 3332 383c 2f69 3e26 6e62 7370 3b26  uf328</i>&nbsp;&
+00019c60: 6e62 7370 3b7b 7365 6c66 2e5f 636f 7079  nbsp;{self._copy
+00019c70: 6275 7474 6578 747d 3c2f 6275 7474 6f6e  buttext}</button
+00019c80: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
+00019c90: 2020 2020 2020 3c64 6976 3e70 6173 7465        <div>paste
+00019ca0: 2069 6e20 6120 7370 7265 6164 7368 6565   in a spreadshee
+00019cb0: 743c 2f64 6976 3e0a 2020 2020 2020 2020  t</div>.        
+00019cc0: 2020 2020 2020 2020 3c62 7574 746f 6e20          <button 
+00019cd0: 7479 7065 3d27 6275 7474 6f6e 273e 3c69  type='button'><i
+00019ce0: 2063 6c61 7373 3d27 6661 7327 3e5c 7566   class='fas'>\uf
+00019cf0: 3063 653c 2f69 3e26 6e62 7370 3b26 6e62  0ce</i>&nbsp;&nb
+00019d00: 7370 3b53 6176 6520 4353 563c 2f62 7574  sp;Save CSV</but
+00019d10: 746f 6e3e 0a20 2020 2020 2020 2020 2020  ton>.           
+00019d20: 2020 2020 2020 2020 203c 6469 763e 7361           <div>sa
+00019d30: 7665 2073 7072 6561 6473 6865 6574 2028  ve spreadsheet (
+00019d40: 6d6f 7265 2064 6574 6169 6c73 293c 2f64  more details)</d
+00019d50: 6976 3e0a 2020 2020 2020 2020 2020 2020  iv>.            
+00019d60: 2020 2020 3c62 7574 746f 6e20 7479 7065      <button type
+00019d70: 3d27 6275 7474 6f6e 273e 3c69 2063 6c61  ='button'><i cla
+00019d80: 7373 3d27 6661 7327 3e5c 7566 3163 313c  ss='fas'>\uf1c1<
+00019d90: 2f69 3e26 6e62 7370 3b26 6e62 7370 3b53  /i>&nbsp;&nbsp;S
+00019da0: 6176 6520 5044 463c 2f62 7574 746f 6e3e  ave PDF</button>
+00019db0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019dc0: 2020 2020 203c 6469 763e 6172 6368 6976       <div>archiv
+00019dd0: 6520 6f72 2073 656e 6420 746f 2061 2063  e or send to a c
+00019de0: 6c69 656e 743c 2f64 6976 3e0a 2020 2020  lient</div>.    
+00019df0: 2020 2020 2020 2020 3c2f 6469 763e 0a20          </div>. 
+00019e00: 2020 2020 2020 2020 2020 203c 6872 202f             <hr /
+00019e10: 3e0a 2020 2020 2020 2020 2020 2020 3c74  >.            <t
+00019e20: 6162 6c65 2069 643d 2772 6570 6f72 745f  able id='report_
+00019e30: 7461 626c 6527 3e3c 2f74 6162 6c65 3e0a  table'></table>.
+00019e40: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+00019e50: 2020 2020 2073 656c 662e 6d61 696e 6469       self.maindi
+00019e60: 762e 696e 6e65 7248 544d 4c20 3d20 6874  v.innerHTML = ht
+00019e70: 6d6c 0a20 2020 2020 2020 2073 656c 662e  ml.        self.
+00019e80: 5f74 6162 6c65 5f65 6c65 6d65 6e74 203d  _table_element =
+00019e90: 2073 656c 662e 6d61 696e 6469 762e 6368   self.maindiv.ch
+00019ea0: 696c 6472 656e 5b2d 315d 0a20 2020 2020  ildren[-1].     
+00019eb0: 2020 2066 6f72 6d20 3d20 7365 6c66 2e6d     form = self.m
+00019ec0: 6169 6e64 6976 2e63 6869 6c64 7265 6e5b  aindiv.children[
+00019ed0: 315d 0a0a 2020 2020 2020 2020 2320 6669  1]..        # fi
+00019ee0: 6c74 6572 2074 6578 7420 3d20 666f 726d  lter text = form
+00019ef0: 2e63 6869 6c64 7265 6e5b 315d 0a20 2020  .children[1].   
+00019f00: 2020 2020 2073 656c 662e 5f64 6174 655f       self._date_
+00019f10: 7261 6e67 6520 3d20 666f 726d 2e63 6869  range = form.chi
+00019f20: 6c64 7265 6e5b 335d 0a20 2020 2020 2020  ldren[3].       
+00019f30: 2073 656c 662e 5f67 726f 7570 696e 675f   self._grouping_
+00019f40: 7365 6c65 6374 203d 2066 6f72 6d2e 6368  select = form.ch
+00019f50: 696c 6472 656e 5b35 5d0a 2020 2020 2020  ildren[5].      
+00019f60: 2020 7365 6c66 2e5f 6772 6f75 7070 6572    self._groupper
+00019f70: 696f 645f 7365 6c65 6374 203d 2066 6f72  iod_select = for
+00019f80: 6d2e 6368 696c 6472 656e 5b37 5d0a 2020  m.children[7].  
+00019f90: 2020 2020 2020 7365 6c66 2e5f 6869 6465        self._hide
+00019fa0: 7365 636f 6e64 6172 795f 6275 7420 3d20  secondary_but = 
+00019fb0: 666f 726d 2e63 6869 6c64 7265 6e5b 395d  form.children[9]
+00019fc0: 2e63 6869 6c64 7265 6e5b 305d 2020 2320  .children[0]  # 
+00019fd0: 696e 7369 6465 206c 6162 656c 0a20 2020  inside label.   
+00019fe0: 2020 2020 2073 656c 662e 5f66 6f72 6d61       self._forma
+00019ff0: 745f 6275 7420 3d20 666f 726d 2e63 6869  t_but = form.chi
+0001a000: 6c64 7265 6e5b 3131 5d0a 2020 2020 2020  ldren[11].      
+0001a010: 2020 7365 6c66 2e5f 7368 6f77 7265 636f    self._showreco
+0001a020: 7264 735f 6275 7420 3d20 666f 726d 2e63  rds_but = form.c
+0001a030: 6869 6c64 7265 6e5b 3133 5d2e 6368 696c  hildren[13].chil
+0001a040: 6472 656e 5b30 5d20 2023 2069 6e73 6964  dren[0]  # insid
+0001a050: 6520 6c61 6265 6c0a 2020 2020 2020 2020  e label.        
+0001a060: 7365 6c66 2e5f 636f 7079 5f62 7574 203d  self._copy_but =
+0001a070: 2066 6f72 6d2e 6368 696c 6472 656e 5b31   form.children[1
+0001a080: 345d 0a20 2020 2020 2020 2073 656c 662e  4].        self.
+0001a090: 5f73 6176 6563 7376 5f62 7574 203d 2066  _savecsv_but = f
+0001a0a0: 6f72 6d2e 6368 696c 6472 656e 5b31 365d  orm.children[16]
+0001a0b0: 0a20 2020 2020 2020 2073 656c 662e 5f73  .        self._s
+0001a0c0: 6176 6570 6466 5f62 7574 203d 2066 6f72  avepdf_but = for
+0001a0d0: 6d2e 6368 696c 6472 656e 5b31 385d 0a0a  m.children[18]..
+0001a0e0: 2020 2020 2020 2020 2320 436f 6e6e 6563          # Connec
+0001a0f0: 7420 696e 7075 7420 656c 656d 656e 7473  t input elements
+0001a100: 0a20 2020 2020 2020 2063 6c6f 7365 5f62  .        close_b
+0001a110: 7574 203d 2073 656c 662e 6d61 696e 6469  ut = self.maindi
+0001a120: 762e 6368 696c 6472 656e 5b30 5d2e 6368  v.children[0].ch
+0001a130: 696c 6472 656e 5b2d 315d 0a20 2020 2020  ildren[-1].     
+0001a140: 2020 2063 6c6f 7365 5f62 7574 2e6f 6e63     close_but.onc
+0001a150: 6c69 636b 203d 2073 656c 662e 636c 6f73  lick = self.clos
+0001a160: 650a 2020 2020 2020 2020 7365 6c66 2e5f  e.        self._
+0001a170: 6461 7465 5f72 616e 6765 2e69 6e6e 6572  date_range.inner
+0001a180: 4854 4d4c 203d 2028 0a20 2020 2020 2020  HTML = (.       
+0001a190: 2020 2020 2074 315f 6461 7465 202b 2022       t1_date + "
+0001a1a0: 266e 6273 703b 266e 6273 703b 266e 6461  &nbsp;&nbsp;&nda
+0001a1b0: 7368 3b26 6e62 7370 3b26 6e62 7370 3b22  sh;&nbsp;&nbsp;"
+0001a1c0: 202b 2074 325f 6461 7465 0a20 2020 2020   + t2_date.     
+0001a1d0: 2020 2029 0a20 2020 2020 2020 2073 656c     ).        sel
+0001a1e0: 662e 5f64 6174 655f 7261 6e67 652e 696e  f._date_range.in
+0001a1f0: 6e65 7248 544d 4c20 2b3d 2028 0a20 2020  nerHTML += (.   
+0001a200: 2020 2020 2020 2020 2022 266e 6273 703b           "&nbsp;
+0001a210: 266e 6273 703b 3c62 7574 746f 6e20 7479  &nbsp;<button ty
+0001a220: 7065 3d27 6275 7474 6f6e 273e 3c69 2063  pe='button'><i c
+0001a230: 6c61 7373 3d27 6661 7327 3e5c 7566 3037  lass='fas'>\uf07
+0001a240: 333c 2f69 3e3c 2f62 7574 746f 6e3e 220a  3</i></button>".
+0001a250: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0001a260: 2020 6461 7465 5f62 7574 746f 6e20 3d20    date_button = 
+0001a270: 7365 6c66 2e5f 6461 7465 5f72 616e 6765  self._date_range
+0001a280: 2e63 6869 6c64 7265 6e5b 305d 0a20 2020  .children[0].   
+0001a290: 2020 2020 2064 6174 655f 6275 7474 6f6e       date_button
+0001a2a0: 2e6f 6e63 6c69 636b 203d 2073 656c 662e  .onclick = self.
+0001a2b0: 5f75 7365 725f 6368 6f73 655f 6461 7465  _user_chose_date
+0001a2c0: 0a20 2020 2020 2020 2023 0a20 2020 2020  .        #.     
+0001a2d0: 2020 2067 726f 7570 696e 6720 3d20 7769     grouping = wi
+0001a2e0: 6e64 6f77 2e73 696d 706c 6573 6574 7469  ndow.simplesetti
+0001a2f0: 6e67 732e 6765 7428 2272 6570 6f72 745f  ngs.get("report_
+0001a300: 6772 6f75 7069 6e67 2229 0a20 2020 2020  grouping").     
+0001a310: 2020 2073 656c 662e 5f67 726f 7570 696e     self._groupin
+0001a320: 675f 7365 6c65 6374 2e76 616c 7565 203d  g_select.value =
+0001a330: 2067 726f 7570 696e 670a 2020 2020 2020   grouping.      
+0001a340: 2020 6772 6f75 7070 6572 696f 6420 3d20    groupperiod = 
+0001a350: 7769 6e64 6f77 2e73 696d 706c 6573 6574  window.simpleset
+0001a360: 7469 6e67 732e 6765 7428 2272 6570 6f72  tings.get("repor
+0001a370: 745f 6772 6f75 7070 6572 696f 6422 290a  t_groupperiod").
+0001a380: 2020 2020 2020 2020 7365 6c66 2e5f 6772          self._gr
+0001a390: 6f75 7070 6572 696f 645f 7365 6c65 6374  oupperiod_select
+0001a3a0: 2e76 616c 7565 203d 2067 726f 7570 7065  .value = grouppe
+0001a3b0: 7269 6f64 0a20 2020 2020 2020 2068 6964  riod.        hid
+0001a3c0: 6573 6563 6f6e 6461 7279 203d 2077 696e  esecondary = win
+0001a3d0: 646f 772e 7369 6d70 6c65 7365 7474 696e  dow.simplesettin
+0001a3e0: 6773 2e67 6574 2822 7265 706f 7274 5f68  gs.get("report_h
+0001a3f0: 6964 6573 6563 6f6e 6461 7279 2229 0a20  idesecondary"). 
+0001a400: 2020 2020 2020 2073 656c 662e 5f68 6964         self._hid
+0001a410: 6573 6563 6f6e 6461 7279 5f62 7574 2e63  esecondary_but.c
+0001a420: 6865 636b 6564 203d 2068 6964 6573 6563  hecked = hidesec
+0001a430: 6f6e 6461 7279 0a20 2020 2020 2020 2066  ondary.        f
+0001a440: 6f72 6d61 7420 3d20 7769 6e64 6f77 2e73  ormat = window.s
+0001a450: 696d 706c 6573 6574 7469 6e67 732e 6765  implesettings.ge
+0001a460: 7428 2272 6570 6f72 745f 666f 726d 6174  t("report_format
+0001a470: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
+0001a480: 5f66 6f72 6d61 745f 6275 742e 7661 6c75  _format_but.valu
+0001a490: 6520 3d20 666f 726d 6174 0a20 2020 2020  e = format.     
+0001a4a0: 2020 2073 686f 7772 6563 6f72 6473 203d     showrecords =
+0001a4b0: 2077 696e 646f 772e 7369 6d70 6c65 7365   window.simplese
+0001a4c0: 7474 696e 6773 2e67 6574 2822 7265 706f  ttings.get("repo
+0001a4d0: 7274 5f73 686f 7772 6563 6f72 6473 2229  rt_showrecords")
+0001a4e0: 0a20 2020 2020 2020 2073 656c 662e 5f73  .        self._s
+0001a4f0: 686f 7772 6563 6f72 6473 5f62 7574 2e63  howrecords_but.c
+0001a500: 6865 636b 6564 203d 2073 686f 7772 6563  hecked = showrec
+0001a510: 6f72 6473 0a20 2020 2020 2020 2023 0a20  ords.        #. 
+0001a520: 2020 2020 2020 2073 656c 662e 5f67 726f         self._gro
+0001a530: 7570 696e 675f 7365 6c65 6374 2e6f 6e63  uping_select.onc
+0001a540: 6861 6e67 6520 3d20 7365 6c66 2e5f 6f6e  hange = self._on
+0001a550: 5f73 6574 7469 6e67 5f63 6861 6e67 6564  _setting_changed
+0001a560: 0a20 2020 2020 2020 2073 656c 662e 5f67  .        self._g
+0001a570: 726f 7570 7065 7269 6f64 5f73 656c 6563  roupperiod_selec
+0001a580: 742e 6f6e 6368 616e 6765 203d 2073 656c  t.onchange = sel
+0001a590: 662e 5f6f 6e5f 7365 7474 696e 675f 6368  f._on_setting_ch
+0001a5a0: 616e 6765 640a 2020 2020 2020 2020 7365  anged.        se
+0001a5b0: 6c66 2e5f 6869 6465 7365 636f 6e64 6172  lf._hidesecondar
+0001a5c0: 795f 6275 742e 6f6e 696e 7075 7420 3d20  y_but.oninput = 
+0001a5d0: 7365 6c66 2e5f 6f6e 5f73 6574 7469 6e67  self._on_setting
+0001a5e0: 5f63 6861 6e67 6564 0a20 2020 2020 2020  _changed.       
+0001a5f0: 2073 656c 662e 5f66 6f72 6d61 745f 6275   self._format_bu
+0001a600: 742e 6f6e 6368 616e 6765 203d 2073 656c  t.onchange = sel
+0001a610: 662e 5f6f 6e5f 7365 7474 696e 675f 6368  f._on_setting_ch
+0001a620: 616e 6765 640a 2020 2020 2020 2020 7365  anged.        se
+0001a630: 6c66 2e5f 7368 6f77 7265 636f 7264 735f  lf._showrecords_
+0001a640: 6275 742e 6f6e 696e 7075 7420 3d20 7365  but.oninput = se
+0001a650: 6c66 2e5f 6f6e 5f73 6574 7469 6e67 5f63  lf._on_setting_c
+0001a660: 6861 6e67 6564 0a20 2020 2020 2020 2023  hanged.        #
+0001a670: 0a20 2020 2020 2020 2073 656c 662e 5f63  .        self._c
+0001a680: 6f70 795f 6275 742e 6f6e 636c 6963 6b20  opy_but.onclick 
+0001a690: 3d20 7365 6c66 2e5f 636f 7079 5f63 6c69  = self._copy_cli
+0001a6a0: 7062 6f61 7264 0a20 2020 2020 2020 2073  pboard.        s
+0001a6b0: 656c 662e 5f73 6176 6563 7376 5f62 7574  elf._savecsv_but
+0001a6c0: 2e6f 6e63 6c69 636b 203d 2073 656c 662e  .onclick = self.
+0001a6d0: 5f73 6176 655f 6173 5f63 7376 0a20 2020  _save_as_csv.   
+0001a6e0: 2020 2020 2073 656c 662e 5f73 6176 6570       self._savep
+0001a6f0: 6466 5f62 7574 2e6f 6e63 6c69 636b 203d  df_but.onclick =
+0001a700: 2073 656c 662e 5f73 6176 655f 6173 5f70   self._save_as_p
+0001a710: 6466 0a0a 2020 2020 2020 2020 7769 6e64  df..        wind
+0001a720: 6f77 2e73 6574 5469 6d65 6f75 7428 7365  ow.setTimeout(se
+0001a730: 6c66 2e5f 7570 6461 7465 5f74 6162 6c65  lf._update_table
+0001a740: 290a 2020 2020 2020 2020 7375 7065 7228  ).        super(
+0001a750: 292e 6f70 656e 284e 6f6e 6529 0a0a 2020  ).open(None)..  
+0001a760: 2020 6465 6620 5f75 7365 725f 6368 6f73    def _user_chos
+0001a770: 655f 6461 7465 2873 656c 6629 3a0a 2020  e_date(self):.  
+0001a780: 2020 2020 2020 7365 6c66 2e63 6c6f 7365        self.close
+0001a790: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
+0001a7a0: 5f63 616e 7661 732e 7469 6d65 7365 6c65  _canvas.timesele
+0001a7b0: 6374 696f 6e5f 6469 616c 6f67 2e6f 7065  ction_dialog.ope
+0001a7c0: 6e28 7365 6c66 2e6f 7065 6e29 0a0a 2020  n(self.open)..  
+0001a7d0: 2020 6465 6620 5f6f 6e5f 7365 7474 696e    def _on_settin
+0001a7e0: 675f 6368 616e 6765 6428 7365 6c66 293a  g_changed(self):
+0001a7f0: 0a20 2020 2020 2020 2077 696e 646f 772e  .        window.
+0001a800: 7369 6d70 6c65 7365 7474 696e 6773 2e73  simplesettings.s
+0001a810: 6574 2822 7265 706f 7274 5f67 726f 7570  et("report_group
+0001a820: 696e 6722 2c20 7365 6c66 2e5f 6772 6f75  ing", self._grou
+0001a830: 7069 6e67 5f73 656c 6563 742e 7661 6c75  ping_select.valu
+0001a840: 6529 0a20 2020 2020 2020 2077 696e 646f  e).        windo
+0001a850: 772e 7369 6d70 6c65 7365 7474 696e 6773  w.simplesettings
+0001a860: 2e73 6574 2822 7265 706f 7274 5f67 726f  .set("report_gro
+0001a870: 7570 7065 7269 6f64 222c 2073 656c 662e  upperiod", self.
+0001a880: 5f67 726f 7570 7065 7269 6f64 5f73 656c  _groupperiod_sel
+0001a890: 6563 742e 7661 6c75 6529 0a20 2020 2020  ect.value).     
+0001a8a0: 2020 2077 696e 646f 772e 7369 6d70 6c65     window.simple
+0001a8b0: 7365 7474 696e 6773 2e73 6574 280a 2020  settings.set(.  
+0001a8c0: 2020 2020 2020 2020 2020 2272 6570 6f72            "repor
+0001a8d0: 745f 6869 6465 7365 636f 6e64 6172 7922  t_hidesecondary"
+0001a8e0: 2c20 7365 6c66 2e5f 6869 6465 7365 636f  , self._hideseco
+0001a8f0: 6e64 6172 795f 6275 742e 6368 6563 6b65  ndary_but.checke
+0001a900: 640a 2020 2020 2020 2020 290a 2020 2020  d.        ).    
+0001a910: 2020 2020 7769 6e64 6f77 2e73 696d 706c      window.simpl
+0001a920: 6573 6574 7469 6e67 732e 7365 7428 2272  esettings.set("r
+0001a930: 6570 6f72 745f 666f 726d 6174 222c 2073  eport_format", s
+0001a940: 656c 662e 5f66 6f72 6d61 745f 6275 742e  elf._format_but.
+0001a950: 7661 6c75 6529 0a20 2020 2020 2020 2077  value).        w
+0001a960: 696e 646f 772e 7369 6d70 6c65 7365 7474  indow.simplesett
+0001a970: 696e 6773 2e73 6574 2822 7265 706f 7274  ings.set("report
+0001a980: 5f73 686f 7772 6563 6f72 6473 222c 2073  _showrecords", s
+0001a990: 656c 662e 5f73 686f 7772 6563 6f72 6473  elf._showrecords
+0001a9a0: 5f62 7574 2e63 6865 636b 6564 290a 2020  _but.checked).  
+0001a9b0: 2020 2020 2020 7365 6c66 2e5f 7570 6461        self._upda
+0001a9c0: 7465 5f74 6162 6c65 2829 0a0a 2020 2020  te_table()..    
+0001a9d0: 6465 6620 5f75 7064 6174 655f 7461 626c  def _update_tabl
+0001a9e0: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
+0001a9f0: 2074 315f 6461 7465 203d 2073 656c 662e   t1_date = self.
+0001aa00: 5f74 315f 6461 7465 0a20 2020 2020 2020  _t1_date.       
+0001aa10: 2074 325f 6461 7465 203d 2073 656c 662e   t2_date = self.
+0001aa20: 5f74 325f 6461 7465 0a20 2020 2020 2020  _t2_date.       
+0001aa30: 2069 6620 6e6f 7420 666c 6f61 7428 7431   if not float(t1
+0001aa40: 5f64 6174 652e 7370 6c69 7428 222d 2229  _date.split("-")
+0001aa50: 5b30 5d29 203e 2031 3839 393a 0a20 2020  [0]) > 1899:.   
+0001aa60: 2020 2020 2020 2020 2073 656c 662e 5f74           self._t
+0001aa70: 6162 6c65 5f65 6c65 6d65 6e74 2e69 6e6e  able_element.inn
+0001aa80: 6572 4854 4d4c 203d 2022 220a 2020 2020  erHTML = "".    
+0001aa90: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
+0001aaa0: 2020 2020 2020 2065 6c69 6620 6e6f 7420         elif not 
+0001aab0: 666c 6f61 7428 7432 5f64 6174 652e 7370  float(t2_date.sp
+0001aac0: 6c69 7428 222d 2229 5b30 5d29 203e 2031  lit("-")[0]) > 1
+0001aad0: 3839 393a 0a20 2020 2020 2020 2020 2020  899:.           
+0001aae0: 2073 656c 662e 5f74 6162 6c65 5f65 6c65   self._table_ele
+0001aaf0: 6d65 6e74 2e69 6e6e 6572 4854 4d4c 203d  ment.innerHTML =
+0001ab00: 2022 220a 2020 2020 2020 2020 2020 2020   "".            
+0001ab10: 7265 7475 726e 0a0a 2020 2020 2020 2020  return..        
+0001ab20: 7431 203d 2073 7472 5f64 6174 655f 746f  t1 = str_date_to
+0001ab30: 5f74 696d 655f 696e 7428 7431 5f64 6174  _time_int(t1_dat
+0001ab40: 6529 0a20 2020 2020 2020 2074 3220 3d20  e).        t2 = 
+0001ab50: 7374 725f 6461 7465 5f74 6f5f 7469 6d65  str_date_to_time
+0001ab60: 5f69 6e74 2874 325f 6461 7465 290a 2020  _int(t2_date).  
+0001ab70: 2020 2020 2020 7432 203d 2064 742e 6164        t2 = dt.ad
+0001ab80: 6428 7432 2c20 2231 4422 2920 2023 206c  d(t2, "1D")  # l
+0001ab90: 6f6f 6b20 756e 7469 6c20 7468 6520 656e  ook until the en
+0001aba0: 6420 6f66 2074 6865 2064 6179 0a0a 2020  d of the day..  
+0001abb0: 2020 2020 2020 7365 6c66 2e5f 6c61 7374        self._last
+0001abc0: 5f74 312c 2073 656c 662e 5f6c 6173 745f  _t1, self._last_
+0001abd0: 7432 203d 2074 312c 2074 320a 2020 2020  t2 = t1, t2.    
+0001abe0: 2020 2020 6874 6d6c 203d 2073 656c 662e      html = self.
+0001abf0: 5f67 656e 6572 6174 655f 7461 626c 655f  _generate_table_
+0001ac00: 6874 6d6c 2873 656c 662e 5f67 656e 6572  html(self._gener
+0001ac10: 6174 655f 7461 626c 655f 726f 7773 2874  ate_table_rows(t
+0001ac20: 312c 2074 3229 290a 2020 2020 2020 2020  1, t2)).        
+0001ac30: 7365 6c66 2e5f 7461 626c 655f 656c 656d  self._table_elem
+0001ac40: 656e 742e 696e 6e65 7248 544d 4c20 3d20  ent.innerHTML = 
+0001ac50: 6874 6d6c 0a0a 2020 2020 2020 2020 2320  html..        # 
+0001ac60: 436f 6e66 6967 7572 6520 7468 6520 7461  Configure the ta
+0001ac70: 626c 6520 2e2e 2e0a 2020 2020 2020 2020  ble ....        
+0001ac80: 6966 2073 656c 662e 5f73 686f 7772 6563  if self._showrec
+0001ac90: 6f72 6473 5f62 7574 2e63 6865 636b 6564  ords_but.checked
+0001aca0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+0001acb0: 6c66 2e5f 7461 626c 655f 656c 656d 656e  lf._table_elemen
+0001acc0: 742e 636c 6173 734c 6973 742e 6164 6428  t.classList.add(
+0001acd0: 2264 6172 6b68 6561 6465 7273 2229 0a20  "darkheaders"). 
+0001ace0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0001acf0: 2020 2020 2020 2020 2073 656c 662e 5f74           self._t
+0001ad00: 6162 6c65 5f65 6c65 6d65 6e74 2e63 6c61  able_element.cla
+0001ad10: 7373 4c69 7374 2e72 656d 6f76 6528 2264  ssList.remove("d
+0001ad20: 6172 6b68 6561 6465 7273 2229 0a0a 2020  arkheaders")..  
+0001ad30: 2020 2020 2020 2320 416c 736f 2061 7070        # Also app
+0001ad40: 6c79 2069 6e20 7468 6520 6170 7020 6974  ly in the app it
+0001ad50: 7365 6c66 210a 2020 2020 2020 2020 7769  self!.        wi
+0001ad60: 6e64 6f77 2e63 616e 7661 732e 7261 6e67  ndow.canvas.rang
+0001ad70: 652e 616e 696d 6174 655f 7261 6e67 6528  e.animate_range(
+0001ad80: 7431 2c20 7432 2c20 4e6f 6e65 2c20 4661  t1, t2, None, Fa
+0001ad90: 6c73 6529 2020 2320 7769 7468 6f75 7420  lse)  # without 
+0001ada0: 736e 6170 0a0a 2020 2020 6465 6620 5f67  snap..    def _g
+0001adb0: 656e 6572 6174 655f 7461 626c 655f 726f  enerate_table_ro
+0001adc0: 7773 2873 656c 662c 2074 312c 2074 3229  ws(self, t1, t2)
+0001add0: 3a0a 2020 2020 2020 2020 7368 6f77 7265  :.        showre
+0001ade0: 636f 7264 7320 3d20 7365 6c66 2e5f 7368  cords = self._sh
+0001adf0: 6f77 7265 636f 7264 735f 6275 742e 6368  owrecords_but.ch
+0001ae00: 6563 6b65 640a 0a20 2020 2020 2020 2066  ecked..        f
+0001ae10: 6f72 6d61 7420 3d20 7365 6c66 2e5f 666f  ormat = self._fo
+0001ae20: 726d 6174 5f62 7574 2e76 616c 7565 0a20  rmat_but.value. 
+0001ae30: 2020 2020 2020 2069 6620 666f 726d 6174         if format
+0001ae40: 203d 3d20 2268 3022 3a0a 2020 2020 2020   == "h0":.      
+0001ae50: 2020 2020 2020 726f 756e 645f 6475 7261        round_dura
+0001ae60: 7469 6f6e 203d 206c 616d 6264 6120 743a  tion = lambda t:
+0001ae70: 204d 6174 682e 726f 756e 6428 7420 2f20   Math.round(t / 
+0001ae80: 3336 3030 2920 2a20 3336 3030 0a20 2020  3600) * 3600.   
+0001ae90: 2020 2020 2020 2020 2064 7572 6174 696f           duratio
+0001aea0: 6e32 7374 7220 3d20 6c61 6d62 6461 2074  n2str = lambda t
+0001aeb0: 3a20 6622 7b74 2f33 3630 303a 302e 3066  : f"{t/3600:0.0f
+0001aec0: 7d22 0a20 2020 2020 2020 2065 6c69 6620  }".        elif 
+0001aed0: 666f 726d 6174 203d 3d20 2268 3122 3a0a  format == "h1":.
+0001aee0: 2020 2020 2020 2020 2020 2020 726f 756e              roun
+0001aef0: 645f 6475 7261 7469 6f6e 203d 206c 616d  d_duration = lam
+0001af00: 6264 6120 743a 204d 6174 682e 726f 756e  bda t: Math.roun
+0001af10: 6428 7420 2f20 3336 3029 202a 2033 3630  d(t / 360) * 360
+0001af20: 0a20 2020 2020 2020 2020 2020 2064 7572  .            dur
+0001af30: 6174 696f 6e32 7374 7220 3d20 6c61 6d62  ation2str = lamb
+0001af40: 6461 2074 3a20 6622 7b74 2f33 3630 303a  da t: f"{t/3600:
+0001af50: 302e 3166 7d22 0a20 2020 2020 2020 2065  0.1f}".        e
+0001af60: 6c69 6620 666f 726d 6174 203d 3d20 2268  lif format == "h
+0001af70: 3222 3a0a 2020 2020 2020 2020 2020 2020  2":.            
+0001af80: 726f 756e 645f 6475 7261 7469 6f6e 203d  round_duration =
+0001af90: 206c 616d 6264 6120 743a 204d 6174 682e   lambda t: Math.
+0001afa0: 726f 756e 6428 7420 2f20 3336 2920 2a20  round(t / 36) * 
+0001afb0: 3336 0a20 2020 2020 2020 2020 2020 2064  36.            d
+0001afc0: 7572 6174 696f 6e32 7374 7220 3d20 6c61  uration2str = la
+0001afd0: 6d62 6461 2074 3a20 6622 7b74 2f33 3630  mbda t: f"{t/360
+0001afe0: 303a 302e 3266 7d22 0a20 2020 2020 2020  0:0.2f}".       
+0001aff0: 2065 6c69 6620 666f 726d 6174 203d 3d20   elif format == 
+0001b000: 2268 3322 3a0a 2020 2020 2020 2020 2020  "h3":.          
+0001b010: 2020 726f 756e 645f 6475 7261 7469 6f6e    round_duration
+0001b020: 203d 206c 616d 6264 6120 743a 204d 6174   = lambda t: Mat
+0001b030: 682e 726f 756e 6428 7420 2f20 332e 3629  h.round(t / 3.6)
+0001b040: 202a 2033 2e36 0a20 2020 2020 2020 2020   * 3.6.         
+0001b050: 2020 2064 7572 6174 696f 6e32 7374 7220     duration2str 
+0001b060: 3d20 6c61 6d62 6461 2074 3a20 6622 7b74  = lambda t: f"{t
+0001b070: 2f33 3630 303a 302e 3366 7d22 0a20 2020  /3600:0.3f}".   
+0001b080: 2020 2020 2065 6c69 6620 666f 726d 6174       elif format
+0001b090: 203d 3d20 2268 3422 3a0a 2020 2020 2020   == "h4":.      
+0001b0a0: 2020 2020 2020 726f 756e 645f 6475 7261        round_dura
+0001b0b0: 7469 6f6e 203d 206c 616d 6264 6120 743a  tion = lambda t:
+0001b0c0: 204d 6174 682e 726f 756e 6428 7420 2f20   Math.round(t / 
+0001b0d0: 302e 3336 2920 2a20 302e 3336 0a20 2020  0.36) * 0.36.   
+0001b0e0: 2020 2020 2020 2020 2064 7572 6174 696f           duratio
+0001b0f0: 6e32 7374 7220 3d20 6c61 6d62 6461 2074  n2str = lambda t
+0001b100: 3a20 6622 7b74 2f33 3630 303a 302e 3466  : f"{t/3600:0.4f
+0001b110: 7d22 0a20 2020 2020 2020 2065 6c69 6620  }".        elif 
+0001b120: 666f 726d 6174 203d 3d20 2268 6d73 223a  format == "hms":
+0001b130: 0a20 2020 2020 2020 2020 2020 2072 6f75  .            rou
+0001b140: 6e64 5f64 7572 6174 696f 6e20 3d20 6c61  nd_duration = la
+0001b150: 6d62 6461 2074 3a20 4d61 7468 2e72 6f75  mbda t: Math.rou
+0001b160: 6e64 2874 290a 2020 2020 2020 2020 2020  nd(t).          
+0001b170: 2020 6475 7261 7469 6f6e 3273 7472 203d    duration2str =
+0001b180: 206c 616d 6264 6120 743a 2064 742e 6475   lambda t: dt.du
+0001b190: 7261 7469 6f6e 5f73 7472 696e 675f 636f  ration_string_co
+0001b1a0: 6c6f 6e28 742c 2054 7275 6529 0a20 2020  lon(t, True).   
+0001b1b0: 2020 2020 2065 6c73 653a 2020 2320 6661       else:  # fa
+0001b1c0: 6c6c 6261 636b 203d 3d20 2268 6d22 3a0a  llback == "hm":.
+0001b1d0: 2020 2020 2020 2020 2020 2020 726f 756e              roun
+0001b1e0: 645f 6475 7261 7469 6f6e 203d 206c 616d  d_duration = lam
+0001b1f0: 6264 6120 743a 204d 6174 682e 726f 756e  bda t: Math.roun
+0001b200: 6428 7420 2f20 3630 2920 2a20 3630 0a20  d(t / 60) * 60. 
+0001b210: 2020 2020 2020 2020 2020 2064 7572 6174             durat
+0001b220: 696f 6e32 7374 7220 3d20 6c61 6d62 6461  ion2str = lambda
+0001b230: 2074 3a20 6474 2e64 7572 6174 696f 6e5f   t: dt.duration_
+0001b240: 7374 7269 6e67 5f63 6f6c 6f6e 2874 2c20  string_colon(t, 
+0001b250: 4661 6c73 6529 0a0a 2020 2020 2020 2020  False)..        
+0001b260: 2320 4765 7420 7374 6174 7320 616e 6420  # Get stats and 
+0001b270: 736f 7274 6564 2072 6563 6f72 6473 2c20  sorted records, 
+0001b280: 7468 6973 2061 6c72 6561 6479 2065 7863  this already exc
+0001b290: 6c75 6465 7320 6869 6464 656e 2072 6563  ludes hidden rec
+0001b2a0: 6f72 6473 0a20 2020 2020 2020 2073 7461  ords.        sta
+0001b2b0: 7473 203d 2077 696e 646f 772e 7374 6f72  ts = window.stor
+0001b2c0: 652e 7265 636f 7264 732e 6765 745f 7374  e.records.get_st
+0001b2d0: 6174 7328 7431 2c20 7432 292e 636f 7079  ats(t1, t2).copy
+0001b2e0: 2829 0a20 2020 2020 2020 2072 6563 6f72  ().        recor
+0001b2f0: 6473 203d 2077 696e 646f 772e 7374 6f72  ds = window.stor
+0001b300: 652e 7265 636f 7264 732e 6765 745f 7265  e.records.get_re
+0001b310: 636f 7264 7328 7431 2c20 7432 292e 7661  cords(t1, t2).va
+0001b320: 6c75 6573 2829 0a20 2020 2020 2020 2072  lues().        r
+0001b330: 6563 6f72 6473 2e73 6f72 7428 6b65 793d  ecords.sort(key=
+0001b340: 6c61 6d62 6461 2072 6563 6f72 643a 2072  lambda record: r
+0001b350: 6563 6f72 642e 7431 290a 0a20 2020 2020  ecord.t1)..     
+0001b360: 2020 2023 2053 6574 2028 6170 7072 6f70     # Set (approp
+0001b370: 7269 6174 656c 7920 726f 756e 6465 6429  riately rounded)
+0001b380: 2064 7572 6174 696f 6e73 0a20 2020 2020   durations.     
+0001b390: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+0001b3a0: 6528 6c65 6e28 7265 636f 7264 7329 293a  e(len(records)):
+0001b3b0: 0a20 2020 2020 2020 2020 2020 2072 6563  .            rec
+0001b3c0: 6f72 6420 3d20 7265 636f 7264 735b 695d  ord = records[i]
+0001b3d0: 0a20 2020 2020 2020 2020 2020 2072 6563  .            rec
+0001b3e0: 6f72 642e 6475 7261 7469 6f6e 203d 2072  ord.duration = r
+0001b3f0: 6f75 6e64 5f64 7572 6174 696f 6e28 6d69  ound_duration(mi
+0001b400: 6e28 7432 2c20 7265 636f 7264 2e74 3229  n(t2, record.t2)
+0001b410: 202d 206d 6178 2874 312c 2072 6563 6f72   - max(t1, recor
+0001b420: 642e 7431 2929 0a0a 2020 2020 2020 2020  d.t1))..        
+0001b430: 2320 4465 7465 726d 696e 6520 7072 696f  # Determine prio
+0001b440: 7269 7469 6573 0a20 2020 2020 2020 2070  rities.        p
+0001b450: 7269 6f72 6974 6965 7320 3d20 7b7d 0a20  riorities = {}. 
+0001b460: 2020 2020 2020 2066 6f72 2074 6167 7a20         for tagz 
+0001b470: 696e 2073 7461 7473 2e6b 6579 7328 293a  in stats.keys():
+0001b480: 0a20 2020 2020 2020 2020 2020 2074 6167  .            tag
+0001b490: 7320 3d20 7461 677a 2e73 706c 6974 2822  s = tagz.split("
+0001b4a0: 2022 290a 2020 2020 2020 2020 2020 2020   ").            
+0001b4b0: 666f 7220 7461 6720 696e 2074 6167 733a  for tag in tags:
+0001b4c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b4d0: 2069 6e66 6f20 3d20 7769 6e64 6f77 2e73   info = window.s
+0001b4e0: 746f 7265 2e73 6574 7469 6e67 732e 6765  tore.settings.ge
+0001b4f0: 745f 7461 675f 696e 666f 2874 6167 290a  t_tag_info(tag).
+0001b500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b510: 7072 696f 7269 7469 6573 5b74 6167 5d20  priorities[tag] 
+0001b520: 3d20 696e 666f 2e67 6574 2822 7072 696f  = info.get("prio
+0001b530: 7269 7479 222c 2030 2920 6f72 2031 0a0a  rity", 0) or 1..
+0001b540: 2020 2020 2020 2020 2320 4765 7420 6265          # Get be
+0001b550: 7474 6572 206e 616d 6573 0a20 2020 2020  tter names.     
+0001b560: 2020 206e 616d 655f 6d61 7020 3d20 7574     name_map = ut
+0001b570: 696c 732e 6765 745f 6265 7474 6572 5f74  ils.get_better_t
+0001b580: 6167 5f6f 7264 6572 5f66 726f 6d5f 7374  ag_order_from_st
+0001b590: 6174 7328 0a20 2020 2020 2020 2020 2020  ats(.           
+0001b5a0: 2073 7461 7473 2c20 7365 6c66 2e5f 7461   stats, self._ta
+0001b5b0: 6773 2c20 5472 7565 2c20 7072 696f 7269  gs, True, priori
+0001b5c0: 7469 6573 0a20 2020 2020 2020 2029 0a0a  ties.        )..
+0001b5d0: 2020 2020 2020 2020 2320 4869 6465 2073          # Hide s
+0001b5e0: 6563 6f6e 6461 7279 2074 6167 7320 6279  econdary tags by
+0001b5f0: 2072 656d 6f76 696e 6720 7468 656d 2066   removing them f
+0001b600: 726f 6d20 7468 6520 6d61 7070 696e 672e  rom the mapping.
+0001b610: 0a20 2020 2020 2020 2023 204e 6f74 6520  .        # Note 
+0001b620: 7468 6174 2074 6869 7320 6d65 616e 7320  that this means 
+0001b630: 7468 6174 2064 6966 6665 7265 6e74 206b  that different k
+0001b640: 6579 7320 6e6f 7720 6d61 7020 746f 2074  eys now map to t
+0001b650: 6865 2073 616d 6520 7661 6c75 652e 0a20  he same value.. 
+0001b660: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
+0001b670: 6869 6465 7365 636f 6e64 6172 795f 6275  hidesecondary_bu
+0001b680: 742e 6368 6563 6b65 643a 0a20 2020 2020  t.checked:.     
+0001b690: 2020 2020 2020 2066 6f72 2074 6167 7a31         for tagz1
+0001b6a0: 2c20 7461 677a 3220 696e 206e 616d 655f  , tagz2 in name_
+0001b6b0: 6d61 702e 6974 656d 7328 293a 0a20 2020  map.items():.   
+0001b6c0: 2020 2020 2020 2020 2020 2020 2074 6167               tag
+0001b6d0: 7320 3d20 7461 677a 322e 7370 6c69 7428  s = tagz2.split(
+0001b6e0: 2220 2229 0a20 2020 2020 2020 2020 2020  " ").           
+0001b6f0: 2020 2020 2074 6167 7320 3d20 5b74 6167       tags = [tag
+0001b700: 2066 6f72 2074 6167 2069 6e20 7461 6773   for tag in tags
+0001b710: 2069 6620 7072 696f 7269 7469 6573 5b74   if priorities[t
+0001b720: 6167 5d20 3c3d 2031 5d0a 2020 2020 2020  ag] <= 1].      
+0001b730: 2020 2020 2020 2020 2020 7461 677a 3220            tagz2 
+0001b740: 3d20 7461 6773 2e6a 6f69 6e28 2220 2229  = tags.join(" ")
+0001b750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b760: 206e 616d 655f 6d61 705b 7461 677a 315d   name_map[tagz1]
+0001b770: 203d 2074 6167 7a32 0a0a 2020 2020 2020   = tagz2..      
+0001b780: 2020 2320 4372 6561 7465 206c 6973 7420    # Create list 
+0001b790: 6f66 2070 6169 7273 206f 6620 7374 6174  of pairs of stat
+0001b7a0: 2d6e 616d 652c 2073 7461 742d 6b65 792c  -name, stat-key,
+0001b7b0: 2061 6e64 2073 6f72 742e 0a20 2020 2020   and sort..     
+0001b7c0: 2020 2023 2054 6869 7320 6973 2074 6865     # This is the
+0001b7d0: 2072 6566 6572 656e 6365 206f 7264 6572   reference order
+0001b7e0: 2066 6f72 2074 6167 7a2e 0a20 2020 2020   for tagz..     
+0001b7f0: 2020 2073 7461 746f 626a 6563 7473 203d     statobjects =
+0001b800: 207b 7d0a 2020 2020 2020 2020 666f 7220   {}.        for 
+0001b810: 7461 677a 312c 2074 6167 7a32 2069 6e20  tagz1, tagz2 in 
+0001b820: 6e61 6d65 5f6d 6170 2e69 7465 6d73 2829  name_map.items()
+0001b830: 3a0a 2020 2020 2020 2020 2020 2020 7420  :.            t 
+0001b840: 3d20 7374 6174 6f62 6a65 6374 732e 6765  = statobjects.ge
+0001b850: 7428 7461 677a 322c 207b 7d29 2e67 6574  t(tagz2, {}).get
+0001b860: 2822 7422 2c20 3029 202b 2073 7461 7473  ("t", 0) + stats
+0001b870: 5b74 6167 7a31 5d0a 2020 2020 2020 2020  [tagz1].        
+0001b880: 2020 2020 7374 6174 6f62 6a65 6374 735b      statobjects[
+0001b890: 7461 677a 325d 203d 207b 2274 6167 7a22  tagz2] = {"tagz"
+0001b8a0: 3a20 7461 677a 322c 2022 7422 3a20 747d  : tagz2, "t": t}
+0001b8b0: 0a20 2020 2020 2020 2073 7461 746f 626a  .        statobj
+0001b8c0: 6563 7473 203d 2073 7461 746f 626a 6563  ects = statobjec
+0001b8d0: 7473 2e76 616c 7565 7328 290a 2020 2020  ts.values().    
+0001b8e0: 2020 2020 7574 696c 732e 6f72 6465 725f      utils.order_
+0001b8f0: 7374 6174 735f 6279 5f64 7572 6174 696f  stats_by_duratio
+0001b900: 6e5f 616e 645f 6e61 6d65 2873 7461 746f  n_and_name(stato
+0001b910: 626a 6563 7473 290a 0a20 2020 2020 2020  bjects)..       
+0001b920: 2023 2047 6574 2068 6f77 2074 6f20 6772   # Get how to gr
+0001b930: 6f75 7020 7468 6520 7265 636f 7264 730a  oup the records.
+0001b940: 2020 2020 2020 2020 6772 6f75 705f 6d65          group_me
+0001b950: 7468 6f64 203d 2073 656c 662e 5f67 726f  thod = self._gro
+0001b960: 7570 696e 675f 7365 6c65 6374 2e76 616c  uping_select.val
+0001b970: 7565 0a20 2020 2020 2020 2067 726f 7570  ue.        group
+0001b980: 5f70 6572 696f 6420 3d20 7365 6c66 2e5f  _period = self._
+0001b990: 6772 6f75 7070 6572 696f 645f 7365 6c65  groupperiod_sele
+0001b9a0: 6374 2e76 616c 7565 0a20 2020 2020 2020  ct.value.       
+0001b9b0: 2065 6d70 7479 5f74 6974 6c65 203d 2022   empty_title = "
+0001b9c0: 4765 6e65 7261 6c22 0a0a 2020 2020 2020  General"..      
+0001b9d0: 2020 2320 5065 7266 6f72 6d20 7072 696d    # Perform prim
+0001b9e0: 6172 7920 6772 6f75 7069 6e67 202e 2e2e  ary grouping ...
+0001b9f0: 0a20 2020 2020 2020 2069 6620 6772 6f75  .        if grou
+0001ba00: 705f 6d65 7468 6f64 203d 3d20 2274 6167  p_method == "tag
+0001ba10: 7a22 3a0a 2020 2020 2020 2020 2020 2020  z":.            
+0001ba20: 6772 6f75 7073 203d 207b 7d0a 2020 2020  groups = {}.    
+0001ba30: 2020 2020 2020 2020 666f 7220 6f62 6a20          for obj 
+0001ba40: 696e 2073 7461 746f 626a 6563 7473 3a0a  in statobjects:.
+0001ba50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ba60: 6772 6f75 7073 5b6f 626a 2e74 6167 7a5d  groups[obj.tagz]
+0001ba70: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
+0001ba80: 2020 2020 2020 2020 2022 7469 746c 6522           "title"
+0001ba90: 3a20 6f62 6a2e 7461 677a 206f 7220 656d  : obj.tagz or em
+0001baa0: 7074 795f 7469 746c 652c 0a20 2020 2020  pty_title,.     
+0001bab0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0001bac0: 6475 7261 7469 6f6e 223a 2030 2c0a 2020  duration": 0,.  
+0001bad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bae0: 2020 2272 6563 6f72 6473 223a 205b 5d2c    "records": [],
+0001baf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001bb00: 207d 0a20 2020 2020 2020 2020 2020 2066   }.            f
+0001bb10: 6f72 2069 2069 6e20 7261 6e67 6528 6c65  or i in range(le
+0001bb20: 6e28 7265 636f 7264 7329 293a 0a20 2020  n(records)):.   
+0001bb30: 2020 2020 2020 2020 2020 2020 2072 6563               rec
+0001bb40: 6f72 6420 3d20 7265 636f 7264 735b 695d  ord = records[i]
+0001bb50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001bb60: 2074 6167 7a31 203d 2077 696e 646f 772e   tagz1 = window.
+0001bb70: 7374 6f72 652e 7265 636f 7264 732e 7461  store.records.ta
+0001bb80: 6773 5f66 726f 6d5f 7265 636f 7264 2872  gs_from_record(r
+0001bb90: 6563 6f72 6429 2e6a 6f69 6e28 2220 2229  ecord).join(" ")
+0001bba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001bbb0: 2069 6620 7461 677a 3120 6e6f 7420 696e   if tagz1 not in
+0001bbc0: 206e 616d 655f 6d61 703a 0a20 2020 2020   name_map:.     
+0001bbd0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0001bbe0: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
+0001bbf0: 2020 2020 2020 2020 7461 677a 3220 3d20          tagz2 = 
+0001bc00: 6e61 6d65 5f6d 6170 5b74 6167 7a31 5d0a  name_map[tagz1].
+0001bc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bc20: 6772 6f75 7020 3d20 6772 6f75 7073 5b74  group = groups[t
+0001bc30: 6167 7a32 5d0a 2020 2020 2020 2020 2020  agz2].          
+0001bc40: 2020 2020 2020 6772 6f75 702e 7265 636f        group.reco
+0001bc50: 7264 732e 7075 7368 2872 6563 6f72 6429  rds.push(record)
+0001bc60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001bc70: 2067 726f 7570 2e64 7572 6174 696f 6e20   group.duration 
+0001bc80: 2b3d 2072 6563 6f72 642e 6475 7261 7469  += record.durati
+0001bc90: 6f6e 0a20 2020 2020 2020 2020 2020 2067  on.            g
+0001bca0: 726f 7570 5f6c 6973 7431 203d 2067 726f  roup_list1 = gro
+0001bcb0: 7570 732e 7661 6c75 6573 2829 0a0a 2020  ups.values()..  
+0001bcc0: 2020 2020 2020 656c 6966 2067 726f 7570        elif group
+0001bcd0: 5f6d 6574 686f 6420 3d3d 2022 6473 223a  _method == "ds":
+0001bce0: 0a20 2020 2020 2020 2020 2020 2067 726f  .            gro
+0001bcf0: 7570 7320 3d20 7b7d 0a20 2020 2020 2020  ups = {}.       
+0001bd00: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
+0001bd10: 6e67 6528 6c65 6e28 7265 636f 7264 7329  nge(len(records)
+0001bd20: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001bd30: 2020 2072 6563 6f72 6420 3d20 7265 636f     record = reco
+0001bd40: 7264 735b 695d 0a20 2020 2020 2020 2020  rds[i].         
+0001bd50: 2020 2020 2020 2074 6167 7a31 203d 2077         tagz1 = w
+0001bd60: 696e 646f 772e 7374 6f72 652e 7265 636f  indow.store.reco
+0001bd70: 7264 732e 7461 6773 5f66 726f 6d5f 7265  rds.tags_from_re
+0001bd80: 636f 7264 2872 6563 6f72 6429 2e6a 6f69  cord(record).joi
+0001bd90: 6e28 2220 2229 0a20 2020 2020 2020 2020  n(" ").         
+0001bda0: 2020 2020 2020 2069 6620 7461 677a 3120         if tagz1 
+0001bdb0: 6e6f 7420 696e 206e 616d 655f 6d61 703a  not in name_map:
+0001bdc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001bdd0: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
+0001bde0: 2020 2020 2020 2020 2020 2020 2020 6473                ds
+0001bdf0: 203d 2072 6563 6f72 642e 6473 0a20 2020   = record.ds.   
+0001be00: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001be10: 6473 206e 6f74 2069 6e20 6772 6f75 7073  ds not in groups
+0001be20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001be30: 2020 2020 2020 6772 6f75 7073 5b64 735d        groups[ds]
+0001be40: 203d 207b 2274 6974 6c65 223a 2064 732c   = {"title": ds,
+0001be50: 2022 6475 7261 7469 6f6e 223a 2030 2c20   "duration": 0, 
+0001be60: 2272 6563 6f72 6473 223a 205b 5d7d 0a20  "records": []}. 
+0001be70: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+0001be80: 726f 7570 203d 2067 726f 7570 735b 6473  roup = groups[ds
+0001be90: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0001bea0: 2020 6772 6f75 702e 7265 636f 7264 732e    group.records.
+0001beb0: 7075 7368 2872 6563 6f72 6429 0a20 2020  push(record).   
+0001bec0: 2020 2020 2020 2020 2020 2020 2067 726f               gro
+0001bed0: 7570 2e64 7572 6174 696f 6e20 2b3d 2072  up.duration += r
+0001bee0: 6563 6f72 642e 6475 7261 7469 6f6e 0a20  ecord.duration. 
+0001bef0: 2020 2020 2020 2020 2020 2067 726f 7570             group
+0001bf00: 5f6c 6973 7431 203d 2067 726f 7570 732e  _list1 = groups.
+0001bf10: 7661 6c75 6573 2829 0a20 2020 2020 2020  values().       
+0001bf20: 2020 2020 2067 726f 7570 5f6c 6973 7431       group_list1
+0001bf30: 2e73 6f72 7428 6b65 793d 6c61 6d62 6461  .sort(key=lambda
+0001bf40: 2078 3a20 782e 7469 746c 652e 6c6f 7765   x: x.title.lowe
+0001bf50: 7228 2929 0a0a 2020 2020 2020 2020 656c  r())..        el
+0001bf60: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001bf70: 6772 6f75 7020 3d20 7b22 7469 746c 6522  group = {"title"
+0001bf80: 3a20 2268 6964 6465 6e22 2c20 2264 7572  : "hidden", "dur
+0001bf90: 6174 696f 6e22 3a20 302c 2022 7265 636f  ation": 0, "reco
+0001bfa0: 7264 7322 3a20 5b5d 7d0a 2020 2020 2020  rds": []}.      
+0001bfb0: 2020 2020 2020 6772 6f75 705f 6c69 7374        group_list
+0001bfc0: 3120 3d20 5b67 726f 7570 5d0a 2020 2020  1 = [group].    
+0001bfd0: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
+0001bfe0: 2072 616e 6765 286c 656e 2872 6563 6f72   range(len(recor
+0001bff0: 6473 2929 3a0a 2020 2020 2020 2020 2020  ds)):.          
+0001c000: 2020 2020 2020 7265 636f 7264 203d 2072        record = r
+0001c010: 6563 6f72 6473 5b69 5d0a 2020 2020 2020  ecords[i].      
+0001c020: 2020 2020 2020 2020 2020 7461 677a 3120            tagz1 
+0001c030: 3d20 7769 6e64 6f77 2e73 746f 7265 2e72  = window.store.r
+0001c040: 6563 6f72 6473 2e74 6167 735f 6672 6f6d  ecords.tags_from
+0001c050: 5f72 6563 6f72 6428 7265 636f 7264 292e  _record(record).
+0001c060: 6a6f 696e 2822 2022 290a 2020 2020 2020  join(" ").      
+0001c070: 2020 2020 2020 2020 2020 6966 2074 6167            if tag
+0001c080: 7a31 206e 6f74 2069 6e20 6e61 6d65 5f6d  z1 not in name_m
+0001c090: 6170 3a0a 2020 2020 2020 2020 2020 2020  ap:.            
+0001c0a0: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+0001c0b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c0c0: 2067 726f 7570 2e72 6563 6f72 6473 2e70   group.records.p
+0001c0d0: 7573 6828 7265 636f 7264 290a 0a20 2020  ush(record)..   
+0001c0e0: 2020 2020 2023 2050 6572 666f 726d 2067       # Perform g
+0001c0f0: 726f 7570 696e 6720 666f 7220 7469 6d65  rouping for time
+0001c100: 202e 2e2e 0a20 2020 2020 2020 2069 6620   ....        if 
+0001c110: 6772 6f75 705f 7065 7269 6f64 203d 3d20  group_period == 
+0001c120: 226e 6f6e 6522 3a0a 2020 2020 2020 2020  "none":.        
+0001c130: 2020 2020 6772 6f75 705f 6c69 7374 3220      group_list2 
+0001c140: 3d20 6772 6f75 705f 6c69 7374 310a 2020  = group_list1.  
+0001c150: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0001c160: 2020 2020 2020 2020 6772 6f75 7073 203d          groups =
+0001c170: 207b 7d0a 2020 2020 2020 2020 2020 2020   {}.            
+0001c180: 666f 7220 6772 6f75 705f 696e 6465 7820  for group_index 
+0001c190: 696e 2072 616e 6765 286c 656e 2867 726f  in range(len(gro
+0001c1a0: 7570 5f6c 6973 7431 2929 3a0a 2020 2020  up_list1)):.    
+0001c1b0: 2020 2020 2020 2020 2020 2020 6772 6f75              grou
+0001c1c0: 705f 7469 746c 6520 3d20 6772 6f75 705f  p_title = group_
+0001c1d0: 6c69 7374 315b 6772 6f75 705f 696e 6465  list1[group_inde
+0001c1e0: 785d 2e74 6974 6c65 0a20 2020 2020 2020  x].title.       
+0001c1f0: 2020 2020 2020 2020 2066 6f72 2072 6563           for rec
+0001c200: 6f72 6420 696e 2067 726f 7570 5f6c 6973  ord in group_lis
+0001c210: 7431 5b67 726f 7570 5f69 6e64 6578 5d2e  t1[group_index].
+0001c220: 7265 636f 7264 733a 0a20 2020 2020 2020  records:.       
+0001c230: 2020 2020 2020 2020 2020 2020 2023 2047               # G
+0001c240: 6574 2070 6572 696f 6420 7374 7269 6e67  et period string
+0001c250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c260: 2020 2020 2064 6174 6520 3d20 6474 2e74       date = dt.t
+0001c270: 696d 6532 6c6f 6361 6c73 7472 2872 6563  ime2localstr(rec
+0001c280: 6f72 642e 7431 292e 7370 6c69 7428 2220  ord.t1).split(" 
+0001c290: 2229 5b30 5d0a 2020 2020 2020 2020 2020  ")[0].          
+0001c2a0: 2020 2020 2020 2020 2020 7965 6172 203d            year =
+0001c2b0: 2069 6e74 2864 6174 652e 7370 6c69 7428   int(date.split(
+0001c2c0: 222d 2229 5b30 5d29 0a20 2020 2020 2020  "-")[0]).       
+0001c2d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001c2e0: 6772 6f75 705f 7065 7269 6f64 203d 3d20  group_period == 
+0001c2f0: 2264 6179 223a 0a20 2020 2020 2020 2020  "day":.         
+0001c300: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001c310: 6572 696f 6420 3d20 222d 222e 6a6f 696e  eriod = "-".join
+0001c320: 2872 6576 6572 7365 6428 6461 7465 2e73  (reversed(date.s
+0001c330: 706c 6974 2822 2d22 2929 290a 2020 2020  plit("-"))).    
+0001c340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c350: 656c 6966 2067 726f 7570 5f70 6572 696f  elif group_perio
+0001c360: 6420 3d3d 2022 7765 656b 223a 0a20 2020  d == "week":.   
+0001c370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c380: 2020 2020 2077 6565 6b20 3d20 6474 2e67       week = dt.g
+0001c390: 6574 5f77 6565 6b6e 756d 6265 7228 7265  et_weeknumber(re
+0001c3a0: 636f 7264 2e74 3129 0a20 2020 2020 2020  cord.t1).       
+0001c3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c3c0: 2070 6572 696f 6420 3d20 6622 7b79 6561   period = f"{yea
+0001c3d0: 727d 577b 7765 656b 7d22 0a20 2020 2020  r}W{week}".     
+0001c3e0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0001c3f0: 6c69 6620 6772 6f75 705f 7065 7269 6f64  lif group_period
+0001c400: 203d 3d20 226d 6f6e 7468 223a 0a20 2020   == "month":.   
+0001c410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c420: 2020 2020 206d 6f6e 7468 203d 2069 6e74       month = int
+0001c430: 2864 6174 652e 7370 6c69 7428 222d 2229  (date.split("-")
+0001c440: 5b31 5d29 0a20 2020 2020 2020 2020 2020  [1]).           
+0001c450: 2020 2020 2020 2020 2020 2020 2070 6572               per
+0001c460: 696f 6420 3d20 6474 2e4d 4f4e 5448 535f  iod = dt.MONTHS_
+0001c470: 5348 4f52 545b 6d6f 6e74 6820 2d20 315d  SHORT[month - 1]
+0001c480: 202b 2066 2220 7b79 6561 727d 220a 2020   + f" {year}".  
+0001c490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c4a0: 2020 656c 6966 2067 726f 7570 5f70 6572    elif group_per
+0001c4b0: 696f 6420 3d3d 2022 7175 6172 7465 7222  iod == "quarter"
+0001c4c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001c4d0: 2020 2020 2020 2020 2020 6d6f 6e74 6820            month 
+0001c4e0: 3d20 696e 7428 6461 7465 2e73 706c 6974  = int(date.split
+0001c4f0: 2822 2d22 295b 315d 290a 2020 2020 2020  ("-")[1]).      
+0001c500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c510: 2020 7120 3d20 2231 3131 3232 3233 3333    q = "111222333
+0001c520: 3434 3422 5b6d 6f6e 7468 202d 2031 5d0a  444"[month - 1].
+0001c530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c540: 2020 2020 2020 2020 7065 7269 6f64 203d          period =
+0001c550: 2066 227b 7965 6172 7d51 7b71 7d22 0a20   f"{year}Q{q}". 
+0001c560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c570: 2020 2065 6c69 6620 6772 6f75 705f 7065     elif group_pe
+0001c580: 7269 6f64 203d 3d20 2279 6561 7222 3a0a  riod == "year":.
+0001c590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c5a0: 2020 2020 2020 2020 7065 7269 6f64 203d          period =
+0001c5b0: 2066 227b 7965 6172 7d22 0a20 2020 2020   f"{year}".     
+0001c5c0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0001c5d0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001c5e0: 2020 2020 2020 2020 2020 2020 2070 6572               per
+0001c5f0: 696f 6420 3d20 6461 7465 2020 2320 6661  iod = date  # fa
+0001c600: 6c6c 6261 636b 0a20 2020 2020 2020 2020  llback.         
+0001c610: 2020 2020 2020 2020 2020 2023 204e 6577             # New
+0001c620: 2074 6974 6c65 0a20 2020 2020 2020 2020   title.         
+0001c630: 2020 2020 2020 2020 2020 2023 204e 6f74             # Not
+0001c640: 653a 2063 616e 2074 7572 6e20 6172 6f75  e: can turn arou
+0001c650: 6e64 2074 6974 6c65 2061 6e64 2073 6f72  nd title and sor
+0001c660: 746b 6579 2074 6f20 6d61 6b65 2074 6865  tkey to make the
+0001c670: 2070 6572 696f 6420 7468 6520 7365 636f   period the seco
+0001c680: 6e64 6172 7920 6772 6f75 700a 2020 2020  ndary group.    
+0001c690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c6a0: 6966 2067 726f 7570 5f74 6974 6c65 203d  if group_title =
+0001c6b0: 3d20 2268 6964 6465 6e22 3a0a 2020 2020  = "hidden":.    
+0001c6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c6d0: 2020 2020 7469 746c 6520 3d20 7065 7269      title = peri
+0001c6e0: 6f64 0a20 2020 2020 2020 2020 2020 2020  od.             
+0001c6f0: 2020 2020 2020 2020 2020 2073 6f72 746b             sortk
+0001c700: 6579 203d 2064 6174 650a 2020 2020 2020  ey = date.      
+0001c710: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0001c720: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001c730: 2020 2020 2020 2020 2020 2020 7469 746c              titl
+0001c740: 6520 3d20 7065 7269 6f64 202b 2022 202f  e = period + " /
+0001c750: 2022 202b 2067 726f 7570 5f74 6974 6c65   " + group_title
+0001c760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c770: 2020 2020 2020 2020 2073 6f72 746b 6579           sortkey
+0001c780: 203d 2064 6174 6520 2b20 7374 7228 3130   = date + str(10
+0001c790: 3030 3030 3020 2b20 6772 6f75 705f 696e  00000 + group_in
+0001c7a0: 6465 7829 0a20 2020 2020 2020 2020 2020  dex).           
+0001c7b0: 2020 2020 2020 2020 2069 6620 7469 746c           if titl
+0001c7c0: 6520 6e6f 7420 696e 2067 726f 7570 733a  e not in groups:
+0001c7d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c7e0: 2020 2020 2020 2020 2067 726f 7570 735b           groups[
+0001c7f0: 7469 746c 655d 203d 207b 0a20 2020 2020  title] = {.     
+0001c800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c810: 2020 2020 2020 2022 7469 746c 6522 3a20         "title": 
+0001c820: 7469 746c 652c 0a20 2020 2020 2020 2020  title,.         
+0001c830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c840: 2020 2022 6475 7261 7469 6f6e 223a 2030     "duration": 0
+0001c850: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001c860: 2020 2020 2020 2020 2020 2020 2020 2272                "r
+0001c870: 6563 6f72 6473 223a 205b 5d2c 0a20 2020  ecords": [],.   
+0001c880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c890: 2020 2020 2020 2020 2022 736f 7274 6b65           "sortke
+0001c8a0: 7922 3a20 736f 7274 6b65 792c 0a20 2020  y": sortkey,.   
+0001c8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c8c0: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
+0001c8d0: 2020 2020 2020 2020 2020 2023 2041 7070             # App
+0001c8e0: 656e 640a 2020 2020 2020 2020 2020 2020  end.            
+0001c8f0: 2020 2020 2020 2020 6772 6f75 7020 3d20          group = 
+0001c900: 6772 6f75 7073 5b74 6974 6c65 5d0a 2020  groups[title].  
+0001c910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c920: 2020 6772 6f75 702e 7265 636f 7264 732e    group.records.
+0001c930: 7075 7368 2872 6563 6f72 6429 0a20 2020  push(record).   
+0001c940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c950: 2067 726f 7570 2e64 7572 6174 696f 6e20   group.duration 
+0001c960: 2b3d 2072 6563 6f72 642e 6475 7261 7469  += record.durati
+0001c970: 6f6e 0a0a 2020 2020 2020 2020 2020 2020  on..            
+0001c980: 2320 4765 7420 6e65 7720 6772 6f75 7073  # Get new groups
+0001c990: 2c20 736f 7274 6564 2062 7920 7065 7269  , sorted by peri
+0001c9a0: 6f64 0a20 2020 2020 2020 2020 2020 2067  od.            g
+0001c9b0: 726f 7570 5f6c 6973 7432 203d 2067 726f  roup_list2 = gro
+0001c9c0: 7570 732e 7661 6c75 6573 2829 0a20 2020  ups.values().   
+0001c9d0: 2020 2020 2020 2020 2067 726f 7570 5f6c           group_l
+0001c9e0: 6973 7432 2e73 6f72 7428 6b65 793d 6c61  ist2.sort(key=la
+0001c9f0: 6d62 6461 2078 3a20 782e 736f 7274 6b65  mbda x: x.sortke
+0001ca00: 7929 0a0a 2020 2020 2020 2020 2320 4765  y)..        # Ge
+0001ca10: 6e65 7261 7465 2072 6f77 730a 2020 2020  nerate rows.    
+0001ca20: 2020 2020 726f 7773 203d 205b 5d0a 0a20      rows = [].. 
+0001ca30: 2020 2020 2020 2023 2049 6e63 6c75 6465         # Include
+0001ca40: 2074 6f74 616c 0a20 2020 2020 2020 2074   total.        t
+0001ca50: 6f74 616c 5f64 7572 6174 696f 6e20 3d20  otal_duration = 
+0001ca60: 300a 2020 2020 2020 2020 666f 7220 6772  0.        for gr
+0001ca70: 6f75 7020 696e 2067 726f 7570 5f6c 6973  oup in group_lis
+0001ca80: 7432 3a0a 2020 2020 2020 2020 2020 2020  t2:.            
+0001ca90: 746f 7461 6c5f 6475 7261 7469 6f6e 202b  total_duration +
+0001caa0: 3d20 6772 6f75 702e 6475 7261 7469 6f6e  = group.duration
+0001cab0: 0a20 2020 2020 2020 2072 6f77 732e 6170  .        rows.ap
+0001cac0: 7065 6e64 285b 2268 6561 6422 2c20 6475  pend(["head", du
+0001cad0: 7261 7469 6f6e 3273 7472 2874 6f74 616c  ration2str(total
+0001cae0: 5f64 7572 6174 696f 6e29 2c20 2254 6f74  _duration), "Tot
+0001caf0: 616c 222c 2030 5d29 0a0a 2020 2020 2020  al", 0])..      
+0001cb00: 2020 666f 7220 6772 6f75 7020 696e 2067    for group in g
+0001cb10: 726f 7570 5f6c 6973 7432 3a0a 2020 2020  roup_list2:.    
+0001cb20: 2020 2020 2020 2020 2320 4164 6420 726f          # Add ro
+0001cb30: 7720 666f 7220 746f 7461 6c20 6f66 2074  w for total of t
+0001cb40: 6869 7320 7461 6720 636f 6d62 690a 2020  his tag combi.  
+0001cb50: 2020 2020 2020 2020 2020 6475 7261 7469            durati
+0001cb60: 6f6e 203d 2064 7572 6174 696f 6e32 7374  on = duration2st
+0001cb70: 7228 6772 6f75 702e 6475 7261 7469 6f6e  r(group.duration
+0001cb80: 290a 2020 2020 2020 2020 2020 2020 7061  ).            pa
+0001cb90: 6420 3d20 310a 2020 2020 2020 2020 2020  d = 1.          
+0001cba0: 2020 6966 2073 686f 7772 6563 6f72 6473    if showrecords
+0001cbb0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001cbc0: 2020 726f 7773 2e61 7070 656e 6428 5b22    rows.append(["
+0001cbd0: 626c 616e 6b22 5d29 0a20 2020 2020 2020  blank"]).       
+0001cbe0: 2020 2020 2069 6620 6772 6f75 702e 7469       if group.ti
+0001cbf0: 746c 6520 213d 2022 6869 6464 656e 223a  tle != "hidden":
+0001cc00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001cc10: 2072 6f77 732e 6170 7065 6e64 285b 2268   rows.append(["h
+0001cc20: 6561 6422 2c20 6475 7261 7469 6f6e 2c20  ead", duration, 
+0001cc30: 6772 6f75 702e 7469 746c 652c 2070 6164  group.title, pad
+0001cc40: 5d29 0a0a 2020 2020 2020 2020 2020 2020  ])..            
+0001cc50: 2320 4164 6420 726f 7720 666f 7220 6561  # Add row for ea
+0001cc60: 6368 2072 6563 6f72 640a 2020 2020 2020  ch record.      
+0001cc70: 2020 2020 2020 6966 2073 686f 7772 6563        if showrec
+0001cc80: 6f72 6473 3a0a 2020 2020 2020 2020 2020  ords:.          
+0001cc90: 2020 2020 2020 7265 636f 7264 7320 3d20        records = 
+0001cca0: 6772 6f75 702e 7265 636f 7264 730a 2020  group.records.  
+0001ccb0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0001ccc0: 7220 6920 696e 2072 616e 6765 286c 656e  r i in range(len
+0001ccd0: 2872 6563 6f72 6473 2929 3a0a 2020 2020  (records)):.    
+0001cce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ccf0: 7265 636f 7264 203d 2072 6563 6f72 6473  record = records
+0001cd00: 5b69 5d0a 2020 2020 2020 2020 2020 2020  [i].            
+0001cd10: 2020 2020 2020 2020 7364 312c 2073 7431          sd1, st1
+0001cd20: 203d 2064 742e 7469 6d65 326c 6f63 616c   = dt.time2local
+0001cd30: 7374 7228 7265 636f 7264 2e74 3129 2e73  str(record.t1).s
+0001cd40: 706c 6974 2822 2022 290a 2020 2020 2020  plit(" ").      
+0001cd50: 2020 2020 2020 2020 2020 2020 2020 7364                sd
+0001cd60: 322c 2073 7432 203d 2064 742e 7469 6d65  2, st2 = dt.time
+0001cd70: 326c 6f63 616c 7374 7228 7265 636f 7264  2localstr(record
+0001cd80: 2e74 3229 2e73 706c 6974 2822 2022 290a  .t2).split(" ").
+0001cd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cda0: 2020 2020 6966 2054 7275 653a 2020 2320      if True:  # 
+0001cdb0: 7374 312e 656e 6473 5769 7468 2822 3a30  st1.endsWith(":0
+0001cdc0: 3022 293a 0a20 2020 2020 2020 2020 2020  0"):.           
+0001cdd0: 2020 2020 2020 2020 2020 2020 2073 7431               st1
+0001cde0: 203d 2073 7431 5b3a 2d33 5d0a 2020 2020   = st1[:-3].    
+0001cdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ce00: 6966 2054 7275 653a 2020 2320 7374 322e  if True:  # st2.
+0001ce10: 656e 6473 5769 7468 2822 3a30 3022 293a  endsWith(":00"):
+0001ce20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ce30: 2020 2020 2020 2020 2073 7432 203d 2073           st2 = s
+0001ce40: 7432 5b3a 2d33 5d0a 2020 2020 2020 2020  t2[:-3].        
+0001ce50: 2020 2020 2020 2020 2020 2020 6475 7261              dura
+0001ce60: 7469 6f6e 203d 2064 7572 6174 696f 6e32  tion = duration2
+0001ce70: 7374 7228 7265 636f 7264 2e64 7572 6174  str(record.durat
+0001ce80: 696f 6e29 0a20 2020 2020 2020 2020 2020  ion).           
+0001ce90: 2020 2020 2020 2020 2072 6f77 732e 6170           rows.ap
+0001cea0: 7065 6e64 280a 2020 2020 2020 2020 2020  pend(.          
+0001ceb0: 2020 2020 2020 2020 2020 2020 2020 5b0a                [.
+0001cec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ced0: 2020 2020 2020 2020 2020 2020 2272 6563              "rec
+0001cee0: 6f72 6422 2c0a 2020 2020 2020 2020 2020  ord",.          
+0001cef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cf00: 2020 7265 636f 7264 2e6b 6579 2c0a 2020    record.key,.  
+0001cf10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cf20: 2020 2020 2020 2020 2020 6475 7261 7469            durati
+0001cf30: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
+0001cf40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cf50: 7364 312c 0a20 2020 2020 2020 2020 2020  sd1,.           
+0001cf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cf70: 2073 7431 2c0a 2020 2020 2020 2020 2020   st1,.          
+0001cf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cf90: 2020 7374 322c 0a20 2020 2020 2020 2020    st2,.         
+0001cfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cfb0: 2020 2074 6f5f 7374 7228 7265 636f 7264     to_str(record
+0001cfc0: 2e67 6574 2822 6473 222c 2022 2229 292c  .get("ds", "")),
+0001cfd0: 2020 2320 7374 7269 7020 7461 6273 2061    # strip tabs a
+0001cfe0: 6e64 206e 6577 6c69 6e65 730a 2020 2020  nd newlines.    
+0001cff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d000: 2020 2020 2020 2020 7769 6e64 6f77 2e73          window.s
+0001d010: 746f 7265 2e72 6563 6f72 6473 2e74 6167  tore.records.tag
+0001d020: 735f 6672 6f6d 5f72 6563 6f72 6428 7265  s_from_record(re
+0001d030: 636f 7264 292e 6a6f 696e 2822 2022 292c  cord).join(" "),
+0001d040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d050: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
+0001d060: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0001d070: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0001d080: 2072 6f77 730a 0a20 2020 2064 6566 205f   rows..    def _
+0001d090: 6765 6e65 7261 7465 5f74 6162 6c65 5f68  generate_table_h
+0001d0a0: 746d 6c28 7365 6c66 2c20 726f 7773 293a  tml(self, rows):
+0001d0b0: 0a20 2020 2020 2020 2077 696e 646f 772e  .        window.
+0001d0c0: 5f6f 7065 6e5f 7265 636f 7264 5f64 6961  _open_record_dia
+0001d0d0: 6c6f 6720 3d20 7365 6c66 2e5f 6f70 656e  log = self._open
+0001d0e0: 5f72 6563 6f72 640a 2020 2020 2020 2020  _record.        
+0001d0f0: 626c 616e 6b5f 726f 7720 3d20 223c 7472  blank_row = "<tr
+0001d100: 2063 6c61 7373 3d27 626c 616e 6b5f 726f   class='blank_ro
+0001d110: 7727 3e3c 7464 3e3c 2f74 643e 3c74 643e  w'><td></td><td>
+0001d120: 3c2f 7464 3e3c 7464 3e3c 2f74 643e 3c74  </td><td></td><t
+0001d130: 643e 3c2f 7464 3e3c 7464 3e3c 2f74 643e  d></td><td></td>
+0001d140: 3c74 643e 3c2f 7464 3e3c 7464 3e3c 2f74  <td></td><td></t
+0001d150: 643e 3c2f 7472 3e22 0a20 2020 2020 2020  d></tr>".       
+0001d160: 206c 696e 6573 203d 205b 5d0a 2020 2020   lines = [].    
+0001d170: 2020 2020 666f 7220 726f 7720 696e 2072      for row in r
+0001d180: 6f77 733a 0a20 2020 2020 2020 2020 2020  ows:.           
+0001d190: 2069 6620 726f 775b 305d 203d 3d20 2262   if row[0] == "b
+0001d1a0: 6c61 6e6b 223a 0a20 2020 2020 2020 2020  lank":.         
+0001d1b0: 2020 2020 2020 206c 696e 6573 2e61 7070         lines.app
+0001d1c0: 656e 6428 626c 616e 6b5f 726f 7729 0a20  end(blank_row). 
+0001d1d0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0001d1e0: 726f 775b 305d 203d 3d20 2268 6561 6422  row[0] == "head"
+0001d1f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001d200: 2020 6c69 6e65 732e 6170 7065 6e64 280a    lines.append(.
+0001d210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d220: 2020 2020 6622 3c74 723e 3c74 683e 7b72      f"<tr><th>{r
+0001d230: 6f77 5b31 5d7d 3c2f 7468 3e3c 7468 2063  ow[1]}</th><th c
+0001d240: 6c61 7373 3d27 7061 647b 726f 775b 335d  lass='pad{row[3]
+0001d250: 7d27 3e7b 726f 775b 325d 7d3c 2f74 683e  }'>{row[2]}</th>
+0001d260: 3c74 683e 3c2f 7468 3e22 0a20 2020 2020  <th></th>".     
+0001d270: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0001d280: 2022 3c74 683e 3c2f 7468 3e3c 7468 3e3c   "<th></th><th><
+0001d290: 2f74 683e 3c74 683e 3c2f 7468 3e3c 7468  /th><th></th><th
+0001d2a0: 3e3c 2f74 683e 3c2f 7472 3e22 0a20 2020  ></th></tr>".   
+0001d2b0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+0001d2c0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0001d2d0: 726f 775b 305d 203d 3d20 2272 6563 6f72  row[0] == "recor
+0001d2e0: 6422 3a0a 2020 2020 2020 2020 2020 2020  d":.            
+0001d2f0: 2020 2020 5f2c 206b 6579 2c20 6475 7261      _, key, dura
+0001d300: 7469 6f6e 2c20 7364 312c 2073 7431 2c20  tion, sd1, st1, 
+0001d310: 7374 322c 2064 732c 2074 6167 7a20 3d20  st2, ds, tagz = 
+0001d320: 726f 770a 2020 2020 2020 2020 2020 2020  row.            
+0001d330: 2020 2020 6c69 6e65 732e 6170 7065 6e64      lines.append
+0001d340: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001d350: 2020 2020 2020 6622 3c74 723e 3c74 643e        f"<tr><td>
+0001d360: 3c2f 7464 3e3c 7464 3e3c 2f74 643e 3c74  </td><td></td><t
+0001d370: 643e 7b64 7572 6174 696f 6e7d 3c2f 7464  d>{duration}</td
+0001d380: 3e22 0a20 2020 2020 2020 2020 2020 2020  >".             
+0001d390: 2020 2020 2020 202b 2066 223c 7464 3e7b         + f"<td>{
+0001d3a0: 7364 317d 3c2f 7464 3e3c 7464 2063 6c61  sd1}</td><td cla
+0001d3b0: 7373 3d27 7431 273e 7b73 7431 7d3c 2f74  ss='t1'>{st1}</t
+0001d3c0: 643e 3c74 6420 636c 6173 733d 2774 3227  d><td class='t2'
+0001d3d0: 3e7b 7374 327d 3c2f 7464 3e22 0a20 2020  >{st2}</td>".   
+0001d3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d3f0: 202b 2066 223c 7464 3e3c 6120 6f6e 636c   + f"<td><a oncl
+0001d400: 6963 6b3d 2777 696e 646f 772e 5f6f 7065  ick='window._ope
+0001d410: 6e5f 7265 636f 7264 5f64 6961 6c6f 6728  n_record_dialog(
+0001d420: 5c22 7b6b 6579 7d5c 2229 2720 7374 796c  \"{key}\")' styl
+0001d430: 653d 2763 7572 736f 723a 706f 696e 7465  e='cursor:pointe
+0001d440: 723b 273e 220a 2020 2020 2020 2020 2020  r;'>".          
+0001d450: 2020 2020 2020 2020 2020 2b20 6622 7b64            + f"{d
+0001d460: 7320 6f72 2027 266e 6273 703b 2d26 6e62  s or '&nbsp;-&nb
+0001d470: 7370 3b27 7d3c 2f61 3e3c 2f74 643e 3c2f  sp;'}</a></td></
+0001d480: 7472 3e22 0a20 2020 2020 2020 2020 2020  tr>".           
+0001d490: 2020 2020 2029 0a20 2020 2020 2020 2072       ).        r
+0001d4a0: 6574 7572 6e20 6c69 6e65 732e 6a6f 696e  eturn lines.join
+0001d4b0: 2822 2229 0a0a 2020 2020 6465 6620 5f6f  ("")..    def _o
+0001d4c0: 7065 6e5f 7265 636f 7264 2873 656c 662c  pen_record(self,
+0001d4d0: 206b 6579 293a 0a20 2020 2020 2020 2072   key):.        r
+0001d4e0: 6563 6f72 6420 3d20 7769 6e64 6f77 2e73  ecord = window.s
+0001d4f0: 746f 7265 2e72 6563 6f72 6473 2e67 6574  tore.records.get
+0001d500: 5f62 795f 6b65 7928 6b65 7929 0a20 2020  _by_key(key).   
+0001d510: 2020 2020 2073 656c 662e 5f63 616e 7661       self._canva
+0001d520: 732e 7265 636f 7264 5f64 6961 6c6f 672e  s.record_dialog.
+0001d530: 6f70 656e 2822 4564 6974 222c 2072 6563  open("Edit", rec
+0001d540: 6f72 642c 2073 656c 662e 5f75 7064 6174  ord, self._updat
+0001d550: 655f 7461 626c 6529 0a0a 2020 2020 6465  e_table)..    de
+0001d560: 6620 5f63 6f70 795f 636c 6970 626f 6172  f _copy_clipboar
+0001d570: 6428 7365 6c66 293a 0a20 2020 2020 2020  d(self):.       
+0001d580: 2074 6f6f 6c73 2e63 6f70 795f 646f 6d5f   tools.copy_dom_
+0001d590: 6e6f 6465 2873 656c 662e 5f74 6162 6c65  node(self._table
+0001d5a0: 5f65 6c65 6d65 6e74 290a 2020 2020 2020  _element).      
+0001d5b0: 2020 7365 6c66 2e5f 636f 7079 5f62 7574    self._copy_but
+0001d5c0: 2e69 6e6e 6572 4854 4d4c 203d 2028 0a20  .innerHTML = (. 
+0001d5d0: 2020 2020 2020 2020 2020 2066 223c 6920             f"<i 
+0001d5e0: 636c 6173 733d 2766 6173 273e 5c75 6634  class='fas'>\uf4
+0001d5f0: 3663 3c2f 693e 266e 6273 703b 266e 6273  6c</i>&nbsp;&nbs
+0001d600: 703b 7b73 656c 662e 5f63 6f70 7962 7574  p;{self._copybut
+0001d610: 7465 7874 7d22 0a20 2020 2020 2020 2029  text}".        )
+0001d620: 0a20 2020 2020 2020 2077 696e 646f 772e  .        window.
+0001d630: 7365 7454 696d 656f 7574 2873 656c 662e  setTimeout(self.
+0001d640: 5f72 6573 6574 5f63 6f70 795f 6275 745f  _reset_copy_but_
+0001d650: 7465 7874 2c20 3830 3029 0a0a 2020 2020  text, 800)..    
+0001d660: 6465 6620 5f72 6573 6574 5f63 6f70 795f  def _reset_copy_
+0001d670: 6275 745f 7465 7874 2873 656c 6629 3a0a  but_text(self):.
+0001d680: 2020 2020 2020 2020 7365 6c66 2e5f 636f          self._co
+0001d690: 7079 5f62 7574 2e69 6e6e 6572 4854 4d4c  py_but.innerHTML
+0001d6a0: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+0001d6b0: 2066 223c 6920 636c 6173 733d 2766 6173   f"<i class='fas
+0001d6c0: 273e 5c75 6633 3238 3c2f 693e 266e 6273  '>\uf328</i>&nbs
+0001d6d0: 703b 266e 6273 703b 7b73 656c 662e 5f63  p;&nbsp;{self._c
+0001d6e0: 6f70 7962 7574 7465 7874 7d22 0a20 2020  opybuttext}".   
+0001d6f0: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+0001d700: 5f67 6574 5f65 7870 6f72 745f 6669 6c65  _get_export_file
+0001d710: 6e61 6d65 2873 656c 662c 2065 7874 293a  name(self, ext):
+0001d720: 0a20 2020 2020 2020 2064 6174 6531 203d  .        date1 =
+0001d730: 2073 656c 662e 5f74 315f 6461 7465 2e72   self._t1_date.r
+0001d740: 6570 6c61 6365 2822 2d22 2c20 2222 290a  eplace("-", "").
+0001d750: 2020 2020 2020 2020 6461 7465 3220 3d20          date2 = 
+0001d760: 7365 6c66 2e5f 7432 5f64 6174 652e 7265  self._t2_date.re
+0001d770: 706c 6163 6528 222d 222c 2022 2229 0a20  place("-", ""). 
+0001d780: 2020 2020 2020 2069 6620 6461 7465 3120         if date1 
+0001d790: 3d3d 2064 6174 6532 3a0a 2020 2020 2020  == date2:.      
+0001d7a0: 2020 2020 2020 7265 7475 726e 2066 2274        return f"t
+0001d7b0: 696d 6574 6167 6765 722d 7b64 6174 6531  imetagger-{date1
+0001d7c0: 7d2e 7b65 7874 7d22 0a20 2020 2020 2020  }.{ext}".       
+0001d7d0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001d7e0: 2020 2072 6574 7572 6e20 6622 7469 6d65     return f"time
+0001d7f0: 7461 6767 6572 2d7b 6461 7465 317d 2d7b  tagger-{date1}-{
+0001d800: 6461 7465 327d 2e7b 6578 747d 220a 0a20  date2}.{ext}".. 
+0001d810: 2020 2064 6566 205f 7361 7665 5f61 735f     def _save_as_
+0001d820: 6373 7628 7365 6c66 293a 0a20 2020 2020  csv(self):.     
+0001d830: 2020 2023 2054 6869 7320 6973 2061 6c6c     # This is all
+0001d840: 2070 7265 7474 7920 7374 7261 6967 6874   pretty straight
+0001d850: 666f 7277 6172 642e 2054 6865 206d 6f73  forward. The mos
+0001d860: 7420 7472 6963 6b79 2062 6974 2069 740a  t tricky bit it.
+0001d870: 2020 2020 2020 2020 2320 7468 6520 6473          # the ds
+0001d880: 2028 6465 7363 7269 7074 696f 6e29 2e20   (description). 
+0001d890: 4974 2063 616e 2068 6176 6520 616e 7920  It can have any 
+0001d8a0: 556e 6963 6f64 652c 2073 6f20 6974 2073  Unicode, so it s
+0001d8b0: 686f 756c 640a 2020 2020 2020 2020 2320  hould.        # 
+0001d8c0: 7375 7272 6f75 6e64 6564 2062 7920 646f  surrounded by do
+0001d8d0: 7562 6c65 2071 756f 7465 732e 2041 6e79  uble quotes. Any
+0001d8e0: 2064 6f75 626c 652d 7175 6f74 6573 2069   double-quotes i
+0001d8f0: 6e73 6964 6520 7468 6520 6473 0a20 2020  nside the ds.   
+0001d900: 2020 2020 2023 206d 7573 7420 6265 2065       # must be e
+0001d910: 7363 6170 6564 2062 7920 646f 7562 6c69  scaped by doubli
+0001d920: 6e67 2074 6865 6d2e 2041 6e64 2066 696e  ng them. And fin
+0001d930: 616c 6c79 2c20 646f 6e27 7420 7075 7420  ally, don't put 
+0001d940: 7370 6163 650a 2020 2020 2020 2020 2320  space.        # 
+0001d950: 6166 7465 7220 636f 6d6d 6127 732c 206f  after comma's, o
+0001d960: 7220 746f 6f6c 7320 6c69 6b65 2045 7863  r tools like Exc
+0001d970: 656c 206d 6179 206e 6f74 2062 6520 6162  el may not be ab
+0001d980: 6c65 2074 6f20 7061 7273 650a 2020 2020  le to parse.    
+0001d990: 2020 2020 2320 7468 6520 7175 6f74 6564      # the quoted
+0001d9a0: 2073 7472 696e 6720 636f 7272 6563 746c   string correctl
+0001d9b0: 792e 204e 6f74 6520 7468 6174 2069 6e20  y. Note that in 
+0001d9c0: 5f67 656e 6572 6174 655f 7461 626c 655f  _generate_table_
+0001d9d0: 726f 7773 0a20 2020 2020 2020 2023 2074  rows.        # t
+0001d9e0: 6865 2064 7320 6973 2073 7469 7070 6564  he ds is stipped
+0001d9f0: 2066 726f 6d20 5c74 5c72 5c6e 2e0a 0a20   from \t\r\n... 
+0001da00: 2020 2020 2020 2072 6f77 7320 3d20 7365         rows = se
+0001da10: 6c66 2e5f 6765 6e65 7261 7465 5f74 6162  lf._generate_tab
+0001da20: 6c65 5f72 6f77 7328 7365 6c66 2e5f 6c61  le_rows(self._la
+0001da30: 7374 5f74 312c 2073 656c 662e 5f6c 6173  st_t1, self._las
+0001da40: 745f 7432 290a 0a20 2020 2020 2020 206c  t_t2)..        l
+0001da50: 696e 6573 203d 205b 5d0a 2020 2020 2020  ines = [].      
+0001da60: 2020 6c69 6e65 732e 6170 7065 6e64 280a    lines.append(.
+0001da70: 2020 2020 2020 2020 2020 2020 2273 7562              "sub
+0001da80: 746f 7461 6c73 2c74 6167 5f67 726f 7570  totals,tag_group
+0001da90: 732c 6475 7261 7469 6f6e 2c64 6174 652c  s,duration,date,
+0001daa0: 7374 6172 742c 7374 6f70 2c64 6573 6372  start,stop,descr
+0001dab0: 6970 7469 6f6e 2c75 7365 722c 7461 6773  iption,user,tags
+0001dac0: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
+0001dad0: 2020 2020 6c69 6e65 732e 6170 7065 6e64      lines.append
+0001dae0: 2822 2229 0a0a 2020 2020 2020 2020 7573  ("")..        us
+0001daf0: 6572 203d 2022 2220 2023 206e 6f71 610a  er = ""  # noqa.
+0001db00: 2020 2020 2020 2020 6966 2077 696e 646f          if windo
+0001db10: 772e 7374 6f72 652e 6765 745f 6175 7468  w.store.get_auth
+0001db20: 3a0a 2020 2020 2020 2020 2020 2020 6175  :.            au
+0001db30: 7468 203d 2077 696e 646f 772e 7374 6f72  th = window.stor
+0001db40: 652e 6765 745f 6175 7468 2829 0a20 2020  e.get_auth().   
+0001db50: 2020 2020 2020 2020 2069 6620 6175 7468           if auth
+0001db60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001db70: 2020 7573 6572 203d 2061 7574 682e 7573    user = auth.us
+0001db80: 6572 6e61 6d65 2020 2320 6e6f 7161 0a0a  ername  # noqa..
+0001db90: 2020 2020 2020 2020 666f 7220 726f 7720          for row 
+0001dba0: 696e 2072 6f77 733a 0a20 2020 2020 2020  in rows:.       
+0001dbb0: 2020 2020 2069 6620 726f 775b 305d 203d       if row[0] =
+0001dbc0: 3d20 2262 6c61 6e6b 223a 0a20 2020 2020  = "blank":.     
+0001dbd0: 2020 2020 2020 2020 2020 206c 696e 6573             lines
+0001dbe0: 2e61 7070 656e 6428 222c 2c2c 2c2c 2c2c  .append(",,,,,,,
+0001dbf0: 2c22 290a 2020 2020 2020 2020 2020 2020  ,").            
+0001dc00: 656c 6966 2072 6f77 5b30 5d20 3d3d 2022  elif row[0] == "
+0001dc10: 6865 6164 223a 0a20 2020 2020 2020 2020  head":.         
+0001dc20: 2020 2020 2020 206c 696e 6573 2e61 7070         lines.app
+0001dc30: 656e 6428 5261 774a 5328 2772 6f77 5b31  end(RawJS('row[1
+0001dc40: 5d20 2b20 222c 2220 2b20 726f 775b 325d  ] + "," + row[2]
+0001dc50: 202b 2022 2c2c 2c2c 2c2c 2c22 2729 290a   + ",,,,,,,"')).
+0001dc60: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+0001dc70: 2072 6f77 5b30 5d20 3d3d 2022 7265 636f   row[0] == "reco
+0001dc80: 7264 223a 0a20 2020 2020 2020 2020 2020  rd":.           
+0001dc90: 2020 2020 205f 2c20 6b65 792c 2064 7572       _, key, dur
+0001dca0: 6174 696f 6e2c 2073 6431 2c20 7374 312c  ation, sd1, st1,
+0001dcb0: 2073 7432 2c20 6473 2c20 7461 677a 203d   st2, ds, tagz =
+0001dcc0: 2072 6f77 0a20 2020 2020 2020 2020 2020   row.           
+0001dcd0: 2020 2020 2064 7320 3d20 2722 2720 2b20       ds = '"' + 
+0001dce0: 6473 2e72 6570 6c61 6365 2827 2227 2c20  ds.replace('"', 
+0001dcf0: 2722 2227 2920 2b20 2722 270a 2020 2020  '""') + '"'.    
+0001dd00: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
+0001dd10: 732e 6170 7065 6e64 280a 2020 2020 2020  s.append(.      
+0001dd20: 2020 2020 2020 2020 2020 2020 2020 5261                Ra
+0001dd30: 774a 5328 0a20 2020 2020 2020 2020 2020  wJS(.           
+0001dd40: 2020 2020 2020 2020 2020 2020 2022 2222               """
+0001dd50: 272c 2c27 202b 2064 7572 6174 696f 6e20  ',,' + duration 
+0001dd60: 2b20 272c 2720 2b20 7364 3120 2b20 272c  + ',' + sd1 + ',
+0001dd70: 2720 2b20 7374 3120 2b20 272c 2720 2b20  ' + st1 + ',' + 
+0001dd80: 7374 3220 2b20 272c 2720 2b20 6473 202b  st2 + ',' + ds +
+0001dd90: 2027 2c27 202b 2075 7365 7220 2b20 272c   ',' + user + ',
+0001dda0: 2720 2b20 7461 677a 2222 220a 2020 2020  ' + tagz""".    
+0001ddb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ddc0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001ddd0: 2020 290a 0a20 2020 2020 2020 2023 2047    )..        # G
+0001dde0: 6574 2062 6c6f 6220 7772 6170 7065 6420  et blob wrapped 
+0001ddf0: 696e 2061 6e20 6f62 6a65 6374 2075 726c  in an object url
+0001de00: 0a20 2020 2020 2020 206f 626a 5f75 726c  .        obj_url
+0001de10: 203d 2077 696e 646f 772e 5552 4c2e 6372   = window.URL.cr
+0001de20: 6561 7465 4f62 6a65 6374 5552 4c28 0a20  eateObjectURL(. 
+0001de30: 2020 2020 2020 2020 2020 2077 696e 646f             windo
+0001de40: 772e 426c 6f62 285b 225c 725c 6e22 2e6a  w.Blob(["\r\n".j
+0001de50: 6f69 6e28 6c69 6e65 7329 5d2c 207b 2274  oin(lines)], {"t
+0001de60: 7970 6522 3a20 2274 6578 742f 6373 7622  ype": "text/csv"
+0001de70: 7d29 0a20 2020 2020 2020 2029 0a20 2020  }).        ).   
+0001de80: 2020 2020 2023 2043 7265 6174 6520 6120       # Create a 
+0001de90: 656c 656d 656e 7420 746f 2061 7474 6163  element to attac
+0001dea0: 6820 7468 6520 646f 776e 6c6f 6164 2074  h the download t
+0001deb0: 6f0a 2020 2020 2020 2020 6120 3d20 646f  o.        a = do
+0001dec0: 6375 6d65 6e74 2e63 7265 6174 6545 6c65  cument.createEle
+0001ded0: 6d65 6e74 2822 6122 290a 2020 2020 2020  ment("a").      
+0001dee0: 2020 612e 7374 796c 652e 6469 7370 6c61    a.style.displa
+0001def0: 7920 3d20 226e 6f6e 6522 0a20 2020 2020  y = "none".     
+0001df00: 2020 2061 2e73 6574 4174 7472 6962 7574     a.setAttribut
+0001df10: 6528 2264 6f77 6e6c 6f61 6422 2c20 7365  e("download", se
+0001df20: 6c66 2e5f 6765 745f 6578 706f 7274 5f66  lf._get_export_f
+0001df30: 696c 656e 616d 6528 2263 7376 2229 290a  ilename("csv")).
+0001df40: 2020 2020 2020 2020 612e 6872 6566 203d          a.href =
+0001df50: 206f 626a 5f75 726c 0a20 2020 2020 2020   obj_url.       
+0001df60: 2064 6f63 756d 656e 742e 626f 6479 2e61   document.body.a
+0001df70: 7070 656e 6443 6869 6c64 2861 290a 2020  ppendChild(a).  
+0001df80: 2020 2020 2020 2320 5472 6967 6765 7220        # Trigger 
+0001df90: 7468 6520 646f 776e 6c6f 6164 2062 7920  the download by 
+0001dfa0: 7369 6d75 6c61 7469 6e67 2063 6c69 636b  simulating click
+0001dfb0: 0a20 2020 2020 2020 2061 2e63 6c69 636b  .        a.click
+0001dfc0: 2829 0a20 2020 2020 2020 2023 2043 6c65  ().        # Cle
+0001dfd0: 616e 7570 0a20 2020 2020 2020 2077 696e  anup.        win
+0001dfe0: 646f 772e 5552 4c2e 7265 766f 6b65 4f62  dow.URL.revokeOb
+0001dff0: 6a65 6374 5552 4c28 612e 6872 6566 290a  jectURL(a.href).
+0001e000: 2020 2020 2020 2020 646f 6375 6d65 6e74          document
+0001e010: 2e62 6f64 792e 7265 6d6f 7665 4368 696c  .body.removeChil
+0001e020: 6428 6129 0a0a 2020 2020 6465 6620 5f73  d(a)..    def _s
+0001e030: 6176 655f 6173 5f70 6466 2873 656c 6629  ave_as_pdf(self)
+0001e040: 3a0a 2020 2020 2020 2020 2320 436f 6e66  :.        # Conf
+0001e050: 6967 7572 650a 2020 2020 2020 2020 7769  igure.        wi
+0001e060: 6474 682c 2068 6569 6768 7420 3d20 3231  dth, height = 21
+0001e070: 302c 2032 3937 2020 2320 4134 0a20 2020  0, 297  # A4.   
+0001e080: 2020 2020 206d 6172 6769 6e20 3d20 3230       margin = 20
+0001e090: 2020 2320 6d6d 0a20 2020 2020 2020 2073    # mm.        s
+0001e0a0: 686f 7772 6563 6f72 6473 203d 2073 656c  howrecords = sel
+0001e0b0: 662e 5f73 686f 7772 6563 6f72 6473 5f62  f._showrecords_b
+0001e0c0: 7574 2e63 6865 636b 6564 0a20 2020 2020  ut.checked.     
+0001e0d0: 2020 2072 6f77 6865 6967 6874 203d 2036     rowheight = 6
+0001e0e0: 0a20 2020 2020 2020 2072 6f77 6865 6967  .        rowheig
+0001e0f0: 6874 3220 3d20 726f 7768 6569 6768 7420  ht2 = rowheight 
+0001e100: 2f20 320a 2020 2020 2020 2020 726f 7773  / 2.        rows
+0001e110: 6b69 7020 3d20 330a 2020 2020 2020 2020  kip = 3.        
+0001e120: 636f 6c6f 6666 7365 7473 203d 2031 352c  coloffsets = 15,
+0001e130: 2034 2c20 3137 2c20 3130 2c20 3130 0a0a   4, 17, 10, 10..
+0001e140: 2020 2020 2020 2020 2320 4765 7420 726f          # Get ro
+0001e150: 7720 6461 7461 2061 6e64 2064 6976 6964  w data and divid
+0001e160: 6520 696e 2063 6875 6e6b 732e 2054 6869  e in chunks. Thi
+0001e170: 7320 6973 2064 6f6e 6520 736f 2074 6861  s is done so tha
+0001e180: 7420 7765 0a20 2020 2020 2020 2023 2063  t we.        # c
+0001e190: 616e 2062 7265 616b 2070 6167 6573 2065  an break pages e
+0001e1a0: 6172 6c69 6572 2074 6f20 6176 6f69 6420  arlier to avoid 
+0001e1b0: 6272 6561 6b69 6e67 2063 6875 6e6b 732e  breaking chunks.
+0001e1c0: 0a20 2020 2020 2020 2072 6f77 7320 3d20  .        rows = 
+0001e1d0: 7365 6c66 2e5f 6765 6e65 7261 7465 5f74  self._generate_t
+0001e1e0: 6162 6c65 5f72 6f77 7328 7365 6c66 2e5f  able_rows(self._
+0001e1f0: 6c61 7374 5f74 312c 2073 656c 662e 5f6c  last_t1, self._l
+0001e200: 6173 745f 7432 290a 2020 2020 2020 2020  ast_t2).        
+0001e210: 6368 756e 6b73 203d 205b 5b5d 5d0a 2020  chunks = [[]].  
+0001e220: 2020 2020 2020 666f 7220 726f 7720 696e        for row in
+0001e230: 2072 6f77 733a 0a20 2020 2020 2020 2020   rows:.         
+0001e240: 2020 2069 6620 726f 775b 305d 203d 3d20     if row[0] == 
+0001e250: 2262 6c61 6e6b 223a 0a20 2020 2020 2020  "blank":.       
+0001e260: 2020 2020 2020 2020 2063 6875 6e6b 732e           chunks.
+0001e270: 6170 7065 6e64 285b 5d29 0a20 2020 2020  append([]).     
+0001e280: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0001e290: 2020 2020 2020 2020 2020 2020 2063 6875               chu
+0001e2a0: 6e6b 735b 2d31 5d2e 6170 7065 6e64 2872  nks[-1].append(r
+0001e2b0: 6f77 290a 0a20 2020 2020 2020 2023 2049  ow)..        # I
+0001e2c0: 6e69 7469 616c 697a 6520 7468 6520 646f  nitialize the do
+0001e2d0: 6375 6d65 6e74 0a20 2020 2020 2020 2064  cument.        d
+0001e2e0: 6f63 203d 2077 696e 646f 772e 6a73 5044  oc = window.jsPD
+0001e2f0: 4628 290a 2020 2020 2020 2020 646f 632e  F().        doc.
+0001e300: 7365 7446 6f6e 7428 2255 6275 6e74 752d  setFont("Ubuntu-
+0001e310: 4322 290a 0a20 2020 2020 2020 2023 2044  C")..        # D
+0001e320: 7261 7720 7072 6561 6d62 6c65 0a20 2020  raw preamble.   
+0001e330: 2020 2020 2064 6f63 2e73 6574 466f 6e74       doc.setFont
+0001e340: 5369 7a65 2832 3429 0a20 2020 2020 2020  Size(24).       
+0001e350: 2064 6f63 2e74 6578 7428 2254 696d 6520   doc.text("Time 
+0001e360: 7265 636f 7264 2072 6570 6f72 7422 2c20  record report", 
+0001e370: 6d61 7267 696e 2c20 6d61 7267 696e 2c20  margin, margin, 
+0001e380: 7b22 6261 7365 6c69 6e65 223a 2022 746f  {"baseline": "to
+0001e390: 7022 7d29 0a20 2020 2020 2020 2069 6d67  p"}).        img
+0001e3a0: 203d 2064 6f63 756d 656e 742e 6765 7445   = document.getE
+0001e3b0: 6c65 6d65 6e74 4279 4964 2822 7474 6c6f  lementById("ttlo
+0001e3c0: 676f 5f62 6422 290a 2020 2020 2020 2020  go_bd").        
+0001e3d0: 646f 632e 6164 6449 6d61 6765 2869 6d67  doc.addImage(img
+0001e3e0: 2c20 2250 4e47 222c 2077 6964 7468 202d  , "PNG", width -
+0001e3f0: 206d 6172 6769 6e20 2d20 3330 2c20 6d61   margin - 30, ma
+0001e400: 7267 696e 2c20 3330 2c20 3330 290a 2020  rgin, 30, 30).  
+0001e410: 2020 2020 2020 2320 646f 632e 7365 7446        # doc.setF
+0001e420: 6f6e 7453 697a 6528 3132 290a 2020 2020  ontSize(12).    
+0001e430: 2020 2020 2320 646f 632e 7465 7874 280a      # doc.text(.
+0001e440: 2020 2020 2020 2020 2320 2020 2020 2254          #     "T
+0001e450: 696d 6554 6167 6765 7222 2c0a 2020 2020  imeTagger",.    
+0001e460: 2020 2020 2320 2020 2020 7769 6474 6820      #     width 
+0001e470: 2d20 6d61 7267 696e 2c0a 2020 2020 2020  - margin,.      
+0001e480: 2020 2320 2020 2020 6d61 7267 696e 202b    #     margin +
+0001e490: 2032 322c 0a20 2020 2020 2020 2023 2020   22,.        #  
+0001e4a0: 2020 207b 2261 6c69 676e 223a 2022 7269     {"align": "ri
+0001e4b0: 6768 7422 2c20 2262 6173 656c 696e 6522  ght", "baseline"
+0001e4c0: 3a20 2274 6f70 227d 2c0a 2020 2020 2020  : "top"},.      
+0001e4d0: 2020 2320 290a 0a20 2020 2020 2020 2074    # )..        t
+0001e4e0: 6167 6e61 6d65 203d 2073 656c 662e 5f74  agname = self._t
+0001e4f0: 6167 732e 6a6f 696e 2822 2022 2920 6966  ags.join(" ") if
+0001e500: 2073 656c 662e 5f74 6167 7320 656c 7365   self._tags else
+0001e510: 2022 616c 6c22 0a20 2020 2020 2020 2064   "all".        d
+0001e520: 3120 3d20 7265 7665 7273 6564 2873 656c  1 = reversed(sel
+0001e530: 662e 5f74 315f 6461 7465 2e73 706c 6974  f._t1_date.split
+0001e540: 2822 2d22 2929 2e6a 6f69 6e28 222d 2229  ("-")).join("-")
+0001e550: 0a20 2020 2020 2020 2064 3220 3d20 7265  .        d2 = re
+0001e560: 7665 7273 6564 2873 656c 662e 5f74 325f  versed(self._t2_
+0001e570: 6461 7465 2e73 706c 6974 2822 2d22 2929  date.split("-"))
+0001e580: 2e6a 6f69 6e28 222d 2229 0a20 2020 2020  .join("-").     
+0001e590: 2020 2064 6f63 2e73 6574 466f 6e74 5369     doc.setFontSi
+0001e5a0: 7a65 2831 3129 0a20 2020 2020 2020 2064  ze(11).        d
+0001e5b0: 6f63 2e74 6578 7428 2254 6167 733a 2020  oc.text("Tags:  
+0001e5c0: 222c 206d 6172 6769 6e20 2b20 3230 2c20  ", margin + 20, 
+0001e5d0: 6d61 7267 696e 202b 2031 352c 207b 2261  margin + 15, {"a
+0001e5e0: 6c69 676e 223a 2022 7269 6768 7422 7d29  lign": "right"})
+0001e5f0: 0a20 2020 2020 2020 2064 6f63 2e74 6578  .        doc.tex
+0001e600: 7428 7461 676e 616d 652c 206d 6172 6769  t(tagname, margi
+0001e610: 6e20 2b20 3230 2c20 6d61 7267 696e 202b  n + 20, margin +
+0001e620: 2031 3529 0a20 2020 2020 2020 2064 6f63   15).        doc
+0001e630: 2e74 6578 7428 2246 726f 6d3a 2020 222c  .text("From:  ",
+0001e640: 206d 6172 6769 6e20 2b20 3230 2c20 6d61   margin + 20, ma
+0001e650: 7267 696e 202b 2032 302c 207b 2261 6c69  rgin + 20, {"ali
+0001e660: 676e 223a 2022 7269 6768 7422 7d29 0a20  gn": "right"}). 
+0001e670: 2020 2020 2020 2064 6f63 2e74 6578 7428         doc.text(
+0001e680: 6431 2c20 6d61 7267 696e 202b 2032 302c  d1, margin + 20,
+0001e690: 206d 6172 6769 6e20 2b20 3230 290a 2020   margin + 20).  
+0001e6a0: 2020 2020 2020 646f 632e 7465 7874 2822        doc.text("
+0001e6b0: 556e 7469 6c3a 2020 222c 206d 6172 6769  Until:  ", margi
+0001e6c0: 6e20 2b20 3230 2c20 6d61 7267 696e 202b  n + 20, margin +
+0001e6d0: 2032 352c 207b 2261 6c69 676e 223a 2022   25, {"align": "
+0001e6e0: 7269 6768 7422 7d29 0a20 2020 2020 2020  right"}).       
+0001e6f0: 2064 6f63 2e74 6578 7428 6432 2c20 6d61   doc.text(d2, ma
+0001e700: 7267 696e 202b 2032 302c 206d 6172 6769  rgin + 20, margi
+0001e710: 6e20 2b20 3235 290a 0a20 2020 2020 2020  n + 25)..       
+0001e720: 2023 2050 7265 7061 7265 2064 7261 7769   # Prepare drawi
+0001e730: 6e67 2074 6162 6c65 0a20 2020 2020 2020  ng table.       
+0001e740: 2064 6f63 2e73 6574 466f 6e74 5369 7a65   doc.setFontSize
+0001e750: 2831 3029 0a20 2020 2020 2020 206c 6566  (10).        lef
+0001e760: 745f 6d69 6464 6c65 203d 207b 2261 6c69  t_middle = {"ali
+0001e770: 676e 223a 2022 6c65 6674 222c 2022 6261  gn": "left", "ba
+0001e780: 7365 6c69 6e65 223a 2022 6d69 6464 6c65  seline": "middle
+0001e790: 227d 0a20 2020 2020 2020 2072 6967 6874  "}.        right
+0001e7a0: 5f6d 6964 646c 6520 3d20 7b22 616c 6967  _middle = {"alig
+0001e7b0: 6e22 3a20 2272 6967 6874 222c 2022 6261  n": "right", "ba
+0001e7c0: 7365 6c69 6e65 223a 2022 6d69 6464 6c65  seline": "middle
+0001e7d0: 227d 0a20 2020 2020 2020 2079 203d 206d  "}.        y = m
+0001e7e0: 6172 6769 6e20 2b20 3335 0a0a 2020 2020  argin + 35..    
+0001e7f0: 2020 2020 2320 4472 6177 2074 6162 6c65      # Draw table
+0001e800: 0a20 2020 2020 2020 206e 7061 6765 7320  .        npages 
+0001e810: 3d20 310a 2020 2020 2020 2020 666f 7220  = 1.        for 
+0001e820: 6368 756e 6b6e 7220 696e 2072 616e 6765  chunknr in range
+0001e830: 286c 656e 2863 6875 6e6b 7329 293a 0a20  (len(chunks)):. 
+0001e840: 2020 2020 2020 2020 2020 2023 204d 6179             # May
+0001e850: 6265 2069 6e73 6572 7420 6120 7061 6765  be insert a page
+0001e860: 2062 7265 616b 2065 6172 6c79 2074 6f20   break early to 
+0001e870: 7072 6573 6572 7665 2077 686f 6c65 2063  preserve whole c
+0001e880: 6875 6e6b 730a 2020 2020 2020 2020 2020  hunks.          
+0001e890: 2020 7370 6163 655f 7573 6564 203d 2079    space_used = y
+0001e8a0: 202d 206d 6172 6769 6e0a 2020 2020 2020   - margin.      
+0001e8b0: 2020 2020 2020 7370 6163 655f 746f 7461        space_tota
+0001e8c0: 6c20 3d20 6865 6967 6874 202d 2032 202a  l = height - 2 *
+0001e8d0: 206d 6172 6769 6e0a 2020 2020 2020 2020   margin.        
+0001e8e0: 2020 2020 6966 2073 7061 6365 5f75 7365      if space_use
+0001e8f0: 6420 3e20 302e 3920 2a20 7370 6163 655f  d > 0.9 * space_
+0001e900: 746f 7461 6c3a 0a20 2020 2020 2020 2020  total:.         
+0001e910: 2020 2020 2020 2072 6f77 736c 6566 7420         rowsleft 
+0001e920: 3d20 7375 6d28 5b6c 656e 2863 6875 6e6b  = sum([len(chunk
+0001e930: 2920 666f 7220 6368 756e 6b20 696e 2063  ) for chunk in c
+0001e940: 6875 6e6b 735b 6368 756e 6b6e 723a 5d5d  hunks[chunknr:]]
+0001e950: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001e960: 2020 7370 6163 655f 6e65 6564 6564 203d    space_needed =
+0001e970: 2072 6f77 736c 6566 7420 2a20 726f 7768   rowsleft * rowh
+0001e980: 6569 6768 740a 2020 2020 2020 2020 2020  eight.          
+0001e990: 2020 2020 2020 7370 6163 655f 6e65 6564        space_need
+0001e9a0: 6564 202b 3d20 286c 656e 2863 6875 6e6b  ed += (len(chunk
+0001e9b0: 7329 202d 2063 6875 6e6b 6e72 2920 2a20  s) - chunknr) * 
+0001e9c0: 726f 7773 6b69 700a 2020 2020 2020 2020  rowskip.        
+0001e9d0: 2020 2020 2020 2020 6966 2073 7061 6365          if space
+0001e9e0: 5f6e 6565 6465 6420 3e20 7370 6163 655f  _needed > space_
+0001e9f0: 746f 7461 6c20 2d20 7370 6163 655f 7573  total - space_us
+0001ea00: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
+0001ea10: 2020 2020 2020 2020 646f 632e 6164 6450          doc.addP
+0001ea20: 6167 6528 290a 2020 2020 2020 2020 2020  age().          
+0001ea30: 2020 2020 2020 2020 2020 6e70 6167 6573            npages
+0001ea40: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+0001ea50: 2020 2020 2020 2020 2020 7920 3d20 6d61            y = ma
+0001ea60: 7267 696e 0a0a 2020 2020 2020 2020 2020  rgin..          
+0001ea70: 2020 666f 7220 726f 776e 722c 2072 6f77    for rownr, row
+0001ea80: 2069 6e20 656e 756d 6572 6174 6528 6368   in enumerate(ch
+0001ea90: 756e 6b73 5b63 6875 6e6b 6e72 5d29 3a0a  unks[chunknr]):.
+0001eaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eab0: 2320 4164 6420 7061 6765 2062 7265 616b  # Add page break
+0001eac0: 3f0a 2020 2020 2020 2020 2020 2020 2020  ?.              
+0001ead0: 2020 6966 2028 7920 2b20 726f 7768 6569    if (y + rowhei
+0001eae0: 6768 7429 203e 2028 6865 6967 6874 202d  ght) > (height -
+0001eaf0: 206d 6172 6769 6e29 3a0a 2020 2020 2020   margin):.      
+0001eb00: 2020 2020 2020 2020 2020 2020 2020 646f                do
+0001eb10: 632e 6164 6450 6167 6528 290a 2020 2020  c.addPage().    
+0001eb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eb30: 6e70 6167 6573 202b 3d20 310a 2020 2020  npages += 1.    
+0001eb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eb50: 7920 3d20 6d61 7267 696e 0a0a 2020 2020  y = margin..    
+0001eb60: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+0001eb70: 6f77 5b30 5d20 3d3d 2022 6865 6164 223a  ow[0] == "head":
+0001eb80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001eb90: 2020 2020 2069 6620 7368 6f77 7265 636f       if showreco
+0001eba0: 7264 733a 0a20 2020 2020 2020 2020 2020  rds:.           
+0001ebb0: 2020 2020 2020 2020 2020 2020 2064 6f63               doc
+0001ebc0: 2e73 6574 4669 6c6c 436f 6c6f 7228 2223  .setFillColor("#
+0001ebd0: 6363 6322 290a 2020 2020 2020 2020 2020  ccc").          
+0001ebe0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0001ebf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ec00: 2020 2020 2020 2020 646f 632e 7365 7446          doc.setF
+0001ec10: 696c 6c43 6f6c 6f72 2822 2366 3366 3366  illColor("#f3f3f
+0001ec20: 3322 2069 6620 726f 776e 7220 2520 3220  3" if rownr % 2 
+0001ec30: 656c 7365 2022 2365 6165 6165 6122 290a  else "#eaeaea").
+0001ec40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ec50: 2020 2020 646f 632e 7265 6374 286d 6172      doc.rect(mar
+0001ec60: 6769 6e2c 2079 2c20 7769 6474 6820 2d20  gin, y, width - 
+0001ec70: 3220 2a20 6d61 7267 696e 2c20 726f 7768  2 * margin, rowh
+0001ec80: 6569 6768 742c 2022 4622 290a 2020 2020  eight, "F").    
+0001ec90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eca0: 2320 4475 7261 7469 6f6e 0a20 2020 2020  # Duration.     
+0001ecb0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0001ecc0: 6f63 2e73 6574 5465 7874 436f 6c6f 7228  oc.setTextColor(
+0001ecd0: 2223 3030 3022 290a 2020 2020 2020 2020  "#000").        
+0001ece0: 2020 2020 2020 2020 2020 2020 7820 3d20              x = 
+0001ecf0: 6d61 7267 696e 202b 2063 6f6c 6f66 6673  margin + coloffs
+0001ed00: 6574 735b 305d 0a20 2020 2020 2020 2020  ets[0].         
+0001ed10: 2020 2020 2020 2020 2020 2064 6f63 2e74             doc.t
+0001ed20: 6578 7428 726f 775b 315d 2c20 782c 2079  ext(row[1], x, y
+0001ed30: 202b 2072 6f77 6865 6967 6874 322c 2072   + rowheight2, r
+0001ed40: 6967 6874 5f6d 6964 646c 6529 2020 2320  ight_middle)  # 
+0001ed50: 6475 7261 7469 6f6e 0a20 2020 2020 2020  duration.       
+0001ed60: 2020 2020 2020 2020 2020 2020 2023 2054               # T
+0001ed70: 6167 206e 616d 6573 2c20 6164 6420 7374  ag names, add st
+0001ed80: 7275 6374 7572 6520 7669 6120 636f 6c6f  ructure via colo
+0001ed90: 722c 206e 6f20 7061 6464 696e 670a 2020  r, no padding.  
+0001eda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001edb0: 2020 6261 7365 6e61 6d65 2c20 6c61 7374    basename, last
+0001edc0: 6e61 6d65 203d 2022 222c 2072 6f77 5b32  name = "", row[2
+0001edd0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0001ede0: 2020 2020 2020 646f 632e 7365 7454 6578        doc.setTex
+0001edf0: 7443 6f6c 6f72 2822 2335 3535 2229 0a20  tColor("#555"). 
+0001ee00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ee10: 2020 2078 202b 3d20 636f 6c6f 6666 7365     x += coloffse
+0001ee20: 7473 5b31 5d0a 2020 2020 2020 2020 2020  ts[1].          
+0001ee30: 2020 2020 2020 2020 2020 646f 632e 7465            doc.te
+0001ee40: 7874 2862 6173 656e 616d 652c 2078 2c20  xt(basename, x, 
+0001ee50: 7920 2b20 726f 7768 6569 6768 7432 2c20  y + rowheight2, 
+0001ee60: 6c65 6674 5f6d 6964 646c 6529 0a20 2020  left_middle).   
+0001ee70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ee80: 2064 6f63 2e73 6574 5465 7874 436f 6c6f   doc.setTextColo
+0001ee90: 7228 2223 3030 3022 290a 2020 2020 2020  r("#000").      
+0001eea0: 2020 2020 2020 2020 2020 2020 2020 7820                x 
+0001eeb0: 2b3d 2064 6f63 2e67 6574 5465 7874 5769  += doc.getTextWi
+0001eec0: 6474 6828 6261 7365 6e61 6d65 290a 2020  dth(basename).  
+0001eed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eee0: 2020 646f 632e 7465 7874 286c 6173 746e    doc.text(lastn
+0001eef0: 616d 652c 2078 2c20 7920 2b20 726f 7768  ame, x, y + rowh
+0001ef00: 6569 6768 7432 2c20 6c65 6674 5f6d 6964  eight2, left_mid
+0001ef10: 646c 6529 0a0a 2020 2020 2020 2020 2020  dle)..          
+0001ef20: 2020 2020 2020 656c 6966 2072 6f77 5b30        elif row[0
+0001ef30: 5d20 3d3d 2022 7265 636f 7264 223a 0a20  ] == "record":. 
+0001ef40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ef50: 2020 2064 6f63 2e73 6574 4669 6c6c 436f     doc.setFillCo
+0001ef60: 6c6f 7228 2223 6633 6633 6633 2220 6966  lor("#f3f3f3" if
+0001ef70: 2072 6f77 6e72 2025 2032 2065 6c73 6520   rownr % 2 else 
+0001ef80: 2223 6561 6561 6561 2229 0a20 2020 2020  "#eaeaea").     
+0001ef90: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0001efa0: 6f63 2e72 6563 7428 6d61 7267 696e 2c20  oc.rect(margin, 
+0001efb0: 792c 2077 6964 7468 202d 2032 202a 206d  y, width - 2 * m
+0001efc0: 6172 6769 6e2c 2072 6f77 6865 6967 6874  argin, rowheight
+0001efd0: 2c20 2246 2229 0a20 2020 2020 2020 2020  , "F").         
+0001efe0: 2020 2020 2020 2020 2020 2064 6f63 2e73             doc.s
+0001eff0: 6574 5465 7874 436f 6c6f 7228 2223 3030  etTextColor("#00
+0001f000: 3022 290a 2020 2020 2020 2020 2020 2020  0").            
+0001f010: 2020 2020 2020 2020 2320 5f2c 206b 6579          # _, key
+0001f020: 2c20 6475 7261 7469 6f6e 2c20 7364 312c  , duration, sd1,
+0001f030: 2073 7431 2c20 7374 322c 2064 732c 2074   st1, st2, ds, t
+0001f040: 6167 7a20 3d20 726f 770a 2020 2020 2020  agz = row.      
+0001f050: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0001f060: 5468 6520 6475 7261 7469 6f6e 2069 7320  The duration is 
+0001f070: 7269 6768 742d 616c 6967 6e65 640a 2020  right-aligned.  
+0001f080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f090: 2020 7820 3d20 6d61 7267 696e 202b 2063    x = margin + c
+0001f0a0: 6f6c 6f66 6673 6574 735b 305d 0a20 2020  oloffsets[0].   
+0001f0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f0c0: 2064 6f63 2e74 6578 7428 726f 775b 325d   doc.text(row[2]
+0001f0d0: 2c20 782c 2079 202b 2072 6f77 6865 6967  , x, y + rowheig
+0001f0e0: 6874 322c 2072 6967 6874 5f6d 6964 646c  ht2, right_middl
+0001f0f0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+0001f100: 2020 2020 2020 2023 2054 6865 2072 6573         # The res
+0001f110: 7420 2873 6431 2c20 7374 312c 2073 7432  t (sd1, st1, st2
+0001f120: 2920 6973 206c 6566 742d 616c 6967 6e65  ) is left-aligne
+0001f130: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
+0001f140: 2020 2020 2020 666f 7220 6920 696e 2028        for i in (
+0001f150: 312c 2032 2c20 3329 3a0a 2020 2020 2020  1, 2, 3):.      
+0001f160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f170: 2020 7820 2b3d 2063 6f6c 6f66 6673 6574    x += coloffset
+0001f180: 735b 695d 0a20 2020 2020 2020 2020 2020  s[i].           
+0001f190: 2020 2020 2020 2020 2020 2020 2073 203d               s =
+0001f1a0: 2072 6f77 5b69 202b 2032 5d0a 2020 2020   row[i + 2].    
+0001f1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f1c0: 2020 2020 6966 2069 203d 3d20 333a 2020      if i == 3:  
+0001f1d0: 2320 7374 320a 2020 2020 2020 2020 2020  # st2.          
+0001f1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f1f0: 2020 646f 632e 7465 7874 2822 2d22 2c20    doc.text("-", 
+0001f200: 7820 2d20 312c 2079 202b 2072 6f77 6865  x - 1, y + rowhe
+0001f210: 6967 6874 322c 2072 6967 6874 5f6d 6964  ight2, right_mid
+0001f220: 646c 6529 0a20 2020 2020 2020 2020 2020  dle).           
+0001f230: 2020 2020 2020 2020 2020 2020 2064 6f63               doc
+0001f240: 2e74 6578 7428 732c 2078 2c20 7920 2b20  .text(s, x, y + 
+0001f250: 726f 7768 6569 6768 7432 2c20 6c65 6674  rowheight2, left
+0001f260: 5f6d 6964 646c 6529 0a20 2020 2020 2020  _middle).       
+0001f270: 2020 2020 2020 2020 2020 2020 2023 2054               # T
+0001f280: 6865 2064 6573 6372 6970 7469 6f6e 206d  he description m
+0001f290: 6179 2062 6520 736f 206c 6f6e 6720 7765  ay be so long we
+0001f2a0: 206e 6565 6420 746f 2073 706c 6974 2069   need to split i
+0001f2b0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+0001f2c0: 2020 2020 2020 7820 2b3d 2063 6f6c 6f66        x += colof
+0001f2d0: 6673 6574 735b 345d 0a20 2020 2020 2020  fsets[4].       
+0001f2e0: 2020 2020 2020 2020 2020 2020 206d 696e               min
+0001f2f0: 5f78 203d 2078 0a20 2020 2020 2020 2020  _x = x.         
+0001f300: 2020 2020 2020 2020 2020 206d 6178 5f78             max_x
+0001f310: 203d 2077 6964 7468 202d 206d 6172 6769   = width - margi
+0001f320: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+0001f330: 2020 2020 2020 6473 203d 2072 6f77 5b36        ds = row[6
+0001f340: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0001f350: 2020 2020 2020 6966 2078 202b 2064 6f63        if x + doc
+0001f360: 2e67 6574 5465 7874 5769 6474 6828 6473  .getTextWidth(ds
+0001f370: 2920 3c3d 206d 6178 5f78 3a0a 2020 2020  ) <= max_x:.    
+0001f380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f390: 2020 2020 646f 632e 7465 7874 2864 732c      doc.text(ds,
+0001f3a0: 2078 2c20 7920 2b20 726f 7768 6569 6768   x, y + rowheigh
+0001f3b0: 7432 2c20 6c65 6674 5f6d 6964 646c 6529  t2, left_middle)
+0001f3c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f3d0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0001f3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f3f0: 2020 2077 5f73 7061 6365 203d 2064 6f63     w_space = doc
+0001f400: 2e67 6574 5465 7874 5769 6474 6828 2220  .getTextWidth(" 
+0001f410: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0001f420: 2020 2020 2020 2020 2020 2066 6f72 2077             for w
+0001f430: 6f72 6420 696e 2064 732e 7370 6c69 7428  ord in ds.split(
+0001f440: 2220 2229 3a0a 2020 2020 2020 2020 2020  " "):.          
+0001f450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f460: 2020 7720 3d20 646f 632e 6765 7454 6578    w = doc.getTex
+0001f470: 7457 6964 7468 2877 6f72 6429 0a20 2020  tWidth(word).   
+0001f480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f490: 2020 2020 2020 2020 2069 6620 7820 2b20           if x + 
+0001f4a0: 7720 3e20 6d61 785f 783a 2020 2320 6e65  w > max_x:  # ne
+0001f4b0: 6564 206e 6577 206c 696e 650a 2020 2020  ed new line.    
+0001f4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f4d0: 2020 2020 2020 2020 2020 2020 7820 3d20              x = 
+0001f4e0: 6d69 6e5f 780a 2020 2020 2020 2020 2020  min_x.          
+0001f4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f500: 2020 2020 2020 7920 2b3d 2072 6f77 6865        y += rowhe
+0001f510: 6967 6874 0a20 2020 2020 2020 2020 2020  ight.           
+0001f520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f530: 2020 2020 2064 6f63 2e73 6574 4669 6c6c       doc.setFill
+0001f540: 436f 6c6f 7228 2223 6633 6633 6633 2220  Color("#f3f3f3" 
+0001f550: 6966 2072 6f77 6e72 2025 2032 2065 6c73  if rownr % 2 els
+0001f560: 6520 2223 6561 6561 6561 2229 0a20 2020  e "#eaeaea").   
+0001f570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f580: 2020 2020 2020 2020 2020 2020 2064 6f63               doc
+0001f590: 2e72 6563 7428 6d61 7267 696e 2c20 792c  .rect(margin, y,
+0001f5a0: 2077 6964 7468 202d 2032 202a 206d 6172   width - 2 * mar
+0001f5b0: 6769 6e2c 2072 6f77 6865 6967 6874 2c20  gin, rowheight, 
+0001f5c0: 2246 2229 0a20 2020 2020 2020 2020 2020  "F").           
+0001f5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f5e0: 2020 2020 2064 6f63 2e73 6574 5465 7874       doc.setText
+0001f5f0: 436f 6c6f 7228 2223 3030 3022 290a 2020  Color("#000").  
+0001f600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f610: 2020 2020 2020 2020 2020 646f 632e 7465            doc.te
+0001f620: 7874 2877 6f72 642c 2078 2c20 7920 2b20  xt(word, x, y + 
+0001f630: 726f 7768 6569 6768 7432 2c20 6c65 6674  rowheight2, left
+0001f640: 5f6d 6964 646c 6529 0a20 2020 2020 2020  _middle).       
+0001f650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f660: 2020 2020 2078 202b 3d20 7720 2b20 775f       x += w + w_
+0001f670: 7370 6163 650a 2020 2020 2020 2020 2020  space.          
+0001f680: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0001f690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f6a0: 646f 632e 7365 7446 696c 6c43 6f6c 6f72  doc.setFillColor
+0001f6b0: 2822 2366 6665 6565 6522 290a 2020 2020  ("#ffeeee").    
+0001f6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f6d0: 646f 632e 7265 6374 286d 6172 6769 6e2c  doc.rect(margin,
+0001f6e0: 2079 2c20 7769 6474 6820 2d20 3220 2a20   y, width - 2 * 
+0001f6f0: 6d61 7267 696e 2c20 726f 7768 6569 6768  margin, rowheigh
+0001f700: 742c 2022 4622 290a 0a20 2020 2020 2020  t, "F")..       
+0001f710: 2020 2020 2020 2020 2079 202b 3d20 726f           y += ro
+0001f720: 7768 6569 6768 740a 2020 2020 2020 2020  wheight.        
+0001f730: 2020 2020 7920 2b3d 2072 6f77 736b 6970      y += rowskip
+0001f740: 0a0a 2020 2020 2020 2020 2320 4164 6420  ..        # Add 
+0001f750: 7061 6769 6e61 7469 6f6e 0a20 2020 2020  pagination.     
+0001f760: 2020 2064 6f63 2e73 6574 466f 6e74 5369     doc.setFontSi
+0001f770: 7a65 2838 290a 2020 2020 2020 2020 646f  ze(8).        do
+0001f780: 632e 7365 7454 6578 7443 6f6c 6f72 2822  c.setTextColor("
+0001f790: 2335 3535 2229 0a20 2020 2020 2020 2066  #555").        f
+0001f7a0: 6f72 2069 2069 6e20 7261 6e67 6528 6e70  or i in range(np
+0001f7b0: 6167 6573 293a 0a20 2020 2020 2020 2020  ages):.         
+0001f7c0: 2020 2070 6167 656e 7220 3d20 6920 2b20     pagenr = i + 
+0001f7d0: 310a 2020 2020 2020 2020 2020 2020 646f  1.            do
+0001f7e0: 632e 7365 7450 6167 6528 7061 6765 6e72  c.setPage(pagenr
+0001f7f0: 290a 2020 2020 2020 2020 2020 2020 782c  ).            x,
+0001f800: 2079 203d 2077 6964 7468 202d 2030 2e35   y = width - 0.5
+0001f810: 202a 206d 6172 6769 6e2c 2030 2e35 202a   * margin, 0.5 *
+0001f820: 206d 6172 6769 6e0a 2020 2020 2020 2020   margin.        
+0001f830: 2020 2020 646f 632e 7465 7874 2866 227b      doc.text(f"{
+0001f840: 7061 6765 6e72 7d2f 7b6e 7061 6765 737d  pagenr}/{npages}
+0001f850: 222c 2078 2c20 792c 207b 2261 6c69 676e  ", x, y, {"align
+0001f860: 223a 2022 7269 6768 7422 2c20 2262 6173  ": "right", "bas
+0001f870: 656c 696e 6522 3a20 2274 6f70 227d 290a  eline": "top"}).
+0001f880: 0a20 2020 2020 2020 2064 6f63 2e73 6176  .        doc.sav
+0001f890: 6528 7365 6c66 2e5f 6765 745f 6578 706f  e(self._get_expo
+0001f8a0: 7274 5f66 696c 656e 616d 6528 2270 6466  rt_filename("pdf
+0001f8b0: 2229 290a 2020 2020 2020 2020 2320 646f  ")).        # do
+0001f8c0: 632e 6f75 7470 7574 2827 6461 7461 7572  c.output('dataur
+0001f8d0: 6c6e 6577 7769 6e64 6f77 2729 2020 2320  lnewwindow')  # 
+0001f8e0: 6861 6e64 7920 6475 7269 6e67 2064 6576  handy during dev
+0001f8f0: 0a0a 0a63 6c61 7373 2045 7870 6f72 7444  ...class ExportD
+0001f900: 6961 6c6f 6728 4261 7365 4469 616c 6f67  ialog(BaseDialog
+0001f910: 293a 0a20 2020 2022 2222 4469 616c 6f67  ):.    """Dialog
+0001f920: 2074 6f20 6578 706f 7274 2064 6174 612e   to export data.
+0001f930: 2222 220a 0a20 2020 2064 6566 205f 5f69  """..    def __i
+0001f940: 6e69 745f 5f28 7365 6c66 2c20 6361 6e76  nit__(self, canv
+0001f950: 6173 293a 0a20 2020 2020 2020 2073 7570  as):.        sup
+0001f960: 6572 2829 2e5f 5f69 6e69 745f 5f28 6361  er().__init__(ca
+0001f970: 6e76 6173 290a 2020 2020 2020 2020 7365  nvas).        se
+0001f980: 6c66 2e5f 6474 666f 726d 6174 203d 2022  lf._dtformat = "
+0001f990: 6c6f 6361 6c22 0a20 2020 2020 2020 2073  local".        s
+0001f9a0: 656c 662e 5f77 6f72 6b69 6e67 203d 2030  elf._working = 0
+0001f9b0: 0a0a 2020 2020 6465 6620 6f70 656e 2873  ..    def open(s
+0001f9c0: 656c 662c 2063 616c 6c62 6163 6b3d 4e6f  elf, callback=No
+0001f9d0: 6e65 293a 0a20 2020 2020 2020 2073 656c  ne):.        sel
+0001f9e0: 662e 6d61 696e 6469 762e 696e 6e65 7248  f.maindiv.innerH
+0001f9f0: 544d 4c20 3d20 6622 2222 0a20 2020 2020  TML = f""".     
+0001fa00: 2020 2020 2020 203c 6831 3e3c 6920 636c         <h1><i cl
+0001fa10: 6173 733d 2766 6173 273e 5c75 6635 3665  ass='fas'>\uf56e
+0001fa20: 3c2f 693e 266e 6273 703b 266e 6273 703b  </i>&nbsp;&nbsp;
+0001fa30: 4578 706f 7274 0a20 2020 2020 2020 2020  Export.         
+0001fa40: 2020 2020 2020 203c 6275 7474 6f6e 2074         <button t
+0001fa50: 7970 653d 2762 7574 746f 6e27 3e3c 6920  ype='button'><i 
+0001fa60: 636c 6173 733d 2766 6173 273e 5c75 6630  class='fas'>\uf0
+0001fa70: 3064 3c2f 693e 3c2f 6275 7474 6f6e 3e0a  0d</i></button>.
+0001fa80: 2020 2020 2020 2020 2020 2020 3c2f 6831              </h1
+0001fa90: 3e0a 2020 2020 2020 2020 2020 2020 3c70  >.            <p
+0001faa0: 3e0a 2020 2020 2020 2020 2020 2020 5468  >.            Th
+0001fab0: 6520 7461 626c 6520 6265 6c6f 7720 636f  e table below co
+0001fac0: 6e74 6169 6e73 2061 6c6c 2079 6f75 7220  ntains all your 
+0001fad0: 7265 636f 7264 732e 2054 6869 7320 6361  records. This ca
+0001fae0: 6e20 6265 0a20 2020 2020 2020 2020 2020  n be.           
+0001faf0: 2075 7365 6675 6c20 666f 7220 6261 636b   useful for back
+0001fb00: 7570 732c 2070 726f 6365 7373 696e 672c  ups, processing,
+0001fb10: 206f 7220 746f 206d 6f76 6520 796f 7572   or to move your
+0001fb20: 2064 6174 610a 2020 2020 2020 2020 2020   data.          
+0001fb30: 2020 656c 7365 7768 6572 652e 0a20 2020    elsewhere..   
+0001fb40: 2020 2020 2020 2020 203c 2f70 3e3c 703e           </p><p>
+0001fb50: 266e 6273 703b 3c2f 703e 0a20 2020 2020  &nbsp;</p>.     
+0001fb60: 2020 2020 2020 203c 6469 763e 0a20 2020         <div>.   
+0001fb70: 2020 2020 2020 2020 2020 2020 203c 7370               <sp
+0001fb80: 616e 3e44 6174 652d 7469 6d65 2066 6f72  an>Date-time for
+0001fb90: 6d61 743a 3c2f 7370 616e 3e0a 2020 2020  mat:</span>.    
+0001fba0: 2020 2020 2020 2020 2020 2020 266e 6273              &nbs
+0001fbb0: 703b 3c69 6e70 7574 2074 7970 653d 2272  p;<input type="r
+0001fbc0: 6164 696f 2220 6e61 6d65 3d22 6474 666f  adio" name="dtfo
+0001fbd0: 726d 6174 2220 7661 6c75 653d 226c 6f63  rmat" value="loc
+0001fbe0: 616c 2220 6368 6563 6b65 643e 204c 6f63  al" checked> Loc
+0001fbf0: 616c 3c2f 696e 7075 743e 0a20 2020 2020  al</input>.     
+0001fc00: 2020 2020 2020 2020 2020 2026 6e62 7370             &nbsp
+0001fc10: 3b3c 696e 7075 7420 7479 7065 3d22 7261  ;<input type="ra
+0001fc20: 6469 6f22 206e 616d 653d 2264 7466 6f72  dio" name="dtfor
+0001fc30: 6d61 7422 2076 616c 7565 3d22 756e 6978  mat" value="unix
+0001fc40: 223e 2055 6e69 783c 2f69 6e70 7574 3e0a  "> Unix</input>.
+0001fc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fc60: 266e 6273 703b 3c69 6e70 7574 2074 7970  &nbsp;<input typ
+0001fc70: 653d 2272 6164 696f 2220 6e61 6d65 3d22  e="radio" name="
+0001fc80: 6474 666f 726d 6174 2220 7661 6c75 653d  dtformat" value=
+0001fc90: 2269 736f 223e 2049 534f 2038 3630 313c  "iso"> ISO 8601<
+0001fca0: 2f69 6e70 7574 3e0a 2020 2020 2020 2020  /input>.        
+0001fcb0: 2020 2020 3c2f 6469 763e 0a20 2020 2020      </div>.     
+0001fcc0: 2020 2020 2020 203c 6275 7474 6f6e 2074         <button t
+0001fcd0: 7970 653d 2762 7574 746f 6e27 3e43 6f70  ype='button'>Cop
+0001fce0: 793c 2f62 7574 746f 6e3e 0a20 2020 2020  y</button>.     
+0001fcf0: 2020 2020 2020 203c 6872 202f 3e0a 2020         <hr />.  
+0001fd00: 2020 2020 2020 2020 2020 3c74 6162 6c65            <table
+0001fd10: 2069 643d 2765 7870 6f72 745f 7461 626c   id='export_tabl
+0001fd20: 6527 3e3c 2f74 6162 6c65 3e0a 2020 2020  e'></table>.    
+0001fd30: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+0001fd40: 2020 2020 2073 656c 662e 5f74 6162 6c65       self._table
+0001fd50: 5f65 6c65 6d65 6e74 203d 2073 656c 662e  _element = self.
+0001fd60: 6d61 696e 6469 762e 6368 696c 6472 656e  maindiv.children
+0001fd70: 5b2d 315d 0a20 2020 2020 2020 2073 656c  [-1].        sel
+0001fd80: 662e 5f74 6162 6c65 5f65 6c65 6d65 6e74  f._table_element
+0001fd90: 2e63 6c61 7373 4c69 7374 2e61 6464 2822  .classList.add("
+0001fda0: 6461 726b 6865 6164 6572 7322 290a 0a20  darkheaders").. 
+0001fdb0: 2020 2020 2020 2073 656c 662e 5f63 6f70         self._cop
+0001fdc0: 795f 6275 7420 3d20 7365 6c66 2e6d 6169  y_but = self.mai
+0001fdd0: 6e64 6976 2e63 6869 6c64 7265 6e5b 2d33  ndiv.children[-3
+0001fde0: 5d0a 2020 2020 2020 2020 7365 6c66 2e5f  ].        self._
+0001fdf0: 636f 7079 5f62 7574 2e6f 6e63 6c69 636b  copy_but.onclick
+0001fe00: 203d 2073 656c 662e 5f63 6f70 795f 636c   = self._copy_cl
+0001fe10: 6970 626f 6172 640a 2020 2020 2020 2020  ipboard.        
+0001fe20: 7365 6c66 2e5f 636f 7079 5f62 7574 2e64  self._copy_but.d
+0001fe30: 6973 6162 6c65 6420 3d20 5472 7565 0a0a  isabled = True..
+0001fe40: 2020 2020 2020 2020 7261 6469 6f5f 6275          radio_bu
+0001fe50: 7474 6f6e 7320 3d20 7365 6c66 2e6d 6169  ttons = self.mai
+0001fe60: 6e64 6976 2e63 6869 6c64 7265 6e5b 2d34  ndiv.children[-4
+0001fe70: 5d2e 6368 696c 6472 656e 0a20 2020 2020  ].children.     
+0001fe80: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+0001fe90: 6528 312c 206c 656e 2872 6164 696f 5f62  e(1, len(radio_b
+0001fea0: 7574 746f 6e73 2929 3a0a 2020 2020 2020  uttons)):.      
+0001feb0: 2020 2020 2020 6275 7420 3d20 7261 6469        but = radi
+0001fec0: 6f5f 6275 7474 6f6e 735b 695d 0a20 2020  o_buttons[i].   
+0001fed0: 2020 2020 2020 2020 2062 7574 2e6f 6e63           but.onc
+0001fee0: 6861 6e67 6520 3d20 7365 6c66 2e5f 6f6e  hange = self._on
+0001fef0: 5f64 7466 6f72 6d61 740a 0a20 2020 2020  _dtformat..     
+0001ff00: 2020 2073 656c 662e 5f63 616e 6365 6c5f     self._cancel_
+0001ff10: 6275 7420 3d20 7365 6c66 2e6d 6169 6e64  but = self.maind
+0001ff20: 6976 2e63 6869 6c64 7265 6e5b 305d 2e63  iv.children[0].c
+0001ff30: 6869 6c64 7265 6e5b 2d31 5d0a 2020 2020  hildren[-1].    
+0001ff40: 2020 2020 7365 6c66 2e5f 6361 6e63 656c      self._cancel
+0001ff50: 5f62 7574 2e6f 6e63 6c69 636b 203d 2073  _but.onclick = s
+0001ff60: 656c 662e 636c 6f73 650a 2020 2020 2020  elf.close.      
+0001ff70: 2020 7375 7065 7228 292e 6f70 656e 2863    super().open(c
+0001ff80: 616c 6c62 6163 6b29 0a0a 2020 2020 2020  allback)..      
+0001ff90: 2020 7365 6c66 2e66 696c 6c5f 7265 636f    self.fill_reco
+0001ffa0: 7264 7328 290a 0a20 2020 2064 6566 205f  rds()..    def _
+0001ffb0: 6f6e 5f64 7466 6f72 6d61 7428 7365 6c66  on_dtformat(self
+0001ffc0: 2c20 6529 3a0a 2020 2020 2020 2020 7365  , e):.        se
+0001ffd0: 6c66 2e5f 6474 666f 726d 6174 203d 2065  lf._dtformat = e
+0001ffe0: 2e74 6172 6765 742e 7661 6c75 650a 2020  .target.value.  
+0001fff0: 2020 2020 2020 7365 6c66 2e66 696c 6c5f        self.fill_
+00020000: 7265 636f 7264 7328 290a 0a20 2020 2061  records()..    a
+00020010: 7379 6e63 2064 6566 2066 696c 6c5f 7265  sync def fill_re
+00020020: 636f 7264 7328 7365 6c66 293a 0a20 2020  cords(self):.   
+00020030: 2020 2020 2073 656c 662e 5f77 6f72 6b69       self._worki
+00020040: 6e67 202b 3d20 310a 2020 2020 2020 2020  ng += 1.        
+00020050: 776f 726b 696e 6720 3d20 7365 6c66 2e5f  working = self._
+00020060: 776f 726b 696e 670a 2020 2020 2020 2020  working.        
+00020070: 6177 6169 7420 7769 6e64 6f77 2e74 6f6f  await window.too
+00020080: 6c73 2e73 6c65 6570 6d73 2831 3030 290a  ls.sleepms(100).
+00020090: 0a20 2020 2020 2020 2023 2050 7265 7061  .        # Prepa
+000200a0: 7265 0a20 2020 2020 2020 2073 656c 662e  re.        self.
+000200b0: 5f63 6f70 795f 6275 742e 6469 7361 626c  _copy_but.disabl
+000200c0: 6564 203d 2054 7275 650a 2020 2020 2020  ed = True.      
+000200d0: 2020 6974 656d 7364 6963 7420 3d20 7769    itemsdict = wi
+000200e0: 6e64 6f77 2e73 746f 7265 2e72 6563 6f72  ndow.store.recor
+000200f0: 6473 2e5f 6974 656d 730a 2020 2020 2020  ds._items.      
+00020100: 2020 6c69 6e65 7320 3d20 5b5d 0a0a 2020    lines = []..  
+00020110: 2020 2020 2020 2320 4164 6420 6865 6164        # Add head
+00020120: 6572 0a20 2020 2020 2020 206c 696e 6570  er.        linep
+00020130: 6172 7473 203d 205b 226b 6579 222c 2022  arts = ["key", "
+00020140: 7374 6172 7422 2c20 2273 746f 7022 2c20  start", "stop", 
+00020150: 2274 6167 7322 2c20 2264 6573 6372 6970  "tags", "descrip
+00020160: 7469 6f6e 225d 0a20 2020 2020 2020 206c  tion"].        l
+00020170: 696e 6573 2e61 7070 656e 6428 223c 7472  ines.append("<tr
+00020180: 3e3c 7468 3e22 202b 206c 696e 6570 6172  ><th>" + linepar
+00020190: 7473 2e6a 6f69 6e28 223c 2f74 683e 3c74  ts.join("</th><t
+000201a0: 683e 2229 202b 2022 3c2f 7468 3e3c 2f74  h>") + "</th></t
+000201b0: 723e 2229 0a0a 2020 2020 2020 2020 2320  r>")..        # 
+000201c0: 5061 7273 6520 616c 6c20 6974 656d 730a  Parse all items.
+000201d0: 2020 2020 2020 2020 2320 5461 6b65 2063          # Take c
+000201e0: 6172 6520 7468 6174 2064 6573 6372 6970  are that descrip
+000201f0: 7469 6f6e 2064 6f65 7320 6e6f 7420 6861  tion does not ha
+00020200: 7665 206e 6577 6c69 6e65 7320 6f72 2074  ve newlines or t
+00020210: 6162 732c 2075 7369 6e67 2074 6f5f 7374  abs, using to_st
+00020220: 720a 2020 2020 2020 2020 2320 5769 7468  r.        # With
+00020230: 2074 6162 2d73 6570 6172 6174 6564 2076   tab-separated v
+00020240: 616c 7565 7320 6974 2069 7320 6e6f 7420  alues it is not 
+00020250: 636f 6d6d 6f6e 2074 6f20 7375 7272 6f75  common to surrou
+00020260: 6e64 2076 616c 7565 7320 696e 2071 756f  nd values in quo
+00020270: 7465 732e 0a20 2020 2020 2020 2066 6f72  tes..        for
+00020280: 206b 6579 2069 6e20 6974 656d 7364 6963   key in itemsdic
+00020290: 742e 6b65 7973 2829 3a0a 2020 2020 2020  t.keys():.      
+000202a0: 2020 2020 2020 6974 656d 203d 2069 7465        item = ite
+000202b0: 6d73 6469 6374 5b6b 6579 5d0a 2020 2020  msdict[key].    
+000202c0: 2020 2020 2020 2020 6966 206e 6f74 2077          if not w
+000202d0: 696e 646f 772e 7374 6f72 6573 2e69 735f  indow.stores.is_
+000202e0: 6869 6464 656e 2869 7465 6d29 3a0a 2020  hidden(item):.  
+000202f0: 2020 2020 2020 2020 2020 2020 2020 7431                t1
+00020300: 2c20 7432 203d 2069 7465 6d2e 7431 2c20  , t2 = item.t1, 
+00020310: 6974 656d 2e74 320a 2020 2020 2020 2020  item.t2.        
+00020320: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00020330: 5f64 7466 6f72 6d61 7420 3d3d 2022 6c6f  _dtformat == "lo
+00020340: 6361 6c22 3a0a 2020 2020 2020 2020 2020  cal":.          
+00020350: 2020 2020 2020 2020 2020 7431 2c20 7432            t1, t2
+00020360: 203d 2064 742e 7469 6d65 326c 6f63 616c   = dt.time2local
+00020370: 7374 7228 7431 292c 2064 742e 7469 6d65  str(t1), dt.time
+00020380: 326c 6f63 616c 7374 7228 7432 290a 2020  2localstr(t2).  
+00020390: 2020 2020 2020 2020 2020 2020 2020 656c                el
+000203a0: 6966 2073 656c 662e 5f64 7466 6f72 6d61  if self._dtforma
+000203b0: 7420 3d3d 2022 6973 6f22 3a0a 2020 2020  t == "iso":.    
+000203c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000203d0: 7431 2c20 7432 203d 2064 742e 7469 6d65  t1, t2 = dt.time
+000203e0: 3273 7472 2874 312c 2030 292c 2064 742e  2str(t1, 0), dt.
+000203f0: 7469 6d65 3273 7472 2874 322c 2030 290a  time2str(t2, 0).
+00020400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020410: 6c69 6e65 7061 7274 7320 3d20 5b0a 2020  lineparts = [.  
+00020420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020430: 2020 6974 656d 2e6b 6579 2c0a 2020 2020    item.key,.    
+00020440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020450: 7431 2c0a 2020 2020 2020 2020 2020 2020  t1,.            
+00020460: 2020 2020 2020 2020 7432 2c0a 2020 2020          t2,.    
+00020470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020480: 7574 696c 732e 6765 745f 7461 6773 5f61  utils.get_tags_a
+00020490: 6e64 5f70 6172 7473 5f66 726f 6d5f 7374  nd_parts_from_st
+000204a0: 7269 6e67 2869 7465 6d2e 6473 295b 305d  ring(item.ds)[0]
+000204b0: 2e6a 6f69 6e28 2220 2229 2c0a 2020 2020  .join(" "),.    
+000204c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000204d0: 746f 5f73 7472 2869 7465 6d2e 6765 7428  to_str(item.get(
+000204e0: 2264 7322 2c20 2222 2929 2c0a 2020 2020  "ds", "")),.    
+000204f0: 2020 2020 2020 2020 2020 2020 5d0a 2020              ].  
+00020500: 2020 2020 2020 2020 2020 2020 2020 6c69                li
+00020510: 6e65 732e 6170 7065 6e64 2822 3c74 723e  nes.append("<tr>
+00020520: 3c74 643e 2220 2b20 6c69 6e65 7061 7274  <td>" + linepart
+00020530: 732e 6a6f 696e 2822 3c2f 7464 3e3c 7464  s.join("</td><td
+00020540: 3e22 2920 2b20 223c 2f74 643e 3c2f 7472  >") + "</td></tr
+00020550: 3e22 290a 2020 2020 2020 2020 2020 2020  >").            
+00020560: 2320 4769 7665 2066 6565 6462 6163 6b20  # Give feedback 
+00020570: 7768 696c 6520 7072 6f63 6573 7369 6e67  while processing
+00020580: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00020590: 6c65 6e28 6c69 6e65 7329 2025 2032 3536  len(lines) % 256
+000205a0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+000205b0: 2020 2020 2020 2073 656c 662e 5f63 6f70         self._cop
+000205c0: 795f 6275 742e 696e 6e65 7248 544d 4c20  y_but.innerHTML 
+000205d0: 3d20 2246 6f75 6e64 2022 202b 206c 656e  = "Found " + len
+000205e0: 286c 696e 6573 2920 2b20 2220 7265 636f  (lines) + " reco
+000205f0: 7264 7322 0a20 2020 2020 2020 2020 2020  rds".           
+00020600: 2020 2020 2023 2073 656c 662e 5f74 6162       # self._tab
+00020610: 6c65 5f65 6c65 6d65 6e74 2e69 6e6e 6572  le_element.inner
+00020620: 4854 4d4c 203d 206c 696e 6573 2e6a 6f69  HTML = lines.joi
+00020630: 6e28 225c 6e22 290a 2020 2020 2020 2020  n("\n").        
+00020640: 2020 2020 2020 2020 6177 6169 7420 7769          await wi
+00020650: 6e64 6f77 2e74 6f6f 6c73 2e73 6c65 6570  ndow.tools.sleep
+00020660: 6d73 2831 290a 2020 2020 2020 2020 2020  ms(1).          
+00020670: 2020 6966 2077 6f72 6b69 6e67 2021 3d20    if working != 
+00020680: 7365 6c66 2e5f 776f 726b 696e 673a 0a20  self._working:. 
+00020690: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000206a0: 6574 7572 6e0a 0a20 2020 2020 2020 2023  eturn..        #
+000206b0: 2044 6f6e 650a 2020 2020 2020 2020 7365   Done.        se
+000206c0: 6c66 2e5f 636f 7079 5f62 7574 2e69 6e6e  lf._copy_but.inn
+000206d0: 6572 4854 4d4c 203d 2022 436f 7079 2065  erHTML = "Copy e
+000206e0: 7870 6f72 742d 7461 626c 6520 3c69 2063  xport-table <i c
+000206f0: 6c61 7373 3d27 6661 7327 3e5c 7566 3065  lass='fas'>\uf0e
+00020700: 613c 2f69 3e22 0a20 2020 2020 2020 2073  a</i>".        s
+00020710: 656c 662e 5f74 6162 6c65 5f65 6c65 6d65  elf._table_eleme
+00020720: 6e74 2e69 6e6e 6572 4854 4d4c 203d 206c  nt.innerHTML = l
+00020730: 696e 6573 2e6a 6f69 6e28 225c 6e22 290a  ines.join("\n").
+00020740: 2020 2020 2020 2020 7365 6c66 2e5f 636f          self._co
+00020750: 7079 5f62 7574 2e64 6973 6162 6c65 6420  py_but.disabled 
+00020760: 3d20 4661 6c73 650a 0a20 2020 2064 6566  = False..    def
+00020770: 205f 636f 7079 5f63 6c69 7062 6f61 7264   _copy_clipboard
+00020780: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00020790: 7461 626c 6520 3d20 7365 6c66 2e6d 6169  table = self.mai
+000207a0: 6e64 6976 2e63 6869 6c64 7265 6e5b 2d31  ndiv.children[-1
+000207b0: 5d0a 2020 2020 2020 2020 746f 6f6c 732e  ].        tools.
+000207c0: 636f 7079 5f64 6f6d 5f6e 6f64 6528 7461  copy_dom_node(ta
+000207d0: 626c 6529 0a20 2020 2020 2020 2073 656c  ble).        sel
+000207e0: 662e 5f63 6f70 795f 6275 742e 696e 6e65  f._copy_but.inne
+000207f0: 7248 544d 4c20 3d20 2243 6f70 7920 6578  rHTML = "Copy ex
+00020800: 706f 7274 2d74 6162 6c65 203c 6920 636c  port-table <i cl
+00020810: 6173 733d 2766 6173 273e 5c75 6634 3663  ass='fas'>\uf46c
+00020820: 3c2f 693e 220a 2020 2020 2020 2020 7769  </i>".        wi
+00020830: 6e64 6f77 2e73 6574 5469 6d65 6f75 7428  ndow.setTimeout(
+00020840: 7365 6c66 2e5f 7265 7365 745f 636f 7079  self._reset_copy
+00020850: 5f62 7574 5f74 6578 742c 2038 3030 290a  _but_text, 800).
+00020860: 0a20 2020 2064 6566 205f 7265 7365 745f  .    def _reset_
+00020870: 636f 7079 5f62 7574 5f74 6578 7428 7365  copy_but_text(se
+00020880: 6c66 293a 0a20 2020 2020 2020 2073 656c  lf):.        sel
+00020890: 662e 5f63 6f70 795f 6275 742e 696e 6e65  f._copy_but.inne
+000208a0: 7248 544d 4c20 3d20 2243 6f70 7920 6578  rHTML = "Copy ex
+000208b0: 706f 7274 2d74 6162 6c65 203c 6920 636c  port-table <i cl
+000208c0: 6173 733d 2766 6173 273e 5c75 6630 6561  ass='fas'>\uf0ea
+000208d0: 3c2f 693e 220a 0a0a 636c 6173 7320 496d  </i>"...class Im
+000208e0: 706f 7274 4469 616c 6f67 2842 6173 6544  portDialog(BaseD
+000208f0: 6961 6c6f 6729 3a0a 2020 2020 2222 2244  ialog):.    """D
+00020900: 6961 6c6f 6720 746f 2069 6d70 6f72 7420  ialog to import 
+00020910: 6461 7461 2e22 2222 0a0a 2020 2020 6465  data."""..    de
+00020920: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+00020930: 2063 616e 7661 7329 3a0a 2020 2020 2020   canvas):.      
+00020940: 2020 7375 7065 7228 292e 5f5f 696e 6974    super().__init
+00020950: 5f5f 2863 616e 7661 7329 0a0a 2020 2020  __(canvas)..    
+00020960: 6465 6620 6f70 656e 2873 656c 662c 2063  def open(self, c
+00020970: 616c 6c62 6163 6b3d 4e6f 6e65 293a 0a20  allback=None):. 
+00020980: 2020 2020 2020 2073 656c 662e 6d61 696e         self.main
+00020990: 6469 762e 696e 6e65 7248 544d 4c20 3d20  div.innerHTML = 
+000209a0: 6622 2222 0a20 2020 2020 2020 2020 2020  f""".           
+000209b0: 203c 6831 3e3c 6920 636c 6173 733d 2766   <h1><i class='f
+000209c0: 6173 273e 5c75 6635 3666 3c2f 693e 266e  as'>\uf56f</i>&n
+000209d0: 6273 703b 266e 6273 703b 496d 706f 7274  bsp;&nbsp;Import
+000209e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000209f0: 203c 6275 7474 6f6e 2074 7970 653d 2762   <button type='b
+00020a00: 7574 746f 6e27 3e3c 6920 636c 6173 733d  utton'><i class=
+00020a10: 2766 6173 273e 5c75 6630 3064 3c2f 693e  'fas'>\uf00d</i>
+00020a20: 3c2f 6275 7474 6f6e 3e0a 2020 2020 2020  </button>.      
+00020a30: 2020 2020 2020 3c2f 6831 3e0a 2020 2020        </h1>.    
+00020a40: 2020 2020 2020 2020 3c70 3e0a 2020 2020          <p>.    
+00020a50: 2020 2020 2020 2020 436f 7079 2079 6f75          Copy you
+00020a60: 7220 7461 626c 6520 6461 7461 2028 6672  r table data (fr
+00020a70: 6f6d 2065 2e67 2e20 6120 4353 5620 6669  om e.g. a CSV fi
+00020a80: 6c65 2c20 6120 7465 7874 2066 696c 652c  le, a text file,
+00020a90: 206f 720a 2020 2020 2020 2020 2020 2020   or.            
+00020aa0: 6469 7265 6374 6c79 2066 726f 6d20 4578  directly from Ex
+00020ab0: 6365 6c29 2061 6e64 2070 6173 7465 2069  cel) and paste i
+00020ac0: 7420 696e 2074 6865 2074 6578 7420 6669  t in the text fi
+00020ad0: 656c 6420 6265 6c6f 772e 0a20 2020 2020  eld below..     
+00020ae0: 2020 2020 2020 2043 5356 2066 696c 6573         CSV files
+00020af0: 2063 616e 2062 6520 6472 6167 6765 6420   can be dragged 
+00020b00: 696e 746f 2074 6865 2074 6578 7420 6669  into the text fi
+00020b10: 656c 642e 0a20 2020 2020 2020 2020 2020  eld..           
+00020b20: 2053 6565 203c 6120 6872 6566 3d27 6874   See <a href='ht
+00020b30: 7470 733a 2f2f 7469 6d65 7461 6767 6572  tps://timetagger
+00020b40: 2e61 7070 2f61 7274 6963 6c65 732f 696d  .app/articles/im
+00020b50: 706f 7274 696e 672f 273e 7468 6973 2061  porting/'>this a
+00020b60: 7274 6963 6c65 3c2f 613e 0a20 2020 2020  rticle</a>.     
+00020b70: 2020 2020 2020 2066 6f72 2064 6574 6169         for detai
+00020b80: 6c73 2e0a 2020 2020 2020 2020 2020 2020  ls..            
+00020b90: 3c2f 703e 3c70 3e26 6e62 7370 3b3c 2f70  </p><p>&nbsp;</p
+00020ba0: 3e0a 2020 2020 2020 2020 2020 2020 3c62  >.            <b
+00020bb0: 7574 746f 6e20 7479 7065 3d27 6275 7474  utton type='butt
+00020bc0: 6f6e 273e 416e 616c 7973 653c 2f62 7574  on'>Analyse</but
+00020bd0: 746f 6e3e 0a20 2020 2020 2020 2020 2020  ton>.           
+00020be0: 203c 6275 7474 6f6e 2074 7970 653d 2762   <button type='b
+00020bf0: 7574 746f 6e27 3e49 6d70 6f72 743c 2f62  utton'>Import</b
+00020c00: 7574 746f 6e3e 0a20 2020 2020 2020 2020  utton>.         
+00020c10: 2020 203c 6872 202f 3e0a 2020 2020 2020     <hr />.      
+00020c20: 2020 2020 2020 3c64 6976 3e3c 2f64 6976        <div></div
+00020c30: 3e0a 2020 2020 2020 2020 2020 2020 3c74  >.            <t
+00020c40: 6578 7461 7265 6120 726f 7773 3d27 3132  extarea rows='12
+00020c50: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+00020c60: 2020 7374 796c 653d 2762 6163 6b67 726f    style='backgro
+00020c70: 756e 643a 2023 6666 663b 2064 6973 706c  und: #fff; displ
+00020c80: 6179 3a20 626c 6f63 6b3b 206d 6172 6769  ay: block; margi
+00020c90: 6e3a 2030 2e35 656d 3b20 7769 6474 683a  n: 0.5em; width:
+00020ca0: 2063 616c 6328 3130 3025 202d 2031 2e35   calc(100% - 1.5
+00020cb0: 656d 293b 273e 0a20 2020 2020 2020 2020  em);'>.         
+00020cc0: 2020 203c 2f74 6578 7461 7265 613e 0a20     </textarea>. 
+00020cd0: 2020 2020 2020 2020 2020 2022 2222 0a0a             """..
+00020ce0: 2020 2020 2020 2020 7365 6c66 2e5f 696e          self._in
+00020cf0: 7075 745f 656c 656d 656e 7420 3d20 7365  put_element = se
+00020d00: 6c66 2e6d 6169 6e64 6976 2e63 6869 6c64  lf.maindiv.child
+00020d10: 7265 6e5b 2d31 5d0a 2020 2020 2020 2020  ren[-1].        
+00020d20: 7365 6c66 2e5f 696e 7075 745f 656c 656d  self._input_elem
+00020d30: 656e 742e 7661 6c75 6520 3d20 2222 0a20  ent.value = "". 
+00020d40: 2020 2020 2020 2073 656c 662e 5f69 6e70         self._inp
+00020d50: 7574 5f65 6c65 6d65 6e74 2e6f 6e64 7261  ut_element.ondra
+00020d60: 6765 7869 7420 3d20 7365 6c66 2e5f 6f6e  gexit = self._on
+00020d70: 5f64 726f 705f 7374 6f70 0a20 2020 2020  _drop_stop.     
+00020d80: 2020 2073 656c 662e 5f69 6e70 7574 5f65     self._input_e
+00020d90: 6c65 6d65 6e74 2e6f 6e64 7261 676f 7665  lement.ondragove
+00020da0: 7220 3d20 7365 6c66 2e5f 6f6e 5f64 726f  r = self._on_dro
+00020db0: 705f 6f76 6572 0a20 2020 2020 2020 2073  p_over.        s
+00020dc0: 656c 662e 5f69 6e70 7574 5f65 6c65 6d65  elf._input_eleme
+00020dd0: 6e74 2e6f 6e64 726f 7020 3d20 7365 6c66  nt.ondrop = self
+00020de0: 2e5f 6f6e 5f64 726f 700a 0a20 2020 2020  ._on_drop..     
+00020df0: 2020 2069 6620 6e6f 7420 280a 2020 2020     if not (.    
+00020e00: 2020 2020 2020 2020 7769 6e64 6f77 2e73          window.s
+00020e10: 746f 7265 2e5f 5f6e 616d 655f 5f2e 7374  tore.__name__.st
+00020e20: 6172 7473 7769 7468 2822 4465 6d6f 2229  artswith("Demo")
+00020e30: 0a20 2020 2020 2020 2020 2020 206f 7220  .            or 
+00020e40: 7769 6e64 6f77 2e73 746f 7265 2e5f 5f6e  window.store.__n
+00020e50: 616d 655f 5f2e 7374 6172 7473 7769 7468  ame__.startswith
+00020e60: 2822 5361 6e64 626f 7822 290a 2020 2020  ("Sandbox").    
+00020e70: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+00020e80: 2020 206d 6169 6e74 6578 7420 3d20 7365     maintext = se
+00020e90: 6c66 2e6d 6169 6e64 6976 2e63 6869 6c64  lf.maindiv.child
+00020ea0: 7265 6e5b 325d 0a20 2020 2020 2020 2020  ren[2].         
+00020eb0: 2020 206d 6169 6e74 6578 742e 696e 6e65     maintext.inne
+00020ec0: 7248 544d 4c20 2b3d 2022 2222 0a20 2020  rHTML += """.   
+00020ed0: 2020 2020 2020 2020 2020 2020 2043 6f6e               Con
+00020ee0: 7369 6465 7220 696d 706f 7274 696e 6720  sider importing 
+00020ef0: 696e 746f 2074 6865 0a20 2020 2020 2020  into the.       
+00020f00: 2020 2020 2020 2020 203c 6120 7461 7267           <a targ
+00020f10: 6574 3d27 6e65 7727 2068 7265 663d 2773  et='new' href='s
+00020f20: 616e 6462 6f78 273e 5361 6e64 626f 783c  andbox'>Sandbox<
+00020f30: 2f61 3e20 6669 7273 742e 0a20 2020 2020  /a> first..     
+00020f40: 2020 2020 2020 2020 2020 2022 2222 0a0a             """..
+00020f50: 2020 2020 2020 2020 7365 6c66 2e5f 616e          self._an
+00020f60: 616c 7973 6973 5f6f 7574 203d 2073 656c  alysis_out = sel
+00020f70: 662e 6d61 696e 6469 762e 6368 696c 6472  f.maindiv.childr
+00020f80: 656e 5b2d 325d 0a0a 2020 2020 2020 2020  en[-2]..        
+00020f90: 7365 6c66 2e5f 616e 616c 7973 655f 6275  self._analyse_bu
+00020fa0: 7420 3d20 7365 6c66 2e6d 6169 6e64 6976  t = self.maindiv
+00020fb0: 2e63 6869 6c64 7265 6e5b 335d 0a20 2020  .children[3].   
+00020fc0: 2020 2020 2073 656c 662e 5f61 6e61 6c79       self._analy
+00020fd0: 7365 5f62 7574 2e6f 6e63 6c69 636b 203d  se_but.onclick =
+00020fe0: 2073 656c 662e 646f 5f61 6e61 6c79 7365   self.do_analyse
+00020ff0: 0a20 2020 2020 2020 2073 656c 662e 5f69  .        self._i
+00021000: 6d70 6f72 745f 6275 7420 3d20 7365 6c66  mport_but = self
+00021010: 2e6d 6169 6e64 6976 2e63 6869 6c64 7265  .maindiv.childre
+00021020: 6e5b 345d 0a20 2020 2020 2020 2073 656c  n[4].        sel
+00021030: 662e 5f69 6d70 6f72 745f 6275 742e 6f6e  f._import_but.on
+00021040: 636c 6963 6b20 3d20 7365 6c66 2e64 6f5f  click = self.do_
+00021050: 696d 706f 7274 0a20 2020 2020 2020 2073  import.        s
+00021060: 656c 662e 5f69 6d70 6f72 745f 6275 742e  elf._import_but.
+00021070: 6469 7361 626c 6564 203d 2054 7275 650a  disabled = True.
+00021080: 0a20 2020 2020 2020 2073 656c 662e 5f63  .        self._c
+00021090: 616e 6365 6c5f 6275 7420 3d20 7365 6c66  ancel_but = self
+000210a0: 2e6d 6169 6e64 6976 2e63 6869 6c64 7265  .maindiv.childre
+000210b0: 6e5b 305d 2e63 6869 6c64 7265 6e5b 2d31  n[0].children[-1
+000210c0: 5d0a 2020 2020 2020 2020 7365 6c66 2e5f  ].        self._
+000210d0: 6361 6e63 656c 5f62 7574 2e6f 6e63 6c69  cancel_but.oncli
+000210e0: 636b 203d 2073 656c 662e 636c 6f73 650a  ck = self.close.
+000210f0: 2020 2020 2020 2020 7375 7065 7228 292e          super().
+00021100: 6f70 656e 2863 616c 6c62 6163 6b29 0a0a  open(callback)..
+00021110: 2020 2020 6465 6620 5f6f 6e5f 6472 6f70      def _on_drop
+00021120: 5f73 746f 7028 7365 6c66 2c20 6576 293a  _stop(self, ev):
+00021130: 0a20 2020 2020 2020 2073 656c 662e 5f69  .        self._i
+00021140: 6e70 7574 5f65 6c65 6d65 6e74 2e73 7479  nput_element.sty
+00021150: 6c65 2e62 6163 6b67 726f 756e 6420 3d20  le.background = 
+00021160: 4e6f 6e65 0a0a 2020 2020 6465 6620 5f6f  None..    def _o
+00021170: 6e5f 6472 6f70 5f6f 7665 7228 7365 6c66  n_drop_over(self
+00021180: 2c20 6576 293a 0a20 2020 2020 2020 2065  , ev):.        e
+00021190: 762e 7072 6576 656e 7444 6566 6175 6c74  v.preventDefault
+000211a0: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
+000211b0: 5f69 6e70 7574 5f65 6c65 6d65 6e74 2e73  _input_element.s
+000211c0: 7479 6c65 2e62 6163 6b67 726f 756e 6420  tyle.background 
+000211d0: 3d20 2223 4446 4422 0a0a 2020 2020 6465  = "#DFD"..    de
+000211e0: 6620 5f6f 6e5f 6472 6f70 2873 656c 662c  f _on_drop(self,
+000211f0: 2065 7629 3a0a 2020 2020 2020 2020 6576   ev):.        ev
+00021200: 2e70 7265 7665 6e74 4465 6661 756c 7428  .preventDefault(
+00021210: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
+00021220: 6f6e 5f64 726f 705f 7374 6f70 2829 0a0a  on_drop_stop()..
+00021230: 2020 2020 2020 2020 6465 6620 6170 706c          def appl
+00021240: 795f 7465 7874 2873 293a 0a20 2020 2020  y_text(s):.     
+00021250: 2020 2020 2020 2073 656c 662e 5f69 6e70         self._inp
+00021260: 7574 5f65 6c65 6d65 6e74 2e76 616c 7565  ut_element.value
+00021270: 203d 2073 0a0a 2020 2020 2020 2020 6966   = s..        if
+00021280: 2065 762e 6461 7461 5472 616e 7366 6572   ev.dataTransfer
+00021290: 2e69 7465 6d73 3a0a 2020 2020 2020 2020  .items:.        
+000212a0: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
+000212b0: 6765 286c 656e 2865 762e 6461 7461 5472  ge(len(ev.dataTr
+000212c0: 616e 7366 6572 2e69 7465 6d73 2929 3a0a  ansfer.items)):.
+000212d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000212e0: 6966 2065 762e 6461 7461 5472 616e 7366  if ev.dataTransf
+000212f0: 6572 2e69 7465 6d73 5b69 5d2e 6b69 6e64  er.items[i].kind
+00021300: 203d 3d20 2266 696c 6522 3a0a 2020 2020   == "file":.    
+00021310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021320: 6669 6c65 203d 2065 762e 6461 7461 5472  file = ev.dataTr
+00021330: 616e 7366 6572 2e69 7465 6d73 5b69 5d2e  ansfer.items[i].
+00021340: 6765 7441 7346 696c 6528 290a 2020 2020  getAsFile().    
+00021350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021360: 6578 7420 3d20 6669 6c65 2e6e 616d 652e  ext = file.name.
+00021370: 6c6f 7765 7228 292e 7370 6c69 7428 222e  lower().split(".
+00021380: 2229 5b2d 315d 0a20 2020 2020 2020 2020  ")[-1].         
+00021390: 2020 2020 2020 2020 2020 2069 6620 6578             if ex
+000213a0: 7420 696e 2028 2278 6c73 222c 2022 786c  t in ("xls", "xl
+000213b0: 7378 222c 2022 786c 736d 222c 2022 7064  sx", "xlsm", "pd
+000213c0: 6622 293a 0a20 2020 2020 2020 2020 2020  f"):.           
+000213d0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000213e0: 662e 5f61 6e61 6c79 7369 735f 6f75 742e  f._analysis_out.
+000213f0: 696e 6e65 7248 544d 4c20 3d20 280a 2020  innerHTML = (.  
+00021400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021410: 2020 2020 2020 2020 2020 6622 4361 6e6e            f"Cann
+00021420: 6f74 2070 726f 6365 7373 203c 753e 7b66  ot process <u>{f
+00021430: 696c 652e 6e61 6d65 7d3c 2f75 3e2e 2044  ile.name}</u>. D
+00021440: 726f 7020 6120 2e63 7376 2066 696c 6520  rop a .csv file 
+00021450: 6f72 2022 0a20 2020 2020 2020 2020 2020  or ".           
 00021460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021470: 2020 2020 2020 2069 6620 6c65 6e28 6461         if len(da
-00021480: 7465 2e73 706c 6974 2822 2d22 295b 2d31  te.split("-")[-1
-00021490: 5d29 203d 3d20 343a 0a20 2020 2020 2020  ]) == 4:.       
+00021470: 202b 2066 2263 6f70 7920 7468 6520 636f   + f"copy the co
+00021480: 6c75 6d6e 7320 696e 2045 7863 656c 2061  lumns in Excel a
+00021490: 6e64 2070 6173 7465 2068 6572 652e 220a  nd paste here.".
 000214a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000214b0: 2020 2020 2064 6174 6520 3d20 222d 222e       date = "-".
-000214c0: 6a6f 696e 2872 6576 6572 7365 6428 6461  join(reversed(da
-000214d0: 7465 2e73 706c 6974 2822 2d22 2929 290a  te.split("-"))).
-000214e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000214f0: 2020 2020 2020 2020 7261 772e 6461 7465          raw.date
-00021500: 5f6f 6b20 3d20 6461 7465 0a20 2020 2020  _ok = date.     
-00021510: 2020 2020 2020 2020 2020 2069 6620 5472             if Tr
-00021520: 7565 3a20 2023 2072 6177 2e74 3120 616c  ue:  # raw.t1 al
-00021530: 7761 7973 2065 7869 7374 730a 2020 2020  ways exists.    
-00021540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021550: 7265 636f 7264 2e74 3120 3d20 666c 6f61  record.t1 = floa
-00021560: 7428 7261 772e 7431 290a 2020 2020 2020  t(raw.t1).      
-00021570: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00021580: 206e 6f74 2028 6973 4669 6e69 7465 2872   not (isFinite(r
-00021590: 6563 6f72 642e 7431 2920 616e 6420 7265  ecord.t1) and re
-000215a0: 636f 7264 2e74 3120 3e20 7965 6172 5f70  cord.t1 > year_p
-000215b0: 6173 745f 6570 6f63 6829 3a0a 2020 2020  ast_epoch):.    
-000215c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000215d0: 2020 2020 7265 636f 7264 2e74 3120 3d20      record.t1 = 
-000215e0: 4461 7465 2872 6177 2e74 3129 2e67 6574  Date(raw.t1).get
-000215f0: 5469 6d65 2829 202f 2031 3030 300a 2020  Time() / 1000.  
-00021600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021610: 2020 6966 206e 6f74 2069 7346 696e 6974    if not isFinit
-00021620: 6528 7265 636f 7264 2e74 3129 2061 6e64  e(record.t1) and
-00021630: 2072 6177 2e64 6174 655f 6f6b 3a0a 2020   raw.date_ok:.  
-00021640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021650: 2020 2020 2020 2320 5472 7920 7573 6520        # Try use 
-00021660: 6461 7465 2c20 5961 7374 2075 7365 7320  date, Yast uses 
-00021670: 646f 7473 2c20 7265 7665 7273 6520 6966  dots, reverse if
-00021680: 206e 6565 6465 640a 2020 2020 2020 2020   needed.        
-00021690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000216a0: 746d 6520 3d20 7261 772e 7431 2e72 6570  tme = raw.t1.rep
-000216b0: 6c61 6365 2822 2e22 2c20 223a 2229 0a20  lace(".", ":"). 
-000216c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000216d0: 2020 2020 2020 2069 6620 3420 3c3d 206c         if 4 <= l
-000216e0: 656e 2874 6d65 2920 3c3d 2038 2061 6e64  en(tme) <= 8 and
-000216f0: 2031 203c 3d20 746d 652e 636f 756e 7428   1 <= tme.count(
-00021700: 223a 2229 203c 3d20 323a 0a20 2020 2020  ":") <= 2:.     
-00021710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021720: 2020 2020 2020 2023 204e 6f74 653a 206f         # Note: o
-00021730: 6e20 494f 532c 2044 6174 6520 6e65 6564  n IOS, Date need
-00021740: 7320 746f 2062 6520 2279 7979 792d 6d6d  s to be "yyyy-mm
-00021750: 2d64 6454 6868 3a6d 6d3a 7373 220a 2020  -ddThh:mm:ss".  
-00021760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021770: 2020 2020 2020 2020 2020 2320 6275 7420            # but 
-00021780: 7065 6f70 6c65 2061 7265 2075 6e6c 696b  people are unlik
-00021790: 656c 7920 746f 2069 6d70 6f72 7420 6f6e  ely to import on
-000217a0: 2061 6e20 696f 7320 6465 7669 6365 202e   an ios device .
-000217b0: 2e2e 2049 2068 6f70 652e 0a20 2020 2020  .. I hope..     
-000217c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000217d0: 2020 2020 2020 2072 6563 6f72 642e 7431         record.t1
-000217e0: 203d 2044 6174 6528 7261 772e 6461 7465   = Date(raw.date
-000217f0: 5f6f 6b20 2b20 2220 2220 2b20 746d 6529  _ok + " " + tme)
-00021800: 2e67 6574 5469 6d65 2829 202f 2031 3030  .getTime() / 100
-00021810: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
-00021820: 2020 2020 2020 7265 636f 7264 2e74 3120        record.t1 
-00021830: 3d20 4d61 7468 2e66 6c6f 6f72 2872 6563  = Math.floor(rec
-00021840: 6f72 642e 7431 290a 2020 2020 2020 2020  ord.t1).        
-00021850: 2020 2020 2020 2020 6966 2054 7275 653a          if True:
-00021860: 2020 2320 7261 772e 7432 206f 7220 6475    # raw.t2 or du
-00021870: 7261 7469 6f6e 2065 7869 7374 7320 2d0a  ration exists -.
-00021880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021890: 2020 2020 7265 636f 7264 2e74 3220 3d20      record.t2 = 
-000218a0: 666c 6f61 7428 7261 772e 7432 290a 2020  float(raw.t2).  
-000218b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000218c0: 2020 6966 206e 6f74 2028 6973 4669 6e69    if not (isFini
-000218d0: 7465 2872 6563 6f72 642e 7432 2920 616e  te(record.t2) an
-000218e0: 6420 7265 636f 7264 2e74 3220 3e20 7965  d record.t2 > ye
-000218f0: 6172 5f70 6173 745f 6570 6f63 6829 3a0a  ar_past_epoch):.
-00021900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021910: 2020 2020 2020 2020 7265 636f 7264 2e74          record.t
-00021920: 3220 3d20 4461 7465 2872 6177 2e74 3229  2 = Date(raw.t2)
-00021930: 2e67 6574 5469 6d65 2829 202f 2031 3030  .getTime() / 100
-00021940: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
-00021950: 2020 2020 2020 6966 206e 6f74 2069 7346        if not isF
-00021960: 696e 6974 6528 7265 636f 7264 2e74 3229  inite(record.t2)
-00021970: 2061 6e64 2072 6177 2e64 7572 6174 696f   and raw.duratio
-00021980: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
-00021990: 2020 2020 2020 2020 2020 2023 2054 7279             # Try
-000219a0: 2075 7365 2064 7572 6174 696f 6e0a 2020   use duration.  
-000219b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000219c0: 2020 2020 2020 6475 7261 7469 6f6e 203d        duration =
-000219d0: 2066 6c6f 6174 2872 6177 2e64 7572 6174   float(raw.durat
-000219e0: 696f 6e29 0a20 2020 2020 2020 2020 2020  ion).           
-000219f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00021a00: 223a 2220 696e 2072 6177 2e64 7572 6174  ":" in raw.durat
-00021a10: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
-00021a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021a30: 2064 7572 6174 696f 6e5f 7061 7274 7320   duration_parts 
-00021a40: 3d20 7261 772e 6475 7261 7469 6f6e 2e73  = raw.duration.s
-00021a50: 706c 6974 2822 3a22 290a 2020 2020 2020  plit(":").      
-00021a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021a70: 2020 2020 2020 6966 206c 656e 2864 7572        if len(dur
-00021a80: 6174 696f 6e5f 7061 7274 7329 203d 3d20  ation_parts) == 
-00021a90: 323a 0a20 2020 2020 2020 2020 2020 2020  2:.             
-00021aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021ab0: 2020 2064 7572 6174 696f 6e20 3d20 666c     duration = fl
-00021ac0: 6f61 7428 6475 7261 7469 6f6e 5f70 6172  oat(duration_par
-00021ad0: 7473 5b30 5d29 202a 2033 3630 300a 2020  ts[0]) * 3600.  
-00021ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021af0: 2020 2020 2020 2020 2020 2020 2020 6475                du
-00021b00: 7261 7469 6f6e 202b 3d20 666c 6f61 7428  ration += float(
-00021b10: 6475 7261 7469 6f6e 5f70 6172 7473 5b31  duration_parts[1
-00021b20: 5d29 202a 2036 300a 2020 2020 2020 2020  ]) * 60.        
-00021b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021b40: 2020 2020 656c 6966 206c 656e 2864 7572      elif len(dur
-00021b50: 6174 696f 6e5f 7061 7274 7329 203d 3d20  ation_parts) == 
-00021b60: 333a 0a20 2020 2020 2020 2020 2020 2020  3:.             
-00021b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021b80: 2020 2064 7572 6174 696f 6e20 3d20 666c     duration = fl
-00021b90: 6f61 7428 6475 7261 7469 6f6e 5f70 6172  oat(duration_par
-00021ba0: 7473 5b30 5d29 202a 2033 3630 300a 2020  ts[0]) * 3600.  
-00021bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021bc0: 2020 2020 2020 2020 2020 2020 2020 6475                du
-00021bd0: 7261 7469 6f6e 202b 3d20 666c 6f61 7428  ration += float(
-00021be0: 6475 7261 7469 6f6e 5f70 6172 7473 5b31  duration_parts[1
-00021bf0: 5d29 202a 2036 300a 2020 2020 2020 2020  ]) * 60.        
-00021c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021c10: 2020 2020 2020 2020 6475 7261 7469 6f6e          duration
-00021c20: 202b 3d20 666c 6f61 7428 6475 7261 7469   += float(durati
-00021c30: 6f6e 5f70 6172 7473 5b32 5d29 0a20 2020  on_parts[2]).   
-00021c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021c50: 2020 2020 2072 6563 6f72 642e 7432 203d       record.t2 =
-00021c60: 2072 6563 6f72 642e 7431 202b 2066 6c6f   record.t1 + flo
-00021c70: 6174 2864 7572 6174 696f 6e29 0a20 2020  at(duration).   
-00021c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021c90: 2069 6620 6e6f 7420 6973 4669 6e69 7465   if not isFinite
-00021ca0: 2872 6563 6f72 642e 7432 2920 616e 6420  (record.t2) and 
-00021cb0: 7261 772e 6461 7465 5f6f 6b3a 0a20 2020  raw.date_ok:.   
-00021cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021cd0: 2020 2020 2023 2054 7279 2075 7365 2064       # Try use d
-00021ce0: 6174 650a 2020 2020 2020 2020 2020 2020  ate.            
-00021cf0: 2020 2020 2020 2020 2020 2020 746d 6520              tme 
-00021d00: 3d20 7261 772e 7432 2e72 6570 6c61 6365  = raw.t2.replace
-00021d10: 2822 2e22 2c20 223a 2229 0a20 2020 2020  (".", ":").     
-00021d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021d30: 2020 2069 6620 3420 3c3d 206c 656e 2874     if 4 <= len(t
-00021d40: 6d65 2920 3c3d 2038 2061 6e64 2031 203c  me) <= 8 and 1 <
-00021d50: 3d20 746d 652e 636f 756e 7428 223a 2229  = tme.count(":")
-00021d60: 203c 3d20 323a 0a20 2020 2020 2020 2020   <= 2:.         
-00021d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021d80: 2020 2072 6563 6f72 642e 7432 203d 2044     record.t2 = D
-00021d90: 6174 6528 7261 772e 6461 7465 5f6f 6b20  ate(raw.date_ok 
-00021da0: 2b20 2220 2220 2b20 746d 6529 2e67 6574  + " " + tme).get
-00021db0: 5469 6d65 2829 202f 2031 3030 300a 2020  Time() / 1000.  
-00021dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021dd0: 2020 7265 636f 7264 2e74 3220 3d20 4d61    record.t2 = Ma
-00021de0: 7468 2e63 6569 6c28 7265 636f 7264 2e74  th.ceil(record.t
-00021df0: 3229 0a20 2020 2020 2020 2020 2020 2020  2).             
-00021e00: 2020 2069 6620 7261 772e 7461 6773 3a20     if raw.tags: 
-00021e10: 2023 2049 6620 7461 6773 2061 7265 2067   # If tags are g
-00021e20: 6976 656e 2c20 7573 6520 7468 6174 0a20  iven, use that. 
-00021e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021e40: 2020 2072 6177 5f74 6167 7320 3d20 7261     raw_tags = ra
-00021e50: 772e 7461 6773 2e72 6570 6c61 6365 2822  w.tags.replace("
-00021e60: 2c22 2c20 2220 2229 2e73 706c 6974 2829  ,", " ").split()
-00021e70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021e80: 2020 2020 2074 6167 7320 3d20 5b5d 0a20       tags = []. 
-00021e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021ea0: 2020 2066 6f72 2074 6167 2069 6e20 7261     for tag in ra
-00021eb0: 775f 7461 6773 3a0a 2020 2020 2020 2020  w_tags:.        
-00021ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021ed0: 7461 6720 3d20 7574 696c 732e 636f 6e76  tag = utils.conv
-00021ee0: 6572 745f 7465 7874 5f74 6f5f 7661 6c69  ert_text_to_vali
-00021ef0: 645f 7461 6728 7461 672e 7472 696d 2829  d_tag(tag.trim()
-00021f00: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00021f10: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-00021f20: 2874 6167 2920 3e20 323a 0a20 2020 2020  (tag) > 2:.     
-00021f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021f40: 2020 2020 2020 2074 6167 732e 7075 7368         tags.push
-00021f50: 2874 6167 290a 2020 2020 2020 2020 2020  (tag).          
-00021f60: 2020 2020 2020 656c 7365 3a20 2023 2049        else:  # I
-00021f70: 6620 6e6f 2074 6167 7320 6172 6520 6769  f no tags are gi
-00021f80: 7665 6e2c 2074 7279 2074 6f20 6465 7269  ven, try to deri
-00021f90: 7665 2074 6167 7320 6672 6f6d 2070 726f  ve tags from pro
-00021fa0: 6a65 6374 206e 616d 650a 2020 2020 2020  ject name.      
-00021fb0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00021fc0: 6f6a 6563 745f 6e61 6d65 203d 2072 6177  oject_name = raw
-00021fd0: 2e70 726f 6a65 6374 6e61 6d65 206f 7220  .projectname or 
-00021fe0: 7261 772e 7072 6f6a 6563 746b 6579 206f  raw.projectkey o
-00021ff0: 7220 2222 0a20 2020 2020 2020 2020 2020  r "".           
-00022000: 2020 2020 2020 2020 2069 6620 7261 772e           if raw.
-00022010: 7072 6f6a 6563 7470 6174 683a 0a20 2020  projectpath:.   
-00022020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022030: 2020 2020 2070 726f 6a65 6374 5f70 6172       project_par
-00022040: 7473 203d 205b 7261 772e 7072 6f6a 6563  ts = [raw.projec
-00022050: 7470 6174 685d 0a20 2020 2020 2020 2020  tpath].         
-00022060: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00022070: 6620 7261 772e 6d6f 7265 2061 6e64 2068  f raw.more and h
-00022080: 6561 6465 7270 6172 7473 325b 2d31 5d20  eaderparts2[-1] 
-00022090: 3d3d 2022 7072 6f6a 6563 7470 6174 6822  == "projectpath"
-000220a0: 3a20 2023 2059 6173 740a 2020 2020 2020  :  # Yast.      
-000220b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000220c0: 2020 2020 2020 7072 6f6a 6563 745f 7061        project_pa
-000220d0: 7274 7320 3d20 5b72 6177 2e70 726f 6a65  rts = [raw.proje
-000220e0: 6374 7061 7468 2e72 6570 6c61 6365 2822  ctpath.replace("
-000220f0: 2f22 2c20 2220 7c20 2229 5d0a 2020 2020  /", " | ")].    
-00022100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022110: 2020 2020 2020 2020 666f 7220 6a20 696e          for j in
-00022120: 2072 616e 6765 286c 656e 2872 6177 2e6d   range(len(raw.m
-00022130: 6f72 6529 293a 0a20 2020 2020 2020 2020  ore)):.         
-00022140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022150: 2020 2020 2020 2069 6620 6c65 6e28 7261         if len(ra
-00022160: 772e 6d6f 7265 5b6a 5d29 203e 2030 3a0a  w.more[j]) > 0:.
-00022170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022190: 2020 2020 7072 6f6a 6563 745f 7061 7274      project_part
-000221a0: 732e 6170 7065 6e64 280a 2020 2020 2020  s.append(.      
-000221b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000221c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000221d0: 2020 7261 772e 6d6f 7265 5b6a 5d2e 7265    raw.more[j].re
-000221e0: 706c 6163 6528 222f 222c 2022 207c 2022  place("/", " | "
-000221f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00022200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022210: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00022220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022230: 7072 6f6a 6563 745f 7061 7274 732e 6170  project_parts.ap
-00022240: 7065 6e64 2872 6177 2e70 726f 6a65 6374  pend(raw.project
-00022250: 6e61 6d65 2e72 6570 6c61 6365 2822 2f22  name.replace("/"
-00022260: 2c20 2220 7c20 2229 290a 2020 2020 2020  , " | ")).      
-00022270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022280: 2020 7072 6f6a 6563 745f 6e61 6d65 203d    project_name =
-00022290: 2022 2f22 2e6a 6f69 6e28 7072 6f6a 6563   "/".join(projec
-000222a0: 745f 7061 7274 7329 0a20 2020 2020 2020  t_parts).       
-000222b0: 2020 2020 2020 2020 2020 2020 2070 726f               pro
-000222c0: 6a65 6374 5f6e 616d 6520 3d20 746f 5f73  ject_name = to_s
-000222d0: 7472 2870 726f 6a65 6374 5f6e 616d 6529  tr(project_name)
-000222e0: 2020 2320 6e6f 726d 616c 697a 650a 2020    # normalize.  
-000222f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022300: 2020 7461 6773 203d 205b 5d0a 2020 2020    tags = [].    
-00022310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022320: 6966 2070 726f 6a65 6374 5f6e 616d 653a  if project_name:
-00022330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022340: 2020 2020 2020 2020 2074 6167 7320 3d20           tags = 
-00022350: 5b75 7469 6c73 2e63 6f6e 7665 7274 5f74  [utils.convert_t
-00022360: 6578 745f 746f 5f76 616c 6964 5f74 6167  ext_to_valid_tag
-00022370: 2870 726f 6a65 6374 5f6e 616d 6529 5d0a  (project_name)].
-00022380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022390: 6966 2054 7275 653a 0a20 2020 2020 2020  if True:.       
-000223a0: 2020 2020 2020 2020 2020 2020 2074 6167               tag
-000223b0: 735f 6469 6374 203d 207b 7d0a 2020 2020  s_dict = {}.    
-000223c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000223d0: 666f 7220 7461 6720 696e 2074 6167 733a  for tag in tags:
-000223e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000223f0: 2020 2020 2020 2020 2074 6167 735f 6469           tags_di
-00022400: 6374 5b74 6167 5d20 3d20 7461 670a 2020  ct[tag] = tag.  
-00022410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022420: 2020 6966 2072 6177 2e64 6573 6372 6970    if raw.descrip
-00022430: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
-00022440: 2020 2020 2020 2020 2020 2020 2020 7461                ta
-00022450: 6773 2c20 7061 7274 7320 3d20 7574 696c  gs, parts = util
-00022460: 732e 6765 745f 7461 6773 5f61 6e64 5f70  s.get_tags_and_p
-00022470: 6172 7473 5f66 726f 6d5f 7374 7269 6e67  arts_from_string
-00022480: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00022490: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-000224a0: 772e 6465 7363 7269 7074 696f 6e0a 2020  w.description.  
-000224b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000224c0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000224d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000224e0: 666f 7220 7461 6720 696e 2074 6167 733a  for tag in tags:
-000224f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022500: 2020 2020 2020 2020 2020 2020 2074 6167               tag
-00022510: 735f 6469 6374 2e70 6f70 2874 6167 2c20  s_dict.pop(tag, 
-00022520: 4e6f 6e65 290a 2020 2020 2020 2020 2020  None).          
-00022530: 2020 2020 2020 2020 2020 2020 2020 7461                ta
-00022540: 677a 203d 2022 2022 2e6a 6f69 6e28 7461  gz = " ".join(ta
-00022550: 6773 5f64 6963 742e 7661 6c75 6573 2829  gs_dict.values()
-00022560: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00022570: 2020 2020 2020 2020 2020 7265 636f 7264            record
-00022580: 2e64 7320 3d20 746f 5f73 7472 2874 6167  .ds = to_str(tag
-00022590: 7a20 2b20 2220 2220 2b20 7261 772e 6465  z + " " + raw.de
-000225a0: 7363 7269 7074 696f 6e29 0a20 2020 2020  scription).     
-000225b0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000225c0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000225d0: 2020 2020 2020 2020 2020 2020 2074 6167               tag
-000225e0: 7a20 3d20 2220 222e 6a6f 696e 2874 6167  z = " ".join(tag
-000225f0: 735f 6469 6374 2e76 616c 7565 7328 2929  s_dict.values())
-00022600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022610: 2020 2020 2020 2020 2072 6563 6f72 642e           record.
-00022620: 6473 203d 2074 6167 7a0a 2020 2020 2020  ds = tagz.      
-00022630: 2020 2020 2020 2020 2020 2320 5661 6c69            # Vali
-00022640: 6461 7465 2072 6563 6f72 640a 2020 2020  date record.    
-00022650: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-00022660: 6563 6f72 642e 7431 203d 3d20 3020 6f72  ecord.t1 == 0 or
-00022670: 2072 6563 6f72 642e 7432 203d 3d20 303a   record.t2 == 0:
-00022680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022690: 2020 2020 206c 6f67 2866 2249 7465 6d20       log(f"Item 
-000226a0: 6f6e 2072 6f77 207b 726f 777d 2068 6173  on row {row} has
-000226b0: 2069 6e76 616c 6964 2073 7461 7274 2f73   invalid start/s
-000226c0: 746f 7020 7469 6d65 7322 290a 2020 2020  top times").    
-000226d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000226e0: 7265 7475 726e 0a20 2020 2020 2020 2020  return.         
-000226f0: 2020 2020 2020 2069 6620 6c65 6e28 7769         if len(wi
-00022700: 6e64 6f77 2e73 746f 7265 2e72 6563 6f72  ndow.store.recor
-00022710: 6473 2e5f 7661 6c69 6461 7465 5f69 7465  ds._validate_ite
-00022720: 6d73 285b 7265 636f 7264 5d29 2920 3d3d  ms([record])) ==
-00022730: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-00022740: 2020 2020 2020 2020 6c6f 6728 0a20 2020          log(.   
-00022750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022760: 2020 2020 2066 2249 7465 6d20 6f6e 2072       f"Item on r
-00022770: 6f77 207b 726f 777d 2064 6f65 7320 6e6f  ow {row} does no
-00022780: 7420 7061 7373 2076 616c 6964 6174 696f  t pass validatio
-00022790: 6e3a 2022 0a20 2020 2020 2020 2020 2020  n: ".           
-000227a0: 2020 2020 2020 2020 2020 2020 202b 204a               + J
-000227b0: 534f 4e2e 7374 7269 6e67 6966 7928 7265  SON.stringify(re
-000227c0: 636f 7264 290a 2020 2020 2020 2020 2020  cord).          
-000227d0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-000227e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000227f0: 7265 7475 726e 0a20 2020 2020 2020 2020  return.         
-00022800: 2020 2020 2020 2072 6563 6f72 642e 7432         record.t2
-00022810: 203d 206d 6178 2872 6563 6f72 642e 7432   = max(record.t2
-00022820: 2c20 7265 636f 7264 2e74 3120 2b20 3129  , record.t1 + 1)
-00022830: 2020 2320 6e6f 2072 756e 6e69 6e67 2072    # no running r
-00022840: 6563 6f72 6473 0a20 2020 2020 2020 2020  ecords.         
-00022850: 2020 2020 2020 2023 2041 7373 6967 6e20         # Assign 
-00022860: 7468 6520 7269 6768 7420 6b65 7920 6261  the right key ba
-00022870: 7365 6420 6f6e 2067 6976 656e 206b 6579  sed on given key
-00022880: 206f 7220 7431 5f74 320a 2020 2020 2020   or t1_t2.      
-00022890: 2020 2020 2020 2020 2020 6966 2072 6563            if rec
-000228a0: 6f72 645f 6b65 7920 6973 206e 6f74 204e  ord_key is not N
-000228b0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-000228c0: 2020 2020 2020 2020 2072 6563 6f72 642e           record.
-000228d0: 6b65 7920 3d20 7265 636f 7264 5f6b 6579  key = record_key
-000228e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000228f0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00022900: 2020 2020 2020 2020 2020 2065 7869 7374             exist
-00022910: 696e 675f 6b65 7920 3d20 7469 6d65 6d61  ing_key = timema
-00022920: 702e 6765 7428 7265 636f 7264 2e74 3120  p.get(record.t1 
-00022930: 2b20 225f 2220 2b20 7265 636f 7264 2e74  + "_" + record.t
-00022940: 322c 204e 6f6e 6529 0a20 2020 2020 2020  2, None).       
-00022950: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00022960: 6578 6973 7469 6e67 5f6b 6579 2069 7320  existing_key is 
-00022970: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+000214b0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000214c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000214d0: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
+000214e0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000214f0: 6561 6465 7220 3d20 7769 6e64 6f77 2e46  eader = window.F
+00021500: 696c 6552 6561 6465 7228 290a 2020 2020  ileReader().    
+00021510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021520: 7265 6164 6572 2e6f 6e6c 6f61 6420 3d20  reader.onload = 
+00021530: 6c61 6d62 6461 3a20 6170 706c 795f 7465  lambda: apply_te
+00021540: 7874 2872 6561 6465 722e 7265 7375 6c74  xt(reader.result
+00021550: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00021560: 2020 2020 2020 7265 6164 6572 2e72 6561        reader.rea
+00021570: 6441 7354 6578 7428 6669 6c65 290a 2020  dAsText(file).  
+00021580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021590: 2020 7365 6c66 2e5f 616e 616c 7973 6973    self._analysis
+000215a0: 5f6f 7574 2e69 6e6e 6572 4854 4d4c 203d  _out.innerHTML =
+000215b0: 2066 2252 6561 6420 6672 6f6d 203c 753e   f"Read from <u>
+000215c0: 7b66 696c 652e 6e61 6d65 7d3c 2f75 3e22  {file.name}</u>"
+000215d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000215e0: 2020 2020 2062 7265 616b 2020 2320 6f6e       break  # on
+000215f0: 6c79 2070 726f 6365 7373 2066 6972 7374  ly process first
+00021600: 206f 6e65 0a0a 2020 2020 6173 796e 6320   one..    async 
+00021610: 6465 6620 646f 5f61 6e61 6c79 7365 2873  def do_analyse(s
+00021620: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+00021630: 2241 6e61 6c79 7a65 2069 6e63 6f6d 696e  "Analyze incomin
+00021640: 6720 6461 7461 202e 2e2e 2222 220a 2020  g data ...""".  
+00021650: 2020 2020 2020 6966 2073 656c 662e 5f61        if self._a
+00021660: 6e61 6c79 7a69 6e67 3a0a 2020 2020 2020  nalyzing:.      
+00021670: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
+00021680: 2020 2020 2020 2320 5072 6570 6172 650a        # Prepare.
+00021690: 2020 2020 2020 2020 7365 6c66 2e5f 616e          self._an
+000216a0: 616c 797a 696e 6720 3d20 5472 7565 0a20  alyzing = True. 
+000216b0: 2020 2020 2020 2073 656c 662e 5f69 6d70         self._imp
+000216c0: 6f72 745f 6275 742e 6469 7361 626c 6564  ort_but.disabled
+000216d0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+000216e0: 7365 6c66 2e5f 696d 706f 7274 5f62 7574  self._import_but
+000216f0: 2e69 6e6e 6572 4854 4d4c 203d 2022 496d  .innerHTML = "Im
+00021700: 706f 7274 220a 2020 2020 2020 2020 7365  port".        se
+00021710: 6c66 2e5f 7265 636f 7264 7332 696d 706f  lf._records2impo
+00021720: 7274 203d 205b 5d0a 2020 2020 2020 2020  rt = [].        
+00021730: 2320 5275 6e0a 2020 2020 2020 2020 7472  # Run.        tr
+00021740: 793a 0a20 2020 2020 2020 2020 2020 2061  y:.            a
+00021750: 7761 6974 2073 656c 662e 5f64 6f5f 616e  wait self._do_an
+00021760: 616c 7973 6528 290a 2020 2020 2020 2020  alyse().        
+00021770: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+00021780: 2061 7320 6572 723a 0a20 2020 2020 2020   as err:.       
+00021790: 2020 2020 2063 6f6e 736f 6c65 2e77 6172       console.war
+000217a0: 6e28 7374 7228 6572 7229 290a 2020 2020  n(str(err)).    
+000217b0: 2020 2020 2320 5265 7374 6f72 650a 2020      # Restore.  
+000217c0: 2020 2020 2020 7365 6c66 2e5f 616e 616c        self._anal
+000217d0: 797a 696e 6720 3d20 4661 6c73 650a 2020  yzing = False.  
+000217e0: 2020 2020 2020 7365 6c66 2e5f 696d 706f        self._impo
+000217f0: 7274 5f62 7574 2e69 6e6e 6572 4854 4d4c  rt_but.innerHTML
+00021800: 203d 2022 496d 706f 7274 220a 2020 2020   = "Import".    
+00021810: 2020 2020 6966 206c 656e 2873 656c 662e      if len(self.
+00021820: 5f72 6563 6f72 6473 3269 6d70 6f72 7429  _records2import)
+00021830: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
+00021840: 2020 7365 6c66 2e5f 696d 706f 7274 5f62    self._import_b
+00021850: 7574 2e64 6973 6162 6c65 6420 3d20 4661  ut.disabled = Fa
+00021860: 6c73 650a 0a20 2020 2061 7379 6e63 2064  lse..    async d
+00021870: 6566 205f 646f 5f61 6e61 6c79 7365 2873  ef _do_analyse(s
+00021880: 656c 6629 3a0a 2020 2020 2020 2020 676c  elf):.        gl
+00021890: 6f62 616c 204a 534f 4e0a 0a20 2020 2020  obal JSON..     
+000218a0: 2020 2064 6566 206c 6f67 2873 293a 0a20     def log(s):. 
+000218b0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000218c0: 5f61 6e61 6c79 7369 735f 6f75 742e 696e  _analysis_out.in
+000218d0: 6e65 7248 544d 4c20 2b3d 2073 202b 2022  nerHTML += s + "
+000218e0: 3c62 7220 2f3e 220a 0a20 2020 2020 2020  <br />"..       
+000218f0: 2023 2049 6e69 740a 2020 2020 2020 2020   # Init.        
+00021900: 7365 6c66 2e5f 616e 616c 7973 6973 5f6f  self._analysis_o
+00021910: 7574 2e69 6e6e 6572 4854 4d4c 203d 2022  ut.innerHTML = "
+00021920: 220a 2020 2020 2020 2020 7465 7874 203d  ".        text =
+00021930: 2073 656c 662e 5f69 6e70 7574 5f65 6c65   self._input_ele
+00021940: 6d65 6e74 2e76 616c 7565 2e6c 7374 7269  ment.value.lstri
+00021950: 7028 290a 2020 2020 2020 2020 6865 6164  p().        head
+00021960: 6572 2c20 7465 7874 203d 2074 6578 742e  er, text = text.
+00021970: 6c73 7472 6970 2829 2e73 706c 6974 2822  lstrip().split("
+00021980: 5c6e 222c 2031 290a 2020 2020 2020 2020  \n", 1).        
+00021990: 6865 6164 6572 203d 2068 6561 6465 722e  header = header.
+000219a0: 7374 7269 7028 290a 2020 2020 2020 2020  strip().        
+000219b0: 7465 7874 203d 2074 6578 7420 6f72 2022  text = text or "
+000219c0: 220a 0a20 2020 2020 2020 2023 2050 6172  "..        # Par
+000219d0: 7365 2068 6561 6465 7220 746f 2067 6574  se header to get
+000219e0: 2073 6570 6174 6f72 0a20 2020 2020 2020   sepator.       
+000219f0: 2073 6570 2c20 7365 706e 616d 652c 2073   sep, sepname, s
+00021a00: 6570 636f 756e 7420 3d20 2222 2c20 2222  epcount = "", ""
+00021a10: 2c20 300a 2020 2020 2020 2020 666f 7220  , 0.        for 
+00021a20: 782c 206e 616d 6520 696e 205b 2822 5c74  x, name in [("\t
+00021a30: 222c 2022 7461 6222 292c 2028 222c 222c  ", "tab"), (",",
+00021a40: 2022 636f 6d6d 6122 292c 2028 223b 222c   "comma"), (";",
+00021a50: 2022 7365 6d69 636f 6c6f 6e22 295d 3a0a   "semicolon")]:.
+00021a60: 2020 2020 2020 2020 2020 2020 6966 2068              if h
+00021a70: 6561 6465 722e 636f 756e 7428 7829 203e  eader.count(x) >
+00021a80: 2073 6570 636f 756e 743a 0a20 2020 2020   sepcount:.     
+00021a90: 2020 2020 2020 2020 2020 2073 6570 2c20             sep, 
+00021aa0: 7365 706e 616d 652c 2073 6570 636f 756e  sepname, sepcoun
+00021ab0: 7420 3d20 782c 206e 616d 652c 2068 6561  t = x, name, hea
+00021ac0: 6465 722e 636f 756e 7428 7829 0a20 2020  der.count(x).   
+00021ad0: 2020 2020 2069 6620 6e6f 7420 6865 6164       if not head
+00021ae0: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
+00021af0: 6c6f 6728 224e 6f20 6461 7461 2229 0a20  log("No data"). 
+00021b00: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00021b10: 6e0a 2020 2020 2020 2020 656c 6966 206e  n.        elif n
+00021b20: 6f74 2073 6570 636f 756e 7420 6f72 206e  ot sepcount or n
+00021b30: 6f74 2073 6570 3a0a 2020 2020 2020 2020  ot sep:.        
+00021b40: 2020 2020 6c6f 6728 2243 6f75 6c64 206e      log("Could n
+00021b50: 6f74 2064 6574 6572 6d69 6e65 2073 6570  ot determine sep
+00021b60: 6172 6174 6f72 2028 7472 6965 6420 7461  arator (tried ta
+00021b70: 622c 2063 6f6d 6d61 2c20 7365 6d69 636f  b, comma, semico
+00021b80: 6c6f 6e29 2229 0a20 2020 2020 2020 2020  lon)").         
+00021b90: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
+00021ba0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00021bb0: 2020 2020 6c6f 6728 224c 6f6f 6b73 206c      log("Looks l
+00021bc0: 696b 6520 7468 6520 7365 7061 7261 746f  ike the separato
+00021bd0: 7220 6973 2022 202b 2073 6570 6e61 6d65  r is " + sepname
+00021be0: 290a 0a20 2020 2020 2020 2023 2047 6574  )..        # Get
+00021bf0: 206d 6170 7069 6e67 2074 6f20 7061 7273   mapping to pars
+00021c00: 6520 6865 6164 6572 206e 616d 6573 0a20  e header names. 
+00021c10: 2020 2020 2020 204d 203d 207b 0a20 2020         M = {.   
+00021c20: 2020 2020 2020 2020 2022 6b65 7922 3a20           "key": 
+00021c30: 5b22 6964 222c 2022 6964 656e 7469 6669  ["id", "identifi
+00021c40: 6572 225d 2c0a 2020 2020 2020 2020 2020  er"],.          
+00021c50: 2020 2270 726f 6a65 6374 6b65 7922 3a20    "projectkey": 
+00021c60: 5b22 7072 6f6a 6563 7420 6b65 7922 2c20  ["project key", 
+00021c70: 2270 726f 6a65 6374 2069 6422 5d2c 0a20  "project id"],. 
+00021c80: 2020 2020 2020 2020 2020 2022 7072 6f6a             "proj
+00021c90: 6563 746e 616d 6522 3a20 5b22 7072 6f6a  ectname": ["proj
+00021ca0: 6563 7422 2c20 2270 7222 2c20 2270 726f  ect", "pr", "pro
+00021cb0: 6a22 2c20 2270 726f 6a65 6374 206e 616d  j", "project nam
+00021cc0: 6522 5d2c 0a20 2020 2020 2020 2020 2020  e"],.           
+00021cd0: 2022 7461 6773 223a 205b 2274 6167 7322   "tags": ["tags"
+00021ce0: 2c20 2274 6167 225d 2c0a 2020 2020 2020  , "tag"],.      
+00021cf0: 2020 2020 2020 2274 3122 3a20 5b22 7374        "t1": ["st
+00021d00: 6172 7422 2c20 2262 6567 696e 222c 2022  art", "begin", "
+00021d10: 7374 6172 7420 7469 6d65 222c 2022 6265  start time", "be
+00021d20: 6769 6e20 7469 6d65 225d 2c0a 2020 2020  gin time"],.    
+00021d30: 2020 2020 2020 2020 2274 3222 3a20 5b22          "t2": ["
+00021d40: 7374 6f70 222c 2022 656e 6422 2c20 2273  stop", "end", "s
+00021d50: 746f 7020 7469 6d65 222c 2022 656e 6420  top time", "end 
+00021d60: 7469 6d65 225d 2c0a 2020 2020 2020 2020  time"],.        
+00021d70: 2020 2020 2264 6573 6372 6970 7469 6f6e      "description
+00021d80: 223a 205b 2273 756d 6d61 7279 222c 2022  ": ["summary", "
+00021d90: 636f 6d6d 656e 7422 2c20 2274 6974 6c65  comment", "title
+00021da0: 222c 2022 6473 225d 2c0a 2020 2020 2020  ", "ds"],.      
+00021db0: 2020 2020 2020 2270 726f 6a65 6374 7061        "projectpa
+00021dc0: 7468 223a 205b 2270 726f 6a65 6374 2070  th": ["project p
+00021dd0: 6174 6822 5d2c 0a20 2020 2020 2020 2020  ath"],.         
+00021de0: 2020 2022 6461 7465 223a 205b 5d2c 0a20     "date": [],. 
+00021df0: 2020 2020 2020 2020 2020 2022 6475 7261             "dura
+00021e00: 7469 6f6e 223a 205b 0a20 2020 2020 2020  tion": [.       
+00021e10: 2020 2020 2020 2020 2022 6475 7261 7469           "durati
+00021e20: 6f6e 2068 3a6d 222c 0a20 2020 2020 2020  on h:m",.       
+00021e30: 2020 2020 2020 2020 2022 6475 7261 7469           "durati
+00021e40: 6f6e 2068 3a6d 3a73 222c 0a20 2020 2020  on h:m:s",.     
+00021e50: 2020 2020 2020 2020 2020 2022 6475 7261             "dura
+00021e60: 7469 6f6e 2068 683a 6d6d 222c 0a20 2020  tion hh:mm",.   
+00021e70: 2020 2020 2020 2020 2020 2020 2022 6475               "du
+00021e80: 7261 7469 6f6e 2068 683a 6d6d 3a73 7322  ration hh:mm:ss"
+00021e90: 2c0a 2020 2020 2020 2020 2020 2020 5d2c  ,.            ],
+00021ea0: 0a20 2020 2020 2020 207d 0a20 2020 2020  .        }.     
+00021eb0: 2020 206e 616d 656d 6170 203d 207b 7d0a     namemap = {}.
+00021ec0: 2020 2020 2020 2020 666f 7220 6b65 792c          for key,
+00021ed0: 206f 7074 696f 6e73 2069 6e20 4d2e 6974   options in M.it
+00021ee0: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
+00021ef0: 2020 206e 616d 656d 6170 5b6b 6579 5d20     namemap[key] 
+00021f00: 3d20 6b65 790a 2020 2020 2020 2020 2020  = key.          
+00021f10: 2020 666f 7220 7820 696e 206f 7074 696f    for x in optio
+00021f20: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
+00021f30: 2020 2020 6e61 6d65 6d61 705b 785d 203d      namemap[x] =
+00021f40: 206b 6579 0a0a 2020 2020 2020 2020 2320   key..        # 
+00021f50: 5061 7273 6520 6865 6164 6572 2074 6f20  Parse header to 
+00021f60: 6765 7420 6e61 6d65 730a 2020 2020 2020  get names.      
+00021f70: 2020 6865 6164 6572 7061 7274 7331 203d    headerparts1 =
+00021f80: 2063 7376 7370 6c69 7428 6865 6164 6572   csvsplit(header
+00021f90: 2c20 7365 7029 5b30 5d0a 2020 2020 2020  , sep)[0].      
+00021fa0: 2020 6865 6164 6572 7061 7274 7332 203d    headerparts2 =
+00021fb0: 205b 5d0a 2020 2020 2020 2020 6865 6164   [].        head
+00021fc0: 6572 7061 7274 735f 756e 6b6e 6f77 6e20  erparts_unknown 
+00021fd0: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
+00021fe0: 206e 616d 6520 696e 2068 6561 6465 7270   name in headerp
+00021ff0: 6172 7473 313a 0a20 2020 2020 2020 2020  arts1:.         
+00022000: 2020 206e 616d 6520 3d20 6e61 6d65 2e6c     name = name.l
+00022010: 6f77 6572 2829 2e72 6570 6c61 6365 2822  ower().replace("
+00022020: 2d22 2c20 2220 2229 2e72 6570 6c61 6365  -", " ").replace
+00022030: 2822 5f22 2c20 2220 2229 0a20 2020 2020  ("_", " ").     
+00022040: 2020 2020 2020 2069 6620 6e61 6d65 2069         if name i
+00022050: 6e20 6e61 6d65 6d61 703a 0a20 2020 2020  n namemap:.     
+00022060: 2020 2020 2020 2020 2020 2068 6561 6465             heade
+00022070: 7270 6172 7473 322e 6170 7065 6e64 286e  rparts2.append(n
+00022080: 616d 656d 6170 5b6e 616d 655d 290a 2020  amemap[name]).  
+00022090: 2020 2020 2020 2020 2020 656c 6966 206e            elif n
+000220a0: 6f74 206e 616d 653a 0a20 2020 2020 2020  ot name:.       
+000220b0: 2020 2020 2020 2020 2068 6561 6465 7270           headerp
+000220c0: 6172 7473 322e 6170 7065 6e64 284e 6f6e  arts2.append(Non
+000220d0: 6529 0a20 2020 2020 2020 2020 2020 2065  e).            e
+000220e0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000220f0: 2020 2020 2068 6561 6465 7270 6172 7473       headerparts
+00022100: 5f75 6e6b 6e6f 776e 2e61 7070 656e 6428  _unknown.append(
+00022110: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
+00022120: 2020 2020 2020 6865 6164 6572 7061 7274        headerpart
+00022130: 7332 2e61 7070 656e 6428 4e6f 6e65 290a  s2.append(None).
+00022140: 2020 2020 2020 2020 7768 696c 6520 6865          while he
+00022150: 6164 6572 7061 7274 7332 2061 6e64 2068  aderparts2 and h
+00022160: 6561 6465 7270 6172 7473 325b 2d31 5d20  eaderparts2[-1] 
+00022170: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00022180: 2020 2020 2068 6561 6465 7270 6172 7473       headerparts
+00022190: 322e 706f 7028 2d31 290a 2020 2020 2020  2.pop(-1).      
+000221a0: 2020 6966 2068 6561 6465 7270 6172 7473    if headerparts
+000221b0: 5f75 6e6b 6e6f 776e 3a0a 2020 2020 2020  _unknown:.      
+000221c0: 2020 2020 2020 6c6f 6728 2249 676e 6f72        log("Ignor
+000221d0: 696e 6720 736f 6d65 2068 6561 6465 7273  ing some headers
+000221e0: 3a20 2220 2b20 6865 6164 6572 7061 7274  : " + headerpart
+000221f0: 735f 756e 6b6e 6f77 6e2e 6a6f 696e 2822  s_unknown.join("
+00022200: 2c20 2229 290a 2020 2020 2020 2020 656c  , ")).        el
+00022210: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00022220: 6c6f 6728 2241 6c6c 2068 6561 6465 7273  log("All headers
+00022230: 206e 616d 6573 2072 6563 6f67 6e69 7a65   names recognize
+00022240: 6422 290a 0a20 2020 2020 2020 2023 2041  d")..        # A
+00022250: 6c6c 2072 6571 7569 7265 6420 6e61 6d65  ll required name
+00022260: 7320 6865 6164 6572 7320 7072 6573 656e  s headers presen
+00022270: 743f 0a20 2020 2020 2020 2069 6620 2274  t?.        if "t
+00022280: 3122 206e 6f74 2069 6e20 6865 6164 6572  1" not in header
+00022290: 7061 7274 7332 3a0a 2020 2020 2020 2020  parts2:.        
+000222a0: 2020 2020 6c6f 6728 224d 6973 7369 6e67      log("Missing
+000222b0: 2072 6571 7569 7265 6420 6865 6164 6572   required header
+000222c0: 2066 6f72 2073 7461 7274 2074 696d 652e   for start time.
+000222d0: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
+000222e0: 6574 7572 6e0a 2020 2020 2020 2020 656c  eturn.        el
+000222f0: 6966 2022 7432 2220 6e6f 7420 696e 2068  if "t2" not in h
+00022300: 6561 6465 7270 6172 7473 3220 616e 6420  eaderparts2 and 
+00022310: 2264 7572 6174 696f 6e22 206e 6f74 2069  "duration" not i
+00022320: 6e20 6865 6164 6572 7061 7274 7332 3a0a  n headerparts2:.
+00022330: 2020 2020 2020 2020 2020 2020 6c6f 6728              log(
+00022340: 224d 6973 7369 6e67 2072 6571 7569 7265  "Missing require
+00022350: 6420 6865 6164 6572 2066 6f72 2073 746f  d header for sto
+00022360: 7020 7469 6d65 206f 7220 6475 7261 7469  p time or durati
+00022370: 6f6e 2e22 290a 2020 2020 2020 2020 2020  on.").          
+00022380: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
+00022390: 2020 2320 4765 7420 6469 6374 2074 6f20    # Get dict to 
+000223a0: 6d61 7020 2874 312c 2074 3229 2074 6f20  map (t1, t2) to 
+000223b0: 7265 636f 7264 206b 6579 0a20 2020 2020  record key.     
+000223c0: 2020 2074 696d 656d 6170 203d 207b 7d20     timemap = {} 
+000223d0: 2023 2074 315f 7432 202d 3e20 6b65 790a   # t1_t2 -> key.
+000223e0: 2020 2020 2020 2020 666f 7220 6b65 792c          for key,
+000223f0: 2072 6563 6f72 6420 696e 2077 696e 646f   record in windo
+00022400: 772e 7374 6f72 652e 7265 636f 7264 732e  w.store.records.
+00022410: 5f69 7465 6d73 2e69 7465 6d73 2829 3a0a  _items.items():.
+00022420: 2020 2020 2020 2020 2020 2020 7469 6d65              time
+00022430: 6d61 705b 7265 636f 7264 2e74 3120 2b20  map[record.t1 + 
+00022440: 225f 2220 2b20 7265 636f 7264 2e74 325d  "_" + record.t2]
+00022450: 203d 206b 6579 0a0a 2020 2020 2020 2020   = key..        
+00022460: 2320 4e6f 7720 7061 7273 6521 0a20 2020  # Now parse!.   
+00022470: 2020 2020 2079 6561 725f 7061 7374 5f65       year_past_e
+00022480: 706f 6368 203d 2033 3135 3336 3030 3020  poch = 31536000 
+00022490: 2023 2053 6f20 7765 2063 616e 2074 6573   # So we can tes
+000224a0: 7420 7468 6174 2061 2074 696d 6573 7461  t that a timesta
+000224b0: 6d70 2069 7320 6e6f 7420 6120 6868 2e6d  mp is not a hh.m
+000224c0: 6d0a 2020 2020 2020 2020 7265 636f 7264  m.        record
+000224d0: 7320 3d20 5b5d 0a20 2020 2020 2020 206e  s = [].        n
+000224e0: 6577 5f72 6563 6f72 645f 636f 756e 7420  ew_record_count 
+000224f0: 3d20 300a 2020 2020 2020 2020 696e 6465  = 0.        inde
+00022500: 7820 3d20 300a 2020 2020 2020 2020 726f  x = 0.        ro
+00022510: 7720 3d20 300a 2020 2020 2020 2020 7768  w = 0.        wh
+00022520: 696c 6520 696e 6465 7820 3c20 6c65 6e28  ile index < len(
+00022530: 7465 7874 293a 0a20 2020 2020 2020 2020  text):.         
+00022540: 2020 2072 6f77 202b 3d20 310a 2020 2020     row += 1.    
+00022550: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00022560: 2020 2020 2020 2020 2020 2020 2023 2047               # G
+00022570: 6574 2070 6172 7473 206f 6e20 7468 6973  et parts on this
+00022580: 2072 6f77 0a20 2020 2020 2020 2020 2020   row.           
+00022590: 2020 2020 206c 696e 6570 6172 7473 2c20       lineparts, 
+000225a0: 696e 6465 7820 3d20 6373 7673 706c 6974  index = csvsplit
+000225b0: 2874 6578 742c 2073 6570 2c20 696e 6465  (text, sep, inde
+000225c0: 7829 0a20 2020 2020 2020 2020 2020 2020  x).             
+000225d0: 2020 2069 6620 6c65 6e28 2222 2e6a 6f69     if len("".joi
+000225e0: 6e28 6c69 6e65 7061 7274 7329 2e74 7269  n(lineparts).tri
+000225f0: 6d28 2929 203d 3d20 303a 0a20 2020 2020  m()) == 0:.     
+00022600: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00022610: 6f6e 7469 6e75 6520 2023 2073 6b69 7020  ontinue  # skip 
+00022620: 656d 7074 7920 726f 7773 0a20 2020 2020  empty rows.     
+00022630: 2020 2020 2020 2020 2020 2023 2042 7569             # Bui
+00022640: 6c64 2072 6177 206f 626a 6563 740a 2020  ld raw object.  
+00022650: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+00022660: 7720 3d20 7b7d 0a20 2020 2020 2020 2020  w = {}.         
+00022670: 2020 2020 2020 2066 6f72 206a 2069 6e20         for j in 
+00022680: 7261 6e67 6528 6d69 6e28 6c65 6e28 6c69  range(min(len(li
+00022690: 6e65 7061 7274 7329 2c20 6c65 6e28 6865  neparts), len(he
+000226a0: 6164 6572 7061 7274 7332 2929 293a 0a20  aderparts2))):. 
+000226b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000226c0: 2020 206b 6579 203d 2068 6561 6465 7270     key = headerp
+000226d0: 6172 7473 325b 6a5d 0a20 2020 2020 2020  arts2[j].       
+000226e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000226f0: 6b65 7920 6973 206e 6f74 204e 6f6e 653a  key is not None:
+00022700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022710: 2020 2020 2020 2020 2072 6177 5b6b 6579           raw[key
+00022720: 5d20 3d20 6c69 6e65 7061 7274 735b 6a5d  ] = lineparts[j]
+00022730: 2e73 7472 6970 2829 0a20 2020 2020 2020  .strip().       
+00022740: 2020 2020 2020 2020 2072 6177 2e6d 6f72           raw.mor
+00022750: 6520 3d20 6c69 6e65 7061 7274 735b 6c65  e = lineparts[le
+00022760: 6e28 6865 6164 6572 7061 7274 7332 2920  n(headerparts2) 
+00022770: 3a5d 0a20 2020 2020 2020 2020 2020 2020  :].             
+00022780: 2020 2023 2042 7569 6c64 2072 6563 6f72     # Build recor
+00022790: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
+000227a0: 2020 7265 636f 7264 203d 2077 696e 646f    record = windo
+000227b0: 772e 7374 6f72 652e 7265 636f 7264 732e  w.store.records.
+000227c0: 6372 6561 7465 2830 2c20 3029 0a20 2020  create(0, 0).   
+000227d0: 2020 2020 2020 2020 2020 2020 2072 6563               rec
+000227e0: 6f72 645f 6b65 7920 3d20 4e6f 6e65 0a20  ord_key = None. 
+000227f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00022800: 6620 7261 772e 6b65 793a 0a20 2020 2020  f raw.key:.     
+00022810: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00022820: 6563 6f72 645f 6b65 7920 3d20 7261 772e  ecord_key = raw.
+00022830: 6b65 7920 2023 2064 6f6e 7420 7374 6f72  key  # dont stor
+00022840: 6520 6174 2072 6563 6f72 6420 7965 740a  e at record yet.
+00022850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022860: 6966 2072 6177 2e64 6174 653a 0a20 2020  if raw.date:.   
+00022870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022880: 2023 2050 7265 7020 6461 7465 2e20 5375   # Prep date. Su
+00022890: 7070 6f72 7420 626f 7468 2064 642d 6d6d  pport both dd-mm
+000228a0: 2d79 7979 7920 616e 6420 7979 792d 6d6d  -yyyy and yyy-mm
+000228b0: 2d64 640a 2020 2020 2020 2020 2020 2020  -dd.            
+000228c0: 2020 2020 2020 2020 6461 7465 203d 2072          date = r
+000228d0: 6177 2e64 6174 652e 7265 706c 6163 6528  aw.date.replace(
+000228e0: 222e 222c 2022 2d22 2920 2023 2053 6f6d  ".", "-")  # Som
+000228f0: 6520 746f 6f6c 7320 7573 6520 646f 7473  e tools use dots
+00022900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022910: 2020 2020 2069 6620 6c65 6e28 6461 7465       if len(date
+00022920: 2920 3d3d 2031 3020 616e 6420 6461 7465  ) == 10 and date
+00022930: 2e63 6f75 6e74 2822 2d22 2920 3d3d 2032  .count("-") == 2
+00022940: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00022950: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00022960: 2864 6174 652e 7370 6c69 7428 222d 2229  (date.split("-")
+00022970: 5b2d 315d 2920 3d3d 2034 3a0a 2020 2020  [-1]) == 4:.    
 00022980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022990: 2020 7265 636f 7264 2e6b 6579 203d 2065    record.key = e
-000229a0: 7869 7374 696e 675f 6b65 790a 2020 2020  xisting_key.    
-000229b0: 2020 2020 2020 2020 2020 2020 2320 4164              # Ad
-000229c0: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
-000229d0: 2020 7265 636f 7264 732e 6170 7065 6e64    records.append
-000229e0: 2872 6563 6f72 6429 0a20 2020 2020 2020  (record).       
-000229f0: 2020 2020 2020 2020 2069 6620 7769 6e64           if wind
-00022a00: 6f77 2e73 746f 7265 2e72 6563 6f72 6473  ow.store.records
-00022a10: 2e67 6574 5f62 795f 6b65 7928 7265 636f  .get_by_key(reco
-00022a20: 7264 2e6b 6579 2920 6973 204e 6f6e 653a  rd.key) is None:
-00022a30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022a40: 2020 2020 206e 6577 5f72 6563 6f72 645f       new_record_
-00022a50: 636f 756e 7420 2b3d 2031 0a20 2020 2020  count += 1.     
-00022a60: 2020 2020 2020 2020 2020 2023 204b 6565             # Kee
-00022a70: 7020 6769 7669 6e67 2066 6565 6462 6163  p giving feedbac
-00022a80: 6b20 2f20 646f 6e74 2066 7265 657a 650a  k / dont freeze.
-00022a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022aa0: 6966 2072 6f77 2025 2031 3030 203d 3d20  if row % 100 == 
-00022ab0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-00022ac0: 2020 2020 2020 2073 656c 662e 5f69 6d70         self._imp
-00022ad0: 6f72 745f 6275 742e 696e 6e65 7248 544d  ort_but.innerHTM
-00022ae0: 4c20 3d20 6622 466f 756e 6420 7b6c 656e  L = f"Found {len
-00022af0: 2872 6563 6f72 6473 297d 2072 6563 6f72  (records)} recor
-00022b00: 6473 220a 2020 2020 2020 2020 2020 2020  ds".            
-00022b10: 2020 2020 2020 2020 6177 6169 7420 7769          await wi
-00022b20: 6e64 6f77 2e74 6f6f 6c73 2e73 6c65 6570  ndow.tools.sleep
-00022b30: 6d73 2831 290a 2020 2020 2020 2020 2020  ms(1).          
-00022b40: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
-00022b50: 6f6e 2061 7320 6572 723a 0a20 2020 2020  on as err:.     
-00022b60: 2020 2020 2020 2020 2020 206c 6f67 2866             log(f
-00022b70: 2245 7272 6f72 2061 7420 726f 7720 7b72  "Error at row {r
-00022b80: 6f77 7d3a 207b 6572 727d 2229 0a20 2020  ow}: {err}").   
-00022b90: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00022ba0: 7572 6e0a 0a20 2020 2020 2020 2023 2053  urn..        # S
-00022bb0: 746f 7265 2061 6e64 2067 6976 6520 7375  tore and give su
-00022bc0: 6d6d 6172 790a 2020 2020 2020 2020 7365  mmary.        se
-00022bd0: 6c66 2e5f 7265 636f 7264 7332 696d 706f  lf._records2impo
-00022be0: 7274 203d 2072 6563 6f72 6473 0a20 2020  rt = records.   
-00022bf0: 2020 2020 206c 6f67 2866 2246 6f75 6e64       log(f"Found
-00022c00: 207b 6c65 6e28 7265 636f 7264 7329 7d20   {len(records)} 
-00022c10: 287b 6e65 775f 7265 636f 7264 5f63 6f75  ({new_record_cou
-00022c20: 6e74 7d20 6e65 7729 2229 0a0a 2020 2020  nt} new)")..    
-00022c30: 6465 6620 646f 5f69 6d70 6f72 7428 7365  def do_import(se
-00022c40: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-00022c50: 446f 2074 6865 2069 6d70 6f72 7421 2222  Do the import!""
-00022c60: 220a 2020 2020 2020 2020 7769 6e64 6f77  ".        window
-00022c70: 2e73 746f 7265 2e72 6563 6f72 6473 2e70  .store.records.p
-00022c80: 7574 282a 7365 6c66 2e5f 7265 636f 7264  ut(*self._record
-00022c90: 7332 696d 706f 7274 290a 2020 2020 2020  s2import).      
-00022ca0: 2020 7365 6c66 2e5f 7265 636f 7264 7332    self._records2
-00022cb0: 696d 706f 7274 203d 205b 5d0a 2020 2020  import = [].    
-00022cc0: 2020 2020 7365 6c66 2e5f 696d 706f 7274      self._import
-00022cd0: 5f62 7574 2e64 6973 6162 6c65 6420 3d20  _but.disabled = 
-00022ce0: 5472 7565 0a20 2020 2020 2020 2073 656c  True.        sel
-00022cf0: 662e 5f69 6d70 6f72 745f 6275 742e 696e  f._import_but.in
-00022d00: 6e65 7248 544d 4c20 3d20 2249 6d70 6f72  nerHTML = "Impor
-00022d10: 7420 646f 6e65 220a 0a0a 636c 6173 7320  t done"...class 
-00022d20: 5365 7474 696e 6773 4469 616c 6f67 2842  SettingsDialog(B
-00022d30: 6173 6544 6961 6c6f 6729 3a0a 2020 2020  aseDialog):.    
-00022d40: 2222 2244 6961 6c6f 6720 746f 2063 6861  """Dialog to cha
-00022d50: 6e67 6520 7573 6572 2073 6574 7469 6e67  nge user setting
-00022d60: 732e 2222 220a 0a20 2020 2064 6566 205f  s."""..    def _
-00022d70: 5f69 6e69 745f 5f28 7365 6c66 2c20 6361  _init__(self, ca
-00022d80: 6e76 6173 293a 0a20 2020 2020 2020 2073  nvas):.        s
-00022d90: 7570 6572 2829 2e5f 5f69 6e69 745f 5f28  uper().__init__(
-00022da0: 6361 6e76 6173 290a 0a20 2020 2064 6566  canvas)..    def
-00022db0: 206f 7065 6e28 7365 6c66 2c20 6361 6c6c   open(self, call
-00022dc0: 6261 636b 3d4e 6f6e 6529 3a0a 2020 2020  back=None):.    
-00022dd0: 2020 2020 2320 4765 7420 7368 6f72 7463      # Get shortc
-00022de0: 7574 7320 6874 6d6c 0a20 2020 2020 2020  uts html.       
-00022df0: 2073 686f 7274 6375 7473 203d 207b 0a20   shortcuts = {. 
-00022e00: 2020 2020 2020 2020 2020 2022 5f64 6961             "_dia
-00022e10: 6c6f 6773 223a 2022 3c62 3e49 6e20 6469  logs": "<b>In di
-00022e20: 616c 6f67 733c 2f62 3e22 2c0a 2020 2020  alogs</b>",.    
-00022e30: 2020 2020 2020 2020 2245 6e74 6572 223a          "Enter":
-00022e40: 2022 5375 626d 6974 2064 6961 6c6f 6722   "Submit dialog"
-00022e50: 2c0a 2020 2020 2020 2020 2020 2020 2245  ,.            "E
-00022e60: 7363 6170 6522 3a20 2243 6c6f 7365 2064  scape": "Close d
-00022e70: 6961 6c6f 6722 2c0a 2020 2020 2020 2020  ialog",.        
-00022e80: 2020 2020 225f 6e61 7622 3a20 223c 623e      "_nav": "<b>
-00022e90: 4e61 7669 6761 7469 6f6e 3c2f 623e 222c  Navigation</b>",
-00022ea0: 0a20 2020 2020 2020 2020 2020 2022 4e2f  .            "N/
-00022eb0: 486f 6d65 2f45 6e64 223a 2022 536e 6170  Home/End": "Snap
-00022ec0: 2074 6f20 6e6f 7722 2c0a 2020 2020 2020   to now",.      
-00022ed0: 2020 2020 2020 2244 223a 2022 5365 6c65        "D": "Sele
-00022ee0: 6374 2074 6f64 6179 222c 0a20 2020 2020  ct today",.     
-00022ef0: 2020 2020 2020 2022 5722 3a20 2253 656c         "W": "Sel
-00022f00: 6563 7420 7468 6973 2077 6565 6b22 2c0a  ect this week",.
-00022f10: 2020 2020 2020 2020 2020 2020 224d 223a              "M":
-00022f20: 2022 5365 6c65 6374 2074 6869 7320 6d6f   "Select this mo
-00022f30: 6e74 6822 2c0a 2020 2020 2020 2020 2020  nth",.          
-00022f40: 2020 22e2 8691 2f50 6167 6555 7022 3a20    ".../PageUp": 
-00022f50: 2253 7465 7020 6261 636b 2069 6e20 7469  "Step back in ti
-00022f60: 6d65 222c 0a20 2020 2020 2020 2020 2020  me",.           
-00022f70: 2022 e286 932f 5061 6765 446f 776e 223a   ".../PageDown":
-00022f80: 2022 5374 6570 2066 6f72 7761 7264 2069   "Step forward i
-00022f90: 6e20 7469 6d65 222c 0a20 2020 2020 2020  n time",.       
-00022fa0: 2020 2020 2022 e286 9222 3a20 225a 6f6f       "...": "Zoo
-00022fb0: 6d20 696e 222c 0a20 2020 2020 2020 2020  m in",.         
-00022fc0: 2020 2022 e286 9022 3a20 225a 6f6f 6d20     "...": "Zoom 
-00022fd0: 6f75 7422 2c0a 2020 2020 2020 2020 2020  out",.          
-00022fe0: 2020 225f 6f74 6865 7222 3a20 223c 623e    "_other": "<b>
-00022ff0: 4f74 6865 723c 2f62 3e22 2c0a 2020 2020  Other</b>",.    
-00023000: 2020 2020 2020 2020 2253 223a 2022 5374          "S": "St
-00023010: 6172 7420 7468 6520 7469 6d65 7220 6f72  art the timer or
-00023020: 2061 6464 2061 6e20 6561 726c 6965 7220   add an earlier 
-00023030: 7265 636f 7264 222c 0a20 2020 2020 2020  record",.       
-00023040: 2020 2020 2022 5368 6966 742b 5322 3a20       "Shift+S": 
-00023050: 2252 6573 756d 6520 7468 6520 6375 7272  "Resume the curr
-00023060: 656e 742f 7072 6576 696f 7573 2072 6563  ent/previous rec
-00023070: 6f72 6422 2c0a 2020 2020 2020 2020 2020  ord",.          
-00023080: 2020 2258 223a 2022 5374 6f70 2074 6865    "X": "Stop the
-00023090: 2074 696d 6572 222c 0a20 2020 2020 2020   timer",.       
-000230a0: 2020 2020 2022 5422 3a20 2253 656c 6563       "T": "Selec
-000230b0: 7420 7469 6d65 2072 616e 6765 222c 0a20  t time range",. 
-000230c0: 2020 2020 2020 2020 2020 2022 5222 3a20             "R": 
-000230d0: 224f 7065 6e20 7265 706f 7274 2064 6961  "Open report dia
-000230e0: 6c6f 6722 2c0a 2020 2020 2020 2020 2020  log",.          
-000230f0: 2020 2249 223a 2022 4f70 656e 2074 6865    "I": "Open the
-00023100: 2067 7569 6465 222c 0a20 2020 2020 2020   guide",.       
-00023110: 207d 0a20 2020 2020 2020 2073 686f 7274   }.        short
-00023120: 6375 7473 5f68 746d 6c20 3d20 2222 0a20  cuts_html = "". 
-00023130: 2020 2020 2020 2066 6f72 206b 6579 2c20         for key, 
-00023140: 6578 706c 2069 6e20 7368 6f72 7463 7574  expl in shortcut
-00023150: 732e 6974 656d 7328 293a 0a20 2020 2020  s.items():.     
-00023160: 2020 2020 2020 2069 6620 6b65 792e 7374         if key.st
-00023170: 6172 7473 7769 7468 2822 5f22 293a 0a20  artswith("_"):. 
-00023180: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-00023190: 6579 203d 2022 220a 2020 2020 2020 2020  ey = "".        
-000231a0: 2020 2020 7368 6f72 7463 7574 735f 6874      shortcuts_ht
-000231b0: 6d6c 202b 3d20 6622 3c64 6976 2063 6c61  ml += f"<div cla
-000231c0: 7373 3d27 6d6f 6e6f 7370 6163 6527 3e7b  ss='monospace'>{
-000231d0: 6b65 797d 3c2f 6469 763e 3c64 6976 3e7b  key}</div><div>{
-000231e0: 6578 706c 7d3c 2f64 6976 3e22 0a0a 2020  expl}</div>"..  
-000231f0: 2020 2020 2020 6874 6d6c 203d 2066 2222        html = f""
-00023200: 220a 2020 2020 2020 2020 2020 2020 3c68  ".            <h
-00023210: 313e 3c69 2063 6c61 7373 3d27 6661 7327  1><i class='fas'
-00023220: 3e5c 7566 3031 333c 2f69 3e26 6e62 7370  >\uf013</i>&nbsp
-00023230: 3b26 6e62 7370 3b53 6574 7469 6e67 730a  ;&nbsp;Settings.
-00023240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023250: 3c62 7574 746f 6e20 7479 7065 3d27 6275  <button type='bu
-00023260: 7474 6f6e 273e 3c69 2063 6c61 7373 3d27  tton'><i class='
-00023270: 6661 7327 3e5c 7566 3030 643c 2f69 3e3c  fas'>\uf00d</i><
-00023280: 2f62 7574 746f 6e3e 0a20 2020 2020 2020  /button>.       
-00023290: 2020 2020 203c 2f68 313e 0a0a 2020 2020       </h1>..    
-000232a0: 2020 2020 2020 2020 3c63 656e 7465 7220          <center 
-000232b0: 7374 796c 653d 2766 6f6e 742d 7369 7a65  style='font-size
-000232c0: 3a38 3025 273e 5573 6572 2073 6574 7469  :80%'>User setti
-000232d0: 6e67 733c 2f63 656e 7465 723e 0a20 2020  ngs</center>.   
-000232e0: 2020 2020 2020 2020 203c 6832 3e3c 6920           <h2><i 
-000232f0: 636c 6173 733d 2766 6173 273e 5c75 6634  class='fas'>\uf4
-00023300: 6664 3c2f 693e 266e 6273 703b 266e 6273  fd</i>&nbsp;&nbs
-00023310: 703b 5469 6d65 2072 6570 7265 7365 6e74  p;Time represent
-00023320: 6174 696f 6e3c 2f68 323e 0a20 2020 2020  ation</h2>.     
-00023330: 2020 2020 2020 203c 6469 7620 636c 6173         <div clas
-00023340: 733d 2766 6f72 6d6c 6179 6f75 7427 3e0a  s='formlayout'>.
-00023350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023360: 3c64 6976 3e57 6565 6b20 7374 6172 7473  <div>Week starts
-00023370: 206f 6e3a 3c2f 6469 763e 0a20 2020 2020   on:</div>.     
-00023380: 2020 2020 2020 2020 2020 203c 7365 6c65             <sele
-00023390: 6374 3e0a 2020 2020 2020 2020 2020 2020  ct>.            
-000233a0: 2020 2020 2020 2020 3c6f 7074 696f 6e20          <option 
-000233b0: 7661 6c75 653d 2730 273e 5375 6e64 6179  value='0'>Sunday
-000233c0: 3c2f 6f70 7469 6f6e 3e0a 2020 2020 2020  </option>.      
-000233d0: 2020 2020 2020 2020 2020 2020 2020 3c6f                <o
-000233e0: 7074 696f 6e20 7661 6c75 653d 2731 273e  ption value='1'>
-000233f0: 4d6f 6e64 6179 3c2f 6f70 7469 6f6e 3e0a  Monday</option>.
-00023400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023410: 2020 2020 3c6f 7074 696f 6e20 7661 6c75      <option valu
-00023420: 653d 2736 273e 5361 7475 7264 6179 3c2f  e='6'>Saturday</
-00023430: 6f70 7469 6f6e 3e0a 2020 2020 2020 2020  option>.        
-00023440: 2020 2020 2020 2020 3c2f 7365 6c65 6374          </select
-00023450: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
-00023460: 2020 3c64 6976 3e53 686f 7720 7469 6d65    <div>Show time
-00023470: 2061 733a 3c2f 6469 763e 0a20 2020 2020   as:</div>.     
-00023480: 2020 2020 2020 2020 2020 203c 7365 6c65             <sele
-00023490: 6374 3e0a 2020 2020 2020 2020 2020 2020  ct>.            
-000234a0: 2020 2020 2020 2020 3c6f 7074 696f 6e20          <option 
-000234b0: 7661 6c75 653d 2761 7574 6f27 3e41 7574  value='auto'>Aut
-000234c0: 6f3c 2f6f 7074 696f 6e3e 0a20 2020 2020  o</option>.     
-000234d0: 2020 2020 2020 2020 2020 2020 2020 203c                 <
-000234e0: 6f70 7469 6f6e 2076 616c 7565 3d27 3234  option value='24
-000234f0: 6827 3e32 333a 3230 3c2f 6f70 7469 6f6e  h'>23:20</option
-00023500: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
-00023510: 2020 2020 2020 3c6f 7074 696f 6e20 7661        <option va
-00023520: 6c75 653d 2761 6d70 6d27 3e31 313a 3230  lue='ampm'>11:20
-00023530: 2070 6d3c 2f6f 7074 696f 6e3e 0a20 2020   pm</option>.   
-00023540: 2020 2020 2020 2020 2020 2020 203c 2f73               </s
-00023550: 656c 6563 743e 0a20 2020 2020 2020 2020  elect>.         
-00023560: 2020 2020 2020 203c 6469 763e 5368 6f77         <div>Show
-00023570: 2064 7572 6174 696f 6e20 6173 3a3c 2f64   duration as:</d
-00023580: 6976 3e0a 2020 2020 2020 2020 2020 2020  iv>.            
-00023590: 2020 2020 3c73 656c 6563 743e 0a20 2020      <select>.   
-000235a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000235b0: 203c 6f70 7469 6f6e 2076 616c 7565 3d27   <option value='
-000235c0: 6468 6d73 273e 3164 3368 3230 6d3c 2f6f  dhms'>1d3h20m</o
-000235d0: 7074 696f 6e3e 0a20 2020 2020 2020 2020  ption>.         
-000235e0: 2020 2020 2020 2020 2020 203c 6f70 7469             <opti
-000235f0: 6f6e 2076 616c 7565 3d27 686d 7327 3e32  on value='hms'>2
-00023600: 3768 3230 6d3c 2f6f 7074 696f 6e3e 0a20  7h20m</option>. 
-00023610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023620: 2020 203c 6f70 7469 6f6e 2076 616c 7565     <option value
-00023630: 3d27 636f 6c6f 6e27 3e32 373a 3230 3c2f  ='colon'>27:20</
-00023640: 6f70 7469 6f6e 3e0a 2020 2020 2020 2020  option>.        
-00023650: 2020 2020 2020 2020 3c2f 7365 6c65 6374          </select
-00023660: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
-00023670: 2020 3c64 6976 3e54 6f64 6179 2073 7461    <div>Today sta
-00023680: 7274 7320 6174 3a3c 2f64 6976 3e0a 2020  rts at:</div>.  
-00023690: 2020 2020 2020 2020 2020 2020 2020 3c73                <s
-000236a0: 656c 6563 743e 0a20 2020 2020 2020 2020  elect>.         
-000236b0: 2020 2020 2020 2020 2020 203c 6f70 7469             <opti
-000236c0: 6f6e 2076 616c 7565 3d27 273e 3030 3a30  on value=''>00:0
-000236d0: 303c 2f6f 7074 696f 6e3e 0a20 2020 2020  0</option>.     
-000236e0: 2020 2020 2020 2020 2020 2020 2020 203c                 <
-000236f0: 6f70 7469 6f6e 2076 616c 7565 3d27 3168  option value='1h
-00023700: 273e 3031 3a30 303c 2f6f 7074 696f 6e3e  '>01:00</option>
-00023710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023720: 2020 2020 203c 6f70 7469 6f6e 2076 616c       <option val
-00023730: 7565 3d27 3268 273e 3032 3a30 303c 2f6f  ue='2h'>02:00</o
-00023740: 7074 696f 6e3e 0a20 2020 2020 2020 2020  ption>.         
-00023750: 2020 2020 2020 2020 2020 203c 6f70 7469             <opti
-00023760: 6f6e 2076 616c 7565 3d27 3368 273e 3033  on value='3h'>03
-00023770: 3a30 303c 2f6f 7074 696f 6e3e 0a20 2020  :00</option>.   
-00023780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023790: 203c 6f70 7469 6f6e 2076 616c 7565 3d27   <option value='
-000237a0: 3468 273e 3034 3a30 303c 2f6f 7074 696f  4h'>04:00</optio
-000237b0: 6e3e 0a20 2020 2020 2020 2020 2020 2020  n>.             
-000237c0: 2020 2020 2020 203c 6f70 7469 6f6e 2076         <option v
-000237d0: 616c 7565 3d27 3568 273e 3035 3a30 303c  alue='5h'>05:00<
-000237e0: 2f6f 7074 696f 6e3e 0a20 2020 2020 2020  /option>.       
-000237f0: 2020 2020 2020 2020 2020 2020 203c 6f70               <op
-00023800: 7469 6f6e 2076 616c 7565 3d27 3668 273e  tion value='6h'>
-00023810: 3036 3a30 303c 2f6f 7074 696f 6e3e 0a20  06:00</option>. 
-00023820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023830: 2020 203c 6f70 7469 6f6e 2076 616c 7565     <option value
-00023840: 3d27 3768 273e 3037 3a30 303c 2f6f 7074  ='7h'>07:00</opt
-00023850: 696f 6e3e 0a20 2020 2020 2020 2020 2020  ion>.           
-00023860: 2020 2020 2020 2020 203c 6f70 7469 6f6e           <option
-00023870: 2076 616c 7565 3d27 3868 273e 3038 3a30   value='8h'>08:0
-00023880: 303c 2f6f 7074 696f 6e3e 0a20 2020 2020  0</option>.     
-00023890: 2020 2020 2020 2020 2020 2020 2020 203c                 <
-000238a0: 6f70 7469 6f6e 2076 616c 7565 3d27 3968  option value='9h
-000238b0: 273e 3039 3a30 303c 2f6f 7074 696f 6e3e  '>09:00</option>
-000238c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000238d0: 203c 2f73 656c 6563 743e 0a20 2020 2020   </select>.     
-000238e0: 2020 2020 2020 2020 2020 203c 6469 763e             <div>
-000238f0: 546f 6461 7920 6475 7261 7469 6f6e 3a3c  Today duration:<
-00023900: 2f64 6976 3e0a 2020 2020 2020 2020 2020  /div>.          
-00023910: 2020 2020 2020 3c73 656c 6563 743e 0a20        <select>. 
+00022990: 2020 2020 2020 2020 6461 7465 203d 2022          date = "
+000229a0: 2d22 2e6a 6f69 6e28 7265 7665 7273 6564  -".join(reversed
+000229b0: 2864 6174 652e 7370 6c69 7428 222d 2229  (date.split("-")
+000229c0: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+000229d0: 2020 2020 2020 2020 2020 2072 6177 2e64             raw.d
+000229e0: 6174 655f 6f6b 203d 2064 6174 650a 2020  ate_ok = date.  
+000229f0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00022a00: 2054 7275 653a 2020 2320 7261 772e 7431   True:  # raw.t1
+00022a10: 2061 6c77 6179 7320 6578 6973 7473 0a20   always exists. 
+00022a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022a30: 2020 2072 6563 6f72 642e 7431 203d 2066     record.t1 = f
+00022a40: 6c6f 6174 2872 6177 2e74 3129 0a20 2020  loat(raw.t1).   
+00022a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022a60: 2069 6620 6e6f 7420 2869 7346 696e 6974   if not (isFinit
+00022a70: 6528 7265 636f 7264 2e74 3129 2061 6e64  e(record.t1) and
+00022a80: 2072 6563 6f72 642e 7431 203e 2079 6561   record.t1 > yea
+00022a90: 725f 7061 7374 5f65 706f 6368 293a 0a20  r_past_epoch):. 
+00022aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022ab0: 2020 2020 2020 2072 6563 6f72 642e 7431         record.t1
+00022ac0: 203d 2044 6174 6528 7261 772e 7431 292e   = Date(raw.t1).
+00022ad0: 6765 7454 696d 6528 2920 2f20 3130 3030  getTime() / 1000
+00022ae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022af0: 2020 2020 2069 6620 6e6f 7420 6973 4669       if not isFi
+00022b00: 6e69 7465 2872 6563 6f72 642e 7431 2920  nite(record.t1) 
+00022b10: 616e 6420 7261 772e 6461 7465 5f6f 6b3a  and raw.date_ok:
+00022b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022b30: 2020 2020 2020 2020 2023 2054 7279 2075           # Try u
+00022b40: 7365 2064 6174 652c 2059 6173 7420 7573  se date, Yast us
+00022b50: 6573 2064 6f74 732c 2072 6576 6572 7365  es dots, reverse
+00022b60: 2069 6620 6e65 6564 6564 0a20 2020 2020   if needed.     
+00022b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022b80: 2020 2074 6d65 203d 2072 6177 2e74 312e     tme = raw.t1.
+00022b90: 7265 706c 6163 6528 222e 222c 2022 3a22  replace(".", ":"
+00022ba0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00022bb0: 2020 2020 2020 2020 2020 6966 2034 203c            if 4 <
+00022bc0: 3d20 6c65 6e28 746d 6529 203c 3d20 3820  = len(tme) <= 8 
+00022bd0: 616e 6420 3120 3c3d 2074 6d65 2e63 6f75  and 1 <= tme.cou
+00022be0: 6e74 2822 3a22 2920 3c3d 2032 3a0a 2020  nt(":") <= 2:.  
+00022bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022c00: 2020 2020 2020 2020 2020 2320 4e6f 7465            # Note
+00022c10: 3a20 6f6e 2049 4f53 2c20 4461 7465 206e  : on IOS, Date n
+00022c20: 6565 6473 2074 6f20 6265 2022 7979 7979  eeds to be "yyyy
+00022c30: 2d6d 6d2d 6464 5468 683a 6d6d 3a73 7322  -mm-ddThh:mm:ss"
+00022c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022c50: 2020 2020 2020 2020 2020 2020 2023 2062               # b
+00022c60: 7574 2070 656f 706c 6520 6172 6520 756e  ut people are un
+00022c70: 6c69 6b65 6c79 2074 6f20 696d 706f 7274  likely to import
+00022c80: 206f 6e20 616e 2069 6f73 2064 6576 6963   on an ios devic
+00022c90: 6520 2e2e 2e20 4920 686f 7065 2e0a 2020  e ... I hope..  
+00022ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022cb0: 2020 2020 2020 2020 2020 7265 636f 7264            record
+00022cc0: 2e74 3120 3d20 4461 7465 2872 6177 2e64  .t1 = Date(raw.d
+00022cd0: 6174 655f 6f6b 202b 2022 2022 202b 2074  ate_ok + " " + t
+00022ce0: 6d65 292e 6765 7454 696d 6528 2920 2f20  me).getTime() / 
+00022cf0: 3130 3030 0a20 2020 2020 2020 2020 2020  1000.           
+00022d00: 2020 2020 2020 2020 2072 6563 6f72 642e           record.
+00022d10: 7431 203d 204d 6174 682e 666c 6f6f 7228  t1 = Math.floor(
+00022d20: 7265 636f 7264 2e74 3129 0a20 2020 2020  record.t1).     
+00022d30: 2020 2020 2020 2020 2020 2069 6620 5472             if Tr
+00022d40: 7565 3a20 2023 2072 6177 2e74 3220 6f72  ue:  # raw.t2 or
+00022d50: 2064 7572 6174 696f 6e20 6578 6973 7473   duration exists
+00022d60: 202d 0a20 2020 2020 2020 2020 2020 2020   -.             
+00022d70: 2020 2020 2020 2072 6563 6f72 642e 7432         record.t2
+00022d80: 203d 2066 6c6f 6174 2872 6177 2e74 3229   = float(raw.t2)
+00022d90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022da0: 2020 2020 2069 6620 6e6f 7420 2869 7346       if not (isF
+00022db0: 696e 6974 6528 7265 636f 7264 2e74 3229  inite(record.t2)
+00022dc0: 2061 6e64 2072 6563 6f72 642e 7432 203e   and record.t2 >
+00022dd0: 2079 6561 725f 7061 7374 5f65 706f 6368   year_past_epoch
+00022de0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00022df0: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
+00022e00: 642e 7432 203d 2044 6174 6528 7261 772e  d.t2 = Date(raw.
+00022e10: 7432 292e 6765 7454 696d 6528 2920 2f20  t2).getTime() / 
+00022e20: 3130 3030 0a20 2020 2020 2020 2020 2020  1000.           
+00022e30: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00022e40: 6973 4669 6e69 7465 2872 6563 6f72 642e  isFinite(record.
+00022e50: 7432 2920 616e 6420 7261 772e 6475 7261  t2) and raw.dura
+00022e60: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
+00022e70: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00022e80: 5472 7920 7573 6520 6475 7261 7469 6f6e  Try use duration
+00022e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022ea0: 2020 2020 2020 2020 2064 7572 6174 696f           duratio
+00022eb0: 6e20 3d20 666c 6f61 7428 7261 772e 6475  n = float(raw.du
+00022ec0: 7261 7469 6f6e 290a 2020 2020 2020 2020  ration).        
+00022ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022ee0: 6966 2022 3a22 2069 6e20 7261 772e 6475  if ":" in raw.du
+00022ef0: 7261 7469 6f6e 3a0a 2020 2020 2020 2020  ration:.        
+00022f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022f10: 2020 2020 6475 7261 7469 6f6e 5f70 6172      duration_par
+00022f20: 7473 203d 2072 6177 2e64 7572 6174 696f  ts = raw.duratio
+00022f30: 6e2e 7370 6c69 7428 223a 2229 0a20 2020  n.split(":").   
+00022f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022f50: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+00022f60: 6475 7261 7469 6f6e 5f70 6172 7473 2920  duration_parts) 
+00022f70: 3d3d 2032 3a0a 2020 2020 2020 2020 2020  == 2:.          
+00022f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022f90: 2020 2020 2020 6475 7261 7469 6f6e 203d        duration =
+00022fa0: 2066 6c6f 6174 2864 7572 6174 696f 6e5f   float(duration_
+00022fb0: 7061 7274 735b 305d 2920 2a20 3336 3030  parts[0]) * 3600
+00022fc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022fe0: 2064 7572 6174 696f 6e20 2b3d 2066 6c6f   duration += flo
+00022ff0: 6174 2864 7572 6174 696f 6e5f 7061 7274  at(duration_part
+00023000: 735b 315d 2920 2a20 3630 0a20 2020 2020  s[1]) * 60.     
+00023010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023020: 2020 2020 2020 2065 6c69 6620 6c65 6e28         elif len(
+00023030: 6475 7261 7469 6f6e 5f70 6172 7473 2920  duration_parts) 
+00023040: 3d3d 2033 3a0a 2020 2020 2020 2020 2020  == 3:.          
+00023050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023060: 2020 2020 2020 6475 7261 7469 6f6e 203d        duration =
+00023070: 2066 6c6f 6174 2864 7572 6174 696f 6e5f   float(duration_
+00023080: 7061 7274 735b 305d 2920 2a20 3336 3030  parts[0]) * 3600
+00023090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000230a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000230b0: 2064 7572 6174 696f 6e20 2b3d 2066 6c6f   duration += flo
+000230c0: 6174 2864 7572 6174 696f 6e5f 7061 7274  at(duration_part
+000230d0: 735b 315d 2920 2a20 3630 0a20 2020 2020  s[1]) * 60.     
+000230e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000230f0: 2020 2020 2020 2020 2020 2064 7572 6174             durat
+00023100: 696f 6e20 2b3d 2066 6c6f 6174 2864 7572  ion += float(dur
+00023110: 6174 696f 6e5f 7061 7274 735b 325d 290a  ation_parts[2]).
+00023120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023130: 2020 2020 2020 2020 7265 636f 7264 2e74          record.t
+00023140: 3220 3d20 7265 636f 7264 2e74 3120 2b20  2 = record.t1 + 
+00023150: 666c 6f61 7428 6475 7261 7469 6f6e 290a  float(duration).
+00023160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023170: 2020 2020 6966 206e 6f74 2069 7346 696e      if not isFin
+00023180: 6974 6528 7265 636f 7264 2e74 3229 2061  ite(record.t2) a
+00023190: 6e64 2072 6177 2e64 6174 655f 6f6b 3a0a  nd raw.date_ok:.
+000231a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000231b0: 2020 2020 2020 2020 2320 5472 7920 7573          # Try us
+000231c0: 6520 6461 7465 0a20 2020 2020 2020 2020  e date.         
+000231d0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+000231e0: 6d65 203d 2072 6177 2e74 322e 7265 706c  me = raw.t2.repl
+000231f0: 6163 6528 222e 222c 2022 3a22 290a 2020  ace(".", ":").  
+00023200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023210: 2020 2020 2020 6966 2034 203c 3d20 6c65        if 4 <= le
+00023220: 6e28 746d 6529 203c 3d20 3820 616e 6420  n(tme) <= 8 and 
+00023230: 3120 3c3d 2074 6d65 2e63 6f75 6e74 2822  1 <= tme.count("
+00023240: 3a22 2920 3c3d 2032 3a0a 2020 2020 2020  :") <= 2:.      
+00023250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023260: 2020 2020 2020 7265 636f 7264 2e74 3220        record.t2 
+00023270: 3d20 4461 7465 2872 6177 2e64 6174 655f  = Date(raw.date_
+00023280: 6f6b 202b 2022 2022 202b 2074 6d65 292e  ok + " " + tme).
+00023290: 6765 7454 696d 6528 2920 2f20 3130 3030  getTime() / 1000
+000232a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000232b0: 2020 2020 2072 6563 6f72 642e 7432 203d       record.t2 =
+000232c0: 204d 6174 682e 6365 696c 2872 6563 6f72   Math.ceil(recor
+000232d0: 642e 7432 290a 2020 2020 2020 2020 2020  d.t2).          
+000232e0: 2020 2020 2020 6966 2072 6177 2e74 6167        if raw.tag
+000232f0: 733a 2020 2320 4966 2074 6167 7320 6172  s:  # If tags ar
+00023300: 6520 6769 7665 6e2c 2075 7365 2074 6861  e given, use tha
+00023310: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+00023320: 2020 2020 2020 7261 775f 7461 6773 203d        raw_tags =
+00023330: 2072 6177 2e74 6167 732e 7265 706c 6163   raw.tags.replac
+00023340: 6528 222c 222c 2022 2022 292e 7370 6c69  e(",", " ").spli
+00023350: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
+00023360: 2020 2020 2020 2020 7461 6773 203d 205b          tags = [
+00023370: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00023380: 2020 2020 2020 666f 7220 7461 6720 696e        for tag in
+00023390: 2072 6177 5f74 6167 733a 0a20 2020 2020   raw_tags:.     
+000233a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000233b0: 2020 2074 6167 203d 2075 7469 6c73 2e63     tag = utils.c
+000233c0: 6f6e 7665 7274 5f74 6578 745f 746f 5f76  onvert_text_to_v
+000233d0: 616c 6964 5f74 6167 2874 6167 2e74 7269  alid_tag(tag.tri
+000233e0: 6d28 2929 0a20 2020 2020 2020 2020 2020  m()).           
+000233f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00023400: 6c65 6e28 7461 6729 203e 2032 3a0a 2020  len(tag) > 2:.  
+00023410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023420: 2020 2020 2020 2020 2020 7461 6773 2e70            tags.p
+00023430: 7573 6828 7461 6729 0a20 2020 2020 2020  ush(tag).       
+00023440: 2020 2020 2020 2020 2065 6c73 653a 2020           else:  
+00023450: 2320 4966 206e 6f20 7461 6773 2061 7265  # If no tags are
+00023460: 2067 6976 656e 2c20 7472 7920 746f 2064   given, try to d
+00023470: 6572 6976 6520 7461 6773 2066 726f 6d20  erive tags from 
+00023480: 7072 6f6a 6563 7420 6e61 6d65 0a20 2020  project name.   
+00023490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000234a0: 2070 726f 6a65 6374 5f6e 616d 6520 3d20   project_name = 
+000234b0: 7261 772e 7072 6f6a 6563 746e 616d 6520  raw.projectname 
+000234c0: 6f72 2072 6177 2e70 726f 6a65 6374 6b65  or raw.projectke
+000234d0: 7920 6f72 2022 220a 2020 2020 2020 2020  y or "".        
+000234e0: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+000234f0: 6177 2e70 726f 6a65 6374 7061 7468 3a0a  aw.projectpath:.
+00023500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023510: 2020 2020 2020 2020 7072 6f6a 6563 745f          project_
+00023520: 7061 7274 7320 3d20 5b72 6177 2e70 726f  parts = [raw.pro
+00023530: 6a65 6374 7061 7468 5d0a 2020 2020 2020  jectpath].      
+00023540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023550: 2020 6966 2072 6177 2e6d 6f72 6520 616e    if raw.more an
+00023560: 6420 6865 6164 6572 7061 7274 7332 5b2d  d headerparts2[-
+00023570: 315d 203d 3d20 2270 726f 6a65 6374 7061  1] == "projectpa
+00023580: 7468 223a 2020 2320 5961 7374 0a20 2020  th":  # Yast.   
+00023590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000235a0: 2020 2020 2020 2020 2070 726f 6a65 6374           project
+000235b0: 5f70 6172 7473 203d 205b 7261 772e 7072  _parts = [raw.pr
+000235c0: 6f6a 6563 7470 6174 682e 7265 706c 6163  ojectpath.replac
+000235d0: 6528 222f 222c 2022 207c 2022 295d 0a20  e("/", " | ")]. 
+000235e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000235f0: 2020 2020 2020 2020 2020 2066 6f72 206a             for j
+00023600: 2069 6e20 7261 6e67 6528 6c65 6e28 7261   in range(len(ra
+00023610: 772e 6d6f 7265 2929 3a0a 2020 2020 2020  w.more)):.      
+00023620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023630: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00023640: 2872 6177 2e6d 6f72 655b 6a5d 2920 3e20  (raw.more[j]) > 
+00023650: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+00023660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023670: 2020 2020 2020 2070 726f 6a65 6374 5f70         project_p
+00023680: 6172 7473 2e61 7070 656e 6428 0a20 2020  arts.append(.   
+00023690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000236a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000236b0: 2020 2020 2072 6177 2e6d 6f72 655b 6a5d       raw.more[j]
+000236c0: 2e72 6570 6c61 6365 2822 2f22 2c20 2220  .replace("/", " 
+000236d0: 7c20 2229 0a20 2020 2020 2020 2020 2020  | ").           
+000236e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000236f0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00023700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023710: 2020 2070 726f 6a65 6374 5f70 6172 7473     project_parts
+00023720: 2e61 7070 656e 6428 7261 772e 7072 6f6a  .append(raw.proj
+00023730: 6563 746e 616d 652e 7265 706c 6163 6528  ectname.replace(
+00023740: 222f 222c 2022 207c 2022 2929 0a20 2020  "/", " | ")).   
+00023750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023760: 2020 2020 2070 726f 6a65 6374 5f6e 616d       project_nam
+00023770: 6520 3d20 222f 222e 6a6f 696e 2870 726f  e = "/".join(pro
+00023780: 6a65 6374 5f70 6172 7473 290a 2020 2020  ject_parts).    
+00023790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000237a0: 7072 6f6a 6563 745f 6e61 6d65 203d 2074  project_name = t
+000237b0: 6f5f 7374 7228 7072 6f6a 6563 745f 6e61  o_str(project_na
+000237c0: 6d65 2920 2023 206e 6f72 6d61 6c69 7a65  me)  # normalize
+000237d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000237e0: 2020 2020 2074 6167 7320 3d20 5b5d 0a20       tags = []. 
+000237f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023800: 2020 2069 6620 7072 6f6a 6563 745f 6e61     if project_na
+00023810: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
+00023820: 2020 2020 2020 2020 2020 2020 7461 6773              tags
+00023830: 203d 205b 7574 696c 732e 636f 6e76 6572   = [utils.conver
+00023840: 745f 7465 7874 5f74 6f5f 7661 6c69 645f  t_text_to_valid_
+00023850: 7461 6728 7072 6f6a 6563 745f 6e61 6d65  tag(project_name
+00023860: 295d 0a20 2020 2020 2020 2020 2020 2020  )].             
+00023870: 2020 2069 6620 5472 7565 3a0a 2020 2020     if True:.    
+00023880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023890: 7461 6773 5f64 6963 7420 3d20 7b7d 0a20  tags_dict = {}. 
+000238a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000238b0: 2020 2066 6f72 2074 6167 2069 6e20 7461     for tag in ta
+000238c0: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
+000238d0: 2020 2020 2020 2020 2020 2020 7461 6773              tags
+000238e0: 5f64 6963 745b 7461 675d 203d 2074 6167  _dict[tag] = tag
+000238f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023900: 2020 2020 2069 6620 7261 772e 6465 7363       if raw.desc
+00023910: 7269 7074 696f 6e3a 0a20 2020 2020 2020  ription:.       
 00023920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023930: 2020 203c 6f70 7469 6f6e 2076 616c 7565     <option value
-00023940: 3d27 2d31 3268 273e 3132 683c 2f6f 7074  ='-12h'>12h</opt
-00023950: 696f 6e3e 0a20 2020 2020 2020 2020 2020  ion>.           
-00023960: 2020 2020 2020 2020 203c 6f70 7469 6f6e           <option
-00023970: 2076 616c 7565 3d27 273e 3234 683c 2f6f   value=''>24h</o
-00023980: 7074 696f 6e3e 0a20 2020 2020 2020 2020  ption>.         
-00023990: 2020 2020 2020 203c 2f73 656c 6563 743e         </select>
-000239a0: 0a20 2020 2020 2020 2020 2020 203c 2f64  .            </d
-000239b0: 6976 3e0a 2020 2020 2020 2020 2020 2020  iv>.            
-000239c0: 3c68 323e 3c69 2063 6c61 7373 3d27 6661  <h2><i class='fa
-000239d0: 7327 3e5c 7566 3038 353c 2f69 3e26 6e62  s'>\uf085</i>&nb
-000239e0: 7370 3b26 6e62 7370 3b4d 6973 633c 2f68  sp;&nbsp;Misc</h
-000239f0: 323e 0a20 2020 2020 2020 2020 2020 203c  2>.            <
-00023a00: 6c61 6265 6c3e 0a20 2020 2020 2020 2020  label>.         
-00023a10: 2020 2020 2020 203c 696e 7075 7420 7479         <input ty
-00023a20: 7065 3d27 6368 6563 6b62 6f78 2720 6368  pe='checkbox' ch
-00023a30: 6563 6b65 643d 2774 7275 6527 3e3c 2f69  ecked='true'></i
-00023a40: 6e70 7574 3e0a 2020 2020 2020 2020 2020  nput>.          
-00023a50: 2020 2020 2020 5368 6f77 2065 6c61 7073        Show elaps
-00023a60: 6564 2074 696d 6520 6265 6c6f 7720 7374  ed time below st
-00023a70: 6172 742d 6275 7474 6f6e 3c2f 6c61 6265  art-button</labe
-00023a80: 6c3e 0a0a 2020 2020 2020 2020 2020 2020  l>..            
-00023a90: 3c68 7220 7374 796c 653d 276d 6172 6769  <hr style='margi
-00023aa0: 6e2d 746f 703a 2031 656d 3b27 202f 3e0a  n-top: 1em;' />.
-00023ab0: 0a20 2020 2020 2020 2020 2020 203c 6365  .            <ce
-00023ac0: 6e74 6572 2073 7479 6c65 3d27 666f 6e74  nter style='font
-00023ad0: 2d73 697a 653a 3830 2527 3e53 6574 7469  -size:80%'>Setti
-00023ae0: 6e67 7320 666f 7220 7468 6973 2064 6576  ngs for this dev
-00023af0: 6963 653c 2f63 656e 7465 723e 0a20 2020  ice</center>.   
-00023b00: 2020 2020 2020 2020 203c 6832 3e3c 6920           <h2><i 
-00023b10: 636c 6173 733d 2766 6173 273e 5c75 6633  class='fas'>\uf3
-00023b20: 6661 3c2f 693e 266e 6273 703b 266e 6273  fa</i>&nbsp;&nbs
-00023b30: 703b 4170 7065 6172 616e 6365 3c2f 6832  p;Appearance</h2
-00023b40: 3e0a 2020 2020 2020 2020 2020 2020 3c64  >.            <d
-00023b50: 6976 2063 6c61 7373 3d27 666f 726d 6c61  iv class='formla
-00023b60: 796f 7574 273e 0a20 2020 2020 2020 2020  yout'>.         
-00023b70: 2020 2020 2020 203c 6469 763e 4c69 6768         <div>Ligh
-00023b80: 7420 2f20 6461 726b 3a3c 2f64 6976 3e0a  t / dark:</div>.
-00023b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023ba0: 3c73 656c 6563 743e 0a20 2020 2020 2020  <select>.       
-00023bb0: 2020 2020 2020 2020 2020 2020 203c 6f70               <op
-00023bc0: 7469 6f6e 2076 616c 7565 3d30 3e41 7574  tion value=0>Aut
-00023bd0: 6f20 6465 7465 6374 3c2f 6f70 7469 6f6e  o detect</option
-00023be0: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
-00023bf0: 2020 2020 2020 3c6f 7074 696f 6e20 7661        <option va
-00023c00: 6c75 653d 313e 4c69 6768 7420 6d6f 6465  lue=1>Light mode
-00023c10: 3c2f 6f70 7469 6f6e 3e0a 2020 2020 2020  </option>.      
-00023c20: 2020 2020 2020 2020 2020 2020 2020 3c6f                <o
-00023c30: 7074 696f 6e20 7661 6c75 653d 323e 4461  ption value=2>Da
-00023c40: 726b 206d 6f64 653c 2f6f 7074 696f 6e3e  rk mode</option>
-00023c50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023c60: 203c 2f73 656c 6563 743e 0a20 2020 2020   </select>.     
-00023c70: 2020 2020 2020 2020 2020 203c 6469 763e             <div>
-00023c80: 5769 6474 683a 3c2f 6469 763e 0a20 2020  Width:</div>.   
-00023c90: 2020 2020 2020 2020 2020 2020 203c 7365               <se
-00023ca0: 6c65 6374 3e0a 2020 2020 2020 2020 2020  lect>.          
-00023cb0: 2020 2020 2020 2020 2020 3c6f 7074 696f            <optio
-00023cc0: 6e20 7661 6c75 653d 2761 7574 6f27 3e41  n value='auto'>A
-00023cd0: 7574 6f20 7363 616c 653c 2f6f 7074 696f  uto scale</optio
-00023ce0: 6e3e 0a20 2020 2020 2020 2020 2020 2020  n>.             
-00023cf0: 2020 2020 2020 203c 6f70 7469 6f6e 2076         <option v
-00023d00: 616c 7565 3d27 3130 3030 273e 4d61 7820  alue='1000'>Max 
-00023d10: 3130 3030 7078 3c2f 6f70 7469 6f6e 3e0a  1000px</option>.
-00023d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023d30: 2020 2020 3c6f 7074 696f 6e20 7661 6c75      <option valu
-00023d40: 653d 2731 3530 3027 3e4d 6178 2031 3530  e='1500'>Max 150
-00023d50: 3070 783c 2f6f 7074 696f 6e3e 0a20 2020  0px</option>.   
-00023d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023d70: 203c 6f70 7469 6f6e 2076 616c 7565 3d27   <option value='
-00023d80: 6675 6c6c 273e 4675 6c6c 2077 6964 7468  full'>Full width
-00023d90: 3c2f 6f70 7469 6f6e 3e0a 2020 2020 2020  </option>.      
-00023da0: 2020 2020 2020 2020 2020 3c2f 7365 6c65            </sele
-00023db0: 6374 3e0a 2020 2020 2020 2020 2020 2020  ct>.            
-00023dc0: 3c2f 6469 763e 0a20 2020 2020 2020 2020  </div>.         
-00023dd0: 2020 203c 6832 3e3c 6920 636c 6173 733d     <h2><i class=
-00023de0: 2766 6173 273e 5c75 6632 6632 3c2f 693e  'fas'>\uf2f2</i>
-00023df0: 266e 6273 703b 266e 6273 703b 506f 6d6f  &nbsp;&nbsp;Pomo
-00023e00: 646f 726f 3c2f 6832 3e0a 2020 2020 2020  doro</h2>.      
-00023e10: 2020 2020 2020 3c6c 6162 656c 3e0a 2020        <label>.  
-00023e20: 2020 2020 2020 2020 2020 2020 2020 3c69                <i
-00023e30: 6e70 7574 2074 7970 653d 2763 6865 636b  nput type='check
-00023e40: 626f 7827 2063 6865 636b 6564 3d27 6661  box' checked='fa
-00023e50: 6c73 6527 3e3c 2f69 6e70 7574 3e0a 2020  lse'></input>.  
-00023e60: 2020 2020 2020 2020 2020 2020 2020 456e                En
-00023e70: 6162 6c65 2070 6f6d 6f64 6f72 6f20 2865  able pomodoro (e
-00023e80: 7870 6572 696d 656e 7461 6c29 203c 2f6c  xperimental) </l
-00023e90: 6162 656c 3e0a 0a20 2020 2020 2020 2020  abel>..         
-00023ea0: 2020 203c 6872 2073 7479 6c65 3d27 6d61     <hr style='ma
-00023eb0: 7267 696e 2d74 6f70 3a20 3165 6d3b 2720  rgin-top: 1em;' 
-00023ec0: 2f3e 0a0a 2020 2020 2020 2020 2020 2020  />..            
-00023ed0: 3c63 656e 7465 7220 7374 796c 653d 2766  <center style='f
-00023ee0: 6f6e 742d 7369 7a65 3a38 3025 273e 5374  ont-size:80%'>St
-00023ef0: 6174 6963 2073 6574 7469 6e67 733c 2f63  atic settings</c
-00023f00: 656e 7465 723e 0a20 2020 2020 2020 2020  enter>.         
-00023f10: 2020 203c 6832 3e3c 6920 636c 6173 733d     <h2><i class=
-00023f20: 2766 6173 273e 5c75 6630 6163 3c2f 693e  'fas'>\uf0ac</i>
-00023f30: 266e 6273 703b 266e 6273 703b 5469 6d65  &nbsp;&nbsp;Time
-00023f40: 207a 6f6e 653c 2f68 323e 0a20 2020 2020   zone</h2>.     
-00023f50: 2020 2020 2020 203c 6469 763e 3c2f 6469         <div></di
-00023f60: 763e 0a20 2020 2020 2020 2020 2020 203c  v>.            <
-00023f70: 6832 3e3c 6920 636c 6173 733d 2766 6173  h2><i class='fas
-00023f80: 273e 5c75 6631 3163 3c2f 693e 266e 6273  '>\uf11c</i>&nbs
-00023f90: 703b 266e 6273 703b 4b65 7962 6f61 7264  p;&nbsp;Keyboard
-00023fa0: 2073 686f 7274 6375 7473 3c2f 6832 3e0a   shortcuts</h2>.
-00023fb0: 2020 2020 2020 2020 2020 2020 3c64 6976              <div
-00023fc0: 2063 6c61 7373 3d27 666f 726d 6c61 796f   class='formlayo
-00023fd0: 7574 273e 7b73 686f 7274 6375 7473 5f68  ut'>{shortcuts_h
-00023fe0: 746d 6c7d 3c2f 6469 763e 0a20 2020 2020  tml}</div>.     
-00023ff0: 2020 2020 2020 203c 6272 202f 3e3c 6272         <br /><br
-00024000: 202f 3e0a 2020 2020 2020 2020 2020 2020   />.            
-00024010: 2222 220a 0a20 2020 2020 2020 2073 656c  """..        sel
-00024020: 662e 6d61 696e 6469 762e 696e 6e65 7248  f.maindiv.innerH
-00024030: 544d 4c20 3d20 6874 6d6c 0a20 2020 2020  TML = html.     
-00024040: 2020 2073 656c 662e 5f63 6c6f 7365 5f62     self._close_b
-00024050: 7574 203d 2073 656c 662e 6d61 696e 6469  ut = self.maindi
-00024060: 762e 6368 696c 6472 656e 5b30 5d2e 6368  v.children[0].ch
-00024070: 696c 6472 656e 5b2d 315d 0a20 2020 2020  ildren[-1].     
-00024080: 2020 2073 656c 662e 5f63 6c6f 7365 5f62     self._close_b
-00024090: 7574 2e6f 6e63 6c69 636b 203d 2073 656c  ut.onclick = sel
-000240a0: 662e 636c 6f73 650a 2020 2020 2020 2020  f.close.        
-000240b0: 280a 2020 2020 2020 2020 2020 2020 5f2c  (.            _,
-000240c0: 2020 2320 4469 616c 6f67 2074 6974 6c65    # Dialog title
-000240d0: 0a20 2020 2020 2020 2020 2020 205f 2c20  .            _, 
-000240e0: 2023 2053 6563 7469 6f6e 3a20 7573 6572   # Section: user
-000240f0: 2073 6574 7469 6e67 730a 2020 2020 2020   settings.      
-00024100: 2020 2020 2020 5f2c 2020 2320 5469 6d65        _,  # Time
-00024110: 2072 6570 7220 6865 6164 6572 0a20 2020   repr header.   
-00024120: 2020 2020 2020 2020 2073 656c 662e 5f72           self._r
-00024130: 6570 725f 666f 726d 2c0a 2020 2020 2020  epr_form,.      
-00024140: 2020 2020 2020 5f2c 2020 2320 4d69 7363        _,  # Misc
-00024150: 2068 6561 6465 720a 2020 2020 2020 2020   header.        
-00024160: 2020 2020 7365 6c66 2e5f 7374 6f70 7761      self._stopwa
-00024170: 7463 685f 6c61 6265 6c2c 0a20 2020 2020  tch_label,.     
-00024180: 2020 2020 2020 205f 2c20 2023 2068 720a         _,  # hr.
-00024190: 2020 2020 2020 2020 2020 2020 5f2c 2020              _,  
-000241a0: 2320 5365 6374 696f 6e3a 2070 6572 2064  # Section: per d
-000241b0: 6576 6963 650a 2020 2020 2020 2020 2020  evice.          
-000241c0: 2020 5f2c 2020 2320 4170 7065 6172 616e    _,  # Appearan
-000241d0: 6365 2068 6561 6465 720a 2020 2020 2020  ce header.      
-000241e0: 2020 2020 2020 7365 6c66 2e5f 6170 7065        self._appe
-000241f0: 6172 616e 6365 5f66 6f72 6d2c 0a20 2020  arance_form,.   
-00024200: 2020 2020 2020 2020 205f 2c20 2023 2050           _,  # P
-00024210: 6f6d 6f64 6f72 6f20 6865 6164 6572 0a20  omodoro header. 
-00024220: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00024230: 5f70 6f6d 6f64 6f72 6f5f 6c61 6265 6c2c  _pomodoro_label,
-00024240: 0a20 2020 2020 2020 2020 2020 205f 2c20  .            _, 
-00024250: 2023 2068 720a 2020 2020 2020 2020 2020   # hr.          
-00024260: 2020 5f2c 2020 2320 5365 6374 696f 6e3a    _,  # Section:
-00024270: 2069 6e66 6f0a 2020 2020 2020 2020 2020   info.          
-00024280: 2020 5f2c 2020 2320 5469 6d65 7a6f 6e65    _,  # Timezone
-00024290: 2068 6561 6465 720a 2020 2020 2020 2020   header.        
-000242a0: 2020 2020 7365 6c66 2e5f 7469 6d65 7a6f      self._timezo
-000242b0: 6e65 5f64 6976 2c0a 2020 2020 2020 2020  ne_div,.        
-000242c0: 2020 2020 5f2c 2020 2320 5368 6f72 7463      _,  # Shortc
-000242d0: 7574 7320 6865 6164 6572 0a20 2020 2020  uts header.     
-000242e0: 2020 2020 2020 2073 656c 662e 5f73 686f         self._sho
-000242f0: 7274 6375 7473 5f64 6976 2c0a 2020 2020  rtcuts_div,.    
-00024300: 2020 2020 2920 3d20 7365 6c66 2e6d 6169      ) = self.mai
-00024310: 6e64 6976 2e63 6869 6c64 7265 6e0a 0a20  ndiv.children.. 
-00024320: 2020 2020 2020 2023 2055 7365 7220 7365         # User se
-00024330: 7474 696e 6773 0a0a 2020 2020 2020 2020  ttings..        
-00024340: 2320 5765 656b 7320 7374 6172 7473 206f  # Weeks starts o
-00024350: 6e0a 2020 2020 2020 2020 6669 7273 745f  n.        first_
-00024360: 6461 795f 6f66 5f77 6565 6b20 3d20 7769  day_of_week = wi
-00024370: 6e64 6f77 2e73 696d 706c 6573 6574 7469  ndow.simplesetti
-00024380: 6e67 732e 6765 7428 2266 6972 7374 5f64  ngs.get("first_d
-00024390: 6179 5f6f 665f 7765 656b 2229 0a20 2020  ay_of_week").   
-000243a0: 2020 2020 2073 656c 662e 5f66 6972 7374       self._first
-000243b0: 5f64 6179 5f6f 665f 7765 656b 203d 2073  _day_of_week = s
-000243c0: 656c 662e 5f72 6570 725f 666f 726d 2e63  elf._repr_form.c
-000243d0: 6869 6c64 7265 6e5b 315d 0a20 2020 2020  hildren[1].     
-000243e0: 2020 2073 656c 662e 5f66 6972 7374 5f64     self._first_d
-000243f0: 6179 5f6f 665f 7765 656b 2e76 616c 7565  ay_of_week.value
-00024400: 203d 2066 6972 7374 5f64 6179 5f6f 665f   = first_day_of_
-00024410: 7765 656b 0a20 2020 2020 2020 2073 656c  week.        sel
-00024420: 662e 5f66 6972 7374 5f64 6179 5f6f 665f  f._first_day_of_
-00024430: 7765 656b 2e6f 6e63 6861 6e67 6520 3d20  week.onchange = 
-00024440: 7365 6c66 2e5f 6f6e 5f66 6972 7374 5f64  self._on_first_d
-00024450: 6179 5f6f 665f 7765 656b 5f63 6861 6e67  ay_of_week_chang
-00024460: 650a 0a20 2020 2020 2020 2023 2054 696d  e..        # Tim
-00024470: 6520 7265 7072 6573 656e 7461 7469 6f6e  e representation
-00024480: 0a20 2020 2020 2020 2074 696d 655f 7265  .        time_re
-00024490: 7072 203d 2077 696e 646f 772e 7369 6d70  pr = window.simp
-000244a0: 6c65 7365 7474 696e 6773 2e67 6574 2822  lesettings.get("
-000244b0: 7469 6d65 5f72 6570 7222 290a 2020 2020  time_repr").    
-000244c0: 2020 2020 7365 6c66 2e5f 7469 6d65 5f72      self._time_r
-000244d0: 6570 7220 3d20 7365 6c66 2e5f 7265 7072  epr = self._repr
-000244e0: 5f66 6f72 6d2e 6368 696c 6472 656e 5b33  _form.children[3
-000244f0: 5d0a 2020 2020 2020 2020 7365 6c66 2e5f  ].        self._
-00024500: 7469 6d65 5f72 6570 722e 7661 6c75 6520  time_repr.value 
-00024510: 3d20 7469 6d65 5f72 6570 720a 2020 2020  = time_repr.    
-00024520: 2020 2020 7365 6c66 2e5f 7469 6d65 5f72      self._time_r
-00024530: 6570 722e 6f6e 6368 616e 6765 203d 2073  epr.onchange = s
-00024540: 656c 662e 5f6f 6e5f 7469 6d65 5f72 6570  elf._on_time_rep
-00024550: 725f 6368 616e 6765 0a0a 2020 2020 2020  r_change..      
-00024560: 2020 2320 4475 7261 7469 6f6e 2072 6570    # Duration rep
-00024570: 7265 7365 6e74 6174 696f 6e0a 2020 2020  resentation.    
-00024580: 2020 2020 6475 7261 7469 6f6e 5f72 6570      duration_rep
-00024590: 7220 3d20 7769 6e64 6f77 2e73 696d 706c  r = window.simpl
-000245a0: 6573 6574 7469 6e67 732e 6765 7428 2264  esettings.get("d
-000245b0: 7572 6174 696f 6e5f 7265 7072 2229 0a20  uration_repr"). 
-000245c0: 2020 2020 2020 2073 656c 662e 5f64 7572         self._dur
-000245d0: 6174 696f 6e5f 7265 7072 203d 2073 656c  ation_repr = sel
-000245e0: 662e 5f72 6570 725f 666f 726d 2e63 6869  f._repr_form.chi
-000245f0: 6c64 7265 6e5b 355d 0a20 2020 2020 2020  ldren[5].       
-00024600: 2073 656c 662e 5f64 7572 6174 696f 6e5f   self._duration_
-00024610: 7265 7072 2e76 616c 7565 203d 2064 7572  repr.value = dur
-00024620: 6174 696f 6e5f 7265 7072 0a20 2020 2020  ation_repr.     
-00024630: 2020 2073 656c 662e 5f64 7572 6174 696f     self._duratio
-00024640: 6e5f 7265 7072 2e6f 6e63 6861 6e67 6520  n_repr.onchange 
-00024650: 3d20 7365 6c66 2e5f 6f6e 5f64 7572 6174  = self._on_durat
-00024660: 696f 6e5f 7265 7072 5f63 6861 6e67 650a  ion_repr_change.
-00024670: 0a20 2020 2020 2020 2023 2054 6f64 6179  .        # Today
-00024680: 2073 6e61 7020 7469 6d65 2f6f 6666 7365   snap time/offse
-00024690: 740a 2020 2020 2020 2020 746f 6461 795f  t.        today_
-000246a0: 736e 6170 5f6f 6666 7365 7420 3d20 7769  snap_offset = wi
-000246b0: 6e64 6f77 2e73 696d 706c 6573 6574 7469  ndow.simplesetti
-000246c0: 6e67 732e 6765 7428 2274 6f64 6179 5f73  ngs.get("today_s
-000246d0: 6e61 705f 6f66 6673 6574 2229 0a20 2020  nap_offset").   
-000246e0: 2020 2020 2073 656c 662e 5f74 6f64 6179       self._today
-000246f0: 5f73 6e61 705f 6f66 6673 6574 203d 2073  _snap_offset = s
-00024700: 656c 662e 5f72 6570 725f 666f 726d 2e63  elf._repr_form.c
-00024710: 6869 6c64 7265 6e5b 375d 0a20 2020 2020  hildren[7].     
-00024720: 2020 2073 656c 662e 5f74 6f64 6179 5f73     self._today_s
-00024730: 6e61 705f 6f66 6673 6574 2e76 616c 7565  nap_offset.value
-00024740: 203d 2074 6f64 6179 5f73 6e61 705f 6f66   = today_snap_of
-00024750: 6673 6574 0a20 2020 2020 2020 2073 656c  fset.        sel
-00024760: 662e 5f74 6f64 6179 5f73 6e61 705f 6f66  f._today_snap_of
-00024770: 6673 6574 2e6f 6e63 6861 6e67 6520 3d20  fset.onchange = 
-00024780: 7365 6c66 2e5f 6f6e 5f74 6f64 6179 5f73  self._on_today_s
-00024790: 6e61 705f 6f66 6673 6574 5f63 6861 6e67  nap_offset_chang
-000247a0: 650a 0a20 2020 2020 2020 2023 2054 6f64  e..        # Tod
-000247b0: 6179 206e 756d 6265 7220 6f66 2068 6f75  ay number of hou
-000247c0: 7273 0a20 2020 2020 2020 2074 6f64 6179  rs.        today
-000247d0: 5f65 6e64 5f6f 6666 7365 7420 3d20 7769  _end_offset = wi
-000247e0: 6e64 6f77 2e73 696d 706c 6573 6574 7469  ndow.simplesetti
-000247f0: 6e67 732e 6765 7428 2274 6f64 6179 5f65  ngs.get("today_e
-00024800: 6e64 5f6f 6666 7365 7422 290a 2020 2020  nd_offset").    
-00024810: 2020 2020 7365 6c66 2e5f 746f 6461 795f      self._today_
-00024820: 656e 645f 6f66 6673 6574 203d 2073 656c  end_offset = sel
-00024830: 662e 5f72 6570 725f 666f 726d 2e63 6869  f._repr_form.chi
-00024840: 6c64 7265 6e5b 395d 0a20 2020 2020 2020  ldren[9].       
-00024850: 2073 656c 662e 5f74 6f64 6179 5f65 6e64   self._today_end
-00024860: 5f6f 6666 7365 742e 7661 6c75 6520 3d20  _offset.value = 
-00024870: 746f 6461 795f 656e 645f 6f66 6673 6574  today_end_offset
-00024880: 0a20 2020 2020 2020 2073 656c 662e 5f74  .        self._t
-00024890: 6f64 6179 5f65 6e64 5f6f 6666 7365 742e  oday_end_offset.
-000248a0: 6f6e 6368 616e 6765 203d 2073 656c 662e  onchange = self.
-000248b0: 5f6f 6e5f 746f 6461 795f 656e 645f 6f66  _on_today_end_of
-000248c0: 6673 6574 5f63 6861 6e67 650a 0a20 2020  fset_change..   
-000248d0: 2020 2020 2023 2053 746f 7077 6174 6368       # Stopwatch
-000248e0: 0a20 2020 2020 2020 2073 686f 775f 7374  .        show_st
-000248f0: 6f70 7761 7463 6820 3d20 7769 6e64 6f77  opwatch = window
-00024900: 2e73 696d 706c 6573 6574 7469 6e67 732e  .simplesettings.
-00024910: 6765 7428 2273 686f 775f 7374 6f70 7761  get("show_stopwa
-00024920: 7463 6822 290a 2020 2020 2020 2020 7365  tch").        se
-00024930: 6c66 2e5f 7374 6f70 7761 7463 685f 6368  lf._stopwatch_ch
-00024940: 6563 6b20 3d20 7365 6c66 2e5f 7374 6f70  eck = self._stop
-00024950: 7761 7463 685f 6c61 6265 6c2e 6368 696c  watch_label.chil
-00024960: 6472 656e 5b30 5d0a 2020 2020 2020 2020  dren[0].        
-00024970: 7365 6c66 2e5f 7374 6f70 7761 7463 685f  self._stopwatch_
-00024980: 6368 6563 6b2e 6368 6563 6b65 6420 3d20  check.checked = 
-00024990: 7368 6f77 5f73 746f 7077 6174 6368 0a20  show_stopwatch. 
-000249a0: 2020 2020 2020 2073 656c 662e 5f73 746f         self._sto
-000249b0: 7077 6174 6368 5f63 6865 636b 2e6f 6e63  pwatch_check.onc
-000249c0: 6861 6e67 6520 3d20 7365 6c66 2e5f 6f6e  hange = self._on
-000249d0: 5f73 746f 7077 6174 6368 5f63 6865 636b  _stopwatch_check
-000249e0: 0a0a 2020 2020 2020 2020 2320 4465 7669  ..        # Devi
-000249f0: 6365 2073 6574 7469 6e67 730a 0a20 2020  ce settings..   
-00024a00: 2020 2020 2023 2044 6172 6b20 6d6f 6465       # Dark mode
-00024a10: 0a20 2020 2020 2020 2064 6172 6b6d 6f64  .        darkmod
-00024a20: 6520 3d20 7769 6e64 6f77 2e73 696d 706c  e = window.simpl
-00024a30: 6573 6574 7469 6e67 732e 6765 7428 2264  esettings.get("d
-00024a40: 6172 6b6d 6f64 6522 290a 2020 2020 2020  arkmode").      
-00024a50: 2020 7365 6c66 2e5f 6461 726b 6d6f 6465    self._darkmode
-00024a60: 5f73 656c 6563 7420 3d20 7365 6c66 2e5f  _select = self._
-00024a70: 6170 7065 6172 616e 6365 5f66 6f72 6d2e  appearance_form.
-00024a80: 6368 696c 6472 656e 5b31 5d0a 2020 2020  children[1].    
-00024a90: 2020 2020 7365 6c66 2e5f 6461 726b 6d6f      self._darkmo
-00024aa0: 6465 5f73 656c 6563 742e 7661 6c75 6520  de_select.value 
-00024ab0: 3d20 6461 726b 6d6f 6465 0a20 2020 2020  = darkmode.     
-00024ac0: 2020 2073 656c 662e 5f64 6172 6b6d 6f64     self._darkmod
-00024ad0: 655f 7365 6c65 6374 2e6f 6e63 6861 6e67  e_select.onchang
-00024ae0: 6520 3d20 7365 6c66 2e5f 6f6e 5f64 6172  e = self._on_dar
-00024af0: 6b6d 6f64 655f 6368 616e 6765 0a0a 2020  kmode_change..  
-00024b00: 2020 2020 2020 2320 5769 6474 6820 6d6f        # Width mo
-00024b10: 6465 0a20 2020 2020 2020 2077 6964 7468  de.        width
-00024b20: 5f6d 6f64 6520 3d20 7769 6e64 6f77 2e73  _mode = window.s
-00024b30: 696d 706c 6573 6574 7469 6e67 732e 6765  implesettings.ge
-00024b40: 7428 2277 6964 7468 5f6d 6f64 6522 290a  t("width_mode").
-00024b50: 2020 2020 2020 2020 7365 6c66 2e5f 7769          self._wi
-00024b60: 6474 685f 6d6f 6465 5f73 656c 6563 7420  dth_mode_select 
-00024b70: 3d20 7365 6c66 2e5f 6170 7065 6172 616e  = self._appearan
-00024b80: 6365 5f66 6f72 6d2e 6368 696c 6472 656e  ce_form.children
-00024b90: 5b33 5d0a 2020 2020 2020 2020 7365 6c66  [3].        self
-00024ba0: 2e5f 7769 6474 685f 6d6f 6465 5f73 656c  ._width_mode_sel
-00024bb0: 6563 742e 7661 6c75 6520 3d20 7769 6474  ect.value = widt
-00024bc0: 685f 6d6f 6465 0a20 2020 2020 2020 2073  h_mode.        s
-00024bd0: 656c 662e 5f77 6964 7468 5f6d 6f64 655f  elf._width_mode_
-00024be0: 7365 6c65 6374 2e6f 6e63 6861 6e67 6520  select.onchange 
-00024bf0: 3d20 7365 6c66 2e5f 6f6e 5f77 6964 7468  = self._on_width
-00024c00: 5f6d 6f64 655f 6368 616e 6765 0a0a 2020  _mode_change..  
-00024c10: 2020 2020 2020 2320 506f 6d6f 646f 726f        # Pomodoro
-00024c20: 0a20 2020 2020 2020 2070 6f6d 6f5f 656e  .        pomo_en
-00024c30: 6162 6c65 6420 3d20 7769 6e64 6f77 2e73  abled = window.s
-00024c40: 696d 706c 6573 6574 7469 6e67 732e 6765  implesettings.ge
-00024c50: 7428 2270 6f6d 6f64 6f72 6f5f 656e 6162  t("pomodoro_enab
-00024c60: 6c65 6422 290a 2020 2020 2020 2020 7365  led").        se
-00024c70: 6c66 2e5f 706f 6d6f 646f 726f 5f63 6865  lf._pomodoro_che
-00024c80: 636b 203d 2073 656c 662e 5f70 6f6d 6f64  ck = self._pomod
-00024c90: 6f72 6f5f 6c61 6265 6c2e 6368 696c 6472  oro_label.childr
-00024ca0: 656e 5b30 5d0a 2020 2020 2020 2020 7365  en[0].        se
-00024cb0: 6c66 2e5f 706f 6d6f 646f 726f 5f63 6865  lf._pomodoro_che
-00024cc0: 636b 2e63 6865 636b 6564 203d 2070 6f6d  ck.checked = pom
-00024cd0: 6f5f 656e 6162 6c65 640a 2020 2020 2020  o_enabled.      
-00024ce0: 2020 7365 6c66 2e5f 706f 6d6f 646f 726f    self._pomodoro
-00024cf0: 5f63 6865 636b 2e6f 6e63 6861 6e67 6520  _check.onchange 
-00024d00: 3d20 7365 6c66 2e5f 6f6e 5f70 6f6d 6f64  = self._on_pomod
-00024d10: 6f72 6f5f 6368 6563 6b0a 0a20 2020 2020  oro_check..     
-00024d20: 2020 2023 2053 7461 7469 6320 7365 7474     # Static sett
-00024d30: 696e 6773 0a0a 2020 2020 2020 2020 2320  ings..        # 
-00024d40: 5365 7420 7469 6d65 7a6f 6e65 2069 6e66  Set timezone inf
-00024d50: 6f0a 2020 2020 2020 2020 7365 6c66 2e5f  o.        self._
-00024d60: 7469 6d65 7a6f 6e65 5f64 6976 2e69 6e6e  timezone_div.inn
-00024d70: 6572 5465 7874 203d 2022 5554 4322 202b  erText = "UTC" +
-00024d80: 2064 742e 6765 745f 7469 6d65 7a6f 6e65   dt.get_timezone
-00024d90: 5f69 6e64 6963 6174 6f72 2864 742e 6e6f  _indicator(dt.no
-00024da0: 7728 292c 2022 3a22 290a 0a20 2020 2020  w(), ":")..     
-00024db0: 2020 2073 7570 6572 2829 2e6f 7065 6e28     super().open(
-00024dc0: 6361 6c6c 6261 636b 290a 0a20 2020 2064  callback)..    d
-00024dd0: 6566 205f 6f6e 5f66 6972 7374 5f64 6179  ef _on_first_day
-00024de0: 5f6f 665f 7765 656b 5f63 6861 6e67 6528  _of_week_change(
-00024df0: 7365 6c66 293a 0a20 2020 2020 2020 2066  self):.        f
-00024e00: 6972 7374 5f64 6179 5f6f 665f 7765 656b  irst_day_of_week
-00024e10: 203d 2069 6e74 2873 656c 662e 5f66 6972   = int(self._fir
-00024e20: 7374 5f64 6179 5f6f 665f 7765 656b 2e76  st_day_of_week.v
-00024e30: 616c 7565 290a 2020 2020 2020 2020 7769  alue).        wi
-00024e40: 6e64 6f77 2e73 696d 706c 6573 6574 7469  ndow.simplesetti
-00024e50: 6e67 732e 7365 7428 2266 6972 7374 5f64  ngs.set("first_d
-00024e60: 6179 5f6f 665f 7765 656b 222c 2066 6972  ay_of_week", fir
-00024e70: 7374 5f64 6179 5f6f 665f 7765 656b 290a  st_day_of_week).
-00024e80: 0a20 2020 2064 6566 205f 6f6e 5f74 696d  .    def _on_tim
-00024e90: 655f 7265 7072 5f63 6861 6e67 6528 7365  e_repr_change(se
-00024ea0: 6c66 293a 0a20 2020 2020 2020 2074 696d  lf):.        tim
-00024eb0: 655f 7265 7072 203d 2073 656c 662e 5f74  e_repr = self._t
-00024ec0: 696d 655f 7265 7072 2e76 616c 7565 0a20  ime_repr.value. 
-00024ed0: 2020 2020 2020 2077 696e 646f 772e 7369         window.si
-00024ee0: 6d70 6c65 7365 7474 696e 6773 2e73 6574  mplesettings.set
-00024ef0: 2822 7469 6d65 5f72 6570 7222 2c20 7469  ("time_repr", ti
-00024f00: 6d65 5f72 6570 7229 0a0a 2020 2020 6465  me_repr)..    de
-00024f10: 6620 5f6f 6e5f 6475 7261 7469 6f6e 5f72  f _on_duration_r
-00024f20: 6570 725f 6368 616e 6765 2873 656c 6629  epr_change(self)
-00024f30: 3a0a 2020 2020 2020 2020 6475 7261 7469  :.        durati
-00024f40: 6f6e 5f72 6570 7220 3d20 7365 6c66 2e5f  on_repr = self._
-00024f50: 6475 7261 7469 6f6e 5f72 6570 722e 7661  duration_repr.va
-00024f60: 6c75 650a 2020 2020 2020 2020 7769 6e64  lue.        wind
-00024f70: 6f77 2e73 696d 706c 6573 6574 7469 6e67  ow.simplesetting
-00024f80: 732e 7365 7428 2264 7572 6174 696f 6e5f  s.set("duration_
-00024f90: 7265 7072 222c 2064 7572 6174 696f 6e5f  repr", duration_
-00024fa0: 7265 7072 290a 0a20 2020 2064 6566 205f  repr)..    def _
-00024fb0: 6f6e 5f74 6f64 6179 5f73 6e61 705f 6f66  on_today_snap_of
-00024fc0: 6673 6574 5f63 6861 6e67 6528 7365 6c66  fset_change(self
-00024fd0: 293a 0a20 2020 2020 2020 2074 6f64 6179  ):.        today
-00024fe0: 5f73 6e61 705f 6f66 6673 6574 203d 2073  _snap_offset = s
-00024ff0: 656c 662e 5f74 6f64 6179 5f73 6e61 705f  elf._today_snap_
-00025000: 6f66 6673 6574 2e76 616c 7565 0a20 2020  offset.value.   
-00025010: 2020 2020 2077 696e 646f 772e 7369 6d70       window.simp
-00025020: 6c65 7365 7474 696e 6773 2e73 6574 2822  lesettings.set("
-00025030: 746f 6461 795f 736e 6170 5f6f 6666 7365  today_snap_offse
-00025040: 7422 2c20 746f 6461 795f 736e 6170 5f6f  t", today_snap_o
-00025050: 6666 7365 7429 0a0a 2020 2020 6465 6620  ffset)..    def 
-00025060: 5f6f 6e5f 746f 6461 795f 656e 645f 6f66  _on_today_end_of
-00025070: 6673 6574 5f63 6861 6e67 6528 7365 6c66  fset_change(self
-00025080: 293a 0a20 2020 2020 2020 2074 6f64 6179  ):.        today
-00025090: 5f65 6e64 5f6f 6666 7365 7420 3d20 7365  _end_offset = se
-000250a0: 6c66 2e5f 746f 6461 795f 656e 645f 6f66  lf._today_end_of
-000250b0: 6673 6574 2e76 616c 7565 0a20 2020 2020  fset.value.     
-000250c0: 2020 2077 696e 646f 772e 7369 6d70 6c65     window.simple
-000250d0: 7365 7474 696e 6773 2e73 6574 2822 746f  settings.set("to
-000250e0: 6461 795f 656e 645f 6f66 6673 6574 222c  day_end_offset",
-000250f0: 2074 6f64 6179 5f65 6e64 5f6f 6666 7365   today_end_offse
-00025100: 7429 0a0a 2020 2020 6465 6620 5f6f 6e5f  t)..    def _on_
-00025110: 6461 726b 6d6f 6465 5f63 6861 6e67 6528  darkmode_change(
-00025120: 7365 6c66 293a 0a20 2020 2020 2020 2064  self):.        d
-00025130: 6172 6b6d 6f64 6520 3d20 696e 7428 7365  arkmode = int(se
-00025140: 6c66 2e5f 6461 726b 6d6f 6465 5f73 656c  lf._darkmode_sel
-00025150: 6563 742e 7661 6c75 6529 0a20 2020 2020  ect.value).     
-00025160: 2020 2077 696e 646f 772e 7369 6d70 6c65     window.simple
-00025170: 7365 7474 696e 6773 2e73 6574 2822 6461  settings.set("da
-00025180: 726b 6d6f 6465 222c 2064 6172 6b6d 6f64  rkmode", darkmod
-00025190: 6529 0a20 2020 2020 2020 2069 6620 7769  e).        if wi
-000251a0: 6e64 6f77 2e66 726f 6e74 3a0a 2020 2020  ndow.front:.    
-000251b0: 2020 2020 2020 2020 7769 6e64 6f77 2e66          window.f
-000251c0: 726f 6e74 2e73 6574 5f63 6f6c 6f72 7328  ront.set_colors(
-000251d0: 290a 0a20 2020 2064 6566 205f 6f6e 5f77  )..    def _on_w
-000251e0: 6964 7468 5f6d 6f64 655f 6368 616e 6765  idth_mode_change
-000251f0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00025200: 7769 6474 685f 6d6f 6465 203d 2073 656c  width_mode = sel
-00025210: 662e 5f77 6964 7468 5f6d 6f64 655f 7365  f._width_mode_se
-00025220: 6c65 6374 2e76 616c 7565 0a20 2020 2020  lect.value.     
-00025230: 2020 2077 696e 646f 772e 7369 6d70 6c65     window.simple
-00025240: 7365 7474 696e 6773 2e73 6574 2822 7769  settings.set("wi
-00025250: 6474 685f 6d6f 6465 222c 2077 6964 7468  dth_mode", width
-00025260: 5f6d 6f64 6529 0a20 2020 2020 2020 2069  _mode).        i
-00025270: 6620 7769 6e64 6f77 2e66 726f 6e74 3a0a  f window.front:.
-00025280: 2020 2020 2020 2020 2020 2020 7769 6e64              wind
-00025290: 6f77 2e66 726f 6e74 2e73 6574 5f77 6964  ow.front.set_wid
-000252a0: 7468 5f6d 6f64 6528 7769 6474 685f 6d6f  th_mode(width_mo
-000252b0: 6465 290a 2020 2020 2020 2020 2020 2020  de).            
-000252c0: 7365 6c66 2e5f 6361 6e76 6173 2e5f 6f6e  self._canvas._on
-000252d0: 5f6a 735f 7265 7369 7a65 5f65 7665 6e74  _js_resize_event
-000252e0: 2829 2020 2320 7072 6976 6174 6520 6d65  ()  # private me
-000252f0: 7468 6f64 2c20 6275 7420 6168 2077 656c  thod, but ah wel
-00025300: 6c0a 0a20 2020 2064 6566 205f 6f6e 5f70  l..    def _on_p
-00025310: 6f6d 6f64 6f72 6f5f 6368 6563 6b28 7365  omodoro_check(se
-00025320: 6c66 293a 0a20 2020 2020 2020 2070 6f6d  lf):.        pom
-00025330: 6f5f 656e 6162 6c65 6420 3d20 626f 6f6c  o_enabled = bool
-00025340: 2873 656c 662e 5f70 6f6d 6f64 6f72 6f5f  (self._pomodoro_
-00025350: 6368 6563 6b2e 6368 6563 6b65 6429 0a20  check.checked). 
-00025360: 2020 2020 2020 2077 696e 646f 772e 7369         window.si
-00025370: 6d70 6c65 7365 7474 696e 6773 2e73 6574  mplesettings.set
-00025380: 2822 706f 6d6f 646f 726f 5f65 6e61 626c  ("pomodoro_enabl
-00025390: 6564 222c 2070 6f6d 6f5f 656e 6162 6c65  ed", pomo_enable
-000253a0: 6429 0a0a 2020 2020 6465 6620 5f6f 6e5f  d)..    def _on_
-000253b0: 7374 6f70 7761 7463 685f 6368 6563 6b28  stopwatch_check(
-000253c0: 7365 6c66 293a 0a20 2020 2020 2020 2073  self):.        s
-000253d0: 686f 775f 7374 6f70 7761 7463 6820 3d20  how_stopwatch = 
-000253e0: 626f 6f6c 2873 656c 662e 5f73 746f 7077  bool(self._stopw
-000253f0: 6174 6368 5f63 6865 636b 2e63 6865 636b  atch_check.check
-00025400: 6564 290a 2020 2020 2020 2020 7769 6e64  ed).        wind
-00025410: 6f77 2e73 696d 706c 6573 6574 7469 6e67  ow.simplesetting
-00025420: 732e 7365 7428 2273 686f 775f 7374 6f70  s.set("show_stop
-00025430: 7761 7463 6822 2c20 7368 6f77 5f73 746f  watch", show_sto
-00025440: 7077 6174 6368 290a 0a0a 636c 6173 7320  pwatch)...class 
-00025450: 4775 6964 6544 6961 6c6f 6728 4261 7365  GuideDialog(Base
-00025460: 4469 616c 6f67 293a 0a20 2020 2022 2222  Dialog):.    """
-00025470: 4469 616c 6f67 2074 6f20 6861 7665 2071  Dialog to have q
-00025480: 7569 636b 2061 6363 6573 7320 746f 2074  uick access to t
-00025490: 6865 2067 7569 6465 2e22 2222 0a0a 2020  he guide."""..  
-000254a0: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-000254b0: 656c 662c 2063 616e 7661 7329 3a0a 2020  elf, canvas):.  
-000254c0: 2020 2020 2020 7375 7065 7228 292e 5f5f        super().__
-000254d0: 696e 6974 5f5f 2863 616e 7661 7329 0a20  init__(canvas). 
-000254e0: 2020 2020 2020 2073 656c 662e 696e 6974         self.init
-000254f0: 6961 6c69 7a65 6420 3d20 300a 0a20 2020  ialized = 0..   
-00025500: 2064 6566 206f 7065 6e28 7365 6c66 2c20   def open(self, 
-00025510: 6361 6c6c 6261 636b 3d4e 6f6e 6529 3a0a  callback=None):.
-00025520: 2020 2020 2020 2020 2320 4f6e 6c79 2069          # Only i
-00025530: 6e69 7420 6f6e 6365 2c20 736f 2074 6861  nit once, so tha
-00025540: 7420 7468 6520 6775 6964 6520 7374 6179  t the guide stay
-00025550: 7320 696e 2074 6865 2073 7461 7465 2061  s in the state a
-00025560: 7320 7468 650a 2020 2020 2020 2020 2320  s the.        # 
-00025570: 7573 6572 2074 7269 6573 2073 6f6d 6574  user tries somet
-00025580: 6869 6e67 2061 6e64 2074 6865 6e20 6f70  hing and then op
-00025590: 656e 7320 6974 2061 6761 696e 2e20 5570  ens it again. Up
-000255a0: 2074 6f20 3234 2068 6f75 7273 2e0a 2020   to 24 hours..  
-000255b0: 2020 2020 2020 6966 2064 742e 6e6f 7728        if dt.now(
-000255c0: 2920 3c20 7365 6c66 2e69 6e69 7469 616c  ) < self.initial
-000255d0: 697a 6564 202b 2038 3634 3030 3a0a 2020  ized + 86400:.  
-000255e0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000255f0: 2073 7570 6572 2829 2e6f 7065 6e28 6361   super().open(ca
-00025600: 6c6c 6261 636b 290a 2020 2020 2020 2020  llback).        
-00025610: 7365 6c66 2e69 6e69 7469 616c 697a 6564  self.initialized
-00025620: 203d 2064 742e 6e6f 7728 290a 0a20 2020   = dt.now()..   
-00025630: 2020 2020 2073 656c 662e 6d61 696e 6469       self.maindi
-00025640: 762e 696e 6e65 7248 544d 4c20 3d20 2222  v.innerHTML = ""
-00025650: 220a 2020 2020 2020 2020 2020 2020 3c68  ".            <h
-00025660: 313e 3c69 2063 6c61 7373 3d27 6661 7327  1><i class='fas'
-00025670: 3e5c 7566 3035 613c 2f69 3e26 6e62 7370  >\uf05a</i>&nbsp
-00025680: 3b26 6e62 7370 3b47 7569 6465 0a20 2020  ;&nbsp;Guide.   
-00025690: 2020 2020 2020 2020 2020 2020 203c 6275               <bu
-000256a0: 7474 6f6e 2074 7970 653d 2762 7574 746f  tton type='butto
-000256b0: 6e27 3e3c 6920 636c 6173 733d 2766 6173  n'><i class='fas
-000256c0: 273e 5c75 6630 3064 3c2f 693e 3c2f 6275  '>\uf00d</i></bu
-000256d0: 7474 6f6e 3e0a 2020 2020 2020 2020 2020  tton>.          
-000256e0: 2020 3c2f 6831 3e0a 2020 2020 2020 2020    </h1>.        
-000256f0: 2020 2020 3c69 6672 616d 6520 7372 633d      <iframe src=
-00025700: 2768 7474 7073 3a2f 2f74 696d 6574 6167  'https://timetag
-00025710: 6765 722e 6170 702f 6775 6964 655f 6865  ger.app/guide_he
-00025720: 6164 6c65 7373 270a 2020 2020 2020 2020  adless'.        
-00025730: 2020 2020 6469 7370 6c61 793a 626c 6f63      display:bloc
-00025740: 6b3b 2073 7479 6c65 3d27 7769 6474 683a  k; style='width:
-00025750: 3130 3025 3b20 6865 6967 6874 3a63 616c  100%; height:cal
-00025760: 6328 3930 7668 202d 2031 3030 7078 293b  c(90vh - 100px);
-00025770: 2062 6f72 6465 723a 6e6f 6e65 3b27 0a20   border:none;'. 
-00025780: 2020 2020 2020 2020 2020 202f 3e0a 2020             />.  
-00025790: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-000257a0: 2020 2073 656c 662e 5f63 616e 6365 6c5f     self._cancel_
-000257b0: 6275 7420 3d20 7365 6c66 2e6d 6169 6e64  but = self.maind
-000257c0: 6976 2e63 6869 6c64 7265 6e5b 305d 2e63  iv.children[0].c
-000257d0: 6869 6c64 7265 6e5b 2d31 5d0a 2020 2020  hildren[-1].    
-000257e0: 2020 2020 7365 6c66 2e5f 6361 6e63 656c      self._cancel
-000257f0: 5f62 7574 2e6f 6e63 6c69 636b 203d 2073  _but.onclick = s
-00025800: 656c 662e 636c 6f73 650a 2020 2020 2020  elf.close.      
-00025810: 2020 7375 7065 7228 292e 6f70 656e 2863    super().open(c
-00025820: 616c 6c62 6163 6b29 0a0a 0a63 6c61 7373  allback)...class
-00025830: 2050 6f6d 6f64 6f72 6f44 6961 6c6f 6728   PomodoroDialog(
-00025840: 4261 7365 4469 616c 6f67 293a 0a20 2020  BaseDialog):.   
-00025850: 2022 2222 4469 616c 6f67 2074 6f20 636f   """Dialog to co
-00025860: 6e74 726f 6c20 7468 6520 506f 6d6f 646f  ntrol the Pomodo
-00025870: 726f 2074 696d 6572 2e22 2222 0a0a 2020  ro timer."""..  
-00025880: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-00025890: 656c 662c 2063 616e 7661 7329 3a0a 2020  elf, canvas):.  
-000258a0: 2020 2020 2020 7375 7065 7228 292e 5f5f        super().__
-000258b0: 696e 6974 5f5f 2863 616e 7661 7329 0a0a  init__(canvas)..
-000258c0: 2020 2020 2020 2020 2320 4e6f 7465 2074          # Note t
-000258d0: 6861 7420 7765 2061 7373 756d 6520 7468  hat we assume th
-000258e0: 6174 2074 6869 7320 6973 2074 6865 206f  at this is the o
-000258f0: 6e6c 7920 636f 6465 2074 6f75 6368 696e  nly code touchin
-00025900: 6720 7468 6520 646f 6375 6d65 6e74 2074  g the document t
-00025910: 6974 6c65 0a20 2020 2020 2020 2073 656c  itle.        sel
-00025920: 662e 5f6f 7269 6769 6e61 6c5f 7469 746c  f._original_titl
-00025930: 6520 3d20 7769 6e64 6f77 2e64 6f63 756d  e = window.docum
-00025940: 656e 742e 7469 746c 650a 0a20 2020 2020  ent.title..     
-00025950: 2020 2023 2049 6e69 740a 2020 2020 2020     # Init.      
-00025960: 2020 7365 6c66 2e5f 696e 6974 2829 0a20    self._init(). 
-00025970: 2020 2020 2020 2073 656c 662e 5f73 6574         self._set
-00025980: 5f73 7461 7465 2822 7072 652d 776f 726b  _state("pre-work
-00025990: 2229 0a0a 2020 2020 2020 2020 2320 5365  ")..        # Se
-000259a0: 7475 7020 6361 6c6c 6261 636b 730a 2020  tup callbacks.  
-000259b0: 2020 2020 2020 7769 6e64 6f77 2e73 6574        window.set
-000259c0: 496e 7465 7276 616c 2873 656c 662e 5f75  Interval(self._u
-000259d0: 7064 6174 652c 2032 3530 290a 2020 2020  pdate, 250).    
-000259e0: 2020 2020 7769 6e64 6f77 2e64 6f63 756d      window.docum
-000259f0: 656e 742e 6164 6445 7665 6e74 4c69 7374  ent.addEventList
-00025a00: 656e 6572 2822 7669 7369 6269 6c69 7479  ener("visibility
-00025a10: 6368 616e 6765 222c 2073 656c 662e 5f75  change", self._u
-00025a20: 7064 6174 6529 0a20 2020 2020 2020 2069  pdate).        i
-00025a30: 6620 7769 6e64 6f77 2e6e 6176 6967 6174  f window.navigat
-00025a40: 6f72 2e73 6572 7669 6365 576f 726b 6572  or.serviceWorker
-00025a50: 3a0a 2020 2020 2020 2020 2020 2020 7472  :.            tr
-00025a60: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-00025a70: 2020 2077 696e 646f 772e 6e61 7669 6761     window.naviga
-00025a80: 746f 722e 7365 7276 6963 6557 6f72 6b65  tor.serviceWorke
-00025a90: 722e 6164 6445 7665 6e74 4c69 7374 656e  r.addEventListen
-00025aa0: 6572 280a 2020 2020 2020 2020 2020 2020  er(.            
-00025ab0: 2020 2020 2020 2020 226d 6573 7361 6765          "message
-00025ac0: 222c 2073 656c 662e 6f6e 5f6e 6f74 6966  ", self.on_notif
-00025ad0: 6963 6174 696f 6e63 6c69 636b 0a20 2020  icationclick.   
-00025ae0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-00025af0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00025b00: 7420 4578 6365 7074 696f 6e3a 0a20 2020  t Exception:.   
-00025b10: 2020 2020 2020 2020 2020 2020 2070 6173               pas
-00025b20: 730a 0a20 2020 2020 2020 2023 2050 7265  s..        # Pre
-00025b30: 7061 7265 2073 6f75 6e64 730a 2020 2020  pare sounds.    
-00025b40: 2020 2020 7365 6c66 2e5f 736f 756e 6473      self._sounds
-00025b50: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
-00025b60: 2022 7769 6e64 223a 2041 7564 696f 2822   "wind": Audio("
-00025b70: 7769 6e64 2d75 702d 312d 3533 342e 6f67  wind-up-1-534.og
-00025b80: 6722 292c 0a20 2020 2020 2020 2020 2020  g"),.           
-00025b90: 2022 776f 726b 5f65 6e64 223a 2041 7564   "work_end": Aud
-00025ba0: 696f 2822 6576 656e 7475 616c 6c79 2d35  io("eventually-5
-00025bb0: 3930 2e6f 6767 2229 2c0a 2020 2020 2020  90.ogg"),.      
-00025bc0: 2020 2020 2020 2262 7265 616b 5f65 6e64        "break_end
-00025bd0: 223a 2041 7564 696f 2822 6576 656e 7475  ": Audio("eventu
-00025be0: 616c 6c79 2d35 3930 2e6f 6767 2229 2c0a  ally-590.ogg"),.
-00025bf0: 2020 2020 2020 2020 2020 2020 226d 616e              "man
-00025c00: 7561 6c5f 656e 6422 3a20 4175 6469 6f28  ual_end": Audio(
-00025c10: 2263 6c65 6172 6c79 2d36 3032 2e6f 6767  "clearly-602.ogg
-00025c20: 2229 2c0a 2020 2020 2020 2020 7d0a 0a20  "),.        }.. 
-00025c30: 2020 2064 6566 205f 696e 6974 2873 656c     def _init(sel
-00025c40: 6629 3a0a 2020 2020 2020 2020 6874 6d6c  f):.        html
-00025c50: 203d 2066 2222 220a 2020 2020 2020 2020   = f""".        
-00025c60: 2020 2020 3c68 313e 3c69 2063 6c61 7373      <h1><i class
-00025c70: 3d27 6661 7327 3e5c 7566 3266 323c 2f69  ='fas'>\uf2f2</i
-00025c80: 3e26 6e62 7370 3b26 6e62 7370 3b50 6f6d  >&nbsp;&nbsp;Pom
-00025c90: 6f64 6f72 6f0a 2020 2020 2020 2020 2020  odoro.          
-00025ca0: 2020 2020 2020 3c62 7574 746f 6e20 7479        <button ty
-00025cb0: 7065 3d27 6275 7474 6f6e 273e 3c69 2063  pe='button'><i c
-00025cc0: 6c61 7373 3d27 6661 7327 3e5c 7566 3030  lass='fas'>\uf00
-00025cd0: 643c 2f69 3e3c 2f62 7574 746f 6e3e 0a20  d</i></button>. 
-00025ce0: 2020 2020 2020 2020 2020 203c 2f68 313e             </h1>
-00025cf0: 0a20 2020 2020 2020 2020 2020 203c 6365  .            <ce
-00025d00: 6e74 6572 3e0a 2020 2020 2020 2020 2020  nter>.          
-00025d10: 2020 2020 2020 3c64 6976 2073 7479 6c65        <div style
-00025d20: 3d27 6d61 7267 696e 3a20 3165 6d3b 2066  ='margin: 1em; f
-00025d30: 6f6e 742d 7369 7a65 3a20 3134 3025 3b27  ont-size: 140%;'
-00025d40: 3e32 353a 3030 3c2f 6469 763e 0a20 2020  >25:00</div>.   
-00025d50: 2020 2020 2020 2020 2020 2020 203c 6275               <bu
-00025d60: 7474 6f6e 2074 7970 653d 2762 7574 746f  tton type='butto
-00025d70: 6e27 2063 6c61 7373 3d27 6163 7469 6f6e  n' class='action
-00025d80: 6275 7474 6f6e 2720 7374 796c 653d 276d  button' style='m
-00025d90: 6172 6769 6e3a 2031 656d 3b27 3e53 7461  argin: 1em;'>Sta
-00025da0: 7274 3c2f 6275 7474 6f6e 3e0a 2020 2020  rt</button>.    
-00025db0: 2020 2020 2020 2020 3c2f 6365 6e74 6572          </center
-00025dc0: 3e0a 2020 2020 2020 2020 2020 2020 3c64  >.            <d
-00025dd0: 6574 6169 6c73 2073 7479 6c65 3d27 636f  etails style='co
-00025de0: 6c6f 723a 2023 3737 373b 206d 6172 6769  lor: #777; margi
-00025df0: 6e3a 2031 656d 3b20 666f 6e74 2d73 697a  n: 1em; font-siz
-00025e00: 653a 2038 3725 3b27 3e0a 2020 2020 2020  e: 87%;'>.      
-00025e10: 2020 2020 2020 3c73 756d 6d61 7279 2073        <summary s
-00025e20: 7479 6c65 3d27 6375 7273 6f72 3a20 706f  tyle='cursor: po
-00025e30: 696e 7465 723b 273e 5468 6520 506f 6d6f  inter;'>The Pomo
-00025e40: 646f 726f 2054 6563 686e 6971 7565 3c2f  doro Technique</
-00025e50: 7375 6d6d 6172 793e 0a20 2020 2020 2020  summary>.       
-00025e60: 2020 2020 203c 703e 0a20 2020 2020 2020       <p>.       
-00025e70: 2020 2020 2054 6865 2050 6f6d 6f64 6f72       The Pomodor
-00025e80: 6f20 5465 6368 6e69 7175 6520 6973 2061  o Technique is a
-00025e90: 2074 696d 6520 6d61 6e61 6765 6d65 6e74   time management
-00025ea0: 206d 6574 686f 6420 7768 6572 6520 796f   method where yo
-00025eb0: 750a 2020 2020 2020 2020 2020 2020 616c  u.            al
-00025ec0: 7465 726e 6174 6520 6265 7477 6565 6e20  ternate between 
-00025ed0: 3235 206d 696e 7574 6573 206f 6620 776f  25 minutes of wo
-00025ee0: 726b 2061 6e64 2035 206d 696e 7574 6520  rk and 5 minute 
-00025ef0: 6272 6561 6b73 2e0a 2020 2020 2020 2020  breaks..        
-00025f00: 2020 2020 4974 2069 7320 7265 636f 6d6d      It is recomm
-00025f10: 656e 6465 6420 746f 2075 7365 2062 7265  ended to use bre
-00025f20: 616b 7320 746f 206c 6561 7665 2079 6f75  aks to leave you
-00025f30: 7220 6368 6169 7220 6966 2079 6f75 0a20  r chair if you. 
-00025f40: 2020 2020 2020 2020 2020 2073 6974 2064             sit d
-00025f50: 7572 696e 6720 776f 726b 2e20 5365 650a  uring work. See.
-00025f60: 2020 2020 2020 2020 2020 2020 3c61 2068              <a h
-00025f70: 7265 663d 2768 7474 7073 3a2f 2f74 696d  ref='https://tim
-00025f80: 6574 6167 6765 722e 6170 702f 706f 6d6f  etagger.app/pomo
-00025f90: 646f 726f 2f27 2074 6172 6765 743d 276e  doro/' target='n
-00025fa0: 6577 273e 7468 6973 2061 7274 6963 6c65  ew'>this article
-00025fb0: 3c2f 613e 0a20 2020 2020 2020 2020 2020  </a>.           
-00025fc0: 2066 6f72 206d 6f72 6520 696e 666f 2e0a   for more info..
-00025fd0: 2020 2020 2020 2020 2020 2020 3c2f 703e              </p>
-00025fe0: 3c70 3e0a 2020 2020 2020 2020 2020 2020  <p>.            
-00025ff0: 5468 6520 506f 6d6f 646f 726f 2074 696d  The Pomodoro tim
-00026000: 6572 2069 7320 6175 746f 6d61 7469 6361  er is automatica
-00026010: 6c6c 7920 7374 6172 7465 6420 616e 6420  lly started and 
-00026020: 7374 6f70 7065 6420 6173 2079 6f75 0a20  stopped as you. 
-00026030: 2020 2020 2020 2020 2020 2073 7461 7274             start
-00026040: 2f73 746f 7020 7472 6163 6b69 6e67 2074  /stop tracking t
-00026050: 696d 652e 2054 6869 7320 6665 6174 7572  ime. This featur
-00026060: 6520 6973 2065 7870 6572 696d 656e 7461  e is experimenta
-00026070: 6c20 2d20 646f 0a20 2020 2020 2020 2020  l - do.         
-00026080: 2020 206c 6574 2075 7320 6b6e 6f77 2061     let us know a
-00026090: 626f 7574 2070 726f 626c 656d 7320 616e  bout problems an
-000260a0: 6420 7375 6767 6573 7469 6f6e 7321 0a20  d suggestions!. 
-000260b0: 2020 2020 2020 2020 2020 203c 2f70 3e3c             </p><
-000260c0: 703e 0a20 2020 2020 2020 2020 2020 2055  p>.            U
-000260d0: 7369 6e67 2073 6f75 6e64 7320 6672 6f6d  sing sounds from
-000260e0: 206e 6f74 6966 6963 6174 696f 6e73 6f75   notificationsou
-000260f0: 6e64 732e 636f 6d2e 0a20 2020 2020 2020  nds.com..       
-00026100: 2020 2020 203c 2f70 3e3c 2f64 6574 6169       </p></detai
-00026110: 6c73 3e0a 2020 2020 2020 2020 2020 2020  ls>.            
-00026120: 2222 220a 0a20 2020 2020 2020 2073 656c  """..        sel
-00026130: 662e 6d61 696e 6469 762e 696e 6e65 7248  f.maindiv.innerH
-00026140: 544d 4c20 3d20 6874 6d6c 0a0a 2020 2020  TML = html..    
-00026150: 2020 2020 7365 6c66 2e5f 636c 6f73 655f      self._close_
-00026160: 6275 7420 3d20 7365 6c66 2e6d 6169 6e64  but = self.maind
-00026170: 6976 2e63 6869 6c64 7265 6e5b 305d 2e63  iv.children[0].c
-00026180: 6869 6c64 7265 6e5b 2d31 5d0a 2020 2020  hildren[-1].    
-00026190: 2020 2020 7365 6c66 2e5f 636c 6f73 655f      self._close_
-000261a0: 6275 742e 6f6e 636c 6963 6b20 3d20 7365  but.onclick = se
-000261b0: 6c66 2e63 6c6f 7365 0a20 2020 2020 2020  lf.close.       
-000261c0: 2028 0a20 2020 2020 2020 2020 2020 2073   (.            s
-000261d0: 656c 662e 5f6c 6162 656c 2c0a 2020 2020  elf._label,.    
-000261e0: 2020 2020 2020 2020 7365 6c66 2e5f 6275          self._bu
-000261f0: 7474 6f6e 2c0a 2020 2020 2020 2020 2920  tton,.        ) 
-00026200: 3d20 7365 6c66 2e6d 6169 6e64 6976 2e63  = self.maindiv.c
-00026210: 6869 6c64 7265 6e5b 315d 2e63 6869 6c64  hildren[1].child
-00026220: 7265 6e0a 0a20 2020 2020 2020 2073 656c  ren..        sel
-00026230: 662e 5f62 7574 746f 6e2e 6f6e 636c 6963  f._button.onclic
-00026240: 6b20 3d20 7365 6c66 2e5f 6f6e 5f62 7574  k = self._on_but
-00026250: 746f 6e5f 636c 6963 6b0a 0a20 2020 2064  ton_click..    d
-00026260: 6566 206f 7065 6e28 7365 6c66 2c20 6361  ef open(self, ca
-00026270: 6c6c 6261 636b 3d4e 6f6e 6529 3a0a 2020  llback=None):.  
-00026280: 2020 2020 2020 7375 7065 7228 292e 6f70        super().op
-00026290: 656e 2863 616c 6c62 6163 6b29 0a20 2020  en(callback).   
-000262a0: 2020 2020 2073 656c 662e 5f75 7064 6174       self._updat
-000262b0: 6528 290a 0a20 2020 2064 6566 205f 706c  e()..    def _pl
-000262c0: 6179 5f73 6f75 6e64 2873 656c 662c 2073  ay_sound(self, s
-000262d0: 6f75 6e64 293a 0a20 2020 2020 2020 2061  ound):.        a
-000262e0: 7564 696f 203d 2073 656c 662e 5f73 6f75  udio = self._sou
-000262f0: 6e64 735b 736f 756e 645d 0a20 2020 2020  nds[sound].     
-00026300: 2020 2069 6620 6175 6469 6f2e 6375 7272     if audio.curr
-00026310: 656e 7454 696d 653a 0a20 2020 2020 2020  entTime:.       
-00026320: 2020 2020 2061 7564 696f 2e63 7572 7265       audio.curre
-00026330: 6e74 5469 6d65 203d 2030 0a20 2020 2020  ntTime = 0.     
-00026340: 2020 2070 726f 6d69 7365 203d 2061 7564     promise = aud
-00026350: 696f 2e70 6c61 7928 290a 2020 2020 2020  io.play().      
-00026360: 2020 2320 4361 7463 6820 7768 656e 2070    # Catch when p
-00026370: 6c61 7969 6e67 2074 6865 2073 6f75 6e64  laying the sound
-00026380: 2066 6169 6c65 642c 2074 6f20 6176 6f69   failed, to avoi
-00026390: 6420 226e 6861 6e64 6c65 6420 5072 6f6d  d "nhandled Prom
-000263a0: 6973 6520 5265 6a65 6374 696f 6e22 0a20  ise Rejection". 
-000263b0: 2020 2020 2020 2069 6620 7072 6f6d 6973         if promis
-000263c0: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
-000263d0: 726f 6d69 7365 2e63 6174 6368 286c 616d  romise.catch(lam
-000263e0: 6264 6120 6572 723a 204e 6f6e 6529 0a0a  bda err: None)..
-000263f0: 2020 2020 6465 6620 5f73 6574 5f73 7461      def _set_sta
-00026400: 7465 2873 656c 662c 2073 7461 7465 293a  te(self, state):
-00026410: 0a20 2020 2020 2020 2069 6620 7374 6174  .        if stat
-00026420: 6520 3d3d 2022 7072 652d 776f 726b 223a  e == "pre-work":
-00026430: 0a20 2020 2020 2020 2020 2020 2065 7469  .            eti
-00026440: 6d65 203d 2030 0a20 2020 2020 2020 2020  me = 0.         
-00026450: 2020 2070 7265 7469 746c 6520 3d20 2222     pretitle = ""
-00026460: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00026470: 662e 5f62 7574 746f 6e2e 696e 6e65 7248  f._button.innerH
-00026480: 544d 4c20 3d20 2253 7461 7274 2077 6f72  TML = "Start wor
-00026490: 6b69 6e67 220a 2020 2020 2020 2020 656c  king".        el
-000264a0: 6966 2073 7461 7465 203d 3d20 2277 6f72  if state == "wor
-000264b0: 6b22 3a0a 2020 2020 2020 2020 2020 2020  k":.            
-000264c0: 6574 696d 6520 3d20 6474 2e6e 6f77 2829  etime = dt.now()
-000264d0: 202b 2032 3520 2a20 3630 0a20 2020 2020   + 25 * 60.     
-000264e0: 2020 2020 2020 2070 7265 7469 746c 6520         pretitle 
-000264f0: 3d20 2257 6f72 6b69 6e67 207c 2022 0a20  = "Working | ". 
-00026500: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00026510: 5f62 7574 746f 6e2e 696e 6e65 7248 544d  _button.innerHTM
-00026520: 4c20 3d20 2253 746f 7022 0a20 2020 2020  L = "Stop".     
-00026530: 2020 2065 6c69 6620 7374 6174 6520 3d3d     elif state ==
-00026540: 2022 7072 652d 6272 6561 6b22 3a0a 2020   "pre-break":.  
-00026550: 2020 2020 2020 2020 2020 6574 696d 6520            etime 
-00026560: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
-00026570: 7072 6574 6974 6c65 203d 2022 220a 2020  pretitle = "".  
-00026580: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00026590: 6275 7474 6f6e 2e69 6e6e 6572 4854 4d4c  button.innerHTML
-000265a0: 203d 2022 5374 6172 7420 6272 6561 6b22   = "Start break"
-000265b0: 0a20 2020 2020 2020 2065 6c69 6620 7374  .        elif st
-000265c0: 6174 6520 3d3d 2022 6272 6561 6b22 3a0a  ate == "break":.
-000265d0: 2020 2020 2020 2020 2020 2020 6574 696d              etim
-000265e0: 6520 3d20 6474 2e6e 6f77 2829 202b 2035  e = dt.now() + 5
-000265f0: 202a 2036 300a 2020 2020 2020 2020 2020   * 60.          
-00026600: 2020 7072 6574 6974 6c65 203d 2022 4272    pretitle = "Br
-00026610: 6561 6b20 7c20 220a 2020 2020 2020 2020  eak | ".        
-00026620: 2020 2020 7365 6c66 2e5f 6275 7474 6f6e      self._button
-00026630: 2e69 6e6e 6572 4854 4d4c 203d 2022 5374  .innerHTML = "St
-00026640: 6f70 220a 2020 2020 2020 2020 656c 7365  op".        else
-00026650: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-00026660: 6e73 6f6c 652e 7761 726e 2822 496e 7661  nsole.warn("Inva
-00026670: 6c69 6420 706f 6d6f 646f 726f 2073 7461  lid pomodoro sta
-00026680: 7465 3a20 2220 2b20 7374 6174 6529 0a20  te: " + state). 
-00026690: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000266a0: 6e0a 2020 2020 2020 2020 7769 6e64 6f77  n.        window
-000266b0: 2e64 6f63 756d 656e 742e 7469 746c 6520  .document.title 
-000266c0: 3d20 7072 6574 6974 6c65 202b 2073 656c  = pretitle + sel
-000266d0: 662e 5f6f 7269 6769 6e61 6c5f 7469 746c  f._original_titl
-000266e0: 650a 2020 2020 2020 2020 7365 6c66 2e5f  e.        self._
-000266f0: 7374 6174 6520 3d20 7374 6174 652c 2065  state = state, e
-00026700: 7469 6d65 0a20 2020 2020 2020 2073 656c  time.        sel
-00026710: 662e 5f75 7064 6174 6528 290a 0a20 2020  f._update()..   
-00026720: 2064 6566 2074 696d 655f 6c65 6674 2873   def time_left(s
-00026730: 656c 6629 3a0a 2020 2020 2020 2020 6574  elf):.        et
-00026740: 696d 6520 3d20 7365 6c66 2e5f 7374 6174  ime = self._stat
-00026750: 655b 315d 0a20 2020 2020 2020 206c 6566  e[1].        lef
-00026760: 7420 3d20 6d61 7828 302c 2065 7469 6d65  t = max(0, etime
-00026770: 202d 2064 742e 6e6f 7728 2929 0a20 2020   - dt.now()).   
-00026780: 2020 2020 2069 6620 6c65 6674 3a0a 2020       if left:.  
-00026790: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000267a0: 2073 656c 662e 5f73 7461 7465 5b30 5d20   self._state[0] 
-000267b0: 2b20 223a 2022 202b 2064 742e 6475 7261  + ": " + dt.dura
-000267c0: 7469 6f6e 5f73 7472 696e 6728 6c65 6674  tion_string(left
-000267d0: 2c20 5472 7565 290a 2020 2020 2020 2020  , True).        
-000267e0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-000267f0: 2020 7265 7475 726e 204e 6f6e 650a 0a20    return None.. 
-00026800: 2020 2064 6566 2073 7461 7274 5f77 6f72     def start_wor
-00026810: 6b28 7365 6c66 293a 0a20 2020 2020 2020  k(self):.       
-00026820: 2073 656c 662e 5f73 6574 5f73 7461 7465   self._set_state
-00026830: 2822 776f 726b 2229 0a0a 2020 2020 2020  ("work")..      
-00026840: 2020 2320 4e6f 7720 6973 2061 2067 6f6f    # Now is a goo
-00026850: 6420 7469 6d65 2074 6f20 6173 6b20 666f  d time to ask fo
-00026860: 7220 7065 726d 6973 7369 6f6e 2c0a 2020  r permission,.  
-00026870: 2020 2020 2020 2320 6173 7375 6d69 6e67        # assuming
-00026880: 2074 6861 7420 7468 6973 2063 616c 6c20   that this call 
-00026890: 6f72 6967 696e 616c 6c79 2063 616d 6520  originally came 
-000268a0: 6672 6f6d 2061 2075 7365 7227 7320 6d6f  from a user's mo
-000268b0: 7573 6520 636c 6963 6b2e 0a20 2020 2020  use click..     
-000268c0: 2020 2069 6620 7769 6e64 6f77 2e4e 6f74     if window.Not
-000268d0: 6966 6963 6174 696f 6e20 616e 6420 7769  ification and wi
-000268e0: 6e64 6f77 2e4e 6f74 6966 6963 6174 696f  ndow.Notificatio
-000268f0: 6e2e 7065 726d 6973 7369 6f6e 203d 3d20  n.permission == 
-00026900: 2264 6566 6175 6c74 223a 0a20 2020 2020  "default":.     
-00026910: 2020 2020 2020 204e 6f74 6966 6963 6174         Notificat
-00026920: 696f 6e2e 7265 7175 6573 7450 6572 6d69  ion.requestPermi
-00026930: 7373 696f 6e28 290a 0a20 2020 2020 2020  ssion()..       
-00026940: 2073 656c 662e 5f70 6c61 795f 736f 756e   self._play_soun
-00026950: 6428 2277 696e 6422 290a 0a20 2020 2064  d("wind")..    d
-00026960: 6566 2073 746f 7028 7365 6c66 293a 0a20  ef stop(self):. 
-00026970: 2020 2020 2020 2073 656c 662e 5f73 6574         self._set
-00026980: 5f73 7461 7465 2822 7072 652d 776f 726b  _state("pre-work
-00026990: 2229 0a0a 2020 2020 6465 6620 5f6f 6e5f  ")..    def _on_
-000269a0: 6275 7474 6f6e 5f63 6c69 636b 2873 656c  button_click(sel
-000269b0: 6629 3a0a 2020 2020 2020 2020 7374 6174  f):.        stat
-000269c0: 652c 2065 7469 6d65 203d 2073 656c 662e  e, etime = self.
-000269d0: 5f73 7461 7465 0a20 2020 2020 2020 2069  _state.        i
-000269e0: 6620 7374 6174 6520 3d3d 2022 7072 652d  f state == "pre-
-000269f0: 776f 726b 223a 0a20 2020 2020 2020 2020  work":.         
-00026a00: 2020 2073 656c 662e 7374 6172 745f 776f     self.start_wo
-00026a10: 726b 2829 0a20 2020 2020 2020 2065 6c69  rk().        eli
-00026a20: 6620 7374 6174 6520 3d3d 2022 776f 726b  f state == "work
-00026a30: 223a 0a20 2020 2020 2020 2020 2020 2073  ":.            s
-00026a40: 656c 662e 5f73 6574 5f73 7461 7465 2822  elf._set_state("
-00026a50: 7072 652d 6272 6561 6b22 290a 2020 2020  pre-break").    
-00026a60: 2020 2020 2020 2020 7365 6c66 2e5f 706c          self._pl
-00026a70: 6179 5f73 6f75 6e64 2822 6d61 6e75 616c  ay_sound("manual
-00026a80: 5f65 6e64 2229 0a20 2020 2020 2020 2065  _end").        e
-00026a90: 6c69 6620 7374 6174 6520 3d3d 2022 7072  lif state == "pr
-00026aa0: 652d 6272 6561 6b22 3a0a 2020 2020 2020  e-break":.      
-00026ab0: 2020 2020 2020 7365 6c66 2e5f 7365 745f        self._set_
-00026ac0: 7374 6174 6528 2262 7265 616b 2229 0a20  state("break"). 
-00026ad0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00026ae0: 5f70 6c61 795f 736f 756e 6428 2277 696e  _play_sound("win
-00026af0: 6422 290a 2020 2020 2020 2020 656c 6966  d").        elif
-00026b00: 2073 7461 7465 203d 3d20 2262 7265 616b   state == "break
-00026b10: 223a 0a20 2020 2020 2020 2020 2020 2073  ":.            s
-00026b20: 656c 662e 5f73 6574 5f73 7461 7465 2822  elf._set_state("
-00026b30: 7072 652d 776f 726b 2229 0a20 2020 2020  pre-work").     
-00026b40: 2020 2020 2020 2073 656c 662e 5f70 6c61         self._pla
-00026b50: 795f 736f 756e 6428 226d 616e 7561 6c5f  y_sound("manual_
-00026b60: 656e 6422 290a 2020 2020 2020 2020 656c  end").        el
-00026b70: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00026b80: 7365 6c66 2e5f 7365 745f 7374 6174 6528  self._set_state(
-00026b90: 2270 7265 2d77 6f72 6b22 290a 0a20 2020  "pre-work")..   
-00026ba0: 2064 6566 205f 7570 6461 7465 2873 656c   def _update(sel
-00026bb0: 6629 3a0a 2020 2020 2020 2020 2320 416c  f):.        # Al
-00026bc0: 7761 7973 2064 6f20 7468 6973 0a0a 2020  ways do this..  
-00026bd0: 2020 2020 2020 7374 6174 652c 2065 7469        state, eti
-00026be0: 6d65 203d 2073 656c 662e 5f73 7461 7465  me = self._state
-00026bf0: 0a20 2020 2020 2020 206c 6566 7420 3d20  .        left = 
-00026c00: 6d61 7828 302c 2065 7469 6d65 202d 2064  max(0, etime - d
-00026c10: 742e 6e6f 7728 2929 0a0a 2020 2020 2020  t.now())..      
-00026c20: 2020 6966 2073 7461 7465 203d 3d20 2277    if state == "w
-00026c30: 6f72 6b22 3a0a 2020 2020 2020 2020 2020  ork":.          
-00026c40: 2020 6966 206e 6f74 206c 6566 743a 0a20    if not left:. 
-00026c50: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00026c60: 656c 662e 5f73 6574 5f73 7461 7465 2822  elf._set_state("
-00026c70: 7072 652d 6272 6561 6b22 290a 2020 2020  pre-break").    
-00026c80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00026c90: 2e61 6c61 726d 2873 7461 7465 290a 2020  .alarm(state).  
-00026ca0: 2020 2020 2020 656c 6966 2073 7461 7465        elif state
-00026cb0: 203d 3d20 2262 7265 616b 223a 0a20 2020   == "break":.   
-00026cc0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00026cd0: 6c65 6674 3a0a 2020 2020 2020 2020 2020  left:.          
-00026ce0: 2020 2020 2020 7365 6c66 2e5f 7365 745f        self._set_
-00026cf0: 7374 6174 6528 2270 7265 2d77 6f72 6b22  state("pre-work"
-00026d00: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00026d10: 2020 7365 6c66 2e61 6c61 726d 2873 7461    self.alarm(sta
-00026d20: 7465 290a 0a20 2020 2020 2020 2023 2045  te)..        # E
-00026d30: 7869 7420 6561 726c 7920 6966 2077 6527  xit early if we'
-00026d40: 7265 206e 6f74 2073 686f 776e 0a20 2020  re not shown.   
-00026d50: 2020 2020 2069 6620 7769 6e64 6f77 2e64       if window.d
-00026d60: 6f63 756d 656e 742e 6869 6464 656e 206f  ocument.hidden o
-00026d70: 7220 6e6f 7420 7365 6c66 2e69 735f 7368  r not self.is_sh
-00026d80: 6f77 6e28 293a 0a20 2020 2020 2020 2020  own():.         
-00026d90: 2020 2072 6574 7572 6e0a 0a20 2020 2020     return..     
-00026da0: 2020 2023 2055 7064 6174 6520 4755 490a     # Update GUI.
-00026db0: 2020 2020 2020 2020 6966 2073 7461 7465          if state
-00026dc0: 203d 3d20 2270 7265 2d77 6f72 6b22 3a0a   == "pre-work":.
-00026dd0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00026de0: 2e5f 6c61 6265 6c2e 696e 6e65 7248 544d  ._label.innerHTM
-00026df0: 4c20 3d20 2257 6f72 6b20 2832 353a 3030  L = "Work (25:00
-00026e00: 2922 0a20 2020 2020 2020 2065 6c69 6620  )".        elif 
-00026e10: 7374 6174 6520 3d3d 2022 776f 726b 223a  state == "work":
-00026e20: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00026e30: 662e 5f6c 6162 656c 2e69 6e6e 6572 4854  f._label.innerHT
-00026e40: 4d4c 203d 2022 576f 726b 696e 673a 2022  ML = "Working: "
-00026e50: 202b 2064 742e 6475 7261 7469 6f6e 5f73   + dt.duration_s
-00026e60: 7472 696e 6728 6c65 6674 2c20 5472 7565  tring(left, True
-00026e70: 290a 2020 2020 2020 2020 656c 6966 2073  ).        elif s
-00026e80: 7461 7465 203d 3d20 2270 7265 2d62 7265  tate == "pre-bre
-00026e90: 616b 223a 0a20 2020 2020 2020 2020 2020  ak":.           
-00026ea0: 2073 656c 662e 5f6c 6162 656c 2e69 6e6e   self._label.inn
-00026eb0: 6572 4854 4d4c 203d 2022 4272 6561 6b20  erHTML = "Break 
-00026ec0: 2835 3a30 3029 220a 2020 2020 2020 2020  (5:00)".        
-00026ed0: 656c 6966 2073 7461 7465 203d 3d20 2262  elif state == "b
-00026ee0: 7265 616b 223a 0a20 2020 2020 2020 2020  reak":.         
-00026ef0: 2020 2073 656c 662e 5f6c 6162 656c 2e69     self._label.i
-00026f00: 6e6e 6572 4854 4d4c 203d 2022 4272 6561  nnerHTML = "Brea
-00026f10: 6b3a 2022 202b 2064 742e 6475 7261 7469  k: " + dt.durati
-00026f20: 6f6e 5f73 7472 696e 6728 6c65 6674 2c20  on_string(left, 
-00026f30: 5472 7565 290a 2020 2020 2020 2020 656c  True).        el
-00026f40: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00026f50: 7365 6c66 2e5f 7365 745f 7374 6174 6528  self._set_state(
-00026f60: 2270 7265 2d77 6f72 6b22 290a 0a20 2020  "pre-work")..   
-00026f70: 2064 6566 2061 6c61 726d 2873 656c 662c   def alarm(self,
-00026f80: 206f 6c64 5f73 7461 7465 293a 0a20 2020   old_state):.   
-00026f90: 2020 2020 2023 204f 7065 6e20 7468 6973       # Open this
-00026fa0: 2064 6961 6c6f 670a 2020 2020 2020 2020   dialog.        
-00026fb0: 7365 6c66 2e6f 7065 6e28 290a 0a20 2020  self.open()..   
-00026fc0: 2020 2020 2023 204d 616b 6520 6120 736f       # Make a so
-00026fd0: 756e 640a 2020 2020 2020 2020 6966 206f  und.        if o
-00026fe0: 6c64 5f73 7461 7465 203d 3d20 2277 6f72  ld_state == "wor
-00026ff0: 6b22 3a0a 2020 2020 2020 2020 2020 2020  k":.            
-00027000: 7365 6c66 2e5f 706c 6179 5f73 6f75 6e64  self._play_sound
-00027010: 2822 776f 726b 5f65 6e64 2229 0a20 2020  ("work_end").   
-00027020: 2020 2020 2065 6c69 6620 6f6c 645f 7374       elif old_st
-00027030: 6174 6520 3d3d 2022 6272 6561 6b22 3a0a  ate == "break":.
-00027040: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00027050: 2e5f 706c 6179 5f73 6f75 6e64 2822 6272  ._play_sound("br
-00027060: 6561 6b5f 656e 6422 290a 0a20 2020 2020  eak_end")..     
-00027070: 2020 2023 2054 6865 2077 696e 646f 7720     # The window 
-00027080: 7469 746c 6520 6973 2063 6861 6e67 6564  title is changed
-00027090: 206f 6e20 5f73 6574 5f73 7461 7465 2c20   on _set_state, 
-000270a0: 6361 7573 696e 6720 6120 626c 7565 2064  causing a blue d
-000270b0: 6f74 0a20 2020 2020 2020 2023 2074 6f20  ot.        # to 
-000270c0: 6170 7065 6172 2077 6865 6e20 7069 6e6e  appear when pinn
-000270d0: 6564 2e20 5468 6973 2069 7320 616c 736f  ed. This is also
-000270e0: 2070 6172 7420 6f66 2074 6865 2022 616c   part of the "al
-000270f0: 6172 6d22 2e0a 0a20 2020 2020 2020 2023  arm"...        #
-00027100: 2053 686f 7720 6120 7379 7374 656d 206e   Show a system n
-00027110: 6f74 6966 6963 6174 696f 6e0a 2020 2020  otification.    
-00027120: 2020 2020 6966 2077 696e 646f 772e 4e6f      if window.No
-00027130: 7469 6669 6361 7469 6f6e 2061 6e64 204e  tification and N
-00027140: 6f74 6966 6963 6174 696f 6e2e 7065 726d  otification.perm
-00027150: 6973 7369 6f6e 203d 3d20 2267 7261 6e74  ission == "grant
-00027160: 6564 223a 0a20 2020 2020 2020 2020 2020  ed":.           
-00027170: 2069 6620 6f6c 645f 7374 6174 6520 3d3d   if old_state ==
-00027180: 2022 6272 6561 6b22 3a0a 2020 2020 2020   "break":.      
-00027190: 2020 2020 2020 2020 2020 7469 746c 6520            title 
-000271a0: 3d20 2242 7265 616b 2069 7320 6f76 6572  = "Break is over
-000271b0: 2c20 6261 636b 2074 6f20 776f 726b 2122  , back to work!"
-000271c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000271d0: 2061 6374 696f 6e73 203d 205b 0a20 2020   actions = [.   
-000271e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000271f0: 207b 2261 6374 696f 6e22 3a20 2277 6f72   {"action": "wor
-00027200: 6b22 2c20 2274 6974 6c65 223a 2022 5374  k", "title": "St
-00027210: 6172 7420 3235 6d20 776f 726b 227d 2c0a  art 25m work"},.
-00027220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027230: 2020 2020 7b22 6163 7469 6f6e 223a 2022      {"action": "
-00027240: 636c 6f73 6522 2c20 2274 6974 6c65 223a  close", "title":
-00027250: 2022 436c 6f73 6522 7d2c 0a20 2020 2020   "Close"},.     
-00027260: 2020 2020 2020 2020 2020 205d 0a20 2020             ].   
-00027270: 2020 2020 2020 2020 2065 6c69 6620 6f6c           elif ol
-00027280: 645f 7374 6174 6520 3d3d 2022 776f 726b  d_state == "work
-00027290: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-000272a0: 2020 2074 6974 6c65 203d 2022 5469 6d65     title = "Time
-000272b0: 2066 6f72 2061 2062 7265 616b 2122 0a20   for a break!". 
-000272c0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-000272d0: 6374 696f 6e73 203d 205b 0a20 2020 2020  ctions = [.     
-000272e0: 2020 2020 2020 2020 2020 2020 2020 207b                 {
-000272f0: 2261 6374 696f 6e22 3a20 2262 7265 616b  "action": "break
-00027300: 222c 2022 7469 746c 6522 3a20 2253 7461  ", "title": "Sta
-00027310: 7274 2035 6d20 6272 6561 6b22 7d2c 0a20  rt 5m break"},. 
-00027320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027330: 2020 207b 2261 6374 696f 6e22 3a20 2263     {"action": "c
-00027340: 6c6f 7365 222c 2022 7469 746c 6522 3a20  lose", "title": 
-00027350: 2243 6c6f 7365 227d 2c0a 2020 2020 2020  "Close"},.      
-00027360: 2020 2020 2020 2020 2020 5d0a 2020 2020            ].    
-00027370: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00027380: 2020 2020 2020 2020 2020 2020 2020 7469                ti
-00027390: 746c 6520 3d20 2250 6f6d 6f64 6f72 6f22  tle = "Pomodoro"
-000273a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000273b0: 2061 6374 696f 6e73 203d 205b 5d0a 0a20   actions = [].. 
-000273c0: 2020 2020 2020 2020 2020 206f 7074 696f             optio
-000273d0: 6e73 203d 207b 0a20 2020 2020 2020 2020  ns = {.         
-000273e0: 2020 2020 2020 2022 6963 6f6e 223a 2022         "icon": "
-000273f0: 7469 6d65 7461 6767 6572 3139 325f 7366  timetagger192_sf
-00027400: 2e70 6e67 222c 0a20 2020 2020 2020 2020  .png",.         
-00027410: 2020 2020 2020 2022 626f 6479 223a 2022         "body": "
-00027420: 436c 6963 6b20 746f 206f 7065 6e20 5469  Click to open Ti
-00027430: 6d65 5461 6767 6572 222c 0a20 2020 2020  meTagger",.     
-00027440: 2020 2020 2020 2020 2020 2022 7265 7175             "requ
-00027450: 6972 6549 6e74 6572 6163 7469 6f6e 223a  ireInteraction":
-00027460: 2054 7275 652c 0a20 2020 2020 2020 2020   True,.         
-00027470: 2020 2020 2020 2022 7461 6722 3a20 2274         "tag": "t
-00027480: 696d 6574 6167 6765 722d 706f 6d6f 646f  imetagger-pomodo
-00027490: 726f 222c 2020 2320 7265 706c 6163 6520  ro",  # replace 
-000274a0: 7072 6576 696f 7573 206e 6f74 6966 6963  previous notific
-000274b0: 6174 696f 6e73 0a20 2020 2020 2020 2020  ations.         
-000274c0: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
-000274d0: 2023 2049 6620 7765 2073 686f 7720 7468   # If we show th
-000274e0: 6520 6e6f 7469 6669 6361 7469 6f6e 2076  e notification v
-000274f0: 6961 2074 6865 2073 6572 7669 6365 2077  ia the service w
-00027500: 6f72 6b65 722c 2077 650a 2020 2020 2020  orker, we.      
-00027510: 2020 2020 2020 2320 6361 6e20 7368 6f77        # can show
-00027520: 2061 6374 696f 6e73 2c20 6d61 6b69 6e67   actions, making
-00027530: 2074 6865 2066 6c6f 7720 6561 7369 6572   the flow easier
-00027540: 2066 6f72 2075 7365 7273 2e0a 2020 2020   for users..    
-00027550: 2020 2020 2020 2020 6966 2077 696e 646f          if windo
-00027560: 772e 7077 6120 616e 6420 7769 6e64 6f77  w.pwa and window
-00027570: 2e70 7761 2e73 775f 7265 673a 0a20 2020  .pwa.sw_reg:.   
-00027580: 2020 2020 2020 2020 2020 2020 206f 7074               opt
-00027590: 696f 6e73 2e61 6374 696f 6e73 203d 2061  ions.actions = a
-000275a0: 6374 696f 6e73 0a20 2020 2020 2020 2020  ctions.         
-000275b0: 2020 2020 2020 2077 696e 646f 772e 7077         window.pw
-000275c0: 612e 7377 5f72 6567 2e73 686f 774e 6f74  a.sw_reg.showNot
-000275d0: 6966 6963 6174 696f 6e28 7469 746c 652c  ification(title,
-000275e0: 206f 7074 696f 6e73 290a 2020 2020 2020   options).      
-000275f0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00027600: 2020 2020 2020 2020 2020 2020 4e6f 7469              Noti
-00027610: 6669 6361 7469 6f6e 2874 6974 6c65 2c20  fication(title, 
-00027620: 6f70 7469 6f6e 7329 0a0a 2020 2020 6465  options)..    de
-00027630: 6620 6f6e 5f6e 6f74 6966 6963 6174 696f  f on_notificatio
-00027640: 6e63 6c69 636b 2873 656c 662c 206d 6573  nclick(self, mes
-00027650: 7361 6765 5f65 7665 6e74 293a 0a20 2020  sage_event):.   
-00027660: 2020 2020 2022 2222 5468 6973 2069 7320       """This is 
-00027670: 6120 6361 6c6c 6261 636b 2066 6f72 2073  a callback for s
-00027680: 6572 7669 6365 2077 6f72 6b65 7220 6576  ervice worker ev
-00027690: 656e 7473 2e0a 2020 2020 2020 2020 5765  ents..        We
-000276a0: 2066 696c 7465 7220 6f6e 2027 6e6f 7469   filter on 'noti
-000276b0: 6669 6361 7469 6f6e 636c 6963 6b27 2074  ficationclick' t
-000276c0: 7970 6573 2028 6465 6669 6e65 6420 6279  ypes (defined by
-000276d0: 2075 7329 2e0a 2020 2020 2020 2020 2222   us)..        ""
-000276e0: 220a 2020 2020 2020 2020 6576 656e 7420  ".        event 
-000276f0: 3d20 6d65 7373 6167 655f 6576 656e 742e  = message_event.
-00027700: 6461 7461 0a20 2020 2020 2020 2069 6620  data.        if 
-00027710: 6576 656e 742e 7479 7065 2021 3d20 226e  event.type != "n
-00027720: 6f74 6966 6963 6174 696f 6e63 6c69 636b  otificationclick
-00027730: 223a 0a20 2020 2020 2020 2020 2020 2072  ":.            r
-00027740: 6574 7572 6e0a 2020 2020 2020 2020 6966  eturn.        if
-00027750: 206e 6f74 2077 696e 646f 772e 7369 6d70   not window.simp
-00027760: 6c65 7365 7474 696e 6773 2e67 6574 2822  lesettings.get("
-00027770: 706f 6d6f 646f 726f 5f65 6e61 626c 6564  pomodoro_enabled
-00027780: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
-00027790: 7265 7475 726e 0a20 2020 2020 2020 2069  return.        i
-000277a0: 6620 6576 656e 742e 6163 7469 6f6e 203d  f event.action =
-000277b0: 3d20 2277 6f72 6b22 3a0a 2020 2020 2020  = "work":.      
-000277c0: 2020 2020 2020 7365 6c66 2e5f 7365 745f        self._set_
-000277d0: 7374 6174 6528 2277 6f72 6b22 290a 2020  state("work").  
-000277e0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-000277f0: 706c 6179 5f73 6f75 6e64 2822 7769 6e64  play_sound("wind
-00027800: 2229 0a20 2020 2020 2020 2065 6c69 6620  ").        elif 
-00027810: 6576 656e 742e 6163 7469 6f6e 203d 3d20  event.action == 
-00027820: 2262 7265 616b 223a 0a20 2020 2020 2020  "break":.       
-00027830: 2020 2020 2073 656c 662e 5f73 6574 5f73       self._set_s
-00027840: 7461 7465 2822 6272 6561 6b22 290a 2020  tate("break").  
-00027850: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00027860: 706c 6179 5f73 6f75 6e64 2822 7769 6e64  play_sound("wind
-00027870: 2229 0a                                  ").
+00023930: 2074 6167 732c 2070 6172 7473 203d 2075   tags, parts = u
+00023940: 7469 6c73 2e67 6574 5f74 6167 735f 616e  tils.get_tags_an
+00023950: 645f 7061 7274 735f 6672 6f6d 5f73 7472  d_parts_from_str
+00023960: 696e 6728 0a20 2020 2020 2020 2020 2020  ing(.           
+00023970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023980: 2072 6177 2e64 6573 6372 6970 7469 6f6e   raw.description
+00023990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000239a0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+000239b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000239c0: 2020 2066 6f72 2074 6167 2069 6e20 7461     for tag in ta
+000239d0: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
+000239e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000239f0: 7461 6773 5f64 6963 742e 706f 7028 7461  tags_dict.pop(ta
+00023a00: 672c 204e 6f6e 6529 0a20 2020 2020 2020  g, None).       
+00023a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023a20: 2074 6167 7a20 3d20 2220 222e 6a6f 696e   tagz = " ".join
+00023a30: 2874 6167 735f 6469 6374 2e76 616c 7565  (tags_dict.value
+00023a40: 7328 2929 0a20 2020 2020 2020 2020 2020  s()).           
+00023a50: 2020 2020 2020 2020 2020 2020 2072 6563               rec
+00023a60: 6f72 642e 6473 203d 2074 6f5f 7374 7228  ord.ds = to_str(
+00023a70: 7461 677a 202b 2022 2022 202b 2072 6177  tagz + " " + raw
+00023a80: 2e64 6573 6372 6970 7469 6f6e 290a 2020  .description).  
+00023a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023aa0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00023ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023ac0: 7461 677a 203d 2022 2022 2e6a 6f69 6e28  tagz = " ".join(
+00023ad0: 7461 6773 5f64 6963 742e 7661 6c75 6573  tags_dict.values
+00023ae0: 2829 290a 2020 2020 2020 2020 2020 2020  ()).            
+00023af0: 2020 2020 2020 2020 2020 2020 7265 636f              reco
+00023b00: 7264 2e64 7320 3d20 7461 677a 0a20 2020  rd.ds = tagz.   
+00023b10: 2020 2020 2020 2020 2020 2020 2023 2056               # V
+00023b20: 616c 6964 6174 6520 7265 636f 7264 0a20  alidate record. 
+00023b30: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00023b40: 6620 7265 636f 7264 2e74 3120 3d3d 2030  f record.t1 == 0
+00023b50: 206f 7220 7265 636f 7264 2e74 3220 3d3d   or record.t2 ==
+00023b60: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00023b70: 2020 2020 2020 2020 6c6f 6728 6622 4974          log(f"It
+00023b80: 656d 206f 6e20 726f 7720 7b72 6f77 7d20  em on row {row} 
+00023b90: 6861 7320 696e 7661 6c69 6420 7374 6172  has invalid star
+00023ba0: 742f 7374 6f70 2074 696d 6573 2229 0a20  t/stop times"). 
+00023bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023bc0: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
+00023bd0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00023be0: 2877 696e 646f 772e 7374 6f72 652e 7265  (window.store.re
+00023bf0: 636f 7264 732e 5f76 616c 6964 6174 655f  cords._validate_
+00023c00: 6974 656d 7328 5b72 6563 6f72 645d 2929  items([record]))
+00023c10: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+00023c20: 2020 2020 2020 2020 2020 206c 6f67 280a             log(.
+00023c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023c40: 2020 2020 2020 2020 6622 4974 656d 206f          f"Item o
+00023c50: 6e20 726f 7720 7b72 6f77 7d20 646f 6573  n row {row} does
+00023c60: 206e 6f74 2070 6173 7320 7661 6c69 6461   not pass valida
+00023c70: 7469 6f6e 3a20 220a 2020 2020 2020 2020  tion: ".        
+00023c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023c90: 2b20 4a53 4f4e 2e73 7472 696e 6769 6679  + JSON.stringify
+00023ca0: 2872 6563 6f72 6429 0a20 2020 2020 2020  (record).       
+00023cb0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+00023cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023cd0: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
+00023ce0: 2020 2020 2020 2020 2020 7265 636f 7264            record
+00023cf0: 2e74 3220 3d20 6d61 7828 7265 636f 7264  .t2 = max(record
+00023d00: 2e74 322c 2072 6563 6f72 642e 7431 202b  .t2, record.t1 +
+00023d10: 2031 2920 2023 206e 6f20 7275 6e6e 696e   1)  # no runnin
+00023d20: 6720 7265 636f 7264 730a 2020 2020 2020  g records.      
+00023d30: 2020 2020 2020 2020 2020 2320 4173 7369            # Assi
+00023d40: 676e 2074 6865 2072 6967 6874 206b 6579  gn the right key
+00023d50: 2062 6173 6564 206f 6e20 6769 7665 6e20   based on given 
+00023d60: 6b65 7920 6f72 2074 315f 7432 0a20 2020  key or t1_t2.   
+00023d70: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00023d80: 7265 636f 7264 5f6b 6579 2069 7320 6e6f  record_key is no
+00023d90: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00023da0: 2020 2020 2020 2020 2020 2020 7265 636f              reco
+00023db0: 7264 2e6b 6579 203d 2072 6563 6f72 645f  rd.key = record_
+00023dc0: 6b65 790a 2020 2020 2020 2020 2020 2020  key.            
+00023dd0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00023de0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+00023df0: 6973 7469 6e67 5f6b 6579 203d 2074 696d  isting_key = tim
+00023e00: 656d 6170 2e67 6574 2872 6563 6f72 642e  emap.get(record.
+00023e10: 7431 202b 2022 5f22 202b 2072 6563 6f72  t1 + "_" + recor
+00023e20: 642e 7432 2c20 4e6f 6e65 290a 2020 2020  d.t2, None).    
+00023e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023e40: 6966 2065 7869 7374 696e 675f 6b65 7920  if existing_key 
+00023e50: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00023e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023e70: 2020 2020 2072 6563 6f72 642e 6b65 7920       record.key 
+00023e80: 3d20 6578 6973 7469 6e67 5f6b 6579 0a20  = existing_key. 
+00023e90: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00023ea0: 2041 6464 0a20 2020 2020 2020 2020 2020   Add.           
+00023eb0: 2020 2020 2072 6563 6f72 6473 2e61 7070       records.app
+00023ec0: 656e 6428 7265 636f 7264 290a 2020 2020  end(record).    
+00023ed0: 2020 2020 2020 2020 2020 2020 6966 2077              if w
+00023ee0: 696e 646f 772e 7374 6f72 652e 7265 636f  indow.store.reco
+00023ef0: 7264 732e 6765 745f 6279 5f6b 6579 2872  rds.get_by_key(r
+00023f00: 6563 6f72 642e 6b65 7929 2069 7320 4e6f  ecord.key) is No
+00023f10: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00023f20: 2020 2020 2020 2020 6e65 775f 7265 636f          new_reco
+00023f30: 7264 5f63 6f75 6e74 202b 3d20 310a 2020  rd_count += 1.  
+00023f40: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00023f50: 4b65 6570 2067 6976 696e 6720 6665 6564  Keep giving feed
+00023f60: 6261 636b 202f 2064 6f6e 7420 6672 6565  back / dont free
+00023f70: 7a65 0a20 2020 2020 2020 2020 2020 2020  ze.             
+00023f80: 2020 2069 6620 726f 7720 2520 3130 3020     if row % 100 
+00023f90: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
+00023fa0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00023fb0: 696d 706f 7274 5f62 7574 2e69 6e6e 6572  import_but.inner
+00023fc0: 4854 4d4c 203d 2066 2246 6f75 6e64 207b  HTML = f"Found {
+00023fd0: 6c65 6e28 7265 636f 7264 7329 7d20 7265  len(records)} re
+00023fe0: 636f 7264 7322 0a20 2020 2020 2020 2020  cords".         
+00023ff0: 2020 2020 2020 2020 2020 2061 7761 6974             await
+00024000: 2077 696e 646f 772e 746f 6f6c 732e 736c   window.tools.sl
+00024010: 6565 706d 7328 3129 0a20 2020 2020 2020  eepms(1).       
+00024020: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
+00024030: 7074 696f 6e20 6173 2065 7272 3a0a 2020  ption as err:.  
+00024040: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+00024050: 6728 6622 4572 726f 7220 6174 2072 6f77  g(f"Error at row
+00024060: 207b 726f 777d 3a20 7b65 7272 7d22 290a   {row}: {err}").
+00024070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024080: 7265 7475 726e 0a0a 2020 2020 2020 2020  return..        
+00024090: 2320 5374 6f72 6520 616e 6420 6769 7665  # Store and give
+000240a0: 2073 756d 6d61 7279 0a20 2020 2020 2020   summary.       
+000240b0: 2073 656c 662e 5f72 6563 6f72 6473 3269   self._records2i
+000240c0: 6d70 6f72 7420 3d20 7265 636f 7264 730a  mport = records.
+000240d0: 2020 2020 2020 2020 6c6f 6728 6622 466f          log(f"Fo
+000240e0: 756e 6420 7b6c 656e 2872 6563 6f72 6473  und {len(records
+000240f0: 297d 2028 7b6e 6577 5f72 6563 6f72 645f  )} ({new_record_
+00024100: 636f 756e 747d 206e 6577 2922 290a 0a20  count} new)").. 
+00024110: 2020 2064 6566 2064 6f5f 696d 706f 7274     def do_import
+00024120: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00024130: 2222 2244 6f20 7468 6520 696d 706f 7274  """Do the import
+00024140: 2122 2222 0a20 2020 2020 2020 2077 696e  !""".        win
+00024150: 646f 772e 7374 6f72 652e 7265 636f 7264  dow.store.record
+00024160: 732e 7075 7428 2a73 656c 662e 5f72 6563  s.put(*self._rec
+00024170: 6f72 6473 3269 6d70 6f72 7429 0a20 2020  ords2import).   
+00024180: 2020 2020 2073 656c 662e 5f72 6563 6f72       self._recor
+00024190: 6473 3269 6d70 6f72 7420 3d20 5b5d 0a20  ds2import = []. 
+000241a0: 2020 2020 2020 2073 656c 662e 5f69 6d70         self._imp
+000241b0: 6f72 745f 6275 742e 6469 7361 626c 6564  ort_but.disabled
+000241c0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+000241d0: 7365 6c66 2e5f 696d 706f 7274 5f62 7574  self._import_but
+000241e0: 2e69 6e6e 6572 4854 4d4c 203d 2022 496d  .innerHTML = "Im
+000241f0: 706f 7274 2064 6f6e 6522 0a0a 0a63 6c61  port done"...cla
+00024200: 7373 2053 6574 7469 6e67 7344 6961 6c6f  ss SettingsDialo
+00024210: 6728 4261 7365 4469 616c 6f67 293a 0a20  g(BaseDialog):. 
+00024220: 2020 2022 2222 4469 616c 6f67 2074 6f20     """Dialog to 
+00024230: 6368 616e 6765 2075 7365 7220 7365 7474  change user sett
+00024240: 696e 6773 2e22 2222 0a0a 2020 2020 6465  ings."""..    de
+00024250: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+00024260: 2063 616e 7661 7329 3a0a 2020 2020 2020   canvas):.      
+00024270: 2020 7375 7065 7228 292e 5f5f 696e 6974    super().__init
+00024280: 5f5f 2863 616e 7661 7329 0a0a 2020 2020  __(canvas)..    
+00024290: 6465 6620 6f70 656e 2873 656c 662c 2063  def open(self, c
+000242a0: 616c 6c62 6163 6b3d 4e6f 6e65 293a 0a20  allback=None):. 
+000242b0: 2020 2020 2020 2023 2047 6574 2073 686f         # Get sho
+000242c0: 7274 6375 7473 2068 746d 6c0a 2020 2020  rtcuts html.    
+000242d0: 2020 2020 7368 6f72 7463 7574 7320 3d20      shortcuts = 
+000242e0: 7b0a 2020 2020 2020 2020 2020 2020 225f  {.            "_
+000242f0: 6469 616c 6f67 7322 3a20 223c 623e 496e  dialogs": "<b>In
+00024300: 2064 6961 6c6f 6773 3c2f 623e 222c 0a20   dialogs</b>",. 
+00024310: 2020 2020 2020 2020 2020 2022 456e 7465             "Ente
+00024320: 7222 3a20 2253 7562 6d69 7420 6469 616c  r": "Submit dial
+00024330: 6f67 222c 0a20 2020 2020 2020 2020 2020  og",.           
+00024340: 2022 4573 6361 7065 223a 2022 436c 6f73   "Escape": "Clos
+00024350: 6520 6469 616c 6f67 222c 0a20 2020 2020  e dialog",.     
+00024360: 2020 2020 2020 2022 5f6e 6176 223a 2022         "_nav": "
+00024370: 3c62 3e4e 6176 6967 6174 696f 6e3c 2f62  <b>Navigation</b
+00024380: 3e22 2c0a 2020 2020 2020 2020 2020 2020  >",.            
+00024390: 224e 2f48 6f6d 652f 456e 6422 3a20 2253  "N/Home/End": "S
+000243a0: 6e61 7020 746f 206e 6f77 222c 0a20 2020  nap to now",.   
+000243b0: 2020 2020 2020 2020 2022 4422 3a20 2253           "D": "S
+000243c0: 656c 6563 7420 746f 6461 7922 2c0a 2020  elect today",.  
+000243d0: 2020 2020 2020 2020 2020 2257 223a 2022            "W": "
+000243e0: 5365 6c65 6374 2074 6869 7320 7765 656b  Select this week
+000243f0: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
+00024400: 4d22 3a20 2253 656c 6563 7420 7468 6973  M": "Select this
+00024410: 206d 6f6e 7468 222c 0a20 2020 2020 2020   month",.       
+00024420: 2020 2020 2022 5122 3a20 2253 656c 6563       "Q": "Selec
+00024430: 7420 7468 6973 2071 7561 7274 6572 222c  t this quarter",
+00024440: 0a20 2020 2020 2020 2020 2020 2022 5922  .            "Y"
+00024450: 3a20 2253 656c 6563 7420 7468 6973 2079  : "Select this y
+00024460: 6561 7222 2c0a 2020 2020 2020 2020 2020  ear",.          
+00024470: 2020 22e2 8691 2f50 6167 6555 7022 3a20    ".../PageUp": 
+00024480: 2253 7465 7020 6261 636b 2069 6e20 7469  "Step back in ti
+00024490: 6d65 222c 0a20 2020 2020 2020 2020 2020  me",.           
+000244a0: 2022 e286 932f 5061 6765 446f 776e 223a   ".../PageDown":
+000244b0: 2022 5374 6570 2066 6f72 7761 7264 2069   "Step forward i
+000244c0: 6e20 7469 6d65 222c 0a20 2020 2020 2020  n time",.       
+000244d0: 2020 2020 2022 e286 9222 3a20 225a 6f6f       "...": "Zoo
+000244e0: 6d20 696e 222c 0a20 2020 2020 2020 2020  m in",.         
+000244f0: 2020 2022 e286 9022 3a20 225a 6f6f 6d20     "...": "Zoom 
+00024500: 6f75 7422 2c0a 2020 2020 2020 2020 2020  out",.          
+00024510: 2020 225f 6f74 6865 7222 3a20 223c 623e    "_other": "<b>
+00024520: 4f74 6865 723c 2f62 3e22 2c0a 2020 2020  Other</b>",.    
+00024530: 2020 2020 2020 2020 2253 223a 2022 5374          "S": "St
+00024540: 6172 7420 7468 6520 7469 6d65 7220 6f72  art the timer or
+00024550: 2061 6464 2061 6e20 6561 726c 6965 7220   add an earlier 
+00024560: 7265 636f 7264 222c 0a20 2020 2020 2020  record",.       
+00024570: 2020 2020 2022 5368 6966 742b 5322 3a20       "Shift+S": 
+00024580: 2252 6573 756d 6520 7468 6520 6375 7272  "Resume the curr
+00024590: 656e 742f 7072 6576 696f 7573 2072 6563  ent/previous rec
+000245a0: 6f72 6422 2c0a 2020 2020 2020 2020 2020  ord",.          
+000245b0: 2020 2258 223a 2022 5374 6f70 2074 6865    "X": "Stop the
+000245c0: 2074 696d 6572 222c 0a20 2020 2020 2020   timer",.       
+000245d0: 2020 2020 2022 4622 3a20 224f 7065 6e20       "F": "Open 
+000245e0: 7365 6172 6368 2064 6961 6c6f 6722 2c0a  search dialog",.
+000245f0: 2020 2020 2020 2020 2020 2020 2254 223a              "T":
+00024600: 2022 5365 6c65 6374 2074 696d 6520 7261   "Select time ra
+00024610: 6e67 6522 2c0a 2020 2020 2020 2020 2020  nge",.          
+00024620: 2020 2252 223a 2022 4f70 656e 2072 6570    "R": "Open rep
+00024630: 6f72 7420 6469 616c 6f67 222c 0a20 2020  ort dialog",.   
+00024640: 2020 2020 2020 2020 2022 4922 3a20 224f           "I": "O
+00024650: 7065 6e20 7468 6520 6775 6964 6522 2c0a  pen the guide",.
+00024660: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+00024670: 2020 7368 6f72 7463 7574 735f 6874 6d6c    shortcuts_html
+00024680: 203d 2022 220a 2020 2020 2020 2020 666f   = "".        fo
+00024690: 7220 6b65 792c 2065 7870 6c20 696e 2073  r key, expl in s
+000246a0: 686f 7274 6375 7473 2e69 7465 6d73 2829  hortcuts.items()
+000246b0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+000246c0: 206b 6579 2e73 7461 7274 7377 6974 6828   key.startswith(
+000246d0: 225f 2229 3a0a 2020 2020 2020 2020 2020  "_"):.          
+000246e0: 2020 2020 2020 6b65 7920 3d20 2222 0a20        key = "". 
+000246f0: 2020 2020 2020 2020 2020 2073 686f 7274             short
+00024700: 6375 7473 5f68 746d 6c20 2b3d 2066 223c  cuts_html += f"<
+00024710: 6469 7620 636c 6173 733d 276d 6f6e 6f73  div class='monos
+00024720: 7061 6365 273e 7b6b 6579 7d3c 2f64 6976  pace'>{key}</div
+00024730: 3e3c 6469 763e 7b65 7870 6c7d 3c2f 6469  ><div>{expl}</di
+00024740: 763e 220a 0a20 2020 2020 2020 2068 746d  v>"..        htm
+00024750: 6c20 3d20 6622 2222 0a20 2020 2020 2020  l = f""".       
+00024760: 2020 2020 203c 6831 3e3c 6920 636c 6173       <h1><i clas
+00024770: 733d 2766 6173 273e 5c75 6630 3133 3c2f  s='fas'>\uf013</
+00024780: 693e 266e 6273 703b 266e 6273 703b 5365  i>&nbsp;&nbsp;Se
+00024790: 7474 696e 6773 0a20 2020 2020 2020 2020  ttings.         
+000247a0: 2020 2020 2020 203c 6275 7474 6f6e 2074         <button t
+000247b0: 7970 653d 2762 7574 746f 6e27 3e3c 6920  ype='button'><i 
+000247c0: 636c 6173 733d 2766 6173 273e 5c75 6630  class='fas'>\uf0
+000247d0: 3064 3c2f 693e 3c2f 6275 7474 6f6e 3e0a  0d</i></button>.
+000247e0: 2020 2020 2020 2020 2020 2020 3c2f 6831              </h1
+000247f0: 3e0a 0a20 2020 2020 2020 2020 2020 203c  >..            <
+00024800: 6365 6e74 6572 2073 7479 6c65 3d27 666f  center style='fo
+00024810: 6e74 2d73 697a 653a 3830 2527 3e55 7365  nt-size:80%'>Use
+00024820: 7220 7365 7474 696e 6773 3c2f 6365 6e74  r settings</cent
+00024830: 6572 3e0a 2020 2020 2020 2020 2020 2020  er>.            
+00024840: 3c68 323e 3c69 2063 6c61 7373 3d27 6661  <h2><i class='fa
+00024850: 7327 3e5c 7566 3466 643c 2f69 3e26 6e62  s'>\uf4fd</i>&nb
+00024860: 7370 3b26 6e62 7370 3b54 696d 6520 7265  sp;&nbsp;Time re
+00024870: 7072 6573 656e 7461 7469 6f6e 3c2f 6832  presentation</h2
+00024880: 3e0a 2020 2020 2020 2020 2020 2020 3c64  >.            <d
+00024890: 6976 2063 6c61 7373 3d27 666f 726d 6c61  iv class='formla
+000248a0: 796f 7574 273e 0a20 2020 2020 2020 2020  yout'>.         
+000248b0: 2020 2020 2020 203c 6469 763e 5765 656b         <div>Week
+000248c0: 2073 7461 7274 7320 6f6e 3a3c 2f64 6976   starts on:</div
+000248d0: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
+000248e0: 2020 3c73 656c 6563 743e 0a20 2020 2020    <select>.     
+000248f0: 2020 2020 2020 2020 2020 2020 2020 203c                 <
+00024900: 6f70 7469 6f6e 2076 616c 7565 3d27 3027  option value='0'
+00024910: 3e53 756e 6461 793c 2f6f 7074 696f 6e3e  >Sunday</option>
+00024920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024930: 2020 2020 203c 6f70 7469 6f6e 2076 616c       <option val
+00024940: 7565 3d27 3127 3e4d 6f6e 6461 793c 2f6f  ue='1'>Monday</o
+00024950: 7074 696f 6e3e 0a20 2020 2020 2020 2020  ption>.         
+00024960: 2020 2020 2020 2020 2020 203c 6f70 7469             <opti
+00024970: 6f6e 2076 616c 7565 3d27 3627 3e53 6174  on value='6'>Sat
+00024980: 7572 6461 793c 2f6f 7074 696f 6e3e 0a20  urday</option>. 
+00024990: 2020 2020 2020 2020 2020 2020 2020 203c                 <
+000249a0: 2f73 656c 6563 743e 0a20 2020 2020 2020  /select>.       
+000249b0: 2020 2020 2020 2020 203c 6469 763e 576f           <div>Wo
+000249c0: 726b 6461 7973 3a3c 2f64 6976 3e0a 2020  rkdays:</div>.  
+000249d0: 2020 2020 2020 2020 2020 2020 2020 3c73                <s
+000249e0: 656c 6563 743e 0a20 2020 2020 2020 2020  elect>.         
+000249f0: 2020 2020 2020 2020 2020 203c 6f70 7469             <opti
+00024a00: 6f6e 2076 616c 7565 3d27 3227 3e4d 6f6e  on value='2'>Mon
+00024a10: 6461 7920 2d20 4672 6964 6179 3c2f 6f70  day - Friday</op
+00024a20: 7469 6f6e 3e0a 2020 2020 2020 2020 2020  tion>.          
+00024a30: 2020 2020 2020 2020 2020 3c6f 7074 696f            <optio
+00024a40: 6e20 7661 6c75 653d 2731 273e 4d6f 6e64  n value='1'>Mond
+00024a50: 6179 202d 2053 6174 7572 6461 793c 2f6f  ay - Saturday</o
+00024a60: 7074 696f 6e3e 0a20 2020 2020 2020 2020  ption>.         
+00024a70: 2020 2020 2020 2020 2020 203c 6f70 7469             <opti
+00024a80: 6f6e 2076 616c 7565 3d27 3027 3e4d 6f6e  on value='0'>Mon
+00024a90: 6461 7920 2d20 5375 6e64 6179 3c2f 6f70  day - Sunday</op
+00024aa0: 7469 6f6e 3e0a 2020 2020 2020 2020 2020  tion>.          
+00024ab0: 2020 2020 2020 3c2f 7365 6c65 6374 3e0a        </select>.
+00024ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024ad0: 3c64 6976 3e53 686f 7720 7469 6d65 2061  <div>Show time a
+00024ae0: 733a 3c2f 6469 763e 0a20 2020 2020 2020  s:</div>.       
+00024af0: 2020 2020 2020 2020 203c 7365 6c65 6374           <select
+00024b00: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
+00024b10: 2020 2020 2020 3c6f 7074 696f 6e20 7661        <option va
+00024b20: 6c75 653d 2761 7574 6f27 3e41 7574 6f3c  lue='auto'>Auto<
+00024b30: 2f6f 7074 696f 6e3e 0a20 2020 2020 2020  /option>.       
+00024b40: 2020 2020 2020 2020 2020 2020 203c 6f70               <op
+00024b50: 7469 6f6e 2076 616c 7565 3d27 3234 6827  tion value='24h'
+00024b60: 3e32 333a 3230 3c2f 6f70 7469 6f6e 3e0a  >23:20</option>.
+00024b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024b80: 2020 2020 3c6f 7074 696f 6e20 7661 6c75      <option valu
+00024b90: 653d 2761 6d70 6d27 3e31 313a 3230 2070  e='ampm'>11:20 p
+00024ba0: 6d3c 2f6f 7074 696f 6e3e 0a20 2020 2020  m</option>.     
+00024bb0: 2020 2020 2020 2020 2020 203c 2f73 656c             </sel
+00024bc0: 6563 743e 0a20 2020 2020 2020 2020 2020  ect>.           
+00024bd0: 2020 2020 203c 6469 763e 5368 6f77 2064       <div>Show d
+00024be0: 7572 6174 696f 6e20 6173 3a3c 2f64 6976  uration as:</div
+00024bf0: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
+00024c00: 2020 3c73 656c 6563 743e 0a20 2020 2020    <select>.     
+00024c10: 2020 2020 2020 2020 2020 2020 2020 203c                 <
+00024c20: 6f70 7469 6f6e 2076 616c 7565 3d27 6468  option value='dh
+00024c30: 6d73 273e 3164 3368 3230 6d3c 2f6f 7074  ms'>1d3h20m</opt
+00024c40: 696f 6e3e 0a20 2020 2020 2020 2020 2020  ion>.           
+00024c50: 2020 2020 2020 2020 203c 6f70 7469 6f6e           <option
+00024c60: 2076 616c 7565 3d27 686d 7327 3e32 3768   value='hms'>27h
+00024c70: 3230 6d3c 2f6f 7074 696f 6e3e 0a20 2020  20m</option>.   
+00024c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024c90: 203c 6f70 7469 6f6e 2076 616c 7565 3d27   <option value='
+00024ca0: 636f 6c6f 6e27 3e32 373a 3230 3c2f 6f70  colon'>27:20</op
+00024cb0: 7469 6f6e 3e0a 2020 2020 2020 2020 2020  tion>.          
+00024cc0: 2020 2020 2020 3c2f 7365 6c65 6374 3e0a        </select>.
+00024cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024ce0: 3c64 6976 3e54 6f64 6179 2073 7461 7274  <div>Today start
+00024cf0: 7320 6174 3a3c 2f64 6976 3e0a 2020 2020  s at:</div>.    
+00024d00: 2020 2020 2020 2020 2020 2020 3c73 656c              <sel
+00024d10: 6563 743e 0a20 2020 2020 2020 2020 2020  ect>.           
+00024d20: 2020 2020 2020 2020 203c 6f70 7469 6f6e           <option
+00024d30: 2076 616c 7565 3d27 273e 3030 3a30 303c   value=''>00:00<
+00024d40: 2f6f 7074 696f 6e3e 0a20 2020 2020 2020  /option>.       
+00024d50: 2020 2020 2020 2020 2020 2020 203c 6f70               <op
+00024d60: 7469 6f6e 2076 616c 7565 3d27 3168 273e  tion value='1h'>
+00024d70: 3031 3a30 303c 2f6f 7074 696f 6e3e 0a20  01:00</option>. 
+00024d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024d90: 2020 203c 6f70 7469 6f6e 2076 616c 7565     <option value
+00024da0: 3d27 3268 273e 3032 3a30 303c 2f6f 7074  ='2h'>02:00</opt
+00024db0: 696f 6e3e 0a20 2020 2020 2020 2020 2020  ion>.           
+00024dc0: 2020 2020 2020 2020 203c 6f70 7469 6f6e           <option
+00024dd0: 2076 616c 7565 3d27 3368 273e 3033 3a30   value='3h'>03:0
+00024de0: 303c 2f6f 7074 696f 6e3e 0a20 2020 2020  0</option>.     
+00024df0: 2020 2020 2020 2020 2020 2020 2020 203c                 <
+00024e00: 6f70 7469 6f6e 2076 616c 7565 3d27 3468  option value='4h
+00024e10: 273e 3034 3a30 303c 2f6f 7074 696f 6e3e  '>04:00</option>
+00024e20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024e30: 2020 2020 203c 6f70 7469 6f6e 2076 616c       <option val
+00024e40: 7565 3d27 3568 273e 3035 3a30 303c 2f6f  ue='5h'>05:00</o
+00024e50: 7074 696f 6e3e 0a20 2020 2020 2020 2020  ption>.         
+00024e60: 2020 2020 2020 2020 2020 203c 6f70 7469             <opti
+00024e70: 6f6e 2076 616c 7565 3d27 3668 273e 3036  on value='6h'>06
+00024e80: 3a30 303c 2f6f 7074 696f 6e3e 0a20 2020  :00</option>.   
+00024e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024ea0: 203c 6f70 7469 6f6e 2076 616c 7565 3d27   <option value='
+00024eb0: 3768 273e 3037 3a30 303c 2f6f 7074 696f  7h'>07:00</optio
+00024ec0: 6e3e 0a20 2020 2020 2020 2020 2020 2020  n>.             
+00024ed0: 2020 2020 2020 203c 6f70 7469 6f6e 2076         <option v
+00024ee0: 616c 7565 3d27 3868 273e 3038 3a30 303c  alue='8h'>08:00<
+00024ef0: 2f6f 7074 696f 6e3e 0a20 2020 2020 2020  /option>.       
+00024f00: 2020 2020 2020 2020 2020 2020 203c 6f70               <op
+00024f10: 7469 6f6e 2076 616c 7565 3d27 3968 273e  tion value='9h'>
+00024f20: 3039 3a30 303c 2f6f 7074 696f 6e3e 0a20  09:00</option>. 
+00024f30: 2020 2020 2020 2020 2020 2020 2020 203c                 <
+00024f40: 2f73 656c 6563 743e 0a20 2020 2020 2020  /select>.       
+00024f50: 2020 2020 2020 2020 203c 6469 763e 546f           <div>To
+00024f60: 6461 7920 6475 7261 7469 6f6e 3a3c 2f64  day duration:</d
+00024f70: 6976 3e0a 2020 2020 2020 2020 2020 2020  iv>.            
+00024f80: 2020 2020 3c73 656c 6563 743e 0a20 2020      <select>.   
+00024f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024fa0: 203c 6f70 7469 6f6e 2076 616c 7565 3d27   <option value='
+00024fb0: 2d31 3268 273e 3132 683c 2f6f 7074 696f  -12h'>12h</optio
+00024fc0: 6e3e 0a20 2020 2020 2020 2020 2020 2020  n>.             
+00024fd0: 2020 2020 2020 203c 6f70 7469 6f6e 2076         <option v
+00024fe0: 616c 7565 3d27 273e 3234 683c 2f6f 7074  alue=''>24h</opt
+00024ff0: 696f 6e3e 0a20 2020 2020 2020 2020 2020  ion>.           
+00025000: 2020 2020 203c 2f73 656c 6563 743e 0a20       </select>. 
+00025010: 2020 2020 2020 2020 2020 203c 2f64 6976             </div
+00025020: 3e0a 2020 2020 2020 2020 2020 2020 3c68  >.            <h
+00025030: 323e 3c69 2063 6c61 7373 3d27 6661 7327  2><i class='fas'
+00025040: 3e5c 7566 3038 353c 2f69 3e26 6e62 7370  >\uf085</i>&nbsp
+00025050: 3b26 6e62 7370 3b4d 6973 633c 2f68 323e  ;&nbsp;Misc</h2>
+00025060: 0a20 2020 2020 2020 2020 2020 203c 6c61  .            <la
+00025070: 6265 6c3e 0a20 2020 2020 2020 2020 2020  bel>.           
+00025080: 2020 2020 203c 696e 7075 7420 7479 7065       <input type
+00025090: 3d27 6368 6563 6b62 6f78 2720 6368 6563  ='checkbox' chec
+000250a0: 6b65 643d 2774 7275 6527 3e3c 2f69 6e70  ked='true'></inp
+000250b0: 7574 3e0a 2020 2020 2020 2020 2020 2020  ut>.            
+000250c0: 2020 2020 5368 6f77 2065 6c61 7073 6564      Show elapsed
+000250d0: 2074 696d 6520 6265 6c6f 7720 7374 6172   time below star
+000250e0: 742d 6275 7474 6f6e 3c2f 6c61 6265 6c3e  t-button</label>
+000250f0: 0a0a 2020 2020 2020 2020 2020 2020 3c68  ..            <h
+00025100: 7220 7374 796c 653d 276d 6172 6769 6e2d  r style='margin-
+00025110: 746f 703a 2031 656d 3b27 202f 3e0a 0a20  top: 1em;' />.. 
+00025120: 2020 2020 2020 2020 2020 203c 6365 6e74             <cent
+00025130: 6572 2073 7479 6c65 3d27 666f 6e74 2d73  er style='font-s
+00025140: 697a 653a 3830 2527 3e53 6574 7469 6e67  ize:80%'>Setting
+00025150: 7320 666f 7220 7468 6973 2064 6576 6963  s for this devic
+00025160: 653c 2f63 656e 7465 723e 0a20 2020 2020  e</center>.     
+00025170: 2020 2020 2020 203c 6832 3e3c 6920 636c         <h2><i cl
+00025180: 6173 733d 2766 6173 273e 5c75 6633 6661  ass='fas'>\uf3fa
+00025190: 3c2f 693e 266e 6273 703b 266e 6273 703b  </i>&nbsp;&nbsp;
+000251a0: 4170 7065 6172 616e 6365 3c2f 6832 3e0a  Appearance</h2>.
+000251b0: 2020 2020 2020 2020 2020 2020 3c64 6976              <div
+000251c0: 2063 6c61 7373 3d27 666f 726d 6c61 796f   class='formlayo
+000251d0: 7574 273e 0a20 2020 2020 2020 2020 2020  ut'>.           
+000251e0: 2020 2020 203c 6469 763e 4c69 6768 7420       <div>Light 
+000251f0: 2f20 6461 726b 3a3c 2f64 6976 3e0a 2020  / dark:</div>.  
+00025200: 2020 2020 2020 2020 2020 2020 2020 3c73                <s
+00025210: 656c 6563 743e 0a20 2020 2020 2020 2020  elect>.         
+00025220: 2020 2020 2020 2020 2020 203c 6f70 7469             <opti
+00025230: 6f6e 2076 616c 7565 3d30 3e41 7574 6f20  on value=0>Auto 
+00025240: 6465 7465 6374 3c2f 6f70 7469 6f6e 3e0a  detect</option>.
+00025250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025260: 2020 2020 3c6f 7074 696f 6e20 7661 6c75      <option valu
+00025270: 653d 313e 4c69 6768 7420 6d6f 6465 3c2f  e=1>Light mode</
+00025280: 6f70 7469 6f6e 3e0a 2020 2020 2020 2020  option>.        
+00025290: 2020 2020 2020 2020 2020 2020 3c6f 7074              <opt
+000252a0: 696f 6e20 7661 6c75 653d 323e 4461 726b  ion value=2>Dark
+000252b0: 206d 6f64 653c 2f6f 7074 696f 6e3e 0a20   mode</option>. 
+000252c0: 2020 2020 2020 2020 2020 2020 2020 203c                 <
+000252d0: 2f73 656c 6563 743e 0a20 2020 2020 2020  /select>.       
+000252e0: 2020 2020 2020 2020 203c 6469 763e 5769           <div>Wi
+000252f0: 6474 683a 3c2f 6469 763e 0a20 2020 2020  dth:</div>.     
+00025300: 2020 2020 2020 2020 2020 203c 7365 6c65             <sele
+00025310: 6374 3e0a 2020 2020 2020 2020 2020 2020  ct>.            
+00025320: 2020 2020 2020 2020 3c6f 7074 696f 6e20          <option 
+00025330: 7661 6c75 653d 2761 7574 6f27 3e41 7574  value='auto'>Aut
+00025340: 6f20 7363 616c 653c 2f6f 7074 696f 6e3e  o scale</option>
+00025350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025360: 2020 2020 203c 6f70 7469 6f6e 2076 616c       <option val
+00025370: 7565 3d27 3130 3030 273e 4d61 7820 3130  ue='1000'>Max 10
+00025380: 3030 7078 3c2f 6f70 7469 6f6e 3e0a 2020  00px</option>.  
+00025390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000253a0: 2020 3c6f 7074 696f 6e20 7661 6c75 653d    <option value=
+000253b0: 2731 3530 3027 3e4d 6178 2031 3530 3070  '1500'>Max 1500p
+000253c0: 783c 2f6f 7074 696f 6e3e 0a20 2020 2020  x</option>.     
+000253d0: 2020 2020 2020 2020 2020 2020 2020 203c                 <
+000253e0: 6f70 7469 6f6e 2076 616c 7565 3d27 6675  option value='fu
+000253f0: 6c6c 273e 4675 6c6c 2077 6964 7468 3c2f  ll'>Full width</
+00025400: 6f70 7469 6f6e 3e0a 2020 2020 2020 2020  option>.        
+00025410: 2020 2020 2020 2020 3c2f 7365 6c65 6374          </select
+00025420: 3e0a 2020 2020 2020 2020 2020 2020 3c2f  >.            </
+00025430: 6469 763e 0a20 2020 2020 2020 2020 2020  div>.           
+00025440: 203c 6832 3e3c 6920 636c 6173 733d 2766   <h2><i class='f
+00025450: 6173 273e 5c75 6630 6530 3c2f 693e 266e  as'>\uf0e0</i>&n
+00025460: 6273 703b 266e 6273 703b 4e6f 7469 6669  bsp;&nbsp;Notifi
+00025470: 6361 7469 6f6e 3c2f 6832 3e0a 2020 2020  cation</h2>.    
+00025480: 2020 2020 2020 2020 3c6c 6162 656c 3e0a          <label>.
+00025490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000254a0: 3c69 6e70 7574 2074 7970 653d 2763 6865  <input type='che
+000254b0: 636b 626f 7827 2063 6865 636b 6564 3d27  ckbox' checked='
+000254c0: 6661 6c73 6527 3e3c 2f69 6e70 7574 3e0a  false'></input>.
+000254d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000254e0: 5368 6f77 206e 6f74 6966 6963 6174 696f  Show notificatio
+000254f0: 6e20 7768 656e 2073 7461 7274 696e 6720  n when starting 
+00025500: 6120 7265 636f 7264 2e3c 2f6c 6162 656c  a record.</label
+00025510: 3e0a 2020 2020 2020 2020 2020 2020 3c68  >.            <h
+00025520: 323e 3c69 2063 6c61 7373 3d27 6661 7327  2><i class='fas'
+00025530: 3e5c 7566 3266 323c 2f69 3e26 6e62 7370  >\uf2f2</i>&nbsp
+00025540: 3b26 6e62 7370 3b50 6f6d 6f64 6f72 6f3c  ;&nbsp;Pomodoro<
+00025550: 2f68 323e 0a20 2020 2020 2020 2020 2020  /h2>.           
+00025560: 203c 6c61 6265 6c3e 0a20 2020 2020 2020   <label>.       
+00025570: 2020 2020 2020 2020 203c 696e 7075 7420           <input 
+00025580: 7479 7065 3d27 6368 6563 6b62 6f78 2720  type='checkbox' 
+00025590: 6368 6563 6b65 643d 2766 616c 7365 273e  checked='false'>
+000255a0: 3c2f 696e 7075 743e 0a20 2020 2020 2020  </input>.       
+000255b0: 2020 2020 2020 2020 2045 6e61 626c 6520           Enable 
+000255c0: 706f 6d6f 646f 726f 2028 6578 7065 7269  pomodoro (experi
+000255d0: 6d65 6e74 616c 2920 3c2f 6c61 6265 6c3e  mental) </label>
+000255e0: 0a0a 2020 2020 2020 2020 2020 2020 3c68  ..            <h
+000255f0: 7220 7374 796c 653d 276d 6172 6769 6e2d  r style='margin-
+00025600: 746f 703a 2031 656d 3b27 202f 3e0a 0a20  top: 1em;' />.. 
+00025610: 2020 2020 2020 2020 2020 203c 6365 6e74             <cent
+00025620: 6572 2073 7479 6c65 3d27 666f 6e74 2d73  er style='font-s
+00025630: 697a 653a 3830 2527 3e53 7461 7469 6320  ize:80%'>Static 
+00025640: 7365 7474 696e 6773 3c2f 6365 6e74 6572  settings</center
+00025650: 3e0a 2020 2020 2020 2020 2020 2020 3c68  >.            <h
+00025660: 323e 3c69 2063 6c61 7373 3d27 6661 7327  2><i class='fas'
+00025670: 3e5c 7566 3061 633c 2f69 3e26 6e62 7370  >\uf0ac</i>&nbsp
+00025680: 3b26 6e62 7370 3b54 696d 6520 7a6f 6e65  ;&nbsp;Time zone
+00025690: 3c2f 6832 3e0a 2020 2020 2020 2020 2020  </h2>.          
+000256a0: 2020 3c64 6976 3e3c 2f64 6976 3e0a 2020    <div></div>.  
+000256b0: 2020 2020 2020 2020 2020 3c68 323e 3c69            <h2><i
+000256c0: 2063 6c61 7373 3d27 6661 7327 3e5c 7566   class='fas'>\uf
+000256d0: 3131 633c 2f69 3e26 6e62 7370 3b26 6e62  11c</i>&nbsp;&nb
+000256e0: 7370 3b4b 6579 626f 6172 6420 7368 6f72  sp;Keyboard shor
+000256f0: 7463 7574 733c 2f68 323e 0a20 2020 2020  tcuts</h2>.     
+00025700: 2020 2020 2020 203c 6469 7620 636c 6173         <div clas
+00025710: 733d 2766 6f72 6d6c 6179 6f75 7427 3e7b  s='formlayout'>{
+00025720: 7368 6f72 7463 7574 735f 6874 6d6c 7d3c  shortcuts_html}<
+00025730: 2f64 6976 3e0a 2020 2020 2020 2020 2020  /div>.          
+00025740: 2020 3c62 7220 2f3e 3c62 7220 2f3e 0a20    <br /><br />. 
+00025750: 2020 2020 2020 2020 2020 2022 2222 0a0a             """..
+00025760: 2020 2020 2020 2020 7365 6c66 2e6d 6169          self.mai
+00025770: 6e64 6976 2e69 6e6e 6572 4854 4d4c 203d  ndiv.innerHTML =
+00025780: 2068 746d 6c0a 2020 2020 2020 2020 7365   html.        se
+00025790: 6c66 2e5f 636c 6f73 655f 6275 7420 3d20  lf._close_but = 
+000257a0: 7365 6c66 2e6d 6169 6e64 6976 2e63 6869  self.maindiv.chi
+000257b0: 6c64 7265 6e5b 305d 2e63 6869 6c64 7265  ldren[0].childre
+000257c0: 6e5b 2d31 5d0a 2020 2020 2020 2020 7365  n[-1].        se
+000257d0: 6c66 2e5f 636c 6f73 655f 6275 742e 6f6e  lf._close_but.on
+000257e0: 636c 6963 6b20 3d20 7365 6c66 2e63 6c6f  click = self.clo
+000257f0: 7365 0a20 2020 2020 2020 2028 0a20 2020  se.        (.   
+00025800: 2020 2020 2020 2020 205f 2c20 2023 2044           _,  # D
+00025810: 6961 6c6f 6720 7469 746c 650a 2020 2020  ialog title.    
+00025820: 2020 2020 2020 2020 5f2c 2020 2320 5365          _,  # Se
+00025830: 6374 696f 6e3a 2075 7365 7220 7365 7474  ction: user sett
+00025840: 696e 6773 0a20 2020 2020 2020 2020 2020  ings.           
+00025850: 205f 2c20 2023 2054 696d 6520 7265 7072   _,  # Time repr
+00025860: 2068 6561 6465 720a 2020 2020 2020 2020   header.        
+00025870: 2020 2020 7365 6c66 2e5f 7265 7072 5f66      self._repr_f
+00025880: 6f72 6d2c 0a20 2020 2020 2020 2020 2020  orm,.           
+00025890: 205f 2c20 2023 204d 6973 6320 6865 6164   _,  # Misc head
+000258a0: 6572 0a20 2020 2020 2020 2020 2020 2073  er.            s
+000258b0: 656c 662e 5f73 746f 7077 6174 6368 5f6c  elf._stopwatch_l
+000258c0: 6162 656c 2c0a 2020 2020 2020 2020 2020  abel,.          
+000258d0: 2020 5f2c 2020 2320 6872 0a20 2020 2020    _,  # hr.     
+000258e0: 2020 2020 2020 205f 2c20 2023 2053 6563         _,  # Sec
+000258f0: 7469 6f6e 3a20 7065 7220 6465 7669 6365  tion: per device
+00025900: 0a20 2020 2020 2020 2020 2020 205f 2c20  .            _, 
+00025910: 2023 2041 7070 6561 7261 6e63 6520 6865   # Appearance he
+00025920: 6164 6572 0a20 2020 2020 2020 2020 2020  ader.           
+00025930: 2073 656c 662e 5f61 7070 6561 7261 6e63   self._appearanc
+00025940: 655f 666f 726d 2c0a 2020 2020 2020 2020  e_form,.        
+00025950: 2020 2020 5f2c 2020 2320 4e6f 7469 6669      _,  # Notifi
+00025960: 6361 7469 6f6e 2068 6561 6465 720a 2020  cation header.  
+00025970: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00025980: 6e6f 7469 6669 6361 7469 6f6e 5f6c 6162  notification_lab
+00025990: 656c 2c0a 2020 2020 2020 2020 2020 2020  el,.            
+000259a0: 5f2c 2020 2320 506f 6d6f 646f 726f 2068  _,  # Pomodoro h
+000259b0: 6561 6465 720a 2020 2020 2020 2020 2020  eader.          
+000259c0: 2020 7365 6c66 2e5f 706f 6d6f 646f 726f    self._pomodoro
+000259d0: 5f6c 6162 656c 2c0a 2020 2020 2020 2020  _label,.        
+000259e0: 2020 2020 5f2c 2020 2320 6872 0a20 2020      _,  # hr.   
+000259f0: 2020 2020 2020 2020 205f 2c20 2023 2053           _,  # S
+00025a00: 6563 7469 6f6e 3a20 696e 666f 0a20 2020  ection: info.   
+00025a10: 2020 2020 2020 2020 205f 2c20 2023 2054           _,  # T
+00025a20: 696d 657a 6f6e 6520 6865 6164 6572 0a20  imezone header. 
+00025a30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00025a40: 5f74 696d 657a 6f6e 655f 6469 762c 0a20  _timezone_div,. 
+00025a50: 2020 2020 2020 2020 2020 205f 2c20 2023             _,  #
+00025a60: 2053 686f 7274 6375 7473 2068 6561 6465   Shortcuts heade
+00025a70: 720a 2020 2020 2020 2020 2020 2020 7365  r.            se
+00025a80: 6c66 2e5f 7368 6f72 7463 7574 735f 6469  lf._shortcuts_di
+00025a90: 762c 0a20 2020 2020 2020 2029 203d 2073  v,.        ) = s
+00025aa0: 656c 662e 6d61 696e 6469 762e 6368 696c  elf.maindiv.chil
+00025ab0: 6472 656e 0a0a 2020 2020 2020 2020 2320  dren..        # 
+00025ac0: 5573 6572 2073 6574 7469 6e67 730a 0a20  User settings.. 
+00025ad0: 2020 2020 2020 2023 2057 6565 6b73 2073         # Weeks s
+00025ae0: 7461 7274 7320 6f6e 0a20 2020 2020 2020  tarts on.       
+00025af0: 2066 6972 7374 5f64 6179 5f6f 665f 7765   first_day_of_we
+00025b00: 656b 203d 2077 696e 646f 772e 7369 6d70  ek = window.simp
+00025b10: 6c65 7365 7474 696e 6773 2e67 6574 2822  lesettings.get("
+00025b20: 6669 7273 745f 6461 795f 6f66 5f77 6565  first_day_of_wee
+00025b30: 6b22 290a 2020 2020 2020 2020 7365 6c66  k").        self
+00025b40: 2e5f 6669 7273 745f 6461 795f 6f66 5f77  ._first_day_of_w
+00025b50: 6565 6b20 3d20 7365 6c66 2e5f 7265 7072  eek = self._repr
+00025b60: 5f66 6f72 6d2e 6368 696c 6472 656e 5b31  _form.children[1
+00025b70: 5d0a 2020 2020 2020 2020 7365 6c66 2e5f  ].        self._
+00025b80: 6669 7273 745f 6461 795f 6f66 5f77 6565  first_day_of_wee
+00025b90: 6b2e 7661 6c75 6520 3d20 6669 7273 745f  k.value = first_
+00025ba0: 6461 795f 6f66 5f77 6565 6b0a 2020 2020  day_of_week.    
+00025bb0: 2020 2020 7365 6c66 2e5f 6669 7273 745f      self._first_
+00025bc0: 6461 795f 6f66 5f77 6565 6b2e 6f6e 6368  day_of_week.onch
+00025bd0: 616e 6765 203d 2073 656c 662e 5f6f 6e5f  ange = self._on_
+00025be0: 6669 7273 745f 6461 795f 6f66 5f77 6565  first_day_of_wee
+00025bf0: 6b5f 6368 616e 6765 0a0a 2020 2020 2020  k_change..      
+00025c00: 2020 2320 576f 726b 6461 7973 0a20 2020    # Workdays.   
+00025c10: 2020 2020 2077 6f72 6b64 6179 7320 3d20       workdays = 
+00025c20: 7769 6e64 6f77 2e73 696d 706c 6573 6574  window.simpleset
+00025c30: 7469 6e67 732e 6765 7428 2277 6f72 6b64  tings.get("workd
+00025c40: 6179 7322 290a 2020 2020 2020 2020 7365  ays").        se
+00025c50: 6c66 2e5f 776f 726b 6461 7973 203d 2073  lf._workdays = s
+00025c60: 656c 662e 5f72 6570 725f 666f 726d 2e63  elf._repr_form.c
+00025c70: 6869 6c64 7265 6e5b 335d 0a20 2020 2020  hildren[3].     
+00025c80: 2020 2073 656c 662e 5f77 6f72 6b64 6179     self._workday
+00025c90: 732e 7661 6c75 6520 3d20 776f 726b 6461  s.value = workda
+00025ca0: 7973 0a20 2020 2020 2020 2073 656c 662e  ys.        self.
+00025cb0: 5f77 6f72 6b64 6179 732e 6f6e 6368 616e  _workdays.onchan
+00025cc0: 6765 203d 2073 656c 662e 5f6f 6e5f 776f  ge = self._on_wo
+00025cd0: 726b 6461 7973 5f63 6861 6e67 650a 0a20  rkdays_change.. 
+00025ce0: 2020 2020 2020 2023 2054 696d 6520 7265         # Time re
+00025cf0: 7072 6573 656e 7461 7469 6f6e 0a20 2020  presentation.   
+00025d00: 2020 2020 2074 696d 655f 7265 7072 203d       time_repr =
+00025d10: 2077 696e 646f 772e 7369 6d70 6c65 7365   window.simplese
+00025d20: 7474 696e 6773 2e67 6574 2822 7469 6d65  ttings.get("time
+00025d30: 5f72 6570 7222 290a 2020 2020 2020 2020  _repr").        
+00025d40: 7365 6c66 2e5f 7469 6d65 5f72 6570 7220  self._time_repr 
+00025d50: 3d20 7365 6c66 2e5f 7265 7072 5f66 6f72  = self._repr_for
+00025d60: 6d2e 6368 696c 6472 656e 5b35 5d0a 2020  m.children[5].  
+00025d70: 2020 2020 2020 7365 6c66 2e5f 7469 6d65        self._time
+00025d80: 5f72 6570 722e 7661 6c75 6520 3d20 7469  _repr.value = ti
+00025d90: 6d65 5f72 6570 720a 2020 2020 2020 2020  me_repr.        
+00025da0: 7365 6c66 2e5f 7469 6d65 5f72 6570 722e  self._time_repr.
+00025db0: 6f6e 6368 616e 6765 203d 2073 656c 662e  onchange = self.
+00025dc0: 5f6f 6e5f 7469 6d65 5f72 6570 725f 6368  _on_time_repr_ch
+00025dd0: 616e 6765 0a0a 2020 2020 2020 2020 2320  ange..        # 
+00025de0: 4475 7261 7469 6f6e 2072 6570 7265 7365  Duration represe
+00025df0: 6e74 6174 696f 6e0a 2020 2020 2020 2020  ntation.        
+00025e00: 6475 7261 7469 6f6e 5f72 6570 7220 3d20  duration_repr = 
+00025e10: 7769 6e64 6f77 2e73 696d 706c 6573 6574  window.simpleset
+00025e20: 7469 6e67 732e 6765 7428 2264 7572 6174  tings.get("durat
+00025e30: 696f 6e5f 7265 7072 2229 0a20 2020 2020  ion_repr").     
+00025e40: 2020 2073 656c 662e 5f64 7572 6174 696f     self._duratio
+00025e50: 6e5f 7265 7072 203d 2073 656c 662e 5f72  n_repr = self._r
+00025e60: 6570 725f 666f 726d 2e63 6869 6c64 7265  epr_form.childre
+00025e70: 6e5b 375d 0a20 2020 2020 2020 2073 656c  n[7].        sel
+00025e80: 662e 5f64 7572 6174 696f 6e5f 7265 7072  f._duration_repr
+00025e90: 2e76 616c 7565 203d 2064 7572 6174 696f  .value = duratio
+00025ea0: 6e5f 7265 7072 0a20 2020 2020 2020 2073  n_repr.        s
+00025eb0: 656c 662e 5f64 7572 6174 696f 6e5f 7265  elf._duration_re
+00025ec0: 7072 2e6f 6e63 6861 6e67 6520 3d20 7365  pr.onchange = se
+00025ed0: 6c66 2e5f 6f6e 5f64 7572 6174 696f 6e5f  lf._on_duration_
+00025ee0: 7265 7072 5f63 6861 6e67 650a 0a20 2020  repr_change..   
+00025ef0: 2020 2020 2023 2054 6f64 6179 2073 6e61       # Today sna
+00025f00: 7020 7469 6d65 2f6f 6666 7365 740a 2020  p time/offset.  
+00025f10: 2020 2020 2020 746f 6461 795f 736e 6170        today_snap
+00025f20: 5f6f 6666 7365 7420 3d20 7769 6e64 6f77  _offset = window
+00025f30: 2e73 696d 706c 6573 6574 7469 6e67 732e  .simplesettings.
+00025f40: 6765 7428 2274 6f64 6179 5f73 6e61 705f  get("today_snap_
+00025f50: 6f66 6673 6574 2229 0a20 2020 2020 2020  offset").       
+00025f60: 2073 656c 662e 5f74 6f64 6179 5f73 6e61   self._today_sna
+00025f70: 705f 6f66 6673 6574 203d 2073 656c 662e  p_offset = self.
+00025f80: 5f72 6570 725f 666f 726d 2e63 6869 6c64  _repr_form.child
+00025f90: 7265 6e5b 395d 0a20 2020 2020 2020 2073  ren[9].        s
+00025fa0: 656c 662e 5f74 6f64 6179 5f73 6e61 705f  elf._today_snap_
+00025fb0: 6f66 6673 6574 2e76 616c 7565 203d 2074  offset.value = t
+00025fc0: 6f64 6179 5f73 6e61 705f 6f66 6673 6574  oday_snap_offset
+00025fd0: 0a20 2020 2020 2020 2073 656c 662e 5f74  .        self._t
+00025fe0: 6f64 6179 5f73 6e61 705f 6f66 6673 6574  oday_snap_offset
+00025ff0: 2e6f 6e63 6861 6e67 6520 3d20 7365 6c66  .onchange = self
+00026000: 2e5f 6f6e 5f74 6f64 6179 5f73 6e61 705f  ._on_today_snap_
+00026010: 6f66 6673 6574 5f63 6861 6e67 650a 0a20  offset_change.. 
+00026020: 2020 2020 2020 2023 2054 6f64 6179 206e         # Today n
+00026030: 756d 6265 7220 6f66 2068 6f75 7273 0a20  umber of hours. 
+00026040: 2020 2020 2020 2074 6f64 6179 5f65 6e64         today_end
+00026050: 5f6f 6666 7365 7420 3d20 7769 6e64 6f77  _offset = window
+00026060: 2e73 696d 706c 6573 6574 7469 6e67 732e  .simplesettings.
+00026070: 6765 7428 2274 6f64 6179 5f65 6e64 5f6f  get("today_end_o
+00026080: 6666 7365 7422 290a 2020 2020 2020 2020  ffset").        
+00026090: 7365 6c66 2e5f 746f 6461 795f 656e 645f  self._today_end_
+000260a0: 6f66 6673 6574 203d 2073 656c 662e 5f72  offset = self._r
+000260b0: 6570 725f 666f 726d 2e63 6869 6c64 7265  epr_form.childre
+000260c0: 6e5b 3131 5d0a 2020 2020 2020 2020 7365  n[11].        se
+000260d0: 6c66 2e5f 746f 6461 795f 656e 645f 6f66  lf._today_end_of
+000260e0: 6673 6574 2e76 616c 7565 203d 2074 6f64  fset.value = tod
+000260f0: 6179 5f65 6e64 5f6f 6666 7365 740a 2020  ay_end_offset.  
+00026100: 2020 2020 2020 7365 6c66 2e5f 746f 6461        self._toda
+00026110: 795f 656e 645f 6f66 6673 6574 2e6f 6e63  y_end_offset.onc
+00026120: 6861 6e67 6520 3d20 7365 6c66 2e5f 6f6e  hange = self._on
+00026130: 5f74 6f64 6179 5f65 6e64 5f6f 6666 7365  _today_end_offse
+00026140: 745f 6368 616e 6765 0a0a 2020 2020 2020  t_change..      
+00026150: 2020 2320 5374 6f70 7761 7463 680a 2020    # Stopwatch.  
+00026160: 2020 2020 2020 7368 6f77 5f73 746f 7077        show_stopw
+00026170: 6174 6368 203d 2077 696e 646f 772e 7369  atch = window.si
+00026180: 6d70 6c65 7365 7474 696e 6773 2e67 6574  mplesettings.get
+00026190: 2822 7368 6f77 5f73 746f 7077 6174 6368  ("show_stopwatch
+000261a0: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
+000261b0: 5f73 746f 7077 6174 6368 5f63 6865 636b  _stopwatch_check
+000261c0: 203d 2073 656c 662e 5f73 746f 7077 6174   = self._stopwat
+000261d0: 6368 5f6c 6162 656c 2e63 6869 6c64 7265  ch_label.childre
+000261e0: 6e5b 305d 0a20 2020 2020 2020 2073 656c  n[0].        sel
+000261f0: 662e 5f73 746f 7077 6174 6368 5f63 6865  f._stopwatch_che
+00026200: 636b 2e63 6865 636b 6564 203d 2073 686f  ck.checked = sho
+00026210: 775f 7374 6f70 7761 7463 680a 2020 2020  w_stopwatch.    
+00026220: 2020 2020 7365 6c66 2e5f 7374 6f70 7761      self._stopwa
+00026230: 7463 685f 6368 6563 6b2e 6f6e 6368 616e  tch_check.onchan
+00026240: 6765 203d 2073 656c 662e 5f6f 6e5f 7374  ge = self._on_st
+00026250: 6f70 7761 7463 685f 6368 6563 6b0a 0a20  opwatch_check.. 
+00026260: 2020 2020 2020 2023 2044 6576 6963 6520         # Device 
+00026270: 7365 7474 696e 6773 0a0a 2020 2020 2020  settings..      
+00026280: 2020 2320 4461 726b 206d 6f64 650a 2020    # Dark mode.  
+00026290: 2020 2020 2020 6461 726b 6d6f 6465 203d        darkmode =
+000262a0: 2077 696e 646f 772e 7369 6d70 6c65 7365   window.simplese
+000262b0: 7474 696e 6773 2e67 6574 2822 6461 726b  ttings.get("dark
+000262c0: 6d6f 6465 2229 0a20 2020 2020 2020 2073  mode").        s
+000262d0: 656c 662e 5f64 6172 6b6d 6f64 655f 7365  elf._darkmode_se
+000262e0: 6c65 6374 203d 2073 656c 662e 5f61 7070  lect = self._app
+000262f0: 6561 7261 6e63 655f 666f 726d 2e63 6869  earance_form.chi
+00026300: 6c64 7265 6e5b 315d 0a20 2020 2020 2020  ldren[1].       
+00026310: 2073 656c 662e 5f64 6172 6b6d 6f64 655f   self._darkmode_
+00026320: 7365 6c65 6374 2e76 616c 7565 203d 2064  select.value = d
+00026330: 6172 6b6d 6f64 650a 2020 2020 2020 2020  arkmode.        
+00026340: 7365 6c66 2e5f 6461 726b 6d6f 6465 5f73  self._darkmode_s
+00026350: 656c 6563 742e 6f6e 6368 616e 6765 203d  elect.onchange =
+00026360: 2073 656c 662e 5f6f 6e5f 6461 726b 6d6f   self._on_darkmo
+00026370: 6465 5f63 6861 6e67 650a 0a20 2020 2020  de_change..     
+00026380: 2020 2023 2057 6964 7468 206d 6f64 650a     # Width mode.
+00026390: 2020 2020 2020 2020 7769 6474 685f 6d6f          width_mo
+000263a0: 6465 203d 2077 696e 646f 772e 7369 6d70  de = window.simp
+000263b0: 6c65 7365 7474 696e 6773 2e67 6574 2822  lesettings.get("
+000263c0: 7769 6474 685f 6d6f 6465 2229 0a20 2020  width_mode").   
+000263d0: 2020 2020 2073 656c 662e 5f77 6964 7468       self._width
+000263e0: 5f6d 6f64 655f 7365 6c65 6374 203d 2073  _mode_select = s
+000263f0: 656c 662e 5f61 7070 6561 7261 6e63 655f  elf._appearance_
+00026400: 666f 726d 2e63 6869 6c64 7265 6e5b 335d  form.children[3]
+00026410: 0a20 2020 2020 2020 2073 656c 662e 5f77  .        self._w
+00026420: 6964 7468 5f6d 6f64 655f 7365 6c65 6374  idth_mode_select
+00026430: 2e76 616c 7565 203d 2077 6964 7468 5f6d  .value = width_m
+00026440: 6f64 650a 2020 2020 2020 2020 7365 6c66  ode.        self
+00026450: 2e5f 7769 6474 685f 6d6f 6465 5f73 656c  ._width_mode_sel
+00026460: 6563 742e 6f6e 6368 616e 6765 203d 2073  ect.onchange = s
+00026470: 656c 662e 5f6f 6e5f 7769 6474 685f 6d6f  elf._on_width_mo
+00026480: 6465 5f63 6861 6e67 650a 0a20 2020 2020  de_change..     
+00026490: 2020 2023 204e 6f74 6966 6963 6174 696f     # Notificatio
+000264a0: 6e73 0a20 2020 2020 2020 206e 6f74 6966  ns.        notif
+000264b0: 6963 6174 696f 6e73 5f65 6e61 626c 6564  ications_enabled
+000264c0: 203d 2077 696e 646f 772e 7369 6d70 6c65   = window.simple
+000264d0: 7365 7474 696e 6773 2e67 6574 2822 6e6f  settings.get("no
+000264e0: 7469 6669 6361 7469 6f6e 7322 290a 2020  tifications").  
+000264f0: 2020 2020 2020 7365 6c66 2e5f 6e6f 7469        self._noti
+00026500: 6669 6361 7469 6f6e 5f63 6865 636b 203d  fication_check =
+00026510: 2073 656c 662e 5f6e 6f74 6966 6963 6174   self._notificat
+00026520: 696f 6e5f 6c61 6265 6c2e 6368 696c 6472  ion_label.childr
+00026530: 656e 5b30 5d0a 2020 2020 2020 2020 7365  en[0].        se
+00026540: 6c66 2e5f 6e6f 7469 6669 6361 7469 6f6e  lf._notification
+00026550: 5f63 6865 636b 2e63 6865 636b 6564 203d  _check.checked =
+00026560: 206e 6f74 6966 6963 6174 696f 6e73 5f65   notifications_e
+00026570: 6e61 626c 6564 0a20 2020 2020 2020 2073  nabled.        s
+00026580: 656c 662e 5f6e 6f74 6966 6963 6174 696f  elf._notificatio
+00026590: 6e5f 6368 6563 6b2e 6f6e 6368 616e 6765  n_check.onchange
+000265a0: 203d 2073 656c 662e 5f6f 6e5f 6e6f 7469   = self._on_noti
+000265b0: 6669 6361 7469 6f6e 735f 6368 6563 6b0a  fications_check.
+000265c0: 0a20 2020 2020 2020 2023 2050 6f6d 6f64  .        # Pomod
+000265d0: 6f72 6f0a 2020 2020 2020 2020 706f 6d6f  oro.        pomo
+000265e0: 5f65 6e61 626c 6564 203d 2077 696e 646f  _enabled = windo
+000265f0: 772e 7369 6d70 6c65 7365 7474 696e 6773  w.simplesettings
+00026600: 2e67 6574 2822 706f 6d6f 646f 726f 5f65  .get("pomodoro_e
+00026610: 6e61 626c 6564 2229 0a20 2020 2020 2020  nabled").       
+00026620: 2073 656c 662e 5f70 6f6d 6f64 6f72 6f5f   self._pomodoro_
+00026630: 6368 6563 6b20 3d20 7365 6c66 2e5f 706f  check = self._po
+00026640: 6d6f 646f 726f 5f6c 6162 656c 2e63 6869  modoro_label.chi
+00026650: 6c64 7265 6e5b 305d 0a20 2020 2020 2020  ldren[0].       
+00026660: 2073 656c 662e 5f70 6f6d 6f64 6f72 6f5f   self._pomodoro_
+00026670: 6368 6563 6b2e 6368 6563 6b65 6420 3d20  check.checked = 
+00026680: 706f 6d6f 5f65 6e61 626c 6564 0a20 2020  pomo_enabled.   
+00026690: 2020 2020 2073 656c 662e 5f70 6f6d 6f64       self._pomod
+000266a0: 6f72 6f5f 6368 6563 6b2e 6f6e 6368 616e  oro_check.onchan
+000266b0: 6765 203d 2073 656c 662e 5f6f 6e5f 706f  ge = self._on_po
+000266c0: 6d6f 646f 726f 5f63 6865 636b 0a0a 2020  modoro_check..  
+000266d0: 2020 2020 2020 2320 5374 6174 6963 2073        # Static s
+000266e0: 6574 7469 6e67 730a 0a20 2020 2020 2020  ettings..       
+000266f0: 2023 2053 6574 2074 696d 657a 6f6e 6520   # Set timezone 
+00026700: 696e 666f 0a20 2020 2020 2020 2073 656c  info.        sel
+00026710: 662e 5f74 696d 657a 6f6e 655f 6469 762e  f._timezone_div.
+00026720: 696e 6e65 7254 6578 7420 3d20 2255 5443  innerText = "UTC
+00026730: 2220 2b20 6474 2e67 6574 5f74 696d 657a  " + dt.get_timez
+00026740: 6f6e 655f 696e 6469 6361 746f 7228 6474  one_indicator(dt
+00026750: 2e6e 6f77 2829 2c20 223a 2229 0a0a 2020  .now(), ":")..  
+00026760: 2020 2020 2020 7375 7065 7228 292e 6f70        super().op
+00026770: 656e 2863 616c 6c62 6163 6b29 0a0a 2020  en(callback)..  
+00026780: 2020 6465 6620 5f6f 6e5f 6669 7273 745f    def _on_first_
+00026790: 6461 795f 6f66 5f77 6565 6b5f 6368 616e  day_of_week_chan
+000267a0: 6765 2873 656c 6629 3a0a 2020 2020 2020  ge(self):.      
+000267b0: 2020 6669 7273 745f 6461 795f 6f66 5f77    first_day_of_w
+000267c0: 6565 6b20 3d20 696e 7428 7365 6c66 2e5f  eek = int(self._
+000267d0: 6669 7273 745f 6461 795f 6f66 5f77 6565  first_day_of_wee
+000267e0: 6b2e 7661 6c75 6529 0a20 2020 2020 2020  k.value).       
+000267f0: 2077 696e 646f 772e 7369 6d70 6c65 7365   window.simplese
+00026800: 7474 696e 6773 2e73 6574 2822 6669 7273  ttings.set("firs
+00026810: 745f 6461 795f 6f66 5f77 6565 6b22 2c20  t_day_of_week", 
+00026820: 6669 7273 745f 6461 795f 6f66 5f77 6565  first_day_of_wee
+00026830: 6b29 0a0a 2020 2020 6465 6620 5f6f 6e5f  k)..    def _on_
+00026840: 776f 726b 6461 7973 5f63 6861 6e67 6528  workdays_change(
+00026850: 7365 6c66 293a 0a20 2020 2020 2020 2077  self):.        w
+00026860: 6f72 6b64 6179 7320 3d20 696e 7428 7365  orkdays = int(se
+00026870: 6c66 2e5f 776f 726b 6461 7973 2e76 616c  lf._workdays.val
+00026880: 7565 290a 2020 2020 2020 2020 7769 6e64  ue).        wind
+00026890: 6f77 2e73 696d 706c 6573 6574 7469 6e67  ow.simplesetting
+000268a0: 732e 7365 7428 2277 6f72 6b64 6179 7322  s.set("workdays"
+000268b0: 2c20 776f 726b 6461 7973 290a 0a20 2020  , workdays)..   
+000268c0: 2064 6566 205f 6f6e 5f74 696d 655f 7265   def _on_time_re
+000268d0: 7072 5f63 6861 6e67 6528 7365 6c66 293a  pr_change(self):
+000268e0: 0a20 2020 2020 2020 2074 696d 655f 7265  .        time_re
+000268f0: 7072 203d 2073 656c 662e 5f74 696d 655f  pr = self._time_
+00026900: 7265 7072 2e76 616c 7565 0a20 2020 2020  repr.value.     
+00026910: 2020 2077 696e 646f 772e 7369 6d70 6c65     window.simple
+00026920: 7365 7474 696e 6773 2e73 6574 2822 7469  settings.set("ti
+00026930: 6d65 5f72 6570 7222 2c20 7469 6d65 5f72  me_repr", time_r
+00026940: 6570 7229 0a0a 2020 2020 6465 6620 5f6f  epr)..    def _o
+00026950: 6e5f 6475 7261 7469 6f6e 5f72 6570 725f  n_duration_repr_
+00026960: 6368 616e 6765 2873 656c 6629 3a0a 2020  change(self):.  
+00026970: 2020 2020 2020 6475 7261 7469 6f6e 5f72        duration_r
+00026980: 6570 7220 3d20 7365 6c66 2e5f 6475 7261  epr = self._dura
+00026990: 7469 6f6e 5f72 6570 722e 7661 6c75 650a  tion_repr.value.
+000269a0: 2020 2020 2020 2020 7769 6e64 6f77 2e73          window.s
+000269b0: 696d 706c 6573 6574 7469 6e67 732e 7365  implesettings.se
+000269c0: 7428 2264 7572 6174 696f 6e5f 7265 7072  t("duration_repr
+000269d0: 222c 2064 7572 6174 696f 6e5f 7265 7072  ", duration_repr
+000269e0: 290a 0a20 2020 2064 6566 205f 6f6e 5f74  )..    def _on_t
+000269f0: 6f64 6179 5f73 6e61 705f 6f66 6673 6574  oday_snap_offset
+00026a00: 5f63 6861 6e67 6528 7365 6c66 293a 0a20  _change(self):. 
+00026a10: 2020 2020 2020 2074 6f64 6179 5f73 6e61         today_sna
+00026a20: 705f 6f66 6673 6574 203d 2073 656c 662e  p_offset = self.
+00026a30: 5f74 6f64 6179 5f73 6e61 705f 6f66 6673  _today_snap_offs
+00026a40: 6574 2e76 616c 7565 0a20 2020 2020 2020  et.value.       
+00026a50: 2077 696e 646f 772e 7369 6d70 6c65 7365   window.simplese
+00026a60: 7474 696e 6773 2e73 6574 2822 746f 6461  ttings.set("toda
+00026a70: 795f 736e 6170 5f6f 6666 7365 7422 2c20  y_snap_offset", 
+00026a80: 746f 6461 795f 736e 6170 5f6f 6666 7365  today_snap_offse
+00026a90: 7429 0a0a 2020 2020 6465 6620 5f6f 6e5f  t)..    def _on_
+00026aa0: 746f 6461 795f 656e 645f 6f66 6673 6574  today_end_offset
+00026ab0: 5f63 6861 6e67 6528 7365 6c66 293a 0a20  _change(self):. 
+00026ac0: 2020 2020 2020 2074 6f64 6179 5f65 6e64         today_end
+00026ad0: 5f6f 6666 7365 7420 3d20 7365 6c66 2e5f  _offset = self._
+00026ae0: 746f 6461 795f 656e 645f 6f66 6673 6574  today_end_offset
+00026af0: 2e76 616c 7565 0a20 2020 2020 2020 2077  .value.        w
+00026b00: 696e 646f 772e 7369 6d70 6c65 7365 7474  indow.simplesett
+00026b10: 696e 6773 2e73 6574 2822 746f 6461 795f  ings.set("today_
+00026b20: 656e 645f 6f66 6673 6574 222c 2074 6f64  end_offset", tod
+00026b30: 6179 5f65 6e64 5f6f 6666 7365 7429 0a0a  ay_end_offset)..
+00026b40: 2020 2020 6465 6620 5f6f 6e5f 6461 726b      def _on_dark
+00026b50: 6d6f 6465 5f63 6861 6e67 6528 7365 6c66  mode_change(self
+00026b60: 293a 0a20 2020 2020 2020 2064 6172 6b6d  ):.        darkm
+00026b70: 6f64 6520 3d20 696e 7428 7365 6c66 2e5f  ode = int(self._
+00026b80: 6461 726b 6d6f 6465 5f73 656c 6563 742e  darkmode_select.
+00026b90: 7661 6c75 6529 0a20 2020 2020 2020 2077  value).        w
+00026ba0: 696e 646f 772e 7369 6d70 6c65 7365 7474  indow.simplesett
+00026bb0: 696e 6773 2e73 6574 2822 6461 726b 6d6f  ings.set("darkmo
+00026bc0: 6465 222c 2064 6172 6b6d 6f64 6529 0a20  de", darkmode). 
+00026bd0: 2020 2020 2020 2069 6620 7769 6e64 6f77         if window
+00026be0: 2e66 726f 6e74 3a0a 2020 2020 2020 2020  .front:.        
+00026bf0: 2020 2020 7769 6e64 6f77 2e66 726f 6e74      window.front
+00026c00: 2e73 6574 5f63 6f6c 6f72 7328 290a 0a20  .set_colors().. 
+00026c10: 2020 2064 6566 205f 6f6e 5f77 6964 7468     def _on_width
+00026c20: 5f6d 6f64 655f 6368 616e 6765 2873 656c  _mode_change(sel
+00026c30: 6629 3a0a 2020 2020 2020 2020 7769 6474  f):.        widt
+00026c40: 685f 6d6f 6465 203d 2073 656c 662e 5f77  h_mode = self._w
+00026c50: 6964 7468 5f6d 6f64 655f 7365 6c65 6374  idth_mode_select
+00026c60: 2e76 616c 7565 0a20 2020 2020 2020 2077  .value.        w
+00026c70: 696e 646f 772e 7369 6d70 6c65 7365 7474  indow.simplesett
+00026c80: 696e 6773 2e73 6574 2822 7769 6474 685f  ings.set("width_
+00026c90: 6d6f 6465 222c 2077 6964 7468 5f6d 6f64  mode", width_mod
+00026ca0: 6529 0a20 2020 2020 2020 2069 6620 7769  e).        if wi
+00026cb0: 6e64 6f77 2e66 726f 6e74 3a0a 2020 2020  ndow.front:.    
+00026cc0: 2020 2020 2020 2020 7769 6e64 6f77 2e66          window.f
+00026cd0: 726f 6e74 2e73 6574 5f77 6964 7468 5f6d  ront.set_width_m
+00026ce0: 6f64 6528 7769 6474 685f 6d6f 6465 290a  ode(width_mode).
+00026cf0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00026d00: 2e5f 6361 6e76 6173 2e5f 6f6e 5f6a 735f  ._canvas._on_js_
+00026d10: 7265 7369 7a65 5f65 7665 6e74 2829 2020  resize_event()  
+00026d20: 2320 7072 6976 6174 6520 6d65 7468 6f64  # private method
+00026d30: 2c20 6275 7420 6168 2077 656c 6c0a 0a20  , but ah well.. 
+00026d40: 2020 2064 6566 205f 6f6e 5f6e 6f74 6966     def _on_notif
+00026d50: 6963 6174 696f 6e73 5f63 6865 636b 2873  ications_check(s
+00026d60: 656c 6629 3a0a 2020 2020 2020 2020 6e6f  elf):.        no
+00026d70: 7469 6669 6361 7469 6f6e 735f 656e 6162  tifications_enab
+00026d80: 6c65 6420 3d20 626f 6f6c 2873 656c 662e  led = bool(self.
+00026d90: 5f6e 6f74 6966 6963 6174 696f 6e5f 6368  _notification_ch
+00026da0: 6563 6b2e 6368 6563 6b65 6429 0a20 2020  eck.checked).   
+00026db0: 2020 2020 2077 696e 646f 772e 7369 6d70       window.simp
+00026dc0: 6c65 7365 7474 696e 6773 2e73 6574 2822  lesettings.set("
+00026dd0: 6e6f 7469 6669 6361 7469 6f6e 7322 2c20  notifications", 
+00026de0: 6e6f 7469 6669 6361 7469 6f6e 735f 656e  notifications_en
+00026df0: 6162 6c65 6429 0a20 2020 2020 2020 2023  abled).        #
+00026e00: 2041 736b 2074 6865 2075 7365 720a 2020   Ask the user.  
+00026e10: 2020 2020 2020 6966 206e 6f74 6966 6963        if notific
+00026e20: 6174 696f 6e73 5f65 6e61 626c 6564 3a0a  ations_enabled:.
+00026e30: 2020 2020 2020 2020 2020 2020 6966 2077              if w
+00026e40: 696e 646f 772e 4e6f 7469 6669 6361 7469  indow.Notificati
+00026e50: 6f6e 2061 6e64 2077 696e 646f 772e 4e6f  on and window.No
+00026e60: 7469 6669 6361 7469 6f6e 2e70 6572 6d69  tification.permi
+00026e70: 7373 696f 6e20 3d3d 2022 6465 6661 756c  ssion == "defaul
+00026e80: 7422 3a0a 2020 2020 2020 2020 2020 2020  t":.            
+00026e90: 2020 2020 4e6f 7469 6669 6361 7469 6f6e      Notification
+00026ea0: 2e72 6571 7565 7374 5065 726d 6973 7369  .requestPermissi
+00026eb0: 6f6e 2829 0a0a 2020 2020 6465 6620 5f6f  on()..    def _o
+00026ec0: 6e5f 706f 6d6f 646f 726f 5f63 6865 636b  n_pomodoro_check
+00026ed0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00026ee0: 706f 6d6f 5f65 6e61 626c 6564 203d 2062  pomo_enabled = b
+00026ef0: 6f6f 6c28 7365 6c66 2e5f 706f 6d6f 646f  ool(self._pomodo
+00026f00: 726f 5f63 6865 636b 2e63 6865 636b 6564  ro_check.checked
+00026f10: 290a 2020 2020 2020 2020 7769 6e64 6f77  ).        window
+00026f20: 2e73 696d 706c 6573 6574 7469 6e67 732e  .simplesettings.
+00026f30: 7365 7428 2270 6f6d 6f64 6f72 6f5f 656e  set("pomodoro_en
+00026f40: 6162 6c65 6422 2c20 706f 6d6f 5f65 6e61  abled", pomo_ena
+00026f50: 626c 6564 290a 0a20 2020 2064 6566 205f  bled)..    def _
+00026f60: 6f6e 5f73 746f 7077 6174 6368 5f63 6865  on_stopwatch_che
+00026f70: 636b 2873 656c 6629 3a0a 2020 2020 2020  ck(self):.      
+00026f80: 2020 7368 6f77 5f73 746f 7077 6174 6368    show_stopwatch
+00026f90: 203d 2062 6f6f 6c28 7365 6c66 2e5f 7374   = bool(self._st
+00026fa0: 6f70 7761 7463 685f 6368 6563 6b2e 6368  opwatch_check.ch
+00026fb0: 6563 6b65 6429 0a20 2020 2020 2020 2077  ecked).        w
+00026fc0: 696e 646f 772e 7369 6d70 6c65 7365 7474  indow.simplesett
+00026fd0: 696e 6773 2e73 6574 2822 7368 6f77 5f73  ings.set("show_s
+00026fe0: 746f 7077 6174 6368 222c 2073 686f 775f  topwatch", show_
+00026ff0: 7374 6f70 7761 7463 6829 0a0a 0a63 6c61  stopwatch)...cla
+00027000: 7373 2047 7569 6465 4469 616c 6f67 2842  ss GuideDialog(B
+00027010: 6173 6544 6961 6c6f 6729 3a0a 2020 2020  aseDialog):.    
+00027020: 2222 2244 6961 6c6f 6720 746f 2068 6176  """Dialog to hav
+00027030: 6520 7175 6963 6b20 6163 6365 7373 2074  e quick access t
+00027040: 6f20 7468 6520 6775 6964 652e 2222 220a  o the guide.""".
+00027050: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+00027060: 5f28 7365 6c66 2c20 6361 6e76 6173 293a  _(self, canvas):
+00027070: 0a20 2020 2020 2020 2073 7570 6572 2829  .        super()
+00027080: 2e5f 5f69 6e69 745f 5f28 6361 6e76 6173  .__init__(canvas
+00027090: 290a 2020 2020 2020 2020 7365 6c66 2e69  ).        self.i
+000270a0: 6e69 7469 616c 697a 6564 203d 2030 0a0a  nitialized = 0..
+000270b0: 2020 2020 6465 6620 6f70 656e 2873 656c      def open(sel
+000270c0: 662c 2063 616c 6c62 6163 6b3d 4e6f 6e65  f, callback=None
+000270d0: 293a 0a20 2020 2020 2020 2023 204f 6e6c  ):.        # Onl
+000270e0: 7920 696e 6974 206f 6e63 652c 2073 6f20  y init once, so 
+000270f0: 7468 6174 2074 6865 2067 7569 6465 2073  that the guide s
+00027100: 7461 7973 2069 6e20 7468 6520 7374 6174  tays in the stat
+00027110: 6520 6173 2074 6865 0a20 2020 2020 2020  e as the.       
+00027120: 2023 2075 7365 7220 7472 6965 7320 736f   # user tries so
+00027130: 6d65 7468 696e 6720 616e 6420 7468 656e  mething and then
+00027140: 206f 7065 6e73 2069 7420 6167 6169 6e2e   opens it again.
+00027150: 2055 7020 746f 2032 3420 686f 7572 732e   Up to 24 hours.
+00027160: 0a20 2020 2020 2020 2069 6620 6474 2e6e  .        if dt.n
+00027170: 6f77 2829 203c 2073 656c 662e 696e 6974  ow() < self.init
+00027180: 6961 6c69 7a65 6420 2b20 3836 3430 303a  ialized + 86400:
+00027190: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000271a0: 7572 6e20 7375 7065 7228 292e 6f70 656e  urn super().open
+000271b0: 2863 616c 6c62 6163 6b29 0a20 2020 2020  (callback).     
+000271c0: 2020 2073 656c 662e 696e 6974 6961 6c69     self.initiali
+000271d0: 7a65 6420 3d20 6474 2e6e 6f77 2829 0a0a  zed = dt.now()..
+000271e0: 2020 2020 2020 2020 7365 6c66 2e6d 6169          self.mai
+000271f0: 6e64 6976 2e69 6e6e 6572 4854 4d4c 203d  ndiv.innerHTML =
+00027200: 2022 2222 0a20 2020 2020 2020 2020 2020   """.           
+00027210: 203c 6831 3e3c 6920 636c 6173 733d 2766   <h1><i class='f
+00027220: 6173 273e 5c75 6630 3561 3c2f 693e 266e  as'>\uf05a</i>&n
+00027230: 6273 703b 266e 6273 703b 4775 6964 650a  bsp;&nbsp;Guide.
+00027240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027250: 3c62 7574 746f 6e20 7479 7065 3d27 6275  <button type='bu
+00027260: 7474 6f6e 273e 3c69 2063 6c61 7373 3d27  tton'><i class='
+00027270: 6661 7327 3e5c 7566 3030 643c 2f69 3e3c  fas'>\uf00d</i><
+00027280: 2f62 7574 746f 6e3e 0a20 2020 2020 2020  /button>.       
+00027290: 2020 2020 203c 2f68 313e 0a20 2020 2020       </h1>.     
+000272a0: 2020 2020 2020 203c 6966 7261 6d65 2073         <iframe s
+000272b0: 7263 3d27 6874 7470 733a 2f2f 7469 6d65  rc='https://time
+000272c0: 7461 6767 6572 2e61 7070 2f67 7569 6465  tagger.app/guide
+000272d0: 5f68 6561 646c 6573 7327 0a20 2020 2020  _headless'.     
+000272e0: 2020 2020 2020 2064 6973 706c 6179 3a62         display:b
+000272f0: 6c6f 636b 3b20 7374 796c 653d 2777 6964  lock; style='wid
+00027300: 7468 3a31 3030 253b 2068 6569 6768 743a  th:100%; height:
+00027310: 6361 6c63 2839 3076 6820 2d20 3130 3070  calc(90vh - 100p
+00027320: 7829 3b20 626f 7264 6572 3a6e 6f6e 653b  x); border:none;
+00027330: 270a 2020 2020 2020 2020 2020 2020 2f3e  '.            />
+00027340: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+00027350: 2020 2020 2020 7365 6c66 2e5f 6361 6e63        self._canc
+00027360: 656c 5f62 7574 203d 2073 656c 662e 6d61  el_but = self.ma
+00027370: 696e 6469 762e 6368 696c 6472 656e 5b30  indiv.children[0
+00027380: 5d2e 6368 696c 6472 656e 5b2d 315d 0a20  ].children[-1]. 
+00027390: 2020 2020 2020 2073 656c 662e 5f63 616e         self._can
+000273a0: 6365 6c5f 6275 742e 6f6e 636c 6963 6b20  cel_but.onclick 
+000273b0: 3d20 7365 6c66 2e63 6c6f 7365 0a20 2020  = self.close.   
+000273c0: 2020 2020 2073 7570 6572 2829 2e6f 7065       super().ope
+000273d0: 6e28 6361 6c6c 6261 636b 290a 0a0a 636c  n(callback)...cl
+000273e0: 6173 7320 506f 6d6f 646f 726f 4469 616c  ass PomodoroDial
+000273f0: 6f67 2842 6173 6544 6961 6c6f 6729 3a0a  og(BaseDialog):.
+00027400: 2020 2020 2222 2244 6961 6c6f 6720 746f      """Dialog to
+00027410: 2063 6f6e 7472 6f6c 2074 6865 2050 6f6d   control the Pom
+00027420: 6f64 6f72 6f20 7469 6d65 722e 2222 220a  odoro timer.""".
+00027430: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+00027440: 5f28 7365 6c66 2c20 6361 6e76 6173 293a  _(self, canvas):
+00027450: 0a20 2020 2020 2020 2073 7570 6572 2829  .        super()
+00027460: 2e5f 5f69 6e69 745f 5f28 6361 6e76 6173  .__init__(canvas
+00027470: 290a 0a20 2020 2020 2020 2023 204e 6f74  )..        # Not
+00027480: 6520 7468 6174 2077 6520 6173 7375 6d65  e that we assume
+00027490: 2074 6861 7420 7468 6973 2069 7320 7468   that this is th
+000274a0: 6520 6f6e 6c79 2063 6f64 6520 746f 7563  e only code touc
+000274b0: 6869 6e67 2074 6865 2064 6f63 756d 656e  hing the documen
+000274c0: 7420 7469 746c 650a 2020 2020 2020 2020  t title.        
+000274d0: 7365 6c66 2e5f 6f72 6967 696e 616c 5f74  self._original_t
+000274e0: 6974 6c65 203d 2077 696e 646f 772e 646f  itle = window.do
+000274f0: 6375 6d65 6e74 2e74 6974 6c65 0a0a 2020  cument.title..  
+00027500: 2020 2020 2020 2320 496e 6974 0a20 2020        # Init.   
+00027510: 2020 2020 2073 656c 662e 5f69 6e69 7428       self._init(
+00027520: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
+00027530: 7365 745f 7374 6174 6528 2270 7265 2d77  set_state("pre-w
+00027540: 6f72 6b22 290a 0a20 2020 2020 2020 2023  ork")..        #
+00027550: 2053 6574 7570 2063 616c 6c62 6163 6b73   Setup callbacks
+00027560: 0a20 2020 2020 2020 2077 696e 646f 772e  .        window.
+00027570: 7365 7449 6e74 6572 7661 6c28 7365 6c66  setInterval(self
+00027580: 2e5f 7570 6461 7465 2c20 3235 3029 0a20  ._update, 250). 
+00027590: 2020 2020 2020 2077 696e 646f 772e 646f         window.do
+000275a0: 6375 6d65 6e74 2e61 6464 4576 656e 744c  cument.addEventL
+000275b0: 6973 7465 6e65 7228 2276 6973 6962 696c  istener("visibil
+000275c0: 6974 7963 6861 6e67 6522 2c20 7365 6c66  itychange", self
+000275d0: 2e5f 7570 6461 7465 290a 2020 2020 2020  ._update).      
+000275e0: 2020 6966 2077 696e 646f 772e 6e61 7669    if window.navi
+000275f0: 6761 746f 722e 7365 7276 6963 6557 6f72  gator.serviceWor
+00027600: 6b65 723a 0a20 2020 2020 2020 2020 2020  ker:.           
+00027610: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+00027620: 2020 2020 2020 7769 6e64 6f77 2e6e 6176        window.nav
+00027630: 6967 6174 6f72 2e73 6572 7669 6365 576f  igator.serviceWo
+00027640: 726b 6572 2e61 6464 4576 656e 744c 6973  rker.addEventLis
+00027650: 7465 6e65 7228 0a20 2020 2020 2020 2020  tener(.         
+00027660: 2020 2020 2020 2020 2020 2022 6d65 7373             "mess
+00027670: 6167 6522 2c20 7365 6c66 2e6f 6e5f 6e6f  age", self.on_no
+00027680: 7469 6669 6361 7469 6f6e 636c 6963 6b0a  tificationclick.
+00027690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000276a0: 290a 2020 2020 2020 2020 2020 2020 6578  ).            ex
+000276b0: 6365 7074 2045 7863 6570 7469 6f6e 3a0a  cept Exception:.
+000276c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000276d0: 7061 7373 0a0a 2020 2020 2020 2020 2320  pass..        # 
+000276e0: 5072 6570 6172 6520 736f 756e 6473 0a20  Prepare sounds. 
+000276f0: 2020 2020 2020 2073 656c 662e 5f73 6f75         self._sou
+00027700: 6e64 7320 3d20 7b0a 2020 2020 2020 2020  nds = {.        
+00027710: 2020 2020 2277 696e 6422 3a20 4175 6469      "wind": Audi
+00027720: 6f28 2277 696e 642d 7570 2d31 2d35 3334  o("wind-up-1-534
+00027730: 2e6f 6767 2229 2c0a 2020 2020 2020 2020  .ogg"),.        
+00027740: 2020 2020 2277 6f72 6b5f 656e 6422 3a20      "work_end": 
+00027750: 4175 6469 6f28 2265 7665 6e74 7561 6c6c  Audio("eventuall
+00027760: 792d 3539 302e 6f67 6722 292c 0a20 2020  y-590.ogg"),.   
+00027770: 2020 2020 2020 2020 2022 6272 6561 6b5f           "break_
+00027780: 656e 6422 3a20 4175 6469 6f28 2265 7665  end": Audio("eve
+00027790: 6e74 7561 6c6c 792d 3539 302e 6f67 6722  ntually-590.ogg"
+000277a0: 292c 0a20 2020 2020 2020 2020 2020 2022  ),.            "
+000277b0: 6d61 6e75 616c 5f65 6e64 223a 2041 7564  manual_end": Aud
+000277c0: 696f 2822 636c 6561 726c 792d 3630 322e  io("clearly-602.
+000277d0: 6f67 6722 292c 0a20 2020 2020 2020 207d  ogg"),.        }
+000277e0: 0a0a 2020 2020 6465 6620 5f69 6e69 7428  ..    def _init(
+000277f0: 7365 6c66 293a 0a20 2020 2020 2020 2068  self):.        h
+00027800: 746d 6c20 3d20 6622 2222 0a20 2020 2020  tml = f""".     
+00027810: 2020 2020 2020 203c 6831 3e3c 6920 636c         <h1><i cl
+00027820: 6173 733d 2766 6173 273e 5c75 6632 6632  ass='fas'>\uf2f2
+00027830: 3c2f 693e 266e 6273 703b 266e 6273 703b  </i>&nbsp;&nbsp;
+00027840: 506f 6d6f 646f 726f 0a20 2020 2020 2020  Pomodoro.       
+00027850: 2020 2020 2020 2020 203c 6275 7474 6f6e           <button
+00027860: 2074 7970 653d 2762 7574 746f 6e27 3e3c   type='button'><
+00027870: 6920 636c 6173 733d 2766 6173 273e 5c75  i class='fas'>\u
+00027880: 6630 3064 3c2f 693e 3c2f 6275 7474 6f6e  f00d</i></button
+00027890: 3e0a 2020 2020 2020 2020 2020 2020 3c2f  >.            </
+000278a0: 6831 3e0a 2020 2020 2020 2020 2020 2020  h1>.            
+000278b0: 3c63 656e 7465 723e 0a20 2020 2020 2020  <center>.       
+000278c0: 2020 2020 2020 2020 203c 6469 7620 7374           <div st
+000278d0: 796c 653d 276d 6172 6769 6e3a 2031 656d  yle='margin: 1em
+000278e0: 3b20 666f 6e74 2d73 697a 653a 2031 3430  ; font-size: 140
+000278f0: 253b 273e 3235 3a30 303c 2f64 6976 3e0a  %;'>25:00</div>.
+00027900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027910: 3c62 7574 746f 6e20 7479 7065 3d27 6275  <button type='bu
+00027920: 7474 6f6e 2720 636c 6173 733d 2761 6374  tton' class='act
+00027930: 696f 6e62 7574 746f 6e27 2073 7479 6c65  ionbutton' style
+00027940: 3d27 6d61 7267 696e 3a20 3165 6d3b 273e  ='margin: 1em;'>
+00027950: 5374 6172 743c 2f62 7574 746f 6e3e 0a20  Start</button>. 
+00027960: 2020 2020 2020 2020 2020 203c 2f63 656e             </cen
+00027970: 7465 723e 0a20 2020 2020 2020 2020 2020  ter>.           
+00027980: 203c 6465 7461 696c 7320 7374 796c 653d   <details style=
+00027990: 2763 6f6c 6f72 3a20 2337 3737 3b20 6d61  'color: #777; ma
+000279a0: 7267 696e 3a20 3165 6d3b 2066 6f6e 742d  rgin: 1em; font-
+000279b0: 7369 7a65 3a20 3837 253b 273e 0a20 2020  size: 87%;'>.   
+000279c0: 2020 2020 2020 2020 203c 7375 6d6d 6172           <summar
+000279d0: 7920 7374 796c 653d 2763 7572 736f 723a  y style='cursor:
+000279e0: 2070 6f69 6e74 6572 3b27 3e54 6865 2050   pointer;'>The P
+000279f0: 6f6d 6f64 6f72 6f20 5465 6368 6e69 7175  omodoro Techniqu
+00027a00: 653c 2f73 756d 6d61 7279 3e0a 2020 2020  e</summary>.    
+00027a10: 2020 2020 2020 2020 3c70 3e0a 2020 2020          <p>.    
+00027a20: 2020 2020 2020 2020 5468 6520 506f 6d6f          The Pomo
+00027a30: 646f 726f 2054 6563 686e 6971 7565 2069  doro Technique i
+00027a40: 7320 6120 7469 6d65 206d 616e 6167 656d  s a time managem
+00027a50: 656e 7420 6d65 7468 6f64 2077 6865 7265  ent method where
+00027a60: 2079 6f75 0a20 2020 2020 2020 2020 2020   you.           
+00027a70: 2061 6c74 6572 6e61 7465 2062 6574 7765   alternate betwe
+00027a80: 656e 2032 3520 6d69 6e75 7465 7320 6f66  en 25 minutes of
+00027a90: 2077 6f72 6b20 616e 6420 3520 6d69 6e75   work and 5 minu
+00027aa0: 7465 2062 7265 616b 732e 0a20 2020 2020  te breaks..     
+00027ab0: 2020 2020 2020 2049 7420 6973 2072 6563         It is rec
+00027ac0: 6f6d 6d65 6e64 6564 2074 6f20 7573 6520  ommended to use 
+00027ad0: 6272 6561 6b73 2074 6f20 6c65 6176 6520  breaks to leave 
+00027ae0: 796f 7572 2063 6861 6972 2069 6620 796f  your chair if yo
+00027af0: 750a 2020 2020 2020 2020 2020 2020 7369  u.            si
+00027b00: 7420 6475 7269 6e67 2077 6f72 6b2e 2053  t during work. S
+00027b10: 6565 0a20 2020 2020 2020 2020 2020 203c  ee.            <
+00027b20: 6120 6872 6566 3d27 6874 7470 733a 2f2f  a href='https://
+00027b30: 7469 6d65 7461 6767 6572 2e61 7070 2f70  timetagger.app/p
+00027b40: 6f6d 6f64 6f72 6f2f 2720 7461 7267 6574  omodoro/' target
+00027b50: 3d27 6e65 7727 3e74 6869 7320 6172 7469  ='new'>this arti
+00027b60: 636c 653c 2f61 3e0a 2020 2020 2020 2020  cle</a>.        
+00027b70: 2020 2020 666f 7220 6d6f 7265 2069 6e66      for more inf
+00027b80: 6f2e 0a20 2020 2020 2020 2020 2020 203c  o..            <
+00027b90: 2f70 3e3c 703e 0a20 2020 2020 2020 2020  /p><p>.         
+00027ba0: 2020 2054 6865 2050 6f6d 6f64 6f72 6f20     The Pomodoro 
+00027bb0: 7469 6d65 7220 6973 2061 7574 6f6d 6174  timer is automat
+00027bc0: 6963 616c 6c79 2073 7461 7274 6564 2061  ically started a
+00027bd0: 6e64 2073 746f 7070 6564 2061 7320 796f  nd stopped as yo
+00027be0: 750a 2020 2020 2020 2020 2020 2020 7374  u.            st
+00027bf0: 6172 742f 7374 6f70 2074 7261 636b 696e  art/stop trackin
+00027c00: 6720 7469 6d65 2e20 5468 6973 2066 6561  g time. This fea
+00027c10: 7475 7265 2069 7320 6578 7065 7269 6d65  ture is experime
+00027c20: 6e74 616c 202d 2064 6f0a 2020 2020 2020  ntal - do.      
+00027c30: 2020 2020 2020 6c65 7420 7573 206b 6e6f        let us kno
+00027c40: 7720 6162 6f75 7420 7072 6f62 6c65 6d73  w about problems
+00027c50: 2061 6e64 2073 7567 6765 7374 696f 6e73   and suggestions
+00027c60: 210a 2020 2020 2020 2020 2020 2020 3c2f  !.            </
+00027c70: 703e 3c70 3e0a 2020 2020 2020 2020 2020  p><p>.          
+00027c80: 2020 5573 696e 6720 736f 756e 6473 2066    Using sounds f
+00027c90: 726f 6d20 6e6f 7469 6669 6361 7469 6f6e  rom notification
+00027ca0: 736f 756e 6473 2e63 6f6d 2e0a 2020 2020  sounds.com..    
+00027cb0: 2020 2020 2020 2020 3c2f 703e 3c2f 6465          </p></de
+00027cc0: 7461 696c 733e 0a20 2020 2020 2020 2020  tails>.         
+00027cd0: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+00027ce0: 7365 6c66 2e6d 6169 6e64 6976 2e69 6e6e  self.maindiv.inn
+00027cf0: 6572 4854 4d4c 203d 2068 746d 6c0a 0a20  erHTML = html.. 
+00027d00: 2020 2020 2020 2073 656c 662e 5f63 6c6f         self._clo
+00027d10: 7365 5f62 7574 203d 2073 656c 662e 6d61  se_but = self.ma
+00027d20: 696e 6469 762e 6368 696c 6472 656e 5b30  indiv.children[0
+00027d30: 5d2e 6368 696c 6472 656e 5b2d 315d 0a20  ].children[-1]. 
+00027d40: 2020 2020 2020 2073 656c 662e 5f63 6c6f         self._clo
+00027d50: 7365 5f62 7574 2e6f 6e63 6c69 636b 203d  se_but.onclick =
+00027d60: 2073 656c 662e 636c 6f73 650a 2020 2020   self.close.    
+00027d70: 2020 2020 280a 2020 2020 2020 2020 2020      (.          
+00027d80: 2020 7365 6c66 2e5f 6c61 6265 6c2c 0a20    self._label,. 
+00027d90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00027da0: 5f62 7574 746f 6e2c 0a20 2020 2020 2020  _button,.       
+00027db0: 2029 203d 2073 656c 662e 6d61 696e 6469   ) = self.maindi
+00027dc0: 762e 6368 696c 6472 656e 5b31 5d2e 6368  v.children[1].ch
+00027dd0: 696c 6472 656e 0a0a 2020 2020 2020 2020  ildren..        
+00027de0: 7365 6c66 2e5f 6275 7474 6f6e 2e6f 6e63  self._button.onc
+00027df0: 6c69 636b 203d 2073 656c 662e 5f6f 6e5f  lick = self._on_
+00027e00: 6275 7474 6f6e 5f63 6c69 636b 0a0a 2020  button_click..  
+00027e10: 2020 6465 6620 6f70 656e 2873 656c 662c    def open(self,
+00027e20: 2063 616c 6c62 6163 6b3d 4e6f 6e65 293a   callback=None):
+00027e30: 0a20 2020 2020 2020 2073 7570 6572 2829  .        super()
+00027e40: 2e6f 7065 6e28 6361 6c6c 6261 636b 290a  .open(callback).
+00027e50: 2020 2020 2020 2020 7365 6c66 2e5f 7570          self._up
+00027e60: 6461 7465 2829 0a0a 2020 2020 6465 6620  date()..    def 
+00027e70: 5f70 6c61 795f 736f 756e 6428 7365 6c66  _play_sound(self
+00027e80: 2c20 736f 756e 6429 3a0a 2020 2020 2020  , sound):.      
+00027e90: 2020 6175 6469 6f20 3d20 7365 6c66 2e5f    audio = self._
+00027ea0: 736f 756e 6473 5b73 6f75 6e64 5d0a 2020  sounds[sound].  
+00027eb0: 2020 2020 2020 6966 2061 7564 696f 2e63        if audio.c
+00027ec0: 7572 7265 6e74 5469 6d65 3a0a 2020 2020  urrentTime:.    
+00027ed0: 2020 2020 2020 2020 6175 6469 6f2e 6375          audio.cu
+00027ee0: 7272 656e 7454 696d 6520 3d20 300a 2020  rrentTime = 0.  
+00027ef0: 2020 2020 2020 7072 6f6d 6973 6520 3d20        promise = 
+00027f00: 6175 6469 6f2e 706c 6179 2829 0a20 2020  audio.play().   
+00027f10: 2020 2020 2023 2043 6174 6368 2077 6865       # Catch whe
+00027f20: 6e20 706c 6179 696e 6720 7468 6520 736f  n playing the so
+00027f30: 756e 6420 6661 696c 6564 2c20 746f 2061  und failed, to a
+00027f40: 766f 6964 2022 6e68 616e 646c 6564 2050  void "nhandled P
+00027f50: 726f 6d69 7365 2052 656a 6563 7469 6f6e  romise Rejection
+00027f60: 220a 2020 2020 2020 2020 6966 2070 726f  ".        if pro
+00027f70: 6d69 7365 3a0a 2020 2020 2020 2020 2020  mise:.          
+00027f80: 2020 7072 6f6d 6973 652e 6361 7463 6828    promise.catch(
+00027f90: 6c61 6d62 6461 2065 7272 3a20 4e6f 6e65  lambda err: None
+00027fa0: 290a 0a20 2020 2064 6566 205f 7365 745f  )..    def _set_
+00027fb0: 7374 6174 6528 7365 6c66 2c20 7374 6174  state(self, stat
+00027fc0: 6529 3a0a 2020 2020 2020 2020 6966 2073  e):.        if s
+00027fd0: 7461 7465 203d 3d20 2270 7265 2d77 6f72  tate == "pre-wor
+00027fe0: 6b22 3a0a 2020 2020 2020 2020 2020 2020  k":.            
+00027ff0: 6574 696d 6520 3d20 300a 2020 2020 2020  etime = 0.      
+00028000: 2020 2020 2020 7072 6574 6974 6c65 203d        pretitle =
+00028010: 2022 220a 2020 2020 2020 2020 2020 2020   "".            
+00028020: 7365 6c66 2e5f 6275 7474 6f6e 2e69 6e6e  self._button.inn
+00028030: 6572 4854 4d4c 203d 2022 5374 6172 7420  erHTML = "Start 
+00028040: 776f 726b 696e 6722 0a20 2020 2020 2020  working".       
+00028050: 2065 6c69 6620 7374 6174 6520 3d3d 2022   elif state == "
+00028060: 776f 726b 223a 0a20 2020 2020 2020 2020  work":.         
+00028070: 2020 2065 7469 6d65 203d 2064 742e 6e6f     etime = dt.no
+00028080: 7728 2920 2b20 3235 202a 2036 300a 2020  w() + 25 * 60.  
+00028090: 2020 2020 2020 2020 2020 7072 6574 6974            pretit
+000280a0: 6c65 203d 2022 576f 726b 696e 6720 7c20  le = "Working | 
+000280b0: 220a 2020 2020 2020 2020 2020 2020 7365  ".            se
+000280c0: 6c66 2e5f 6275 7474 6f6e 2e69 6e6e 6572  lf._button.inner
+000280d0: 4854 4d4c 203d 2022 5374 6f70 220a 2020  HTML = "Stop".  
+000280e0: 2020 2020 2020 656c 6966 2073 7461 7465        elif state
+000280f0: 203d 3d20 2270 7265 2d62 7265 616b 223a   == "pre-break":
+00028100: 0a20 2020 2020 2020 2020 2020 2065 7469  .            eti
+00028110: 6d65 203d 2030 0a20 2020 2020 2020 2020  me = 0.         
+00028120: 2020 2070 7265 7469 746c 6520 3d20 2222     pretitle = ""
+00028130: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00028140: 662e 5f62 7574 746f 6e2e 696e 6e65 7248  f._button.innerH
+00028150: 544d 4c20 3d20 2253 7461 7274 2062 7265  TML = "Start bre
+00028160: 616b 220a 2020 2020 2020 2020 656c 6966  ak".        elif
+00028170: 2073 7461 7465 203d 3d20 2262 7265 616b   state == "break
+00028180: 223a 0a20 2020 2020 2020 2020 2020 2065  ":.            e
+00028190: 7469 6d65 203d 2064 742e 6e6f 7728 2920  time = dt.now() 
+000281a0: 2b20 3520 2a20 3630 0a20 2020 2020 2020  + 5 * 60.       
+000281b0: 2020 2020 2070 7265 7469 746c 6520 3d20       pretitle = 
+000281c0: 2242 7265 616b 207c 2022 0a20 2020 2020  "Break | ".     
+000281d0: 2020 2020 2020 2073 656c 662e 5f62 7574         self._but
+000281e0: 746f 6e2e 696e 6e65 7248 544d 4c20 3d20  ton.innerHTML = 
+000281f0: 2253 746f 7022 0a20 2020 2020 2020 2065  "Stop".        e
+00028200: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00028210: 2063 6f6e 736f 6c65 2e77 6172 6e28 2249   console.warn("I
+00028220: 6e76 616c 6964 2070 6f6d 6f64 6f72 6f20  nvalid pomodoro 
+00028230: 7374 6174 653a 2022 202b 2073 7461 7465  state: " + state
+00028240: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00028250: 7475 726e 0a20 2020 2020 2020 2077 696e  turn.        win
+00028260: 646f 772e 646f 6375 6d65 6e74 2e74 6974  dow.document.tit
+00028270: 6c65 203d 2070 7265 7469 746c 6520 2b20  le = pretitle + 
+00028280: 7365 6c66 2e5f 6f72 6967 696e 616c 5f74  self._original_t
+00028290: 6974 6c65 0a20 2020 2020 2020 2073 656c  itle.        sel
+000282a0: 662e 5f73 7461 7465 203d 2073 7461 7465  f._state = state
+000282b0: 2c20 6574 696d 650a 2020 2020 2020 2020  , etime.        
+000282c0: 7365 6c66 2e5f 7570 6461 7465 2829 0a0a  self._update()..
+000282d0: 2020 2020 6465 6620 7469 6d65 5f6c 6566      def time_lef
+000282e0: 7428 7365 6c66 293a 0a20 2020 2020 2020  t(self):.       
+000282f0: 2065 7469 6d65 203d 2073 656c 662e 5f73   etime = self._s
+00028300: 7461 7465 5b31 5d0a 2020 2020 2020 2020  tate[1].        
+00028310: 6c65 6674 203d 206d 6178 2830 2c20 6574  left = max(0, et
+00028320: 696d 6520 2d20 6474 2e6e 6f77 2829 290a  ime - dt.now()).
+00028330: 2020 2020 2020 2020 6966 206c 6566 743a          if left:
+00028340: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00028350: 7572 6e20 7365 6c66 2e5f 7374 6174 655b  urn self._state[
+00028360: 305d 202b 2022 3a20 2220 2b20 6474 2e64  0] + ": " + dt.d
+00028370: 7572 6174 696f 6e5f 7374 7269 6e67 286c  uration_string(l
+00028380: 6566 742c 2054 7275 6529 0a20 2020 2020  eft, True).     
+00028390: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000283a0: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+000283b0: 0a0a 2020 2020 6465 6620 7374 6172 745f  ..    def start_
+000283c0: 776f 726b 2873 656c 6629 3a0a 2020 2020  work(self):.    
+000283d0: 2020 2020 7365 6c66 2e5f 7365 745f 7374      self._set_st
+000283e0: 6174 6528 2277 6f72 6b22 290a 0a20 2020  ate("work")..   
+000283f0: 2020 2020 2023 204e 6f77 2069 7320 6120       # Now is a 
+00028400: 676f 6f64 2074 696d 6520 746f 2061 736b  good time to ask
+00028410: 2066 6f72 2070 6572 6d69 7373 696f 6e2c   for permission,
+00028420: 0a20 2020 2020 2020 2023 2061 7373 756d  .        # assum
+00028430: 696e 6720 7468 6174 2074 6869 7320 6361  ing that this ca
+00028440: 6c6c 206f 7269 6769 6e61 6c6c 7920 6361  ll originally ca
+00028450: 6d65 2066 726f 6d20 6120 7573 6572 2773  me from a user's
+00028460: 206d 6f75 7365 2063 6c69 636b 2e0a 2020   mouse click..  
+00028470: 2020 2020 2020 6966 2077 696e 646f 772e        if window.
+00028480: 4e6f 7469 6669 6361 7469 6f6e 2061 6e64  Notification and
+00028490: 2077 696e 646f 772e 4e6f 7469 6669 6361   window.Notifica
+000284a0: 7469 6f6e 2e70 6572 6d69 7373 696f 6e20  tion.permission 
+000284b0: 3d3d 2022 6465 6661 756c 7422 3a0a 2020  == "default":.  
+000284c0: 2020 2020 2020 2020 2020 4e6f 7469 6669            Notifi
+000284d0: 6361 7469 6f6e 2e72 6571 7565 7374 5065  cation.requestPe
+000284e0: 726d 6973 7369 6f6e 2829 0a0a 2020 2020  rmission()..    
+000284f0: 2020 2020 7365 6c66 2e5f 706c 6179 5f73      self._play_s
+00028500: 6f75 6e64 2822 7769 6e64 2229 0a0a 2020  ound("wind")..  
+00028510: 2020 6465 6620 7374 6f70 2873 656c 6629    def stop(self)
+00028520: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
+00028530: 7365 745f 7374 6174 6528 2270 7265 2d77  set_state("pre-w
+00028540: 6f72 6b22 290a 0a20 2020 2064 6566 205f  ork")..    def _
+00028550: 6f6e 5f62 7574 746f 6e5f 636c 6963 6b28  on_button_click(
+00028560: 7365 6c66 293a 0a20 2020 2020 2020 2073  self):.        s
+00028570: 7461 7465 2c20 6574 696d 6520 3d20 7365  tate, etime = se
+00028580: 6c66 2e5f 7374 6174 650a 2020 2020 2020  lf._state.      
+00028590: 2020 6966 2073 7461 7465 203d 3d20 2270    if state == "p
+000285a0: 7265 2d77 6f72 6b22 3a0a 2020 2020 2020  re-work":.      
+000285b0: 2020 2020 2020 7365 6c66 2e73 7461 7274        self.start
+000285c0: 5f77 6f72 6b28 290a 2020 2020 2020 2020  _work().        
+000285d0: 656c 6966 2073 7461 7465 203d 3d20 2277  elif state == "w
+000285e0: 6f72 6b22 3a0a 2020 2020 2020 2020 2020  ork":.          
+000285f0: 2020 7365 6c66 2e5f 7365 745f 7374 6174    self._set_stat
+00028600: 6528 2270 7265 2d62 7265 616b 2229 0a20  e("pre-break"). 
+00028610: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00028620: 5f70 6c61 795f 736f 756e 6428 226d 616e  _play_sound("man
+00028630: 7561 6c5f 656e 6422 290a 2020 2020 2020  ual_end").      
+00028640: 2020 656c 6966 2073 7461 7465 203d 3d20    elif state == 
+00028650: 2270 7265 2d62 7265 616b 223a 0a20 2020  "pre-break":.   
+00028660: 2020 2020 2020 2020 2073 656c 662e 5f73           self._s
+00028670: 6574 5f73 7461 7465 2822 6272 6561 6b22  et_state("break"
+00028680: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00028690: 6c66 2e5f 706c 6179 5f73 6f75 6e64 2822  lf._play_sound("
+000286a0: 7769 6e64 2229 0a20 2020 2020 2020 2065  wind").        e
+000286b0: 6c69 6620 7374 6174 6520 3d3d 2022 6272  lif state == "br
+000286c0: 6561 6b22 3a0a 2020 2020 2020 2020 2020  eak":.          
+000286d0: 2020 7365 6c66 2e5f 7365 745f 7374 6174    self._set_stat
+000286e0: 6528 2270 7265 2d77 6f72 6b22 290a 2020  e("pre-work").  
+000286f0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00028700: 706c 6179 5f73 6f75 6e64 2822 6d61 6e75  play_sound("manu
+00028710: 616c 5f65 6e64 2229 0a20 2020 2020 2020  al_end").       
+00028720: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00028730: 2020 2073 656c 662e 5f73 6574 5f73 7461     self._set_sta
+00028740: 7465 2822 7072 652d 776f 726b 2229 0a0a  te("pre-work")..
+00028750: 2020 2020 6465 6620 5f75 7064 6174 6528      def _update(
+00028760: 7365 6c66 293a 0a20 2020 2020 2020 2023  self):.        #
+00028770: 2041 6c77 6179 7320 646f 2074 6869 730a   Always do this.
+00028780: 0a20 2020 2020 2020 2073 7461 7465 2c20  .        state, 
+00028790: 6574 696d 6520 3d20 7365 6c66 2e5f 7374  etime = self._st
+000287a0: 6174 650a 2020 2020 2020 2020 6c65 6674  ate.        left
+000287b0: 203d 206d 6178 2830 2c20 6574 696d 6520   = max(0, etime 
+000287c0: 2d20 6474 2e6e 6f77 2829 290a 0a20 2020  - dt.now())..   
+000287d0: 2020 2020 2069 6620 7374 6174 6520 3d3d       if state ==
+000287e0: 2022 776f 726b 223a 0a20 2020 2020 2020   "work":.       
+000287f0: 2020 2020 2069 6620 6e6f 7420 6c65 6674       if not left
+00028800: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00028810: 2020 7365 6c66 2e5f 7365 745f 7374 6174    self._set_stat
+00028820: 6528 2270 7265 2d62 7265 616b 2229 0a20  e("pre-break"). 
+00028830: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00028840: 656c 662e 616c 6172 6d28 7374 6174 6529  elf.alarm(state)
+00028850: 0a20 2020 2020 2020 2065 6c69 6620 7374  .        elif st
+00028860: 6174 6520 3d3d 2022 6272 6561 6b22 3a0a  ate == "break":.
+00028870: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00028880: 6f74 206c 6566 743a 0a20 2020 2020 2020  ot left:.       
+00028890: 2020 2020 2020 2020 2073 656c 662e 5f73           self._s
+000288a0: 6574 5f73 7461 7465 2822 7072 652d 776f  et_state("pre-wo
+000288b0: 726b 2229 0a20 2020 2020 2020 2020 2020  rk").           
+000288c0: 2020 2020 2073 656c 662e 616c 6172 6d28       self.alarm(
+000288d0: 7374 6174 6529 0a0a 2020 2020 2020 2020  state)..        
+000288e0: 2320 4578 6974 2065 6172 6c79 2069 6620  # Exit early if 
+000288f0: 7765 2772 6520 6e6f 7420 7368 6f77 6e0a  we're not shown.
+00028900: 2020 2020 2020 2020 6966 2077 696e 646f          if windo
+00028910: 772e 646f 6375 6d65 6e74 2e68 6964 6465  w.document.hidde
+00028920: 6e20 6f72 206e 6f74 2073 656c 662e 6973  n or not self.is
+00028930: 5f73 686f 776e 2829 3a0a 2020 2020 2020  _shown():.      
+00028940: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
+00028950: 2020 2020 2020 2320 5570 6461 7465 2047        # Update G
+00028960: 5549 0a20 2020 2020 2020 2069 6620 7374  UI.        if st
+00028970: 6174 6520 3d3d 2022 7072 652d 776f 726b  ate == "pre-work
+00028980: 223a 0a20 2020 2020 2020 2020 2020 2073  ":.            s
+00028990: 656c 662e 5f6c 6162 656c 2e69 6e6e 6572  elf._label.inner
+000289a0: 4854 4d4c 203d 2022 576f 726b 2028 3235  HTML = "Work (25
+000289b0: 3a30 3029 220a 2020 2020 2020 2020 656c  :00)".        el
+000289c0: 6966 2073 7461 7465 203d 3d20 2277 6f72  if state == "wor
+000289d0: 6b22 3a0a 2020 2020 2020 2020 2020 2020  k":.            
+000289e0: 7365 6c66 2e5f 6c61 6265 6c2e 696e 6e65  self._label.inne
+000289f0: 7248 544d 4c20 3d20 2257 6f72 6b69 6e67  rHTML = "Working
+00028a00: 3a20 2220 2b20 6474 2e64 7572 6174 696f  : " + dt.duratio
+00028a10: 6e5f 7374 7269 6e67 286c 6566 742c 2054  n_string(left, T
+00028a20: 7275 6529 0a20 2020 2020 2020 2065 6c69  rue).        eli
+00028a30: 6620 7374 6174 6520 3d3d 2022 7072 652d  f state == "pre-
+00028a40: 6272 6561 6b22 3a0a 2020 2020 2020 2020  break":.        
+00028a50: 2020 2020 7365 6c66 2e5f 6c61 6265 6c2e      self._label.
+00028a60: 696e 6e65 7248 544d 4c20 3d20 2242 7265  innerHTML = "Bre
+00028a70: 616b 2028 353a 3030 2922 0a20 2020 2020  ak (5:00)".     
+00028a80: 2020 2065 6c69 6620 7374 6174 6520 3d3d     elif state ==
+00028a90: 2022 6272 6561 6b22 3a0a 2020 2020 2020   "break":.      
+00028aa0: 2020 2020 2020 7365 6c66 2e5f 6c61 6265        self._labe
+00028ab0: 6c2e 696e 6e65 7248 544d 4c20 3d20 2242  l.innerHTML = "B
+00028ac0: 7265 616b 3a20 2220 2b20 6474 2e64 7572  reak: " + dt.dur
+00028ad0: 6174 696f 6e5f 7374 7269 6e67 286c 6566  ation_string(lef
+00028ae0: 742c 2054 7275 6529 0a20 2020 2020 2020  t, True).       
+00028af0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00028b00: 2020 2073 656c 662e 5f73 6574 5f73 7461     self._set_sta
+00028b10: 7465 2822 7072 652d 776f 726b 2229 0a0a  te("pre-work")..
+00028b20: 2020 2020 6465 6620 616c 6172 6d28 7365      def alarm(se
+00028b30: 6c66 2c20 6f6c 645f 7374 6174 6529 3a0a  lf, old_state):.
+00028b40: 2020 2020 2020 2020 2320 4f70 656e 2074          # Open t
+00028b50: 6869 7320 6469 616c 6f67 0a20 2020 2020  his dialog.     
+00028b60: 2020 2073 656c 662e 6f70 656e 2829 0a0a     self.open()..
+00028b70: 2020 2020 2020 2020 2320 4d61 6b65 2061          # Make a
+00028b80: 2073 6f75 6e64 0a20 2020 2020 2020 2069   sound.        i
+00028b90: 6620 6f6c 645f 7374 6174 6520 3d3d 2022  f old_state == "
+00028ba0: 776f 726b 223a 0a20 2020 2020 2020 2020  work":.         
+00028bb0: 2020 2073 656c 662e 5f70 6c61 795f 736f     self._play_so
+00028bc0: 756e 6428 2277 6f72 6b5f 656e 6422 290a  und("work_end").
+00028bd0: 2020 2020 2020 2020 656c 6966 206f 6c64          elif old
+00028be0: 5f73 7461 7465 203d 3d20 2262 7265 616b  _state == "break
+00028bf0: 223a 0a20 2020 2020 2020 2020 2020 2073  ":.            s
+00028c00: 656c 662e 5f70 6c61 795f 736f 756e 6428  elf._play_sound(
+00028c10: 2262 7265 616b 5f65 6e64 2229 0a0a 2020  "break_end")..  
+00028c20: 2020 2020 2020 2320 5468 6520 7769 6e64        # The wind
+00028c30: 6f77 2074 6974 6c65 2069 7320 6368 616e  ow title is chan
+00028c40: 6765 6420 6f6e 205f 7365 745f 7374 6174  ged on _set_stat
+00028c50: 652c 2063 6175 7369 6e67 2061 2062 6c75  e, causing a blu
+00028c60: 6520 646f 740a 2020 2020 2020 2020 2320  e dot.        # 
+00028c70: 746f 2061 7070 6561 7220 7768 656e 2070  to appear when p
+00028c80: 696e 6e65 642e 2054 6869 7320 6973 2061  inned. This is a
+00028c90: 6c73 6f20 7061 7274 206f 6620 7468 6520  lso part of the 
+00028ca0: 2261 6c61 726d 222e 0a0a 2020 2020 2020  "alarm"...      
+00028cb0: 2020 2320 5368 6f77 2061 2073 7973 7465    # Show a syste
+00028cc0: 6d20 6e6f 7469 6669 6361 7469 6f6e 0a20  m notification. 
+00028cd0: 2020 2020 2020 2069 6620 7769 6e64 6f77         if window
+00028ce0: 2e4e 6f74 6966 6963 6174 696f 6e20 616e  .Notification an
+00028cf0: 6420 4e6f 7469 6669 6361 7469 6f6e 2e70  d Notification.p
+00028d00: 6572 6d69 7373 696f 6e20 3d3d 2022 6772  ermission == "gr
+00028d10: 616e 7465 6422 3a0a 2020 2020 2020 2020  anted":.        
+00028d20: 2020 2020 6966 206f 6c64 5f73 7461 7465      if old_state
+00028d30: 203d 3d20 2262 7265 616b 223a 0a20 2020   == "break":.   
+00028d40: 2020 2020 2020 2020 2020 2020 2074 6974               tit
+00028d50: 6c65 203d 2022 4272 6561 6b20 6973 206f  le = "Break is o
+00028d60: 7665 722c 2062 6163 6b20 746f 2077 6f72  ver, back to wor
+00028d70: 6b21 220a 2020 2020 2020 2020 2020 2020  k!".            
+00028d80: 2020 2020 6163 7469 6f6e 7320 3d20 5b0a      actions = [.
+00028d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028da0: 2020 2020 7b22 6163 7469 6f6e 223a 2022      {"action": "
+00028db0: 776f 726b 222c 2022 7469 746c 6522 3a20  work", "title": 
+00028dc0: 2253 7461 7274 2032 356d 2077 6f72 6b22  "Start 25m work"
+00028dd0: 7d2c 0a20 2020 2020 2020 2020 2020 2020  },.             
+00028de0: 2020 2020 2020 207b 2261 6374 696f 6e22         {"action"
+00028df0: 3a20 2263 6c6f 7365 222c 2022 7469 746c  : "close", "titl
+00028e00: 6522 3a20 2243 6c6f 7365 227d 2c0a 2020  e": "Close"},.  
+00028e10: 2020 2020 2020 2020 2020 2020 2020 5d0a                ].
+00028e20: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00028e30: 206f 6c64 5f73 7461 7465 203d 3d20 2277   old_state == "w
+00028e40: 6f72 6b22 3a0a 2020 2020 2020 2020 2020  ork":.          
+00028e50: 2020 2020 2020 7469 746c 6520 3d20 2254        title = "T
+00028e60: 696d 6520 666f 7220 6120 6272 6561 6b21  ime for a break!
+00028e70: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00028e80: 2020 6163 7469 6f6e 7320 3d20 5b0a 2020    actions = [.  
+00028e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028ea0: 2020 7b22 6163 7469 6f6e 223a 2022 6272    {"action": "br
+00028eb0: 6561 6b22 2c20 2274 6974 6c65 223a 2022  eak", "title": "
+00028ec0: 5374 6172 7420 356d 2062 7265 616b 227d  Start 5m break"}
+00028ed0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00028ee0: 2020 2020 2020 7b22 6163 7469 6f6e 223a        {"action":
+00028ef0: 2022 636c 6f73 6522 2c20 2274 6974 6c65   "close", "title
+00028f00: 223a 2022 436c 6f73 6522 7d2c 0a20 2020  ": "Close"},.   
+00028f10: 2020 2020 2020 2020 2020 2020 205d 0a20               ]. 
+00028f20: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00028f30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00028f40: 2074 6974 6c65 203d 2022 506f 6d6f 646f   title = "Pomodo
+00028f50: 726f 220a 2020 2020 2020 2020 2020 2020  ro".            
+00028f60: 2020 2020 6163 7469 6f6e 7320 3d20 5b5d      actions = []
+00028f70: 0a0a 2020 2020 2020 2020 2020 2020 6f70  ..            op
+00028f80: 7469 6f6e 7320 3d20 7b0a 2020 2020 2020  tions = {.      
+00028f90: 2020 2020 2020 2020 2020 2269 636f 6e22            "icon"
+00028fa0: 3a20 2274 696d 6574 6167 6765 7231 3932  : "timetagger192
+00028fb0: 5f73 662e 706e 6722 2c0a 2020 2020 2020  _sf.png",.      
+00028fc0: 2020 2020 2020 2020 2020 2262 6f64 7922            "body"
+00028fd0: 3a20 2243 6c69 636b 2074 6f20 6f70 656e  : "Click to open
+00028fe0: 2054 696d 6554 6167 6765 7222 2c0a 2020   TimeTagger",.  
+00028ff0: 2020 2020 2020 2020 2020 2020 2020 2272                "r
+00029000: 6571 7569 7265 496e 7465 7261 6374 696f  equireInteractio
+00029010: 6e22 3a20 5472 7565 2c0a 2020 2020 2020  n": True,.      
+00029020: 2020 2020 2020 2020 2020 2274 6167 223a            "tag":
+00029030: 2022 7469 6d65 7461 6767 6572 2d70 6f6d   "timetagger-pom
+00029040: 6f64 6f72 6f22 2c20 2023 2072 6570 6c61  odoro",  # repla
+00029050: 6365 2070 7265 7669 6f75 7320 6e6f 7469  ce previous noti
+00029060: 6669 6361 7469 6f6e 730a 2020 2020 2020  fications.      
+00029070: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+00029080: 2020 2020 2320 4966 2077 6520 7368 6f77      # If we show
+00029090: 2074 6865 206e 6f74 6966 6963 6174 696f   the notificatio
+000290a0: 6e20 7669 6120 7468 6520 7365 7276 6963  n via the servic
+000290b0: 6520 776f 726b 6572 2c20 7765 0a20 2020  e worker, we.   
+000290c0: 2020 2020 2020 2020 2023 2063 616e 2073           # can s
+000290d0: 686f 7720 6163 7469 6f6e 732c 206d 616b  how actions, mak
+000290e0: 696e 6720 7468 6520 666c 6f77 2065 6173  ing the flow eas
+000290f0: 6965 7220 666f 7220 7573 6572 732e 0a20  ier for users.. 
+00029100: 2020 2020 2020 2020 2020 2069 6620 7769             if wi
+00029110: 6e64 6f77 2e70 7761 2061 6e64 2077 696e  ndow.pwa and win
+00029120: 646f 772e 7077 612e 7377 5f72 6567 3a0a  dow.pwa.sw_reg:.
+00029130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029140: 6f70 7469 6f6e 732e 6163 7469 6f6e 7320  options.actions 
+00029150: 3d20 6163 7469 6f6e 730a 2020 2020 2020  = actions.      
+00029160: 2020 2020 2020 2020 2020 7769 6e64 6f77            window
+00029170: 2e70 7761 2e73 775f 7265 672e 7368 6f77  .pwa.sw_reg.show
+00029180: 4e6f 7469 6669 6361 7469 6f6e 2874 6974  Notification(tit
+00029190: 6c65 2c20 6f70 7469 6f6e 7329 0a20 2020  le, options).   
+000291a0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+000291b0: 2020 2020 2020 2020 2020 2020 2020 204e                 N
+000291c0: 6f74 6966 6963 6174 696f 6e28 7469 746c  otification(titl
+000291d0: 652c 206f 7074 696f 6e73 290a 0a20 2020  e, options)..   
+000291e0: 2064 6566 206f 6e5f 6e6f 7469 6669 6361   def on_notifica
+000291f0: 7469 6f6e 636c 6963 6b28 7365 6c66 2c20  tionclick(self, 
+00029200: 6d65 7373 6167 655f 6576 656e 7429 3a0a  message_event):.
+00029210: 2020 2020 2020 2020 2222 2254 6869 7320          """This 
+00029220: 6973 2061 2063 616c 6c62 6163 6b20 666f  is a callback fo
+00029230: 7220 7365 7276 6963 6520 776f 726b 6572  r service worker
+00029240: 2065 7665 6e74 732e 0a20 2020 2020 2020   events..       
+00029250: 2057 6520 6669 6c74 6572 206f 6e20 276e   We filter on 'n
+00029260: 6f74 6966 6963 6174 696f 6e63 6c69 636b  otificationclick
+00029270: 2720 7479 7065 7320 2864 6566 696e 6564  ' types (defined
+00029280: 2062 7920 7573 292e 0a20 2020 2020 2020   by us)..       
+00029290: 2022 2222 0a20 2020 2020 2020 2065 7665   """.        eve
+000292a0: 6e74 203d 206d 6573 7361 6765 5f65 7665  nt = message_eve
+000292b0: 6e74 2e64 6174 610a 2020 2020 2020 2020  nt.data.        
+000292c0: 6966 2065 7665 6e74 2e74 7970 6520 213d  if event.type !=
+000292d0: 2022 6e6f 7469 6669 6361 7469 6f6e 636c   "notificationcl
+000292e0: 6963 6b22 3a0a 2020 2020 2020 2020 2020  ick":.          
+000292f0: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
+00029300: 2069 6620 6e6f 7420 7769 6e64 6f77 2e73   if not window.s
+00029310: 696d 706c 6573 6574 7469 6e67 732e 6765  implesettings.ge
+00029320: 7428 2270 6f6d 6f64 6f72 6f5f 656e 6162  t("pomodoro_enab
+00029330: 6c65 6422 293a 0a20 2020 2020 2020 2020  led"):.         
+00029340: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
+00029350: 2020 6966 2065 7665 6e74 2e61 6374 696f    if event.actio
+00029360: 6e20 3d3d 2022 776f 726b 223a 0a20 2020  n == "work":.   
+00029370: 2020 2020 2020 2020 2073 656c 662e 5f73           self._s
+00029380: 6574 5f73 7461 7465 2822 776f 726b 2229  et_state("work")
+00029390: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000293a0: 662e 5f70 6c61 795f 736f 756e 6428 2277  f._play_sound("w
+000293b0: 696e 6422 290a 2020 2020 2020 2020 656c  ind").        el
+000293c0: 6966 2065 7665 6e74 2e61 6374 696f 6e20  if event.action 
+000293d0: 3d3d 2022 6272 6561 6b22 3a0a 2020 2020  == "break":.    
+000293e0: 2020 2020 2020 2020 7365 6c66 2e5f 7365          self._se
+000293f0: 745f 7374 6174 6528 2262 7265 616b 2229  t_state("break")
+00029400: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00029410: 662e 5f70 6c61 795f 736f 756e 6428 2277  f._play_sound("w
+00029420: 696e 6422 290a                           ind").
```

### Comparing `timetagger-23.9.2/timetagger/app/dt.py` & `timetagger-24.4.1/timetagger/app/dt.py`

 * *Files 16% similar despite different names*

```diff
@@ -396,14 +396,58 @@
     var res = 1 + Math.round(((date.getTime() - week1.getTime()) / 86400000
                                - 3 + (week1.getDay() + 6) % 7) / 7);
     """
     )
     return res  # noqa
 
 
+def get_remaining_hours_of_day(t):
+    d = Date(t * 1000)
+    return 24 - d.getHours() - d.getMinutes() / 60 - d.getSeconds() / 3600
+
+
+def get_elapsed_hours_of_day(t):
+    d = Date(t * 1000)
+    return d.getHours() + d.getMinutes() / 60 + d.getSeconds() / 3600
+
+
+def get_free_hours_in_range(t1, t2, free_days):
+    free_hours = 0
+    if free_days >= 1:
+        d1 = Date(t1 * 1000)
+        d2 = Date(t2 * 1000)
+        hours_in_range = (t2 - t1) / 3600
+
+        if hours_in_range > 24:  # scale > "1D"
+            while d1 < d2:
+                if d1.getDay() == 0:  # sunday
+                    free_hours += 24
+                elif d1.getDay() == 6 and free_days == 2:  # saturday
+                    free_hours += 24
+                d1.setDate(d1.getDate() + 1)  # next day
+        else:  # scale <= "1D"
+            # starts on sunday
+            if d1.getDay() == 0 and d2.getDay() != 0:
+                free_hours = get_remaining_hours_of_day(t1)
+            # only sunday
+            elif d1.getDay() == 0 and d2.getDay() == 0:
+                free_hours = hours_in_range
+            # ends on sunday
+            elif d1.getDay() != 0 and d2.getDay() == 0 and free_days != 2:
+                free_hours = get_elapsed_hours_of_day(t2)
+            # starts on saturday
+            elif d1.getDay() == 6 and free_days == 2:
+                free_hours = hours_in_range
+            # ends on saturday
+            elif d1.getDay() != 6 and d2.getDay() == 6 and free_days == 2:
+                free_hours = get_elapsed_hours_of_day(t2)
+
+    return free_hours
+
+
 if __name__ == "__main__":
     import pscript
 
     pscript.script2js(
         __file__,
         target=__file__[:-3] + ".js",
         namespace="datetime",
```

### Comparing `timetagger-23.9.2/timetagger/app/front.py` & `timetagger-24.4.1/timetagger/app/front.py`

 * *Files 2% similar despite different names*

```diff
@@ -54,15 +54,14 @@
 def set_width_mode():
     # Note that the width modes must match the css classes in _style_embed.scss
     content_div = window.document.getElementById("main-content")
     # Clear
     entries = []
     add = lambda x: entries.push(x)
     content_div.classList.forEach(add)
-    print(entries)
     for entry in entries:
         if "width-" in entry:
             content_div.classList.remove(entry)
     # Apply
     width_mode = window.simplesettings.get("width_mode")
     content_div.classList.add("width-" + width_mode)
 
@@ -236,27 +235,27 @@
         # Determine splitter positions
         #
         #   | records | | analytics |
         # 0 1         2 3           4 5
 
         x0 = 0
         x1 = margin
-        x2 = x1 + records_width
+        x2 = x1 + max(0, records_width)
         x3 = x2 + margin2
         x4 = self.w - margin
         x5 = self.w  # noqa
 
         x1 = self.grid_round(x1)
         x2 = self.grid_round(x2)
         x3 = self.grid_round(x3)
         x4 = self.grid_round(x4)
 
         y0 = 0
         y1 = self.grid_round(140)
-        y3 = self.grid_round(self.h - 15)
+        y3 = self.grid_round(max(y1 + 40, self.h - 15))
 
         self.widgets["TopWidget"].rect = x0, y0, x5, y1
         self.widgets["RecordsWidget"].rect = x1, y1, x2, y3
         self.widgets["AnalyticsWidget"].rect = x3, y1, x4, y3
 
         # Determine reference font
         FONT.default = FONT.condensed if self.w < 450 else FONT.wide
@@ -595,30 +594,32 @@
         if ran.indexOf("W") >= 0 and res.indexOf("W") >= 0:
             delta = "1W"
             minor_delta = "1W"
 
         # Define ticks
         ticks = []
         minor_ticks = []
-        maxi = 2 * npixels / min_distance
+        maxi = min(2 * npixels / min_distance, 99)
         t = dt.floor(t1 - 0.1 * nsecs, delta)
         iter = -1
         while iter < maxi:  # just to be safe
             iter += 1
             pix_pos = (t - t1) * npixels / nsecs
             ticks.push((pix_pos, t))
             # Determine delta. The +1s and then floor is to take care
             # of the transition from wintertime to summertime.
             # Even then, t_new may still not advance for ios somehow (see #73).
             t_new = dt.floor(dt.add(t + 1, delta), delta)
             if t_new <= t:
                 t_new = dt.add(t, delta)
             # Minor ticks
             t_minor = dt.add(t, minor_delta)
-            while (t_new - t_minor) > 0:
+            iter_minor = -1
+            while iter_minor < 20 and (t_new - t_minor) > 0:
+                iter_minor += 1
                 pix_pos = (t_minor - t1) * npixels / nsecs
                 minor_ticks.push((pix_pos, t_minor))
                 t_minor_new = dt.add(t_minor, minor_delta)
                 if t_minor_new <= t_minor:
                     break  # failsafe
                 t_minor = t_minor_new
             # Summertime transition?
@@ -632,15 +633,17 @@
                         tick_times = [tb] if t_new == tc else [tb, tc]
                         for tick_time in tick_times:
                             pix_pos = (tick_time - t1) * npixels / nsecs
                             ticks.push((pix_pos, tc))
                         # Add minor ticks at duplicate hour
                         d_minor = dt.add(t_new, minor_delta) - t_new
                         t_minor = tb + d_minor
-                        while t_minor < tc:
+                        iter_minor = -1
+                        while iter_minor < 20 and t_minor < tc:
+                            iter_minor += 1
                             pix_pos = (t_minor - t1) * npixels / nsecs + 3
                             minor_ticks.push((pix_pos, t_minor))
                             t_minor += d_minor
                         break
             # prepare for next
             if (t - t2) > 0:
                 break
@@ -792,29 +795,32 @@
 
         if text.toUpperCase:  # is string
             texts = [text]
         else:
             texts = list(text)
 
         # Measure texts
+        texts2 = []
         widths = []
         fonts = []
         fontsize = int(0.5 * h)
         if given_w:
             fontsize = min(fontsize, int(0.6 * given_w))
         for i in range(len(texts)):
             text = texts[i]
-            if text.startswith("fas-"):
+            if len(text) == 0:
+                continue
+            elif text.startswith("fas-"):
                 text = text[4:]
                 font = fontsize + "px FontAwesome"
             else:
                 font = fontsize + "px " + opt.font
             ctx.font = font
             width = ctx.measureText(text).width
-            texts[i] = text
+            texts2.push(text)
             fonts.push(font)
             widths.push(width)
 
         # Determine width
         needed_w = sum(widths) + 2 * opt.padding + opt.space * (len(widths) - 1)
         if given_w:
             w = given_w
@@ -881,16 +887,16 @@
         # Get starting x
         x = x1 + opt.padding + 0.5 * (w - needed_w)
 
         # Draw the text on top
         ctx.textBaseline = "middle"
         ctx.textAlign = "left"
         ctx.fillStyle = opt.color
-        for i in range(len(texts)):
-            text, width, font = texts[i], widths[i], fonts[i]
+        for i in range(len(texts2)):
+            text, width, font = texts2[i], widths[i], fonts[i]
             ctx.font = font
             if text.startsWith("#"):
                 draw_tag(ctx, text, x, 0.5 * (y1 + y2))
             else:
                 ctx.fillText(text, x, 0.5 * (y1 + y2))
             x += width + opt.space
 
@@ -901,46 +907,57 @@
     """Widget with menu, buttons, and time header."""
 
     def on_init(self):
         self._picker = utils.Picker()
         self._button_pressed = None
         self._current_scale = {}
         self._sync_feedback_xy = 0, 0, 0
-        window.setInterval(self._draw_sync_feedback_callback, 100)
+
+        # Periodically draw the sync feedback icon. Make sure to do it via requestAnimationFrame
+        window.setInterval(
+            window.requestAnimationFrame, 100, self._draw_sync_feedback_callback
+        )
 
         # For navigation with keys. Listen to canvas events, and window events (in
         # case canvas does not have focus), but don't listen for events from dialogs.
         window.addEventListener("keydown", self._on_key, 0)
         self._canvas.node.addEventListener("keydown", self._on_key, 0)
 
     def on_draw(self, ctx, menu_only=False):
         self._picker.clear()
         x1, y1, x2, y2 = self.rect
+        avail_width = x2 - x1
+        avail_height = y2 - y1
+
+        # Guard for small screen space during resize
+        if avail_width < 50 or avail_height < 20:
+            return
 
         y4 = y2  # noqa - bottom
         y2 = y1 + 60
-        y3 = y2 + 20
+        y3 = y2 + 16
 
-        margin = 8
-        h = 36
+        h = 40
+        margin = 8 if avail_width < 900 else 20
 
         # Top band background
         ctx.fillStyle = COLORS.top_bg
         ctx.fillRect(0, 0, x2, 60)
 
         # Draw icon in top-right
-        iconsize = (y2 - y1) - 2 * margin
+        icon_margin = 8
+        icon_size = (y2 - y1) - 2 * icon_margin
 
-        if iconsize:
+        if icon_size:
             ctx.drawImage(
                 window.document.getElementById("ttlogo_sl"),
-                x2 - iconsize - margin,
-                y1 + margin,
-                iconsize,
-                iconsize,
+                x2 - icon_size - icon_margin,
+                y1 + icon_margin,
+                icon_size,
+                icon_size,
             )
 
         # Always draw the menu button
         self._draw_menu_button(ctx, x1, y1, x2, y2)
 
         # If menu-only, also draw login, then exit
         if menu_only:
@@ -965,22 +982,21 @@
             now_clr = COLORS.button_text
 
         # Draw buttons below the dark banner
         # We go from the center to the sides
         xc = (x1 + x2) / 2
 
         # Move a bit to the right on smaller screens
-        avail_width = x2 - x1
-        xc += max(0, 600 - avail_width) * 0.18
+        xc += min(h, max(0, 800 - avail_width) * 0.18)
 
-        # Draw arrows
-        ha = 0.7 * h
+        # Draw up-down arrows
+        ha = 0.75 * h
         yc = y3 + h / 2
-        updown_w = 0
-        if avail_width > 310:
+        center_margin = -margin / 2
+        if avail_width > 315:
             updown_w = self._draw_button(
                 ctx,
                 xc,
                 yc - 2.5,
                 h,
                 ha,
                 "fas-\uf077",
@@ -995,91 +1011,90 @@
                 h,
                 ha,
                 "fas-\uf078",
                 "nav_forward",
                 "Step forward [/pageDown]",
                 {"ref": "topcenter"},
             )
+            center_margin = updown_w / 2 + 3
 
         # -- move to the left
 
-        x = xc - updown_w / 2 - 3
+        x = xc - center_margin
 
-        zoom_w = 0
-        if avail_width > 350:
-            zoom_w = self._draw_button(
+        if avail_width > 400:
+            x -= self._draw_button(
                 ctx,
                 x,
                 y3,
-                ha,
+                h,
                 h,
                 "fas-\uf010",
                 "nav_zoom_" + self._current_scale["out"],
                 "Zoom out []",
                 {"ref": "ropright"},
             )
-            x -= zoom_w + 5
+        x -= margin
 
         nav_width = ha
-        x -= nav_width + 3 + 5  # tiny extra margin between nav button groups
 
-        today_w = 0
-        today_w = self._draw_button(
+        x -= self._draw_button(
             ctx,
             x,
             y3,
-            None,
-            h,
-            "Today",
-            "nav_snap_today",  # "nav_snap_now" + now_scale,
-            "Snap to today [d]",  # "Snap to now [Home]",
-            {"ref": "topright", "color": now_clr, "font": FONT.condensed},
-        )
-
-        self._draw_button(
-            ctx,
-            x + nav_width + 3,
-            y3,
             nav_width,
             h,
-            "fas-\uf0d7",  # ["fas-\uf073", "fas-\uf0d7"],
+            "fas-\uf073",  # ["fas-\uf073", "fas-\uf0d7"],
             "nav_menu",
             "Select time range [t]",
             {"ref": "topright"},
         )
 
-        x -= today_w + margin
+        if avail_width > 510:
+            x -= 3
+            x -= self._draw_button(
+                ctx,
+                x,
+                y3,
+                None,
+                h,
+                "Today",
+                "nav_snap_today",  # "nav_snap_now" + now_scale,
+                "Snap to today [d]",  # "Snap to now [Home]",
+                {"ref": "topright", "color": now_clr, "font": FONT.condensed},
+            )
+        x -= margin
 
         self._draw_tracking_buttons(ctx, x, y3, h)
 
         # -- move to the right
 
-        x = xc + updown_w / 2 + 3
+        x = xc + center_margin
 
-        if avail_width > 350:
-            zoom_w = self._draw_button(
+        if avail_width > 400:
+            x += self._draw_button(
                 ctx,
                 x,
                 y3,
-                ha,
+                h,
                 h,
                 "fas-\uf00e",
                 "nav_zoom_" + self._current_scale["in"],
                 "Zoom in []",
                 {"ref": "ropleft"},
             )
-        x += zoom_w + margin
+        x += margin
 
         x += self._draw_button(
             ctx,
             x,
             y3,
             None,
             h,
-            ["fas-\uf15c"] + (["Report"] if avail_width > 420 else []),
+            ["fas-\uf15c", "Report" if avail_width > 490 else ""],
             "report",
             "Show report [r]",
             {"ref": "topleft", "font": FONT.condensed},
         )
         x += margin
 
         x += self._draw_button(
@@ -1145,26 +1160,26 @@
             ctx.fillText(text, x, y2 - 8)
 
         self._draw_sync_feedback(ctx, x + d + 4, y, sync_radius)
         return d + dx + 2 * sync_radius + 4
 
     def _draw_sync_feedback(self, ctx, x1, y1, radius):
         self._sync_feedback_xy = x1, y1, radius
-        return self._draw_sync_feedback_work()
+        return self._draw_sync_feedback_work(ctx)
 
     def _draw_sync_feedback_callback(self):
-        self._draw_sync_feedback_work(False)
+        ctx = self._canvas.node.getContext("2d")
+        self._draw_sync_feedback_work(ctx, False)
 
-    def _draw_sync_feedback_work(self, register=True):
+    def _draw_sync_feedback_work(self, ctx, register=True):
         PSCRIPT_OVERLOAD = False  # noqa
 
         if window.document.hidden:
             return
 
-        ctx = self._canvas.node.getContext("2d")
         x, y, radius = self._sync_feedback_xy
 
         state = window.store.state
 
         # Get factor 0..1
         factor = window.store.sync_time
         factor = max(0, (factor[1] - dt.now()) / (factor[1] - factor[0] + 0.0001))
@@ -1281,14 +1296,16 @@
                 "fas-\uf04b",
                 "record_start",
                 start_tt,
                 {"ref": "topright", "font": FONT.condensed},
             )
             x -= dx
         else:
+            # This but takes more space, but there it no stop but. So no reason
+            # to reduce size when avail_width is low.
             dx = self._draw_button(
                 ctx,
                 x,
                 y,
                 None,
                 h,
                 ["fas-\uf04b", "Record"],
@@ -1428,14 +1445,18 @@
             if pressed is not None and picked is not None:
                 if picked.action == pressed.action:
                     self._handle_button_press(picked.action)
 
     def _on_key(self, e):
         if e.ctrlKey or e.metaKey or e.altKey:
             return  # don't fight with the browser
+        #
+        elif e.key.lower() == "f":
+            self._handle_button_press("search")
+        #
         elif e.key.lower() == "arrowup" or e.key.lower() == "pageup":
             self._handle_button_press("nav_backward")
         elif e.key.lower() == "arrowdown" or e.key.lower() == "pagedown":
             self._handle_button_press("nav_forward")
         elif e.key.lower() == "arrowleft":
             self._handle_button_press("nav_zoom_" + self._current_scale["out"])
         elif e.key.lower() == "arrowright":
@@ -1445,14 +1466,18 @@
         #
         elif e.key.lower() == "d":
             self._handle_button_press("nav_snap_today")
         elif e.key.lower() == "w":
             self._handle_button_press("nav_snap_now1W")
         elif e.key.lower() == "m":
             self._handle_button_press("nav_snap_now1M")
+        elif e.key.lower() == "q":
+            self._handle_button_press("nav_snap_now3M")
+        elif e.key.lower() == "y":
+            self._handle_button_press("nav_snap_now1Y")
         elif e.key.lower() == "t":
             self._handle_button_press("nav_menu")
         #
         elif e.key.lower() == "s":
             if e.shiftKey:
                 self._handle_button_press("record_resume")
             else:
@@ -1469,14 +1494,17 @@
 
     def _handle_button_press(self, action):
         now = self._canvas.now()
 
         if action == "menu":
             self._canvas.menu_dialog.open()
 
+        elif action == "search":
+            self._canvas.search_dialog.open()
+
         elif action == "login":
             window.location.href = "../login"
 
         elif action == "dosync":
             if window.store.state in ("warning", "error"):
                 last_error = window.store.last_error or "Unknown sync error"
                 self._canvas.notification_dialog.open(last_error, "Sync error")
@@ -1614,14 +1642,18 @@
         self._pointer_startrange = 0, 0
         self._pointer_inertia = []  # track last n move events
 
     def on_draw(self, ctx):
         x1, y1, x2, y2 = self.rect
         self._picker.clear()
 
+        # Guard for small screen space during resize
+        if y2 - y1 < 20:
+            return
+
         # If too little space, only draw button to expand
         if x2 - x1 <= 50:
             width = 30
             x3, x4 = 0, width
             height = max(200, 0.33 * (y2 - y1))
             y3, y4 = (y1 + y2) / 2 - height / 2, (y1 + y2) / 2 + height / 2
             self._picker.register(
@@ -1671,15 +1703,15 @@
             ctx.textAlign = "left"
             ctx.textBaseline = "bottom"
             ctx.font = 1.2 * FONT.size + "px " + FONT.default
             ctx.fillStyle = COLORS.prim2_clr
             ctx.fillText(" drag to create new record", x4, y1 - 2)
 
         # Draw title text
-        if self._canvas.w > 700:
+        if self._canvas.w > 800:
             text1 = "Timeline"
             ctx.textAlign = "left"
             ctx.textBaseline = "top"
             ctx.font = "bold " + (FONT.size * 1.4) + "px " + FONT.mono
             ctx.fillStyle = COLORS.prim2_clr
             ctx.fillText(text1, x1 + 10, 75)
             # ctx.font = (FONT.size * 0.9) + "px " + FONT.default
@@ -2512,14 +2544,24 @@
         stats_list = [(tag, count) for tag, count in tag_stats.items()]
         stats_list.sort(key=lambda x: -x[1])
 
         # Calculate dimensions
         fullwidth = x2 - x1  # * (sumcount_full / (t2 - t1)) # ** 0.5
         fullheight = (y2 - y1) * (sumcount_full / (t2 - t1))  # ** 0.5
 
+        # Darken the colors for free days.
+        if stat_period == "1D":
+            workdays_setting = window.simplesettings.get("workdays")
+            is_free_day = (text == "Sat" and workdays_setting == 2) or (
+                text == "Sun" and workdays_setting >= 1
+            )
+            if is_free_day:
+                ctx.fillStyle = COLORS.button_text_disabled
+                ctx.fillRect(x1, y1, fullwidth, y2 - y1)
+
         # Show amount of time spend on each tag
         x = x1
         for i in range(len(stats_list)):
             tag, count = stats_list[i]
             width = fullwidth * count / sumcount_full
             ctx.fillStyle = window.store.settings.get_color_for_tag(tag)
             ctx.fillRect(x, y1, width, (y2 - y1))
@@ -2535,23 +2577,24 @@
         bigfontsize = min(FONT.size * 2, (y2 - y1) / 3)
         bigfontsize = max(FONT.size, bigfontsize)
         ymargin = (y2 - y1) / 20
 
         # Draw big text in stronger color if it is the timerange containing today
 
         # Draw duration at the left
-        ctx.fillStyle = COLORS.prim1_clr if hover else COLORS.prim2_clr
-        fontsizeleft = bigfontsize * (0.7 if selected_tags else 0.9)
-        ctx.font = f"{fontsizeleft}px {FONT.default}"
-        ctx.textBaseline = "bottom"
-        ctx.textAlign = "left"
-        duration_text = dt.duration_string(sumcount_selected, False)
-        if selected_tags:
-            duration_text += " / " + dt.duration_string(sumcount_nominal, False)
-        ctx.fillText(duration_text, x1 + 10, y2 - ymargin)
+        if not stat_period == "1D" or sumcount_nominal > 0 or not is_free_day:
+            ctx.fillStyle = COLORS.prim1_clr if hover else COLORS.prim2_clr
+            fontsizeleft = bigfontsize * (0.7 if selected_tags else 0.9)
+            ctx.font = f"{fontsizeleft}px {FONT.default}"
+            ctx.textBaseline = "bottom"
+            ctx.textAlign = "left"
+            duration_text = dt.duration_string(sumcount_selected, False)
+            if selected_tags:
+                duration_text += " / " + dt.duration_string(sumcount_nominal, False)
+            ctx.fillText(duration_text, x1 + 10, y2 - ymargin)
 
         # Draw time-range indication at the right
         isnow = t1 < self._canvas.now() < t2
         ctx.fillStyle = COLORS.prim1_clr if isnow else COLORS.prim2_clr
         ctx.font = f"bold {bigfontsize}px {FONT.default}"
         ctx.textBaseline = "bottom"
         ctx.textAlign = "right"
@@ -2984,25 +3027,35 @@
                 )
 
 
 class AnalyticsWidget(Widget):
     """Widget that draws the analytics, and handles corresponding interaction."""
 
     def on_init(self):
+        self._interaction_mode = 0
         self._picker = utils.Picker()
         self.selected_tags = []
         self._need_more_drawing_flag = False
         self._time_at_last_draw = 0
         self._time_since_last_draw = 0
         self._npixels_each = 0
+        self._target_scroll_offset = 0
+        self._scroll_offset = 0
         self.tagzmap = {}  # public map of tagz -> tagz
         self._tag_bars_dict = {}  # tagz -> bar-info
 
     def on_draw(self, ctx):
         x1, y1, x2, y2 = self.rect
+
+        # Guard for small screen space during resize
+        if y2 - y1 < 20:
+            return
+
+        # return self._draw_test_grid(ctx)
+
         self._picker.clear()
 
         # If too little space, only draw button to expand
         if x2 - x1 <= 50:
             width = 30
             x3, x4 = self._canvas.w - width, self._canvas.w
             height = max(220, 0.33 * (y2 - y1))
@@ -3043,25 +3096,43 @@
         if self._need_more_drawing_flag:
             self._time_since_last_draw = 1
             self.update()
         else:
             self._time_since_last_draw = 0
 
         # Draw title text
-        if self._canvas.w > 700:
+        if self._canvas.w > 800:
             text1 = "Overview"
             ctx.textAlign = "right"
             ctx.textBaseline = "top"
             ctx.font = "bold " + (FONT.size * 1.4) + "px " + FONT.mono
             ctx.fillStyle = COLORS.prim2_clr
             ctx.fillText(text1, x2 - 10, 75)
             # ctx.font = (FONT.size * 0.9) + "px " + FONT.default
             # ctx.fillStyle = COLORS.prim2_clr
             # ctx.fillText(self._help_text, x2 - 10, 90)
 
+    def _draw_test_grid(self, ctx):
+        x1, y1, x2, y2 = self.rect
+
+        grid_round = self._canvas.grid_round
+        x1, x2, x3 = grid_round(x1), grid_round((x1 + x2) / 2), grid_round(x2)
+        y1, y2, y3 = grid_round(y1), grid_round((y1 + y2) / 2), grid_round(y2)
+
+        ctx.strokeStyle = "#000"
+        ctx.lineWidth = 1
+        for i in range((x2 - x1) / 2):
+            ctx.moveTo(x1 + i * 2, y1)
+            ctx.lineTo(x1 + i * 2, y3)
+        ctx.stroke()
+        for i in range((y2 - y1) / 2):
+            ctx.moveTo(x1, y2 + i * 2)
+            ctx.lineTo(x3, y2 + i * 2)
+        ctx.stroke()
+
     def _draw_stats(self, ctx, x1, y1, x2, y2):
         PSCRIPT_OVERLOAD = False  # noqa
 
         # Reset times for all elements. The one that are still valid
         # will get their time set.
         for bar in self._tag_bars_dict.values():
             bar.t = 0
@@ -3131,61 +3202,93 @@
 
         # Get list of bars, and sort
         bars = self._tag_bars_dict.values()
         utils.order_stats_by_duration_and_name(bars)
 
         # Calculate available height for all the bars, plus space to show the total
         if len(self.selected_tags) > 0:
-            header_bar_space = 2
+            header_bar_slots = 2
         else:
-            header_bar_space = 1
-        avail_height = (y2 - y1) - 4
+            header_bar_slots = 1
+        avail_height1 = (y2 - y1) - 8 - 4  # bit extra to prevent FP hiding
 
         # Set _npixels_each (number of pixels per bar)
-        npixels_each_min_max = 25, 60
-        npixels_each = avail_height / (len(bars) + header_bar_space)
+        npixels_each_min_max = 30, 60
+        npixels_each = avail_height1 / (len(bars) + header_bar_slots)
         npixels_each = max(npixels_each, npixels_each_min_max[0])
         npixels_each = min(npixels_each, npixels_each_min_max[1])
         self._npixels_each = self._slowly_update_value(self._npixels_each, npixels_each)
 
-        # Get overview height
-        overview_height = self._npixels_each * header_bar_space
+        # Get vertical bounds of the space for the bars
+        y_top = y1 + self._npixels_each * header_bar_slots
+        y_bottom = y2 - 8
+        avail_height2 = y_bottom - y_top
+
+        # From that we can derive how many bars we can show, and the max scroll offset.
+        n_bars = int(avail_height2 / self._npixels_each)
+        max_scroll_offset = max(0, (len(bars) - n_bars) * self._npixels_each)
+        self._target_scroll_offset = min(max_scroll_offset, self._target_scroll_offset)
+        self._scroll_offset = self._slowly_update_value(
+            self._scroll_offset, self._target_scroll_offset
+        )
 
         # Calculate right base edge. Note that the bars will go beyond it
         x3 = x2 - 10 - 2
 
         # Three resolve passes: target size, real size, positioning
         for bar in bars:
             self._resolve_target_dimensions(bar, x3 - x1, self._npixels_each)
         for bar in bars:
             self._resolve_real_dimensions(bar)
-        y = y1 + overview_height
+        y = y_top - self._scroll_offset
         for bar in bars:
             self._resolve_positions(bar, x1, x3, y)
             y += bar.height
 
+        # Check what bars to not draw, i.e. how many we're missing in view.
+        n_hidden1 = n_hidden2 = 0
+        drawn_bars = bars.copy()
+        height_missing = 20
+        while len(drawn_bars) > 1 and drawn_bars[0].y1 < y_top:
+            drawn_bars.pop(0)
+            n_hidden1 += 1
+        while len(drawn_bars) > 1 and drawn_bars[-1].y2 > y_bottom:
+            drawn_bars.pop(-1)
+            n_hidden2 += 1
+
         # Get statistics
         total_time = 0
-        overview_y2 = y1 + overview_height
-        if len(bars):
-            overview_y2 = bars[-1].y2 + 8
+        overview_y2 = y_top
+        if len(drawn_bars):
+            overview_y2 = drawn_bars[-1].y2 + 8
+        if n_hidden1 > 0 or n_hidden2 > 0:
+            overview_y2 = max(overview_y2, y2)
         for bar in bars:
             total_time += bar.t
 
         # Prepare some more
         self._running_tagz = []
         for record in window.store.records.get_running_records():
             self._running_tagz.append(
                 window.store.records.tags_from_record(record).join(" ")
             )
 
-        # Draw all bars
+        # Draw all visible bars
         self._draw_container(ctx, total_time, x1, y1, x3, overview_y2)
-        for bar in bars:
+        for bar in drawn_bars:
             self._draw_one_bar(ctx, bar)
+        if n_hidden1 > 0:
+            self._draw_placeholder_for_hidden_bars(
+                ctx, x1 + 10, x1 + 50, y_top, y_top + height_missing, n_hidden1
+            )
+        if n_hidden2 > 0:
+            ymiss = overview_y2 - 8
+            self._draw_placeholder_for_hidden_bars(
+                ctx, x1 + 10, x1 + 50, ymiss - height_missing, ymiss, n_hidden2
+            )
 
         # # Determine help text
         # if self._maxlevel > 0:
         #     if len(self.selected_tags) == 0:
         #         self._help_text = "click a tag to filter"
         #     else:
         #         self._help_text = "click more tags to filter more"
@@ -3312,36 +3415,54 @@
                     None,
                     but_height,
                     "fas-\uf02c",
                     "configure_tags:" + self.selected_tags.join(" "),
                     "Configure tag combo",
                     opt,
                 )
-            # Snow total title
-            ctx.textAlign = "left"
-            ctx.font = FONT.size + "px " + FONT.default
-            ctx.fillStyle = COLORS.record_text
+            # Snow tags
+            opt = {
+                "ref": "leftmiddle",
+                "color": COLORS.button_tag_text,
+                "body": COLORS.button_tag_bg,
+                "padding": min(7, (x2 - x1) / 100),
+            }
             for tag in self.selected_tags:
-                text = tag
-                draw_tag(ctx, text, tx, ty)
-                tx += ctx.measureText(text).width + 12
+                tt = "Click to remove from filter"
+                tx += 12 + self._draw_button(
+                    ctx, tx, ty, None, but_height, tag, "unselect:" + tag, tt, opt
+                )
             # Show total duration
             ctx.textAlign = "right"
             ctx.fillStyle = COLORS.record_text
             ctx.fillText(duration, x_ref_duration, ty)
             # -- Row for target
             tx, ty = x_ref_labels, ymid - 2 + npixels * 0.85
+
             # Select the target that best matches the current time range
             best_target = None
-            m = {"day": 24, "week": 168, "month": 720, "year": 8760}
-            for period, divisor in m.items():
+            free_days_per_week = window.simplesettings.get("workdays")
+            free_hours_in_range = dt.get_free_hours_in_range(t1, t2, free_days_per_week)
+            work_hours_in_range = self._hours_in_range - free_hours_in_range
+            for period in ["day", "week", "month", "year"]:
                 target_hours = self._current_targets.get(period, 0)
                 if target_hours <= 0:
                     continue
-                factor = self._hours_in_range / divisor
+
+                # hours in period -> "day": 24, "week": 168, "month": 720, "year": 8760
+                if period == "day":
+                    work_hours_in_period = 24
+                elif period == "week":
+                    work_hours_in_period = 168 - free_days_per_week * 24
+                elif period == "month":  # ~4.33 weeks in a month
+                    work_hours_in_period = 720 - free_days_per_week * 24 * 4.33
+                elif period == "year":
+                    work_hours_in_period = 8760 - free_days_per_week * 24 * 52
+
+                factor = work_hours_in_range / work_hours_in_period
                 if factor > 0.93 or not best_target:
                     best_target = {
                         "period": period,
                         "factor": factor,
                         "hours": target_hours,
                     }
                 else:
@@ -3349,40 +3470,81 @@
             # Show target info
             ctx.font = FONT.size + "px " + FONT.default
             ctx.textAlign = "left"
             ctx.fillStyle = COLORS.prim2_clr
             if best_target:
                 done_this_period = total_time
                 target_this_period = 3600 * best_target.hours * best_target.factor
-                perc = 100 * done_this_period / target_this_period
                 prefix = "" if 0.93 < best_target.factor < 1.034 else "~ "
-                ctx.fillText(
-                    f"{best_target.period} target at {prefix}{perc:0.0f}%",
-                    tx,
-                    ty,
-                )
+                if target_this_period > 0:
+                    perc = 100 * done_this_period / target_this_period
+                    ctx.fillText(
+                        f"{best_target.period} target at {prefix}{perc:0.0f}%",
+                        tx,
+                        ty,
+                    )
+                else:
+                    ctx.fillText("No target", tx, ty)
                 left = target_this_period - done_this_period
                 left_s = dt.duration_string(abs(left), False)
                 left_prefix = "left" if left >= 0 else "over"
                 ctx.textAlign = "right"
                 ctx.fillText(
                     f"{left_prefix}: {prefix}{left_s}",
                     x_ref_duration,
                     ty,
                 )
             else:
                 ctx.fillText("No target", tx, ty)
 
+    def _draw_placeholder_for_hidden_bars(self, ctx, x1, x2, y1, y2, n_hidden):
+        PSCRIPT_OVERLOAD = False  # noqa
+
+        # Offset the bubble by a bit
+        x1 -= 2
+        x2 -= 2
+        y1 -= 2
+        y2 -= 2
+
+        npixels = self._npixels_each
+
+        # Roundness
+        rn = min(ANALYSIS_ROUNDNESS, npixels / 2)
+        rnb = min(COLORBAND_ROUNDNESS, npixels / 2)
+
+        # Draw front
+        ctx.lineWidth = 1.2
+        ctx.strokeStyle = COLORS.record_edge
+        ctx.fillStyle = COLORS.record_bg
+        path = window.Path2D()
+        path.arc(x2 - rn, y1 + rn, rn, 1.5 * PI, 2.0 * PI)
+        path.arc(x2 - rn, y2 - rn, rn, 0.0 * PI, 0.5 * PI)
+        path.arc(x1 + rnb, y2 - rnb, rnb, 0.5 * PI, 1.0 * PI)
+        path.arc(x1 + rnb, y1 + rnb, rnb, 1.0 * PI, 1.5 * PI)
+        path.closePath()
+        ctx.fill(path)
+
+        # Draw edge
+        ctx.stroke(path)
+
+        ymid = y1 + 0.5 * (y2 - y1)
+
+        # Draw number hidden
+        ctx.font = "14px " + FONT.default
+        ctx.textAlign = "left"
+        ctx.fillStyle = COLORS.prim1_clr
+        ctx.fillText(f"+ {n_hidden}", x1 + 11, ymid)
+
     def _draw_one_bar(self, ctx, bar):
         PSCRIPT_OVERLOAD = False  # noqa
 
         t1, t2 = self._canvas.range.get_range()
         x1, x2 = bar.x1, bar.x2
         y1, y2 = bar.y1, bar.y2
-        npixels = min(y2 - y1, self._npixels_each)
+        npixels = Math.round(min(y2 - y1, self._npixels_each))
 
         # Get whether the current tag combi corresponds to the currently running record.
         # The clock only ticks per second if now is within range, so we don't show seconds unless we can.
         is_running = bar.tagz in self._running_tagz
         show_secs = is_running and (t1 < self._canvas.now() < t2)
 
         # Roundness
@@ -3520,15 +3682,34 @@
                 tx += 12 + self._draw_button(
                     ctx, tx, ty, None, but_height, tag, "select:" + tag, tt, opt
                 )
 
     def on_pointer(self, ev):
         x, y = ev.pos[0], ev.pos[1]
 
+        last_interaction_mode = self._interaction_mode
         if "down" in ev.type:
+            if self._interaction_mode == 0 and ev.ntouches == 1:
+                self._interaction_mode = 1  # mode undecided
+                self._last_pointer_down_event = ev
+                self.update()
+            else:  # multi-touch -> tick-widget-behavior-mode
+                self._interaction_mode = 2
+        elif "move" in ev.type:
+            if self._interaction_mode == 1:
+                downx, downy = self._last_pointer_down_event.pos
+                if Math.sqrt((x - downx) ** 2 + (y - downy) ** 2) > 10:
+                    self._last_pointer_move_event = self._last_pointer_down_event
+                    self._interaction_mode = 2  # tick-widget-behavior-mode
+        elif "up" in ev.type:
+            if "mouse" in ev.type or ev.ntouches == 0:
+                self._interaction_mode = 0
+
+        if last_interaction_mode == 1 and "up" in ev.type:
+            # Clicks
             picked = self._picker.pick(x, y)
             if picked is None or picked == "":
                 pass
             elif picked.button:
                 if picked.action == "showanalytics":
                     self._canvas._prefer_show_analytics = True
                     self._canvas.on_resize()
@@ -3540,22 +3721,42 @@
                     if tagz:
                         for tag in tagz.split(" "):
                             if tag not in self.selected_tags:
                                 self.selected_tags.push(tag)
                     else:
                         self.selected_tags = []
                     self._tag_bars_dict = {}  # trigger animation
+                elif picked.action.startswith("unselect:"):
+                    _, _, tagz = picked.action.partition(":")
+                    if tagz:
+                        for tag in tagz.split(" "):
+                            if tag in self.selected_tags:
+                                self.selected_tags.remove(tag)
+                    self._tag_bars_dict = {}  # trigger animation
                 elif picked.action.startswith("configure_tag:"):
                     _, _, tagz = picked.action.partition(":")
                     self._canvas.tag_dialog.open(tagz, self.update)
                 elif picked.action.startswith("configure_tags:"):
                     _, _, tagz = picked.action.partition(":")
                     self._canvas.tag_combo_dialog.open(tagz, self.update)
                 self.update()
 
+        if self._interaction_mode == 2 and "move" in ev.type:
+            dy = self._last_pointer_move_event.pos[1] - y
+            self._last_pointer_move_event = ev
+            self._target_scroll_offset = max(0, self._target_scroll_offset + dy)
+            self.update()
+
+    def on_wheel(self, ev):
+        """Handle wheel event."""
+        if len(ev.modifiers) == 0 and ev.vscroll != 0:
+            self._target_scroll_offset = max(0, self._target_scroll_offset + ev.vscroll)
+            self.update()
+        return True
+
 
 if __name__ == "__main__":
     import pscript
 
     pscript.script2js(
         __file__, target=__file__[:-3] + ".js", namespace="front", module_type="simple"
     )
```

### Comparing `timetagger-23.9.2/timetagger/app/index.md` & `timetagger-24.4.1/timetagger/app/index.md`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/app/jspdf.js` & `timetagger-24.4.1/timetagger/app/jspdf.js`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/app/sandbox.md` & `timetagger-24.4.1/timetagger/app/sandbox.md`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/app/stores.py` & `timetagger-24.4.1/timetagger/app/stores.py`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/app/sw.js` & `timetagger-24.4.1/timetagger/app/sw.js`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/app/timetagger_manifest.json` & `timetagger-24.4.1/timetagger/app/timetagger_manifest.json`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/app/tools.py` & `timetagger-24.4.1/timetagger/app/tools.py`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/app/utils.py` & `timetagger-24.4.1/timetagger/app/utils.py`

 * *Files 4% similar despite different names*

```diff
@@ -52,15 +52,17 @@
 
 def fit_font_size(ctx, available_width, font, text, maxsize=100):
     """Fit a piece of text into a specified available space and return the size."""
     PSCRIPT_OVERLOAD = False  # noqa
     # Takes 2-5 iters, smaller available_width -> faster iteration
     size = maxsize
     width = available_width + 2
-    while width > available_width and size > 4:
+    iter = 0  # failsafe
+    while iter < 9 and width > available_width and size > 4:
+        iter += 1
         new_size = int(1.1 * size * available_width / width)
         size = new_size if new_size < size else size - 1
         ctx.font = str(size) + "px " + font
         width = ctx.measureText(text).width
     return size
 
 
@@ -456,28 +458,18 @@
         pos = positions[i]
         var_pos[0] += (pos[0] - avg_pos[0]) ** 2 / (n - 1)
         var_pos[1] += (pos[1] - avg_pos[1]) ** 2 / (n - 1)
     std_pos = var_pos[0] ** 0.5, var_pos[1] ** 0.5
     return avg_pos, std_pos
 
 
-def get_pixel_ratio(ctx):
+def get_pixel_ratio():
     """Get the ratio of logical pixel to screen pixel."""
     PSCRIPT_OVERLOAD = False  # noqa
-
-    dpr = window.devicePixelRatio or 1
-    bsr = (
-        ctx.webkitBackingStorePixelRatio
-        or ctx.mozBackingStorePixelRatio
-        or ctx.msBackingStorePixelRatio
-        or ctx.oBackingStorePixelRatio
-        or ctx.backingStorePixelRatio
-        or 1
-    )
-    return dpr / bsr
+    return window.devicePixelRatio or 1
 
 
 def create_pointer_event(node, e):
     # From flexx.ui.Widget
     # Get offset to fix positions
     rect = node.getBoundingClientRect()
     offset = rect.left, rect.top
@@ -606,33 +598,35 @@
 
 
 class SimpleSettings:
     """Base API for storing settings. The "simple" refers to the API.
     Key-value pairs are stored in a cache for fast getters.
     The actual storage can be:
     * None / session only: unknown keys are not stored across sessions.
-    * Local storagee: a prefefined set of keys are stored in local storaged,
+    * Local storage: a prefefined set of keys are stored in local storaged,
       which means that they are device-specific.
     * Synced: synced to the server using the settings store.
     """
 
     def __init__(self):
         # Define the settings and the defaults
         self._local_keys = {
             "darkmode": 1,
             "width_mode": "auto",
+            "notifications": False,
             "pomodoro_enabled": False,
             "report_grouping": "date",
             "report_groupperiod": "none",
             "report_hidesecondary": False,
-            "report_hourdecimals": False,
+            "report_format": "hm",
             "report_showrecords": True,
         }
         self._synced_keys = {
             "first_day_of_week": 1,
+            "workdays": 0,
             "time_repr": "auto",
             "duration_repr": "hms",
             "today_snap_offset": "",
             "today_end_offset": "",
             "show_stopwatch": True,
         }
         # The data store for synced source
@@ -773,16 +767,17 @@
         # Keep track of touch events
         self.node.addEventListener("touchstart", self._on_js_touch_event, 0)
         self.node.addEventListener("touchend", self._on_js_touch_event, 0)
         self.node.addEventListener("touchcancel", self._on_js_touch_event, 0)
         self.node.addEventListener("touchmove", self._on_js_touch_event, 0)
 
         # Keep track of window size
-        window.addEventListener("resize", self._on_js_resize_event, False)
-        window.setTimeout(self._on_js_resize_event, 10)
+        # window.addEventListener("resize", self._on_js_resize_event, False)
+        self._resize_observer = window.ResizeObserver(self._on_resize_observer)
+        self._resize_observer.observe(self.node)
 
     def _prevent_default_event(self, e):
         """Prevent the default action of an event unless all modifier
         keys (shift, ctrl, alt) are pressed down.
         """
         if e.target is self.node:
             # if not (e.altKey is True and e.ctrlKey is True and e.shiftKey is True):
@@ -835,29 +830,63 @@
             "start": "down",
             "move": "move",
             "end": "up",
             "cancel": "up",
         }.get(e.type[5:])
         self.on_pointer(ev)
 
-    def _on_js_resize_event(self):
-        """Ensure that the canvas has the correct size and dpi."""
-        ctx = self.node.getContext("2d")
-        self.pixel_ratio = get_pixel_ratio(ctx)
+    def _on_resize_observer(self, entries):
+        # The resize observer allows us to get the extact size of the element
+        # in physical pixels, something we cannot do with a normal resize event.
+        # See https://web.dev/articles/device-pixel-content-box
+        #
+        # On Firefox I've seen the app hang due to window resizing. I have not
+        # been able to find a singular reason, but it seems important that we
+        # update the canvas physical size (i.e. call _apply_new_size) directly.
+        # It also looks like drawing stuff outside a requested animation frame
+        # is dangerous. See https://github.com/almarklein/timetagger/pull/418
+        entry = entries.find(lambda entry: entry.target is self.node)
+        if entry.devicePixelContentBoxSize:
+            # Best if we have the physical pixels ...
+            psize = [
+                entry.devicePixelContentBoxSize[0].inlineSize,
+                entry.devicePixelContentBoxSize[0].blockSize,
+            ]
+        else:
+            # ... but not all browsers support that (see issue #423) ...
+            if entry.contentBoxSize:
+                lsize = [
+                    entry.contentBoxSize[0].inlineSize,
+                    entry.contentBoxSize[0].blockSize,
+                ]
+            else:  # even more backward compat
+                lsize = [entry.contentRect.width, entry.contentRect.height]
+            ratio = get_pixel_ratio()
+            psize = Math.floor(lsize[0] * ratio), Math.floor(lsize[1] * ratio)
+
+        self._apply_new_size(psize)
+        # Calling self._draw() avoids flicker, but I still saw occasional hangups,
+        # so let's accept the flicker and use update() ...
+        self.update()
 
-        # A line-width of 2 is great to have crisp images. For uneven line widths
-        # one needs to offset 0.5 * pixel_ratio. But, that line-width must be
-        # snapped to a width matching the pixel_ratio! pfew!
-        self.grid_linewidth2 = min(self.pixel_ratio, self.grid_round(1)) * 2
+    def _apply_new_size(self, psize):
+        # This is called JIT right before a draw, when a resize has happened
 
-        self.w, self.h = self.node.clientWidth, self.node.clientHeight
-        self.node.width = self.w * self.pixel_ratio
-        self.node.height = self.h * self.pixel_ratio
-        self.update()
-        self.on_resize(True)  # draw asap to avoid flicker
+        # Get and store pixel ratio
+        self.pixel_ratio = ratio = get_pixel_ratio()
+        # Use that to obtain the real number of logical pixels
+        lsize = psize[0] / ratio, psize[1] / ratio
+        # Apply
+        self.node.width = psize[0]
+        self.node.height = psize[1]
+        self.w, self.h = lsize[0], lsize[1]
+        # Calculate linewidth param
+        self.grid_linewidth2 = min(self.pixel_ratio, self.grid_round(1)) * 2
+        # Update
+        self.on_resize()
 
     def grid_round(self, x):
         """Round a value to the screen pixel grid."""
         PSCRIPT_OVERLOAD = False  # noqa
         return Math.round(x * self.pixel_ratio) / self.pixel_ratio
 
     def _draw_tick(self):
@@ -869,41 +898,44 @@
         res = 1000  # 1 FPS
         etime = int(now / res) * res + res
         window.setTimeout(self._draw_tick, etime - now)
         self.update()
 
     def update(self, asap=True):
         """Schedule an update."""
-        # The extra setTimeout is to make sure that there is time for the
-        # browser to process events (like scrolling).
+        # The optional extra setTimeout is to make sure that there is
+        # time for the browser to process events (like scrolling).
         if not self._pending_draw:
             self._pending_draw = True
             if asap:
                 window.requestAnimationFrame(self._draw)
             else:
                 window.setTimeout(window.requestAnimationFrame, 10, self._draw)
 
     def _draw(self):
         """The entry draw function, called by the browser."""
+
+        # Reset flag
         self._pending_draw = False
+
+        # Is the element even visible
         if self.node.style.display == "none":
             return  # Hidden
-        elif self.w <= 0 or self.h <= 0:
+        if self.w <= 0 or self.h <= 0:
             return  # Probably still initializing
 
-        ctx = self.node.getContext("2d")
+        # Some bookkeeping
+        self._tooltips.clear()
 
-        # Prepare hidpi mode for canvas  (flush state just in case)
-        for i in range(4):
-            ctx.restore()
+        # Prepare context
+        ctx = self.node.getContext("2d")
+        ctx.restore()  # undo last
         ctx.save()
         ctx.scale(self.pixel_ratio, self.pixel_ratio)
 
-        self._tooltips.clear()
-
         # Draw
         self.on_draw(ctx)
 
     def _tooltip_handler(self, e):
         ev = create_pointer_event(self.node, e)
         x, y = ev.pos
         # Only on mouse - it's anoying for touch
```

### Comparing `timetagger-23.9.2/timetagger/common/SpaceMono-Regular-webfont.woff` & `timetagger-24.4.1/timetagger/common/SpaceMono-Regular-webfont.woff`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/common/Ubuntu-C-normal.js` & `timetagger-24.4.1/timetagger/common/Ubuntu-C-normal.js`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/common/Ubuntu-C.ttf` & `timetagger-24.4.1/timetagger/common/Ubuntu-C.ttf`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/common/Ubuntu-R-normal.js` & `timetagger-24.4.1/timetagger/common/Ubuntu-R-normal.js`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/common/Ubuntu-R.ttf` & `timetagger-24.4.1/timetagger/common/Ubuntu-R.ttf`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/common/UbuntuCondensed_latin.woff2` & `timetagger-24.4.1/timetagger/common/UbuntuCondensed_latin.woff2`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/common/Ubuntu_latin.woff2` & `timetagger-24.4.1/timetagger/common/Ubuntu_latin.woff2`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/common/_style_embed.scss` & `timetagger-24.4.1/timetagger/common/_style_embed.scss`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/common/_template.html` & `timetagger-24.4.1/timetagger/common/_template.html`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/common/bcrypt.js` & `timetagger-24.4.1/timetagger/common/bcrypt.js`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/common/clearly-602.ogg` & `timetagger-24.4.1/timetagger/common/clearly-602.ogg`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/common/cred.html` & `timetagger-24.4.1/timetagger/common/cred.html`

 * *Files 2% similar despite different names*

```diff
@@ -1,14 +1,15 @@
 <!DOCTYPE html>
 <html lang="en">
 
     <head>
         <meta charset="utf-8">
-        <title>Generate credentials</title>
+        <meta name="viewport" content="width=device-width, initial-scale=1">
         <meta name="description" content="Generate username:password with BCrypt hashing.">
+        <title>Generate credentials</title>
 
         <style>
 
             main {
                 position: absolute;
                 top: 0px; bottom: 0; left: 0; right: 0;
                 padding: 1em;
```

### Comparing `timetagger-23.9.2/timetagger/common/eventually-590.ogg` & `timetagger-24.4.1/timetagger/common/eventually-590.ogg`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/common/fa-solid-900.woff2` & `timetagger-24.4.1/timetagger/common/fa-solid-900.woff2`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/common/wind-up-1-534.ogg` & `timetagger-24.4.1/timetagger/common/wind-up-1-534.ogg`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/images/_update_icons.py` & `timetagger-24.4.1/timetagger/images/_update_icons.py`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/images/_update_paper.py` & `timetagger-24.4.1/timetagger/images/_update_paper.py`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/images/favicon.ico` & `timetagger-24.4.1/timetagger/images/favicon.ico`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/images/paper0.jpg` & `timetagger-24.4.1/timetagger/images/paper0.jpg`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/images/paper1.jpg` & `timetagger-24.4.1/timetagger/images/paper1.jpg`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/images/paper2.jpg` & `timetagger-24.4.1/timetagger/images/paper2.jpg`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/images/paper3.jpg` & `timetagger-24.4.1/timetagger/images/paper3.jpg`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/images/timetagger128_sf.png` & `timetagger-24.4.1/timetagger/images/timetagger128_sf.png`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/images/timetagger16_sf.png` & `timetagger-24.4.1/timetagger/images/timetagger16_sf.png`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/images/timetagger192_bd.png` & `timetagger-24.4.1/timetagger/images/timetagger192_bd.png`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/images/timetagger192_sd.png` & `timetagger-24.4.1/timetagger/images/timetagger192_sd.png`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/images/timetagger192_sf.png` & `timetagger-24.4.1/timetagger/images/timetagger192_sf.png`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/images/timetagger192_sf_dot.png` & `timetagger-24.4.1/timetagger/images/timetagger192_sf_dot.png`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/images/timetagger192_sl.png` & `timetagger-24.4.1/timetagger/images/timetagger192_sl.png`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/images/timetagger192_sm.png` & `timetagger-24.4.1/timetagger/images/timetagger192_sm.png`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/images/timetagger192_tg.png` & `timetagger-24.4.1/timetagger/images/timetagger192_tg.png`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/images/timetagger256_sf.png` & `timetagger-24.4.1/timetagger/images/timetagger256_sf.png`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/images/timetagger32_sf.png` & `timetagger-24.4.1/timetagger/images/timetagger32_sf.png`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/images/timetagger48_sf.png` & `timetagger-24.4.1/timetagger/images/timetagger48_sf.png`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/images/timetagger512_bd.png` & `timetagger-24.4.1/timetagger/images/timetagger512_bd.png`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/images/timetagger512_sf.png` & `timetagger-24.4.1/timetagger/images/timetagger512_sf.png`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/images/timetagger512_sm.png` & `timetagger-24.4.1/timetagger/images/timetagger512_sm.png`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/images/timetagger64_sf.png` & `timetagger-24.4.1/timetagger/images/timetagger64_sf.png`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/images/timetagger_sd.svg` & `timetagger-24.4.1/timetagger/images/timetagger_sd.svg`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/images/timetagger_sf.ico` & `timetagger-24.4.1/timetagger/images/timetagger_sf.ico`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/images/timetagger_sl.svg` & `timetagger-24.4.1/timetagger/images/timetagger_sl.svg`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/images/timetagger_wd.svg` & `timetagger-24.4.1/timetagger/images/timetagger_wd.svg`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/images/timetagger_wl.svg` & `timetagger-24.4.1/timetagger/images/timetagger_wl.svg`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/pages/account.md` & `timetagger-24.4.1/timetagger/pages/account.md`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/pages/index.md` & `timetagger-24.4.1/timetagger/pages/index.md`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/pages/login.md` & `timetagger-24.4.1/timetagger/pages/login.md`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/server/_apiserver.py` & `timetagger-24.4.1/timetagger/server/_apiserver.py`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/server/_assets.py` & `timetagger-24.4.1/timetagger/server/_assets.py`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger/server/_utils.py` & `timetagger-24.4.1/timetagger/server/_utils.py`

 * *Files identical despite different names*

### Comparing `timetagger-23.9.2/timetagger.egg-info/PKG-INFO` & `timetagger-24.4.1/timetagger.egg-info/PKG-INFO`

 * *Files 8% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: timetagger
-Version: 23.9.2
+Version: 24.4.1
 Summary: Tag your time, get the insight - an open source time tracker for individuals
 Home-page: https://github.com/almarklein/timetagger
 Author: Almar Klein
 Author-email: almar.klein@gmail.com
 License: GPL-3.0
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: Intended Audience :: Developers
```

### Comparing `timetagger-23.9.2/timetagger.egg-info/SOURCES.txt` & `timetagger-24.4.1/timetagger.egg-info/SOURCES.txt`

 * *Files 2% similar despite different names*

```diff
@@ -1,12 +1,13 @@
 LICENSE
 MANIFEST.in
 README.md
 requirements.txt
 setup.py
+contrib/multiuser_tweaks/timetagger_multiuser_tweaks.py
 timetagger/__init__.py
 timetagger/__main__.py
 timetagger/_config.py
 timetagger.egg-info/PKG-INFO
 timetagger.egg-info/SOURCES.txt
 timetagger.egg-info/dependency_links.txt
 timetagger.egg-info/requires.txt
```

