# Comparing `tmp/amilib-0.0.5.tar.gz` & `tmp/amilib-0.0.6.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "dist/amilib-0.0.5.tar", last modified: Sat Apr  6 22:10:33 2024, max compression
+gzip compressed data, was "dist/amilib-0.0.6.tar", last modified: Thu Apr 18 23:39:37 2024, max compression
```

## Comparing `amilib-0.0.5.tar` & `amilib-0.0.6.tar`

### file list

```diff
@@ -1,47 +1,46 @@
-drwxr-xr-x   0 pm286      (503) staff       (20)        0 2024-04-06 22:10:33.747294 amilib-0.0.5/
--rw-r--r--   0 pm286      (503) staff       (20)    11357 2024-03-27 16:20:01.000000 amilib-0.0.5/LICENSE
--rw-r--r--   0 pm286      (503) staff       (20)      816 2024-04-06 22:10:33.747158 amilib-0.0.5/PKG-INFO
--rw-r--r--   0 pm286      (503) staff       (20)       76 2024-03-27 16:22:55.000000 amilib-0.0.5/README.md
-drwxr-xr-x   0 pm286      (503) staff       (20)        0 2024-04-06 22:10:33.744700 amilib-0.0.5/amilib/
--rw-r--r--   0 pm286      (503) staff       (20)        0 2024-03-27 18:27:17.000000 amilib-0.0.5/amilib/__init__.py
--rw-r--r--   0 pm286      (503) staff       (20)     5185 2024-04-06 21:49:19.000000 amilib-0.0.5/amilib/ami_bib.py
--rw-r--r--   0 pm286      (503) staff       (20)      539 2024-04-06 21:53:37.000000 amilib-0.0.5/amilib/ami_csv.py
--rw-r--r--   0 pm286      (503) staff       (20)   164257 2024-04-06 21:53:37.000000 amilib-0.0.5/amilib/ami_html.py
--rw-r--r--   0 pm286      (503) staff       (20)    16455 2024-04-06 16:22:07.000000 amilib-0.0.5/amilib/ami_integrate.py
--rw-r--r--   0 pm286      (503) staff       (20)     8541 2024-04-06 18:33:33.000000 amilib-0.0.5/amilib/ami_nlp.py
--rw-r--r--   0 pm286      (503) staff       (20)    81920 2024-04-06 16:22:07.000000 amilib-0.0.5/amilib/ami_pdf_libs.py
--rw-r--r--   0 pm286      (503) staff       (20)     4976 2024-04-06 16:22:07.000000 amilib-0.0.5/amilib/ami_svg.py
--rw-r--r--   0 pm286      (503) staff       (20)    10712 2024-04-06 22:00:19.000000 amilib-0.0.5/amilib/ami_util.py
--rw-r--r--   0 pm286      (503) staff       (20)     8473 2024-04-06 18:35:06.000000 amilib-0.0.5/amilib/amidriver.py
--rw-r--r--   0 pm286      (503) staff       (20)    49681 2024-04-06 22:10:25.000000 amilib-0.0.5/amilib/amix.py
--rw-r--r--   0 pm286      (503) staff       (20)    19772 2024-04-06 22:00:19.000000 amilib-0.0.5/amilib/bbox.py
--rw-r--r--   0 pm286      (503) staff       (20)    14214 2024-04-06 22:00:19.000000 amilib-0.0.5/amilib/file_lib.py
--rw-r--r--   0 pm286      (503) staff       (20)     3862 2024-04-06 22:00:19.000000 amilib-0.0.5/amilib/html_args.py
--rw-r--r--   0 pm286      (503) staff       (20)    16530 2024-04-06 22:00:19.000000 amilib-0.0.5/amilib/html_generator.py
--rw-r--r--   0 pm286      (503) staff       (20)    48363 2024-04-06 21:49:20.000000 amilib-0.0.5/amilib/html_marker.py
--rw-r--r--   0 pm286      (503) staff       (20)    27194 2024-04-06 16:22:07.000000 amilib-0.0.5/amilib/pdf_args.py
--rw-r--r--   0 pm286      (503) staff       (20)    36787 2024-04-06 22:00:19.000000 amilib-0.0.5/amilib/util.py
--rw-r--r--   0 pm286      (503) staff       (20)    33687 2024-04-06 22:00:19.000000 amilib-0.0.5/amilib/wikimedia.py
--rw-r--r--   0 pm286      (503) staff       (20)    54483 2024-04-06 22:00:19.000000 amilib-0.0.5/amilib/xml_lib.py
-drwxr-xr-x   0 pm286      (503) staff       (20)        0 2024-04-06 22:10:33.745567 amilib-0.0.5/amilib.egg-info/
--rw-r--r--   0 pm286      (503) staff       (20)      816 2024-04-06 22:10:33.000000 amilib-0.0.5/amilib.egg-info/PKG-INFO
--rw-r--r--   0 pm286      (503) staff       (20)      822 2024-04-06 22:10:33.000000 amilib-0.0.5/amilib.egg-info/SOURCES.txt
--rw-r--r--   0 pm286      (503) staff       (20)        1 2024-04-06 22:10:33.000000 amilib-0.0.5/amilib.egg-info/dependency_links.txt
--rw-r--r--   0 pm286      (503) staff       (20)       44 2024-04-06 22:10:33.000000 amilib-0.0.5/amilib.egg-info/entry_points.txt
--rw-r--r--   0 pm286      (503) staff       (20)        1 2024-04-06 21:41:47.000000 amilib-0.0.5/amilib.egg-info/not-zip-safe
--rw-r--r--   0 pm286      (503) staff       (20)      125 2024-04-06 22:10:33.000000 amilib-0.0.5/amilib.egg-info/requires.txt
--rw-r--r--   0 pm286      (503) staff       (20)        7 2024-04-06 22:10:33.000000 amilib-0.0.5/amilib.egg-info/top_level.txt
--rw-r--r--   0 pm286      (503) staff       (20)       38 2024-04-06 22:10:33.747337 amilib-0.0.5/setup.cfg
--rw-r--r--   0 pm286      (503) staff       (20)     1651 2024-04-06 22:10:25.000000 amilib-0.0.5/setup.py
-drwxr-xr-x   0 pm286      (503) staff       (20)        0 2024-04-06 22:10:33.746989 amilib-0.0.5/test/
--rw-r--r--   0 pm286      (503) staff       (20)     4200 2024-04-06 18:38:39.000000 amilib-0.0.5/test/test_all.py
--rw-r--r--   0 pm286      (503) staff       (20)     2460 2024-04-04 15:27:40.000000 amilib-0.0.5/test/test_file.py
--rw-r--r--   0 pm286      (503) staff       (20)    38266 2024-04-05 10:07:06.000000 amilib-0.0.5/test/test_headless.py
--rw-r--r--   0 pm286      (503) staff       (20)   121225 2024-04-06 16:22:07.000000 amilib-0.0.5/test/test_html.py
--rw-r--r--   0 pm286      (503) staff       (20)      733 2024-04-05 09:30:56.000000 amilib-0.0.5/test/test_nlp.py
--rw-r--r--   0 pm286      (503) staff       (20)    80084 2024-04-06 22:07:18.000000 amilib-0.0.5/test/test_pdf.py
--rw-r--r--   0 pm286      (503) staff       (20)      957 2024-04-05 09:40:39.000000 amilib-0.0.5/test/test_stat.py
--rw-r--r--   0 pm286      (503) staff       (20)     1065 2024-04-01 09:44:34.000000 amilib-0.0.5/test/test_svg.py
--rw-r--r--   0 pm286      (503) staff       (20)    10324 2024-04-02 21:34:31.000000 amilib-0.0.5/test/test_util.py
--rw-r--r--   0 pm286      (503) staff       (20)    35765 2024-04-06 16:22:07.000000 amilib-0.0.5/test/test_wikidata.py
--rw-r--r--   0 pm286      (503) staff       (20)     4787 2024-04-05 09:18:11.000000 amilib-0.0.5/test/test_xml.py
+drwxr-xr-x   0 pm286      (503) staff       (20)        0 2024-04-18 23:39:37.858864 amilib-0.0.6/
+-rw-r--r--   0 pm286      (503) staff       (20)    11357 2024-04-16 00:05:01.000000 amilib-0.0.6/LICENSE
+-rw-r--r--   0 pm286      (503) staff       (20)      816 2024-04-18 23:39:37.858725 amilib-0.0.6/PKG-INFO
+-rw-r--r--   0 pm286      (503) staff       (20)       76 2024-04-16 00:05:01.000000 amilib-0.0.6/README.md
+drwxr-xr-x   0 pm286      (503) staff       (20)        0 2024-04-18 23:39:37.856248 amilib-0.0.6/amilib/
+-rw-r--r--   0 pm286      (503) staff       (20)        0 2024-04-16 00:05:01.000000 amilib-0.0.6/amilib/__init__.py
+-rw-r--r--   0 pm286      (503) staff       (20)     5132 2024-04-16 00:05:01.000000 amilib-0.0.6/amilib/ami_bib.py
+-rw-r--r--   0 pm286      (503) staff       (20)      287 2024-04-17 21:43:55.000000 amilib-0.0.6/amilib/ami_csv.py
+-rw-r--r--   0 pm286      (503) staff       (20)   168064 2024-04-18 06:54:59.000000 amilib-0.0.6/amilib/ami_html.py
+-rw-r--r--   0 pm286      (503) staff       (20)    16455 2024-04-16 00:05:01.000000 amilib-0.0.6/amilib/ami_integrate.py
+-rw-r--r--   0 pm286      (503) staff       (20)     8504 2024-04-16 00:05:01.000000 amilib-0.0.6/amilib/ami_nlp.py
+-rw-r--r--   0 pm286      (503) staff       (20)    81920 2024-04-16 00:05:01.000000 amilib-0.0.6/amilib/ami_pdf_libs.py
+-rw-r--r--   0 pm286      (503) staff       (20)     4976 2024-04-16 00:05:01.000000 amilib-0.0.6/amilib/ami_svg.py
+-rw-r--r--   0 pm286      (503) staff       (20)    10651 2024-04-16 00:05:01.000000 amilib-0.0.6/amilib/ami_util.py
+-rw-r--r--   0 pm286      (503) staff       (20)     8422 2024-04-16 00:05:01.000000 amilib-0.0.6/amilib/amidriver.py
+-rw-r--r--   0 pm286      (503) staff       (20)    49230 2024-04-18 23:39:25.000000 amilib-0.0.6/amilib/amix.py
+-rw-r--r--   0 pm286      (503) staff       (20)    19721 2024-04-16 00:05:01.000000 amilib-0.0.6/amilib/bbox.py
+-rw-r--r--   0 pm286      (503) staff       (20)    14085 2024-04-16 00:05:01.000000 amilib-0.0.6/amilib/file_lib.py
+-rw-r--r--   0 pm286      (503) staff       (20)    16556 2024-04-16 00:05:01.000000 amilib-0.0.6/amilib/html_generator.py
+-rw-r--r--   0 pm286      (503) staff       (20)    48143 2024-04-16 00:05:01.000000 amilib-0.0.6/amilib/html_marker.py
+-rw-r--r--   0 pm286      (503) staff       (20)    27194 2024-04-16 00:05:01.000000 amilib-0.0.6/amilib/pdf_args.py
+-rw-r--r--   0 pm286      (503) staff       (20)    36799 2024-04-16 00:05:01.000000 amilib-0.0.6/amilib/util.py
+-rw-r--r--   0 pm286      (503) staff       (20)    33690 2024-04-16 00:05:01.000000 amilib-0.0.6/amilib/wikimedia.py
+-rw-r--r--   0 pm286      (503) staff       (20)    54474 2024-04-16 00:05:01.000000 amilib-0.0.6/amilib/xml_lib.py
+drwxr-xr-x   0 pm286      (503) staff       (20)        0 2024-04-18 23:39:37.857156 amilib-0.0.6/amilib.egg-info/
+-rw-r--r--   0 pm286      (503) staff       (20)      816 2024-04-18 23:39:37.000000 amilib-0.0.6/amilib.egg-info/PKG-INFO
+-rw-r--r--   0 pm286      (503) staff       (20)      802 2024-04-18 23:39:37.000000 amilib-0.0.6/amilib.egg-info/SOURCES.txt
+-rw-r--r--   0 pm286      (503) staff       (20)        1 2024-04-18 23:39:37.000000 amilib-0.0.6/amilib.egg-info/dependency_links.txt
+-rw-r--r--   0 pm286      (503) staff       (20)       44 2024-04-18 23:39:37.000000 amilib-0.0.6/amilib.egg-info/entry_points.txt
+-rw-r--r--   0 pm286      (503) staff       (20)        1 2024-04-18 23:35:57.000000 amilib-0.0.6/amilib.egg-info/not-zip-safe
+-rw-r--r--   0 pm286      (503) staff       (20)      125 2024-04-18 23:39:37.000000 amilib-0.0.6/amilib.egg-info/requires.txt
+-rw-r--r--   0 pm286      (503) staff       (20)        7 2024-04-18 23:39:37.000000 amilib-0.0.6/amilib.egg-info/top_level.txt
+-rw-r--r--   0 pm286      (503) staff       (20)       38 2024-04-18 23:39:37.858912 amilib-0.0.6/setup.cfg
+-rw-r--r--   0 pm286      (503) staff       (20)     1651 2024-04-18 23:39:25.000000 amilib-0.0.6/setup.py
+drwxr-xr-x   0 pm286      (503) staff       (20)        0 2024-04-18 23:39:37.858546 amilib-0.0.6/test/
+-rw-r--r--   0 pm286      (503) staff       (20)     2679 2024-04-17 00:12:33.000000 amilib-0.0.6/test/test_all.py
+-rw-r--r--   0 pm286      (503) staff       (20)     3941 2024-04-18 07:09:52.000000 amilib-0.0.6/test/test_file.py
+-rw-r--r--   0 pm286      (503) staff       (20)    38266 2024-04-16 00:05:02.000000 amilib-0.0.6/test/test_headless.py
+-rw-r--r--   0 pm286      (503) staff       (20)   121225 2024-04-16 00:05:02.000000 amilib-0.0.6/test/test_html.py
+-rw-r--r--   0 pm286      (503) staff       (20)      733 2024-04-16 00:05:02.000000 amilib-0.0.6/test/test_nlp.py
+-rw-r--r--   0 pm286      (503) staff       (20)    80007 2024-04-16 00:05:02.000000 amilib-0.0.6/test/test_pdf.py
+-rw-r--r--   0 pm286      (503) staff       (20)      957 2024-04-16 00:05:02.000000 amilib-0.0.6/test/test_stat.py
+-rw-r--r--   0 pm286      (503) staff       (20)     1065 2024-04-16 00:05:02.000000 amilib-0.0.6/test/test_svg.py
+-rw-r--r--   0 pm286      (503) staff       (20)    10541 2024-04-18 07:00:37.000000 amilib-0.0.6/test/test_util.py
+-rw-r--r--   0 pm286      (503) staff       (20)    35765 2024-04-16 00:05:02.000000 amilib-0.0.6/test/test_wikidata.py
+-rw-r--r--   0 pm286      (503) staff       (20)     4787 2024-04-16 00:05:02.000000 amilib-0.0.6/test/test_xml.py
```

### Comparing `amilib-0.0.5/LICENSE` & `amilib-0.0.6/LICENSE`

 * *Files identical despite different names*

### Comparing `amilib-0.0.5/PKG-INFO` & `amilib-0.0.6/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: amilib
-Version: 0.0.5
+Version: 0.0.6
 Summary: document download, cleaning, managemenr
 Home-page: https://github.com/petermr/amilib
 Author: Peter Murray-Rust
 Author-email: petermurrayrust@googlemail.com
 License: Apache2
 Keywords: text and data mining
 Classifier: Development Status :: 3 - Alpha
```

### Comparing `amilib-0.0.5/amilib/ami_bib.py` & `amilib-0.0.6/amilib/ami_bib.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,18 +1,15 @@
 """manages bibligraphy and related stuff"""
-import logging
 
 import lxml
 import lxml.etree
 import re
 # local
 from amilib.util import Util
 
-logger = logging.getLogger(__file__)
-
 
 class Reference:
     SINGLE_REF_REC = re.compile(r"""
                     (?P<pre>.*)   # leading string without bracket
                     \(            # bracket
                     (?P<body>
                     (?:[A-Z]|de|d')
```

### Comparing `amilib-0.0.5/amilib/ami_html.py` & `amilib-0.0.6/amilib/ami_html.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,10267 +1,10504 @@
 00000000: 2222 2253 7570 706f 7274 7320 7061 7273  """Supports pars
 00000010: 696e 672c 2065 6469 7469 6e67 2c20 6d61  ing, editing, ma
 00000020: 726b 7570 2c20 7265 7374 7275 6374 696e  rkup, restructin
 00000030: 6720 6f66 2048 544d 4c0a 5368 6f75 6c64  g of HTML.Should
 00000040: 2068 6176 6520 7265 6c61 7469 7665 6c79   have relatively
 00000050: 2066 6577 2064 6570 656e 6465 6e63 6965   few dependencie
-00000060: 7322 2222 0a69 6d70 6f72 7420 636f 7079  s""".import copy
-00000070: 0a69 6d70 6f72 7420 6c6f 6767 696e 670a  .import logging.
-00000080: 696d 706f 7274 2072 650a 696d 706f 7274  import re.import
-00000090: 2073 7973 0a69 6d70 6f72 7420 7469 6d65   sys.import time
-000000a0: 0a66 726f 6d20 636f 6c6c 6563 7469 6f6e  .from collection
-000000b0: 7320 696d 706f 7274 2064 6566 6175 6c74  s import default
-000000c0: 6469 6374 0a66 726f 6d20 656e 756d 2069  dict.from enum i
-000000d0: 6d70 6f72 7420 456e 756d 0a66 726f 6d20  mport Enum.from 
-000000e0: 696f 2069 6d70 6f72 7420 5374 7269 6e67  io import String
-000000f0: 494f 0a66 726f 6d20 7061 7468 6c69 6220  IO.from pathlib 
-00000100: 696d 706f 7274 2050 6174 680a 6672 6f6d  import Path.from
-00000110: 2070 7072 696e 7420 696d 706f 7274 2070   pprint import p
-00000120: 7072 696e 740a 0a69 6d70 6f72 7420 6c78  print..import lx
-00000130: 6d6c 2e65 7472 6565 2061 7320 4554 0a69  ml.etree as ET.i
-00000140: 6d70 6f72 7420 6e75 6d70 7920 6173 206e  mport numpy as n
-00000150: 700a 6672 6f6d 206c 786d 6c2e 6574 7265  p.from lxml.etre
-00000160: 6520 696d 706f 7274 2045 6c65 6d65 6e74  e import Element
-00000170: 2c20 5f45 6c65 6d65 6e74 2c20 5f45 6c65  , _Element, _Ele
-00000180: 6d65 6e74 5472 6565 0a66 726f 6d20 736b  mentTree.from sk
-00000190: 6c65 6172 6e2e 6c69 6e65 6172 5f6d 6f64  learn.linear_mod
-000001a0: 656c 2069 6d70 6f72 7420 4c69 6e65 6172  el import Linear
-000001b0: 5265 6772 6573 7369 6f6e 0a0a 2320 6c6f  Regression..# lo
-000001c0: 6361 6c0a 6672 6f6d 2061 6d69 6c69 622e  cal.from amilib.
-000001d0: 6262 6f78 2069 6d70 6f72 7420 4242 6f78  bbox import BBox
-000001e0: 0a66 726f 6d20 616d 696c 6962 2e75 7469  .from amilib.uti
-000001f0: 6c20 696d 706f 7274 2053 5363 7269 7074  l import SScript
-00000200: 2c20 5574 696c 2c20 416d 694c 6f67 6765  , Util, AmiLogge
-00000210: 720a 6672 6f6d 2061 6d69 6c69 622e 786d  r.from amilib.xm
-00000220: 6c5f 6c69 6220 696d 706f 7274 2058 6d6c  l_lib import Xml
-00000230: 4c69 622c 2048 746d 6c4c 6962 0a0a 2320  Lib, HtmlLib..# 
-00000240: 6e6f 2074 7279 2d63 6174 6368 2069 6d70  no try-catch imp
-00000250: 6f72 7473 0a0a 6c6f 6767 6572 203d 2041  orts..logger = A
-00000260: 6d69 4c6f 6767 6572 2e63 7265 6174 655f  miLogger.create_
-00000270: 6e61 6d65 645f 6c6f 6767 6572 285f 5f66  named_logger(__f
-00000280: 696c 655f 5f29 0a0a 2320 4854 4d4c 2065  ile__)..# HTML e
-00000290: 6c65 6d65 6e74 730a 485f 4854 4d4c 203d  lements.H_HTML =
-000002a0: 2022 6874 6d6c 220a 485f 4845 4144 203d   "html".H_HEAD =
-000002b0: 2022 6865 6164 220a 485f 4d45 5441 203d   "head".H_META =
-000002c0: 2022 6d65 7461 220a 485f 5343 5249 5054   "meta".H_SCRIPT
-000002d0: 203d 2022 7363 7269 7074 220a 485f 5354   = "script".H_ST
-000002e0: 594c 4520 3d20 2273 7479 6c65 220a 485f  YLE = "style".H_
-000002f0: 424f 4459 203d 2022 626f 6479 220a 485f  BODY = "body".H_
-00000300: 5441 424c 4520 3d20 2274 6162 6c65 220a  TABLE = "table".
-00000310: 485f 5448 4541 4420 3d20 2274 6865 6164  H_THEAD = "thead
-00000320: 220a 485f 5449 544c 4520 3d20 2274 6974  ".H_TITLE = "tit
-00000330: 6c65 220a 485f 5442 4f44 5920 3d20 2274  le".H_TBODY = "t
-00000340: 626f 6479 220a 485f 5452 203d 2022 7472  body".H_TR = "tr
-00000350: 220a 485f 5448 203d 2022 7468 220a 485f  ".H_TH = "th".H_
-00000360: 5444 203d 2022 7464 220a 485f 4449 5620  TD = "td".H_DIV 
-00000370: 3d20 2264 6976 220a 485f 5350 414e 203d  = "div".H_SPAN =
-00000380: 2022 7370 616e 220a 485f 554c 203d 2022   "span".H_UL = "
-00000390: 756c 220a 485f 4c49 203d 2022 6c69 220a  ul".H_LI = "li".
-000003a0: 485f 4120 3d20 2261 220a 485f 4220 3d20  H_A = "a".H_B = 
-000003b0: 2262 220a 485f 5020 3d20 2270 220a 0a58  "b".H_P = "p"..X
-000003c0: 203d 2022 7822 0a59 203d 2022 7922 0a58   = "x".Y = "y".X
-000003d0: 3020 3d20 2278 3022 0a58 3120 3d20 2278  0 = "x0".X1 = "x
-000003e0: 3122 0a0a 2320 4854 4d4c 2061 7474 7269  1"..# HTML attri
-000003f0: 6275 7465 730a 415f 434c 4153 5320 3d20  butes.A_CLASS = 
-00000400: 2263 6c61 7373 220a 415f 4852 4546 203d  "class".A_HREF =
-00000410: 2022 6872 6566 220a 415f 4944 203d 2022   "href".A_ID = "
-00000420: 6964 220a 415f 4e41 4d45 203d 2022 6e61  id".A_NAME = "na
-00000430: 6d65 220a 415f 5354 594c 4520 3d20 2273  me".A_STYLE = "s
-00000440: 7479 6c65 220a 415f 5445 524d 203d 2022  tyle".A_TERM = "
-00000450: 7465 726d 220a 415f 5449 544c 4520 3d20  term".A_TITLE = 
-00000460: 2274 6974 6c65 220a 0a58 5f50 5245 4345  "title"..X_PRECE
-00000470: 4449 4e47 203d 2022 7072 6563 6564 696e  DING = "precedin
-00000480: 6722 0a0a 2320 7374 796c 6520 6275 6e64  g"..# style bund
-00000490: 6c65 0a53 5459 4c45 203d 2022 7374 796c  le.STYLE = "styl
-000004a0: 6522 0a49 5441 4c49 4320 3d20 2269 7461  e".ITALIC = "ita
-000004b0: 6c69 6322 0a42 4f4c 4420 3d20 2262 6f6c  lic".BOLD = "bol
-000004c0: 6422 0a54 494d 4553 203d 2022 7469 6d65  d".TIMES = "time
-000004d0: 7322 0a43 414c 4942 5249 203d 2022 6361  s".CALIBRI = "ca
-000004e0: 6c69 6272 6922 0a46 4f4e 545f 4641 4d49  libri".FONT_FAMI
-000004f0: 4c49 4553 203d 205b 5449 4d45 532c 2043  LIES = [TIMES, C
-00000500: 414c 4942 5249 5d0a 0a23 2073 7479 6c65  ALIBRI]..# style
-00000510: 2061 7474 7269 6275 7465 730a 464f 4e54   attributes.FONT
-00000520: 5f53 495a 4520 3d20 2266 6f6e 742d 7369  _SIZE = "font-si
-00000530: 7a65 220a 464f 4e54 5f53 5459 4c45 203d  ze".FONT_STYLE =
-00000540: 2022 666f 6e74 2d73 7479 6c65 220a 464f   "font-style".FO
-00000550: 4e54 5f57 4549 4748 5420 3d20 2266 6f6e  NT_WEIGHT = "fon
-00000560: 742d 7765 6967 6874 220a 464f 4e54 5f46  t-weight".FONT_F
-00000570: 414d 494c 5920 3d20 2266 6f6e 742d 6661  AMILY = "font-fa
-00000580: 6d69 6c79 220a 464f 4e54 5f46 4f4e 5420  mily".FONT_FONT 
-00000590: 3d20 2266 6f6e 7422 0a46 4f4e 545f 4e41  = "font".FONT_NA
-000005a0: 4d45 203d 2022 666f 6e74 2d6e 616d 6522  ME = "font-name"
-000005b0: 0a46 4f4e 545f 5354 5245 5443 4845 4420  .FONT_STRETCHED 
-000005c0: 3d20 2266 6f6e 742d 7374 7265 7463 6865  = "font-stretche
-000005d0: 6422 0a46 494c 4c20 3d20 2266 696c 6c22  d".FILL = "fill"
-000005e0: 0a53 5452 4f4b 4520 3d20 2273 7472 6f6b  .STROKE = "strok
-000005f0: 6522 0a0a 2320 6368 6172 6163 7465 7220  e"..# character 
-00000600: 7072 6f70 6572 7469 6573 0a50 5f46 4f4e  properties.P_FON
-00000610: 544e 414d 4520 3d20 2266 6f6e 746e 616d  TNAME = "fontnam
-00000620: 6522 0a50 5f48 4549 4748 5420 3d20 2268  e".P_HEIGHT = "h
-00000630: 6569 6768 7422 0a50 5f53 5452 4f4b 494e  eight".P_STROKIN
-00000640: 475f 434f 4c4f 5220 3d20 2273 7472 6f6b  G_COLOR = "strok
-00000650: 696e 675f 636f 6c6f 7222 0a50 5f4e 4f4e  ing_color".P_NON
-00000660: 5f53 5452 4f4b 494e 475f 434f 4c4f 5220  _STROKING_COLOR 
-00000670: 3d20 226e 6f6e 5f73 7472 6f6b 696e 675f  = "non_stroking_
-00000680: 636f 6c6f 7222 0a0a 505f 5830 203d 2022  color"..P_X0 = "
-00000690: 7830 220a 505f 5831 203d 2022 7831 220a  x0".P_X1 = "x1".
-000006a0: 505f 5930 203d 2022 7930 220a 505f 5931  P_Y0 = "y0".P_Y1
-000006b0: 203d 2022 7931 220a 505f 5445 5854 203d   = "y1".P_TEXT =
-000006c0: 2022 7465 7874 220a 0a23 2055 6e77 616e   "text"..# Unwan
-000006d0: 7465 6420 7365 6374 696f 6e73 0a55 5f58  ted sections.U_X
-000006e0: 5041 5448 203d 2022 7870 6174 6822 0a55  PATH = "xpath".U
-000006f0: 5f52 4547 4558 203d 2022 7265 6765 7822  _REGEX = "regex"
-00000700: 0a0a 5354 594c 4553 203d 205b 0a20 2020  ..STYLES = [.   
-00000710: 2046 4f4e 545f 5349 5a45 2c0a 2020 2020   FONT_SIZE,.    
-00000720: 464f 4e54 5f53 5459 4c45 2c0a 2020 2020  FONT_STYLE,.    
-00000730: 464f 4e54 5f46 414d 494c 592c 0a20 2020  FONT_FAMILY,.   
-00000740: 2046 4f4e 545f 5745 4947 4854 2c0a 2020   FONT_WEIGHT,.  
-00000750: 2020 4649 4c4c 2c0a 2020 2020 5354 524f    FILL,.    STRO
-00000760: 4b45 2c0a 5d0a 0a23 2043 5353 0a53 5f42  KE,.]..# CSS.S_B
-00000770: 4f52 4445 5220 3d20 2262 6f72 6465 7222  ORDER = "border"
-00000780: 0a53 5f50 4f53 4954 494f 4e20 3d20 2270  .S_POSITION = "p
-00000790: 6f73 6974 696f 6e22 0a53 5f57 4944 5448  osition".S_WIDTH
-000007a0: 203d 2022 7769 6474 6822 0a53 5f57 5249   = "width".S_WRI
-000007b0: 5449 4e47 5f4d 4f44 4520 3d20 2277 7269  TING_MODE = "wri
-000007c0: 7469 6e67 2d6d 6f64 6522 0a0a 5f55 5446  ting-mode".._UTF
-000007d0: 3820 3d20 2255 5446 2d38 220a 0a43 4841  8 = "UTF-8"..CHA
-000007e0: 505f 544f 505f 5245 4320 3d20 7265 2e63  P_TOP_REC = re.c
-000007f0: 6f6d 7069 6c65 2822 5f5f 4e4f 545f 5f59  ompile("__NOT__Y
-00000800: 4554 5f5f 494d 504c 454d 454e 5445 445f  ET__IMPLEMENTED_
-00000810: 5f22 290a 5345 4354 494f 4e53 5f44 4543  _").SECTIONS_DEC
-00000820: 494d 414c 5f52 4543 203d 2072 652e 636f  IMAL_REC = re.co
-00000830: 6d70 696c 6528 225c 5c64 2b5c 5c2e 5c5c  mpile("\\d+\\.\\
-00000840: 642b 2422 290a 5355 4253 4543 5453 5f44  d+$").SUBSECTS_D
-00000850: 4543 494d 414c 5f52 4543 203d 2072 652e  ECIMAL_REC = re.
-00000860: 636f 6d70 696c 6528 225c 5c64 2b5c 5c2e  compile("\\d+\\.
-00000870: 5c5c 642b 5c5c 2e5c 5c64 2b24 2229 0a0a  \\d+\\.\\d+$")..
-00000880: 434c 4153 5352 4546 203d 2022 636c 6173  CLASSREF = "clas
-00000890: 7372 6566 220a 0a53 5459 4c45 5f58 5041  sref"..STYLE_XPA
-000008a0: 5448 203d 2022 2f68 746d 6c2f 6865 6164  TH = "/html/head
-000008b0: 2f73 7479 6c65 220a 0a22 2222 0a4e 4f54  /style"..""".NOT
-000008c0: 452e 2074 6865 2075 7365 206f 6620 636c  E. the use of cl
-000008d0: 6173 736e 616d 652c 2063 6c61 7373 7265  assname, classre
-000008e0: 6620 616e 6420 7369 6d69 6c61 7220 6973  f and similar is
-000008f0: 2069 6e63 6f6e 7369 7374 656e 742e 2057   inconsistent. W
-00000900: 6520 7761 6e74 2074 6f20 6861 7665 3a0a  e want to have:.
-00000910: 7331 2020 746f 206d 6561 6e20 636c 6173  s1  to mean clas
-00000920: 7320 6e61 6d65 2028 636c 6173 736e 616d  s name (classnam
-00000930: 6529 0a2e 7331 2074 6f20 6d65 616e 2061  e)..s1 to mean a
-00000940: 2072 6566 6572 656e 6365 2074 6f20 6120   reference to a 
-00000950: 636c 6173 736e 616d 6520 286f 6e6c 7920  classname (only 
-00000960: 7573 6564 2069 6e20 3c73 7479 6c65 3e20  used in <style> 
-00000970: 656c 656d 656e 7473 2062 7574 2069 6e76  elements but inv
-00000980: 6f6c 7665 6420 696e 2063 6f6e 7665 7273  olved in convers
-00000990: 696f 6e73 0a22 2222 0a0a 6c6f 6767 6572  ions."""..logger
-000009a0: 203d 206c 6f67 6769 6e67 2e67 6574 4c6f   = logging.getLo
-000009b0: 6767 6572 285f 5f66 696c 655f 5f29 0a0a  gger(__file__)..
-000009c0: 0a63 6c61 7373 2041 6d69 5370 616e 3a0a  .class AmiSpan:.
-000009d0: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-000009e0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-000009f0: 7365 6c66 2e74 6578 745f 7374 796c 6520  self.text_style 
-00000a00: 3d20 4e6f 6e65 0a20 2020 2020 2020 2073  = None.        s
-00000a10: 656c 662e 7374 7269 6e67 203d 2022 220a  elf.string = "".
-00000a20: 2020 2020 2020 2020 7365 6c66 2e78 7820          self.xx 
-00000a30: 3d20 5b5d 0a20 2020 2020 2020 2073 656c  = [].        sel
-00000a40: 662e 7830 203d 204e 6f6e 650a 2020 2020  f.x0 = None.    
-00000a50: 2020 2020 7365 6c66 2e78 3120 3d20 4e6f      self.x1 = No
-00000a60: 6e65 0a20 2020 2020 2020 2073 656c 662e  ne.        self.
-00000a70: 7930 203d 204e 6f6e 650a 2020 2020 2020  y0 = None.      
-00000a80: 2020 2320 7365 6c66 2e61 6476 203d 204e    # self.adv = N
-00000a90: 6f6e 650a 0a20 2020 2064 6566 2063 7265  one..    def cre
-00000aa0: 6174 655f 616e 645f 6164 645f 746f 2873  ate_and_add_to(s
-00000ab0: 656c 662c 2064 6976 293a 0a20 2020 2020  elf, div):.     
-00000ac0: 2020 2068 746d 6c5f 7370 616e 203d 204e     html_span = N
-00000ad0: 6f6e 650a 2020 2020 2020 2020 6966 2064  one.        if d
-00000ae0: 6976 2069 7320 6e6f 7420 4e6f 6e65 3a0a  iv is not None:.
-00000af0: 2020 2020 2020 2020 2020 2020 6874 6d6c              html
-00000b00: 5f73 7061 6e20 3d20 4554 2e53 7562 456c  _span = ET.SubEl
-00000b10: 656d 656e 7428 6469 762c 2048 5f53 5041  ement(div, H_SPA
-00000b20: 4e29 0a20 2020 2020 2020 2020 2020 2068  N).            h
-00000b30: 746d 6c5f 7370 616e 2e74 6578 7420 3d20  tml_span.text = 
-00000b40: 7365 6c66 2e73 7472 696e 670a 2020 2020  self.string.    
-00000b50: 2020 2020 2020 2020 4874 6d6c 5374 796c          HtmlStyl
-00000b60: 652e 7365 745f 7374 796c 6528 6874 6d6c  e.set_style(html
-00000b70: 5f73 7061 6e2c 2073 656c 662e 7465 7874  _span, self.text
-00000b80: 5f73 7479 6c65 2e63 7265 6174 655f 6373  _style.create_cs
-00000b90: 735f 7374 7269 6e67 2829 290a 2020 2020  s_string()).    
-00000ba0: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
-00000bb0: 656c 662e 7878 2920 3e20 303a 0a20 2020  elf.xx) > 0:.   
-00000bc0: 2020 2020 2020 2020 2020 2020 2068 746d               htm
-00000bd0: 6c5f 7370 616e 2e61 7474 7269 625b 585d  l_span.attrib[X]
-00000be0: 203d 2073 656c 662e 7878 5b30 5d0a 2020   = self.xx[0].  
-00000bf0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00000c00: 662e 7830 3a0a 2020 2020 2020 2020 2020  f.x0:.          
-00000c10: 2020 2020 2020 6874 6d6c 5f73 7061 6e2e        html_span.
-00000c20: 6174 7472 6962 5b58 305d 203d 2073 7472  attrib[X0] = str
-00000c30: 2873 656c 662e 7830 290a 2020 2020 2020  (self.x0).      
-00000c40: 2020 2020 2020 6966 2073 656c 662e 7831        if self.x1
-00000c50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00000c60: 2020 6874 6d6c 5f73 7061 6e2e 6174 7472    html_span.attr
-00000c70: 6962 5b58 315d 203d 2073 7472 2873 656c  ib[X1] = str(sel
-00000c80: 662e 7831 290a 2020 2020 2020 2020 2020  f.x1).          
-00000c90: 2020 6874 6d6c 5f73 7061 6e2e 6174 7472    html_span.attr
-00000ca0: 6962 5b59 5d20 3d20 7374 7228 7365 6c66  ib[Y] = str(self
-00000cb0: 2e79 3029 0a20 2020 2020 2020 2072 6574  .y0).        ret
-00000cc0: 7572 6e20 6874 6d6c 5f73 7061 6e0a 0a0a  urn html_span...
-00000cd0: 2320 7368 6f75 6c64 206d 6179 6265 2062  # should maybe b
-00000ce0: 6520 696e 2050 4446 0a63 6c61 7373 2050  e in PDF.class P
-00000cf0: 6167 6542 6f78 3a20 2023 2064 6566 696e  ageBox:  # defin
-00000d00: 6564 2062 7920 7064 666d 696e 6572 2049  ed by pdfminer I
-00000d10: 2074 6869 6e6b 0a0a 2020 2020 2222 220a   think..    """.
-00000d20: 3c62 723e 3c73 7061 6e20 7374 796c 653d  <br><span style=
-00000d30: 2270 6f73 6974 696f 6e3a 6162 736f 6c75  "position:absolu
-00000d40: 7465 3b20 626f 7264 6572 3a20 6772 6179  te; border: gray
-00000d50: 2031 7078 2073 6f6c 6964 3b20 6c65 6674   1px solid; left
-00000d60: 3a30 7078 3b20 746f 703a 3934 3170 783b  :0px; top:941px;
-00000d70: 2077 6964 7468 3a35 3935 7078 3b20 6865   width:595px; he
-00000d80: 6967 6874 3a38 3431 7078 3b22 3e3c 2f73  ight:841px;"></s
-00000d90: 7061 6e3e 0a3c 6469 7620 7374 796c 653d  pan>.<div style=
-00000da0: 2270 6f73 6974 696f 6e3a 6162 736f 6c75  "position:absolu
-00000db0: 7465 3b20 746f 703a 3934 3170 783b 223e  te; top:941px;">
-00000dc0: 3c61 206e 616d 653d 2232 223e 5061 6765  <a name="2">Page
-00000dd0: 2032 3c2f 613e 3c2f 6469 763e 0a0a 666f   2</a></div>..fo
-00000de0: 7220 4950 4343 2074 6f70 2850 6167 6531  r IPCC top(Page1
-00000df0: 2920 3d20 3530 0a74 6f70 2850 6167 656e  ) = 50.top(Pagen
-00000e00: 2920 3d20 3530 202b 2028 6e20 2d20 3129  ) = 50 + (n - 1)
-00000e10: 202a 2028 3834 3120 2b20 3437 290a 0a20   * (841 + 47).. 
-00000e20: 2020 2022 2222 0a0a 2020 2020 6465 6620     """..    def 
-00000e30: 5f5f 696e 6974 5f5f 2873 656c 662c 2063  __init__(self, c
-00000e40: 7373 5f73 7479 6c65 3d4e 6f6e 6529 3a0a  ss_style=None):.
-00000e50: 2020 2020 2020 2020 7365 6c66 2e63 7373          self.css
-00000e60: 5f73 7479 6c65 203d 2063 7373 5f73 7479  _style = css_sty
-00000e70: 6c65 0a20 2020 2020 2020 2073 656c 662e  le.        self.
-00000e80: 6262 6f78 203d 2042 426f 7828 2920 2023  bbox = BBox()  #
-00000e90: 2075 6e69 6e69 7469 616c 6973 6564 0a20   uninitialised. 
-00000ea0: 2020 2020 2020 2069 6620 7365 6c66 2e63         if self.c
-00000eb0: 7373 5f73 7479 6c65 3a0a 2020 2020 2020  ss_style:.      
-00000ec0: 2020 2020 2020 746f 7020 3d20 7365 6c66        top = self
-00000ed0: 2e63 7373 5f73 7479 6c65 2e74 6f70 0a20  .css_style.top. 
-00000ee0: 2020 2020 2020 2020 2020 206c 6566 7420             left 
-00000ef0: 3d20 7365 6c66 2e63 7373 5f73 7479 6c65  = self.css_style
-00000f00: 2e6c 6566 740a 2020 2020 2020 2020 2020  .left.          
-00000f10: 2020 7769 6474 6820 3d20 7365 6c66 2e63    width = self.c
-00000f20: 7373 5f73 7479 6c65 2e77 6964 7468 0a20  ss_style.width. 
-00000f30: 2020 2020 2020 2020 2020 2068 6569 6768             heigh
-00000f40: 7420 3d20 7365 6c66 2e63 7373 5f73 7479  t = self.css_sty
-00000f50: 6c65 2e68 6569 6768 740a 2020 2020 2020  le.height.      
-00000f60: 2020 2020 2020 7365 6c66 2e62 626f 782e        self.bbox.
-00000f70: 7879 5f72 616e 6765 7320 3d20 5b5b 6c65  xy_ranges = [[le
-00000f80: 6674 2c20 6c65 6674 202b 2077 6964 7468  ft, left + width
-00000f90: 5d2c 205b 746f 702c 2074 6f70 202b 2068  ], [top, top + h
-00000fa0: 6569 6768 745d 5d0a 2020 2020 2020 2020  eight]].        
-00000fb0: 7365 6c66 2e65 6c65 6d20 3d20 4e6f 6e65  self.elem = None
-00000fc0: 0a20 2020 2020 2020 2073 656c 662e 696e  .        self.in
-00000fd0: 745f 6e75 6d62 6572 203d 204e 6f6e 6520  t_number = None 
-00000fe0: 2023 2070 6466 706c 756d 6265 7220 696e   # pdfplumber in
-00000ff0: 7465 6765 7220 7061 6765 2028 312d 6261  teger page (1-ba
-00001000: 7365 6429 0a20 2020 2020 2020 2073 656c  sed).        sel
-00001010: 662e 705f 6e75 6d5f 7374 7220 3d20 4e6f  f.p_num_str = No
-00001020: 6e65 2020 2320 7064 6670 6c75 6d62 6572  ne  # pdfplumber
-00001030: 2022 5061 6765 2031 3222 0a0a 2020 2020   "Page 12"..    
-00001040: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
-00001050: 6620 7061 6765 5f6e 756d 6265 7228 7365  f page_number(se
-00001060: 6c66 293a 0a20 2020 2020 2020 2069 6620  lf):.        if 
-00001070: 6e6f 7420 7365 6c66 2e69 6e74 5f6e 756d  not self.int_num
-00001080: 6265 723a 0a20 2020 2020 2020 2020 2020  ber:.           
-00001090: 2073 656c 662e 696e 745f 6e75 6d62 6572   self.int_number
-000010a0: 203d 204e 6f6e 6520 6966 2073 656c 662e   = None if self.
-000010b0: 656c 656d 2069 7320 4e6f 6e65 2065 6c73  elem is None els
-000010c0: 6520 5061 6765 426f 782e 6578 7472 6163  e PageBox.extrac
-000010d0: 745f 7061 6765 5f6e 756d 6265 725f 6672  t_page_number_fr
-000010e0: 6f6d 5f70 6466 5f68 746d 6c28 7365 6c66  om_pdf_html(self
-000010f0: 2e65 6c65 6d29 0a20 2020 2020 2020 2072  .elem).        r
-00001100: 6574 7572 6e20 7365 6c66 2e69 6e74 5f6e  eturn self.int_n
-00001110: 756d 6265 720a 0a20 2020 2040 636c 6173  umber..    @clas
-00001120: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
-00001130: 6578 7472 6163 745f 7061 6765 5f6e 756d  extract_page_num
-00001140: 6265 725f 6672 6f6d 5f70 6466 5f68 746d  ber_from_pdf_htm
-00001150: 6c28 636c 732c 2065 6c65 6d29 3a0a 2020  l(cls, elem):.  
-00001160: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00001170: 2020 736f 6d65 2065 6c65 6d65 6e74 7320    some elements 
-00001180: 3f73 7061 6e73 2920 6672 6f6d 2070 6466  ?spans) from pdf
-00001190: 2070 6172 7369 6e67 2068 6176 6520 7468   parsing have th
-000011a0: 6520 666f 726d 3a0a 2020 2020 2020 2020  e form:.        
-000011b0: 3c64 6976 202e 2e2e 3e3c 6120 6e61 6d65  <div ...><a name
-000011c0: 3d22 3222 3e50 6167 6520 323c 2f61 3e0a  ="2">Page 2</a>.
-000011d0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-000011e0: 656c 656d 3a20 636f 6e74 6169 6e73 2070  elem: contains p
-000011f0: 6167 6520 6e75 6d62 6572 0a20 2020 2020  age number.     
-00001200: 2020 203a 7265 7475 726e 3a20 7061 6765     :return: page
-00001210: 206e 756d 6265 7220 6f72 206e 6f6e 650a   number or none.
+00000060: 7322 2222 0a69 6d70 6f72 7420 6172 6770  s""".import argp
+00000070: 6172 7365 0a69 6d70 6f72 7420 636f 7079  arse.import copy
+00000080: 0a69 6d70 6f72 7420 6c6f 6767 696e 670a  .import logging.
+00000090: 696d 706f 7274 2072 650a 696d 706f 7274  import re.import
+000000a0: 2073 7973 0a69 6d70 6f72 7420 7469 6d65   sys.import time
+000000b0: 0a66 726f 6d20 636f 6c6c 6563 7469 6f6e  .from collection
+000000c0: 7320 696d 706f 7274 2064 6566 6175 6c74  s import default
+000000d0: 6469 6374 2c20 436f 756e 7465 720a 6672  dict, Counter.fr
+000000e0: 6f6d 2065 6e75 6d20 696d 706f 7274 2045  om enum import E
+000000f0: 6e75 6d0a 6672 6f6d 2069 6f20 696d 706f  num.from io impo
+00000100: 7274 2053 7472 696e 6749 4f0a 6672 6f6d  rt StringIO.from
+00000110: 2070 6174 686c 6962 2069 6d70 6f72 7420   pathlib import 
+00000120: 5061 7468 0a66 726f 6d20 7070 7269 6e74  Path.from pprint
+00000130: 2069 6d70 6f72 7420 7070 7269 6e74 0a0a   import pprint..
+00000140: 696d 706f 7274 206e 756d 7079 2061 7320  import numpy as 
+00000150: 6e70 0a69 6d70 6f72 7420 6c78 6d6c 2e65  np.import lxml.e
+00000160: 7472 6565 2061 7320 4554 0a66 726f 6d20  tree as ET.from 
+00000170: 6c78 6d6c 2e65 7472 6565 2069 6d70 6f72  lxml.etree impor
+00000180: 7420 456c 656d 656e 742c 205f 456c 656d  t Element, _Elem
+00000190: 656e 742c 205f 456c 656d 656e 7454 7265  ent, _ElementTre
+000001a0: 650a 6672 6f6d 206c 786d 6c2e 6874 6d6c  e.from lxml.html
+000001b0: 2069 6d70 6f72 7420 4854 4d4c 5061 7273   import HTMLPars
+000001c0: 6572 0a66 726f 6d20 736b 6c65 6172 6e2e  er.from sklearn.
+000001d0: 6c69 6e65 6172 5f6d 6f64 656c 2069 6d70  linear_model imp
+000001e0: 6f72 7420 4c69 6e65 6172 5265 6772 6573  ort LinearRegres
+000001f0: 7369 6f6e 0a0a 2320 6c6f 6361 6c0a 6672  sion..# local.fr
+00000200: 6f6d 2061 6d69 6c69 622e 6262 6f78 2069  om amilib.bbox i
+00000210: 6d70 6f72 7420 4242 6f78 0a66 726f 6d20  mport BBox.from 
+00000220: 616d 696c 6962 2e75 7469 6c20 696d 706f  amilib.util impo
+00000230: 7274 2053 5363 7269 7074 2c20 4162 7374  rt SScript, Abst
+00000240: 7261 6374 4172 6773 2c20 5574 696c 2c20  ractArgs, Util, 
+00000250: 416d 694c 6f67 6765 720a 6672 6f6d 2061  AmiLogger.from a
+00000260: 6d69 6c69 622e 786d 6c5f 6c69 6220 696d  milib.xml_lib im
+00000270: 706f 7274 2058 6d6c 4c69 622c 2048 746d  port XmlLib, Htm
+00000280: 6c4c 6962 0a0a 2320 6e6f 2074 7279 2d63  lLib..# no try-c
+00000290: 6174 6368 2069 6d70 6f72 7473 0a0a 6c6f  atch imports..lo
+000002a0: 6767 6572 203d 2041 6d69 4c6f 6767 6572  gger = AmiLogger
+000002b0: 2e63 7265 6174 655f 6e61 6d65 645f 6c6f  .create_named_lo
+000002c0: 6767 6572 285f 5f66 696c 655f 5f29 0a0a  gger(__file__)..
+000002d0: 2320 4854 4d4c 2065 6c65 6d65 6e74 730a  # HTML elements.
+000002e0: 485f 4854 4d4c 203d 2022 6874 6d6c 220a  H_HTML = "html".
+000002f0: 485f 4845 4144 203d 2022 6865 6164 220a  H_HEAD = "head".
+00000300: 485f 4d45 5441 203d 2022 6d65 7461 220a  H_META = "meta".
+00000310: 485f 5343 5249 5054 203d 2022 7363 7269  H_SCRIPT = "scri
+00000320: 7074 220a 485f 5354 594c 4520 3d20 2273  pt".H_STYLE = "s
+00000330: 7479 6c65 220a 485f 424f 4459 203d 2022  tyle".H_BODY = "
+00000340: 626f 6479 220a 485f 5441 424c 4520 3d20  body".H_TABLE = 
+00000350: 2274 6162 6c65 220a 485f 5448 4541 4420  "table".H_THEAD 
+00000360: 3d20 2274 6865 6164 220a 485f 5449 544c  = "thead".H_TITL
+00000370: 4520 3d20 2274 6974 6c65 220a 485f 5442  E = "title".H_TB
+00000380: 4f44 5920 3d20 2274 626f 6479 220a 485f  ODY = "tbody".H_
+00000390: 5452 203d 2022 7472 220a 485f 5448 203d  TR = "tr".H_TH =
+000003a0: 2022 7468 220a 485f 5444 203d 2022 7464   "th".H_TD = "td
+000003b0: 220a 485f 4449 5620 3d20 2264 6976 220a  ".H_DIV = "div".
+000003c0: 485f 5350 414e 203d 2022 7370 616e 220a  H_SPAN = "span".
+000003d0: 485f 554c 203d 2022 756c 220a 485f 4c49  H_UL = "ul".H_LI
+000003e0: 203d 2022 6c69 220a 485f 4120 3d20 2261   = "li".H_A = "a
+000003f0: 220a 485f 4220 3d20 2262 220a 485f 5020  ".H_B = "b".H_P 
+00000400: 3d20 2270 220a 0a58 203d 2022 7822 0a59  = "p"..X = "x".Y
+00000410: 203d 2022 7922 0a58 3020 3d20 2278 3022   = "y".X0 = "x0"
+00000420: 0a58 3120 3d20 2278 3122 0a0a 2320 4854  .X1 = "x1"..# HT
+00000430: 4d4c 2061 7474 7269 6275 7465 730a 415f  ML attributes.A_
+00000440: 434c 4153 5320 3d20 2263 6c61 7373 220a  CLASS = "class".
+00000450: 415f 4852 4546 203d 2022 6872 6566 220a  A_HREF = "href".
+00000460: 415f 4944 203d 2022 6964 220a 415f 4e41  A_ID = "id".A_NA
+00000470: 4d45 203d 2022 6e61 6d65 220a 415f 5354  ME = "name".A_ST
+00000480: 594c 4520 3d20 2273 7479 6c65 220a 415f  YLE = "style".A_
+00000490: 5445 524d 203d 2022 7465 726d 220a 415f  TERM = "term".A_
+000004a0: 5449 544c 4520 3d20 2274 6974 6c65 220a  TITLE = "title".
+000004b0: 0a58 5f50 5245 4345 4449 4e47 203d 2022  .X_PRECEDING = "
+000004c0: 7072 6563 6564 696e 6722 0a0a 2320 7374  preceding"..# st
+000004d0: 796c 6520 6275 6e64 6c65 0a53 5459 4c45  yle bundle.STYLE
+000004e0: 203d 2022 7374 796c 6522 0a49 5441 4c49   = "style".ITALI
+000004f0: 4320 3d20 2269 7461 6c69 6322 0a42 4f4c  C = "italic".BOL
+00000500: 4420 3d20 2262 6f6c 6422 0a54 494d 4553  D = "bold".TIMES
+00000510: 203d 2022 7469 6d65 7322 0a43 414c 4942   = "times".CALIB
+00000520: 5249 203d 2022 6361 6c69 6272 6922 0a46  RI = "calibri".F
+00000530: 4f4e 545f 4641 4d49 4c49 4553 203d 205b  ONT_FAMILIES = [
+00000540: 5449 4d45 532c 2043 414c 4942 5249 5d0a  TIMES, CALIBRI].
+00000550: 0a23 2073 7479 6c65 2061 7474 7269 6275  .# style attribu
+00000560: 7465 730a 464f 4e54 5f53 495a 4520 3d20  tes.FONT_SIZE = 
+00000570: 2266 6f6e 742d 7369 7a65 220a 464f 4e54  "font-size".FONT
+00000580: 5f53 5459 4c45 203d 2022 666f 6e74 2d73  _STYLE = "font-s
+00000590: 7479 6c65 220a 464f 4e54 5f57 4549 4748  tyle".FONT_WEIGH
+000005a0: 5420 3d20 2266 6f6e 742d 7765 6967 6874  T = "font-weight
+000005b0: 220a 464f 4e54 5f46 414d 494c 5920 3d20  ".FONT_FAMILY = 
+000005c0: 2266 6f6e 742d 6661 6d69 6c79 220a 464f  "font-family".FO
+000005d0: 4e54 5f46 4f4e 5420 3d20 2266 6f6e 7422  NT_FONT = "font"
+000005e0: 0a46 4f4e 545f 4e41 4d45 203d 2022 666f  .FONT_NAME = "fo
+000005f0: 6e74 2d6e 616d 6522 0a46 4f4e 545f 5354  nt-name".FONT_ST
+00000600: 5245 5443 4845 4420 3d20 2266 6f6e 742d  RETCHED = "font-
+00000610: 7374 7265 7463 6865 6422 0a46 494c 4c20  stretched".FILL 
+00000620: 3d20 2266 696c 6c22 0a53 5452 4f4b 4520  = "fill".STROKE 
+00000630: 3d20 2273 7472 6f6b 6522 0a0a 2320 6368  = "stroke"..# ch
+00000640: 6172 6163 7465 7220 7072 6f70 6572 7469  aracter properti
+00000650: 6573 0a50 5f46 4f4e 544e 414d 4520 3d20  es.P_FONTNAME = 
+00000660: 2266 6f6e 746e 616d 6522 0a50 5f48 4549  "fontname".P_HEI
+00000670: 4748 5420 3d20 2268 6569 6768 7422 0a50  GHT = "height".P
+00000680: 5f53 5452 4f4b 494e 475f 434f 4c4f 5220  _STROKING_COLOR 
+00000690: 3d20 2273 7472 6f6b 696e 675f 636f 6c6f  = "stroking_colo
+000006a0: 7222 0a50 5f4e 4f4e 5f53 5452 4f4b 494e  r".P_NON_STROKIN
+000006b0: 475f 434f 4c4f 5220 3d20 226e 6f6e 5f73  G_COLOR = "non_s
+000006c0: 7472 6f6b 696e 675f 636f 6c6f 7222 0a0a  troking_color"..
+000006d0: 505f 5830 203d 2022 7830 220a 505f 5831  P_X0 = "x0".P_X1
+000006e0: 203d 2022 7831 220a 505f 5930 203d 2022   = "x1".P_Y0 = "
+000006f0: 7930 220a 505f 5931 203d 2022 7931 220a  y0".P_Y1 = "y1".
+00000700: 505f 5445 5854 203d 2022 7465 7874 220a  P_TEXT = "text".
+00000710: 0a23 2055 6e77 616e 7465 6420 7365 6374  .# Unwanted sect
+00000720: 696f 6e73 0a55 5f58 5041 5448 203d 2022  ions.U_XPATH = "
+00000730: 7870 6174 6822 0a55 5f52 4547 4558 203d  xpath".U_REGEX =
+00000740: 2022 7265 6765 7822 0a0a 5354 594c 4553   "regex"..STYLES
+00000750: 203d 205b 0a20 2020 2046 4f4e 545f 5349   = [.    FONT_SI
+00000760: 5a45 2c0a 2020 2020 464f 4e54 5f53 5459  ZE,.    FONT_STY
+00000770: 4c45 2c0a 2020 2020 464f 4e54 5f46 414d  LE,.    FONT_FAM
+00000780: 494c 592c 0a20 2020 2046 4f4e 545f 5745  ILY,.    FONT_WE
+00000790: 4947 4854 2c0a 2020 2020 4649 4c4c 2c0a  IGHT,.    FILL,.
+000007a0: 2020 2020 5354 524f 4b45 2c0a 5d0a 0a23      STROKE,.]..#
+000007b0: 2043 5353 0a53 5f42 4f52 4445 5220 3d20   CSS.S_BORDER = 
+000007c0: 2262 6f72 6465 7222 0a53 5f50 4f53 4954  "border".S_POSIT
+000007d0: 494f 4e20 3d20 2270 6f73 6974 696f 6e22  ION = "position"
+000007e0: 0a53 5f57 4944 5448 203d 2022 7769 6474  .S_WIDTH = "widt
+000007f0: 6822 0a53 5f57 5249 5449 4e47 5f4d 4f44  h".S_WRITING_MOD
+00000800: 4520 3d20 2277 7269 7469 6e67 2d6d 6f64  E = "writing-mod
+00000810: 6522 0a0a 5f55 5446 3820 3d20 2255 5446  e".._UTF8 = "UTF
+00000820: 2d38 220a 0a23 2063 6f6d 6d61 6e64 6c69  -8"..# commandli
+00000830: 6e65 0a41 4e4e 4f54 4154 4520 3d20 2261  ne.ANNOTATE = "a
+00000840: 6e6e 6f74 6174 6522 0a43 4f4c 4f52 203d  nnotate".COLOR =
+00000850: 2022 636f 6c6f 7222 0a44 4943 5420 3d20   "color".DICT = 
+00000860: 2264 6963 7422 0a49 4e50 4154 4820 3d20  "dict".INPATH = 
+00000870: 2269 6e70 6174 6822 0a4f 5554 4449 5220  "inpath".OUTDIR 
+00000880: 3d20 226f 7574 6469 7222 0a4f 5554 5041  = "outdir".OUTPA
+00000890: 5448 203d 2022 6f75 7470 6174 6822 0a0a  TH = "outpath"..
+000008a0: 4348 4150 5f54 4f50 5f52 4543 203d 2072  CHAP_TOP_REC = r
+000008b0: 652e 636f 6d70 696c 6528 225f 5f4e 4f54  e.compile("__NOT
+000008c0: 5f5f 5945 545f 5f49 4d50 4c45 4d45 4e54  __YET__IMPLEMENT
+000008d0: 4544 5f5f 2229 0a53 4543 5449 4f4e 535f  ED__").SECTIONS_
+000008e0: 4445 4349 4d41 4c5f 5245 4320 3d20 7265  DECIMAL_REC = re
+000008f0: 2e63 6f6d 7069 6c65 2822 5c5c 642b 5c5c  .compile("\\d+\\
+00000900: 2e5c 5c64 2b24 2229 0a53 5542 5345 4354  .\\d+$").SUBSECT
+00000910: 535f 4445 4349 4d41 4c5f 5245 4320 3d20  S_DECIMAL_REC = 
+00000920: 7265 2e63 6f6d 7069 6c65 2822 5c5c 642b  re.compile("\\d+
+00000930: 5c5c 2e5c 5c64 2b5c 5c2e 5c5c 642b 2422  \\.\\d+\\.\\d+$"
+00000940: 290a 0a43 4c41 5353 5245 4620 3d20 2263  )..CLASSREF = "c
+00000950: 6c61 7373 7265 6622 0a0a 5354 594c 455f  lassref"..STYLE_
+00000960: 5850 4154 4820 3d20 222f 6874 6d6c 2f68  XPATH = "/html/h
+00000970: 6561 642f 7374 796c 6522 0a0a 2222 220a  ead/style"..""".
+00000980: 4e4f 5445 2e20 7468 6520 7573 6520 6f66  NOTE. the use of
+00000990: 2063 6c61 7373 6e61 6d65 2c20 636c 6173   classname, clas
+000009a0: 7372 6566 2061 6e64 2073 696d 696c 6172  sref and similar
+000009b0: 2069 7320 696e 636f 6e73 6973 7465 6e74   is inconsistent
+000009c0: 2e20 5765 2077 616e 7420 746f 2068 6176  . We want to hav
+000009d0: 653a 0a73 3120 2074 6f20 6d65 616e 2063  e:.s1  to mean c
+000009e0: 6c61 7373 206e 616d 6520 2863 6c61 7373  lass name (class
+000009f0: 6e61 6d65 290a 2e73 3120 746f 206d 6561  name)..s1 to mea
+00000a00: 6e20 6120 7265 6665 7265 6e63 6520 746f  n a reference to
+00000a10: 2061 2063 6c61 7373 6e61 6d65 2028 6f6e   a classname (on
+00000a20: 6c79 2075 7365 6420 696e 203c 7374 796c  ly used in <styl
+00000a30: 653e 2065 6c65 6d65 6e74 7320 6275 7420  e> elements but 
+00000a40: 696e 766f 6c76 6564 2069 6e20 636f 6e76  involved in conv
+00000a50: 6572 7369 6f6e 730a 2222 220a 0a6c 6f67  ersions."""..log
+00000a60: 6765 7220 3d20 6c6f 6767 696e 672e 6765  ger = logging.ge
+00000a70: 744c 6f67 6765 7228 5f5f 6669 6c65 5f5f  tLogger(__file__
+00000a80: 290a 0a63 6c61 7373 2041 6d69 5370 616e  )..class AmiSpan
+00000a90: 3a0a 2020 2020 6465 6620 5f5f 696e 6974  :.    def __init
+00000aa0: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
+00000ab0: 2020 7365 6c66 2e74 6578 745f 7374 796c    self.text_styl
+00000ac0: 6520 3d20 4e6f 6e65 0a20 2020 2020 2020  e = None.       
+00000ad0: 2073 656c 662e 7374 7269 6e67 203d 2022   self.string = "
+00000ae0: 220a 2020 2020 2020 2020 7365 6c66 2e78  ".        self.x
+00000af0: 7820 3d20 5b5d 0a20 2020 2020 2020 2073  x = [].        s
+00000b00: 656c 662e 7830 203d 204e 6f6e 650a 2020  elf.x0 = None.  
+00000b10: 2020 2020 2020 7365 6c66 2e78 3120 3d20        self.x1 = 
+00000b20: 4e6f 6e65 0a20 2020 2020 2020 2073 656c  None.        sel
+00000b30: 662e 7930 203d 204e 6f6e 650a 2020 2020  f.y0 = None.    
+00000b40: 2020 2020 2320 7365 6c66 2e61 6476 203d      # self.adv =
+00000b50: 204e 6f6e 650a 0a20 2020 2064 6566 2063   None..    def c
+00000b60: 7265 6174 655f 616e 645f 6164 645f 746f  reate_and_add_to
+00000b70: 2873 656c 662c 2064 6976 293a 0a20 2020  (self, div):.   
+00000b80: 2020 2020 2068 746d 6c5f 7370 616e 203d       html_span =
+00000b90: 204e 6f6e 650a 2020 2020 2020 2020 6966   None.        if
+00000ba0: 2064 6976 2069 7320 6e6f 7420 4e6f 6e65   div is not None
+00000bb0: 3a0a 2020 2020 2020 2020 2020 2020 6874  :.            ht
+00000bc0: 6d6c 5f73 7061 6e20 3d20 4554 2e53 7562  ml_span = ET.Sub
+00000bd0: 456c 656d 656e 7428 6469 762c 2048 5f53  Element(div, H_S
+00000be0: 5041 4e29 0a20 2020 2020 2020 2020 2020  PAN).           
+00000bf0: 2068 746d 6c5f 7370 616e 2e74 6578 7420   html_span.text 
+00000c00: 3d20 7365 6c66 2e73 7472 696e 670a 2020  = self.string.  
+00000c10: 2020 2020 2020 2020 2020 4874 6d6c 5374            HtmlSt
+00000c20: 796c 652e 7365 745f 7374 796c 6528 6874  yle.set_style(ht
+00000c30: 6d6c 5f73 7061 6e2c 2073 656c 662e 7465  ml_span, self.te
+00000c40: 7874 5f73 7479 6c65 2e63 7265 6174 655f  xt_style.create_
+00000c50: 6373 735f 7374 7269 6e67 2829 290a 2020  css_string()).  
+00000c60: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00000c70: 2873 656c 662e 7878 2920 3e20 303a 0a20  (self.xx) > 0:. 
+00000c80: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+00000c90: 746d 6c5f 7370 616e 2e61 7474 7269 625b  tml_span.attrib[
+00000ca0: 585d 203d 2073 656c 662e 7878 5b30 5d0a  X] = self.xx[0].
+00000cb0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00000cc0: 656c 662e 7830 3a0a 2020 2020 2020 2020  elf.x0:.        
+00000cd0: 2020 2020 2020 2020 6874 6d6c 5f73 7061          html_spa
+00000ce0: 6e2e 6174 7472 6962 5b58 305d 203d 2073  n.attrib[X0] = s
+00000cf0: 7472 2873 656c 662e 7830 290a 2020 2020  tr(self.x0).    
+00000d00: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00000d10: 7831 3a0a 2020 2020 2020 2020 2020 2020  x1:.            
+00000d20: 2020 2020 6874 6d6c 5f73 7061 6e2e 6174      html_span.at
+00000d30: 7472 6962 5b58 315d 203d 2073 7472 2873  trib[X1] = str(s
+00000d40: 656c 662e 7831 290a 2020 2020 2020 2020  elf.x1).        
+00000d50: 2020 2020 6874 6d6c 5f73 7061 6e2e 6174      html_span.at
+00000d60: 7472 6962 5b59 5d20 3d20 7374 7228 7365  trib[Y] = str(se
+00000d70: 6c66 2e79 3029 0a20 2020 2020 2020 2072  lf.y0).        r
+00000d80: 6574 7572 6e20 6874 6d6c 5f73 7061 6e0a  eturn html_span.
+00000d90: 0a0a 2320 7368 6f75 6c64 206d 6179 6265  ..# should maybe
+00000da0: 2062 6520 696e 2050 4446 0a63 6c61 7373   be in PDF.class
+00000db0: 2050 6167 6542 6f78 3a20 2023 2064 6566   PageBox:  # def
+00000dc0: 696e 6564 2062 7920 7064 666d 696e 6572  ined by pdfminer
+00000dd0: 2049 2074 6869 6e6b 0a0a 2020 2020 2222   I think..    ""
+00000de0: 220a 3c62 723e 3c73 7061 6e20 7374 796c  ".<br><span styl
+00000df0: 653d 2270 6f73 6974 696f 6e3a 6162 736f  e="position:abso
+00000e00: 6c75 7465 3b20 626f 7264 6572 3a20 6772  lute; border: gr
+00000e10: 6179 2031 7078 2073 6f6c 6964 3b20 6c65  ay 1px solid; le
+00000e20: 6674 3a30 7078 3b20 746f 703a 3934 3170  ft:0px; top:941p
+00000e30: 783b 2077 6964 7468 3a35 3935 7078 3b20  x; width:595px; 
+00000e40: 6865 6967 6874 3a38 3431 7078 3b22 3e3c  height:841px;"><
+00000e50: 2f73 7061 6e3e 0a3c 6469 7620 7374 796c  /span>.<div styl
+00000e60: 653d 2270 6f73 6974 696f 6e3a 6162 736f  e="position:abso
+00000e70: 6c75 7465 3b20 746f 703a 3934 3170 783b  lute; top:941px;
+00000e80: 223e 3c61 206e 616d 653d 2232 223e 5061  "><a name="2">Pa
+00000e90: 6765 2032 3c2f 613e 3c2f 6469 763e 0a0a  ge 2</a></div>..
+00000ea0: 666f 7220 4950 4343 2074 6f70 2850 6167  for IPCC top(Pag
+00000eb0: 6531 2920 3d20 3530 0a74 6f70 2850 6167  e1) = 50.top(Pag
+00000ec0: 656e 2920 3d20 3530 202b 2028 6e20 2d20  en) = 50 + (n - 
+00000ed0: 3129 202a 2028 3834 3120 2b20 3437 290a  1) * (841 + 47).
+00000ee0: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
+00000ef0: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+00000f00: 2063 7373 5f73 7479 6c65 3d4e 6f6e 6529   css_style=None)
+00000f10: 3a0a 2020 2020 2020 2020 7365 6c66 2e63  :.        self.c
+00000f20: 7373 5f73 7479 6c65 203d 2063 7373 5f73  ss_style = css_s
+00000f30: 7479 6c65 0a20 2020 2020 2020 2073 656c  tyle.        sel
+00000f40: 662e 6262 6f78 203d 2042 426f 7828 2920  f.bbox = BBox() 
+00000f50: 2023 2075 6e69 6e69 7469 616c 6973 6564   # uninitialised
+00000f60: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00000f70: 2e63 7373 5f73 7479 6c65 3a0a 2020 2020  .css_style:.    
+00000f80: 2020 2020 2020 2020 746f 7020 3d20 7365          top = se
+00000f90: 6c66 2e63 7373 5f73 7479 6c65 2e74 6f70  lf.css_style.top
+00000fa0: 0a20 2020 2020 2020 2020 2020 206c 6566  .            lef
+00000fb0: 7420 3d20 7365 6c66 2e63 7373 5f73 7479  t = self.css_sty
+00000fc0: 6c65 2e6c 6566 740a 2020 2020 2020 2020  le.left.        
+00000fd0: 2020 2020 7769 6474 6820 3d20 7365 6c66      width = self
+00000fe0: 2e63 7373 5f73 7479 6c65 2e77 6964 7468  .css_style.width
+00000ff0: 0a20 2020 2020 2020 2020 2020 2068 6569  .            hei
+00001000: 6768 7420 3d20 7365 6c66 2e63 7373 5f73  ght = self.css_s
+00001010: 7479 6c65 2e68 6569 6768 740a 2020 2020  tyle.height.    
+00001020: 2020 2020 2020 2020 7365 6c66 2e62 626f          self.bbo
+00001030: 782e 7879 5f72 616e 6765 7320 3d20 5b5b  x.xy_ranges = [[
+00001040: 6c65 6674 2c20 6c65 6674 202b 2077 6964  left, left + wid
+00001050: 7468 5d2c 205b 746f 702c 2074 6f70 202b  th], [top, top +
+00001060: 2068 6569 6768 745d 5d0a 2020 2020 2020   height]].      
+00001070: 2020 7365 6c66 2e65 6c65 6d20 3d20 4e6f    self.elem = No
+00001080: 6e65 0a20 2020 2020 2020 2073 656c 662e  ne.        self.
+00001090: 696e 745f 6e75 6d62 6572 203d 204e 6f6e  int_number = Non
+000010a0: 6520 2023 2070 6466 706c 756d 6265 7220  e  # pdfplumber 
+000010b0: 696e 7465 6765 7220 7061 6765 2028 312d  integer page (1-
+000010c0: 6261 7365 6429 0a20 2020 2020 2020 2073  based).        s
+000010d0: 656c 662e 705f 6e75 6d5f 7374 7220 3d20  elf.p_num_str = 
+000010e0: 4e6f 6e65 2020 2320 7064 6670 6c75 6d62  None  # pdfplumb
+000010f0: 6572 2022 5061 6765 2031 3222 0a0a 2020  er "Page 12"..  
+00001100: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
+00001110: 6465 6620 7061 6765 5f6e 756d 6265 7228  def page_number(
+00001120: 7365 6c66 293a 0a20 2020 2020 2020 2069  self):.        i
+00001130: 6620 6e6f 7420 7365 6c66 2e69 6e74 5f6e  f not self.int_n
+00001140: 756d 6265 723a 0a20 2020 2020 2020 2020  umber:.         
+00001150: 2020 2073 656c 662e 696e 745f 6e75 6d62     self.int_numb
+00001160: 6572 203d 204e 6f6e 6520 6966 2073 656c  er = None if sel
+00001170: 662e 656c 656d 2069 7320 4e6f 6e65 2065  f.elem is None e
+00001180: 6c73 6520 5061 6765 426f 782e 6578 7472  lse PageBox.extr
+00001190: 6163 745f 7061 6765 5f6e 756d 6265 725f  act_page_number_
+000011a0: 6672 6f6d 5f70 6466 5f68 746d 6c28 7365  from_pdf_html(se
+000011b0: 6c66 2e65 6c65 6d29 0a20 2020 2020 2020  lf.elem).       
+000011c0: 2072 6574 7572 6e20 7365 6c66 2e69 6e74   return self.int
+000011d0: 5f6e 756d 6265 720a 0a20 2020 2040 636c  _number..    @cl
+000011e0: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+000011f0: 6620 6578 7472 6163 745f 7061 6765 5f6e  f extract_page_n
+00001200: 756d 6265 725f 6672 6f6d 5f70 6466 5f68  umber_from_pdf_h
+00001210: 746d 6c28 636c 732c 2065 6c65 6d29 3a0a  tml(cls, elem):.
 00001220: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00001230: 2020 2020 6966 2065 6c65 6d20 6973 204e      if elem is N
-00001240: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00001250: 2072 6574 7572 6e20 4e6f 6e65 0a20 2020   return None.   
-00001260: 2020 2020 2078 7061 7468 7820 3d20 6622       xpathx = f"
-00001270: 2e2f 2f61 2f40 7b41 5f4e 414d 457d 220a  .//a/@{A_NAME}".
-00001280: 2020 2020 2020 2020 616e 616d 6520 3d20          aname = 
-00001290: 656c 656d 2e78 7061 7468 2878 7061 7468  elem.xpath(xpath
-000012a0: 7829 0a20 2020 2020 2020 2072 6574 7572  x).        retur
-000012b0: 6e20 616e 616d 650a 0a20 2020 2064 6566  n aname..    def
-000012c0: 2061 6464 5f73 7479 6c65 5f73 7061 6e5f   add_style_span_
-000012d0: 616e 645f 7061 6765 5f6e 756d 6265 7228  and_page_number(
-000012e0: 7365 6c66 2c20 656c 656d 293a 0a20 2020  self, elem):.   
-000012f0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00001300: 2061 6464 2073 7479 6c65 2073 7061 6e20   add style span 
-00001310: 2061 6e64 2061 6c73 6f20 6765 7420 7061   and also get pa
-00001320: 6765 6e75 6d62 6572 2066 726f 6d20 6e65  genumber from ne
-00001330: 7874 2065 6c65 6d65 6e74 0a0a 2020 2020  xt element..    
-00001340: 2020 2020 7479 7069 6361 6c20 7472 6169      typical trai
-00001350: 6c69 6e67 2065 6c65 6d65 6e74 0a20 2020  ling element.   
-00001360: 2020 2020 203c 6469 7620 7374 796c 653d       <div style=
-00001370: 2270 6f73 6974 696f 6e3a 6162 736f 6c75  "position:absolu
-00001380: 7465 3b20 746f 703a 3130 3735 3370 783b  te; top:10753px;
-00001390: 223e 3c61 206e 616d 653d 2231 3322 3e50  "><a name="13">P
-000013a0: 6167 6520 3133 3c2f 613e 3c2f 6469 763e  age 13</a></div>
-000013b0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000013c0: 2020 2020 2073 656c 662e 656c 656d 203d       self.elem =
-000013d0: 2065 6c65 6d0a 2020 2020 2020 2020 7061   elem.        pa
-000013e0: 6765 5f64 6976 203d 2065 6c65 6d2e 6765  ge_div = elem.ge
-000013f0: 746e 6578 7428 290a 2020 2020 2020 2020  tnext().        
-00001400: 6966 2070 6167 655f 6469 7620 6973 206e  if page_div is n
-00001410: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00001420: 2020 2020 206e 203d 2070 6167 655f 6469       n = page_di
-00001430: 762e 7870 6174 6828 6622 2e2f 612f 407b  v.xpath(f"./a/@{
-00001440: 415f 4e41 4d45 7d22 290a 2020 2020 2020  A_NAME}").      
-00001450: 2020 2020 2020 6e20 3d20 6e5b 305d 2069        n = n[0] i
-00001460: 6620 6c65 6e28 6e29 203d 3d20 3120 656c  f len(n) == 1 el
-00001470: 7365 204e 6f6e 650a 2020 2020 2020 2020  se None.        
-00001480: 2020 2020 6966 206e 3a0a 2020 2020 2020      if n:.      
-00001490: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
-000014a0: 6e74 5f6e 756d 6265 7220 3d20 696e 7428  nt_number = int(
-000014b0: 6e29 0a0a 2020 2020 2020 2020 2020 2020  n)..            
-000014c0: 7020 3d20 7061 6765 5f64 6976 2e78 7061  p = page_div.xpa
-000014d0: 7468 2866 222e 2f61 5b40 7b41 5f4e 414d  th(f"./a[@{A_NAM
-000014e0: 457d 2061 6e64 2063 6f6e 7461 696e 7328  E} and contains(
-000014f0: 2e2c 2027 5061 6765 2729 5d22 290a 2020  ., 'Page')]").  
-00001500: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-00001510: 5f6e 756d 5f73 7472 203d 2070 5b30 5d20  _num_str = p[0] 
-00001520: 6966 206c 656e 2870 2920 3d3d 2031 2065  if len(p) == 1 e
-00001530: 6c73 6520 4e6f 6e65 0a0a 0a63 6c61 7373  lse None...class
-00001540: 2048 746d 6c54 6964 793a 0a20 2020 2022   HtmlTidy:.    "
-00001550: 2222 666f 7220 7469 6479 696e 6720 5044  ""for tidying PD
-00001560: 4620 2f20 5356 472f 204f 4352 2070 6172  F / SVG/ OCR par
-00001570: 7369 6e67 0a20 2020 2074 616b 6573 2072  sing.    takes r
-00001580: 6177 2048 544d 4c20 2870 726f 6261 626c  aw HTML (probabl
-00001590: 7920 7363 6174 7465 7265 6420 776f 7264  y scattered word
-000015a0: 7320 6f72 206c 696e 6573 202c 2070 6f73  s or lines , pos
-000015b0: 7369 626c 7920 7769 7468 2063 6f6f 7264  sibly with coord
-000015c0: 696e 6174 6573 2061 6e64 2063 7265 6174  inates and creat
-000015d0: 6573 0a20 2020 2066 6c6f 7769 6e67 2073  es.    flowing s
-000015e0: 7479 6c65 6420 4854 4d4c 2077 6974 6820  tyled HTML with 
-000015f0: 7375 6273 6372 6970 7473 2c20 666f 6e74  subscripts, font
-00001600: 2073 7479 6c65 732c 2065 7463 2e0a 2020   styles, etc..  
-00001610: 2020 2222 220a 0a20 2020 204d 494e 5f50    """..    MIN_P
-00001620: 4147 455f 424f 585f 4845 4947 4854 203d  AGE_BOX_HEIGHT =
-00001630: 2033 3030 2020 2320 616c 6c6f 7773 2066   300  # allows f
-00001640: 6f72 206c 616e 6473 6361 7065 0a20 2020  or landscape.   
-00001650: 2048 4541 445f 454c 454d 535f 494e 5f58   HEAD_ELEMS_IN_X
-00001660: 5041 5448 203d 2066 227b 485f 4d45 5441  PATH = f"{H_META
-00001670: 7d20 7c20 7b48 5f54 4954 4c45 7d20 7c20  } | {H_TITLE} | 
-00001680: 7b48 5f53 4352 4950 547d 207c 207b 485f  {H_SCRIPT} | {H_
-00001690: 5354 594c 457d 220a 0a20 2020 2064 6566  STYLE}"..    def
-000016a0: 205f 5f69 6e69 745f 5f28 7365 6c66 293a   __init__(self):
-000016b0: 0a20 2020 2020 2020 2073 656c 662e 756e  .        self.un
-000016c0: 7761 6e74 6564 7320 3d20 5b5d 2020 2320  wanteds = []  # 
-000016d0: 6e6f 7420 7375 7265 2077 6861 7420 7468  not sure what th
-000016e0: 6973 2069 730a 2020 2020 2020 2020 7365  is is.        se
-000016f0: 6c66 2e65 6d70 7479 5f65 6c65 6d65 6e74  lf.empty_element
-00001700: 735f 746f 5f72 656d 6f76 6520 3d20 5b5d  s_to_remove = []
-00001710: 0a20 2020 2020 2020 2073 656c 662e 7374  .        self.st
-00001720: 796c 6573 5f74 6f5f 7265 6d6f 7665 203d  yles_to_remove =
-00001730: 205b 5d0a 2020 2020 2020 2020 7365 6c66   [].        self
-00001740: 2e64 6573 6365 6e64 616e 7473 5f74 6f5f  .descendants_to_
-00001750: 7265 6d6f 7665 203d 205b 5d0a 2020 2020  remove = [].    
-00001760: 2020 2020 7365 6c66 2e72 656d 6f76 655f      self.remove_
-00001770: 6c68 5f6c 696e 655f 6e75 6d62 6572 7320  lh_line_numbers 
-00001780: 3d20 5472 7565 0a20 2020 2020 2020 2073  = True.        s
-00001790: 656c 662e 7265 6d6f 7665 5f6c 6172 6765  elf.remove_large
-000017a0: 5f66 6f6e 7465 645f 656c 656d 656e 7473  _fonted_elements
-000017b0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-000017c0: 7365 6c66 2e73 7479 6c65 5f61 7474 7269  self.style_attri
-000017d0: 6275 7465 735f 746f 5f72 656d 6f76 6520  butes_to_remove 
-000017e0: 3d20 5b5d 0a20 2020 2020 2020 2073 656c  = [].        sel
-000017f0: 662e 6d61 726b 6572 5f78 7061 7468 203d  f.marker_xpath =
-00001800: 204e 6f6e 650a 2020 2020 2020 2020 7365   None.        se
-00001810: 6c66 2e73 7479 6c65 5f61 7474 7269 6275  lf.style_attribu
-00001820: 7465 735f 746f 5f72 656d 6f76 6520 3d20  tes_to_remove = 
-00001830: 5b5d 0a0a 2020 2020 2020 2020 7365 6c66  []..        self
-00001840: 2e61 6464 5f69 6420 3d20 5472 7565 0a20  .add_id = True. 
-00001850: 2020 2020 2020 2073 656c 662e 6865 6164         self.head
-00001860: 6572 203d 2038 300a 2020 2020 2020 2020  er = 80.        
-00001870: 7365 6c66 2e66 6f6f 7465 7220 3d20 3830  self.footer = 80
-00001880: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
-00001890: 6765 5f74 6f70 7320 3d20 4e6f 6e65 0a20  ge_tops = None. 
-000018a0: 2020 2020 2020 2073 656c 662e 7061 6765         self.page
-000018b0: 5f62 6f78 6573 203d 205b 5d0a 2020 2020  _boxes = [].    
-000018c0: 2020 2020 7365 6c66 2e72 6177 5f65 6c65      self.raw_ele
-000018d0: 6d20 3d20 4e6f 6e65 0a20 2020 2020 2020  m = None.       
-000018e0: 2073 656c 662e 6f75 7464 6972 203d 204e   self.outdir = N
-000018f0: 6f6e 650a 0a20 2020 2064 6566 2074 6964  one..    def tid
-00001900: 795f 666c 6f77 2873 656c 662c 2072 6177  y_flow(self, raw
-00001910: 5f68 746d 6c29 3a0a 2020 2020 2020 2020  _html):.        
-00001920: 2222 220a 2020 2020 2020 2020 4e65 6564  """.        Need
-00001930: 2074 6f20 6361 7074 7572 6520 7061 6765   to capture page
-00001940: 2069 6e66 6f72 6d61 7469 6f6e 2074 6f20   information to 
-00001950: 636f 6d70 7574 6520 7061 6765 2063 6f6f  compute page coo
-00001960: 7264 696e 6174 6573 2c20 6e6f 7420 646f  rdinates, not do
-00001970: 6375 6d65 6e74 2063 6f6f 7264 696e 6174  cument coordinat
-00001980: 6573 0a20 2020 2020 2020 2063 6f6e 7665  es.        conve
-00001990: 7274 7320 7261 7720 6874 6d6c 2074 6f20  rts raw html to 
-000019a0: 7469 6479 0a20 2020 2020 2020 2022 2222  tidy.        """
-000019b0: 0a0a 2020 2020 2020 2020 2320 544f 444f  ..        # TODO
-000019c0: 2063 6865 636b 2061 6e64 206d 6f76 6520   check and move 
-000019d0: 746f 2069 6e73 7461 6e63 6520 6f66 2048  to instance of H
-000019e0: 746d 6c54 6964 790a 0a20 2020 2020 2020  tmlTidy..       
-000019f0: 2069 6620 7261 775f 6874 6d6c 2069 7320   if raw_html is 
-00001a00: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00001a10: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00001a20: 6f72 2822 4e6f 2048 544d 4c22 290a 2020  or("No HTML").  
-00001a30: 2020 2020 2020 7261 775f 7472 6565 203d        raw_tree =
-00001a40: 2045 542e 7061 7273 6528 5374 7269 6e67   ET.parse(String
-00001a50: 494f 2872 6177 5f68 746d 6c29 2c20 4554  IO(raw_html), ET
-00001a60: 2e48 544d 4c50 6172 7365 7228 2929 0a20  .HTMLParser()). 
-00001a70: 2020 2020 2020 2073 656c 662e 7261 775f         self.raw_
-00001a80: 656c 656d 203d 2072 6177 5f74 7265 652e  elem = raw_tree.
-00001a90: 6765 7472 6f6f 7428 290a 2020 2020 2020  getroot().      
-00001aa0: 2020 7365 6c66 2e65 7874 7261 6374 5f70    self.extract_p
-00001ab0: 6167 655f 626f 7865 7328 290a 0a20 2020  age_boxes()..   
-00001ac0: 2020 2020 2073 656c 662e 6164 645f 656c       self.add_el
-00001ad0: 656d 656e 7428 7365 6c66 2e72 6177 5f65  ement(self.raw_e
-00001ae0: 6c65 6d29 0a0a 2020 2020 2020 2020 2320  lem)..        # 
-00001af0: 7468 6973 2069 7320 7365 7420 6279 2075  this is set by u
-00001b00: 7365 720a 2020 2020 2020 2020 7365 6c66  ser.        self
-00001b10: 2e73 6574 5f72 656d 6f76 655f 666c 6167  .set_remove_flag
-00001b20: 7328 290a 0a20 2020 2020 2020 2073 656c  s()..        sel
-00001b30: 662e 7265 6d6f 7665 5f75 6e77 616e 7465  f.remove_unwante
-00001b40: 645f 6174 7472 6962 7574 6573 5f61 6e64  d_attributes_and
-00001b50: 5f65 6c65 6d65 6e74 7328 290a 2020 2020  _elements().    
-00001b60: 2020 2020 7061 6765 7369 7a65 203d 204e      pagesize = N
-00001b70: 6f6e 650a 2020 2020 2020 2020 6966 2073  one.        if s
-00001b80: 656c 662e 6d61 726b 6572 5f78 7061 7468  elf.marker_xpath
-00001b90: 3a0a 2020 2020 2020 2020 2020 2020 6f66  :.            of
-00001ba0: 6673 6574 2c20 7061 6765 7369 7a65 2c20  fset, pagesize, 
-00001bb0: 7061 6765 5f63 6f6f 7264 7320 3d20 4874  page_coords = Ht
-00001bc0: 6d6c 5574 696c 2e66 696e 645f 636f 6e73  mlUtil.find_cons
-00001bd0: 7461 6e74 5f63 6f6f 7264 696e 6174 655f  tant_coordinate_
-00001be0: 6d61 726b 6572 7328 7365 6c66 2e72 6177  markers(self.raw
-00001bf0: 5f65 6c65 6d2c 2073 656c 662e 6d61 726b  _elem, self.mark
-00001c00: 6572 5f78 7061 7468 290a 2020 2020 2020  er_xpath).      
-00001c10: 2020 2020 2020 4874 6d6c 5574 696c 2e72        HtmlUtil.r
-00001c20: 656d 6f76 655f 6865 6164 6572 735f 616e  emove_headers_an
-00001c30: 645f 666f 6f74 6572 735f 7573 696e 675f  d_footers_using_
-00001c40: 7064 666d 696e 6572 5f63 6f6f 7264 7328  pdfminer_coords(
-00001c50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001c60: 2073 656c 662e 7261 775f 656c 656d 2c0a   self.raw_elem,.
-00001c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001c80: 7061 6765 7369 7a65 2c0a 2020 2020 2020  pagesize,.      
-00001c90: 2020 2020 2020 2020 2020 7365 6c66 2e68            self.h
-00001ca0: 6561 6465 722c 0a20 2020 2020 2020 2020  eader,.         
-00001cb0: 2020 2020 2020 2073 656c 662e 666f 6f74         self.foot
-00001cc0: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
-00001cd0: 2020 2020 7365 6c66 2e6d 6172 6b65 725f      self.marker_
-00001ce0: 7870 6174 682c 0a20 2020 2020 2020 2020  xpath,.         
-00001cf0: 2020 2020 2020 2070 6167 655f 746f 7073         page_tops
-00001d00: 3d73 656c 662e 7061 6765 5f74 6f70 732c  =self.page_tops,
-00001d10: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00001d20: 2020 2020 2020 2066 6f72 2061 7474 2069         for att i
-00001d30: 6e20 7365 6c66 2e73 7479 6c65 5f61 7474  n self.style_att
-00001d40: 7269 6275 7465 735f 746f 5f72 656d 6f76  ributes_to_remov
-00001d50: 653a 0a20 2020 2020 2020 2020 2020 2048  e:.            H
-00001d60: 746d 6c55 7469 6c2e 7265 6d6f 7665 5f73  tmlUtil.remove_s
-00001d70: 7479 6c65 5f61 7474 7269 6275 7465 2873  tyle_attribute(s
-00001d80: 656c 662e 7261 775f 656c 656d 2c20 6174  elf.raw_elem, at
-00001d90: 7429 0a20 2020 2020 2020 2048 746d 6c55  t).        HtmlU
-00001da0: 7469 6c2e 7265 6d6f 7665 5f75 6e77 616e  til.remove_unwan
-00001db0: 7465 6473 2873 656c 662e 7261 775f 656c  teds(self.raw_el
-00001dc0: 656d 2c20 7365 6c66 2e75 6e77 616e 7465  em, self.unwante
-00001dd0: 6473 290a 2020 2020 2020 2020 4874 6d6c  ds).        Html
-00001de0: 5574 696c 2e72 656d 6f76 655f 6e65 776c  Util.remove_newl
-00001df0: 696e 6573 2873 656c 662e 7261 775f 656c  ines(self.raw_el
-00001e00: 656d 290a 2020 2020 2020 2020 4874 6d6c  em).        Html
-00001e10: 5472 6565 2e6d 616b 655f 7365 6374 696f  Tree.make_sectio
-00001e20: 6e73 5f61 6e64 5f6f 7574 7075 7428 7365  ns_and_output(se
-00001e30: 6c66 2e72 6177 5f65 6c65 6d2c 206f 7574  lf.raw_elem, out
-00001e40: 7075 745f 6469 723d 7365 6c66 2e6f 7574  put_dir=self.out
-00001e50: 6469 722c 2072 6563 735f 6279 5f73 6563  dir, recs_by_sec
-00001e60: 7469 6f6e 3d52 4543 535f 4259 5f53 4543  tion=RECS_BY_SEC
-00001e70: 5449 4f4e 290a 2020 2020 2020 2020 6874  TION).        ht
-00001e80: 6d6c 7374 7220 3d20 4554 2e74 6f73 7472  mlstr = ET.tostr
-00001e90: 696e 6728 7365 6c66 2e72 6177 5f65 6c65  ing(self.raw_ele
-00001ea0: 6d2c 2065 6e63 6f64 696e 673d 5f55 5446  m, encoding=_UTF
-00001eb0: 3829 2e64 6563 6f64 6528 290a 2020 2020  8).decode().    
-00001ec0: 2020 2020 7265 7475 726e 2068 746d 6c73      return htmls
-00001ed0: 7472 0a0a 2020 2020 6465 6620 7265 6d6f  tr..    def remo
-00001ee0: 7665 5f75 6e77 616e 7465 645f 6174 7472  ve_unwanted_attr
-00001ef0: 6962 7574 6573 5f61 6e64 5f65 6c65 6d65  ibutes_and_eleme
-00001f00: 6e74 7328 7365 6c66 293a 0a20 2020 2020  nts(self):.     
-00001f10: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
-00001f20: 656d 6f76 6520 6f62 6a65 6374 7320 6966  emove objects if
-00001f30: 2066 6c61 6773 2068 6176 6520 6265 656e   flags have been
-00001f40: 2073 6574 2069 6e20 7365 6c66 0a20 2020   set in self.   
-00001f50: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00001f60: 2069 6620 7365 6c66 2e61 6464 5f69 643a   if self.add_id:
-00001f70: 0a20 2020 2020 2020 2020 2020 2048 746d  .            Htm
-00001f80: 6c55 7469 6c2e 6164 645f 6765 6e65 7261  lUtil.add_genera
-00001f90: 7465 645f 6964 7328 7365 6c66 2e72 6177  ted_ids(self.raw
-00001fa0: 5f65 6c65 6d29 0a20 2020 2020 2020 2066  _elem).        f
-00001fb0: 6f72 2074 6167 2069 6e20 7365 6c66 2e64  or tag in self.d
-00001fc0: 6573 6365 6e64 616e 7473 5f74 6f5f 7265  escendants_to_re
-00001fd0: 6d6f 7665 3a0a 2020 2020 2020 2020 2020  move:.          
-00001fe0: 2020 4554 2e73 7472 6970 5f74 6167 7328    ET.strip_tags(
-00001ff0: 7365 6c66 2e72 6177 5f65 6c65 6d2c 205b  self.raw_elem, [
-00002000: 7461 675d 290a 2020 2020 2020 2020 6966  tag]).        if
-00002010: 2073 656c 662e 7265 6d6f 7665 5f6c 685f   self.remove_lh_
-00002020: 6c69 6e65 5f6e 756d 6265 7273 3a0a 2020  line_numbers:.  
-00002030: 2020 2020 2020 2020 2020 4874 6d6c 5574            HtmlUt
-00002040: 696c 2e72 656d 6f76 655f 6c68 5f6c 696e  il.remove_lh_lin
-00002050: 655f 6e75 6d62 6572 7328 7365 6c66 2e72  e_numbers(self.r
+00001230: 2020 2020 736f 6d65 2065 6c65 6d65 6e74      some element
+00001240: 7320 3f73 7061 6e73 2920 6672 6f6d 2070  s ?spans) from p
+00001250: 6466 2070 6172 7369 6e67 2068 6176 6520  df parsing have 
+00001260: 7468 6520 666f 726d 3a0a 2020 2020 2020  the form:.      
+00001270: 2020 3c64 6976 202e 2e2e 3e3c 6120 6e61    <div ...><a na
+00001280: 6d65 3d22 3222 3e50 6167 6520 323c 2f61  me="2">Page 2</a
+00001290: 3e0a 0a20 2020 2020 2020 203a 7061 7261  >..        :para
+000012a0: 6d20 656c 656d 3a20 636f 6e74 6169 6e73  m elem: contains
+000012b0: 2070 6167 6520 6e75 6d62 6572 0a20 2020   page number.   
+000012c0: 2020 2020 203a 7265 7475 726e 3a20 7061       :return: pa
+000012d0: 6765 206e 756d 6265 7220 6f72 206e 6f6e  ge number or non
+000012e0: 650a 2020 2020 2020 2020 2222 220a 2020  e.        """.  
+000012f0: 2020 2020 2020 6966 2065 6c65 6d20 6973        if elem is
+00001300: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00001310: 2020 2072 6574 7572 6e20 4e6f 6e65 0a20     return None. 
+00001320: 2020 2020 2020 2078 7061 7468 7820 3d20         xpathx = 
+00001330: 6622 2e2f 2f61 2f40 7b41 5f4e 414d 457d  f".//a/@{A_NAME}
+00001340: 220a 2020 2020 2020 2020 616e 616d 6520  ".        aname 
+00001350: 3d20 656c 656d 2e78 7061 7468 2878 7061  = elem.xpath(xpa
+00001360: 7468 7829 0a20 2020 2020 2020 2072 6574  thx).        ret
+00001370: 7572 6e20 616e 616d 650a 0a20 2020 2064  urn aname..    d
+00001380: 6566 2061 6464 5f73 7479 6c65 5f73 7061  ef add_style_spa
+00001390: 6e5f 616e 645f 7061 6765 5f6e 756d 6265  n_and_page_numbe
+000013a0: 7228 7365 6c66 2c20 656c 656d 293a 0a20  r(self, elem):. 
+000013b0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000013c0: 2020 2061 6464 2073 7479 6c65 2073 7061     add style spa
+000013d0: 6e20 2061 6e64 2061 6c73 6f20 6765 7420  n  and also get 
+000013e0: 7061 6765 6e75 6d62 6572 2066 726f 6d20  pagenumber from 
+000013f0: 6e65 7874 2065 6c65 6d65 6e74 0a0a 2020  next element..  
+00001400: 2020 2020 2020 7479 7069 6361 6c20 7472        typical tr
+00001410: 6169 6c69 6e67 2065 6c65 6d65 6e74 0a20  ailing element. 
+00001420: 2020 2020 2020 203c 6469 7620 7374 796c         <div styl
+00001430: 653d 2270 6f73 6974 696f 6e3a 6162 736f  e="position:abso
+00001440: 6c75 7465 3b20 746f 703a 3130 3735 3370  lute; top:10753p
+00001450: 783b 223e 3c61 206e 616d 653d 2231 3322  x;"><a name="13"
+00001460: 3e50 6167 6520 3133 3c2f 613e 3c2f 6469  >Page 13</a></di
+00001470: 763e 0a20 2020 2020 2020 2022 2222 0a20  v>.        """. 
+00001480: 2020 2020 2020 2073 656c 662e 656c 656d         self.elem
+00001490: 203d 2065 6c65 6d0a 2020 2020 2020 2020   = elem.        
+000014a0: 7061 6765 5f64 6976 203d 2065 6c65 6d2e  page_div = elem.
+000014b0: 6765 746e 6578 7428 290a 2020 2020 2020  getnext().      
+000014c0: 2020 6966 2070 6167 655f 6469 7620 6973    if page_div is
+000014d0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+000014e0: 2020 2020 2020 206e 203d 2070 6167 655f         n = page_
+000014f0: 6469 762e 7870 6174 6828 6622 2e2f 612f  div.xpath(f"./a/
+00001500: 407b 415f 4e41 4d45 7d22 290a 2020 2020  @{A_NAME}").    
+00001510: 2020 2020 2020 2020 6e20 3d20 6e5b 305d          n = n[0]
+00001520: 2069 6620 6c65 6e28 6e29 203d 3d20 3120   if len(n) == 1 
+00001530: 656c 7365 204e 6f6e 650a 2020 2020 2020  else None.      
+00001540: 2020 2020 2020 6966 206e 3a0a 2020 2020        if n:.    
+00001550: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00001560: 2e69 6e74 5f6e 756d 6265 7220 3d20 696e  .int_number = in
+00001570: 7428 6e29 0a0a 2020 2020 2020 2020 2020  t(n)..          
+00001580: 2020 7020 3d20 7061 6765 5f64 6976 2e78    p = page_div.x
+00001590: 7061 7468 2866 222e 2f61 5b40 7b41 5f4e  path(f"./a[@{A_N
+000015a0: 414d 457d 2061 6e64 2063 6f6e 7461 696e  AME} and contain
+000015b0: 7328 2e2c 2027 5061 6765 2729 5d22 290a  s(., 'Page')]").
+000015c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000015d0: 2e70 5f6e 756d 5f73 7472 203d 2070 5b30  .p_num_str = p[0
+000015e0: 5d20 6966 206c 656e 2870 2920 3d3d 2031  ] if len(p) == 1
+000015f0: 2065 6c73 6520 4e6f 6e65 0a0a 0a63 6c61   else None...cla
+00001600: 7373 2048 746d 6c54 6964 793a 0a20 2020  ss HtmlTidy:.   
+00001610: 2022 2222 666f 7220 7469 6479 696e 6720   """for tidying 
+00001620: 5044 4620 2f20 5356 472f 204f 4352 2070  PDF / SVG/ OCR p
+00001630: 6172 7369 6e67 0a20 2020 2074 616b 6573  arsing.    takes
+00001640: 2072 6177 2048 544d 4c20 2870 726f 6261   raw HTML (proba
+00001650: 626c 7920 7363 6174 7465 7265 6420 776f  bly scattered wo
+00001660: 7264 7320 6f72 206c 696e 6573 202c 2070  rds or lines , p
+00001670: 6f73 7369 626c 7920 7769 7468 2063 6f6f  ossibly with coo
+00001680: 7264 696e 6174 6573 2061 6e64 2063 7265  rdinates and cre
+00001690: 6174 6573 0a20 2020 2066 6c6f 7769 6e67  ates.    flowing
+000016a0: 2073 7479 6c65 6420 4854 4d4c 2077 6974   styled HTML wit
+000016b0: 6820 7375 6273 6372 6970 7473 2c20 666f  h subscripts, fo
+000016c0: 6e74 2073 7479 6c65 732c 2065 7463 2e0a  nt styles, etc..
+000016d0: 2020 2020 2222 220a 0a20 2020 204d 494e      """..    MIN
+000016e0: 5f50 4147 455f 424f 585f 4845 4947 4854  _PAGE_BOX_HEIGHT
+000016f0: 203d 2033 3030 2020 2320 616c 6c6f 7773   = 300  # allows
+00001700: 2066 6f72 206c 616e 6473 6361 7065 0a20   for landscape. 
+00001710: 2020 2048 4541 445f 454c 454d 535f 494e     HEAD_ELEMS_IN
+00001720: 5f58 5041 5448 203d 2066 227b 485f 4d45  _XPATH = f"{H_ME
+00001730: 5441 7d20 7c20 7b48 5f54 4954 4c45 7d20  TA} | {H_TITLE} 
+00001740: 7c20 7b48 5f53 4352 4950 547d 207c 207b  | {H_SCRIPT} | {
+00001750: 485f 5354 594c 457d 220a 0a20 2020 2064  H_STYLE}"..    d
+00001760: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
+00001770: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
+00001780: 756e 7761 6e74 6564 7320 3d20 5b5d 2020  unwanteds = []  
+00001790: 2320 6e6f 7420 7375 7265 2077 6861 7420  # not sure what 
+000017a0: 7468 6973 2069 730a 2020 2020 2020 2020  this is.        
+000017b0: 7365 6c66 2e65 6d70 7479 5f65 6c65 6d65  self.empty_eleme
+000017c0: 6e74 735f 746f 5f72 656d 6f76 6520 3d20  nts_to_remove = 
+000017d0: 5b5d 0a20 2020 2020 2020 2073 656c 662e  [].        self.
+000017e0: 7374 796c 6573 5f74 6f5f 7265 6d6f 7665  styles_to_remove
+000017f0: 203d 205b 5d0a 2020 2020 2020 2020 7365   = [].        se
+00001800: 6c66 2e64 6573 6365 6e64 616e 7473 5f74  lf.descendants_t
+00001810: 6f5f 7265 6d6f 7665 203d 205b 5d0a 2020  o_remove = [].  
+00001820: 2020 2020 2020 7365 6c66 2e72 656d 6f76        self.remov
+00001830: 655f 6c68 5f6c 696e 655f 6e75 6d62 6572  e_lh_line_number
+00001840: 7320 3d20 5472 7565 0a20 2020 2020 2020  s = True.       
+00001850: 2073 656c 662e 7265 6d6f 7665 5f6c 6172   self.remove_lar
+00001860: 6765 5f66 6f6e 7465 645f 656c 656d 656e  ge_fonted_elemen
+00001870: 7473 203d 2054 7275 650a 2020 2020 2020  ts = True.      
+00001880: 2020 7365 6c66 2e73 7479 6c65 5f61 7474    self.style_att
+00001890: 7269 6275 7465 735f 746f 5f72 656d 6f76  ributes_to_remov
+000018a0: 6520 3d20 5b5d 0a20 2020 2020 2020 2073  e = [].        s
+000018b0: 656c 662e 6d61 726b 6572 5f78 7061 7468  elf.marker_xpath
+000018c0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+000018d0: 7365 6c66 2e73 7479 6c65 5f61 7474 7269  self.style_attri
+000018e0: 6275 7465 735f 746f 5f72 656d 6f76 6520  butes_to_remove 
+000018f0: 3d20 5b5d 0a0a 2020 2020 2020 2020 7365  = []..        se
+00001900: 6c66 2e61 6464 5f69 6420 3d20 5472 7565  lf.add_id = True
+00001910: 0a20 2020 2020 2020 2073 656c 662e 6865  .        self.he
+00001920: 6164 6572 203d 2038 300a 2020 2020 2020  ader = 80.      
+00001930: 2020 7365 6c66 2e66 6f6f 7465 7220 3d20    self.footer = 
+00001940: 3830 0a20 2020 2020 2020 2073 656c 662e  80.        self.
+00001950: 7061 6765 5f74 6f70 7320 3d20 4e6f 6e65  page_tops = None
+00001960: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
+00001970: 6765 5f62 6f78 6573 203d 205b 5d0a 2020  ge_boxes = [].  
+00001980: 2020 2020 2020 7365 6c66 2e72 6177 5f65        self.raw_e
+00001990: 6c65 6d20 3d20 4e6f 6e65 0a20 2020 2020  lem = None.     
+000019a0: 2020 2073 656c 662e 6f75 7464 6972 203d     self.outdir =
+000019b0: 204e 6f6e 650a 0a20 2020 2064 6566 2074   None..    def t
+000019c0: 6964 795f 666c 6f77 2873 656c 662c 2072  idy_flow(self, r
+000019d0: 6177 5f68 746d 6c29 3a0a 2020 2020 2020  aw_html):.      
+000019e0: 2020 2222 220a 2020 2020 2020 2020 4e65    """.        Ne
+000019f0: 6564 2074 6f20 6361 7074 7572 6520 7061  ed to capture pa
+00001a00: 6765 2069 6e66 6f72 6d61 7469 6f6e 2074  ge information t
+00001a10: 6f20 636f 6d70 7574 6520 7061 6765 2063  o compute page c
+00001a20: 6f6f 7264 696e 6174 6573 2c20 6e6f 7420  oordinates, not 
+00001a30: 646f 6375 6d65 6e74 2063 6f6f 7264 696e  document coordin
+00001a40: 6174 6573 0a20 2020 2020 2020 2063 6f6e  ates.        con
+00001a50: 7665 7274 7320 7261 7720 6874 6d6c 2074  verts raw html t
+00001a60: 6f20 7469 6479 0a20 2020 2020 2020 2022  o tidy.        "
+00001a70: 2222 0a0a 2020 2020 2020 2020 2320 544f  ""..        # TO
+00001a80: 444f 2063 6865 636b 2061 6e64 206d 6f76  DO check and mov
+00001a90: 6520 746f 2069 6e73 7461 6e63 6520 6f66  e to instance of
+00001aa0: 2048 746d 6c54 6964 790a 0a20 2020 2020   HtmlTidy..     
+00001ab0: 2020 2069 6620 7261 775f 6874 6d6c 2069     if raw_html i
+00001ac0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00001ad0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00001ae0: 7272 6f72 2822 4e6f 2048 544d 4c22 290a  rror("No HTML").
+00001af0: 2020 2020 2020 2020 7261 775f 7472 6565          raw_tree
+00001b00: 203d 2045 542e 7061 7273 6528 5374 7269   = ET.parse(Stri
+00001b10: 6e67 494f 2872 6177 5f68 746d 6c29 2c20  ngIO(raw_html), 
+00001b20: 4554 2e48 544d 4c50 6172 7365 7228 2929  ET.HTMLParser())
+00001b30: 0a20 2020 2020 2020 2073 656c 662e 7261  .        self.ra
+00001b40: 775f 656c 656d 203d 2072 6177 5f74 7265  w_elem = raw_tre
+00001b50: 652e 6765 7472 6f6f 7428 290a 2020 2020  e.getroot().    
+00001b60: 2020 2020 7365 6c66 2e65 7874 7261 6374      self.extract
+00001b70: 5f70 6167 655f 626f 7865 7328 290a 0a20  _page_boxes().. 
+00001b80: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
+00001b90: 656c 656d 656e 7428 7365 6c66 2e72 6177  element(self.raw
+00001ba0: 5f65 6c65 6d29 0a0a 2020 2020 2020 2020  _elem)..        
+00001bb0: 2320 7468 6973 2069 7320 7365 7420 6279  # this is set by
+00001bc0: 2075 7365 720a 2020 2020 2020 2020 7365   user.        se
+00001bd0: 6c66 2e73 6574 5f72 656d 6f76 655f 666c  lf.set_remove_fl
+00001be0: 6167 7328 290a 0a20 2020 2020 2020 2073  ags()..        s
+00001bf0: 656c 662e 7265 6d6f 7665 5f75 6e77 616e  elf.remove_unwan
+00001c00: 7465 645f 6174 7472 6962 7574 6573 5f61  ted_attributes_a
+00001c10: 6e64 5f65 6c65 6d65 6e74 7328 290a 2020  nd_elements().  
+00001c20: 2020 2020 2020 7061 6765 7369 7a65 203d        pagesize =
+00001c30: 204e 6f6e 650a 2020 2020 2020 2020 6966   None.        if
+00001c40: 2073 656c 662e 6d61 726b 6572 5f78 7061   self.marker_xpa
+00001c50: 7468 3a0a 2020 2020 2020 2020 2020 2020  th:.            
+00001c60: 6f66 6673 6574 2c20 7061 6765 7369 7a65  offset, pagesize
+00001c70: 2c20 7061 6765 5f63 6f6f 7264 7320 3d20  , page_coords = 
+00001c80: 4874 6d6c 5574 696c 2e66 696e 645f 636f  HtmlUtil.find_co
+00001c90: 6e73 7461 6e74 5f63 6f6f 7264 696e 6174  nstant_coordinat
+00001ca0: 655f 6d61 726b 6572 7328 7365 6c66 2e72  e_markers(self.r
+00001cb0: 6177 5f65 6c65 6d2c 2073 656c 662e 6d61  aw_elem, self.ma
+00001cc0: 726b 6572 5f78 7061 7468 290a 2020 2020  rker_xpath).    
+00001cd0: 2020 2020 2020 2020 4874 6d6c 5574 696c          HtmlUtil
+00001ce0: 2e72 656d 6f76 655f 6865 6164 6572 735f  .remove_headers_
+00001cf0: 616e 645f 666f 6f74 6572 735f 7573 696e  and_footers_usin
+00001d00: 675f 7064 666d 696e 6572 5f63 6f6f 7264  g_pdfminer_coord
+00001d10: 7328 0a20 2020 2020 2020 2020 2020 2020  s(.             
+00001d20: 2020 2073 656c 662e 7261 775f 656c 656d     self.raw_elem
+00001d30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00001d40: 2020 7061 6765 7369 7a65 2c0a 2020 2020    pagesize,.    
+00001d50: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00001d60: 2e68 6561 6465 722c 0a20 2020 2020 2020  .header,.       
+00001d70: 2020 2020 2020 2020 2073 656c 662e 666f           self.fo
+00001d80: 6f74 6572 2c0a 2020 2020 2020 2020 2020  oter,.          
+00001d90: 2020 2020 2020 7365 6c66 2e6d 6172 6b65        self.marke
+00001da0: 725f 7870 6174 682c 0a20 2020 2020 2020  r_xpath,.       
+00001db0: 2020 2020 2020 2020 2070 6167 655f 746f           page_to
+00001dc0: 7073 3d73 656c 662e 7061 6765 5f74 6f70  ps=self.page_top
+00001dd0: 732c 0a20 2020 2020 2020 2020 2020 2029  s,.            )
+00001de0: 0a20 2020 2020 2020 2066 6f72 2061 7474  .        for att
+00001df0: 2069 6e20 7365 6c66 2e73 7479 6c65 5f61   in self.style_a
+00001e00: 7474 7269 6275 7465 735f 746f 5f72 656d  ttributes_to_rem
+00001e10: 6f76 653a 0a20 2020 2020 2020 2020 2020  ove:.           
+00001e20: 2048 746d 6c55 7469 6c2e 7265 6d6f 7665   HtmlUtil.remove
+00001e30: 5f73 7479 6c65 5f61 7474 7269 6275 7465  _style_attribute
+00001e40: 2873 656c 662e 7261 775f 656c 656d 2c20  (self.raw_elem, 
+00001e50: 6174 7429 0a20 2020 2020 2020 2048 746d  att).        Htm
+00001e60: 6c55 7469 6c2e 7265 6d6f 7665 5f75 6e77  lUtil.remove_unw
+00001e70: 616e 7465 6473 2873 656c 662e 7261 775f  anteds(self.raw_
+00001e80: 656c 656d 2c20 7365 6c66 2e75 6e77 616e  elem, self.unwan
+00001e90: 7465 6473 290a 2020 2020 2020 2020 4874  teds).        Ht
+00001ea0: 6d6c 5574 696c 2e72 656d 6f76 655f 6e65  mlUtil.remove_ne
+00001eb0: 776c 696e 6573 2873 656c 662e 7261 775f  wlines(self.raw_
+00001ec0: 656c 656d 290a 2020 2020 2020 2020 4874  elem).        Ht
+00001ed0: 6d6c 5472 6565 2e6d 616b 655f 7365 6374  mlTree.make_sect
+00001ee0: 696f 6e73 5f61 6e64 5f6f 7574 7075 7428  ions_and_output(
+00001ef0: 7365 6c66 2e72 6177 5f65 6c65 6d2c 206f  self.raw_elem, o
+00001f00: 7574 7075 745f 6469 723d 7365 6c66 2e6f  utput_dir=self.o
+00001f10: 7574 6469 722c 2072 6563 735f 6279 5f73  utdir, recs_by_s
+00001f20: 6563 7469 6f6e 3d52 4543 535f 4259 5f53  ection=RECS_BY_S
+00001f30: 4543 5449 4f4e 290a 2020 2020 2020 2020  ECTION).        
+00001f40: 6874 6d6c 7374 7220 3d20 4554 2e74 6f73  htmlstr = ET.tos
+00001f50: 7472 696e 6728 7365 6c66 2e72 6177 5f65  tring(self.raw_e
+00001f60: 6c65 6d2c 2065 6e63 6f64 696e 673d 5f55  lem, encoding=_U
+00001f70: 5446 3829 2e64 6563 6f64 6528 290a 2020  TF8).decode().  
+00001f80: 2020 2020 2020 7265 7475 726e 2068 746d        return htm
+00001f90: 6c73 7472 0a0a 2020 2020 6465 6620 7265  lstr..    def re
+00001fa0: 6d6f 7665 5f75 6e77 616e 7465 645f 6174  move_unwanted_at
+00001fb0: 7472 6962 7574 6573 5f61 6e64 5f65 6c65  tributes_and_ele
+00001fc0: 6d65 6e74 7328 7365 6c66 293a 0a20 2020  ments(self):.   
+00001fd0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00001fe0: 2072 656d 6f76 6520 6f62 6a65 6374 7320   remove objects 
+00001ff0: 6966 2066 6c61 6773 2068 6176 6520 6265  if flags have be
+00002000: 656e 2073 6574 2069 6e20 7365 6c66 0a20  en set in self. 
+00002010: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00002020: 2020 2069 6620 7365 6c66 2e61 6464 5f69     if self.add_i
+00002030: 643a 0a20 2020 2020 2020 2020 2020 2048  d:.            H
+00002040: 746d 6c55 7469 6c2e 6164 645f 6765 6e65  tmlUtil.add_gene
+00002050: 7261 7465 645f 6964 7328 7365 6c66 2e72  rated_ids(self.r
 00002060: 6177 5f65 6c65 6d29 0a20 2020 2020 2020  aw_elem).       
-00002070: 2069 6620 7365 6c66 2e72 656d 6f76 655f   if self.remove_
-00002080: 6c61 7267 655f 666f 6e74 6564 5f65 6c65  large_fonted_ele
-00002090: 6d65 6e74 733a 0a20 2020 2020 2020 2020  ments:.         
-000020a0: 2020 2048 746d 6c55 7469 6c2e 7265 6d6f     HtmlUtil.remo
-000020b0: 7665 5f6c 6172 6765 5f66 6f6e 7465 645f  ve_large_fonted_
-000020c0: 656c 656d 656e 7473 2873 656c 662e 7261  elements(self.ra
-000020d0: 775f 656c 656d 290a 2020 2020 2020 2020  w_elem).        
-000020e0: 666f 7220 7461 6720 696e 2073 656c 662e  for tag in self.
-000020f0: 656d 7074 795f 656c 656d 656e 7473 5f74  empty_elements_t
-00002100: 6f5f 7265 6d6f 7665 3a0a 2020 2020 2020  o_remove:.      
-00002110: 2020 2020 2020 4874 6d6c 5574 696c 2e72        HtmlUtil.r
-00002120: 656d 6f76 655f 656d 7074 795f 656c 656d  emove_empty_elem
-00002130: 656e 7473 2873 656c 662e 7261 775f 656c  ents(self.raw_el
-00002140: 656d 2c20 5b74 6167 5d29 0a20 2020 2020  em, [tag]).     
-00002150: 2020 2066 6f72 2073 7479 6c65 2069 6e20     for style in 
-00002160: 7365 6c66 2e73 7479 6c65 735f 746f 5f72  self.styles_to_r
-00002170: 656d 6f76 653a 0a20 2020 2020 2020 2020  emove:.         
-00002180: 2020 2048 746d 6c55 7469 6c2e 7265 6d6f     HtmlUtil.remo
-00002190: 7665 5f73 7479 6c65 2873 656c 662e 7261  ve_style(self.ra
-000021a0: 775f 656c 656d 2c20 5b73 7479 6c65 5d29  w_elem, [style])
-000021b0: 0a0a 2020 2020 6465 6620 7365 745f 7265  ..    def set_re
-000021c0: 6d6f 7665 5f66 6c61 6773 2873 656c 6629  move_flags(self)
-000021d0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-000021e0: 2020 2020 2020 7365 7420 666c 6167 7320        set flags 
-000021f0: 7768 6963 6820 6469 7265 6374 2072 656d  which direct rem
-00002200: 6f76 616c 206f 6620 656c 656d 656e 7473  oval of elements
-00002210: 2f61 7474 7269 6275 7465 730a 2020 2020  /attributes.    
-00002220: 2020 2020 6e6f 726d 616c 6c79 2075 6e64      normally und
-00002230: 6572 2075 7365 7220 636f 6e74 726f 6c0a  er user control.
-00002240: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00002250: 2020 2020 7365 6c66 2e61 6464 5f64 6573      self.add_des
-00002260: 6365 6e64 616e 745f 656c 656d 656e 745f  cendant_element_
-00002270: 746f 5f72 656d 6f76 6528 5b22 6272 225d  to_remove(["br"]
-00002280: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00002290: 6464 5f73 7479 6c65 735f 746f 5f72 656d  dd_styles_to_rem
-000022a0: 6f76 6528 0a20 2020 2020 2020 2020 2020  ove(.           
-000022b0: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
-000022c0: 2020 2053 5f50 4f53 4954 494f 4e2c 0a20     S_POSITION,. 
-000022d0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-000022e0: 2022 6c65 6674 222c 0a20 2020 2020 2020   "left",.       
-000022f0: 2020 2020 2020 2020 2053 5f42 4f52 4445           S_BORDE
-00002300: 522c 0a20 2020 2020 2020 2020 2020 2020  R,.             
-00002310: 2020 2053 5f57 5249 5449 4e47 5f4d 4f44     S_WRITING_MOD
-00002320: 452c 0a20 2020 2020 2020 2020 2020 2020  E,.             
-00002330: 2020 2053 5f57 4944 5448 2c20 2023 2074     S_WIDTH,  # t
-00002340: 6869 7320 6469 7361 626c 6573 2066 6c6f  his disables flo
-00002350: 7769 6e67 2074 6578 740a 2020 2020 2020  wing text.      
-00002360: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
-00002370: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00002380: 6464 5f69 6420 3d20 5472 7565 0a20 2020  dd_id = True.   
-00002390: 2020 2020 2073 656c 662e 6164 645f 656d       self.add_em
-000023a0: 7074 795f 656c 656d 656e 7473 5f74 6f5f  pty_elements_to_
-000023b0: 7265 6d6f 7665 285b 2273 7061 6e22 2c20  remove(["span", 
-000023c0: 2264 6976 225d 290a 2020 2020 2020 2020  "div"]).        
-000023d0: 7365 6c66 2e72 656d 6f76 655f 6c68 5f6c  self.remove_lh_l
-000023e0: 696e 655f 6e75 6d62 6572 7320 3d20 5472  ine_numbers = Tr
-000023f0: 7565 2020 2320 780a 2020 2020 2020 2020  ue  # x.        
-00002400: 7365 6c66 2e72 656d 6f76 655f 6c61 7267  self.remove_larg
-00002410: 655f 666f 6e74 6564 5f65 6c65 6d65 6e74  e_fonted_element
-00002420: 7320 3d20 5472 7565 0a20 2020 2020 2020  s = True.       
-00002430: 2073 656c 662e 7374 796c 655f 6174 7472   self.style_attr
-00002440: 6962 7574 6573 5f74 6f5f 7265 6d6f 7665  ibutes_to_remove
-00002450: 203d 205b 2274 6f70 225d 0a20 2020 2020   = ["top"].     
-00002460: 2020 2073 656c 662e 6d61 726b 6572 5f78     self.marker_x
-00002470: 7061 7468 203d 2022 2e2f 2f64 6976 5b61  path = ".//div[a
-00002480: 5b40 6e61 6d65 5d5d 220a 2020 2020 2020  [@name]]".      
-00002490: 2020 7365 6c66 2e73 7479 6c65 5f61 7474    self.style_att
-000024a0: 7269 6275 7465 735f 746f 5f72 656d 6f76  ributes_to_remov
-000024b0: 6520 3d20 5b22 6c65 6674 222c 2022 6865  e = ["left", "he
-000024c0: 6967 6874 225d 0a0a 2020 2020 6465 6620  ight"]..    def 
-000024d0: 6578 7472 6163 745f 7061 6765 5f62 6f78  extract_page_box
-000024e0: 6573 2873 656c 662c 2072 616e 6765 733d  es(self, ranges=
-000024f0: 4e6f 6e65 293a 0a20 2020 2020 2020 2022  None):.        "
-00002500: 2222 0a20 2020 2020 2020 2042 6173 6564  "".        Based
-00002510: 206f 6e20 7064 6670 6c75 6d62 6572 206f   on pdfplumber o
-00002520: 7574 7075 740a 2020 2020 2020 2020 2222  utput.        ""
-00002530: 220a 2020 2020 2020 2020 7365 6c66 2e70  ".        self.p
-00002540: 6167 655f 626f 7865 7320 3d20 5b5d 2020  age_boxes = []  
-00002550: 2320 7061 6765 426f 7820 6d61 7920 6d65  # pageBox may me
-00002560: 7267 6520 7769 7468 2041 6d69 5061 6765  rge with AmiPage
-00002570: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-00002580: 662e 7261 775f 656c 656d 2069 7320 4e6f  f.raw_elem is No
-00002590: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000025a0: 7265 7475 726e 0a20 2020 2020 2020 2073  return.        s
-000025b0: 7479 6c65 5f73 7061 6e73 203d 2073 656c  tyle_spans = sel
-000025c0: 662e 7261 775f 656c 656d 2e78 7061 7468  f.raw_elem.xpath
-000025d0: 2822 2f2f 7370 616e 5b63 6f6e 7461 696e  ("//span[contain
-000025e0: 7328 4073 7479 6c65 2c27 706f 7369 7469  s(@style,'positi
-000025f0: 6f6e 3a61 6273 6f6c 7574 6527 295d 2229  on:absolute')]")
-00002600: 0a20 2020 2020 2020 2066 6f72 2073 7479  .        for sty
-00002610: 6c65 5f73 7061 6e20 696e 2073 7479 6c65  le_span in style
-00002620: 5f73 7061 6e73 3a0a 2020 2020 2020 2020  _spans:.        
-00002630: 2020 2020 6373 735f 7374 796c 6520 3d20      css_style = 
-00002640: 4353 5353 7479 6c65 2e63 7265 6174 655f  CSSStyle.create_
-00002650: 6373 735f 7374 796c 655f 6672 6f6d 5f61  css_style_from_a
-00002660: 7474 7269 6275 7465 5f6f 665f 626f 6479  ttribute_of_body
-00002670: 5f65 6c65 6d65 6e74 2873 7479 6c65 5f73  _element(style_s
-00002680: 7061 6e29 0a20 2020 2020 2020 2020 2020  pan).           
-00002690: 2069 6620 6373 735f 7374 796c 652e 6865   if css_style.he
-000026a0: 6967 6874 203e 2073 656c 662e 4d49 4e5f  ight > self.MIN_
-000026b0: 5041 4745 5f42 4f58 5f48 4549 4748 543a  PAGE_BOX_HEIGHT:
-000026c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000026d0: 2070 6167 655f 626f 7820 3d20 5061 6765   page_box = Page
-000026e0: 426f 7828 6373 735f 7374 796c 653d 6373  Box(css_style=cs
-000026f0: 735f 7374 796c 6529 0a20 2020 2020 2020  s_style).       
-00002700: 2020 2020 2020 2020 2070 6167 655f 626f           page_bo
-00002710: 782e 6164 645f 7374 796c 655f 7370 616e  x.add_style_span
-00002720: 5f61 6e64 5f70 6167 655f 6e75 6d62 6572  _and_page_number
-00002730: 2873 7479 6c65 5f73 7061 6e29 0a20 2020  (style_span).   
-00002740: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00002750: 662e 7061 6765 5f62 6f78 6573 2e61 7070  f.page_boxes.app
-00002760: 656e 6428 7061 6765 5f62 6f78 290a 0a20  end(page_box).. 
-00002770: 2020 2020 2020 2073 656c 662e 6578 7472         self.extr
-00002780: 6163 745f 7061 6765 5f6e 756d 6265 7273  act_page_numbers
-00002790: 2829 0a0a 2020 2020 6465 6620 6578 7472  ()..    def extr
-000027a0: 6163 745f 7061 6765 5f6e 756d 6265 7273  act_page_numbers
-000027b0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-000027c0: 7061 6765 6e6f 5f78 7061 7468 203d 2022  pageno_xpath = "
-000027d0: 2f2f 7370 616e 2f64 6976 2f61 5b40 6e61  //span/div/a[@na
-000027e0: 6d65 5d22 2020 2320 7061 6765 206e 756d  me]"  # page num
-000027f0: 6265 7220 626f 7865 733b 2074 6865 2070  ber boxes; the p
-00002800: 6172 656e 7420 7370 616e 2069 7320 686f  arent span is ho
-00002810: 7272 6964 0a20 2020 2020 2020 2065 6c65  rrid.        ele
-00002820: 6d5f 7769 7468 5f70 6167 656e 6f73 203d  m_with_pagenos =
-00002830: 2073 656c 662e 7261 775f 656c 656d 2e78   self.raw_elem.x
-00002840: 7061 7468 2870 6167 656e 6f5f 7870 6174  path(pageno_xpat
-00002850: 6829 0a20 2020 2020 2020 2063 7373 5f6c  h).        css_l
-00002860: 6173 7420 3d20 4e6f 6e65 0a20 2020 2020  ast = None.     
-00002870: 2020 2022 2222 3c62 723e 3c2f 7370 616e     """<br></span
-00002880: 3e3c 7370 616e 2073 7479 6c65 3d22 666f  ><span style="fo
-00002890: 6e74 2d66 616d 696c 793a 2043 616c 6962  nt-family: Calib
-000028a0: 7269 3b20 666f 6e74 2d73 697a 653a 3130  ri; font-size:10
-000028b0: 7078 223e 200a 2020 2020 2020 2020 2020  px"> .          
-000028c0: 2020 2020 2020 3c62 723e 3c73 7061 6e20        <br><span 
-000028d0: 7374 796c 653d 2270 6f73 6974 696f 6e3a  style="position:
-000028e0: 6162 736f 6c75 7465 3b20 626f 7264 6572  absolute; border
-000028f0: 3a20 6772 6179 2031 7078 2073 6f6c 6964  : gray 1px solid
-00002900: 3b20 6c65 6674 3a30 7078 3b20 746f 703a  ; left:0px; top:
-00002910: 3934 3170 783b 2077 6964 7468 3a35 3935  941px; width:595
-00002920: 7078 3b20 6865 6967 6874 3a38 3431 7078  px; height:841px
-00002930: 3b22 3e3c 2f73 7061 6e3e 0a20 2020 2020  ;"></span>.     
-00002940: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-00002950: 2020 2020 2020 2020 2020 2020 3c64 6976              <div
-00002960: 2073 7479 6c65 3d22 706f 7369 7469 6f6e   style="position
-00002970: 3a61 6273 6f6c 7574 653b 2074 6f70 3a39  :absolute; top:9
-00002980: 3431 7078 3b22 3e3c 6120 6e61 6d65 3d22  41px;"><a name="
-00002990: 3222 3e50 6167 6520 323c 2f61 3e3c 2f64  2">Page 2</a></d
-000029a0: 6976 3e0a 2020 2020 2020 2020 2020 2020  iv>.            
-000029b0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000029c0: 666f 7220 656c 656d 5f77 6974 685f 7061  for elem_with_pa
-000029d0: 6765 6e6f 2069 6e20 656c 656d 5f77 6974  geno in elem_wit
-000029e0: 685f 7061 6765 6e6f 733a 0a20 2020 2020  h_pagenos:.     
-000029f0: 2020 2020 2020 2067 6574 7061 7265 6e74         getparent
-00002a00: 203d 2065 6c65 6d5f 7769 7468 5f70 6167   = elem_with_pag
-00002a10: 656e 6f2e 6765 7470 6172 656e 7428 290a  eno.getparent().
-00002a20: 2020 2020 2020 2020 2020 2020 6373 7320              css 
-00002a30: 3d20 4353 5353 7479 6c65 2e63 7265 6174  = CSSStyle.creat
-00002a40: 655f 6373 735f 7374 796c 655f 6672 6f6d  e_css_style_from
-00002a50: 5f61 7474 7269 6275 7465 5f6f 665f 626f  _attribute_of_bo
-00002a60: 6479 5f65 6c65 6d65 6e74 2867 6574 7061  dy_element(getpa
-00002a70: 7265 6e74 290a 2020 2020 2020 2020 2020  rent).          
-00002a80: 2020 7072 6576 5f65 6c65 6d20 3d20 6765    prev_elem = ge
-00002a90: 7470 6172 656e 742e 6765 7470 7265 7669  tparent.getprevi
-00002aa0: 6f75 7328 290a 2020 2020 2020 2020 2020  ous().          
-00002ab0: 2020 6865 6967 6874 203d 202d 3120 6966    height = -1 if
-00002ac0: 2063 7373 5f6c 6173 7420 6973 204e 6f6e   css_last is Non
-00002ad0: 6520 656c 7365 2063 7373 2e74 6f70 202d  e else css.top -
-00002ae0: 2063 7373 5f6c 6173 742e 746f 700a 2020   css_last.top.  
-00002af0: 2020 2020 2020 2020 2020 7072 6576 5f73            prev_s
-00002b00: 7479 6c65 203d 2043 5353 5374 796c 652e  tyle = CSSStyle.
-00002b10: 6372 6561 7465 5f63 7373 5f73 7479 6c65  create_css_style
-00002b20: 5f66 726f 6d5f 6174 7472 6962 7574 655f  _from_attribute_
-00002b30: 6f66 5f62 6f64 795f 656c 656d 656e 7428  of_body_element(
-00002b40: 7072 6576 5f65 6c65 6d29 0a20 2020 2020  prev_elem).     
-00002b50: 2020 2020 2020 2069 6620 6e6f 7420 7072         if not pr
-00002b60: 6576 5f73 7479 6c65 3a0a 2020 2020 2020  ev_style:.      
-00002b70: 2020 2020 2020 2020 2020 6c6f 6767 696e            loggin
-00002b80: 672e 7761 726e 696e 6728 6622 206e 6f20  g.warning(f" no 
-00002b90: 7072 6576 696f 7573 2073 7479 6c65 2229  previous style")
-00002ba0: 0a20 2020 2020 2020 2020 2020 2062 626f  .            bbo
-00002bb0: 7820 3d20 4e6f 6e65 2069 6620 7072 6576  x = None if prev
-00002bc0: 5f73 7479 6c65 2069 7320 4e6f 6e65 2065  _style is None e
-00002bd0: 6c73 6520 7072 6576 5f73 7479 6c65 2e63  lse prev_style.c
-00002be0: 7265 6174 655f 6262 6f78 2829 0a20 2020  reate_bbox().   
-00002bf0: 2020 2020 2020 2020 2063 7373 5f6c 6173           css_las
-00002c00: 7420 3d20 6373 730a 2020 2020 2020 2020  t = css.        
-00002c10: 7265 7475 726e 2065 6c65 6d5f 7769 7468  return elem_with
-00002c20: 5f70 6167 656e 6f73 0a0a 2020 2020 6465  _pagenos..    de
-00002c30: 6620 7072 696e 745f 7061 6765 735f 6469  f print_pages_di
-00002c40: 7628 7365 6c66 2c20 7261 6e67 6573 3d4e  v(self, ranges=N
-00002c50: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
-00002c60: 220a 2020 2020 2020 2020 6d61 7962 6520  ".        maybe 
-00002c70: 6a75 7374 2061 2064 6562 7567 6765 720a  just a debugger.
-00002c80: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-00002c90: 2020 2020 2069 6620 7261 6e67 6573 3a0a       if ranges:.
-00002ca0: 2020 2020 2020 2020 2020 2020 4874 6d6c              Html
-00002cb0: 5469 6479 2e64 6562 7567 5f62 795f 7870  Tidy.debug_by_xp
-00002cc0: 6174 6828 7365 6c66 2e72 6177 5f65 6c65  ath(self.raw_ele
-00002cd0: 6d2c 2022 2f68 746d 6c2f 626f 6479 2f73  m, "/html/body/s
-00002ce0: 7061 6e22 2c20 7469 746c 653d 2264 6972  pan", title="dir
-00002cf0: 6563 7420 7370 616e 7320 756e 6465 7220  ect spans under 
-00002d00: 626f 6479 2022 2c0a 2020 2020 2020 2020  body ",.        
-00002d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002d20: 2020 2020 2020 2020 2020 2020 7261 6e67              rang
-00002d30: 653d 7261 6e67 6573 5b30 5d29 2c0a 2020  e=ranges[0]),.  
-00002d40: 2020 2020 2020 2020 2020 4874 6d6c 5469            HtmlTi
-00002d50: 6479 2e64 6562 7567 5f62 795f 7870 6174  dy.debug_by_xpat
-00002d60: 6828 7365 6c66 2e72 6177 5f65 6c65 6d2c  h(self.raw_elem,
-00002d70: 2022 2f68 746d 6c2f 626f 6479 2f73 7061   "/html/body/spa
-00002d80: 6e5b 6469 765d 222c 2074 6974 6c65 3d22  n[div]", title="
-00002d90: 746f 702d 6c65 7665 6c20 7370 616e 7320  top-level spans 
-00002da0: 7769 7468 2064 6976 733f 222c 0a20 2020  with divs?",.   
-00002db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002dd0: 2072 616e 6765 3d72 616e 6765 735b 315d   range=ranges[1]
-00002de0: 290a 2020 2020 2020 2020 2020 2020 4874  ).            Ht
-00002df0: 6d6c 5469 6479 2e64 6562 7567 5f62 795f  mlTidy.debug_by_
-00002e00: 7870 6174 6828 7365 6c66 2e72 6177 5f65  xpath(self.raw_e
-00002e10: 6c65 6d2c 2022 2f68 746d 6c2f 626f 6479  lem, "/html/body
-00002e20: 2f73 7061 6e2f 6469 7622 2c20 7469 746c  /span/div", titl
-00002e30: 653d 2274 6865 2064 6976 7320 696e 2073  e="the divs in s
-00002e40: 746f 702d 6c65 7665 6c20 7370 616e 7322  top-level spans"
-00002e50: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00002e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002e70: 2020 2020 2020 7261 6e67 653d 7261 6e67        range=rang
-00002e80: 6573 5b32 5d29 0a20 2020 2020 2020 2020  es[2]).         
-00002e90: 2020 2022 2222 0a20 2020 2020 2020 2020     """.         
-00002ea0: 2020 2020 2020 203c 6469 7620 7374 796c         <div styl
-00002eb0: 653d 2270 6f73 6974 696f 6e3a 6162 736f  e="position:abso
-00002ec0: 6c75 7465 3b20 746f 703a 3435 3039 7078  lute; top:4509px
-00002ed0: 3b22 3e3c 6120 6e61 6d65 3d22 3622 3e50  ;"><a name="6">P
-00002ee0: 6167 6520 363c 2f61 3e3c 2f64 6976 3e0a  age 6</a></div>.
-00002ef0: 2020 2020 2020 2020 2020 2020 2222 220a              """.
-00002f00: 2020 2020 2020 2020 2020 2020 4874 6d6c              Html
-00002f10: 5469 6479 2e64 6562 7567 5f62 795f 7870  Tidy.debug_by_xp
-00002f20: 6174 6828 7365 6c66 2e72 6177 5f65 6c65  ath(self.raw_ele
-00002f30: 6d2c 2022 2f68 746d 6c2f 626f 6479 2f64  m, "/html/body/d
-00002f40: 6976 5b40 7374 796c 6520 616e 6420 615d  iv[@style and a]
-00002f50: 222c 2074 6974 6c65 3d22 7061 6765 206e  ", title="page n
-00002f60: 756d 6265 7220 626f 7865 7320 756e 6465  umber boxes unde
-00002f70: 7220 626f 6479 222c 0a20 2020 2020 2020  r body",.       
-00002f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002f90: 2020 2020 2020 2020 2020 2020 2072 616e               ran
-00002fa0: 6765 3d72 616e 6765 735b 335d 290a 2020  ge=ranges[3]).  
-00002fb0: 2020 2020 2020 2020 2020 4874 6d6c 5469            HtmlTi
-00002fc0: 6479 2e64 6562 7567 5f62 795f 7870 6174  dy.debug_by_xpat
-00002fd0: 6828 7365 6c66 2e72 6177 5f65 6c65 6d2c  h(self.raw_elem,
-00002fe0: 2022 2f68 746d 6c2f 626f 6479 2f2f 6469   "/html/body//di
-00002ff0: 765b 4073 7479 6c65 2061 6e64 2061 5b63  v[@style and a[c
-00003000: 6f6e 7461 696e 7328 2e2c 2027 5061 6765  ontains(., 'Page
-00003010: 2729 5d5d 222c 0a20 2020 2020 2020 2020  ')]]",.         
-00003020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003030: 2020 2020 2020 2020 2020 2074 6974 6c65             title
-00003040: 3d22 7061 6765 206e 756d 6265 7220 626f  ="page number bo
-00003050: 7865 7320 756e 6465 7220 626f 6479 2f73  xes under body/s
-00003060: 7061 6e22 2c20 7261 6e67 653d 7261 6e67  pan", range=rang
-00003070: 6573 5b34 5d29 0a0a 2020 2020 4063 6c61  es[4])..    @cla
-00003080: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-00003090: 2064 6562 7567 5f62 795f 7870 6174 6828   debug_by_xpath(
-000030a0: 636c 732c 2065 6c65 6d2c 2078 7061 7468  cls, elem, xpath
-000030b0: 2c20 7469 746c 653d 4e6f 6e65 2c20 7261  , title=None, ra
-000030c0: 6e67 653d 4e6f 6e65 2920 2d3e 2069 6e74  nge=None) -> int
-000030d0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-000030e0: 2020 2020 2020 6170 706c 6965 7320 7870        applies xp
-000030f0: 6174 6820 616e 6420 7072 696e 7473 2064  ath and prints d
-00003100: 6562 7567 390a 2020 2020 2020 2020 6173  ebug9.        as
-00003110: 7365 7274 0a20 2020 2020 2020 203a 7061  sert.        :pa
-00003120: 7261 6d20 656c 656d 3a20 746f 2064 6562  ram elem: to deb
-00003130: 7567 0a20 2020 2020 2020 203a 7061 7261  ug.        :para
-00003140: 6d20 7870 6174 683a 2074 6f20 6465 6275  m xpath: to debu
-00003150: 6720 7769 7468 0a20 2020 2020 2020 203a  g with.        :
-00003160: 7265 7475 726e 3a20 7870 6174 6820 636f  return: xpath co
-00003170: 756e 740a 2020 2020 2020 2020 2222 220a  unt.        """.
-00003180: 2020 2020 2020 2020 7370 616e 7320 3d20          spans = 
-00003190: 656c 656d 2e78 7061 7468 2878 7061 7468  elem.xpath(xpath
-000031a0: 290a 2020 2020 2020 2020 6966 2072 616e  ).        if ran
-000031b0: 6765 3a0a 2020 2020 2020 2020 2020 2020  ge:.            
-000031c0: 6173 7365 7274 2072 616e 6765 5b30 5d20  assert range[0] 
-000031d0: 3c3d 206c 656e 2873 7061 6e73 2920 3c3d  <= len(spans) <=
-000031e0: 2072 616e 6765 5b31 5d2c 2066 227b 2727   range[1], f"{''
-000031f0: 2069 6620 6e6f 7420 7469 746c 6520 656c   if not title el
-00003200: 7365 2074 6974 6c65 7d3a 2066 6f75 6e64  se title}: found
-00003210: 3a20 7b6c 656e 2873 7061 6e73 297d 220a  : {len(spans)}".
-00003220: 2020 2020 2020 2020 7265 7475 726e 206c          return l
-00003230: 656e 2873 7061 6e73 290a 0a20 2020 2064  en(spans)..    d
-00003240: 6566 2061 6464 5f65 6c65 6d65 6e74 2873  ef add_element(s
-00003250: 656c 662c 2065 6c65 6d29 3a0a 2020 2020  elf, elem):.    
-00003260: 2020 2020 7365 6c66 2e65 6c65 6d65 6e74      self.element
-00003270: 203d 2065 6c65 6d0a 0a20 2020 2064 6566   = elem..    def
-00003280: 2061 6464 5f64 6573 6365 6e64 616e 745f   add_descendant_
-00003290: 656c 656d 656e 745f 746f 5f72 656d 6f76  element_to_remov
-000032a0: 6528 7365 6c66 2c20 6465 7363 656e 6461  e(self, descenda
-000032b0: 6e74 5f65 6c65 6d29 3a0a 2020 2020 2020  nt_elem):.      
-000032c0: 2020 4874 6d6c 5469 6479 2e61 6464 5f65    HtmlTidy.add_e
-000032d0: 6c65 6d65 6e74 735f 746f 5f73 746f 7265  lements_to_store
-000032e0: 2864 6573 6365 6e64 616e 745f 656c 656d  (descendant_elem
-000032f0: 2c20 7365 6c66 2e64 6573 6365 6e64 616e  , self.descendan
-00003300: 7473 5f74 6f5f 7265 6d6f 7665 290a 0a20  ts_to_remove).. 
-00003310: 2020 2064 6566 2061 6464 5f73 7479 6c65     def add_style
-00003320: 735f 746f 5f72 656d 6f76 6528 7365 6c66  s_to_remove(self
-00003330: 2c20 7374 796c 6529 3a0a 2020 2020 2020  , style):.      
-00003340: 2020 7365 6c66 2e73 7479 6c65 735f 746f    self.styles_to
-00003350: 5f72 656d 6f76 652e 6170 7065 6e64 2873  _remove.append(s
-00003360: 7479 6c65 290a 0a20 2020 2064 6566 2061  tyle)..    def a
-00003370: 6464 5f65 6d70 7479 5f65 6c65 6d65 6e74  dd_empty_element
-00003380: 735f 746f 5f72 656d 6f76 6528 7365 6c66  s_to_remove(self
-00003390: 2c20 656c 656d 735f 746f 5f72 656d 6f76  , elems_to_remov
-000033a0: 6529 3a0a 2020 2020 2020 2020 4874 6d6c  e):.        Html
-000033b0: 5469 6479 2e61 6464 5f65 6c65 6d65 6e74  Tidy.add_element
-000033c0: 735f 746f 5f73 746f 7265 2865 6c65 6d73  s_to_store(elems
-000033d0: 5f74 6f5f 7265 6d6f 7665 2c20 7365 6c66  _to_remove, self
-000033e0: 2e65 6d70 7479 5f65 6c65 6d65 6e74 735f  .empty_elements_
-000033f0: 746f 5f72 656d 6f76 6529 0a0a 2020 2020  to_remove)..    
-00003400: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-00003410: 2064 6566 2061 6464 5f65 6c65 6d65 6e74   def add_element
-00003420: 735f 746f 5f73 746f 7265 2863 6c73 2c20  s_to_store(cls, 
-00003430: 656c 656d 735f 746f 5f73 746f 7265 2c20  elems_to_store, 
-00003440: 656c 656d 5f73 746f 7261 6765 293a 0a20  elem_storage):. 
-00003450: 2020 2020 2020 2069 6620 656c 656d 735f         if elems_
-00003460: 746f 5f73 746f 7265 2069 7320 6e6f 7420  to_store is not 
-00003470: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00003480: 2020 6966 206e 6f74 2074 7970 6528 656c    if not type(el
-00003490: 656d 735f 746f 5f73 746f 7265 2920 6973  ems_to_store) is
-000034a0: 206c 6973 743a 0a20 2020 2020 2020 2020   list:.         
-000034b0: 2020 2020 2020 2065 6c65 6d73 5f74 6f5f         elems_to_
-000034c0: 7374 6f72 6520 3d20 6c69 7374 2865 6c65  store = list(ele
-000034d0: 6d73 5f74 6f5f 7374 6f72 6529 0a20 2020  ms_to_store).   
-000034e0: 2020 2020 2020 2020 2065 6c65 6d5f 7374           elem_st
-000034f0: 6f72 6167 652e 6578 7465 6e64 2865 6c65  orage.extend(ele
-00003500: 6d73 5f74 6f5f 7374 6f72 6529 0a0a 2020  ms_to_store)..  
-00003510: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-00003520: 2020 2064 6566 2065 6e73 7572 655f 6874     def ensure_ht
-00003530: 6d6c 5f68 6561 645f 626f 6479 2863 6c73  ml_head_body(cls
-00003540: 2c20 6874 6d6c 5f65 6c65 6d29 3a0a 2020  , html_elem):.  
-00003550: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00003560: 2020 6164 6473 203c 6874 6d6c 3e2c 203c    adds <html>, <
-00003570: 6865 6164 3e2c 203c 626f 6479 3e20 6966  head>, <body> if
-00003580: 206e 6f74 2070 7265 7365 6e74 0a20 2020   not present.   
-00003590: 2020 2020 204d 6f76 6520 746f 2048 544d       Move to HTM
-000035a0: 4c54 6964 790a 2020 2020 2020 2020 2222  LTidy.        ""
-000035b0: 220a 2020 2020 2020 2020 6874 6d6c 5f65  ".        html_e
-000035c0: 6c65 6d20 3d20 636c 732e 5f65 6e73 7572  lem = cls._ensur
-000035d0: 655f 6874 6d6c 5f72 6f6f 7428 6874 6d6c  e_html_root(html
-000035e0: 5f65 6c65 6d29 0a20 2020 2020 2020 2068  _elem).        h
-000035f0: 746d 6c5f 7769 7468 5f68 6561 6420 3d20  tml_with_head = 
-00003600: 636c 732e 5f65 6e73 7572 655f 6865 6164  cls._ensure_head
-00003610: 626f 6479 2868 746d 6c5f 656c 656d 2c20  body(html_elem, 
-00003620: 2268 6561 6422 2c20 3029 0a20 2020 2020  "head", 0).     
-00003630: 2020 2068 746d 6c5f 7769 7468 5f68 6561     html_with_hea
-00003640: 645f 626f 6479 203d 2063 6c73 2e5f 656e  d_body = cls._en
-00003650: 7375 7265 5f68 6561 6462 6f64 7928 6874  sure_headbody(ht
-00003660: 6d6c 5f77 6974 685f 6865 6164 2c20 2262  ml_with_head, "b
-00003670: 6f64 7922 2c20 3129 0a20 2020 2020 2020  ody", 1).       
-00003680: 2068 746d 6c5f 6964 6561 6c20 3d20 636c   html_ideal = cl
-00003690: 732e 5f74 6964 795f 6e6f 6e5f 6865 6164  s._tidy_non_head
-000036a0: 5f62 6f64 795f 6368 696c 6472 656e 2868  _body_children(h
-000036b0: 746d 6c5f 7769 7468 5f68 6561 645f 626f  tml_with_head_bo
-000036c0: 6479 290a 2020 2020 2020 2020 7265 7475  dy).        retu
-000036d0: 726e 2068 746d 6c5f 6964 6561 6c0a 0a20  rn html_ideal.. 
-000036e0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-000036f0: 2020 2020 6465 6620 5f65 6e73 7572 655f      def _ensure_
-00003700: 6865 6164 626f 6479 2863 6c73 2c20 6874  headbody(cls, ht
-00003710: 6d6c 5f72 6f6f 742c 2074 6167 2c20 706f  ml_root, tag, po
-00003720: 7329 3a0a 2020 2020 2020 2020 6465 7363  s):.        desc
-00003730: 656e 6473 203d 206c 656e 2868 746d 6c5f  ends = len(html_
-00003740: 726f 6f74 2e78 7061 7468 2866 222e 2f2f  root.xpath(f".//
-00003750: 7b74 6167 7d22 2929 0a20 2020 2020 2020  {tag}")).       
-00003760: 2069 6620 6465 7363 656e 6473 203e 2031   if descends > 1
-00003770: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
-00003780: 6767 696e 672e 7761 726e 696e 6728 6622  gging.warning(f"
-00003790: 6d6f 7265 2074 6861 6e20 3120 7b74 6167  more than 1 {tag
-000037a0: 7d3b 2063 616e 6e6f 7420 7072 6f63 6573  }; cannot proces
-000037b0: 7322 290a 2020 2020 2020 2020 656c 6966  s").        elif
-000037c0: 2064 6573 6365 6e64 7320 3d3d 2031 3a0a   descends == 1:.
-000037d0: 2020 2020 2020 2020 2020 2020 2320 6f6e              # on
-000037e0: 6520 7461 672c 206f 6b0a 2020 2020 2020  e tag, ok.      
-000037f0: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
-00003800: 2020 2065 6c69 6620 6465 7363 656e 6473     elif descends
-00003810: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-00003820: 2020 2068 6561 6420 3d20 4554 2e45 6c65     head = ET.Ele
-00003830: 6d65 6e74 2874 6167 290a 2020 2020 2020  ment(tag).      
-00003840: 2020 2020 2020 6874 6d6c 5f72 6f6f 742e        html_root.
-00003850: 696e 7365 7274 2870 6f73 2c20 6865 6164  insert(pos, head
-00003860: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00003870: 2068 746d 6c5f 726f 6f74 0a0a 2020 2020   html_root..    
-00003880: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-00003890: 2064 6566 205f 656e 7375 7265 5f68 746d   def _ensure_htm
-000038a0: 6c5f 726f 6f74 2863 6c73 2c20 6874 6d6c  l_root(cls, html
-000038b0: 5f65 6c65 6d29 3a0a 2020 2020 2020 2020  _elem):.        
-000038c0: 2222 220a 2020 2020 2020 2020 6966 2072  """.        if r
-000038d0: 6f6f 7420 656c 656d 656e 7420 6973 206e  oot element is n
-000038e0: 6f74 203c 6874 6d6c 3e20 6372 6561 7465  ot <html> create
-000038f0: 7320 6f6e 6520 616e 6420 7472 616e 7366  s one and transf
-00003900: 6572 7320 6368 696c 6472 656e 0a20 2020  ers children.   
-00003910: 2020 2020 203a 7061 7261 6d20 6874 6d6c       :param html
-00003920: 5f65 6c65 6d3a 206f 6c64 2045 6c65 6d65  _elem: old Eleme
-00003930: 6e74 5472 6565 206f 7220 726f 6f74 2045  ntTree or root E
-00003940: 6c65 6d65 6e74 0a20 2020 2020 2020 2022  lement.        "
-00003950: 2222 0a20 2020 2020 2020 206f 6c64 5f72  "".        old_r
-00003960: 6f6f 7420 3d20 6874 6d6c 5f65 6c65 6d2e  oot = html_elem.
-00003970: 6765 7472 6f6f 7428 2920 6966 2074 7970  getroot() if typ
-00003980: 6528 6874 6d6c 5f65 6c65 6d29 2069 7320  e(html_elem) is 
-00003990: 5f45 6c65 6d65 6e74 5472 6565 2065 6c73  _ElementTree els
-000039a0: 6520 6874 6d6c 5f65 6c65 6d0a 2020 2020  e html_elem.    
-000039b0: 2020 2020 6874 6d6c 7320 3d20 6874 6d6c      htmls = html
-000039c0: 5f65 6c65 6d2e 7870 6174 6828 222f 6874  _elem.xpath("/ht
-000039d0: 6d6c 2229 0a20 2020 2020 2020 2069 6620  ml").        if 
-000039e0: 6c65 6e28 6874 6d6c 7329 203d 3d20 303a  len(htmls) == 0:
-000039f0: 0a20 2020 2020 2020 2020 2020 2068 746d  .            htm
-00003a00: 6c5f 726f 6f74 203d 2045 542e 456c 656d  l_root = ET.Elem
-00003a10: 656e 7428 2268 746d 6c22 290a 2020 2020  ent("html").    
-00003a20: 2020 2020 2020 2020 6874 6d6c 5f72 6f6f          html_roo
-00003a30: 742e 696e 7365 7274 2830 2c20 6f6c 645f  t.insert(0, old_
-00003a40: 726f 6f74 290a 2020 2020 2020 2020 2020  root).          
-00003a50: 2020 7265 7475 726e 2068 746d 6c5f 726f    return html_ro
-00003a60: 6f74 0a20 2020 2020 2020 2072 6574 7572  ot.        retur
-00003a70: 6e20 6874 6d6c 5f65 6c65 6d0a 0a20 2020  n html_elem..   
-00003a80: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-00003a90: 2020 6465 6620 5f74 6964 795f 6e6f 6e5f    def _tidy_non_
-00003aa0: 6865 6164 5f62 6f64 795f 6368 696c 6472  head_body_childr
-00003ab0: 656e 2863 6c73 2c20 6874 6d6c 5f77 6974  en(cls, html_wit
-00003ac0: 685f 6865 6164 5f62 6f64 7929 3a0a 0a20  h_head_body):.. 
-00003ad0: 2020 2020 2020 2068 6561 645f 656c 656d         head_elem
-00003ae0: 7320 3d20 6874 6d6c 5f77 6974 685f 6865  s = html_with_he
-00003af0: 6164 5f62 6f64 792e 7870 6174 6828 4874  ad_body.xpath(Ht
-00003b00: 6d6c 5469 6479 2e48 4541 445f 454c 454d  mlTidy.HEAD_ELEM
-00003b10: 535f 494e 5f58 5041 5448 290a 2020 2020  S_IN_XPATH).    
-00003b20: 2020 2020 6865 6164 203d 2068 746d 6c5f      head = html_
-00003b30: 7769 7468 5f68 6561 645f 626f 6479 2e78  with_head_body.x
-00003b40: 7061 7468 2822 6865 6164 2229 5b30 5d0a  path("head")[0].
-00003b50: 2020 2020 2020 2020 666f 7220 656c 656d          for elem
-00003b60: 2069 6e20 6865 6164 5f65 6c65 6d73 3a0a   in head_elems:.
-00003b70: 2020 2020 2020 2020 2020 2020 6865 6164              head
-00003b80: 2e61 7070 656e 6428 656c 656d 290a 2020  .append(elem).  
-00003b90: 2020 2020 2020 7265 7374 5f65 6c65 6d73        rest_elems
-00003ba0: 203d 2068 746d 6c5f 7769 7468 5f68 6561   = html_with_hea
-00003bb0: 645f 626f 6479 2e78 7061 7468 2822 2a5b  d_body.xpath("*[
-00003bc0: 6e6f 7428 6e61 6d65 2829 3d27 6865 6164  not(name()='head
-00003bd0: 2729 2061 6e64 206e 6f74 286e 616d 6528  ') and not(name(
-00003be0: 293d 2762 6f64 7927 295d 2229 0a20 2020  )='body')]").   
-00003bf0: 2020 2020 2062 6f64 7920 3d20 6874 6d6c       body = html
-00003c00: 5f77 6974 685f 6865 6164 5f62 6f64 792e  _with_head_body.
-00003c10: 7870 6174 6828 2262 6f64 7922 295b 305d  xpath("body")[0]
-00003c20: 0a20 2020 2020 2020 2066 6f72 2065 6c65  .        for ele
-00003c30: 6d20 696e 2072 6573 745f 656c 656d 733a  m in rest_elems:
-00003c40: 0a20 2020 2020 2020 2020 2020 2062 6f64  .            bod
-00003c50: 792e 6170 7065 6e64 2865 6c65 6d29 0a20  y.append(elem). 
-00003c60: 2020 2020 2020 2072 6574 7572 6e20 6874         return ht
-00003c70: 6d6c 5f77 6974 685f 6865 6164 5f62 6f64  ml_with_head_bod
-00003c80: 790a 0a20 2020 2040 636c 6173 736d 6574  y..    @classmet
-00003c90: 686f 640a 2020 2020 6465 6620 636f 6e63  hod.    def conc
-00003ca0: 6174 656e 6174 655f 7370 616e 735f 7769  atenate_spans_wi
-00003cb0: 7468 5f69 6465 6e74 6963 616c 5f73 7479  th_identical_sty
-00003cc0: 6c65 7328 636c 732c 2065 6c65 6d2c 2061  les(cls, elem, a
-00003cd0: 6464 7370 6163 653d 5472 7565 293a 0a0a  ddspace=True):..
-00003ce0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00003cf0: 2020 2020 536f 6d65 7469 6d65 7320 756e      Sometimes un
-00003d00: 6e65 6365 7373 6172 7920 7370 616e 7320  necessary spans 
-00003d10: 6172 6520 6372 6561 7465 6420 2865 2e67  are created (e.g
-00003d20: 2e0a 2020 2020 2020 2020 3c73 7061 6e20  ..        <span 
-00003d30: 636c 6173 733d 2773 3127 3e66 6f6f 3c2f  class='s1'>foo</
-00003d40: 7370 616e 3e3c 7370 616e 6520 636c 6173  span><spane clas
-00003d50: 733d 2273 3122 3e62 6172 3c2f 7370 616e  s="s1">bar</span
-00003d60: 3e0a 2020 2020 2020 2020 6372 6561 7465  >.        create
-00003d70: 7320 3c73 7061 6e20 636c 6173 733d 2273  s <span class="s
-00003d80: 3122 3e66 6f6f 2062 6172 3c2f 7370 616e  1">foo bar</span
-00003d90: 3e0a 2020 2020 2020 2020 3a70 6172 616d  >.        :param
-00003da0: 2065 6c65 6d3a 2070 726f 6261 626c 7920   elem: probably 
-00003db0: 6120 6469 7620 7769 7468 2063 6869 6c64  a div with child
-00003dc0: 2073 7061 6e73 0a20 2020 2020 2020 203a   spans.        :
-00003dd0: 7061 7261 6d20 6164 6473 7061 6365 3a20  param addspace: 
-00003de0: 696e 7365 7274 2073 7061 6365 0a20 2020  insert space.   
-00003df0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00003e00: 2073 7061 6e73 203d 2065 6c65 6d2e 7870   spans = elem.xp
-00003e10: 6174 6828 222e 2f73 7061 6e5b 4063 6c61  ath("./span[@cla
-00003e20: 7373 5d22 290a 2020 2020 2020 2020 6c61  ss]").        la
-00003e30: 7374 5f73 7061 6e20 3d20 4e6f 6e65 0a20  st_span = None. 
-00003e40: 2020 2020 2020 2073 7061 6365 7320 3d20         spaces = 
-00003e50: 2222 2069 6620 6e6f 7420 6164 6473 7061  "" if not addspa
-00003e60: 6365 2065 6c73 6520 2220 220a 2020 2020  ce else " ".    
-00003e70: 2020 2020 666f 7220 7370 616e 2069 6e20      for span in 
-00003e80: 7370 616e 733a 0a20 2020 2020 2020 2020  spans:.         
-00003e90: 2020 2069 6620 6c61 7374 5f73 7061 6e20     if last_span 
-00003ea0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-00003eb0: 6c61 7374 5f73 7061 6e2e 6174 7472 6962  last_span.attrib
-00003ec0: 5b22 636c 6173 7322 5d20 3d3d 2073 7061  ["class"] == spa
-00003ed0: 6e2e 6174 7472 6962 5b22 636c 6173 7322  n.attrib["class"
-00003ee0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00003ef0: 2020 206c 6173 745f 7370 616e 2e74 6578     last_span.tex
-00003f00: 7420 3d20 6c61 7374 5f73 7061 6e2e 7465  t = last_span.te
-00003f10: 7874 202b 2073 7061 6365 7320 2b20 7370  xt + spaces + sp
-00003f20: 616e 2e74 6578 740a 2020 2020 2020 2020  an.text.        
-00003f30: 2020 2020 2020 2020 656c 656d 2e72 656d          elem.rem
-00003f40: 6f76 6528 7370 616e 290a 2020 2020 2020  ove(span).      
-00003f50: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00003f60: 2020 2020 2020 2020 2020 2020 6c61 7374              last
-00003f70: 5f73 7061 6e20 3d20 7370 616e 0a0a 0a64  _span = span...d
-00003f80: 6566 2067 6574 5f74 6172 6765 745f 6872  ef get_target_hr
-00003f90: 6566 2874 6172 6765 745f 6964 293a 0a20  ef(target_id):. 
-00003fa0: 2020 2072 655f 7461 7267 6574 203d 2072     re_target = r
-00003fb0: 652e 636f 6d70 696c 6528 0a20 2020 2020  e.compile(.     
-00003fc0: 2020 2022 5c5c 732a 283f 503c 7265 706f     "\\s*(?P<repo
-00003fd0: 7274 3e57 4749 7c57 4749 497c 5747 4949  rt>WGI|WGII|WGII
-00003fe0: 497c 5352 4343 4c7c 5352 4f43 437c 5352  I|SRCCL|SROCC|SR
-00003ff0: 3135 7c53 5952 295c 5c73 2b28 3f50 3c63  15|SYR)\\s+(?P<c
-00004000: 6861 7074 6572 3e53 504d 7c54 5329 5c5c  hapter>SPM|TS)\\
-00004010: 732b 283f 503c 7365 6374 696f 6e3e 5b41  s+(?P<section>[A
-00004020: 2d47 5d5c 5c2e 3f5c 5c64 2b28 3f3a 5c5c  -G]\\.?\\d+(?:\\
-00004030: 2e5c 5c64 2b29 2a29 2229 0a20 2020 2067  .\\d+)*)").    g
-00004040: 6974 6875 625f 6261 7365 203d 2022 6874  ithub_base = "ht
-00004050: 7470 733a 2f2f 6874 6d6c 7072 6576 6965  tps://htmlprevie
-00004060: 772e 6769 7468 7562 2e69 6f2f 3f68 7474  w.github.io/?htt
-00004070: 7073 3a2f 2f67 6974 6875 622e 636f 6d22  ps://github.com"
-00004080: 0a20 2020 2077 6f72 6b69 6e67 5f75 726c  .    working_url
-00004090: 203d 2022 6874 7470 733a 2f2f 6874 6d6c   = "https://html
-000040a0: 7072 6576 6965 772e 6769 7468 7562 2e69  preview.github.i
-000040b0: 6f2f 3f68 7474 7073 3a2f 2f67 6974 6875  o/?https://githu
-000040c0: 622e 636f 6d2f 7065 7465 726d 722f 7365  b.com/petermr/se
-000040d0: 6d61 6e74 6963 436c 696d 6174 652f 626c  manticClimate/bl
-000040e0: 6f62 2f6d 6169 6e2f 7465 7374 2e68 746d  ob/main/test.htm
-000040f0: 6c22 0a20 2020 2072 6570 6f72 745f 6469  l".    report_di
-00004100: 6374 203d 207b 0a20 2020 2020 2020 2022  ct = {.        "
-00004110: 7767 6922 3a20 2277 6731 222c 0a20 2020  wgi": "wg1",.   
-00004120: 2020 2020 2022 7767 6969 223a 2022 7767       "wgii": "wg
-00004130: 3222 2c0a 2020 2020 2020 2020 2277 6769  2",.        "wgi
-00004140: 6969 223a 2022 7767 3322 2c0a 2020 2020  ii": "wg3",.    
-00004150: 7d0a 2020 2020 6872 6566 203d 2022 220a  }.    href = "".
-00004160: 2020 2020 6d61 7463 6820 3d20 7265 5f74      match = re_t
-00004170: 6172 6765 742e 6d61 7463 6828 7461 7267  arget.match(targ
-00004180: 6574 5f69 6429 0a20 2020 2069 6620 6d61  et_id).    if ma
-00004190: 7463 683a 0a20 2020 2020 2020 2072 6570  tch:.        rep
-000041a0: 6f72 7420 3d20 6d61 7463 682e 6772 6f75  ort = match.grou
-000041b0: 7028 2272 6570 6f72 7422 292e 6c6f 7765  p("report").lowe
-000041c0: 7228 290a 2020 2020 2020 2020 7265 706f  r().        repo
-000041d0: 7274 3120 3d20 7265 706f 7274 5f64 6963  rt1 = report_dic
-000041e0: 742e 6765 7428 7265 706f 7274 290a 2020  t.get(report).  
-000041f0: 2020 2020 2020 7265 706f 7274 203d 2072        report = r
-00004200: 6570 6f72 7431 2069 6620 7265 706f 7274  eport1 if report
-00004210: 3120 656c 7365 2072 6570 6f72 740a 2020  1 else report.  
-00004220: 2020 2020 2020 6368 6170 7465 7220 3d20        chapter = 
-00004230: 6d61 7463 682e 6772 6f75 7028 2263 6861  match.group("cha
-00004240: 7074 6572 2229 2e6c 6f77 6572 2829 0a20  pter").lower(). 
-00004250: 2020 2020 2020 2073 6563 7469 6f6e 203d         section =
-00004260: 206d 6174 6368 2e67 726f 7570 2822 7365   match.group("se
-00004270: 6374 696f 6e22 292e 6c6f 7765 7228 290a  ction").lower().
-00004280: 2020 2020 2020 2020 6872 6566 203d 2066          href = f
-00004290: 227b 6769 7468 7562 5f62 6173 657d 2f70  "{github_base}/p
-000042a0: 6574 6572 6d72 2f73 656d 616e 7469 6343  etermr/semanticC
-000042b0: 6c69 6d61 7465 2f62 6c6f 622f 6d61 696e  limate/blob/main
-000042c0: 2f61 7236 2f61 7236 2f7b 7265 706f 7274  /ar6/ar6/{report
-000042d0: 7d2f 7b63 6861 7074 6572 7d2f 6874 6d6c  }/{chapter}/html
-000042e0: 2f66 756c 6c74 6578 742f 6772 6f75 7073  /fulltext/groups
-000042f0: 5f67 726f 7570 732e 6874 6d6c 237b 7365  _groups.html#{se
-00004300: 6374 696f 6e7d 220a 0a20 2020 2072 6574  ction}"..    ret
-00004310: 7572 6e20 6872 6566 0a0a 0a63 6c61 7373  urn href...class
-00004320: 2048 746d 6c47 726f 7570 3a0a 2020 2020   HtmlGroup:.    
-00004330: 2222 2267 726f 7570 7320 7369 626c 696e  """groups siblin
-00004340: 6773 2069 6e74 6f20 6469 7673 2222 220a  gs into divs""".
-00004350: 0a20 2020 2044 4546 4155 4c54 5f53 5459  .    DEFAULT_STY
-00004360: 4c45 5320 3d20 5b0a 2020 2020 2020 2020  LES = [.        
-00004370: 2822 2e73 6563 7469 6f6e 5f74 6974 6c65  (".section_title
-00004380: 222c 205b 2822 636f 6c6f 7222 2c20 2272  ", [("color", "r
-00004390: 6564 3b22 295d 292c 0a20 2020 2020 2020  ed;")]),.       
-000043a0: 2028 222e 7375 625f 7365 6374 696f 6e5f   (".sub_section_
-000043b0: 7469 746c 6522 2c20 5b28 2263 6f6c 6f72  title", [("color
-000043c0: 222c 2022 626c 7565 3b22 295d 292c 0a20  ", "blue;")]),. 
-000043d0: 2020 2020 2020 2028 222e 7375 625f 7375         (".sub_su
-000043e0: 625f 7365 6374 696f 6e5f 7469 746c 6522  b_section_title"
-000043f0: 2c20 5b28 2263 6f6c 6f72 222c 2022 6772  , [("color", "gr
-00004400: 6565 6e3b 2229 5d29 2c0a 2020 2020 2020  een;")]),.      
-00004410: 2020 2822 2e63 6f6e 6669 6465 6e63 6522    (".confidence"
-00004420: 2c20 5b28 2263 6f6c 6f72 222c 2022 6f72  , [("color", "or
-00004430: 616e 6765 3b22 295d 292c 0a20 2020 2020  ange;")]),.     
-00004440: 2020 2028 222e 7072 6f62 6162 696c 6974     (".probabilit
-00004450: 7922 2c20 5b28 2263 6f6c 6f72 222c 2022  y", [("color", "
-00004460: 2338 3838 3866 663b 2229 5d29 2c0a 2020  #8888ff;")]),.  
-00004470: 2020 2020 2020 2822 2e73 7570 6572 7363        (".supersc
-00004480: 7269 7074 222c 205b 2822 636f 6c6f 7222  ript", [("color"
-00004490: 2c20 226d 6167 656e 7461 3b22 292c 2028  , "magenta;"), (
-000044a0: 2262 6163 6b67 726f 756e 6422 2c20 2279  "background", "y
-000044b0: 656c 6c6f 773b 2229 5d29 2c0a 2020 2020  ellow;")]),.    
-000044c0: 2020 2020 2822 2e63 6875 6e6b 222c 205b      (".chunk", [
-000044d0: 2822 6261 636b 6772 6f75 6e64 222c 2022  ("background", "
-000044e0: 6379 616e 3b22 295d 292c 0a20 2020 2020  cyan;")]),.     
-000044f0: 2020 2028 222e 7461 7267 6574 7322 2c20     (".targets", 
-00004500: 5b28 2262 6163 6b67 726f 756e 6422 2c20  [("background", 
-00004510: 2223 3838 6666 3838 3b22 295d 292c 0a20  "#88ff88;")]),. 
-00004520: 2020 2020 2020 2028 222e 7374 6172 7422         (".start"
-00004530: 2c20 5b28 2262 6163 6b67 726f 756e 6422  , [("background"
-00004540: 2c20 2267 7261 793b 2229 5d29 2c0a 2020  , "gray;")]),.  
-00004550: 2020 2020 2020 2822 2e65 6e64 222c 205b        (".end", [
-00004560: 2822 6261 636b 6772 6f75 6e64 222c 2022  ("background", "
-00004570: 7965 6c6c 6f77 3b22 295d 292c 0a20 2020  yellow;")]),.   
-00004580: 2020 2020 2028 222e 7061 6765 222c 205b       (".page", [
-00004590: 2822 6261 636b 6772 6f75 6e64 222c 2022  ("background", "
-000045a0: 6d61 6765 6e74 613b 2229 5d29 2c0a 2020  magenta;")]),.  
-000045b0: 2020 2020 2020 2822 2e73 7461 7465 6d65        (".stateme
-000045c0: 6e74 222c 205b 2822 6261 636b 6772 6f75  nt", [("backgrou
-000045d0: 6e64 222c 2022 2364 6464 6466 663b 2229  nd", "#ddddff;")
-000045e0: 5d29 2c0a 2020 2020 2020 2020 2822 2e6c  ]),.        (".l
-000045f0: 6576 656c 3122 2c20 5b28 2262 6163 6b67  evel1", [("backg
-00004600: 726f 756e 6422 2c20 2223 6666 6666 6464  round", "#ffffdd
-00004610: 3b22 295d 292c 0a20 2020 2020 2020 2028  ;")]),.        (
-00004620: 222e 6c65 7665 6c32 222c 205b 2822 6261  ".level2", [("ba
-00004630: 636b 6772 6f75 6e64 222c 2022 2364 6466  ckground", "#ddf
-00004640: 6666 663b 2229 5d29 2c0a 2020 2020 2020  fff;")]),.      
-00004650: 2020 2822 2e6c 6576 656c 3322 2c20 5b28    (".level3", [(
-00004660: 2262 6163 6b67 726f 756e 6422 2c20 2223  "background", "#
-00004670: 6464 6666 6464 3b22 295d 292c 0a20 2020  ddffdd;")]),.   
-00004680: 2020 2020 2028 222e 666f 6f74 6e6f 7465       (".footnote
-00004690: 222c 205b 2822 6261 636b 6772 6f75 6e64  ", [("background
-000046a0: 222c 2022 2366 6664 6466 663b 2229 5d29  ", "#ffddff;")])
-000046b0: 2c0a 2020 2020 5d0a 0a20 2020 2040 636c  ,.    ]..    @cl
-000046c0: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-000046d0: 6620 6765 6e65 7261 7465 5f6c 6f77 6572  f generate_lower
-000046e0: 6361 7365 5f6c 6574 7465 725f 6964 2863  case_letter_id(c
-000046f0: 6c73 2c20 6929 3a0a 2020 2020 2020 2020  ls, i):.        
-00004700: 226d 616b 6520 6964 206f 6620 666f 726d  "make id of form
-00004710: 2061 2c62 2c63 2c20 2e2e 2e20 6161 2c20   a,b,c, ... aa, 
-00004720: 6162 2c20 6163 202e 2e2e 2062 612c 2062  ab, ac ... ba, b
-00004730: 622c 202e 2e2e 207a 7a20 2c20 402e 7374  b, ... zz , @.st
-00004740: 7228 6929 220a 2020 2020 2020 2020 6162  r(i)".        ab
-00004750: 6320 3d20 2261 6263 6465 6667 6869 6a6b  c = "abcdefghijk
-00004760: 6c6d 6e6f 7071 7273 7475 7677 7879 7a22  lmnopqrstuvwxyz"
-00004770: 0a20 2020 2020 2020 2069 6920 3d20 6920  .        ii = i 
-00004780: 2520 3236 0a20 2020 2020 2020 206a 6a20  % 26.        jj 
-00004790: 3d20 6920 2f2f 2032 360a 2020 2020 2020  = i // 26.      
-000047a0: 2020 6966 2069 203e 3d20 3136 202a 2031    if i >= 16 * 1
-000047b0: 363a 0a20 2020 2020 2020 2020 2020 2072  6:.            r
-000047c0: 6574 7572 6e20 2240 2e22 202b 2073 7472  eturn "@." + str
-000047d0: 2869 290a 2020 2020 2020 2020 7320 3d20  (i).        s = 
-000047e0: 2222 2069 6620 6a6a 203d 3d20 3020 656c  "" if jj == 0 el
-000047f0: 7365 2061 6263 5b6a 6a20 2d20 315d 0a20  se abc[jj - 1]. 
-00004800: 2020 2020 2020 2072 6574 7572 6e20 7320         return s 
-00004810: 2b20 6162 635b 6969 5d0a 0a20 2020 2040  + abc[ii]..    @
-00004820: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-00004830: 6465 6620 6772 6f75 705f 7369 626c 696e  def group_siblin
-00004840: 6773 2863 6c73 2c20 6874 6d6c 5f65 6c65  gs(cls, html_ele
-00004850: 6d2c 206c 6f63 6174 6f72 3d4e 6f6e 652c  m, locator=None,
-00004860: 2070 6172 656e 745f 6c6f 6361 746f 723d   parent_locator=
-00004870: 4e6f 6e65 2c20 7374 796c 653d 4e6f 6e65  None, style=None
-00004880: 2c20 6465 6275 673d 4661 6c73 6529 3a0a  , debug=False):.
-00004890: 2020 2020 2020 2020 2222 2265 7672 7974          """evryt
-000048a0: 6869 6e67 2073 7461 7274 7320 6173 2061  hing starts as a
-000048b0: 2073 6962 6c69 6e67 2122 2222 0a20 2020   sibling!""".   
-000048c0: 2020 2020 2073 6563 7469 6f6e 7320 3d20       sections = 
-000048d0: 6874 6d6c 5f65 6c65 6d2e 7870 6174 6828  html_elem.xpath(
-000048e0: 6622 2e2f 2f73 7061 6e5b 7374 6172 7473  f".//span[starts
-000048f0: 2d77 6974 6828 4063 6c61 7373 2c20 277b  -with(@class, '{
-00004900: 6c6f 6361 746f 727d 2729 5d22 290a 2020  locator}')]").  
-00004910: 2020 2020 2020 6665 6e63 6570 6f73 7473        fenceposts
-00004920: 203d 2068 746d 6c5f 656c 656d 2e78 7061   = html_elem.xpa
-00004930: 7468 2866 222e 2f2f 7370 616e 5b73 7461  th(f".//span[sta
-00004940: 7274 732d 7769 7468 2840 636c 6173 732c  rts-with(@class,
-00004950: 277b 7061 7265 6e74 5f6c 6f63 6174 6f72  '{parent_locator
-00004960: 7d27 295d 2229 0a20 2020 2020 2020 2069  }')]").        i
-00004970: 6620 6c65 6e28 7365 6374 696f 6e73 2920  f len(sections) 
-00004980: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
-00004990: 2070 6172 656e 7420 3d20 7365 6374 696f   parent = sectio
-000049a0: 6e73 5b30 5d2e 6765 7470 6172 656e 7428  ns[0].getparent(
-000049b0: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
-000049c0: 7220 7365 6374 696f 6e20 696e 2073 6563  r section in sec
-000049d0: 7469 6f6e 733a 0a20 2020 2020 2020 2020  tions:.         
-000049e0: 2020 2020 2020 2063 6c73 2e67 726f 7570         cls.group
-000049f0: 5f73 6962 6c69 6e67 735f 6265 7477 6565  _siblings_betwee
-00004a00: 6e5f 6665 6e63 6570 6f73 7473 2866 656e  n_fenceposts(fen
-00004a10: 6365 706f 7374 732c 2073 7479 6c65 3d73  ceposts, style=s
-00004a20: 7479 6c65 2c20 6465 6275 673d 6465 6275  tyle, debug=debu
-00004a30: 6729 0a0a 2020 2020 4063 6c61 7373 6d65  g)..    @classme
-00004a40: 7468 6f64 0a20 2020 2064 6566 2067 726f  thod.    def gro
-00004a50: 7570 5f73 6962 6c69 6e67 735f 6265 7477  up_siblings_betw
-00004a60: 6565 6e5f 6665 6e63 6570 6f73 7473 2863  een_fenceposts(c
-00004a70: 6c73 2c20 6665 6e63 6570 6f73 7473 2c20  ls, fenceposts, 
-00004a80: 7374 796c 653d 4e6f 6e65 2c20 6465 6275  style=None, debu
-00004a90: 673d 4661 6c73 6529 3a0a 2020 2020 2020  g=False):.      
-00004aa0: 2020 666f 7220 692c 2066 656e 6365 706f    for i, fencepo
-00004ab0: 7374 2069 6e20 656e 756d 6572 6174 6528  st in enumerate(
-00004ac0: 6665 6e63 6570 6f73 7473 293a 0a20 2020  fenceposts):.   
-00004ad0: 2020 2020 2020 2020 2066 656e 6365 706f           fencepo
-00004ae0: 7374 5f66 6f6c 6c6f 7765 7273 203d 2066  st_followers = f
-00004af0: 656e 6365 706f 7374 2e78 7061 7468 2822  encepost.xpath("
-00004b00: 666f 6c6c 6f77 696e 672d 7369 626c 696e  following-siblin
-00004b10: 673a 3a64 6976 5b73 7061 6e5d 2229 0a20  g::div[span]"). 
-00004b20: 2020 2020 2020 2020 2020 2063 6f6e 7461             conta
-00004b30: 696e 6572 5f64 6976 203d 2045 542e 456c  iner_div = ET.El
-00004b40: 656d 656e 7428 2264 6976 2229 0a20 2020  ement("div").   
-00004b50: 2020 2020 2020 2020 2063 6f6e 7461 696e           contain
-00004b60: 6572 5f64 6976 2e61 7474 7269 625b 2273  er_div.attrib["s
-00004b70: 7479 6c65 225d 203d 2073 7479 6c65 0a20  tyle"] = style. 
-00004b80: 2020 2020 2020 2020 2020 2066 656e 6365             fence
-00004b90: 706f 7374 2e61 6464 7072 6576 696f 7573  post.addprevious
-00004ba0: 2863 6f6e 7461 696e 6572 5f64 6976 290a  (container_div).
-00004bb0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00004bc0: 6169 6e65 725f 6469 762e 6170 7065 6e64  ainer_div.append
-00004bd0: 2866 656e 6365 706f 7374 290a 2020 2020  (fencepost).    
-00004be0: 2020 2020 2020 2020 7469 746c 6520 3d20          title = 
-00004bf0: 6665 6e63 6570 6f73 742e 7870 6174 6828  fencepost.xpath(
-00004c00: 2273 7061 6e22 295b 305d 2e61 7474 7269  "span")[0].attri
-00004c10: 622e 6765 7428 2269 6422 290a 2020 2020  b.get("id").    
-00004c20: 2020 2020 2020 2020 6966 2074 6974 6c65          if title
-00004c30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00004c40: 2020 636f 6e74 6169 6e65 725f 6469 762e    container_div.
-00004c50: 6174 7472 6962 5b22 7469 746c 6522 5d20  attrib["title"] 
-00004c60: 3d20 7469 746c 650a 2020 2020 2020 2020  = title.        
-00004c70: 2020 2020 666f 7220 666f 6c6c 6f77 6572      for follower
-00004c80: 2069 6e20 6665 6e63 6570 6f73 745f 666f   in fencepost_fo
-00004c90: 6c6c 6f77 6572 733a 0a20 2020 2020 2020  llowers:.       
-00004ca0: 2020 2020 2020 2020 2069 6620 666f 6c6c           if foll
-00004cb0: 6f77 6572 2069 6e20 6665 6e63 6570 6f73  ower in fencepos
-00004cc0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-00004cd0: 2020 2020 2020 2020 6964 203d 2066 6f6c          id = fol
-00004ce0: 6c6f 7765 722e 7870 6174 6828 222e 2f73  lower.xpath("./s
-00004cf0: 7061 6e22 295b 305d 2e61 7474 7269 622e  pan")[0].attrib.
-00004d00: 6765 7428 2269 6422 290a 2020 2020 2020  get("id").      
-00004d10: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00004d20: 2064 6562 7567 3a0a 2020 2020 2020 2020   debug:.        
-00004d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d40: 7072 696e 7428 6622 2069 643a 207b 6964  print(f" id: {id
-00004d50: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-00004d60: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
-00004d70: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00004d80: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00004d90: 2020 2020 2020 2020 6966 2064 6562 7567          if debug
-00004da0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00004db0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00004dc0: 6622 6d6f 7665 6420 666f 6c6c 6f77 6572  f"moved follower
-00004dd0: 207b 666f 6c6c 6f77 6572 7d20 746f 207b   {follower} to {
-00004de0: 636f 6e74 6169 6e65 725f 6469 762e 6174  container_div.at
-00004df0: 7472 6962 2e67 6574 2827 7469 746c 6527  trib.get('title'
-00004e00: 297d 2229 0a20 2020 2020 2020 2020 2020  )}").           
-00004e10: 2020 2020 2020 2020 2063 6f6e 7461 696e           contain
-00004e20: 6572 5f64 6976 2e61 7070 656e 6428 666f  er_div.append(fo
-00004e30: 6c6c 6f77 6572 290a 0a20 2020 2020 2020  llower)..       
-00004e40: 2022 2222 4927 6d20 776f 726b 696e 6720   """I'm working 
-00004e50: 7769 7468 206c 786d 6c20 696e 2050 7974  with lxml in Pyt
-00004e60: 686f 6e20 616e 6420 7769 7368 2074 6f20  hon and wish to 
-00004e70: 6772 6f75 7020 6120 666c 6174 2073 6574  group a flat set
-00004e80: 206f 6620 3c64 6976 3e20 656c 656d 656e   of <div> elemen
-00004e90: 7473 2069 6e74 6f20 6120 7472 6565 2062  ts into a tree b
-00004ea0: 6173 6564 206f 6e20 7468 6569 7220 636c  ased on their cl
-00004eb0: 6173 7320 6174 7472 6962 7574 6573 0a49  ass attributes.I
-00004ec0: 2068 6176 6520 6120 7365 7420 6f66 2073   have a set of s
-00004ed0: 6563 7469 6f6e 7320 3c64 6976 3e20 7468  ections <div> th
-00004ee0: 6174 2061 7265 2061 6c6c 2063 6869 6c64  at are all child
-00004ef0: 7265 6e20 6f66 203c 626f 6479 3e20 7768  ren of <body> wh
-00004f00: 6963 6820 6d75 7374 2062 6520 6172 7261  ich must be arra
-00004f10: 6e67 6564 2069 6e20 6120 7472 6565 2073  nged in a tree s
-00004f20: 7472 7563 7475 7265 2e20 536f 6d65 206f  tructure. Some o
-00004f30: 6620 7468 6520 6469 7673 2063 6f6e 7461  f the divs conta
-00004f40: 696e 206a 7573 7420 6120 7469 746c 652d  in just a title-
-00004f50: 7374 7269 6e67 2028 7469 746c 652d 6469  string (title-di
-00004f60: 7673 2920 696e 6469 6361 7469 6e67 2074  vs) indicating t
-00004f70: 6865 206c 6576 656c 2069 6e20 7472 6565  he level in tree
-00004f80: 3b20 7468 6973 2069 7320 696e 6469 6361  ; this is indica
-00004f90: 7465 6420 6279 2061 2063 6c61 7373 2061  ted by a class a
-00004fa0: 7474 7269 6275 7465 206f 6620 2273 6563  ttribute of "sec
-00004fb0: 7469 6f6e 222c 2022 7375 625f 7365 6374  tion", "sub_sect
-00004fc0: 696f 6e22 2c20 2273 7562 5f73 7562 5f73  ion", "sub_sub_s
-00004fd0: 6563 7469 6f6e 222c 2065 7463 2e20 416e  ection", etc. An
-00004fe0: 7920 6469 7673 2066 6f6c 6c6f 7769 6e67  y divs following
-00004ff0: 2074 6974 6c65 2d64 6976 7320 6265 6c6f   title-divs belo
-00005000: 6e67 2074 6f20 7468 6520 7361 6d65 206c  ng to the same l
-00005010: 6576 656c 2c20 756e 7469 6c20 6120 666f  evel, until a fo
-00005020: 6c6c 6f77 696e 6720 7469 746c 652d 6469  llowing title-di
-00005030: 7620 6973 2072 6561 6368 6564 2e20 506c  v is reached. Pl
-00005040: 6561 7365 2063 7265 6174 6520 636f 6465  ease create code
-00005050: 2074 6861 743a 0a2a 2063 7265 6174 6573   that:.* creates
-00005060: 2061 206e 6577 2068 6965 7261 7263 6879   a new hierarchy
-00005070: 206f 6620 6469 7673 2072 6570 7265 7365   of divs represe
-00005080: 6e74 696e 6720 7468 6520 7472 6565 2073  nting the tree s
-00005090: 7472 7563 7475 7265 0a2a 2061 6464 7320  tructure.* adds 
-000050a0: 7468 6520 7469 746c 652d 6469 7673 2061  the title-divs a
-000050b0: 6e64 2074 6865 6972 2066 6f6c 6c6f 7769  nd their followi
-000050c0: 6e67 206e 6f6e 2d74 6974 6c65 2d64 6976  ng non-title-div
-000050d0: 7320 746f 2074 6865 2061 7070 726f 7072  s to the appropr
-000050e0: 6961 7465 2070 6f73 6974 696f 6e20 696e  iate position in
-000050f0: 2074 6865 2068 6965 7261 7263 6879 2e0a   the hierarchy..
-00005100: 0a48 6572 6520 6973 2061 2074 7970 6963  .Here is a typic
-00005110: 616c 2069 6e70 7574 3a0a 0a3c 6874 6d6c  al input:..<html
-00005120: 3e0a 2020 3c68 6561 643e 2e2e 2e3c 2f68  >.  <head>...</h
-00005130: 6561 643e 0a20 203c 626f 6479 3e0a 2020  ead>.  <body>.  
-00005140: 2020 3c64 6976 2063 6c61 7373 3d22 7365    <div class="se
-00005150: 6374 696f 6e5f 7469 746c 6522 3e53 6563  ction_title">Sec
-00005160: 7469 6f6e 2031 3c2f 6469 763e 0a20 2020  tion 1</div>.   
-00005170: 203c 6469 763e 7374 7566 6620 613c 2f64   <div>stuff a</d
-00005180: 6976 3e0a 2020 2020 3c64 6976 2063 6c61  iv>.    <div cla
-00005190: 7373 3d22 7375 6273 6563 7469 6f6e 5f74  ss="subsection_t
-000051a0: 6974 6c65 223e 5365 6374 696f 6e20 312e  itle">Section 1.
-000051b0: 313c 2f64 6976 3e0a 2020 2020 3c64 6976  1</div>.    <div
-000051c0: 3e73 7475 6666 2062 3c2f 6469 763e 0a20  >stuff b</div>. 
-000051d0: 2020 203c 6469 763e 7374 7566 6620 6278     <div>stuff bx
-000051e0: 3c2f 6469 763e 0a20 2020 203c 6469 7620  </div>.    <div 
-000051f0: 636c 6173 733d 2273 7562 7375 6273 6563  class="subsubsec
-00005200: 7469 6f6e 5f74 6974 6c65 223e 5365 6374  tion_title">Sect
-00005210: 696f 6e20 312e 312e 313c 2f64 6976 3e0a  ion 1.1.1</div>.
-00005220: 2020 2020 3c64 6976 3e73 7475 6666 207a      <div>stuff z
-00005230: 3c2f 6469 763e 0a20 2020 203c 6469 763e  </div>.    <div>
-00005240: 7374 7566 6620 7a7a 3c2f 6469 763e 0a20  stuff zz</div>. 
-00005250: 2020 203c 6469 7620 636c 6173 733d 2273     <div class="s
-00005260: 7562 7375 6273 6563 7469 6f6e 5f74 6974  ubsubsection_tit
-00005270: 6c65 223e 5365 6374 696f 6e20 312e 312e  le">Section 1.1.
-00005280: 323c 2f64 6976 3e0a 2020 2020 3c64 6976  2</div>.    <div
-00005290: 3e73 7475 6666 2078 3c2f 6469 763e 0a20  >stuff x</div>. 
-000052a0: 2020 203c 6469 763e 7374 7566 6620 7878     <div>stuff xx
-000052b0: 3c2f 6469 763e 0a20 2020 203c 6469 763e  </div>.    <div>
-000052c0: 7374 7566 6620 7878 783c 2f64 6976 3e0a  stuff xxx</div>.
-000052d0: 2020 2020 3c64 6976 2063 6c61 7373 3d22      <div class="
-000052e0: 7375 6273 6563 7469 6f6e 5f74 6974 6c65  subsection_title
-000052f0: 223e 5365 6374 696f 6e20 312e 323c 2f64  ">Section 1.2</d
-00005300: 6976 3e0a 2020 3c2f 626f 6479 3e0a 3c2f  iv>.  </body>.</
-00005310: 6874 6d6c 3e0a 0a20 2020 616e 6420 6465  html>..   and de
-00005320: 7369 7265 6420 6f75 7470 7574 0a3c 6874  sired output.<ht
-00005330: 6d6c 3e0a 2020 3c68 6561 643e 2e2e 2e3c  ml>.  <head>...<
-00005340: 2f68 6561 643e 0a20 203c 626f 6479 3e0a  /head>.  <body>.
-00005350: 2020 2020 3c64 6976 2063 6c61 7373 3d22      <div class="
-00005360: 7365 6374 696f 6e22 3e0a 2020 2020 2020  section">.      
-00005370: 3c64 6976 2063 6c61 7373 3d22 7365 6374  <div class="sect
-00005380: 696f 6e5f 7469 746c 6522 3e53 6563 7469  ion_title">Secti
-00005390: 6f6e 2031 3c2f 6469 763e 0a20 2020 2020  on 1</div>.     
-000053a0: 203c 6469 763e 7374 7566 6620 613c 2f64   <div>stuff a</d
-000053b0: 6976 3e0a 0920 203c 6469 7620 636c 6173  iv>..  <div clas
-000053c0: 733d 2273 7562 7365 6374 696f 6e22 3e0a  s="subsection">.
-000053d0: 2020 2020 2020 2020 3c64 6976 2063 6c61          <div cla
-000053e0: 7373 3d22 7375 6273 6563 7469 6f6e 5f74  ss="subsection_t
-000053f0: 6974 6c65 223e 5365 6374 696f 6e20 312e  itle">Section 1.
-00005400: 313c 2f64 6976 3e0a 2020 2020 2020 2020  1</div>.        
-00005410: 3c64 6976 3e73 7475 6666 2062 3c2f 6469  <div>stuff b</di
-00005420: 763e 0a20 2020 2020 2020 203c 6469 763e  v>.        <div>
-00005430: 7374 7566 6620 6278 3c2f 6469 763e 0a09  stuff bx</div>..
-00005440: 093c 6469 7620 636c 6173 733d 2273 7562  .<div class="sub
-00005450: 7375 6273 6563 7469 6f6e 223e 0a20 2020  subsection">.   
-00005460: 2020 2020 2020 203c 6469 7620 636c 6173         <div clas
-00005470: 733d 2273 7562 7375 6273 6563 7469 6f6e  s="subsubsection
-00005480: 5f74 6974 6c65 223e 5365 6374 696f 6e20  _title">Section 
-00005490: 312e 312e 313c 2f64 6976 3e0a 2020 2020  1.1.1</div>.    
-000054a0: 2020 2020 2020 3c64 6976 3e73 7475 6666        <div>stuff
-000054b0: 207a 3c2f 6469 763e 0a20 2020 2020 2020   z</div>.       
-000054c0: 2020 203c 6469 763e 7374 7566 6620 7a7a     <div>stuff zz
-000054d0: 3c2f 6469 763e 0a09 093c 2f64 6976 3e0a  </div>...</div>.
-000054e0: 0909 3c64 6976 2063 6c61 7373 3d22 7375  ..<div class="su
-000054f0: 6273 7562 7365 6374 696f 6e22 3e0a 2020  bsubsection">.  
-00005500: 2020 2020 2020 2020 3c64 6976 2063 6c61          <div cla
-00005510: 7373 3d22 7375 6273 7562 7365 6374 696f  ss="subsubsectio
-00005520: 6e5f 7469 746c 6522 3e53 6563 7469 6f6e  n_title">Section
-00005530: 2031 2e31 2e32 3c2f 6469 763e 0a20 2020   1.1.2</div>.   
-00005540: 2020 2020 2020 203c 6469 763e 7374 7566         <div>stuf
-00005550: 6620 783c 2f64 6976 3e0a 2020 2020 2020  f x</div>.      
-00005560: 2020 2020 3c64 6976 3e73 7475 6666 2078      <div>stuff x
-00005570: 783c 2f64 6976 3e0a 2020 2020 2020 2020  x</div>.        
-00005580: 2020 3c64 6976 3e73 7475 6666 2078 7878    <div>stuff xxx
-00005590: 3c2f 6469 763e 0a09 093c 2f64 6976 3e0a  </div>...</div>.
-000055a0: 0920 203c 2f64 6976 3e0a 093c 2f64 6976  .  </div>..</div
-000055b0: 3e0a 2020 2020 3c64 6976 2063 6c61 7373  >.    <div class
-000055c0: 3d22 7365 6374 696f 6e22 3e0a 2020 2020  ="section">.    
-000055d0: 2020 3c64 6976 2063 6c61 7373 3d22 7365    <div class="se
-000055e0: 6374 696f 6e5f 7469 746c 6522 3e53 6563  ction_title">Sec
-000055f0: 7469 6f6e 2032 3c2f 6469 763e 0a09 3c2f  tion 2</div>..</
-00005600: 6469 763e 0a20 203c 2f62 6f64 793e 0a3c  div>.  </body>.<
-00005610: 2f68 746d 6c3e 0a0a 4368 6174 4750 540a  /html>..ChatGPT.
-00005620: 546f 2061 6368 6965 7665 2074 6865 2064  To achieve the d
-00005630: 6573 6972 6564 206f 7574 7075 742c 2079  esired output, y
-00005640: 6f75 2063 616e 2075 7365 2074 6865 2066  ou can use the f
-00005650: 6f6c 6c6f 7769 6e67 2050 7974 686f 6e20  ollowing Python 
-00005660: 636f 6465 2074 6f20 7061 7273 6520 7468  code to parse th
-00005670: 6520 4854 4d4c 2075 7369 6e67 206c 786d  e HTML using lxm
-00005680: 6c20 616e 6420 7265 7374 7275 6374 7572  l and restructur
-00005690: 6520 7468 6520 3c64 6976 3e20 656c 656d  e the <div> elem
-000056a0: 656e 7473 2069 6e74 6f20 6120 7472 6565  ents into a tree
-000056b0: 2073 7472 7563 7475 7265 2062 6173 6564   structure based
-000056c0: 206f 6e20 7468 6569 7220 636c 6173 7320   on their class 
-000056d0: 6174 7472 6962 7574 6573 3a0a 0a70 7974  attributes:..pyt
-000056e0: 686f 6e0a 436f 7079 2063 6f64 650a 6672  hon.Copy code.fr
-000056f0: 6f6d 206c 786d 6c20 696d 706f 7274 2065  om lxml import e
-00005700: 7472 6565 2023 2069 6e20 636f 6d6d 656e  tree # in commen
-00005710: 740a 0a64 6566 2067 726f 7570 5f64 6976  t..def group_div
-00005720: 735f 696e 746f 5f74 7265 6528 6874 6d6c  s_into_tree(html
-00005730: 293a 0a20 2020 2023 2050 6172 7365 2074  ):.    # Parse t
-00005740: 6865 2048 544d 4c0a 2020 2020 7472 6565  he HTML.    tree
-00005750: 203d 2065 7472 6565 2e48 544d 4c28 6874   = etree.HTML(ht
-00005760: 6d6c 290a 0a20 2020 2023 2046 696e 6420  ml)..    # Find 
-00005770: 616c 6c20 3c64 6976 3e20 656c 656d 656e  all <div> elemen
-00005780: 7473 2077 6974 6869 6e20 7468 6520 3c62  ts within the <b
-00005790: 6f64 793e 2074 6167 0a20 2020 2064 6976  ody> tag.    div
-000057a0: 5f65 6c65 6d65 6e74 7320 3d20 7472 6565  _elements = tree
-000057b0: 2e78 7061 7468 2822 2f2f 626f 6479 2f64  .xpath("//body/d
-000057c0: 6976 2229 0a0a 2020 2020 2320 4372 6561  iv")..    # Crea
-000057d0: 7465 2061 206e 6577 2072 6f6f 7420 3c64  te a new root <d
-000057e0: 6976 3e20 656c 656d 656e 7420 746f 2068  iv> element to h
-000057f0: 6f6c 6420 7468 6520 7472 6565 2073 7472  old the tree str
-00005800: 7563 7475 7265 0a20 2020 2072 6f6f 7420  ucture.    root 
-00005810: 3d20 6574 7265 652e 456c 656d 656e 7428  = etree.Element(
-00005820: 2264 6976 2229 0a0a 2020 2020 2320 496e  "div")..    # In
-00005830: 6974 6961 6c69 7a65 2076 6172 6961 626c  itialize variabl
-00005840: 6573 2074 6f20 6b65 6570 2074 7261 636b  es to keep track
-00005850: 206f 6620 7468 6520 6375 7272 656e 7420   of the current 
-00005860: 7061 7265 6e74 203c 6469 763e 2061 6e64  parent <div> and
-00005870: 2069 7473 206c 6576 656c 0a20 2020 2063   its level.    c
-00005880: 7572 7265 6e74 5f70 6172 656e 7420 3d20  urrent_parent = 
-00005890: 726f 6f74 0a20 2020 2063 7572 7265 6e74  root.    current
-000058a0: 5f6c 6576 656c 203d 2030 0a0a 2020 2020  _level = 0..    
-000058b0: 666f 7220 6469 7620 696e 2064 6976 5f65  for div in div_e
-000058c0: 6c65 6d65 6e74 733a 0a20 2020 2020 2020  lements:.       
-000058d0: 2023 2043 6865 636b 2069 6620 7468 6520   # Check if the 
-000058e0: 6375 7272 656e 7420 3c64 6976 3e20 6861  current <div> ha
-000058f0: 7320 6120 636c 6173 7320 6174 7472 6962  s a class attrib
-00005900: 7574 650a 2020 2020 2020 2020 6966 2022  ute.        if "
-00005910: 636c 6173 7322 2069 6e20 6469 762e 6174  class" in div.at
-00005920: 7472 6962 3a0a 2020 2020 2020 2020 2020  trib:.          
-00005930: 2020 636c 6173 735f 7661 6c75 6520 3d20    class_value = 
-00005940: 6469 762e 6174 7472 6962 5b22 636c 6173  div.attrib["clas
-00005950: 7322 5d0a 0a20 2020 2020 2020 2020 2020  s"]..           
-00005960: 2023 2044 6574 6572 6d69 6e65 2074 6865   # Determine the
-00005970: 206c 6576 656c 2062 6173 6564 206f 6e20   level based on 
-00005980: 7468 6520 636c 6173 7320 6174 7472 6962  the class attrib
-00005990: 7574 650a 2020 2020 2020 2020 2020 2020  ute.            
-000059a0: 6966 2063 6c61 7373 5f76 616c 7565 2e73  if class_value.s
-000059b0: 7461 7274 7377 6974 6828 2273 6563 7469  tartswith("secti
-000059c0: 6f6e 5f74 6974 6c65 2229 3a0a 2020 2020  on_title"):.    
-000059d0: 2020 2020 2020 2020 2020 2020 6c65 7665              leve
-000059e0: 6c20 3d20 300a 2020 2020 2020 2020 2020  l = 0.          
-000059f0: 2020 656c 6966 2063 6c61 7373 5f76 616c    elif class_val
-00005a00: 7565 2e73 7461 7274 7377 6974 6828 2273  ue.startswith("s
-00005a10: 7562 7365 6374 696f 6e5f 7469 746c 6522  ubsection_title"
-00005a20: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00005a30: 2020 206c 6576 656c 203d 2031 0a20 2020     level = 1.   
-00005a40: 2020 2020 2020 2020 2065 6c69 6620 636c           elif cl
-00005a50: 6173 735f 7661 6c75 652e 7374 6172 7473  ass_value.starts
-00005a60: 7769 7468 2822 7375 6273 7562 7365 6374  with("subsubsect
-00005a70: 696f 6e5f 7469 746c 6522 293a 0a20 2020  ion_title"):.   
-00005a80: 2020 2020 2020 2020 2020 2020 206c 6576               lev
-00005a90: 656c 203d 2032 0a20 2020 2020 2020 2020  el = 2.         
-00005aa0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00005ab0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-00005ac0: 6520 2023 2053 6b69 7020 3c64 6976 3e20  e  # Skip <div> 
-00005ad0: 656c 656d 656e 7473 2077 6974 686f 7574  elements without
-00005ae0: 2074 6974 6c65 2063 6c61 7373 6573 0a0a   title classes..
-00005af0: 2020 2020 2020 2020 2020 2020 2320 4372              # Cr
-00005b00: 6561 7465 2061 206e 6577 203c 6469 763e  eate a new <div>
-00005b10: 2065 6c65 6d65 6e74 2061 6e64 2073 6574   element and set
-00005b20: 2069 7473 2063 6c61 7373 2061 7474 7269   its class attri
-00005b30: 6275 7465 0a20 2020 2020 2020 2020 2020  bute.           
-00005b40: 206e 6577 5f64 6976 203d 2065 7472 6565   new_div = etree
-00005b50: 2e53 7562 456c 656d 656e 7428 6375 7272  .SubElement(curr
-00005b60: 656e 745f 7061 7265 6e74 2c20 2264 6976  ent_parent, "div
-00005b70: 2229 0a20 2020 2020 2020 2020 2020 206e  ").            n
-00005b80: 6577 5f64 6976 2e61 7474 7269 625b 2263  ew_div.attrib["c
-00005b90: 6c61 7373 225d 203d 2022 7365 6374 696f  lass"] = "sectio
-00005ba0: 6e22 202a 2028 6c65 7665 6c20 2b20 3129  n" * (level + 1)
-00005bb0: 2020 2320 4164 6420 6170 7072 6f70 7269    # Add appropri
-00005bc0: 6174 6520 636c 6173 7320 6261 7365 6420  ate class based 
-00005bd0: 6f6e 206c 6576 656c 0a0a 2020 2020 2020  on level..      
-00005be0: 2020 2020 2020 2320 4164 6420 7468 6520        # Add the 
-00005bf0: 6375 7272 656e 7420 3c64 6976 3e20 746f  current <div> to
-00005c00: 2074 6865 206e 6577 203c 6469 763e 2065   the new <div> e
-00005c10: 6c65 6d65 6e74 0a20 2020 2020 2020 2020  lement.         
-00005c20: 2020 206e 6577 5f64 6976 2e61 7070 656e     new_div.appen
-00005c30: 6428 6469 7629 0a0a 2020 2020 2020 2020  d(div)..        
-00005c40: 2020 2020 2320 5570 6461 7465 2074 6865      # Update the
-00005c50: 2063 7572 7265 6e74 2070 6172 656e 7420   current parent 
-00005c60: 616e 6420 6c65 7665 6c0a 2020 2020 2020  and level.      
-00005c70: 2020 2020 2020 6375 7272 656e 745f 7061        current_pa
-00005c80: 7265 6e74 203d 206e 6577 5f64 6976 0a20  rent = new_div. 
-00005c90: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-00005ca0: 6e74 5f6c 6576 656c 203d 206c 6576 656c  nt_level = level
-00005cb0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00005cc0: 2020 2020 2020 2020 2020 2023 2041 6464             # Add
-00005cd0: 206e 6f6e 2d74 6974 6c65 203c 6469 763e   non-title <div>
-00005ce0: 2065 6c65 6d65 6e74 7320 746f 2074 6865   elements to the
-00005cf0: 2063 7572 7265 6e74 2070 6172 656e 740a   current parent.
-00005d00: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-00005d10: 656e 745f 7061 7265 6e74 2e61 7070 656e  ent_parent.appen
-00005d20: 6428 6469 7629 0a0a 2020 2020 2320 5265  d(div)..    # Re
-00005d30: 7475 726e 2074 6865 206d 6f64 6966 6965  turn the modifie
-00005d40: 6420 4854 4d4c 2061 7320 6120 7374 7269  d HTML as a stri
-00005d50: 6e67 0a20 2020 2072 6574 7572 6e20 6574  ng.    return et
-00005d60: 7265 652e 746f 7374 7269 6e67 2874 7265  ree.tostring(tre
-00005d70: 652c 2065 6e63 6f64 696e 673d 2275 6e69  e, encoding="uni
-00005d80: 636f 6465 2229 0a0a 2320 4578 616d 706c  code")..# Exampl
-00005d90: 6520 7573 6167 650a 6874 6d6c 203d 2027  e usage.html = '
-00005da0: 2727 0a3c 6874 6d6c 3e0a 2020 3c68 6561  ''.<html>.  <hea
-00005db0: 643e 2e2e 2e3c 2f68 6561 643e 0a20 203c  d>...</head>.  <
-00005dc0: 626f 6479 3e0a 2020 2020 3c64 6976 2063  body>.    <div c
-00005dd0: 6c61 7373 3d22 7365 6374 696f 6e5f 7469  lass="section_ti
-00005de0: 746c 6522 3e53 6563 7469 6f6e 2031 3c2f  tle">Section 1</
-00005df0: 6469 763e 0a20 2020 203c 6469 763e 7374  div>.    <div>st
-00005e00: 7566 6620 613c 2f64 6976 3e0a 2020 2020  uff a</div>.    
-00005e10: 3c64 6976 2063 6c61 7373 3d22 7375 6273  <div class="subs
-00005e20: 6563 7469 6f6e 5f74 6974 6c65 223e 5365  ection_title">Se
-00005e30: 6374 696f 6e20 312e 313c 2f64 6976 3e0a  ction 1.1</div>.
-00005e40: 2020 2020 3c64 6976 3e73 7475 6666 2062      <div>stuff b
-00005e50: 3c2f 6469 763e 0a20 2020 203c 6469 763e  </div>.    <div>
-00005e60: 7374 7566 6620 6278 3c2f 6469 763e 0a20  stuff bx</div>. 
-00005e70: 2020 203c 6469 7620 636c 6173 733d 2273     <div class="s
-00005e80: 7562 7375 6273 6563 7469 6f6e 5f74 6974  ubsubsection_tit
-00005e90: 6c65 223e 5365 6374 696f 6e20 312e 312e  le">Section 1.1.
-00005ea0: 313c 2f64 6976 3e0a 2020 2020 3c64 6976  1</div>.    <div
-00005eb0: 3e73 7475 6666 207a 3c2f 6469 763e 0a20  >stuff z</div>. 
-00005ec0: 2020 203c 6469 763e 7374 7566 6620 7a7a     <div>stuff zz
-00005ed0: 3c2f 6469 763e 0a20 2020 203c 6469 7620  </div>.    <div 
-00005ee0: 636c 6173 733d 2273 7562 7375 6273 6563  class="subsubsec
-00005ef0: 7469 6f6e 5f74 6974 6c65 223e 5365 6374  tion_title">Sect
-00005f00: 696f 6e20 312e 312e 323c 2f64 6976 3e0a  ion 1.1.2</div>.
-00005f10: 2020 2020 3c64 6976 3e73 7475 6666 2078      <div>stuff x
-00005f20: 3c2f 6469 763e 0a20 2020 203c 6469 763e  </div>.    <div>
-00005f30: 7374 7566 6620 7878 3c2f 6469 763e 0a20  stuff xx</div>. 
-00005f40: 2020 203c 6469 763e 7374 7566 6620 7878     <div>stuff xx
-00005f50: 783c 2f64 6976 3e0a 2020 2020 3c64 6976  x</div>.    <div
-00005f60: 2063 6c61 7373 3d22 7375 6273 6563 7469   class="subsecti
-00005f70: 6f6e 5f74 6974 6c65 223e 5365 6374 696f  on_title">Sectio
-00005f80: 6e20 312e 323c 2f64 6976 3e0a 2020 3c2f  n 1.2</div>.  </
-00005f90: 626f 6479 3e0a 3c2f 6874 6d6c 3e0a 2727  body>.</html>.''
-00005fa0: 270a 0a6f 7574 7075 745f 6874 6d6c 203d  '..output_html =
-00005fb0: 2067 726f 7570 5f64 6976 735f 696e 746f   group_divs_into
-00005fc0: 5f74 7265 6528 6874 6d6c 290a 7072 696e  _tree(html).prin
-00005fd0: 7428 6f75 7470 7574 5f68 746d 6c29 0a54  t(output_html).T
-00005fe0: 6865 2063 6f64 6520 7769 6c6c 2070 6172  he code will par
-00005ff0: 7365 2074 6865 2048 544d 4c2c 2069 6465  se the HTML, ide
-00006000: 6e74 6966 7920 7468 6520 7469 746c 6520  ntify the title 
-00006010: 3c64 6976 3e20 656c 656d 656e 7473 2062  <div> elements b
-00006020: 6173 6564 206f 6e20 7468 6569 7220 636c  ased on their cl
-00006030: 6173 7320 6174 7472 6962 7574 6573 2c20  ass attributes, 
-00006040: 6372 6561 7465 2061 206e 6577 2068 6965  create a new hie
-00006050: 7261 7263 6879 206f 6620 3c64 6976 3e20  rarchy of <div> 
-00006060: 656c 656d 656e 7473 2c20 616e 6420 6164  elements, and ad
-00006070: 6420 7468 6520 7469 746c 6520 3c64 6976  d the title <div
-00006080: 3e73 2061 6e64 2074 6865 6972 2066 6f6c  >s and their fol
-00006090: 6c6f 7769 6e67 206e 6f6e 2d74 6974 6c65  lowing non-title
-000060a0: 203c 6469 763e 7320 746f 2074 6865 2061   <div>s to the a
-000060b0: 7070 726f 7072 6961 7465 2070 6f73 6974  ppropriate posit
-000060c0: 696f 6e20 696e 2074 6865 2068 6965 7261  ion in the hiera
-000060d0: 7263 6879 2e20 4669 6e61 6c6c 792c 2069  rchy. Finally, i
-000060e0: 7420 7769 6c6c 2072 6574 7572 6e20 7468  t will return th
-000060f0: 6520 6d6f 6469 6669 6564 2048 544d 4c20  e modified HTML 
-00006100: 6173 2061 2073 7472 696e 672e 0a0a 506c  as a string...Pl
-00006110: 6561 7365 206e 6f74 6520 7468 6174 2074  ease note that t
-00006120: 6865 2063 6f64 6520 6173 7375 6d65 7320  he code assumes 
-00006130: 7468 6174 2074 6865 2063 6c61 7373 2076  that the class v
-00006140: 616c 7565 7320 666f 7220 7468 6520 7469  alues for the ti
-00006150: 746c 6520 3c64 6976 3e20 656c 656d 656e  tle <div> elemen
-00006160: 7473 2066 6f6c 6c6f 7720 7468 6520 7061  ts follow the pa
-00006170: 7474 6572 6e20 2273 6563 7469 6f6e 5f74  ttern "section_t
-00006180: 6974 6c65 222c 2022 7375 6273 6563 7469  itle", "subsecti
-00006190: 6f6e 5f74 6974 6c65 222c 2022 7375 6273  on_title", "subs
-000061a0: 7562 7365 6374 696f 6e5f 7469 746c 6522  ubsection_title"
-000061b0: 2c20 616e 6420 736f 206f 6e2e 2049 6620  , and so on. If 
-000061c0: 796f 7572 2061 6374 7561 6c20 636c 6173  your actual clas
-000061d0: 7320 6e61 6d65 7320 6469 6666 6572 2c20  s names differ, 
-000061e0: 796f 7520 6d61 7920 6e65 6564 2074 6f20  you may need to 
-000061f0: 6d6f 6469 6679 2074 6865 2063 6f64 6520  modify the code 
-00006200: 6163 636f 7264 696e 676c 792e 0a0a 0a0a  accordingly.....
-00006210: 0a0a 5265 6765 6e65 7261 7465 2072 6573  ..Regenerate res
-00006220: 706f 6e73 650a 5365 6e64 2061 206d 6573  ponse.Send a mes
-00006230: 7361 6765 2e0a 0a46 7265 6520 5265 7365  sage...Free Rese
-00006240: 6172 6368 2050 7265 7669 6577 2e20 4368  arch Preview. Ch
-00006250: 6174 4750 5420 6d61 7920 7072 6f64 7563  atGPT may produc
-00006260: 6520 696e 6163 6375 7261 7465 2069 6e66  e inaccurate inf
-00006270: 6f72 6d61 7469 6f6e 2061 626f 7574 2070  ormation about p
-00006280: 656f 706c 652c 2070 6c61 6365 732c 206f  eople, places, o
-00006290: 7220 6661 6374 732e 2043 6861 7447 5054  r facts. ChatGPT
-000062a0: 204d 6179 2031 3220 5665 7273 696f 6e22   May 12 Version"
-000062b0: 2222 0a0a 2020 2020 4063 6c61 7373 6d65  ""..    @classme
-000062c0: 7468 6f64 0a20 2020 2064 6566 2067 726f  thod.    def gro
-000062d0: 7570 5f64 6976 735f 696e 746f 5f74 7265  up_divs_into_tre
-000062e0: 6528 636c 732c 2062 6f64 7929 3a0a 2020  e(cls, body):.  
-000062f0: 2020 2020 2020 2222 2250 6574 6572 204d        """Peter M
-00006300: 7572 7261 792d 5275 7374 2222 220a 2020  urray-Rust""".  
-00006310: 2020 2020 2020 454e 4420 3d20 225b 454e        END = "[EN
-00006320: 4422 0a20 2020 2020 2020 2053 5441 5254  D".        START
-00006330: 203d 2022 5b53 5441 5254 220a 2020 2020   = "[START".    
-00006340: 2020 2020 464c 4f41 5420 3d20 2266 6c6f      FLOAT = "flo
-00006350: 6174 220a 0a20 2020 2020 2020 2073 6b69  at"..        ski
-00006360: 705f 7265 7320 3d20 5b0a 2020 2020 2020  p_res = [.      
-00006370: 2020 2020 2020 7265 2e63 6f6d 7069 6c65        re.compile
-00006380: 2822 4164 6f70 7465 642e 2a22 292c 0a20  ("Adopted.*"),. 
-00006390: 2020 2020 2020 2020 2020 2072 652e 636f             re.co
-000063a0: 6d70 696c 6528 2253 7562 6a65 6374 2074  mpile("Subject t
-000063b0: 6f20 436f 7079 2229 0a20 2020 2020 2020  o Copy").       
-000063c0: 205d 0a0a 2020 2020 2020 2020 6469 765f   ]..        div_
-000063d0: 7374 796c 6573 203d 205b 2262 6f72 6465  styles = ["borde
-000063e0: 723a 2023 3838 3838 6666 2073 6f6c 6964  r: #8888ff solid
-000063f0: 2033 7078 3b22 2c0a 2020 2020 2020 2020   3px;",.        
-00006400: 2020 2020 2020 2020 2020 2020 2020 2262                "b
-00006410: 6f72 6465 723a 2063 7961 6e20 6461 7368  order: cyan dash
-00006420: 6564 2032 2e35 7078 3b22 2c0a 2020 2020  ed 2.5px;",.    
-00006430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006440: 2020 2262 6f72 6465 723a 2067 7265 656e    "border: green
-00006450: 2064 6173 6865 6420 3270 783b 222c 0a20   dashed 2px;",. 
-00006460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006470: 2020 2020 205d 0a0a 2020 2020 2020 2020       ]..        
-00006480: 2320 4669 6e64 2061 6c6c 203c 6469 763e  # Find all <div>
-00006490: 2065 6c65 6d65 6e74 7320 7769 7468 696e   elements within
-000064a0: 2074 6865 203c 626f 6479 3e20 7461 670a   the <body> tag.
-000064b0: 2020 2020 2020 2020 6469 765f 656c 656d          div_elem
-000064c0: 656e 7473 203d 2062 6f64 792e 7870 6174  ents = body.xpat
-000064d0: 6828 222e 2f64 6976 2229 0a0a 2020 2020  h("./div")..    
-000064e0: 2020 2020 2320 4372 6561 7465 2061 206e      # Create a n
-000064f0: 6577 2072 6f6f 7420 3c64 6976 3e20 656c  ew root <div> el
-00006500: 656d 656e 7420 746f 2068 6f6c 6420 7468  ement to hold th
-00006510: 6520 7472 6565 2073 7472 7563 7475 7265  e tree structure
-00006520: 0a20 2020 2020 2020 2072 6f6f 745f 6469  .        root_di
-00006530: 7620 3d20 4554 2e45 6c65 6d65 6e74 2822  v = ET.Element("
-00006540: 6469 7622 290a 2020 2020 2020 2020 726f  div").        ro
-00006550: 6f74 5f64 6976 2e61 7474 7269 625b 2263  ot_div.attrib["c
-00006560: 6c61 7373 225d 203d 2022 726f 6f74 220a  lass"] = "root".
-00006570: 2020 2020 2020 2020 726f 6f74 5f64 6976          root_div
-00006580: 2e61 7474 7269 625b 2274 6974 6c65 225d  .attrib["title"]
-00006590: 203d 2022 726f 6f74 220a 0a20 2020 2020   = "root"..     
-000065a0: 2020 2023 2049 6e69 7469 616c 697a 6520     # Initialize 
-000065b0: 7661 7269 6162 6c65 7320 746f 206b 6565  variables to kee
-000065c0: 7020 7472 6163 6b20 6f66 2074 6865 2063  p track of the c
-000065d0: 7572 7265 6e74 2070 6172 656e 7420 3c64  urrent parent <d
-000065e0: 6976 3e20 616e 6420 6974 7320 6c65 7665  iv> and its leve
-000065f0: 6c0a 2020 2020 2020 2020 6375 7272 656e  l.        curren
-00006600: 745f 7061 7265 6e74 203d 2072 6f6f 745f  t_parent = root_
-00006610: 6469 760a 2020 2020 2020 2020 6375 7272  div.        curr
-00006620: 656e 745f 6c65 7665 6c20 3d20 300a 0a20  ent_level = 0.. 
-00006630: 2020 2020 2020 2070 6172 656e 7473 203d         parents =
-00006640: 205b 726f 6f74 5f64 6976 2c20 4e6f 6e65   [root_div, None
-00006650: 2c20 4e6f 6e65 2c20 4e6f 6e65 5d0a 2020  , None, None].  
-00006660: 2020 2020 2020 7374 6172 745f 656e 6473        start_ends
-00006670: 203d 205b 5d0a 2020 2020 2020 2020 7061   = [].        pa
-00006680: 7265 6e74 203d 2072 6f6f 745f 6469 760a  rent = root_div.
-00006690: 2020 2020 2020 2020 666f 7220 6469 7620          for div 
-000066a0: 696e 2064 6976 5f65 6c65 6d65 6e74 733a  in div_elements:
-000066b0: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
-000066c0: 6865 636b 2069 6620 7468 6520 6375 7272  heck if the curr
-000066d0: 656e 7420 3c64 6976 3e20 6861 7320 6120  ent <div> has a 
-000066e0: 636c 6173 7320 6174 7472 6962 7574 650a  class attribute.
-000066f0: 2020 2020 2020 2020 2020 2020 7465 7874              text
-00006700: 203d 2027 272e 6a6f 696e 2864 6976 2e69   = ''.join(div.i
-00006710: 7465 7274 6578 7428 2929 0a20 2020 2020  tertext()).     
-00006720: 2020 2020 2020 2069 6620 2263 6c61 7373         if "class
-00006730: 2220 696e 2064 6976 2e61 7474 7269 623a  " in div.attrib:
-00006740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006750: 2070 6172 656e 7420 3d20 636c 732e 7072   parent = cls.pr
-00006760: 6f63 6573 735f 636c 6173 735f 6469 7628  ocess_class_div(
-00006770: 6469 762c 2064 6976 5f73 7479 6c65 732c  div, div_styles,
-00006780: 2070 6172 656e 742c 2070 6172 656e 7473   parent, parents
-00006790: 2c20 7465 7874 290a 0a20 2020 2020 2020  , text)..       
-000067a0: 2020 2020 2065 6c69 6620 7465 7874 2e73       elif text.s
-000067b0: 7461 7274 7377 6974 6828 5354 4152 5429  tartswith(START)
-000067c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000067d0: 2020 7061 7265 6e74 203d 2063 6c73 2e70    parent = cls.p
-000067e0: 726f 6365 7373 5f69 7063 635f 7374 6172  rocess_ipcc_star
-000067f0: 7428 464c 4f41 542c 2053 5441 5254 2c20  t(FLOAT, START, 
-00006800: 7061 7265 6e74 2c20 7374 6172 745f 656e  parent, start_en
-00006810: 6473 2c20 7465 7874 290a 0a20 2020 2020  ds, text)..     
-00006820: 2020 2020 2020 2065 6c69 6620 7465 7874         elif text
-00006830: 2e73 7461 7274 7377 6974 6828 454e 4429  .startswith(END)
-00006840: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00006850: 2020 7061 7265 6e74 203d 2063 6c73 2e70    parent = cls.p
-00006860: 726f 6365 7373 5f69 7063 635f 656e 6428  rocess_ipcc_end(
-00006870: 454e 442c 2053 5441 5254 2c20 7061 7265  END, START, pare
-00006880: 6e74 2c20 7374 6172 745f 656e 6473 2c20  nt, start_ends, 
-00006890: 7465 7874 290a 0a20 2020 2020 2020 2020  text)..         
-000068a0: 2020 2065 6c69 6620 636c 732e 736b 6970     elif cls.skip
-000068b0: 5f63 6f6e 7465 6e74 2874 6578 742c 2073  _content(text, s
-000068c0: 6b69 705f 7265 7329 3a0a 2020 2020 2020  kip_res):.      
-000068d0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-000068e0: 6622 736b 6970 7065 6420 7b74 6578 745b  f"skipped {text[
-000068f0: 3a35 305d 7d22 290a 0a20 2020 2020 2020  :50]}")..       
-00006900: 2020 2020 2023 2065 6c69 6620 636c 732e       # elif cls.
-00006910: 6973 5f66 6f6f 746e 6f74 6528 7370 616e  is_footnote(span
-00006920: 293a 0a20 2020 2020 2020 2020 2020 2023  ):.            #
-00006930: 2020 2020 2070 7269 6e74 2866 2273 6b69       print(f"ski
-00006940: 7070 6564 207b 7465 7874 5b3a 3530 5d7d  pped {text[:50]}
-00006950: 2229 0a20 2020 2020 2020 2020 2020 2023  ").            #
-00006960: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00006970: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00006980: 2020 2070 6172 656e 742e 6170 7065 6e64     parent.append
-00006990: 2864 6976 290a 0a20 2020 2020 2020 2072  (div)..        r
-000069a0: 6574 7572 6e20 726f 6f74 5f64 6976 0a0a  eturn root_div..
-000069b0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-000069c0: 0a20 2020 2064 6566 2070 726f 6365 7373  .    def process
-000069d0: 5f69 7063 635f 656e 6428 636c 732c 2045  _ipcc_end(cls, E
-000069e0: 4e44 2c20 5354 4152 542c 2070 6172 656e  ND, START, paren
-000069f0: 742c 2073 7461 7274 5f65 6e64 732c 2074  t, start_ends, t
-00006a00: 6578 7429 3a0a 2020 2020 2020 2020 656e  ext):.        en
-00006a10: 645f 7374 7220 3d20 7465 7874 5b6c 656e  d_str = text[len
-00006a20: 2845 4e44 293a 5d0a 2020 2020 2020 2020  (END):].        
-00006a30: 6966 2073 7461 7274 5f65 6e64 733a 0a20  if start_ends:. 
-00006a40: 2020 2020 2020 2020 2020 2023 2073 6f6d             # som
-00006a50: 6574 696d 6573 2075 6e62 616c 616e 6365  etimes unbalance
-00006a60: 6420 696e 2064 6f63 756d 656e 740a 2020  d in document.  
-00006a70: 2020 2020 2020 2020 2020 7374 6172 745f            start_
-00006a80: 7374 7220 3d20 7374 6172 745f 656e 6473  str = start_ends
-00006a90: 2e70 6f70 2829 0a20 2020 2020 2020 2020  .pop().         
-00006aa0: 2020 2069 6620 7374 6172 745f 7374 7220     if start_str 
-00006ab0: 213d 2065 6e64 5f73 7472 3a0a 2020 2020  != end_str:.    
-00006ac0: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
-00006ad0: 6572 2e77 6172 6e69 6e67 2866 2275 6e62  er.warning(f"unb
-00006ae0: 616c 616e 6365 643a 207b 5354 4152 5420  alanced: {START 
-00006af0: 2b20 7374 6172 745f 7374 727d 2061 6e64  + start_str} and
-00006b00: 207b 454e 4420 2b20 656e 645f 7374 727d   {END + end_str}
-00006b10: 2229 0a20 2020 2020 2020 2020 2020 2065  ").            e
-00006b20: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00006b30: 2020 2020 2070 6172 656e 7420 3d20 7061       parent = pa
-00006b40: 7265 6e74 2e67 6574 7061 7265 6e74 2829  rent.getparent()
-00006b50: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00006b60: 7061 7265 6e74 0a0a 2020 2020 4063 6c61  parent..    @cla
-00006b70: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-00006b80: 2070 726f 6365 7373 5f69 7063 635f 7374   process_ipcc_st
-00006b90: 6172 7428 636c 732c 2046 4c4f 4154 2c20  art(cls, FLOAT, 
-00006ba0: 5354 4152 542c 2070 6172 656e 742c 2073  START, parent, s
-00006bb0: 7461 7274 5f65 6e64 732c 2074 6578 7429  tart_ends, text)
-00006bc0: 3a0a 2020 2020 2020 2020 7374 6172 745f  :.        start_
-00006bd0: 7374 7220 3d20 7465 7874 5b6c 656e 2853  str = text[len(S
-00006be0: 5441 5254 293a 5d0a 2020 2020 2020 2020  TART):].        
-00006bf0: 7374 6172 745f 656e 6473 2e61 7070 656e  start_ends.appen
-00006c00: 6428 7374 6172 745f 7374 7229 0a20 2020  d(start_str).   
-00006c10: 2020 2020 2073 7562 5f64 6976 203d 2045       sub_div = E
-00006c20: 542e 5375 6245 6c65 6d65 6e74 2870 6172  T.SubElement(par
-00006c30: 656e 742c 2022 6469 7622 290a 2020 2020  ent, "div").    
-00006c40: 2020 2020 7375 625f 6469 762e 6174 7472      sub_div.attr
-00006c50: 6962 5b22 636c 6173 7322 5d20 3d20 464c  ib["class"] = FL
-00006c60: 4f41 540a 2020 2020 2020 2020 7375 625f  OAT.        sub_
-00006c70: 6469 762e 6174 7472 6962 5b22 7469 746c  div.attrib["titl
-00006c80: 6522 5d20 3d20 7465 7874 0a20 2020 2020  e"] = text.     
-00006c90: 2020 2073 7562 5f64 6976 2e61 7474 7269     sub_div.attri
-00006ca0: 625b 2273 7479 6c65 225d 203d 2022 626f  b["style"] = "bo
-00006cb0: 7264 6572 3a20 6461 7368 6564 2062 6c75  rder: dashed blu
-00006cc0: 6520 3370 783b 220a 2020 2020 2020 2020  e 3px;".        
-00006cd0: 7061 7265 6e74 203d 2073 7562 5f64 6976  parent = sub_div
-00006ce0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00006cf0: 7061 7265 6e74 0a0a 2020 2020 4063 6c61  parent..    @cla
-00006d00: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-00006d10: 2070 726f 6365 7373 5f63 6c61 7373 5f64   process_class_d
-00006d20: 6976 2863 6c73 2c20 6469 762c 2064 6976  iv(cls, div, div
-00006d30: 5f73 7479 6c65 732c 2070 6172 656e 742c  _styles, parent,
-00006d40: 2070 6172 656e 7473 2c20 7465 7874 293a   parents, text):
-00006d50: 0a20 2020 2020 2020 2063 6c61 7373 5f76  .        class_v
-00006d60: 616c 7565 203d 2064 6976 2e61 7474 7269  alue = div.attri
-00006d70: 625b 2263 6c61 7373 225d 0a20 2020 2020  b["class"].     
-00006d80: 2020 2023 2044 6574 6572 6d69 6e65 2074     # Determine t
-00006d90: 6865 206c 6576 656c 2062 6173 6564 206f  he level based o
-00006da0: 6e20 7468 6520 636c 6173 7320 6174 7472  n the class attr
-00006db0: 6962 7574 650a 2020 2020 2020 2020 6966  ibute.        if
-00006dc0: 2063 6c61 7373 5f76 616c 7565 2e73 7461   class_value.sta
-00006dd0: 7274 7377 6974 6828 2273 6563 7469 6f6e  rtswith("section
-00006de0: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
-00006df0: 6c65 7665 6c20 3d20 310a 2020 2020 2020  level = 1.      
-00006e00: 2020 656c 6966 2063 6c61 7373 5f76 616c    elif class_val
-00006e10: 7565 2e73 7461 7274 7377 6974 6828 2273  ue.startswith("s
-00006e20: 7562 5f73 6563 7469 6f6e 2229 3a0a 2020  ub_section"):.  
-00006e30: 2020 2020 2020 2020 2020 6c65 7665 6c20            level 
-00006e40: 3d20 320a 2020 2020 2020 2020 656c 6966  = 2.        elif
-00006e50: 2063 6c61 7373 5f76 616c 7565 2e73 7461   class_value.sta
-00006e60: 7274 7377 6974 6828 2273 7562 5f73 7562  rtswith("sub_sub
-00006e70: 5f73 6563 7469 6f6e 2229 3a0a 2020 2020  _section"):.    
-00006e80: 2020 2020 2020 2020 6c65 7665 6c20 3d20          level = 
-00006e90: 330a 2020 2020 2020 2020 656c 7365 3a0a  3.        else:.
-00006ea0: 2020 2020 2020 2020 2020 2020 6c65 7665              leve
-00006eb0: 6c20 3d20 4e6f 6e65 0a20 2020 2020 2020  l = None.       
-00006ec0: 2020 2020 2023 2063 6f6e 7469 6e75 6520       # continue 
-00006ed0: 2023 2053 6b69 7020 3c64 6976 3e20 656c   # Skip <div> el
-00006ee0: 656d 656e 7473 2077 6974 686f 7574 2074  ements without t
-00006ef0: 6974 6c65 2063 6c61 7373 6573 0a20 2020  itle classes.   
-00006f00: 2020 2020 2069 6620 6c65 7665 6c3a 0a20       if level:. 
-00006f10: 2020 2020 2020 2020 2020 2073 7461 636b             stack
-00006f20: 5f70 6172 656e 7420 3d20 7061 7265 6e74  _parent = parent
-00006f30: 735b 6c65 7665 6c20 2d20 315d 0a20 2020  s[level - 1].   
-00006f40: 2020 2020 2020 2020 2069 6620 7374 6163           if stac
-00006f50: 6b5f 7061 7265 6e74 2069 7320 6e6f 7420  k_parent is not 
-00006f60: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00006f70: 2020 2020 2020 6e65 775f 6469 7620 3d20        new_div = 
-00006f80: 4554 2e53 7562 456c 656d 656e 7428 7374  ET.SubElement(st
-00006f90: 6163 6b5f 7061 7265 6e74 2c20 2264 6976  ack_parent, "div
-00006fa0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00006fb0: 2020 206e 6577 5f64 6976 2e61 7474 7269     new_div.attri
-00006fc0: 625b 2274 6974 6c65 225d 203d 2074 6578  b["title"] = tex
-00006fd0: 745b 3a35 305d 0a20 2020 2020 2020 2020  t[:50].         
-00006fe0: 2020 2020 2020 206e 6577 5f64 6976 2e61         new_div.a
-00006ff0: 7474 7269 625b 2273 7479 6c65 225d 203d  ttrib["style"] =
-00007000: 2064 6976 5f73 7479 6c65 735b 6c65 7665   div_styles[leve
-00007010: 6c20 2d20 315d 0a0a 2020 2020 2020 2020  l - 1]..        
-00007020: 2020 2020 2020 2020 7061 7265 6e74 203d          parent =
-00007030: 206e 6577 5f64 6976 0a20 2020 2020 2020   new_div.       
-00007040: 2020 2020 2020 2020 2070 6172 656e 7473           parents
-00007050: 5b6c 6576 656c 5d20 3d20 6e65 775f 6469  [level] = new_di
-00007060: 760a 2020 2020 2020 2020 2020 2020 656c  v.            el
-00007070: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00007080: 2020 2020 6c6f 6767 6572 2e69 6e66 6f28      logger.info(
-00007090: 6622 6e6f 2070 6172 656e 7420 6f6e 2073  f"no parent on s
-000070a0: 7461 636b 206c 6576 656c 207b 6c65 7665  tack level {leve
-000070b0: 6c7d 2229 0a0a 2020 2020 2020 2020 7061  l}")..        pa
-000070c0: 7265 6e74 2e61 7070 656e 6428 6469 7629  rent.append(div)
-000070d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000070e0: 7061 7265 6e74 0a0a 2020 2020 4063 6c61  parent..    @cla
-000070f0: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-00007100: 2073 6b69 705f 636f 6e74 656e 7428 636c   skip_content(cl
-00007110: 732c 2074 6578 742c 2073 6b69 705f 7265  s, text, skip_re
-00007120: 7329 3a0a 2020 2020 2020 2020 666f 7220  s):.        for 
-00007130: 736b 6970 5f72 6520 696e 2073 6b69 705f  skip_re in skip_
-00007140: 7265 733a 0a20 2020 2020 2020 2020 2020  res:.           
-00007150: 2069 6620 736b 6970 5f72 652e 6d61 7463   if skip_re.matc
-00007160: 6828 7465 7874 293a 0a20 2020 2020 2020  h(text):.       
-00007170: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00007180: 5472 7565 0a20 2020 2020 2020 2072 6574  True.        ret
-00007190: 7572 6e20 4661 6c73 650a 0a20 2020 2064  urn False..    d
-000071a0: 6566 206d 6174 6368 5f72 6567 6578 2864  ef match_regex(d
-000071b0: 6976 2c20 7265 6765 782c 2073 6563 7469  iv, regex, secti
-000071c0: 6f6e 5f63 6c61 7373 2c20 7465 7874 293a  on_class, text):
-000071d0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-000071e0: 2020 2020 2020 2020 2020 7265 6720 3d20            reg = 
-000071f0: 7265 2e63 6f6d 7069 6c65 2872 6567 6578  re.compile(regex
-00007200: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
-00007210: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
-00007220: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00007230: 7365 2056 616c 7565 4572 726f 7228 6622  se ValueError(f"
-00007240: 4241 4420 5245 4745 5820 7b72 6567 6578  BAD REGEX {regex
-00007250: 7d20 6265 6361 7573 6520 7b65 7d22 290a  } because {e}").
-00007260: 2020 2020 2020 2020 6d61 7463 6820 3d20          match = 
-00007270: 7265 672e 6d61 7463 6828 7465 7874 290a  reg.match(text).
-00007280: 2020 2020 2020 2020 6966 206d 6174 6368          if match
-00007290: 3a0a 2020 2020 2020 2020 2020 2020 7472  :.            tr
-000072a0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-000072b0: 2020 2069 6420 3d20 6d61 7463 682e 6772     id = match.gr
-000072c0: 6f75 7028 2769 6427 290a 2020 2020 2020  oup('id').      
-000072d0: 2020 2020 2020 2020 2020 6469 762e 6174            div.at
-000072e0: 7472 6962 5b22 7469 746c 6522 5d20 3d20  trib["title"] = 
-000072f0: 6964 0a20 2020 2020 2020 2020 2020 2065  id.            e
-00007300: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
-00007310: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-00007320: 2020 2020 2020 7072 696e 7428 6622 6661        print(f"fa
-00007330: 696c 6564 2074 6f20 6d61 7463 6820 6964  iled to match id
-00007340: 2069 6e20 7b72 6567 6578 7d22 290a 2020   in {regex}").  
-00007350: 2020 2020 2020 2020 2020 6469 762e 6174            div.at
-00007360: 7472 6962 5b22 636c 6173 7322 5d20 3d20  trib["class"] = 
-00007370: 7365 6374 696f 6e5f 636c 6173 730a 0a20  section_class.. 
-00007380: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-00007390: 2020 2020 6465 6620 616e 6e6f 7461 7465      def annotate
-000073a0: 5f74 6974 6c65 5f73 6563 7469 6f6e 7328  _title_sections(
-000073b0: 636c 732c 2068 746d 6c5f 656c 656d 2c20  cls, html_elem, 
-000073c0: 7365 6374 696f 6e5f 7265 6765 7865 733d  section_regexes=
-000073d0: 4e6f 6e65 293a 0a20 2020 2020 2020 2069  None):.        i
-000073e0: 6620 7365 6374 696f 6e5f 7265 6765 7865  f section_regexe
-000073f0: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
-00007400: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00007410: 7565 4572 726f 7228 226d 7573 7420 6861  ueError("must ha
-00007420: 7665 2073 6563 7469 6f6e 5f72 6567 6578  ve section_regex
-00007430: 6573 2061 7267 756d 656e 7422 290a 2020  es argument").  
-00007440: 2020 2020 2020 2020 2020 2320 7468 6973            # this
-00007450: 206f 6e6c 7920 776f 726b 7320 666f 7220   only works for 
-00007460: 4950 4343 2064 7261 6674 0a20 2020 2020  IPCC draft.     
-00007470: 2020 2020 2020 2023 2073 6563 7469 6f6e         # section
-00007480: 5f72 6567 6578 6573 203d 205b 0a20 2020  _regexes = [.   
-00007490: 2020 2020 2020 2020 2023 2020 2020 2028           #     (
-000074a0: 2273 6563 7469 6f6e 222c 2022 5365 6374  "section", "Sect
-000074b0: 696f 6e5c 732a 283f 503c 6964 3e5c 6429  ion\s*(?P<id>\d)
-000074c0: 3a5c 732b 2e2a 2229 2c0a 2020 2020 2020  :\s+.*"),.      
-000074d0: 2020 2020 2020 2320 2020 2020 2822 7375        #     ("su
-000074e0: 625f 7365 6374 696f 6e22 2c20 2228 3f50  b_section", "(?P
-000074f0: 3c69 643e 5c64 2b5c 2e5c 642b 295c 732e  <id>\d+\.\d+)\s.
-00007500: 2a22 292c 0a20 2020 2020 2020 2020 2020  *"),.           
-00007510: 2023 2020 2020 2028 2273 7562 5f73 7562   #     ("sub_sub
-00007520: 5f73 6563 7469 6f6e 222c 2022 283f 503c  _section", "(?P<
-00007530: 6964 3e5c 642b 5c2e 5c64 2b5c 2e5c 642b  id>\d+\.\d+\.\d+
-00007540: 295c 732e 2a22 290a 2020 2020 2020 2020  )\s.*").        
-00007550: 2020 2020 2320 5d0a 0a20 2020 2020 2020      # ]..       
-00007560: 2062 6f64 7920 3d20 4874 6d6c 4c69 622e   body = HtmlLib.
-00007570: 6765 745f 626f 6479 2868 746d 6c5f 656c  get_body(html_el
-00007580: 656d 290a 2020 2020 2020 2020 666f 7220  em).        for 
-00007590: 6469 7620 696e 2062 6f64 792e 7870 6174  div in body.xpat
-000075a0: 6828 222e 2f2f 6469 7622 293a 0a20 2020  h(".//div"):.   
-000075b0: 2020 2020 2020 2020 2074 6578 7420 3d20           text = 
-000075c0: 2727 2e6a 6f69 6e28 6469 762e 6974 6572  ''.join(div.iter
-000075d0: 7465 7874 2829 290a 0a20 2020 2020 2020  text())..       
-000075e0: 2020 2020 2066 6f72 2073 6563 7469 6f6e       for section
-000075f0: 5f72 6567 6578 2069 6e20 7365 6374 696f  _regex in sectio
-00007600: 6e5f 7265 6765 7865 733a 0a20 2020 2020  n_regexes:.     
-00007610: 2020 2020 2020 2020 2020 2073 6563 7469             secti
-00007620: 6f6e 5f63 6c61 7373 203d 2073 6563 7469  on_class = secti
-00007630: 6f6e 5f72 6567 6578 5b30 5d0a 2020 2020  on_regex[0].    
-00007640: 2020 2020 2020 2020 2020 2020 7265 6765              rege
-00007650: 7820 3d20 4e6f 6e65 2069 6620 6e6f 7420  x = None if not 
-00007660: 7365 6374 696f 6e5f 7265 6765 7820 656c  section_regex el
-00007670: 7365 2073 6563 7469 6f6e 5f72 6567 6578  se section_regex
-00007680: 5b31 5d0a 2020 2020 2020 2020 2020 2020  [1].            
-00007690: 2020 2020 6966 206e 6f74 2072 6567 6578      if not regex
-000076a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000076b0: 2020 2020 2020 7072 696e 7428 6622 4e4f        print(f"NO
-000076c0: 2052 4547 4558 3a20 7265 6765 7820 696e   REGEX: regex in
-000076d0: 2073 6563 7469 6f6e 5f72 6567 6578 207b   section_regex {
-000076e0: 7365 6374 696f 6e5f 7265 6765 787d 2229  section_regex}")
-000076f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007700: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
-00007710: 2020 2020 2020 2020 2020 2020 2020 636c                cl
-00007720: 732e 6d61 7463 685f 7265 6765 7828 6469  s.match_regex(di
-00007730: 762c 2072 6567 6578 2c20 7365 6374 696f  v, regex, sectio
-00007740: 6e5f 636c 6173 732c 2074 6578 7429 0a0a  n_class, text)..
-00007750: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-00007760: 0a20 2020 2064 6566 2063 6f6c 6c65 6374  .    def collect
-00007770: 5f66 6c6f 6174 735f 746f 5f62 6163 6b28  _floats_to_back(
-00007780: 636c 732c 2068 746d 6c5f 656c 656d 293a  cls, html_elem):
-00007790: 0a20 2020 2020 2020 2062 6163 6b20 3d20  .        back = 
-000077a0: 4874 6d6c 4772 6f75 702e 6765 745f 6261  HtmlGroup.get_ba
-000077b0: 636b 5f64 6976 2868 746d 6c5f 656c 656d  ck_div(html_elem
-000077c0: 290a 2020 2020 2020 2020 666c 6f61 7473  ).        floats
-000077d0: 203d 2068 746d 6c5f 656c 656d 2e78 7061   = html_elem.xpa
-000077e0: 7468 2822 2e2f 2f64 6976 5b40 636c 6173  th(".//div[@clas
-000077f0: 733d 2766 6c6f 6174 275d 2229 0a20 2020  s='float']").   
-00007800: 2020 2020 206c 6f67 6765 722e 6465 6275       logger.debu
-00007810: 6728 6622 666c 6f61 7473 207b 6c65 6e28  g(f"floats {len(
-00007820: 666c 6f61 7473 297d 2229 0a20 2020 2020  floats)}").     
-00007830: 2020 2066 6f72 2066 6c6f 6174 2069 6e20     for float in 
-00007840: 666c 6f61 7473 3a0a 2020 2020 2020 2020  floats:.        
-00007850: 2020 2020 6261 636b 2e61 7070 656e 6428      back.append(
-00007860: 666c 6f61 7429 0a0a 2020 2020 4063 6c61  float)..    @cla
-00007870: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-00007880: 2063 7265 6174 655f 6261 636b 5f64 6976   create_back_div
-00007890: 2863 6c73 2c20 6874 6d6c 5f65 6c65 6d29  (cls, html_elem)
-000078a0: 3a0a 2020 2020 2020 2020 6261 636b 203d  :.        back =
-000078b0: 2045 542e 5375 6245 6c65 6d65 6e74 2848   ET.SubElement(H
-000078c0: 746d 6c4c 6962 2e67 6574 5f62 6f64 7928  tmlLib.get_body(
-000078d0: 6874 6d6c 5f65 6c65 6d29 2c20 2264 6976  html_elem), "div
-000078e0: 2229 0a20 2020 2020 2020 2062 6163 6b2e  ").        back.
-000078f0: 6174 7472 6962 5b22 636c 6173 7322 5d20  attrib["class"] 
-00007900: 3d20 2262 6163 6b22 0a20 2020 2020 2020  = "back".       
-00007910: 2062 6163 6b2e 6174 7472 6962 5b22 7469   back.attrib["ti
-00007920: 746c 6522 5d20 3d20 2262 6163 6b20 6d61  tle"] = "back ma
-00007930: 7474 6572 220a 2020 2020 2020 2020 6261  tter".        ba
-00007940: 636b 2e61 7474 7269 625b 2273 7479 6c65  ck.attrib["style
-00007950: 225d 203d 2022 6261 636b 6772 6f75 6e64  "] = "background
-00007960: 3a20 2366 6666 6664 643b 2062 6f72 6465  : #ffffdd; borde
-00007970: 723a 2073 6f6c 6964 2070 7572 706c 6520  r: solid purple 
-00007980: 312e 3570 783b 206d 6172 6769 6e3a 2032  1.5px; margin: 2
-00007990: 7078 3b22 0a20 2020 2020 2020 2062 6163  px;".        bac
-000079a0: 6b5f 7469 746c 6520 3d20 4554 2e53 7562  k_title = ET.Sub
-000079b0: 456c 656d 656e 7428 6261 636b 2c20 2264  Element(back, "d
-000079c0: 6976 2229 0a20 2020 2020 2020 2062 6163  iv").        bac
-000079d0: 6b5f 7469 746c 652e 7465 7874 203d 2022  k_title.text = "
-000079e0: 4261 636b 204d 6174 7465 722c 2046 6f6f  Back Matter, Foo
-000079f0: 746e 6f74 6573 2c20 4669 6775 7265 732c  tnotes, Figures,
-00007a00: 2054 6162 6c65 732c 2042 6f78 6573 220a   Tables, Boxes".
-00007a10: 2020 2020 2020 2020 6261 636b 5f74 6974          back_tit
-00007a20: 6c65 2e61 7474 7269 625b 2273 7479 6c65  le.attrib["style
-00007a30: 225d 203d 2022 666f 6e74 2d73 697a 653a  "] = "font-size:
-00007a40: 2032 3070 783b 2066 6f6e 742d 6661 6d69   20px; font-fami
-00007a50: 6c79 3a20 7361 6e73 6572 6966 3b22 0a20  ly: sanserif;". 
-00007a60: 2020 2020 2020 2072 6574 7572 6e20 6261         return ba
-00007a70: 636b 0a0a 2020 2020 4063 6c61 7373 6d65  ck..    @classme
-00007a80: 7468 6f64 0a20 2020 2064 6566 2067 6574  thod.    def get
-00007a90: 5f62 6163 6b5f 6469 7628 636c 732c 2068  _back_div(cls, h
-00007aa0: 746d 6c5f 656c 656d 293a 0a20 2020 2020  tml_elem):.     
-00007ab0: 2020 2022 2222 6765 7420 6f72 2063 7265     """get or cre
-00007ac0: 6174 6520 626f 6479 2f64 6976 5b40 636c  ate body/div[@cl
-00007ad0: 6173 733d 2762 6163 6b27 5d22 2222 0a20  ass='back']""". 
-00007ae0: 2020 2020 2020 2062 6163 6b73 203d 2048         backs = H
-00007af0: 746d 6c4c 6962 2e67 6574 5f62 6f64 7928  tmlLib.get_body(
-00007b00: 6874 6d6c 5f65 6c65 6d29 2e78 7061 7468  html_elem).xpath
-00007b10: 2822 2e2f 6469 765b 636c 6173 733d 2762  ("./div[class='b
-00007b20: 6163 6b27 5d22 290a 2020 2020 2020 2020  ack']").        
-00007b30: 7265 7475 726e 2062 6163 6b73 5b30 5d20  return backs[0] 
-00007b40: 6966 206c 656e 2862 6163 6b73 2920 3e20  if len(backs) > 
-00007b50: 3020 656c 7365 2048 746d 6c47 726f 7570  0 else HtmlGroup
-00007b60: 2e63 7265 6174 655f 6261 636b 5f64 6976  .create_back_div
-00007b70: 2868 746d 6c5f 656c 656d 290a 0a20 2020  (html_elem)..   
-00007b80: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-00007b90: 2020 6465 6620 6372 6561 7465 5f68 6561    def create_hea
-00007ba0: 645f 7374 796c 655f 656c 656d 2863 6c73  d_style_elem(cls
-00007bb0: 2c20 6e65 775f 6874 6d6c 2c20 7461 696c  , new_html, tail
-00007bc0: 3d22 5a5a 5a22 293a 0a20 2020 2020 2020  ="ZZZ"):.       
-00007bd0: 2073 7479 6c65 203d 2045 542e 5375 6245   style = ET.SubE
-00007be0: 6c65 6d65 6e74 2848 746d 6c4c 6962 2e67  lement(HtmlLib.g
-00007bf0: 6574 5f68 6561 6428 6e65 775f 6874 6d6c  et_head(new_html
-00007c00: 292c 2043 5353 5374 796c 652e 5354 594c  ), CSSStyle.STYL
-00007c10: 4529 0a20 2020 2020 2020 2069 6620 7461  E).        if ta
-00007c20: 696c 3a0a 2020 2020 2020 2020 2020 2020  il:.            
-00007c30: 7374 796c 652e 7461 696c 203d 2074 6169  style.tail = tai
-00007c40: 6c0a 2020 2020 2020 2020 2320 6261 7369  l.        # basi
-00007c50: 6320 7374 796c 696e 6720 746f 2073 686f  c styling to sho
-00007c60: 7720 6469 7673 2061 6e64 2073 7061 6e73  w divs and spans
-00007c70: 0a20 2020 2020 2020 2073 7479 6c65 2e74  .        style.t
-00007c80: 6578 7420 3d20 2222 220a 2020 2020 2020  ext = """.      
-00007c90: 2020 6469 7620 7b62 6f72 6465 723a 2072    div {border: r
-00007ca0: 6564 2073 6f6c 6964 2031 7078 3b20 6d61  ed solid 1px; ma
-00007cb0: 7267 696e 3a20 3170 783b 7d0a 2020 2020  rgin: 1px;}.    
-00007cc0: 2020 2020 7370 616e 207b 6261 636b 6772      span {backgr
-00007cd0: 6f75 6e64 3a20 2365 6565 6565 653b 206d  ound: #eeeeee; m
-00007ce0: 6172 6769 6e3a 2031 7078 3b7d 0a20 2020  argin: 1px;}.   
-00007cf0: 2020 2020 2064 6976 2e66 6c6f 6174 207b       div.float {
-00007d00: 6261 636b 6772 6f75 6e64 3a20 2364 6466  background: #ddf
-00007d10: 6666 663b 7d0a 2020 2020 2020 2020 2020  fff;}.          
-00007d20: 2020 2020 2020 2020 2020 2022 2222 0a20             """. 
-00007d30: 2020 2020 2020 2072 6574 7572 6e20 7374         return st
-00007d40: 796c 650a 0a20 2020 2040 636c 6173 736d  yle..    @classm
-00007d50: 6574 686f 640a 2020 2020 6465 6620 6578  ethod.    def ex
-00007d60: 7472 6163 745f 666f 6f74 6e6f 7465 735f  tract_footnotes_
-00007d70: 746f 5f62 6163 6b28 636c 732c 2068 746d  to_back(cls, htm
-00007d80: 6c5f 656c 656d 293a 0a20 2020 2020 2020  l_elem):.       
-00007d90: 2048 746d 6c55 7469 6c2e 6578 7472 6163   HtmlUtil.extrac
-00007da0: 745f 666f 6f74 6e6f 7465 7328 6874 6d6c  t_footnotes(html
-00007db0: 5f65 6c65 6d2c 2022 666f 6e74 2d73 697a  _elem, "font-siz
-00007dc0: 653a 2036 2e30 2229 0a0a 2020 2020 4063  e: 6.0")..    @c
-00007dd0: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-00007de0: 6566 2072 656d 6f76 655f 656d 7074 795f  ef remove_empty_
-00007df0: 6469 7673 2863 6c73 2c20 656c 656d 293a  divs(cls, elem):
-00007e00: 0a20 2020 2020 2020 2064 6976 7320 3d20  .        divs = 
-00007e10: 656c 656d 2e78 7061 7468 2822 2e2f 2f64  elem.xpath(".//d
-00007e20: 6976 2229 0a20 2020 2020 2020 2066 6f72  iv").        for
-00007e30: 2064 6976 2069 6e20 6469 7673 3a0a 2020   div in divs:.  
-00007e40: 2020 2020 2020 2020 2020 7465 7874 203d            text =
-00007e50: 2027 272e 6a6f 696e 2864 6976 2e69 7465   ''.join(div.ite
-00007e60: 7274 6578 7428 2929 0a20 2020 2020 2020  rtext()).       
-00007e70: 2020 2020 2069 6620 6e6f 7420 7465 7874       if not text
-00007e80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00007e90: 2020 6469 762e 6765 7470 6172 656e 7428    div.getparent(
-00007ea0: 292e 7265 6d6f 7665 2864 6976 290a 0a20  ).remove(div).. 
-00007eb0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-00007ec0: 2020 2020 6465 6620 6a6f 696e 5f73 706c      def join_spl
-00007ed0: 6974 5f64 6976 7328 636c 732c 2074 6f70  it_divs(cls, top
-00007ee0: 5f64 6976 293a 0a20 2020 2020 2020 2064  _div):.        d
-00007ef0: 6976 7320 3d20 746f 705f 6469 762e 7870  ivs = top_div.xp
-00007f00: 6174 6828 222e 2f2f 6469 7622 290a 2020  ath(".//div").  
-00007f10: 2020 2020 2020 666f 7220 692c 2064 6976        for i, div
-00007f20: 2069 6e20 656e 756d 6572 6174 6528 6469   in enumerate(di
-00007f30: 7673 293a 0a20 2020 2020 2020 2020 2020  vs):.           
-00007f40: 2069 6620 6920 3e20 303a 0a20 2020 2020   if i > 0:.     
-00007f50: 2020 2020 2020 2020 2020 2064 6976 3020             div0 
-00007f60: 3d20 6469 7673 5b69 202d 2031 5d0a 2020  = divs[i - 1].  
-00007f70: 2020 2020 2020 2020 2020 2020 2020 7370                sp
-00007f80: 616e 3020 3d20 4874 6d6c 4772 6f75 702e  an0 = HtmlGroup.
-00007f90: 6765 745f 6c61 7374 5f73 7061 6e28 6469  get_last_span(di
-00007fa0: 7630 290a 2020 2020 2020 2020 2020 2020  v0).            
-00007fb0: 2020 2020 7370 616e 3120 3d20 4874 6d6c      span1 = Html
-00007fc0: 4772 6f75 702e 6765 745f 6669 7273 745f  Group.get_first_
-00007fd0: 7370 616e 2864 6976 290a 2020 2020 2020  span(div).      
-00007fe0: 2020 2020 2020 2020 2020 6966 2073 7061            if spa
-00007ff0: 6e30 2069 7320 6e6f 7420 4e6f 6e65 2061  n0 is not None a
-00008000: 6e64 2073 7061 6e31 2069 7320 6e6f 7420  nd span1 is not 
-00008010: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00008020: 2020 2020 2020 2020 2020 7374 796c 6530            style0
-00008030: 203d 2043 5353 5374 796c 652e 6372 6561   = CSSStyle.crea
-00008040: 7465 5f63 7373 5f73 7479 6c65 5f66 726f  te_css_style_fro
-00008050: 6d5f 6174 7472 6962 7574 655f 6f66 5f62  m_attribute_of_b
-00008060: 6f64 795f 656c 656d 656e 7428 7370 616e  ody_element(span
-00008070: 3029 0a20 2020 2020 2020 2020 2020 2020  0).             
-00008080: 2020 2020 2020 2073 7479 6c65 3120 3d20         style1 = 
-00008090: 4353 5353 7479 6c65 2e63 7265 6174 655f  CSSStyle.create_
-000080a0: 6373 735f 7374 796c 655f 6672 6f6d 5f61  css_style_from_a
-000080b0: 7474 7269 6275 7465 5f6f 665f 626f 6479  ttribute_of_body
-000080c0: 5f65 6c65 6d65 6e74 2873 7061 6e30 290a  _element(span0).
-000080d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000080e0: 2020 2020 6966 2073 7479 6c65 3020 3d3d      if style0 ==
-000080f0: 2073 7479 6c65 313a 0a20 2020 2020 2020   style1:.       
-00008100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008110: 2069 6620 7370 616e 3120 6973 206e 6f74   if span1 is not
-00008120: 204e 6f6e 6520 616e 6420 6c65 6e28 7370   None and len(sp
-00008130: 616e 312e 7465 7874 2920 3e20 3020 616e  an1.text) > 0 an
-00008140: 6420 7370 616e 312e 7465 7874 5b30 5d2e  d span1.text[0].
-00008150: 6973 6c6f 7765 7228 293a 0a20 2020 2020  islower():.     
-00008160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008170: 2020 2020 2020 2023 2070 7269 6e74 2866         # print(f
-00008180: 2220 6a6f 696e 6564 2073 6563 6f6e 645f  " joined second_
-00008190: 7370 616e 207b 7370 616e 312e 7465 7874  span {span1.text
-000081a0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-000081b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000081c0: 4874 6d6c 5574 696c 2e6a 6f69 6e5f 7370  HtmlUtil.join_sp
-000081d0: 616e 735f 696e 5f73 616d 655f 6469 7628  ans_in_same_div(
-000081e0: 7370 616e 302c 2073 7061 6e31 290a 2020  span0, span1).  
-000081f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008200: 2020 2020 2020 2020 2020 666f 7220 7370            for sp
-00008210: 616e 2069 6e20 6469 762e 7870 6174 6828  an in div.xpath(
-00008220: 222e 2f73 7061 6e22 293a 0a20 2020 2020  "./span"):.     
-00008230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008240: 2020 2020 2020 2020 2020 2064 6976 302e             div0.
-00008250: 6170 7065 6e64 2873 7061 6e29 0a20 2020  append(span).   
-00008260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008270: 2020 2020 2020 2020 2064 6976 2e67 6574           div.get
-00008280: 7061 7265 6e74 2829 2e72 656d 6f76 6528  parent().remove(
-00008290: 6469 7629 0a0a 2020 2020 4063 6c61 7373  div)..    @class
-000082a0: 6d65 7468 6f64 0a20 2020 2064 6566 2067  method.    def g
-000082b0: 6574 5f6c 6173 745f 7370 616e 2863 6c73  et_last_span(cls
-000082c0: 2c20 6469 7629 3a0a 2020 2020 2020 2020  , div):.        
-000082d0: 7370 616e 7320 3d20 6469 762e 7870 6174  spans = div.xpat
-000082e0: 6828 222e 2f73 7061 6e22 290a 2020 2020  h("./span").    
-000082f0: 2020 2020 7265 7475 726e 2073 7061 6e73      return spans
-00008300: 5b2d 315d 2069 6620 6c65 6e28 7370 616e  [-1] if len(span
-00008310: 7329 203e 2030 2065 6c73 6520 4e6f 6e65  s) > 0 else None
-00008320: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-00008330: 6f64 0a20 2020 2064 6566 2067 6574 5f66  od.    def get_f
-00008340: 6972 7374 5f73 7061 6e28 636c 732c 2064  irst_span(cls, d
-00008350: 6976 293a 0a20 2020 2020 2020 2073 7061  iv):.        spa
-00008360: 6e73 203d 2064 6976 2e78 7061 7468 2822  ns = div.xpath("
-00008370: 2e2f 7370 616e 2229 0a20 2020 2020 2020  ./span").       
-00008380: 2072 6574 7572 6e20 7370 616e 735b 305d   return spans[0]
-00008390: 2069 6620 6c65 6e28 7370 616e 7329 203e   if len(spans) >
-000083a0: 2030 2065 6c73 6520 4e6f 6e65 0a0a 2020   0 else None..  
-000083b0: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-000083c0: 2020 2064 6566 2061 6464 5f70 6172 6167     def add_parag
-000083d0: 7261 7068 5f69 6473 2863 6c73 2c20 746f  raph_ids(cls, to
-000083e0: 705f 6469 7629 3a0a 2020 2020 2020 2020  p_div):.        
-000083f0: 2222 2261 6464 7320 7365 7175 656e 7469  """adds sequenti
-00008400: 616c 2070 6172 6167 7261 7068 206e 756d  al paragraph num
-00008410: 6265 7269 6e67 2028 652e 672e 2031 2e32  bering (e.g. 1.2
-00008420: 2e33 203d 3e20 312e 322e 332e 612c 2031  .3 => 1.2.3.a, 1
-00008430: 2e32 2e33 2e62 2065 7463 2222 220a 2020  .2.3.b etc""".  
-00008440: 2020 2020 2020 7469 746c 655f 7061 7261        title_para
-00008450: 5f64 6976 7320 3d20 746f 705f 6469 762e  _divs = top_div.
-00008460: 7870 6174 6828 222e 2f2f 6469 765b 4074  xpath(".//div[@t
-00008470: 6974 6c65 2061 6e64 2063 6f6e 7461 696e  itle and contain
-00008480: 7328 4063 6c61 7373 2c20 2773 6563 7469  s(@class, 'secti
-00008490: 6f6e 2729 5d22 290a 2020 2020 2020 2020  on')]").        
-000084a0: 666f 7220 7469 746c 655f 7061 7261 5f64  for title_para_d
-000084b0: 6976 2069 6e20 7469 746c 655f 7061 7261  iv in title_para
-000084c0: 5f64 6976 733a 0a20 2020 2020 2020 2020  _divs:.         
-000084d0: 2020 206c 6f67 6765 722e 6465 6275 6728     logger.debug(
-000084e0: 6622 7469 746c 6520 7061 7261 2064 6976  f"title para div
-000084f0: 7320 7b6c 656e 2874 6974 6c65 5f70 6172  s {len(title_par
-00008500: 615f 6469 7673 297d 2229 0a20 2020 2020  a_divs)}").     
-00008510: 2020 2020 2020 2074 6974 6c65 5f69 6420         title_id 
-00008520: 3d20 7469 746c 655f 7061 7261 5f64 6976  = title_para_div
-00008530: 2e61 7474 7269 622e 6765 7428 2774 6974  .attrib.get('tit
-00008540: 6c65 2729 0a20 2020 2020 2020 2020 2020  le').           
-00008550: 2069 6620 6e6f 7420 7469 746c 655f 6964   if not title_id
-00008560: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00008570: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-00008580: 2020 2020 2020 2066 6f6c 6c6f 7765 7273         followers
-00008590: 203d 2074 6974 6c65 5f70 6172 615f 6469   = title_para_di
-000085a0: 762e 7870 6174 6828 2266 6f6c 6c6f 7769  v.xpath("followi
-000085b0: 6e67 2d73 6962 6c69 6e67 3a3a 6469 7622  ng-sibling::div"
-000085c0: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
-000085d0: 7220 692c 2066 6f6c 6c6f 7765 7220 696e  r i, follower in
-000085e0: 2065 6e75 6d65 7261 7465 2866 6f6c 6c6f   enumerate(follo
-000085f0: 7765 7273 293a 0a20 2020 2020 2020 2020  wers):.         
-00008600: 2020 2020 2020 206c 6574 7465 7220 3d20         letter = 
-00008610: 4874 6d6c 4772 6f75 702e 6765 6e65 7261  HtmlGroup.genera
-00008620: 7465 5f6c 6f77 6572 6361 7365 5f6c 6574  te_lowercase_let
-00008630: 7465 725f 6964 2869 290a 2020 2020 2020  ter_id(i).      
-00008640: 2020 2020 2020 2020 2020 6964 203d 2074            id = t
-00008650: 6974 6c65 5f69 6420 2b20 222e 2220 2b20  itle_id + "." + 
-00008660: 6c65 7474 6572 0a20 2020 2020 2020 2020  letter.         
-00008670: 2020 2020 2020 2073 7061 6e20 3d20 4554         span = ET
-00008680: 2e45 6c65 6d65 6e74 2822 7370 616e 2229  .Element("span")
-00008690: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000086a0: 2073 7061 6e2e 6174 7472 6962 5b22 7374   span.attrib["st
-000086b0: 796c 6522 5d20 3d20 2262 6163 6b67 726f  yle"] = "backgro
-000086c0: 756e 643a 2023 6666 6666 6464 3b20 666f  und: #ffffdd; fo
-000086d0: 6e74 2d73 697a 653a 2038 7078 220a 2020  nt-size: 8px".  
-000086e0: 2020 2020 2020 2020 2020 2020 2020 7370                sp
-000086f0: 616e 2e74 6578 7420 3d20 6964 0a20 2020  an.text = id.   
-00008700: 2020 2020 2020 2020 2020 2020 2073 7061               spa
-00008710: 6e2e 6174 7472 6962 5b22 6964 225d 203d  n.attrib["id"] =
-00008720: 2069 640a 2020 2020 2020 2020 2020 2020   id.            
-00008730: 2020 2020 666f 6c6c 6f77 6572 2e69 6e73      follower.ins
-00008740: 6572 7428 302c 2073 7061 6e29 0a0a 2020  ert(0, span)..  
-00008750: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-00008760: 2020 2064 6566 206d 616b 655f 6869 6572     def make_hier
-00008770: 6172 6368 6963 616c 5f73 6563 7469 6f6e  archical_section
-00008780: 735f 4b45 5928 636c 732c 2068 746d 6c5f  s_KEY(cls, html_
-00008790: 656c 656d 2c20 7374 656d 2c20 7365 6374  elem, stem, sect
-000087a0: 696f 6e5f 7265 6765 7865 733d 4e6f 6e65  ion_regexes=None
-000087b0: 2c20 6f75 7464 6972 3d4e 6f6e 652c 2064  , outdir=None, d
-000087c0: 6562 7567 3d46 616c 7365 293a 0a20 2020  ebug=False):.   
-000087d0: 2020 2020 2022 2222 4b65 7920 666f 726d       """Key form
-000087e0: 6174 7469 6e67 2072 6f75 7469 6e65 0a20  atting routine. 
-000087f0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00008800: 2020 2048 746d 6c53 7479 6c65 2e65 7874     HtmlStyle.ext
-00008810: 7261 6374 5f73 7479 6c65 735f 616e 645f  ract_styles_and_
-00008820: 6e6f 726d 616c 697a 655f 636c 6173 7372  normalize_classr
-00008830: 6566 7328 6874 6d6c 5f65 6c65 6d2c 206f  efs(html_elem, o
-00008840: 7574 6469 723d 6f75 7464 6972 290a 2020  utdir=outdir).  
-00008850: 2020 2020 2020 6966 206f 7574 6469 723a        if outdir:
-00008860: 0a20 2020 2020 2020 2020 2020 2048 746d  .            Htm
-00008870: 6c4c 6962 2e77 7269 7465 5f68 746d 6c5f  lLib.write_html_
-00008880: 6669 6c65 2868 746d 6c5f 656c 656d 2c20  file(html_elem, 
-00008890: 5061 7468 286f 7574 6469 722c 2066 227b  Path(outdir, f"{
-000088a0: 7374 656d 7d5f 7374 796c 6573 2e68 746d  stem}_styles.htm
-000088b0: 6c22 292c 2064 6562 7567 3d54 7275 6529  l"), debug=True)
-000088c0: 0a20 2020 2020 2020 2048 746d 6c47 726f  .        HtmlGro
-000088d0: 7570 2e61 6e6e 6f74 6174 655f 7469 746c  up.annotate_titl
-000088e0: 655f 7365 6374 696f 6e73 2868 746d 6c5f  e_sections(html_
-000088f0: 656c 656d 2c20 7365 6374 696f 6e5f 7265  elem, section_re
-00008900: 6765 7865 733d 7365 6374 696f 6e5f 7265  gexes=section_re
-00008910: 6765 7865 7329 0a20 2020 2020 2020 2048  gexes).        H
-00008920: 746d 6c47 726f 7570 2e65 7874 7261 6374  tmlGroup.extract
-00008930: 5f66 6f6f 746e 6f74 6573 5f74 6f5f 6261  _footnotes_to_ba
-00008940: 636b 2868 746d 6c5f 656c 656d 290a 2020  ck(html_elem).  
-00008950: 2020 2020 2020 6e65 775f 6469 7620 3d20        new_div = 
-00008960: 4874 6d6c 4772 6f75 702e 6772 6f75 705f  HtmlGroup.group_
-00008970: 6469 7673 5f69 6e74 6f5f 7472 6565 2848  divs_into_tree(H
-00008980: 746d 6c4c 6962 2e67 6574 5f62 6f64 7928  tmlLib.get_body(
-00008990: 6874 6d6c 5f65 6c65 6d29 290a 2020 2020  html_elem)).    
-000089a0: 2020 2020 4874 6d6c 4772 6f75 702e 7265      HtmlGroup.re
-000089b0: 6d6f 7665 5f65 6d70 7479 5f64 6976 7328  move_empty_divs(
-000089c0: 6e65 775f 6469 7629 0a20 2020 2020 2020  new_div).       
-000089d0: 2048 746d 6c47 726f 7570 2e6a 6f69 6e5f   HtmlGroup.join_
-000089e0: 7370 6c69 745f 6469 7673 286e 6577 5f64  split_divs(new_d
-000089f0: 6976 290a 2020 2020 2020 2020 4874 6d6c  iv).        Html
-00008a00: 4772 6f75 702e 6164 645f 7061 7261 6772  Group.add_paragr
-00008a10: 6170 685f 6964 7328 6e65 775f 6469 7629  aph_ids(new_div)
-00008a20: 0a20 2020 2020 2020 2023 2074 7261 6e73  .        # trans
-00008a30: 6665 7220 746f 206e 6577 2065 6c65 6d65  fer to new eleme
-00008a40: 6e74 2028 6d61 7920 6e6f 7420 6265 206e  nt (may not be n
-00008a50: 6563 6573 7361 7279 3f29 0a20 2020 2020  ecessary?).     
-00008a60: 2020 206e 6577 5f68 746d 6c20 3d20 4874     new_html = Ht
-00008a70: 6d6c 4c69 622e 6372 6561 7465 5f68 746d  mlLib.create_htm
-00008a80: 6c5f 7769 7468 5f65 6d70 7479 5f68 6561  l_with_empty_hea
-00008a90: 645f 626f 6479 2829 0a20 2020 2020 2020  d_body().       
-00008aa0: 2048 746d 6c4c 6962 2e67 6574 5f62 6f64   HtmlLib.get_bod
-00008ab0: 7928 6e65 775f 6874 6d6c 292e 6170 7065  y(new_html).appe
-00008ac0: 6e64 286e 6577 5f64 6976 290a 2020 2020  nd(new_div).    
-00008ad0: 2020 2020 4874 6d6c 5374 796c 652e 7472      HtmlStyle.tr
-00008ae0: 616e 7366 6572 5f68 6561 645f 7374 796c  ansfer_head_styl
-00008af0: 6573 2868 746d 6c5f 656c 656d 2c20 6e65  es(html_elem, ne
-00008b00: 775f 6874 6d6c 290a 2020 2020 2020 2020  w_html).        
-00008b10: 4874 6d6c 4772 6f75 702e 636f 6c6c 6563  HtmlGroup.collec
-00008b20: 745f 666c 6f61 7473 5f74 6f5f 6261 636b  t_floats_to_back
-00008b30: 286e 6577 5f68 746d 6c29 0a20 2020 2020  (new_html).     
-00008b40: 2020 2048 746d 6c47 726f 7570 2e61 6e6e     HtmlGroup.ann
-00008b50: 6f74 6174 655f 6970 6363 5f74 6172 6765  otate_ipcc_targe
-00008b60: 745f 6964 7328 6e65 775f 6874 6d6c 290a  t_ids(new_html).
-00008b70: 2020 2020 2020 2020 6966 206f 7574 6469          if outdi
-00008b80: 723a 0a20 2020 2020 2020 2020 2020 2048  r:.            H
-00008b90: 746d 6c4c 6962 2e77 7269 7465 5f68 746d  tmlLib.write_htm
-00008ba0: 6c5f 6669 6c65 286e 6577 5f68 746d 6c2c  l_file(new_html,
-00008bb0: 2050 6174 6828 6f75 7464 6972 2c20 6622   Path(outdir, f"
-00008bc0: 7b73 7465 6d7d 5f67 726f 7570 732e 6874  {stem}_groups.ht
-00008bd0: 6d6c 2229 2c20 6465 6275 673d 5472 7565  ml"), debug=True
-00008be0: 290a 2020 2020 2020 2020 7370 6c69 745f  ).        split_
-00008bf0: 7370 616e 5f72 6567 6578 203d 2022 283f  span_regex = "(?
-00008c00: 503c 7072 653e 2e2a 283f 3a68 6967 687c  P<pre>.*(?:high|
-00008c10: 6d65 6469 756d 7c6c 6f77 295c 5c73 2a28  medium|low)\\s*(
-00008c20: 636f 6e66 6964 656e 6365 2929 283f 503c  confidence))(?P<
-00008c30: 706f 7374 3e2e 2a29 220a 2020 2020 2020  post>.*)".      
-00008c40: 2020 4874 6d6c 4772 6f75 702e 7370 6c69    HtmlGroup.spli
-00008c50: 745f 7370 616e 7328 6e65 775f 6874 6d6c  t_spans(new_html
-00008c60: 2c20 7370 6c69 745f 7370 616e 5f72 6567  , split_span_reg
-00008c70: 6578 290a 2020 2020 2020 2020 6966 206f  ex).        if o
-00008c80: 7574 6469 723a 0a20 2020 2020 2020 2020  utdir:.         
-00008c90: 2020 2048 746d 6c4c 6962 2e77 7269 7465     HtmlLib.write
-00008ca0: 5f68 746d 6c5f 6669 6c65 286e 6577 5f68  _html_file(new_h
-00008cb0: 746d 6c2c 2050 6174 6828 6f75 7464 6972  tml, Path(outdir
-00008cc0: 2c20 6622 7b73 7465 6d7d 5f73 7461 7465  , f"{stem}_state
-00008cd0: 6d65 6e74 732e 6874 6d6c 2229 2c20 6465  ments.html"), de
-00008ce0: 6275 673d 5472 7565 290a 0a20 2020 2020  bug=True)..     
-00008cf0: 2020 2072 6574 7572 6e20 6e65 775f 6874     return new_ht
-00008d00: 6d6c 0a0a 2020 2020 4063 6c61 7373 6d65  ml..    @classme
-00008d10: 7468 6f64 0a20 2020 2064 6566 2067 726f  thod.    def gro
-00008d20: 7570 5f6e 6573 7465 645f 7369 626c 696e  up_nested_siblin
-00008d30: 6773 2863 6c73 2c20 6874 6d6c 5f65 6c65  gs(cls, html_ele
-00008d40: 6d2c 2073 7479 6c65 733d 4e6f 6e65 293a  m, styles=None):
-00008d50: 0a20 2020 2020 2020 2069 6620 7374 796c  .        if styl
-00008d60: 6573 2069 7320 4e6f 6e65 3a0a 2020 2020  es is None:.    
-00008d70: 2020 2020 2020 2020 7374 796c 6573 203d          styles =
-00008d80: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
-00008d90: 2020 2022 626f 7264 6572 203a 2073 6f6c     "border : sol
-00008da0: 6964 2070 7572 706c 6520 3270 783b 206d  id purple 2px; m
-00008db0: 6172 6769 6e3a 3270 783b 222c 0a20 2020  argin:2px;",.   
-00008dc0: 2020 2020 2020 2020 2020 2020 2022 626f               "bo
-00008dd0: 7264 6572 203a 2064 6173 6865 6420 6772  rder : dashed gr
-00008de0: 6565 6e20 312e 3570 783b 206d 6172 6769  een 1.5px; margi
-00008df0: 6e3a 312e 3570 783b 222c 0a20 2020 2020  n:1.5px;",.     
-00008e00: 2020 2020 2020 2020 2020 2022 626f 7264             "bord
-00008e10: 6572 203a 2064 6f74 7465 6420 626c 7565  er : dotted blue
-00008e20: 2031 7078 3b20 6d61 7267 696e 3a31 7078   1px; margin:1px
-00008e30: 3b22 2c0a 2020 2020 2020 2020 2020 2020  ;",.            
-00008e40: 5d0a 0a20 2020 2020 2020 2048 746d 6c47  ]..        HtmlG
-00008e50: 726f 7570 2e67 726f 7570 5f73 6962 6c69  roup.group_sibli
-00008e60: 6e67 7328 6874 6d6c 5f65 6c65 6d2c 206c  ngs(html_elem, l
-00008e70: 6f63 6174 6f72 3d22 7365 6374 696f 6e22  ocator="section"
-00008e80: 2c20 7374 796c 653d 7374 796c 6573 5b30  , style=styles[0
-00008e90: 5d29 0a20 2020 2020 2020 2048 746d 6c47  ]).        HtmlG
-00008ea0: 726f 7570 2e67 726f 7570 5f73 6962 6c69  roup.group_sibli
-00008eb0: 6e67 7328 6874 6d6c 5f65 6c65 6d2c 206c  ngs(html_elem, l
-00008ec0: 6f63 6174 6f72 3d22 7375 625f 7365 6374  ocator="sub_sect
-00008ed0: 696f 6e22 2c20 7374 796c 653d 7374 796c  ion", style=styl
-00008ee0: 6573 5b31 5d2c 2064 6562 7567 3d54 7275  es[1], debug=Tru
-00008ef0: 6529 0a20 2020 2020 2020 2048 746d 6c47  e).        HtmlG
-00008f00: 726f 7570 2e67 726f 7570 5f73 6962 6c69  roup.group_sibli
-00008f10: 6e67 7328 6874 6d6c 5f65 6c65 6d2c 206c  ngs(html_elem, l
-00008f20: 6f63 6174 6f72 3d22 7375 625f 7375 625f  ocator="sub_sub_
-00008f30: 7365 6374 696f 6e22 2c20 7374 796c 653d  section", style=
-00008f40: 7374 796c 6573 5b32 5d29 0a0a 2020 2020  styles[2])..    
-00008f50: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-00008f60: 2064 6566 2061 6e6e 6f74 6174 655f 6970   def annotate_ip
-00008f70: 6363 5f74 6172 6765 745f 6964 7328 636c  cc_target_ids(cl
-00008f80: 732c 2068 746d 6c5f 656c 656d 293a 0a20  s, html_elem):. 
-00008f90: 2020 2020 2020 2022 2222 6669 6e64 7320         """finds 
-00008fa0: 7365 6374 696f 6e73 206f 6620 666f 726d  sections of form
-00008fb0: 207b 7461 7267 6574 5f69 642c 2074 6172   {target_id, tar
-00008fc0: 6765 745f 6964 2e2e 2e7d 2061 6e64 2061  get_id...} and a
-00008fd0: 6464 7320 636c 6173 733d 7461 7267 6574  dds class=target
-00008fe0: 730a 2020 2020 2020 2020 5468 6973 2069  s.        This i
-00008ff0: 7320 6265 7474 6572 2064 6f6e 6520 696e  s better done in
-00009000: 2074 6865 2061 6e6e 6f74 6174 6f72 2077   the annotator w
-00009010: 6f72 6b66 6c6f 7720 7768 6572 6520 6974  orkflow where it
-00009020: 2077 6f72 6b73 2e20 5468 6973 2069 7320   works. This is 
-00009030: 6120 6861 636b 2066 6f72 0a20 2020 2020  a hack for.     
-00009040: 2020 2066 696c 6573 2077 6869 6368 2068     files which h
-00009050: 6176 6520 6265 656e 206d 6973 7365 6422  ave been missed"
-00009060: 2222 0a20 2020 2020 2020 2072 655f 6375  "".        re_cu
-00009070: 726c 7920 3d20 7265 2e63 6f6d 7069 6c65  rly = re.compile
-00009080: 2872 2228 3f50 3c70 7265 3e2e 2a29 7b28  (r"(?P<pre>.*){(
-00009090: 3f50 3c62 6f64 793e 5b5e 7d5d 2b29 7d28  ?P<body>[^}]+)}(
-000090a0: 3f50 3c70 6f73 743e 2e2a 2922 290a 2020  ?P<post>.*)").  
-000090b0: 2020 2020 2020 5441 5247 4554 5320 3d20        TARGETS = 
-000090c0: 2274 6172 6765 7473 220a 2020 2020 2020  "targets".      
-000090d0: 2020 6375 726c 795f 7370 616e 7320 3d20    curly_spans = 
-000090e0: 6874 6d6c 5f65 6c65 6d2e 7870 6174 6828  html_elem.xpath(
-000090f0: 6622 2e2f 2f73 7061 6e5b 636f 6e74 6169  f".//span[contai
-00009100: 6e73 282e 2c20 277b 7b27 2920 616e 6420  ns(., '{{') and 
-00009110: 636f 6e74 6169 6e73 282e 2c20 277d 7d27  contains(., '}}'
-00009120: 295d 2229 0a20 2020 2020 2020 206c 6f67  )]").        log
-00009130: 6765 722e 6465 6275 6728 6622 666f 756e  ger.debug(f"foun
-00009140: 6420 6375 726c 6965 7320 7b6c 656e 2863  d curlies {len(c
-00009150: 7572 6c79 5f73 7061 6e73 297d 2229 0a20  urly_spans)}"). 
-00009160: 2020 2020 2020 2066 6f72 2073 7061 6e20         for span 
-00009170: 696e 2063 7572 6c79 5f73 7061 6e73 3a0a  in curly_spans:.
-00009180: 2020 2020 2020 2020 2020 2020 7061 7265              pare
-00009190: 6e74 203d 2073 7061 6e2e 6765 7470 6172  nt = span.getpar
-000091a0: 656e 7428 290a 2020 2020 2020 2020 2020  ent().          
-000091b0: 2020 6d61 7463 6820 3d20 7265 5f63 7572    match = re_cur
-000091c0: 6c79 2e6d 6174 6368 2873 7061 6e2e 7465  ly.match(span.te
-000091d0: 7874 290a 2020 2020 2020 2020 2020 2020  xt).            
-000091e0: 6966 206d 6174 6368 3a0a 2020 2020 2020  if match:.      
-000091f0: 2020 2020 2020 2020 2020 666f 7220 6770            for gp
-00009200: 2069 6e20 5b22 7072 6522 2c20 2262 6f64   in ["pre", "bod
-00009210: 7922 2c20 2270 6f73 7422 5d3a 0a20 2020  y", "post"]:.   
-00009220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009230: 2074 203d 206d 6174 6368 2e67 726f 7570   t = match.group
-00009240: 2867 7029 0a20 2020 2020 2020 2020 2020  (gp).           
-00009250: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-00009260: 7429 203e 2030 3a0a 2020 2020 2020 2020  t) > 0:.        
-00009270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009280: 6966 2067 7020 3d3d 2022 626f 6479 223a  if gp == "body":
-00009290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000092a0: 2020 2020 2020 2020 2020 2020 2074 6172               tar
-000092b0: 6765 745f 6964 7320 3d20 7265 2e73 706c  get_ids = re.spl
-000092c0: 6974 2822 5b2c 3b5d 222c 2074 290a 2020  it("[,;]", t).  
-000092d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000092e0: 2020 2020 2020 2020 2020 666f 7220 7461            for ta
-000092f0: 7267 6574 5f69 6420 696e 2074 6172 6765  rget_id in targe
-00009300: 745f 6964 733a 0a20 2020 2020 2020 2020  t_ids:.         
-00009310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009320: 2020 2020 2020 2061 203d 2045 542e 5375         a = ET.Su
-00009330: 6245 6c65 6d65 6e74 2870 6172 656e 742c  bElement(parent,
-00009340: 2022 6122 290a 2020 2020 2020 2020 2020   "a").          
+00002070: 2066 6f72 2074 6167 2069 6e20 7365 6c66   for tag in self
+00002080: 2e64 6573 6365 6e64 616e 7473 5f74 6f5f  .descendants_to_
+00002090: 7265 6d6f 7665 3a0a 2020 2020 2020 2020  remove:.        
+000020a0: 2020 2020 4554 2e73 7472 6970 5f74 6167      ET.strip_tag
+000020b0: 7328 7365 6c66 2e72 6177 5f65 6c65 6d2c  s(self.raw_elem,
+000020c0: 205b 7461 675d 290a 2020 2020 2020 2020   [tag]).        
+000020d0: 6966 2073 656c 662e 7265 6d6f 7665 5f6c  if self.remove_l
+000020e0: 685f 6c69 6e65 5f6e 756d 6265 7273 3a0a  h_line_numbers:.
+000020f0: 2020 2020 2020 2020 2020 2020 4874 6d6c              Html
+00002100: 5574 696c 2e72 656d 6f76 655f 6c68 5f6c  Util.remove_lh_l
+00002110: 696e 655f 6e75 6d62 6572 7328 7365 6c66  ine_numbers(self
+00002120: 2e72 6177 5f65 6c65 6d29 0a20 2020 2020  .raw_elem).     
+00002130: 2020 2069 6620 7365 6c66 2e72 656d 6f76     if self.remov
+00002140: 655f 6c61 7267 655f 666f 6e74 6564 5f65  e_large_fonted_e
+00002150: 6c65 6d65 6e74 733a 0a20 2020 2020 2020  lements:.       
+00002160: 2020 2020 2048 746d 6c55 7469 6c2e 7265       HtmlUtil.re
+00002170: 6d6f 7665 5f6c 6172 6765 5f66 6f6e 7465  move_large_fonte
+00002180: 645f 656c 656d 656e 7473 2873 656c 662e  d_elements(self.
+00002190: 7261 775f 656c 656d 290a 2020 2020 2020  raw_elem).      
+000021a0: 2020 666f 7220 7461 6720 696e 2073 656c    for tag in sel
+000021b0: 662e 656d 7074 795f 656c 656d 656e 7473  f.empty_elements
+000021c0: 5f74 6f5f 7265 6d6f 7665 3a0a 2020 2020  _to_remove:.    
+000021d0: 2020 2020 2020 2020 4874 6d6c 5574 696c          HtmlUtil
+000021e0: 2e72 656d 6f76 655f 656d 7074 795f 656c  .remove_empty_el
+000021f0: 656d 656e 7473 2873 656c 662e 7261 775f  ements(self.raw_
+00002200: 656c 656d 2c20 5b74 6167 5d29 0a20 2020  elem, [tag]).   
+00002210: 2020 2020 2066 6f72 2073 7479 6c65 2069       for style i
+00002220: 6e20 7365 6c66 2e73 7479 6c65 735f 746f  n self.styles_to
+00002230: 5f72 656d 6f76 653a 0a20 2020 2020 2020  _remove:.       
+00002240: 2020 2020 2048 746d 6c55 7469 6c2e 7265       HtmlUtil.re
+00002250: 6d6f 7665 5f73 7479 6c65 2873 656c 662e  move_style(self.
+00002260: 7261 775f 656c 656d 2c20 5b73 7479 6c65  raw_elem, [style
+00002270: 5d29 0a0a 2020 2020 6465 6620 7365 745f  ])..    def set_
+00002280: 7265 6d6f 7665 5f66 6c61 6773 2873 656c  remove_flags(sel
+00002290: 6629 3a0a 2020 2020 2020 2020 2222 220a  f):.        """.
+000022a0: 2020 2020 2020 2020 7365 7420 666c 6167          set flag
+000022b0: 7320 7768 6963 6820 6469 7265 6374 2072  s which direct r
+000022c0: 656d 6f76 616c 206f 6620 656c 656d 656e  emoval of elemen
+000022d0: 7473 2f61 7474 7269 6275 7465 730a 2020  ts/attributes.  
+000022e0: 2020 2020 2020 6e6f 726d 616c 6c79 2075        normally u
+000022f0: 6e64 6572 2075 7365 7220 636f 6e74 726f  nder user contro
+00002300: 6c0a 2020 2020 2020 2020 2222 220a 2020  l.        """.  
+00002310: 2020 2020 2020 7365 6c66 2e61 6464 5f64        self.add_d
+00002320: 6573 6365 6e64 616e 745f 656c 656d 656e  escendant_elemen
+00002330: 745f 746f 5f72 656d 6f76 6528 5b22 6272  t_to_remove(["br
+00002340: 225d 290a 2020 2020 2020 2020 7365 6c66  "]).        self
+00002350: 2e61 6464 5f73 7479 6c65 735f 746f 5f72  .add_styles_to_r
+00002360: 656d 6f76 6528 0a20 2020 2020 2020 2020  emove(.         
+00002370: 2020 205b 0a20 2020 2020 2020 2020 2020     [.           
+00002380: 2020 2020 2053 5f50 4f53 4954 494f 4e2c       S_POSITION,
+00002390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000023a0: 2023 2022 6c65 6674 222c 0a20 2020 2020   # "left",.     
+000023b0: 2020 2020 2020 2020 2020 2053 5f42 4f52             S_BOR
+000023c0: 4445 522c 0a20 2020 2020 2020 2020 2020  DER,.           
+000023d0: 2020 2020 2053 5f57 5249 5449 4e47 5f4d       S_WRITING_M
+000023e0: 4f44 452c 0a20 2020 2020 2020 2020 2020  ODE,.           
+000023f0: 2020 2020 2053 5f57 4944 5448 2c20 2023       S_WIDTH,  #
+00002400: 2074 6869 7320 6469 7361 626c 6573 2066   this disables f
+00002410: 6c6f 7769 6e67 2074 6578 740a 2020 2020  lowing text.    
+00002420: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
+00002430: 2020 290a 2020 2020 2020 2020 7365 6c66    ).        self
+00002440: 2e61 6464 5f69 6420 3d20 5472 7565 0a20  .add_id = True. 
+00002450: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
+00002460: 656d 7074 795f 656c 656d 656e 7473 5f74  empty_elements_t
+00002470: 6f5f 7265 6d6f 7665 285b 2273 7061 6e22  o_remove(["span"
+00002480: 2c20 2264 6976 225d 290a 2020 2020 2020  , "div"]).      
+00002490: 2020 7365 6c66 2e72 656d 6f76 655f 6c68    self.remove_lh
+000024a0: 5f6c 696e 655f 6e75 6d62 6572 7320 3d20  _line_numbers = 
+000024b0: 5472 7565 2020 2320 780a 2020 2020 2020  True  # x.      
+000024c0: 2020 7365 6c66 2e72 656d 6f76 655f 6c61    self.remove_la
+000024d0: 7267 655f 666f 6e74 6564 5f65 6c65 6d65  rge_fonted_eleme
+000024e0: 6e74 7320 3d20 5472 7565 0a20 2020 2020  nts = True.     
+000024f0: 2020 2073 656c 662e 7374 796c 655f 6174     self.style_at
+00002500: 7472 6962 7574 6573 5f74 6f5f 7265 6d6f  tributes_to_remo
+00002510: 7665 203d 205b 2274 6f70 225d 0a20 2020  ve = ["top"].   
+00002520: 2020 2020 2073 656c 662e 6d61 726b 6572       self.marker
+00002530: 5f78 7061 7468 203d 2022 2e2f 2f64 6976  _xpath = ".//div
+00002540: 5b61 5b40 6e61 6d65 5d5d 220a 2020 2020  [a[@name]]".    
+00002550: 2020 2020 7365 6c66 2e73 7479 6c65 5f61      self.style_a
+00002560: 7474 7269 6275 7465 735f 746f 5f72 656d  ttributes_to_rem
+00002570: 6f76 6520 3d20 5b22 6c65 6674 222c 2022  ove = ["left", "
+00002580: 6865 6967 6874 225d 0a0a 2020 2020 6465  height"]..    de
+00002590: 6620 6578 7472 6163 745f 7061 6765 5f62  f extract_page_b
+000025a0: 6f78 6573 2873 656c 662c 2072 616e 6765  oxes(self, range
+000025b0: 733d 4e6f 6e65 293a 0a20 2020 2020 2020  s=None):.       
+000025c0: 2022 2222 0a20 2020 2020 2020 2042 6173   """.        Bas
+000025d0: 6564 206f 6e20 7064 6670 6c75 6d62 6572  ed on pdfplumber
+000025e0: 206f 7574 7075 740a 2020 2020 2020 2020   output.        
+000025f0: 2222 220a 2020 2020 2020 2020 7365 6c66  """.        self
+00002600: 2e70 6167 655f 626f 7865 7320 3d20 5b5d  .page_boxes = []
+00002610: 2020 2320 7061 6765 426f 7820 6d61 7920    # pageBox may 
+00002620: 6d65 7267 6520 7769 7468 2041 6d69 5061  merge with AmiPa
+00002630: 6765 0a0a 2020 2020 2020 2020 6966 2073  ge..        if s
+00002640: 656c 662e 7261 775f 656c 656d 2069 7320  elf.raw_elem is 
+00002650: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00002660: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
+00002670: 2073 7479 6c65 5f73 7061 6e73 203d 2073   style_spans = s
+00002680: 656c 662e 7261 775f 656c 656d 2e78 7061  elf.raw_elem.xpa
+00002690: 7468 2822 2f2f 7370 616e 5b63 6f6e 7461  th("//span[conta
+000026a0: 696e 7328 4073 7479 6c65 2c27 706f 7369  ins(@style,'posi
+000026b0: 7469 6f6e 3a61 6273 6f6c 7574 6527 295d  tion:absolute')]
+000026c0: 2229 0a20 2020 2020 2020 2066 6f72 2073  ").        for s
+000026d0: 7479 6c65 5f73 7061 6e20 696e 2073 7479  tyle_span in sty
+000026e0: 6c65 5f73 7061 6e73 3a0a 2020 2020 2020  le_spans:.      
+000026f0: 2020 2020 2020 6373 735f 7374 796c 6520        css_style 
+00002700: 3d20 4353 5353 7479 6c65 2e63 7265 6174  = CSSStyle.creat
+00002710: 655f 6373 735f 7374 796c 655f 6672 6f6d  e_css_style_from
+00002720: 5f61 7474 7269 6275 7465 5f6f 665f 626f  _attribute_of_bo
+00002730: 6479 5f65 6c65 6d65 6e74 2873 7479 6c65  dy_element(style
+00002740: 5f73 7061 6e29 0a20 2020 2020 2020 2020  _span).         
+00002750: 2020 2069 6620 6373 735f 7374 796c 652e     if css_style.
+00002760: 6865 6967 6874 203e 2073 656c 662e 4d49  height > self.MI
+00002770: 4e5f 5041 4745 5f42 4f58 5f48 4549 4748  N_PAGE_BOX_HEIGH
+00002780: 543a 0a20 2020 2020 2020 2020 2020 2020  T:.             
+00002790: 2020 2070 6167 655f 626f 7820 3d20 5061     page_box = Pa
+000027a0: 6765 426f 7828 6373 735f 7374 796c 653d  geBox(css_style=
+000027b0: 6373 735f 7374 796c 6529 0a20 2020 2020  css_style).     
+000027c0: 2020 2020 2020 2020 2020 2070 6167 655f             page_
+000027d0: 626f 782e 6164 645f 7374 796c 655f 7370  box.add_style_sp
+000027e0: 616e 5f61 6e64 5f70 6167 655f 6e75 6d62  an_and_page_numb
+000027f0: 6572 2873 7479 6c65 5f73 7061 6e29 0a20  er(style_span). 
+00002800: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00002810: 656c 662e 7061 6765 5f62 6f78 6573 2e61  elf.page_boxes.a
+00002820: 7070 656e 6428 7061 6765 5f62 6f78 290a  ppend(page_box).
+00002830: 0a20 2020 2020 2020 2073 656c 662e 6578  .        self.ex
+00002840: 7472 6163 745f 7061 6765 5f6e 756d 6265  tract_page_numbe
+00002850: 7273 2829 0a0a 2020 2020 6465 6620 6578  rs()..    def ex
+00002860: 7472 6163 745f 7061 6765 5f6e 756d 6265  tract_page_numbe
+00002870: 7273 2873 656c 6629 3a0a 2020 2020 2020  rs(self):.      
+00002880: 2020 7061 6765 6e6f 5f78 7061 7468 203d    pageno_xpath =
+00002890: 2022 2f2f 7370 616e 2f64 6976 2f61 5b40   "//span/div/a[@
+000028a0: 6e61 6d65 5d22 2020 2320 7061 6765 206e  name]"  # page n
+000028b0: 756d 6265 7220 626f 7865 733b 2074 6865  umber boxes; the
+000028c0: 2070 6172 656e 7420 7370 616e 2069 7320   parent span is 
+000028d0: 686f 7272 6964 0a20 2020 2020 2020 2065  horrid.        e
+000028e0: 6c65 6d5f 7769 7468 5f70 6167 656e 6f73  lem_with_pagenos
+000028f0: 203d 2073 656c 662e 7261 775f 656c 656d   = self.raw_elem
+00002900: 2e78 7061 7468 2870 6167 656e 6f5f 7870  .xpath(pageno_xp
+00002910: 6174 6829 0a20 2020 2020 2020 2063 7373  ath).        css
+00002920: 5f6c 6173 7420 3d20 4e6f 6e65 0a20 2020  _last = None.   
+00002930: 2020 2020 2022 2222 3c62 723e 3c2f 7370       """<br></sp
+00002940: 616e 3e3c 7370 616e 2073 7479 6c65 3d22  an><span style="
+00002950: 666f 6e74 2d66 616d 696c 793a 2043 616c  font-family: Cal
+00002960: 6962 7269 3b20 666f 6e74 2d73 697a 653a  ibri; font-size:
+00002970: 3130 7078 223e 200a 2020 2020 2020 2020  10px"> .        
+00002980: 2020 2020 2020 2020 3c62 723e 3c73 7061          <br><spa
+00002990: 6e20 7374 796c 653d 2270 6f73 6974 696f  n style="positio
+000029a0: 6e3a 6162 736f 6c75 7465 3b20 626f 7264  n:absolute; bord
+000029b0: 6572 3a20 6772 6179 2031 7078 2073 6f6c  er: gray 1px sol
+000029c0: 6964 3b20 6c65 6674 3a30 7078 3b20 746f  id; left:0px; to
+000029d0: 703a 3934 3170 783b 2077 6964 7468 3a35  p:941px; width:5
+000029e0: 3935 7078 3b20 6865 6967 6874 3a38 3431  95px; height:841
+000029f0: 7078 3b22 3e3c 2f73 7061 6e3e 0a20 2020  px;"></span>.   
+00002a00: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+00002a10: 2020 2020 2020 2020 2020 2020 2020 3c64                <d
+00002a20: 6976 2073 7479 6c65 3d22 706f 7369 7469  iv style="positi
+00002a30: 6f6e 3a61 6273 6f6c 7574 653b 2074 6f70  on:absolute; top
+00002a40: 3a39 3431 7078 3b22 3e3c 6120 6e61 6d65  :941px;"><a name
+00002a50: 3d22 3222 3e50 6167 6520 323c 2f61 3e3c  ="2">Page 2</a><
+00002a60: 2f64 6976 3e0a 2020 2020 2020 2020 2020  /div>.          
+00002a70: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00002a80: 2020 666f 7220 656c 656d 5f77 6974 685f    for elem_with_
+00002a90: 7061 6765 6e6f 2069 6e20 656c 656d 5f77  pageno in elem_w
+00002aa0: 6974 685f 7061 6765 6e6f 733a 0a20 2020  ith_pagenos:.   
+00002ab0: 2020 2020 2020 2020 2067 6574 7061 7265           getpare
+00002ac0: 6e74 203d 2065 6c65 6d5f 7769 7468 5f70  nt = elem_with_p
+00002ad0: 6167 656e 6f2e 6765 7470 6172 656e 7428  ageno.getparent(
+00002ae0: 290a 2020 2020 2020 2020 2020 2020 6373  ).            cs
+00002af0: 7320 3d20 4353 5353 7479 6c65 2e63 7265  s = CSSStyle.cre
+00002b00: 6174 655f 6373 735f 7374 796c 655f 6672  ate_css_style_fr
+00002b10: 6f6d 5f61 7474 7269 6275 7465 5f6f 665f  om_attribute_of_
+00002b20: 626f 6479 5f65 6c65 6d65 6e74 2867 6574  body_element(get
+00002b30: 7061 7265 6e74 290a 2020 2020 2020 2020  parent).        
+00002b40: 2020 2020 7072 6576 5f65 6c65 6d20 3d20      prev_elem = 
+00002b50: 6765 7470 6172 656e 742e 6765 7470 7265  getparent.getpre
+00002b60: 7669 6f75 7328 290a 2020 2020 2020 2020  vious().        
+00002b70: 2020 2020 6865 6967 6874 203d 202d 3120      height = -1 
+00002b80: 6966 2063 7373 5f6c 6173 7420 6973 204e  if css_last is N
+00002b90: 6f6e 6520 656c 7365 2063 7373 2e74 6f70  one else css.top
+00002ba0: 202d 2063 7373 5f6c 6173 742e 746f 700a   - css_last.top.
+00002bb0: 2020 2020 2020 2020 2020 2020 7072 6576              prev
+00002bc0: 5f73 7479 6c65 203d 2043 5353 5374 796c  _style = CSSStyl
+00002bd0: 652e 6372 6561 7465 5f63 7373 5f73 7479  e.create_css_sty
+00002be0: 6c65 5f66 726f 6d5f 6174 7472 6962 7574  le_from_attribut
+00002bf0: 655f 6f66 5f62 6f64 795f 656c 656d 656e  e_of_body_elemen
+00002c00: 7428 7072 6576 5f65 6c65 6d29 0a20 2020  t(prev_elem).   
+00002c10: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00002c20: 7072 6576 5f73 7479 6c65 3a0a 2020 2020  prev_style:.    
+00002c30: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+00002c40: 696e 672e 7761 726e 696e 6728 6622 206e  ing.warning(f" n
+00002c50: 6f20 7072 6576 696f 7573 2073 7479 6c65  o previous style
+00002c60: 2229 0a20 2020 2020 2020 2020 2020 2062  ").            b
+00002c70: 626f 7820 3d20 4e6f 6e65 2069 6620 7072  box = None if pr
+00002c80: 6576 5f73 7479 6c65 2069 7320 4e6f 6e65  ev_style is None
+00002c90: 2065 6c73 6520 7072 6576 5f73 7479 6c65   else prev_style
+00002ca0: 2e63 7265 6174 655f 6262 6f78 2829 0a20  .create_bbox(). 
+00002cb0: 2020 2020 2020 2020 2020 2063 7373 5f6c             css_l
+00002cc0: 6173 7420 3d20 6373 730a 2020 2020 2020  ast = css.      
+00002cd0: 2020 7265 7475 726e 2065 6c65 6d5f 7769    return elem_wi
+00002ce0: 7468 5f70 6167 656e 6f73 0a0a 0a20 2020  th_pagenos...   
+00002cf0: 2064 6566 2070 7269 6e74 5f70 6167 6573   def print_pages
+00002d00: 5f64 6976 2873 656c 662c 2072 616e 6765  _div(self, range
+00002d10: 733d 4e6f 6e65 293a 0a20 2020 2020 2020  s=None):.       
+00002d20: 2022 2222 0a20 2020 2020 2020 206d 6179   """.        may
+00002d30: 6265 206a 7573 7420 6120 6465 6275 6767  be just a debugg
+00002d40: 6572 0a20 2020 2020 2020 2022 2222 0a0a  er.        """..
+00002d50: 2020 2020 2020 2020 6966 2072 616e 6765          if range
+00002d60: 733a 0a20 2020 2020 2020 2020 2020 2048  s:.            H
+00002d70: 746d 6c54 6964 792e 6465 6275 675f 6279  tmlTidy.debug_by
+00002d80: 5f78 7061 7468 2873 656c 662e 7261 775f  _xpath(self.raw_
+00002d90: 656c 656d 2c20 222f 6874 6d6c 2f62 6f64  elem, "/html/bod
+00002da0: 792f 7370 616e 222c 2074 6974 6c65 3d22  y/span", title="
+00002db0: 6469 7265 6374 2073 7061 6e73 2075 6e64  direct spans und
+00002dc0: 6572 2062 6f64 7920 222c 0a20 2020 2020  er body ",.     
+00002dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002de0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00002df0: 616e 6765 3d72 616e 6765 735b 305d 292c  ange=ranges[0]),
+00002e00: 0a20 2020 2020 2020 2020 2020 2048 746d  .            Htm
+00002e10: 6c54 6964 792e 6465 6275 675f 6279 5f78  lTidy.debug_by_x
+00002e20: 7061 7468 2873 656c 662e 7261 775f 656c  path(self.raw_el
+00002e30: 656d 2c20 222f 6874 6d6c 2f62 6f64 792f  em, "/html/body/
+00002e40: 7370 616e 5b64 6976 5d22 2c20 7469 746c  span[div]", titl
+00002e50: 653d 2274 6f70 2d6c 6576 656c 2073 7061  e="top-level spa
+00002e60: 6e73 2077 6974 6820 6469 7673 3f22 2c0a  ns with divs?",.
+00002e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002e90: 2020 2020 7261 6e67 653d 7261 6e67 6573      range=ranges
+00002ea0: 5b31 5d29 0a20 2020 2020 2020 2020 2020  [1]).           
+00002eb0: 2048 746d 6c54 6964 792e 6465 6275 675f   HtmlTidy.debug_
+00002ec0: 6279 5f78 7061 7468 2873 656c 662e 7261  by_xpath(self.ra
+00002ed0: 775f 656c 656d 2c20 222f 6874 6d6c 2f62  w_elem, "/html/b
+00002ee0: 6f64 792f 7370 616e 2f64 6976 222c 2074  ody/span/div", t
+00002ef0: 6974 6c65 3d22 7468 6520 6469 7673 2069  itle="the divs i
+00002f00: 6e20 7374 6f70 2d6c 6576 656c 2073 7061  n stop-level spa
+00002f10: 6e73 222c 0a20 2020 2020 2020 2020 2020  ns",.           
+00002f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002f30: 2020 2020 2020 2020 2072 616e 6765 3d72           range=r
+00002f40: 616e 6765 735b 325d 290a 2020 2020 2020  anges[2]).      
+00002f50: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00002f60: 2020 2020 2020 2020 2020 3c64 6976 2073            <div s
+00002f70: 7479 6c65 3d22 706f 7369 7469 6f6e 3a61  tyle="position:a
+00002f80: 6273 6f6c 7574 653b 2074 6f70 3a34 3530  bsolute; top:450
+00002f90: 3970 783b 223e 3c61 206e 616d 653d 2236  9px;"><a name="6
+00002fa0: 223e 5061 6765 2036 3c2f 613e 3c2f 6469  ">Page 6</a></di
+00002fb0: 763e 0a20 2020 2020 2020 2020 2020 2022  v>.            "
+00002fc0: 2222 0a20 2020 2020 2020 2020 2020 2048  "".            H
+00002fd0: 746d 6c54 6964 792e 6465 6275 675f 6279  tmlTidy.debug_by
+00002fe0: 5f78 7061 7468 2873 656c 662e 7261 775f  _xpath(self.raw_
+00002ff0: 656c 656d 2c20 222f 6874 6d6c 2f62 6f64  elem, "/html/bod
+00003000: 792f 6469 765b 4073 7479 6c65 2061 6e64  y/div[@style and
+00003010: 2061 5d22 2c20 7469 746c 653d 2270 6167   a]", title="pag
+00003020: 6520 6e75 6d62 6572 2062 6f78 6573 2075  e number boxes u
+00003030: 6e64 6572 2062 6f64 7922 2c0a 2020 2020  nder body",.    
+00003040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003060: 7261 6e67 653d 7261 6e67 6573 5b33 5d29  range=ranges[3])
+00003070: 0a20 2020 2020 2020 2020 2020 2048 746d  .            Htm
+00003080: 6c54 6964 792e 6465 6275 675f 6279 5f78  lTidy.debug_by_x
+00003090: 7061 7468 2873 656c 662e 7261 775f 656c  path(self.raw_el
+000030a0: 656d 2c20 222f 6874 6d6c 2f62 6f64 792f  em, "/html/body/
+000030b0: 2f64 6976 5b40 7374 796c 6520 616e 6420  /div[@style and 
+000030c0: 615b 636f 6e74 6169 6e73 282e 2c20 2750  a[contains(., 'P
+000030d0: 6167 6527 295d 5d22 2c0a 2020 2020 2020  age')]]",.      
+000030e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000030f0: 2020 2020 2020 2020 2020 2020 2020 7469                ti
+00003100: 746c 653d 2270 6167 6520 6e75 6d62 6572  tle="page number
+00003110: 2062 6f78 6573 2075 6e64 6572 2062 6f64   boxes under bod
+00003120: 792f 7370 616e 222c 2072 616e 6765 3d72  y/span", range=r
+00003130: 616e 6765 735b 345d 290a 0a20 2020 2040  anges[4])..    @
+00003140: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+00003150: 6465 6620 6465 6275 675f 6279 5f78 7061  def debug_by_xpa
+00003160: 7468 2863 6c73 2c20 656c 656d 2c20 7870  th(cls, elem, xp
+00003170: 6174 682c 2074 6974 6c65 3d4e 6f6e 652c  ath, title=None,
+00003180: 2072 616e 6765 3d4e 6f6e 6529 202d 3e20   range=None) -> 
+00003190: 696e 743a 0a20 2020 2020 2020 2022 2222  int:.        """
+000031a0: 0a20 2020 2020 2020 2061 7070 6c69 6573  .        applies
+000031b0: 2078 7061 7468 2061 6e64 2070 7269 6e74   xpath and print
+000031c0: 7320 6465 6275 6739 0a20 2020 2020 2020  s debug9.       
+000031d0: 2061 7373 6572 740a 2020 2020 2020 2020   assert.        
+000031e0: 3a70 6172 616d 2065 6c65 6d3a 2074 6f20  :param elem: to 
+000031f0: 6465 6275 670a 2020 2020 2020 2020 3a70  debug.        :p
+00003200: 6172 616d 2078 7061 7468 3a20 746f 2064  aram xpath: to d
+00003210: 6562 7567 2077 6974 680a 2020 2020 2020  ebug with.      
+00003220: 2020 3a72 6574 7572 6e3a 2078 7061 7468    :return: xpath
+00003230: 2063 6f75 6e74 0a20 2020 2020 2020 2022   count.        "
+00003240: 2222 0a20 2020 2020 2020 2073 7061 6e73  "".        spans
+00003250: 203d 2065 6c65 6d2e 7870 6174 6828 7870   = elem.xpath(xp
+00003260: 6174 6829 0a20 2020 2020 2020 2069 6620  ath).        if 
+00003270: 7261 6e67 653a 0a20 2020 2020 2020 2020  range:.         
+00003280: 2020 2061 7373 6572 7420 7261 6e67 655b     assert range[
+00003290: 305d 203c 3d20 6c65 6e28 7370 616e 7329  0] <= len(spans)
+000032a0: 203c 3d20 7261 6e67 655b 315d 2c20 6622   <= range[1], f"
+000032b0: 7b27 2720 6966 206e 6f74 2074 6974 6c65  {'' if not title
+000032c0: 2065 6c73 6520 7469 746c 657d 3a20 666f   else title}: fo
+000032d0: 756e 643a 207b 6c65 6e28 7370 616e 7329  und: {len(spans)
+000032e0: 7d22 0a20 2020 2020 2020 2072 6574 7572  }".        retur
+000032f0: 6e20 6c65 6e28 7370 616e 7329 0a0a 2020  n len(spans)..  
+00003300: 2020 6465 6620 6164 645f 656c 656d 656e    def add_elemen
+00003310: 7428 7365 6c66 2c20 656c 656d 293a 0a20  t(self, elem):. 
+00003320: 2020 2020 2020 2073 656c 662e 656c 656d         self.elem
+00003330: 656e 7420 3d20 656c 656d 0a0a 2020 2020  ent = elem..    
+00003340: 6465 6620 6164 645f 6465 7363 656e 6461  def add_descenda
+00003350: 6e74 5f65 6c65 6d65 6e74 5f74 6f5f 7265  nt_element_to_re
+00003360: 6d6f 7665 2873 656c 662c 2064 6573 6365  move(self, desce
+00003370: 6e64 616e 745f 656c 656d 293a 0a20 2020  ndant_elem):.   
+00003380: 2020 2020 2048 746d 6c54 6964 792e 6164       HtmlTidy.ad
+00003390: 645f 656c 656d 656e 7473 5f74 6f5f 7374  d_elements_to_st
+000033a0: 6f72 6528 6465 7363 656e 6461 6e74 5f65  ore(descendant_e
+000033b0: 6c65 6d2c 2073 656c 662e 6465 7363 656e  lem, self.descen
+000033c0: 6461 6e74 735f 746f 5f72 656d 6f76 6529  dants_to_remove)
+000033d0: 0a0a 2020 2020 6465 6620 6164 645f 7374  ..    def add_st
+000033e0: 796c 6573 5f74 6f5f 7265 6d6f 7665 2873  yles_to_remove(s
+000033f0: 656c 662c 2073 7479 6c65 293a 0a20 2020  elf, style):.   
+00003400: 2020 2020 2073 656c 662e 7374 796c 6573       self.styles
+00003410: 5f74 6f5f 7265 6d6f 7665 2e61 7070 656e  _to_remove.appen
+00003420: 6428 7374 796c 6529 0a0a 2020 2020 6465  d(style)..    de
+00003430: 6620 6164 645f 656d 7074 795f 656c 656d  f add_empty_elem
+00003440: 656e 7473 5f74 6f5f 7265 6d6f 7665 2873  ents_to_remove(s
+00003450: 656c 662c 2065 6c65 6d73 5f74 6f5f 7265  elf, elems_to_re
+00003460: 6d6f 7665 293a 0a20 2020 2020 2020 2048  move):.        H
+00003470: 746d 6c54 6964 792e 6164 645f 656c 656d  tmlTidy.add_elem
+00003480: 656e 7473 5f74 6f5f 7374 6f72 6528 656c  ents_to_store(el
+00003490: 656d 735f 746f 5f72 656d 6f76 652c 2073  ems_to_remove, s
+000034a0: 656c 662e 656d 7074 795f 656c 656d 656e  elf.empty_elemen
+000034b0: 7473 5f74 6f5f 7265 6d6f 7665 290a 0a20  ts_to_remove).. 
+000034c0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+000034d0: 2020 2020 6465 6620 6164 645f 656c 656d      def add_elem
+000034e0: 656e 7473 5f74 6f5f 7374 6f72 6528 636c  ents_to_store(cl
+000034f0: 732c 2065 6c65 6d73 5f74 6f5f 7374 6f72  s, elems_to_stor
+00003500: 652c 2065 6c65 6d5f 7374 6f72 6167 6529  e, elem_storage)
+00003510: 3a0a 2020 2020 2020 2020 6966 2065 6c65  :.        if ele
+00003520: 6d73 5f74 6f5f 7374 6f72 6520 6973 206e  ms_to_store is n
+00003530: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00003540: 2020 2020 2069 6620 6e6f 7420 7479 7065       if not type
+00003550: 2865 6c65 6d73 5f74 6f5f 7374 6f72 6529  (elems_to_store)
+00003560: 2069 7320 6c69 7374 3a0a 2020 2020 2020   is list:.      
+00003570: 2020 2020 2020 2020 2020 656c 656d 735f            elems_
+00003580: 746f 5f73 746f 7265 203d 206c 6973 7428  to_store = list(
+00003590: 656c 656d 735f 746f 5f73 746f 7265 290a  elems_to_store).
+000035a0: 2020 2020 2020 2020 2020 2020 656c 656d              elem
+000035b0: 5f73 746f 7261 6765 2e65 7874 656e 6428  _storage.extend(
+000035c0: 656c 656d 735f 746f 5f73 746f 7265 290a  elems_to_store).
+000035d0: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+000035e0: 640a 2020 2020 6465 6620 656e 7375 7265  d.    def ensure
+000035f0: 5f68 746d 6c5f 6865 6164 5f62 6f64 7928  _html_head_body(
+00003600: 636c 732c 2068 746d 6c5f 656c 656d 293a  cls, html_elem):
+00003610: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00003620: 2020 2020 2061 6464 7320 3c68 746d 6c3e       adds <html>
+00003630: 2c20 3c68 6561 643e 2c20 3c62 6f64 793e  , <head>, <body>
+00003640: 2069 6620 6e6f 7420 7072 6573 656e 740a   if not present.
+00003650: 2020 2020 2020 2020 4d6f 7665 2074 6f20          Move to 
+00003660: 4854 4d4c 5469 6479 0a20 2020 2020 2020  HTMLTidy.       
+00003670: 2022 2222 0a20 2020 2020 2020 2068 746d   """.        htm
+00003680: 6c5f 656c 656d 203d 2063 6c73 2e5f 656e  l_elem = cls._en
+00003690: 7375 7265 5f68 746d 6c5f 726f 6f74 2868  sure_html_root(h
+000036a0: 746d 6c5f 656c 656d 290a 2020 2020 2020  tml_elem).      
+000036b0: 2020 6874 6d6c 5f77 6974 685f 6865 6164    html_with_head
+000036c0: 203d 2063 6c73 2e5f 656e 7375 7265 5f68   = cls._ensure_h
+000036d0: 6561 6462 6f64 7928 6874 6d6c 5f65 6c65  eadbody(html_ele
+000036e0: 6d2c 2022 6865 6164 222c 2030 290a 2020  m, "head", 0).  
+000036f0: 2020 2020 2020 6874 6d6c 5f77 6974 685f        html_with_
+00003700: 6865 6164 5f62 6f64 7920 3d20 636c 732e  head_body = cls.
+00003710: 5f65 6e73 7572 655f 6865 6164 626f 6479  _ensure_headbody
+00003720: 2868 746d 6c5f 7769 7468 5f68 6561 642c  (html_with_head,
+00003730: 2022 626f 6479 222c 2031 290a 2020 2020   "body", 1).    
+00003740: 2020 2020 6874 6d6c 5f69 6465 616c 203d      html_ideal =
+00003750: 2063 6c73 2e5f 7469 6479 5f6e 6f6e 5f68   cls._tidy_non_h
+00003760: 6561 645f 626f 6479 5f63 6869 6c64 7265  ead_body_childre
+00003770: 6e28 6874 6d6c 5f77 6974 685f 6865 6164  n(html_with_head
+00003780: 5f62 6f64 7929 0a20 2020 2020 2020 2072  _body).        r
+00003790: 6574 7572 6e20 6874 6d6c 5f69 6465 616c  eturn html_ideal
+000037a0: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
+000037b0: 6f64 0a20 2020 2064 6566 205f 656e 7375  od.    def _ensu
+000037c0: 7265 5f68 6561 6462 6f64 7928 636c 732c  re_headbody(cls,
+000037d0: 2068 746d 6c5f 726f 6f74 2c20 7461 672c   html_root, tag,
+000037e0: 2070 6f73 293a 0a20 2020 2020 2020 2064   pos):.        d
+000037f0: 6573 6365 6e64 7320 3d20 6c65 6e28 6874  escends = len(ht
+00003800: 6d6c 5f72 6f6f 742e 7870 6174 6828 6622  ml_root.xpath(f"
+00003810: 2e2f 2f7b 7461 677d 2229 290a 2020 2020  .//{tag}")).    
+00003820: 2020 2020 6966 2064 6573 6365 6e64 7320      if descends 
+00003830: 3e20 313a 0a20 2020 2020 2020 2020 2020  > 1:.           
+00003840: 206c 6f67 6769 6e67 2e77 6172 6e69 6e67   logging.warning
+00003850: 2866 226d 6f72 6520 7468 616e 2031 207b  (f"more than 1 {
+00003860: 7461 677d 3b20 6361 6e6e 6f74 2070 726f  tag}; cannot pro
+00003870: 6365 7373 2229 0a20 2020 2020 2020 2065  cess").        e
+00003880: 6c69 6620 6465 7363 656e 6473 203d 3d20  lif descends == 
+00003890: 313a 0a20 2020 2020 2020 2020 2020 2023  1:.            #
+000038a0: 206f 6e65 2074 6167 2c20 6f6b 0a20 2020   one tag, ok.   
+000038b0: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
+000038c0: 2020 2020 2020 656c 6966 2064 6573 6365        elif desce
+000038d0: 6e64 7320 3d3d 2030 3a0a 2020 2020 2020  nds == 0:.      
+000038e0: 2020 2020 2020 6865 6164 203d 2045 542e        head = ET.
+000038f0: 456c 656d 656e 7428 7461 6729 0a20 2020  Element(tag).   
+00003900: 2020 2020 2020 2020 2068 746d 6c5f 726f           html_ro
+00003910: 6f74 2e69 6e73 6572 7428 706f 732c 2068  ot.insert(pos, h
+00003920: 6561 6429 0a20 2020 2020 2020 2072 6574  ead).        ret
+00003930: 7572 6e20 6874 6d6c 5f72 6f6f 740a 0a20  urn html_root.. 
+00003940: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+00003950: 2020 2020 6465 6620 5f65 6e73 7572 655f      def _ensure_
+00003960: 6874 6d6c 5f72 6f6f 7428 636c 732c 2068  html_root(cls, h
+00003970: 746d 6c5f 656c 656d 293a 0a20 2020 2020  tml_elem):.     
+00003980: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+00003990: 6620 726f 6f74 2065 6c65 6d65 6e74 2069  f root element i
+000039a0: 7320 6e6f 7420 3c68 746d 6c3e 2063 7265  s not <html> cre
+000039b0: 6174 6573 206f 6e65 2061 6e64 2074 7261  ates one and tra
+000039c0: 6e73 6665 7273 2063 6869 6c64 7265 6e0a  nsfers children.
+000039d0: 2020 2020 2020 2020 3a70 6172 616d 2068          :param h
+000039e0: 746d 6c5f 656c 656d 3a20 6f6c 6420 456c  tml_elem: old El
+000039f0: 656d 656e 7454 7265 6520 6f72 2072 6f6f  ementTree or roo
+00003a00: 7420 456c 656d 656e 740a 2020 2020 2020  t Element.      
+00003a10: 2020 2222 220a 2020 2020 2020 2020 6f6c    """.        ol
+00003a20: 645f 726f 6f74 203d 2068 746d 6c5f 656c  d_root = html_el
+00003a30: 656d 2e67 6574 726f 6f74 2829 2069 6620  em.getroot() if 
+00003a40: 7479 7065 2868 746d 6c5f 656c 656d 2920  type(html_elem) 
+00003a50: 6973 205f 456c 656d 656e 7454 7265 6520  is _ElementTree 
+00003a60: 656c 7365 2068 746d 6c5f 656c 656d 0a20  else html_elem. 
+00003a70: 2020 2020 2020 2068 746d 6c73 203d 2068         htmls = h
+00003a80: 746d 6c5f 656c 656d 2e78 7061 7468 2822  tml_elem.xpath("
+00003a90: 2f68 746d 6c22 290a 2020 2020 2020 2020  /html").        
+00003aa0: 6966 206c 656e 2868 746d 6c73 2920 3d3d  if len(htmls) ==
+00003ab0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00003ac0: 6874 6d6c 5f72 6f6f 7420 3d20 4554 2e45  html_root = ET.E
+00003ad0: 6c65 6d65 6e74 2822 6874 6d6c 2229 0a20  lement("html"). 
+00003ae0: 2020 2020 2020 2020 2020 2068 746d 6c5f             html_
+00003af0: 726f 6f74 2e69 6e73 6572 7428 302c 206f  root.insert(0, o
+00003b00: 6c64 5f72 6f6f 7429 0a20 2020 2020 2020  ld_root).       
+00003b10: 2020 2020 2072 6574 7572 6e20 6874 6d6c       return html
+00003b20: 5f72 6f6f 740a 2020 2020 2020 2020 7265  _root.        re
+00003b30: 7475 726e 2068 746d 6c5f 656c 656d 0a0a  turn html_elem..
+00003b40: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+00003b50: 0a20 2020 2064 6566 205f 7469 6479 5f6e  .    def _tidy_n
+00003b60: 6f6e 5f68 6561 645f 626f 6479 5f63 6869  on_head_body_chi
+00003b70: 6c64 7265 6e28 636c 732c 2068 746d 6c5f  ldren(cls, html_
+00003b80: 7769 7468 5f68 6561 645f 626f 6479 293a  with_head_body):
+00003b90: 0a0a 2020 2020 2020 2020 6865 6164 5f65  ..        head_e
+00003ba0: 6c65 6d73 203d 2068 746d 6c5f 7769 7468  lems = html_with
+00003bb0: 5f68 6561 645f 626f 6479 2e78 7061 7468  _head_body.xpath
+00003bc0: 2848 746d 6c54 6964 792e 4845 4144 5f45  (HtmlTidy.HEAD_E
+00003bd0: 4c45 4d53 5f49 4e5f 5850 4154 4829 0a20  LEMS_IN_XPATH). 
+00003be0: 2020 2020 2020 2068 6561 6420 3d20 6874         head = ht
+00003bf0: 6d6c 5f77 6974 685f 6865 6164 5f62 6f64  ml_with_head_bod
+00003c00: 792e 7870 6174 6828 2268 6561 6422 295b  y.xpath("head")[
+00003c10: 305d 0a20 2020 2020 2020 2066 6f72 2065  0].        for e
+00003c20: 6c65 6d20 696e 2068 6561 645f 656c 656d  lem in head_elem
+00003c30: 733a 0a20 2020 2020 2020 2020 2020 2068  s:.            h
+00003c40: 6561 642e 6170 7065 6e64 2865 6c65 6d29  ead.append(elem)
+00003c50: 0a20 2020 2020 2020 2072 6573 745f 656c  .        rest_el
+00003c60: 656d 7320 3d20 6874 6d6c 5f77 6974 685f  ems = html_with_
+00003c70: 6865 6164 5f62 6f64 792e 7870 6174 6828  head_body.xpath(
+00003c80: 222a 5b6e 6f74 286e 616d 6528 293d 2768  "*[not(name()='h
+00003c90: 6561 6427 2920 616e 6420 6e6f 7428 6e61  ead') and not(na
+00003ca0: 6d65 2829 3d27 626f 6479 2729 5d22 290a  me()='body')]").
+00003cb0: 2020 2020 2020 2020 626f 6479 203d 2068          body = h
+00003cc0: 746d 6c5f 7769 7468 5f68 6561 645f 626f  tml_with_head_bo
+00003cd0: 6479 2e78 7061 7468 2822 626f 6479 2229  dy.xpath("body")
+00003ce0: 5b30 5d0a 2020 2020 2020 2020 666f 7220  [0].        for 
+00003cf0: 656c 656d 2069 6e20 7265 7374 5f65 6c65  elem in rest_ele
+00003d00: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
+00003d10: 626f 6479 2e61 7070 656e 6428 656c 656d  body.append(elem
+00003d20: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00003d30: 2068 746d 6c5f 7769 7468 5f68 6561 645f   html_with_head_
+00003d40: 626f 6479 0a0a 2020 2020 4063 6c61 7373  body..    @class
+00003d50: 6d65 7468 6f64 0a20 2020 2064 6566 2063  method.    def c
+00003d60: 6f6e 6361 7465 6e61 7465 5f73 7061 6e73  oncatenate_spans
+00003d70: 5f77 6974 685f 6964 656e 7469 6361 6c5f  _with_identical_
+00003d80: 7374 796c 6573 2863 6c73 2c20 656c 656d  styles(cls, elem
+00003d90: 2c20 6164 6473 7061 6365 3d54 7275 6529  , addspace=True)
+00003da0: 3a0a 0a20 2020 2020 2020 2022 2222 0a20  :..        """. 
+00003db0: 2020 2020 2020 2053 6f6d 6574 696d 6573         Sometimes
+00003dc0: 2075 6e6e 6563 6573 7361 7279 2073 7061   unnecessary spa
+00003dd0: 6e73 2061 7265 2063 7265 6174 6564 2028  ns are created (
+00003de0: 652e 672e 0a20 2020 2020 2020 203c 7370  e.g..        <sp
+00003df0: 616e 2063 6c61 7373 3d27 7331 273e 666f  an class='s1'>fo
+00003e00: 6f3c 2f73 7061 6e3e 3c73 7061 6e65 2063  o</span><spane c
+00003e10: 6c61 7373 3d22 7331 223e 6261 723c 2f73  lass="s1">bar</s
+00003e20: 7061 6e3e 0a20 2020 2020 2020 2063 7265  pan>.        cre
+00003e30: 6174 6573 203c 7370 616e 2063 6c61 7373  ates <span class
+00003e40: 3d22 7331 223e 666f 6f20 6261 723c 2f73  ="s1">foo bar</s
+00003e50: 7061 6e3e 0a20 2020 2020 2020 203a 7061  pan>.        :pa
+00003e60: 7261 6d20 656c 656d 3a20 7072 6f62 6162  ram elem: probab
+00003e70: 6c79 2061 2064 6976 2077 6974 6820 6368  ly a div with ch
+00003e80: 696c 6420 7370 616e 730a 2020 2020 2020  ild spans.      
+00003e90: 2020 3a70 6172 616d 2061 6464 7370 6163    :param addspac
+00003ea0: 653a 2069 6e73 6572 7420 7370 6163 650a  e: insert space.
+00003eb0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00003ec0: 2020 2020 7370 616e 7320 3d20 656c 656d      spans = elem
+00003ed0: 2e78 7061 7468 2822 2e2f 7370 616e 5b40  .xpath("./span[@
+00003ee0: 636c 6173 735d 2229 0a20 2020 2020 2020  class]").       
+00003ef0: 206c 6173 745f 7370 616e 203d 204e 6f6e   last_span = Non
+00003f00: 650a 2020 2020 2020 2020 7370 6163 6573  e.        spaces
+00003f10: 203d 2022 2220 6966 206e 6f74 2061 6464   = "" if not add
+00003f20: 7370 6163 6520 656c 7365 2022 2022 0a20  space else " ". 
+00003f30: 2020 2020 2020 2066 6f72 2073 7061 6e20         for span 
+00003f40: 696e 2073 7061 6e73 3a0a 2020 2020 2020  in spans:.      
+00003f50: 2020 2020 2020 6966 206c 6173 745f 7370        if last_sp
+00003f60: 616e 2069 7320 6e6f 7420 4e6f 6e65 2061  an is not None a
+00003f70: 6e64 206c 6173 745f 7370 616e 2e61 7474  nd last_span.att
+00003f80: 7269 625b 2263 6c61 7373 225d 203d 3d20  rib["class"] == 
+00003f90: 7370 616e 2e61 7474 7269 625b 2263 6c61  span.attrib["cla
+00003fa0: 7373 225d 3a0a 2020 2020 2020 2020 2020  ss"]:.          
+00003fb0: 2020 2020 2020 6c61 7374 5f73 7061 6e2e        last_span.
+00003fc0: 7465 7874 203d 206c 6173 745f 7370 616e  text = last_span
+00003fd0: 2e74 6578 7420 2b20 7370 6163 6573 202b  .text + spaces +
+00003fe0: 2073 7061 6e2e 7465 7874 0a20 2020 2020   span.text.     
+00003ff0: 2020 2020 2020 2020 2020 2065 6c65 6d2e             elem.
+00004000: 7265 6d6f 7665 2873 7061 6e29 0a20 2020  remove(span).   
+00004010: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00004020: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00004030: 6173 745f 7370 616e 203d 2073 7061 6e0a  ast_span = span.
+00004040: 0a0a 6465 6620 6765 745f 7461 7267 6574  ..def get_target
+00004050: 5f68 7265 6628 7461 7267 6574 5f69 6429  _href(target_id)
+00004060: 3a0a 2020 2020 7265 5f74 6172 6765 7420  :.    re_target 
+00004070: 3d20 7265 2e63 6f6d 7069 6c65 2822 5c5c  = re.compile("\\
+00004080: 732a 283f 503c 7265 706f 7274 3e57 4749  s*(?P<report>WGI
+00004090: 7c57 4749 497c 5747 4949 497c 5352 4343  |WGII|WGIII|SRCC
+000040a0: 4c7c 5352 4f43 437c 5352 3135 7c53 5952  L|SROCC|SR15|SYR
+000040b0: 295c 5c73 2b28 3f50 3c63 6861 7074 6572  )\\s+(?P<chapter
+000040c0: 3e53 504d 7c54 5329 5c5c 732b 283f 503c  >SPM|TS)\\s+(?P<
+000040d0: 7365 6374 696f 6e3e 5b41 2d47 5d5c 5c2e  section>[A-G]\\.
+000040e0: 3f5c 5c64 2b28 3f3a 5c5c 2e5c 5c64 2b29  ?\\d+(?:\\.\\d+)
+000040f0: 2a29 2229 0a20 2020 2067 6974 6875 625f  *)").    github_
+00004100: 6261 7365 203d 2022 6874 7470 733a 2f2f  base = "https://
+00004110: 6874 6d6c 7072 6576 6965 772e 6769 7468  htmlpreview.gith
+00004120: 7562 2e69 6f2f 3f68 7474 7073 3a2f 2f67  ub.io/?https://g
+00004130: 6974 6875 622e 636f 6d22 0a20 2020 2077  ithub.com".    w
+00004140: 6f72 6b69 6e67 5f75 726c 203d 2022 6874  orking_url = "ht
+00004150: 7470 733a 2f2f 6874 6d6c 7072 6576 6965  tps://htmlprevie
+00004160: 772e 6769 7468 7562 2e69 6f2f 3f68 7474  w.github.io/?htt
+00004170: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
+00004180: 7065 7465 726d 722f 7365 6d61 6e74 6963  petermr/semantic
+00004190: 436c 696d 6174 652f 626c 6f62 2f6d 6169  Climate/blob/mai
+000041a0: 6e2f 7465 7374 2e68 746d 6c22 0a20 2020  n/test.html".   
+000041b0: 2072 6570 6f72 745f 6469 6374 203d 207b   report_dict = {
+000041c0: 0a20 2020 2020 2020 2022 7767 6922 203a  .        "wgi" :
+000041d0: 2022 7767 3122 2c0a 2020 2020 2020 2020   "wg1",.        
+000041e0: 2277 6769 6922 3a20 2277 6732 222c 0a20  "wgii": "wg2",. 
+000041f0: 2020 2020 2020 2022 7767 6969 6922 3a20         "wgiii": 
+00004200: 2277 6733 222c 0a20 2020 207d 0a20 2020  "wg3",.    }.   
+00004210: 2068 7265 6620 3d20 2222 0a20 2020 206d   href = "".    m
+00004220: 6174 6368 203d 2072 655f 7461 7267 6574  atch = re_target
+00004230: 2e6d 6174 6368 2874 6172 6765 745f 6964  .match(target_id
+00004240: 290a 2020 2020 6966 206d 6174 6368 3a0a  ).    if match:.
+00004250: 2020 2020 2020 2020 7265 706f 7274 203d          report =
+00004260: 206d 6174 6368 2e67 726f 7570 2822 7265   match.group("re
+00004270: 706f 7274 2229 2e6c 6f77 6572 2829 0a20  port").lower(). 
+00004280: 2020 2020 2020 2072 6570 6f72 7431 203d         report1 =
+00004290: 2072 6570 6f72 745f 6469 6374 2e67 6574   report_dict.get
+000042a0: 2872 6570 6f72 7429 0a20 2020 2020 2020  (report).       
+000042b0: 2072 6570 6f72 7420 3d20 7265 706f 7274   report = report
+000042c0: 3120 6966 2072 6570 6f72 7431 2065 6c73  1 if report1 els
+000042d0: 6520 7265 706f 7274 0a20 2020 2020 2020  e report.       
+000042e0: 2063 6861 7074 6572 203d 206d 6174 6368   chapter = match
+000042f0: 2e67 726f 7570 2822 6368 6170 7465 7222  .group("chapter"
+00004300: 292e 6c6f 7765 7228 290a 2020 2020 2020  ).lower().      
+00004310: 2020 7365 6374 696f 6e20 3d20 6d61 7463    section = matc
+00004320: 682e 6772 6f75 7028 2273 6563 7469 6f6e  h.group("section
+00004330: 2229 2e6c 6f77 6572 2829 0a20 2020 2020  ").lower().     
+00004340: 2020 2068 7265 6620 3d20 6622 7b67 6974     href = f"{git
+00004350: 6875 625f 6261 7365 7d2f 7065 7465 726d  hub_base}/peterm
+00004360: 722f 7365 6d61 6e74 6963 436c 696d 6174  r/semanticClimat
+00004370: 652f 626c 6f62 2f6d 6169 6e2f 6172 362f  e/blob/main/ar6/
+00004380: 6172 362f 7b72 6570 6f72 747d 2f7b 6368  ar6/{report}/{ch
+00004390: 6170 7465 727d 2f68 746d 6c2f 6675 6c6c  apter}/html/full
+000043a0: 7465 7874 2f67 726f 7570 735f 6772 6f75  text/groups_grou
+000043b0: 7073 2e68 746d 6c23 7b73 6563 7469 6f6e  ps.html#{section
+000043c0: 7d22 0a0a 2020 2020 7265 7475 726e 2068  }"..    return h
+000043d0: 7265 660a 0a0a 636c 6173 7320 4874 6d6c  ref...class Html
+000043e0: 4772 6f75 703a 0a20 2020 2022 2222 6772  Group:.    """gr
+000043f0: 6f75 7073 2073 6962 6c69 6e67 7320 696e  oups siblings in
+00004400: 746f 2064 6976 7322 2222 0a0a 2020 2020  to divs"""..    
+00004410: 4445 4641 554c 545f 5354 594c 4553 203d  DEFAULT_STYLES =
+00004420: 205b 0a20 2020 2020 2020 2028 222e 7365   [.        (".se
+00004430: 6374 696f 6e5f 7469 746c 6522 2c20 5b28  ction_title", [(
+00004440: 2263 6f6c 6f72 222c 2022 7265 643b 2229  "color", "red;")
+00004450: 5d29 2c0a 2020 2020 2020 2020 2822 2e73  ]),.        (".s
+00004460: 7562 5f73 6563 7469 6f6e 5f74 6974 6c65  ub_section_title
+00004470: 222c 205b 2822 636f 6c6f 7222 2c20 2262  ", [("color", "b
+00004480: 6c75 653b 2229 5d29 2c0a 2020 2020 2020  lue;")]),.      
+00004490: 2020 2822 2e73 7562 5f73 7562 5f73 6563    (".sub_sub_sec
+000044a0: 7469 6f6e 5f74 6974 6c65 222c 205b 2822  tion_title", [("
+000044b0: 636f 6c6f 7222 2c20 2267 7265 656e 3b22  color", "green;"
+000044c0: 295d 292c 0a20 2020 2020 2020 2028 222e  )]),.        (".
+000044d0: 636f 6e66 6964 656e 6365 222c 205b 2822  confidence", [("
+000044e0: 636f 6c6f 7222 2c20 226f 7261 6e67 653b  color", "orange;
+000044f0: 2229 5d29 2c0a 2020 2020 2020 2020 2822  ")]),.        ("
+00004500: 2e70 726f 6261 6269 6c69 7479 222c 205b  .probability", [
+00004510: 2822 636f 6c6f 7222 2c20 2223 3838 3838  ("color", "#8888
+00004520: 6666 3b22 295d 292c 0a20 2020 2020 2020  ff;")]),.       
+00004530: 2028 222e 7375 7065 7273 6372 6970 7422   (".superscript"
+00004540: 2c20 5b28 2263 6f6c 6f72 222c 2022 6d61  , [("color", "ma
+00004550: 6765 6e74 613b 2229 2c20 2822 6261 636b  genta;"), ("back
+00004560: 6772 6f75 6e64 222c 2022 7965 6c6c 6f77  ground", "yellow
+00004570: 3b22 295d 292c 0a20 2020 2020 2020 2028  ;")]),.        (
+00004580: 222e 6368 756e 6b22 2c20 5b28 2262 6163  ".chunk", [("bac
+00004590: 6b67 726f 756e 6422 2c20 2263 7961 6e3b  kground", "cyan;
+000045a0: 2229 5d29 2c0a 2020 2020 2020 2020 2822  ")]),.        ("
+000045b0: 2e74 6172 6765 7473 222c 205b 2822 6261  .targets", [("ba
+000045c0: 636b 6772 6f75 6e64 222c 2022 2338 3866  ckground", "#88f
+000045d0: 6638 383b 2229 5d29 2c0a 2020 2020 2020  f88;")]),.      
+000045e0: 2020 2822 2e73 7461 7274 222c 205b 2822    (".start", [("
+000045f0: 6261 636b 6772 6f75 6e64 222c 2022 6772  background", "gr
+00004600: 6179 3b22 295d 292c 0a20 2020 2020 2020  ay;")]),.       
+00004610: 2028 222e 656e 6422 2c20 5b28 2262 6163   (".end", [("bac
+00004620: 6b67 726f 756e 6422 2c20 2279 656c 6c6f  kground", "yello
+00004630: 773b 2229 5d29 2c0a 2020 2020 2020 2020  w;")]),.        
+00004640: 2822 2e70 6167 6522 2c20 5b28 2262 6163  (".page", [("bac
+00004650: 6b67 726f 756e 6422 2c20 226d 6167 656e  kground", "magen
+00004660: 7461 3b22 295d 292c 0a20 2020 2020 2020  ta;")]),.       
+00004670: 2028 222e 7374 6174 656d 656e 7422 2c20   (".statement", 
+00004680: 5b28 2262 6163 6b67 726f 756e 6422 2c20  [("background", 
+00004690: 2223 6464 6464 6666 3b22 295d 292c 0a20  "#ddddff;")]),. 
+000046a0: 2020 2020 2020 2028 222e 6c65 7665 6c31         (".level1
+000046b0: 222c 205b 2822 6261 636b 6772 6f75 6e64  ", [("background
+000046c0: 222c 2022 2366 6666 6664 643b 2229 5d29  ", "#ffffdd;")])
+000046d0: 2c0a 2020 2020 2020 2020 2822 2e6c 6576  ,.        (".lev
+000046e0: 656c 3222 2c20 5b28 2262 6163 6b67 726f  el2", [("backgro
+000046f0: 756e 6422 2c20 2223 6464 6666 6666 3b22  und", "#ddffff;"
+00004700: 295d 292c 0a20 2020 2020 2020 2028 222e  )]),.        (".
+00004710: 6c65 7665 6c33 222c 205b 2822 6261 636b  level3", [("back
+00004720: 6772 6f75 6e64 222c 2022 2364 6466 6664  ground", "#ddffd
+00004730: 643b 2229 5d29 2c0a 2020 2020 2020 2020  d;")]),.        
+00004740: 2822 2e66 6f6f 746e 6f74 6522 2c20 5b28  (".footnote", [(
+00004750: 2262 6163 6b67 726f 756e 6422 2c20 2223  "background", "#
+00004760: 6666 6464 6666 3b22 295d 292c 0a20 2020  ffddff;")]),.   
+00004770: 205d 0a0a 2020 2020 4063 6c61 7373 6d65   ]..    @classme
+00004780: 7468 6f64 0a20 2020 2064 6566 2067 656e  thod.    def gen
+00004790: 6572 6174 655f 6c6f 7765 7263 6173 655f  erate_lowercase_
+000047a0: 6c65 7474 6572 5f69 6428 636c 732c 2069  letter_id(cls, i
+000047b0: 293a 0a20 2020 2020 2020 2022 6d61 6b65  ):.        "make
+000047c0: 2069 6420 6f66 2066 6f72 6d20 612c 622c   id of form a,b,
+000047d0: 632c 202e 2e2e 2061 612c 2061 622c 2061  c, ... aa, ab, a
+000047e0: 6320 2e2e 2e20 6261 2c20 6262 2c20 2e2e  c ... ba, bb, ..
+000047f0: 2e20 7a7a 202c 2040 2e73 7472 2869 2922  . zz , @.str(i)"
+00004800: 0a20 2020 2020 2020 2061 6263 203d 2022  .        abc = "
+00004810: 6162 6364 6566 6768 696a 6b6c 6d6e 6f70  abcdefghijklmnop
+00004820: 7172 7374 7576 7778 797a 220a 2020 2020  qrstuvwxyz".    
+00004830: 2020 2020 6969 203d 2069 2025 2032 360a      ii = i % 26.
+00004840: 2020 2020 2020 2020 6a6a 203d 2069 202f          jj = i /
+00004850: 2f20 3236 0a20 2020 2020 2020 2069 6620  / 26.        if 
+00004860: 6920 3e3d 2031 3620 2a20 3136 3a0a 2020  i >= 16 * 16:.  
+00004870: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00004880: 2022 402e 2220 2b20 7374 7228 6929 0a20   "@." + str(i). 
+00004890: 2020 2020 2020 2073 203d 2022 2220 6966         s = "" if
+000048a0: 206a 6a20 3d3d 2030 2065 6c73 6520 6162   jj == 0 else ab
+000048b0: 635b 6a6a 202d 2031 5d0a 2020 2020 2020  c[jj - 1].      
+000048c0: 2020 7265 7475 726e 2073 202b 2061 6263    return s + abc
+000048d0: 5b69 695d 0a0a 0a0a 2020 2020 4063 6c61  [ii]....    @cla
+000048e0: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+000048f0: 2067 726f 7570 5f73 6962 6c69 6e67 7328   group_siblings(
+00004900: 636c 732c 2068 746d 6c5f 656c 656d 2c20  cls, html_elem, 
+00004910: 6c6f 6361 746f 723d 4e6f 6e65 2c20 7061  locator=None, pa
+00004920: 7265 6e74 5f6c 6f63 6174 6f72 3d4e 6f6e  rent_locator=Non
+00004930: 652c 2073 7479 6c65 3d4e 6f6e 652c 2064  e, style=None, d
+00004940: 6562 7567 3d46 616c 7365 293a 0a20 2020  ebug=False):.   
+00004950: 2020 2020 2022 2222 6576 7279 7468 696e       """evrythin
+00004960: 6720 7374 6172 7473 2061 7320 6120 7369  g starts as a si
+00004970: 626c 696e 6721 2222 220a 2020 2020 2020  bling!""".      
+00004980: 2020 7365 6374 696f 6e73 203d 2068 746d    sections = htm
+00004990: 6c5f 656c 656d 2e78 7061 7468 2866 222e  l_elem.xpath(f".
+000049a0: 2f2f 7370 616e 5b73 7461 7274 732d 7769  //span[starts-wi
+000049b0: 7468 2840 636c 6173 732c 2027 7b6c 6f63  th(@class, '{loc
+000049c0: 6174 6f72 7d27 295d 2229 0a20 2020 2020  ator}')]").     
+000049d0: 2020 2066 656e 6365 706f 7374 7320 3d20     fenceposts = 
+000049e0: 6874 6d6c 5f65 6c65 6d2e 7870 6174 6828  html_elem.xpath(
+000049f0: 6622 2e2f 2f73 7061 6e5b 7374 6172 7473  f".//span[starts
+00004a00: 2d77 6974 6828 4063 6c61 7373 2c27 7b70  -with(@class,'{p
+00004a10: 6172 656e 745f 6c6f 6361 746f 727d 2729  arent_locator}')
+00004a20: 5d22 290a 2020 2020 2020 2020 6966 206c  ]").        if l
+00004a30: 656e 2873 6563 7469 6f6e 7329 203e 2030  en(sections) > 0
+00004a40: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
+00004a50: 7265 6e74 203d 2073 6563 7469 6f6e 735b  rent = sections[
+00004a60: 305d 2e67 6574 7061 7265 6e74 2829 0a20  0].getparent(). 
+00004a70: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
+00004a80: 6563 7469 6f6e 2069 6e20 7365 6374 696f  ection in sectio
+00004a90: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
+00004aa0: 2020 2020 636c 732e 6772 6f75 705f 7369      cls.group_si
+00004ab0: 626c 696e 6773 5f62 6574 7765 656e 5f66  blings_between_f
+00004ac0: 656e 6365 706f 7374 7328 6665 6e63 6570  enceposts(fencep
+00004ad0: 6f73 7473 2c20 7374 796c 653d 7374 796c  osts, style=styl
+00004ae0: 652c 2064 6562 7567 3d64 6562 7567 290a  e, debug=debug).
+00004af0: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+00004b00: 640a 2020 2020 6465 6620 6772 6f75 705f  d.    def group_
+00004b10: 7369 626c 696e 6773 5f62 6574 7765 656e  siblings_between
+00004b20: 5f66 656e 6365 706f 7374 7328 636c 732c  _fenceposts(cls,
+00004b30: 2066 656e 6365 706f 7374 732c 2073 7479   fenceposts, sty
+00004b40: 6c65 3d4e 6f6e 652c 2064 6562 7567 3d46  le=None, debug=F
+00004b50: 616c 7365 293a 0a20 2020 2020 2020 2066  alse):.        f
+00004b60: 6f72 2069 2c20 6665 6e63 6570 6f73 7420  or i, fencepost 
+00004b70: 696e 2065 6e75 6d65 7261 7465 2866 656e  in enumerate(fen
+00004b80: 6365 706f 7374 7329 3a0a 2020 2020 2020  ceposts):.      
+00004b90: 2020 2020 2020 6665 6e63 6570 6f73 745f        fencepost_
+00004ba0: 666f 6c6c 6f77 6572 7320 3d20 6665 6e63  followers = fenc
+00004bb0: 6570 6f73 742e 7870 6174 6828 2266 6f6c  epost.xpath("fol
+00004bc0: 6c6f 7769 6e67 2d73 6962 6c69 6e67 3a3a  lowing-sibling::
+00004bd0: 6469 765b 7370 616e 5d22 290a 2020 2020  div[span]").    
+00004be0: 2020 2020 2020 2020 636f 6e74 6169 6e65          containe
+00004bf0: 725f 6469 7620 3d20 4554 2e45 6c65 6d65  r_div = ET.Eleme
+00004c00: 6e74 2822 6469 7622 290a 2020 2020 2020  nt("div").      
+00004c10: 2020 2020 2020 636f 6e74 6169 6e65 725f        container_
+00004c20: 6469 762e 6174 7472 6962 5b22 7374 796c  div.attrib["styl
+00004c30: 6522 5d20 3d20 7374 796c 650a 2020 2020  e"] = style.    
+00004c40: 2020 2020 2020 2020 6665 6e63 6570 6f73          fencepos
+00004c50: 742e 6164 6470 7265 7669 6f75 7328 636f  t.addprevious(co
+00004c60: 6e74 6169 6e65 725f 6469 7629 0a20 2020  ntainer_div).   
+00004c70: 2020 2020 2020 2020 2063 6f6e 7461 696e           contain
+00004c80: 6572 5f64 6976 2e61 7070 656e 6428 6665  er_div.append(fe
+00004c90: 6e63 6570 6f73 7429 0a20 2020 2020 2020  ncepost).       
+00004ca0: 2020 2020 2074 6974 6c65 203d 2066 656e       title = fen
+00004cb0: 6365 706f 7374 2e78 7061 7468 2822 7370  cepost.xpath("sp
+00004cc0: 616e 2229 5b30 5d2e 6174 7472 6962 2e67  an")[0].attrib.g
+00004cd0: 6574 2822 6964 2229 0a20 2020 2020 2020  et("id").       
+00004ce0: 2020 2020 2069 6620 7469 746c 653a 0a20       if title:. 
+00004cf0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00004d00: 6f6e 7461 696e 6572 5f64 6976 2e61 7474  ontainer_div.att
+00004d10: 7269 625b 2274 6974 6c65 225d 203d 2074  rib["title"] = t
+00004d20: 6974 6c65 0a20 2020 2020 2020 2020 2020  itle.           
+00004d30: 2066 6f72 2066 6f6c 6c6f 7765 7220 696e   for follower in
+00004d40: 2066 656e 6365 706f 7374 5f66 6f6c 6c6f   fencepost_follo
+00004d50: 7765 7273 3a0a 2020 2020 2020 2020 2020  wers:.          
+00004d60: 2020 2020 2020 6966 2066 6f6c 6c6f 7765        if followe
+00004d70: 7220 696e 2066 656e 6365 706f 7374 733a  r in fenceposts:
+00004d80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004d90: 2020 2020 2069 6420 3d20 666f 6c6c 6f77       id = follow
+00004da0: 6572 2e78 7061 7468 2822 2e2f 7370 616e  er.xpath("./span
+00004db0: 2229 5b30 5d2e 6174 7472 6962 2e67 6574  ")[0].attrib.get
+00004dc0: 2822 6964 2229 0a20 2020 2020 2020 2020  ("id").         
+00004dd0: 2020 2020 2020 2020 2020 2069 6620 6465             if de
+00004de0: 6275 673a 0a20 2020 2020 2020 2020 2020  bug:.           
+00004df0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00004e00: 6e74 2866 2220 6964 3a20 7b69 647d 2229  nt(f" id: {id}")
+00004e10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004e20: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
+00004e30: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00004e40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004e50: 2020 2020 2069 6620 6465 6275 673a 0a20       if debug:. 
+00004e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004e70: 2020 2020 2020 2070 7269 6e74 2866 226d         print(f"m
+00004e80: 6f76 6564 2066 6f6c 6c6f 7765 7220 7b66  oved follower {f
+00004e90: 6f6c 6c6f 7765 727d 2074 6f20 7b63 6f6e  ollower} to {con
+00004ea0: 7461 696e 6572 5f64 6976 2e61 7474 7269  tainer_div.attri
+00004eb0: 622e 6765 7428 2774 6974 6c65 2729 7d22  b.get('title')}"
+00004ec0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00004ed0: 2020 2020 2020 636f 6e74 6169 6e65 725f        container_
+00004ee0: 6469 762e 6170 7065 6e64 2866 6f6c 6c6f  div.append(follo
+00004ef0: 7765 7229 0a0a 2020 2020 2020 2020 2222  wer)..        ""
+00004f00: 2249 276d 2077 6f72 6b69 6e67 2077 6974  "I'm working wit
+00004f10: 6820 6c78 6d6c 2069 6e20 5079 7468 6f6e  h lxml in Python
+00004f20: 2061 6e64 2077 6973 6820 746f 2067 726f   and wish to gro
+00004f30: 7570 2061 2066 6c61 7420 7365 7420 6f66  up a flat set of
+00004f40: 203c 6469 763e 2065 6c65 6d65 6e74 7320   <div> elements 
+00004f50: 696e 746f 2061 2074 7265 6520 6261 7365  into a tree base
+00004f60: 6420 6f6e 2074 6865 6972 2063 6c61 7373  d on their class
+00004f70: 2061 7474 7269 6275 7465 730a 4920 6861   attributes.I ha
+00004f80: 7665 2061 2073 6574 206f 6620 7365 6374  ve a set of sect
+00004f90: 696f 6e73 203c 6469 763e 2074 6861 7420  ions <div> that 
+00004fa0: 6172 6520 616c 6c20 6368 696c 6472 656e  are all children
+00004fb0: 206f 6620 3c62 6f64 793e 2077 6869 6368   of <body> which
+00004fc0: 206d 7573 7420 6265 2061 7272 616e 6765   must be arrange
+00004fd0: 6420 696e 2061 2074 7265 6520 7374 7275  d in a tree stru
+00004fe0: 6374 7572 652e 2053 6f6d 6520 6f66 2074  cture. Some of t
+00004ff0: 6865 2064 6976 7320 636f 6e74 6169 6e20  he divs contain 
+00005000: 6a75 7374 2061 2074 6974 6c65 2d73 7472  just a title-str
+00005010: 696e 6720 2874 6974 6c65 2d64 6976 7329  ing (title-divs)
+00005020: 2069 6e64 6963 6174 696e 6720 7468 6520   indicating the 
+00005030: 6c65 7665 6c20 696e 2074 7265 653b 2074  level in tree; t
+00005040: 6869 7320 6973 2069 6e64 6963 6174 6564  his is indicated
+00005050: 2062 7920 6120 636c 6173 7320 6174 7472   by a class attr
+00005060: 6962 7574 6520 6f66 2022 7365 6374 696f  ibute of "sectio
+00005070: 6e22 2c20 2273 7562 5f73 6563 7469 6f6e  n", "sub_section
+00005080: 222c 2022 7375 625f 7375 625f 7365 6374  ", "sub_sub_sect
+00005090: 696f 6e22 2c20 6574 632e 2041 6e79 2064  ion", etc. Any d
+000050a0: 6976 7320 666f 6c6c 6f77 696e 6720 7469  ivs following ti
+000050b0: 746c 652d 6469 7673 2062 656c 6f6e 6720  tle-divs belong 
+000050c0: 746f 2074 6865 2073 616d 6520 6c65 7665  to the same leve
+000050d0: 6c2c 2075 6e74 696c 2061 2066 6f6c 6c6f  l, until a follo
+000050e0: 7769 6e67 2074 6974 6c65 2d64 6976 2069  wing title-div i
+000050f0: 7320 7265 6163 6865 642e 2050 6c65 6173  s reached. Pleas
+00005100: 6520 6372 6561 7465 2063 6f64 6520 7468  e create code th
+00005110: 6174 3a0a 2a20 6372 6561 7465 7320 6120  at:.* creates a 
+00005120: 6e65 7720 6869 6572 6172 6368 7920 6f66  new hierarchy of
+00005130: 2064 6976 7320 7265 7072 6573 656e 7469   divs representi
+00005140: 6e67 2074 6865 2074 7265 6520 7374 7275  ng the tree stru
+00005150: 6374 7572 650a 2a20 6164 6473 2074 6865  cture.* adds the
+00005160: 2074 6974 6c65 2d64 6976 7320 616e 6420   title-divs and 
+00005170: 7468 6569 7220 666f 6c6c 6f77 696e 6720  their following 
+00005180: 6e6f 6e2d 7469 746c 652d 6469 7673 2074  non-title-divs t
+00005190: 6f20 7468 6520 6170 7072 6f70 7269 6174  o the appropriat
+000051a0: 6520 706f 7369 7469 6f6e 2069 6e20 7468  e position in th
+000051b0: 6520 6869 6572 6172 6368 792e 0a0a 4865  e hierarchy...He
+000051c0: 7265 2069 7320 6120 7479 7069 6361 6c20  re is a typical 
+000051d0: 696e 7075 743a 0a0a 3c68 746d 6c3e 0a20  input:..<html>. 
+000051e0: 203c 6865 6164 3e2e 2e2e 3c2f 6865 6164   <head>...</head
+000051f0: 3e0a 2020 3c62 6f64 793e 0a20 2020 203c  >.  <body>.    <
+00005200: 6469 7620 636c 6173 733d 2273 6563 7469  div class="secti
+00005210: 6f6e 5f74 6974 6c65 223e 5365 6374 696f  on_title">Sectio
+00005220: 6e20 313c 2f64 6976 3e0a 2020 2020 3c64  n 1</div>.    <d
+00005230: 6976 3e73 7475 6666 2061 3c2f 6469 763e  iv>stuff a</div>
+00005240: 0a20 2020 203c 6469 7620 636c 6173 733d  .    <div class=
+00005250: 2273 7562 7365 6374 696f 6e5f 7469 746c  "subsection_titl
+00005260: 6522 3e53 6563 7469 6f6e 2031 2e31 3c2f  e">Section 1.1</
+00005270: 6469 763e 0a20 2020 203c 6469 763e 7374  div>.    <div>st
+00005280: 7566 6620 623c 2f64 6976 3e0a 2020 2020  uff b</div>.    
+00005290: 3c64 6976 3e73 7475 6666 2062 783c 2f64  <div>stuff bx</d
+000052a0: 6976 3e0a 2020 2020 3c64 6976 2063 6c61  iv>.    <div cla
+000052b0: 7373 3d22 7375 6273 7562 7365 6374 696f  ss="subsubsectio
+000052c0: 6e5f 7469 746c 6522 3e53 6563 7469 6f6e  n_title">Section
+000052d0: 2031 2e31 2e31 3c2f 6469 763e 0a20 2020   1.1.1</div>.   
+000052e0: 203c 6469 763e 7374 7566 6620 7a3c 2f64   <div>stuff z</d
+000052f0: 6976 3e0a 2020 2020 3c64 6976 3e73 7475  iv>.    <div>stu
+00005300: 6666 207a 7a3c 2f64 6976 3e0a 2020 2020  ff zz</div>.    
+00005310: 3c64 6976 2063 6c61 7373 3d22 7375 6273  <div class="subs
+00005320: 7562 7365 6374 696f 6e5f 7469 746c 6522  ubsection_title"
+00005330: 3e53 6563 7469 6f6e 2031 2e31 2e32 3c2f  >Section 1.1.2</
+00005340: 6469 763e 0a20 2020 203c 6469 763e 7374  div>.    <div>st
+00005350: 7566 6620 783c 2f64 6976 3e0a 2020 2020  uff x</div>.    
+00005360: 3c64 6976 3e73 7475 6666 2078 783c 2f64  <div>stuff xx</d
+00005370: 6976 3e0a 2020 2020 3c64 6976 3e73 7475  iv>.    <div>stu
+00005380: 6666 2078 7878 3c2f 6469 763e 0a20 2020  ff xxx</div>.   
+00005390: 203c 6469 7620 636c 6173 733d 2273 7562   <div class="sub
+000053a0: 7365 6374 696f 6e5f 7469 746c 6522 3e53  section_title">S
+000053b0: 6563 7469 6f6e 2031 2e32 3c2f 6469 763e  ection 1.2</div>
+000053c0: 0a20 203c 2f62 6f64 793e 0a3c 2f68 746d  .  </body>.</htm
+000053d0: 6c3e 0a0a 2020 2061 6e64 2064 6573 6972  l>..   and desir
+000053e0: 6564 206f 7574 7075 740a 3c68 746d 6c3e  ed output.<html>
+000053f0: 0a20 203c 6865 6164 3e2e 2e2e 3c2f 6865  .  <head>...</he
+00005400: 6164 3e0a 2020 3c62 6f64 793e 0a20 2020  ad>.  <body>.   
+00005410: 203c 6469 7620 636c 6173 733d 2273 6563   <div class="sec
+00005420: 7469 6f6e 223e 0a20 2020 2020 203c 6469  tion">.      <di
+00005430: 7620 636c 6173 733d 2273 6563 7469 6f6e  v class="section
+00005440: 5f74 6974 6c65 223e 5365 6374 696f 6e20  _title">Section 
+00005450: 313c 2f64 6976 3e0a 2020 2020 2020 3c64  1</div>.      <d
+00005460: 6976 3e73 7475 6666 2061 3c2f 6469 763e  iv>stuff a</div>
+00005470: 0a09 2020 3c64 6976 2063 6c61 7373 3d22  ..  <div class="
+00005480: 7375 6273 6563 7469 6f6e 223e 0a20 2020  subsection">.   
+00005490: 2020 2020 203c 6469 7620 636c 6173 733d       <div class=
+000054a0: 2273 7562 7365 6374 696f 6e5f 7469 746c  "subsection_titl
+000054b0: 6522 3e53 6563 7469 6f6e 2031 2e31 3c2f  e">Section 1.1</
+000054c0: 6469 763e 0a20 2020 2020 2020 203c 6469  div>.        <di
+000054d0: 763e 7374 7566 6620 623c 2f64 6976 3e0a  v>stuff b</div>.
+000054e0: 2020 2020 2020 2020 3c64 6976 3e73 7475          <div>stu
+000054f0: 6666 2062 783c 2f64 6976 3e0a 0909 3c64  ff bx</div>...<d
+00005500: 6976 2063 6c61 7373 3d22 7375 6273 7562  iv class="subsub
+00005510: 7365 6374 696f 6e22 3e0a 2020 2020 2020  section">.      
+00005520: 2020 2020 3c64 6976 2063 6c61 7373 3d22      <div class="
+00005530: 7375 6273 7562 7365 6374 696f 6e5f 7469  subsubsection_ti
+00005540: 746c 6522 3e53 6563 7469 6f6e 2031 2e31  tle">Section 1.1
+00005550: 2e31 3c2f 6469 763e 0a20 2020 2020 2020  .1</div>.       
+00005560: 2020 203c 6469 763e 7374 7566 6620 7a3c     <div>stuff z<
+00005570: 2f64 6976 3e0a 2020 2020 2020 2020 2020  /div>.          
+00005580: 3c64 6976 3e73 7475 6666 207a 7a3c 2f64  <div>stuff zz</d
+00005590: 6976 3e0a 0909 3c2f 6469 763e 0a09 093c  iv>...</div>...<
+000055a0: 6469 7620 636c 6173 733d 2273 7562 7375  div class="subsu
+000055b0: 6273 6563 7469 6f6e 223e 0a20 2020 2020  bsection">.     
+000055c0: 2020 2020 203c 6469 7620 636c 6173 733d       <div class=
+000055d0: 2273 7562 7375 6273 6563 7469 6f6e 5f74  "subsubsection_t
+000055e0: 6974 6c65 223e 5365 6374 696f 6e20 312e  itle">Section 1.
+000055f0: 312e 323c 2f64 6976 3e0a 2020 2020 2020  1.2</div>.      
+00005600: 2020 2020 3c64 6976 3e73 7475 6666 2078      <div>stuff x
+00005610: 3c2f 6469 763e 0a20 2020 2020 2020 2020  </div>.         
+00005620: 203c 6469 763e 7374 7566 6620 7878 3c2f   <div>stuff xx</
+00005630: 6469 763e 0a20 2020 2020 2020 2020 203c  div>.          <
+00005640: 6469 763e 7374 7566 6620 7878 783c 2f64  div>stuff xxx</d
+00005650: 6976 3e0a 0909 3c2f 6469 763e 0a09 2020  iv>...</div>..  
+00005660: 3c2f 6469 763e 0a09 3c2f 6469 763e 0a20  </div>..</div>. 
+00005670: 2020 203c 6469 7620 636c 6173 733d 2273     <div class="s
+00005680: 6563 7469 6f6e 223e 0a20 2020 2020 203c  ection">.      <
+00005690: 6469 7620 636c 6173 733d 2273 6563 7469  div class="secti
+000056a0: 6f6e 5f74 6974 6c65 223e 5365 6374 696f  on_title">Sectio
+000056b0: 6e20 323c 2f64 6976 3e0a 093c 2f64 6976  n 2</div>..</div
+000056c0: 3e0a 2020 3c2f 626f 6479 3e0a 3c2f 6874  >.  </body>.</ht
+000056d0: 6d6c 3e0a 0a43 6861 7447 5054 0a54 6f20  ml>..ChatGPT.To 
+000056e0: 6163 6869 6576 6520 7468 6520 6465 7369  achieve the desi
+000056f0: 7265 6420 6f75 7470 7574 2c20 796f 7520  red output, you 
+00005700: 6361 6e20 7573 6520 7468 6520 666f 6c6c  can use the foll
+00005710: 6f77 696e 6720 5079 7468 6f6e 2063 6f64  owing Python cod
+00005720: 6520 746f 2070 6172 7365 2074 6865 2048  e to parse the H
+00005730: 544d 4c20 7573 696e 6720 6c78 6d6c 2061  TML using lxml a
+00005740: 6e64 2072 6573 7472 7563 7475 7265 2074  nd restructure t
+00005750: 6865 203c 6469 763e 2065 6c65 6d65 6e74  he <div> element
+00005760: 7320 696e 746f 2061 2074 7265 6520 7374  s into a tree st
+00005770: 7275 6374 7572 6520 6261 7365 6420 6f6e  ructure based on
+00005780: 2074 6865 6972 2063 6c61 7373 2061 7474   their class att
+00005790: 7269 6275 7465 733a 0a0a 7079 7468 6f6e  ributes:..python
+000057a0: 0a43 6f70 7920 636f 6465 0a66 726f 6d20  .Copy code.from 
+000057b0: 6c78 6d6c 2069 6d70 6f72 7420 6574 7265  lxml import etre
+000057c0: 6520 2320 696e 2063 6f6d 6d65 6e74 0a0a  e # in comment..
+000057d0: 6465 6620 6772 6f75 705f 6469 7673 5f69  def group_divs_i
+000057e0: 6e74 6f5f 7472 6565 2868 746d 6c29 3a0a  nto_tree(html):.
+000057f0: 2020 2020 2320 5061 7273 6520 7468 6520      # Parse the 
+00005800: 4854 4d4c 0a20 2020 2074 7265 6520 3d20  HTML.    tree = 
+00005810: 6574 7265 652e 4854 4d4c 2868 746d 6c29  etree.HTML(html)
+00005820: 0a0a 2020 2020 2320 4669 6e64 2061 6c6c  ..    # Find all
+00005830: 203c 6469 763e 2065 6c65 6d65 6e74 7320   <div> elements 
+00005840: 7769 7468 696e 2074 6865 203c 626f 6479  within the <body
+00005850: 3e20 7461 670a 2020 2020 6469 765f 656c  > tag.    div_el
+00005860: 656d 656e 7473 203d 2074 7265 652e 7870  ements = tree.xp
+00005870: 6174 6828 222f 2f62 6f64 792f 6469 7622  ath("//body/div"
+00005880: 290a 0a20 2020 2023 2043 7265 6174 6520  )..    # Create 
+00005890: 6120 6e65 7720 726f 6f74 203c 6469 763e  a new root <div>
+000058a0: 2065 6c65 6d65 6e74 2074 6f20 686f 6c64   element to hold
+000058b0: 2074 6865 2074 7265 6520 7374 7275 6374   the tree struct
+000058c0: 7572 650a 2020 2020 726f 6f74 203d 2065  ure.    root = e
+000058d0: 7472 6565 2e45 6c65 6d65 6e74 2822 6469  tree.Element("di
+000058e0: 7622 290a 0a20 2020 2023 2049 6e69 7469  v")..    # Initi
+000058f0: 616c 697a 6520 7661 7269 6162 6c65 7320  alize variables 
+00005900: 746f 206b 6565 7020 7472 6163 6b20 6f66  to keep track of
+00005910: 2074 6865 2063 7572 7265 6e74 2070 6172   the current par
+00005920: 656e 7420 3c64 6976 3e20 616e 6420 6974  ent <div> and it
+00005930: 7320 6c65 7665 6c0a 2020 2020 6375 7272  s level.    curr
+00005940: 656e 745f 7061 7265 6e74 203d 2072 6f6f  ent_parent = roo
+00005950: 740a 2020 2020 6375 7272 656e 745f 6c65  t.    current_le
+00005960: 7665 6c20 3d20 300a 0a20 2020 2066 6f72  vel = 0..    for
+00005970: 2064 6976 2069 6e20 6469 765f 656c 656d   div in div_elem
+00005980: 656e 7473 3a0a 2020 2020 2020 2020 2320  ents:.        # 
+00005990: 4368 6563 6b20 6966 2074 6865 2063 7572  Check if the cur
+000059a0: 7265 6e74 203c 6469 763e 2068 6173 2061  rent <div> has a
+000059b0: 2063 6c61 7373 2061 7474 7269 6275 7465   class attribute
+000059c0: 0a20 2020 2020 2020 2069 6620 2263 6c61  .        if "cla
+000059d0: 7373 2220 696e 2064 6976 2e61 7474 7269  ss" in div.attri
+000059e0: 623a 0a20 2020 2020 2020 2020 2020 2063  b:.            c
+000059f0: 6c61 7373 5f76 616c 7565 203d 2064 6976  lass_value = div
+00005a00: 2e61 7474 7269 625b 2263 6c61 7373 225d  .attrib["class"]
+00005a10: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00005a20: 4465 7465 726d 696e 6520 7468 6520 6c65  Determine the le
+00005a30: 7665 6c20 6261 7365 6420 6f6e 2074 6865  vel based on the
+00005a40: 2063 6c61 7373 2061 7474 7269 6275 7465   class attribute
+00005a50: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00005a60: 636c 6173 735f 7661 6c75 652e 7374 6172  class_value.star
+00005a70: 7473 7769 7468 2822 7365 6374 696f 6e5f  tswith("section_
+00005a80: 7469 746c 6522 293a 0a20 2020 2020 2020  title"):.       
+00005a90: 2020 2020 2020 2020 206c 6576 656c 203d           level =
+00005aa0: 2030 0a20 2020 2020 2020 2020 2020 2065   0.            e
+00005ab0: 6c69 6620 636c 6173 735f 7661 6c75 652e  lif class_value.
+00005ac0: 7374 6172 7473 7769 7468 2822 7375 6273  startswith("subs
+00005ad0: 6563 7469 6f6e 5f74 6974 6c65 2229 3a0a  ection_title"):.
+00005ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005af0: 6c65 7665 6c20 3d20 310a 2020 2020 2020  level = 1.      
+00005b00: 2020 2020 2020 656c 6966 2063 6c61 7373        elif class
+00005b10: 5f76 616c 7565 2e73 7461 7274 7377 6974  _value.startswit
+00005b20: 6828 2273 7562 7375 6273 6563 7469 6f6e  h("subsubsection
+00005b30: 5f74 6974 6c65 2229 3a0a 2020 2020 2020  _title"):.      
+00005b40: 2020 2020 2020 2020 2020 6c65 7665 6c20            level 
+00005b50: 3d20 320a 2020 2020 2020 2020 2020 2020  = 2.            
+00005b60: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00005b70: 2020 2020 2020 636f 6e74 696e 7565 2020        continue  
+00005b80: 2320 536b 6970 203c 6469 763e 2065 6c65  # Skip <div> ele
+00005b90: 6d65 6e74 7320 7769 7468 6f75 7420 7469  ments without ti
+00005ba0: 746c 6520 636c 6173 7365 730a 0a20 2020  tle classes..   
+00005bb0: 2020 2020 2020 2020 2023 2043 7265 6174           # Creat
+00005bc0: 6520 6120 6e65 7720 3c64 6976 3e20 656c  e a new <div> el
+00005bd0: 656d 656e 7420 616e 6420 7365 7420 6974  ement and set it
+00005be0: 7320 636c 6173 7320 6174 7472 6962 7574  s class attribut
+00005bf0: 650a 2020 2020 2020 2020 2020 2020 6e65  e.            ne
+00005c00: 775f 6469 7620 3d20 6574 7265 652e 5375  w_div = etree.Su
+00005c10: 6245 6c65 6d65 6e74 2863 7572 7265 6e74  bElement(current
+00005c20: 5f70 6172 656e 742c 2022 6469 7622 290a  _parent, "div").
+00005c30: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+00005c40: 6469 762e 6174 7472 6962 5b22 636c 6173  div.attrib["clas
+00005c50: 7322 5d20 3d20 2273 6563 7469 6f6e 2220  s"] = "section" 
+00005c60: 2a20 286c 6576 656c 202b 2031 2920 2023  * (level + 1)  #
+00005c70: 2041 6464 2061 7070 726f 7072 6961 7465   Add appropriate
+00005c80: 2063 6c61 7373 2062 6173 6564 206f 6e20   class based on 
+00005c90: 6c65 7665 6c0a 0a20 2020 2020 2020 2020  level..         
+00005ca0: 2020 2023 2041 6464 2074 6865 2063 7572     # Add the cur
+00005cb0: 7265 6e74 203c 6469 763e 2074 6f20 7468  rent <div> to th
+00005cc0: 6520 6e65 7720 3c64 6976 3e20 656c 656d  e new <div> elem
+00005cd0: 656e 740a 2020 2020 2020 2020 2020 2020  ent.            
+00005ce0: 6e65 775f 6469 762e 6170 7065 6e64 2864  new_div.append(d
+00005cf0: 6976 290a 0a20 2020 2020 2020 2020 2020  iv)..           
+00005d00: 2023 2055 7064 6174 6520 7468 6520 6375   # Update the cu
+00005d10: 7272 656e 7420 7061 7265 6e74 2061 6e64  rrent parent and
+00005d20: 206c 6576 656c 0a20 2020 2020 2020 2020   level.         
+00005d30: 2020 2063 7572 7265 6e74 5f70 6172 656e     current_paren
+00005d40: 7420 3d20 6e65 775f 6469 760a 2020 2020  t = new_div.    
+00005d50: 2020 2020 2020 2020 6375 7272 656e 745f          current_
+00005d60: 6c65 7665 6c20 3d20 6c65 7665 6c0a 2020  level = level.  
+00005d70: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00005d80: 2020 2020 2020 2020 2320 4164 6420 6e6f          # Add no
+00005d90: 6e2d 7469 746c 6520 3c64 6976 3e20 656c  n-title <div> el
+00005da0: 656d 656e 7473 2074 6f20 7468 6520 6375  ements to the cu
+00005db0: 7272 656e 7420 7061 7265 6e74 0a20 2020  rrent parent.   
+00005dc0: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+00005dd0: 5f70 6172 656e 742e 6170 7065 6e64 2864  _parent.append(d
+00005de0: 6976 290a 0a20 2020 2023 2052 6574 7572  iv)..    # Retur
+00005df0: 6e20 7468 6520 6d6f 6469 6669 6564 2048  n the modified H
+00005e00: 544d 4c20 6173 2061 2073 7472 696e 670a  TML as a string.
+00005e10: 2020 2020 7265 7475 726e 2065 7472 6565      return etree
+00005e20: 2e74 6f73 7472 696e 6728 7472 6565 2c20  .tostring(tree, 
+00005e30: 656e 636f 6469 6e67 3d22 756e 6963 6f64  encoding="unicod
+00005e40: 6522 290a 0a23 2045 7861 6d70 6c65 2075  e")..# Example u
+00005e50: 7361 6765 0a68 746d 6c20 3d20 2727 270a  sage.html = '''.
+00005e60: 3c68 746d 6c3e 0a20 203c 6865 6164 3e2e  <html>.  <head>.
+00005e70: 2e2e 3c2f 6865 6164 3e0a 2020 3c62 6f64  ..</head>.  <bod
+00005e80: 793e 0a20 2020 203c 6469 7620 636c 6173  y>.    <div clas
+00005e90: 733d 2273 6563 7469 6f6e 5f74 6974 6c65  s="section_title
+00005ea0: 223e 5365 6374 696f 6e20 313c 2f64 6976  ">Section 1</div
+00005eb0: 3e0a 2020 2020 3c64 6976 3e73 7475 6666  >.    <div>stuff
+00005ec0: 2061 3c2f 6469 763e 0a20 2020 203c 6469   a</div>.    <di
+00005ed0: 7620 636c 6173 733d 2273 7562 7365 6374  v class="subsect
+00005ee0: 696f 6e5f 7469 746c 6522 3e53 6563 7469  ion_title">Secti
+00005ef0: 6f6e 2031 2e31 3c2f 6469 763e 0a20 2020  on 1.1</div>.   
+00005f00: 203c 6469 763e 7374 7566 6620 623c 2f64   <div>stuff b</d
+00005f10: 6976 3e0a 2020 2020 3c64 6976 3e73 7475  iv>.    <div>stu
+00005f20: 6666 2062 783c 2f64 6976 3e0a 2020 2020  ff bx</div>.    
+00005f30: 3c64 6976 2063 6c61 7373 3d22 7375 6273  <div class="subs
+00005f40: 7562 7365 6374 696f 6e5f 7469 746c 6522  ubsection_title"
+00005f50: 3e53 6563 7469 6f6e 2031 2e31 2e31 3c2f  >Section 1.1.1</
+00005f60: 6469 763e 0a20 2020 203c 6469 763e 7374  div>.    <div>st
+00005f70: 7566 6620 7a3c 2f64 6976 3e0a 2020 2020  uff z</div>.    
+00005f80: 3c64 6976 3e73 7475 6666 207a 7a3c 2f64  <div>stuff zz</d
+00005f90: 6976 3e0a 2020 2020 3c64 6976 2063 6c61  iv>.    <div cla
+00005fa0: 7373 3d22 7375 6273 7562 7365 6374 696f  ss="subsubsectio
+00005fb0: 6e5f 7469 746c 6522 3e53 6563 7469 6f6e  n_title">Section
+00005fc0: 2031 2e31 2e32 3c2f 6469 763e 0a20 2020   1.1.2</div>.   
+00005fd0: 203c 6469 763e 7374 7566 6620 783c 2f64   <div>stuff x</d
+00005fe0: 6976 3e0a 2020 2020 3c64 6976 3e73 7475  iv>.    <div>stu
+00005ff0: 6666 2078 783c 2f64 6976 3e0a 2020 2020  ff xx</div>.    
+00006000: 3c64 6976 3e73 7475 6666 2078 7878 3c2f  <div>stuff xxx</
+00006010: 6469 763e 0a20 2020 203c 6469 7620 636c  div>.    <div cl
+00006020: 6173 733d 2273 7562 7365 6374 696f 6e5f  ass="subsection_
+00006030: 7469 746c 6522 3e53 6563 7469 6f6e 2031  title">Section 1
+00006040: 2e32 3c2f 6469 763e 0a20 203c 2f62 6f64  .2</div>.  </bod
+00006050: 793e 0a3c 2f68 746d 6c3e 0a27 2727 0a0a  y>.</html>.'''..
+00006060: 6f75 7470 7574 5f68 746d 6c20 3d20 6772  output_html = gr
+00006070: 6f75 705f 6469 7673 5f69 6e74 6f5f 7472  oup_divs_into_tr
+00006080: 6565 2868 746d 6c29 0a70 7269 6e74 286f  ee(html).print(o
+00006090: 7574 7075 745f 6874 6d6c 290a 5468 6520  utput_html).The 
+000060a0: 636f 6465 2077 696c 6c20 7061 7273 6520  code will parse 
+000060b0: 7468 6520 4854 4d4c 2c20 6964 656e 7469  the HTML, identi
+000060c0: 6679 2074 6865 2074 6974 6c65 203c 6469  fy the title <di
+000060d0: 763e 2065 6c65 6d65 6e74 7320 6261 7365  v> elements base
+000060e0: 6420 6f6e 2074 6865 6972 2063 6c61 7373  d on their class
+000060f0: 2061 7474 7269 6275 7465 732c 2063 7265   attributes, cre
+00006100: 6174 6520 6120 6e65 7720 6869 6572 6172  ate a new hierar
+00006110: 6368 7920 6f66 203c 6469 763e 2065 6c65  chy of <div> ele
+00006120: 6d65 6e74 732c 2061 6e64 2061 6464 2074  ments, and add t
+00006130: 6865 2074 6974 6c65 203c 6469 763e 7320  he title <div>s 
+00006140: 616e 6420 7468 6569 7220 666f 6c6c 6f77  and their follow
+00006150: 696e 6720 6e6f 6e2d 7469 746c 6520 3c64  ing non-title <d
+00006160: 6976 3e73 2074 6f20 7468 6520 6170 7072  iv>s to the appr
+00006170: 6f70 7269 6174 6520 706f 7369 7469 6f6e  opriate position
+00006180: 2069 6e20 7468 6520 6869 6572 6172 6368   in the hierarch
+00006190: 792e 2046 696e 616c 6c79 2c20 6974 2077  y. Finally, it w
+000061a0: 696c 6c20 7265 7475 726e 2074 6865 206d  ill return the m
+000061b0: 6f64 6966 6965 6420 4854 4d4c 2061 7320  odified HTML as 
+000061c0: 6120 7374 7269 6e67 2e0a 0a50 6c65 6173  a string...Pleas
+000061d0: 6520 6e6f 7465 2074 6861 7420 7468 6520  e note that the 
+000061e0: 636f 6465 2061 7373 756d 6573 2074 6861  code assumes tha
+000061f0: 7420 7468 6520 636c 6173 7320 7661 6c75  t the class valu
+00006200: 6573 2066 6f72 2074 6865 2074 6974 6c65  es for the title
+00006210: 203c 6469 763e 2065 6c65 6d65 6e74 7320   <div> elements 
+00006220: 666f 6c6c 6f77 2074 6865 2070 6174 7465  follow the patte
+00006230: 726e 2022 7365 6374 696f 6e5f 7469 746c  rn "section_titl
+00006240: 6522 2c20 2273 7562 7365 6374 696f 6e5f  e", "subsection_
+00006250: 7469 746c 6522 2c20 2273 7562 7375 6273  title", "subsubs
+00006260: 6563 7469 6f6e 5f74 6974 6c65 222c 2061  ection_title", a
+00006270: 6e64 2073 6f20 6f6e 2e20 4966 2079 6f75  nd so on. If you
+00006280: 7220 6163 7475 616c 2063 6c61 7373 206e  r actual class n
+00006290: 616d 6573 2064 6966 6665 722c 2079 6f75  ames differ, you
+000062a0: 206d 6179 206e 6565 6420 746f 206d 6f64   may need to mod
+000062b0: 6966 7920 7468 6520 636f 6465 2061 6363  ify the code acc
+000062c0: 6f72 6469 6e67 6c79 2e0a 0a0a 0a0a 0a52  ordingly.......R
+000062d0: 6567 656e 6572 6174 6520 7265 7370 6f6e  egenerate respon
+000062e0: 7365 0a53 656e 6420 6120 6d65 7373 6167  se.Send a messag
+000062f0: 652e 0a0a 4672 6565 2052 6573 6561 7263  e...Free Researc
+00006300: 6820 5072 6576 6965 772e 2043 6861 7447  h Preview. ChatG
+00006310: 5054 206d 6179 2070 726f 6475 6365 2069  PT may produce i
+00006320: 6e61 6363 7572 6174 6520 696e 666f 726d  naccurate inform
+00006330: 6174 696f 6e20 6162 6f75 7420 7065 6f70  ation about peop
+00006340: 6c65 2c20 706c 6163 6573 2c20 6f72 2066  le, places, or f
+00006350: 6163 7473 2e20 4368 6174 4750 5420 4d61  acts. ChatGPT Ma
+00006360: 7920 3132 2056 6572 7369 6f6e 2222 220a  y 12 Version""".
+00006370: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+00006380: 0a20 2020 2064 6566 2067 726f 7570 5f64  .    def group_d
+00006390: 6976 735f 696e 746f 5f74 7265 6528 636c  ivs_into_tree(cl
+000063a0: 732c 2062 6f64 7929 3a0a 2020 2020 2020  s, body):.      
+000063b0: 2020 2222 2250 6574 6572 204d 7572 7261    """Peter Murra
+000063c0: 792d 5275 7374 2222 220a 2020 2020 2020  y-Rust""".      
+000063d0: 2020 454e 4420 3d20 225b 454e 4422 0a20    END = "[END". 
+000063e0: 2020 2020 2020 2053 5441 5254 203d 2022         START = "
+000063f0: 5b53 5441 5254 220a 2020 2020 2020 2020  [START".        
+00006400: 464c 4f41 5420 3d20 2266 6c6f 6174 220a  FLOAT = "float".
+00006410: 0a20 2020 2020 2020 2073 6b69 705f 7265  .        skip_re
+00006420: 7320 3d20 5b0a 2020 2020 2020 2020 2020  s = [.          
+00006430: 2020 7265 2e63 6f6d 7069 6c65 2822 4164    re.compile("Ad
+00006440: 6f70 7465 642e 2a22 292c 0a20 2020 2020  opted.*"),.     
+00006450: 2020 2020 2020 2072 652e 636f 6d70 696c         re.compil
+00006460: 6528 2253 7562 6a65 6374 2074 6f20 436f  e("Subject to Co
+00006470: 7079 2229 0a20 2020 2020 2020 205d 0a0a  py").        ]..
+00006480: 0a20 2020 2020 2020 2064 6976 5f73 7479  .        div_sty
+00006490: 6c65 7320 3d20 5b22 626f 7264 6572 3a20  les = ["border: 
+000064a0: 2338 3838 3866 6620 736f 6c69 6420 3370  #8888ff solid 3p
+000064b0: 783b 222c 0a20 2020 2020 2020 2020 2020  x;",.           
+000064c0: 2020 2020 2020 2020 2020 2022 626f 7264             "bord
+000064d0: 6572 3a20 6379 616e 2064 6173 6865 6420  er: cyan dashed 
+000064e0: 322e 3570 783b 222c 0a20 2020 2020 2020  2.5px;",.       
+000064f0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00006500: 626f 7264 6572 3a20 6772 6565 6e20 6461  border: green da
+00006510: 7368 6564 2032 7078 3b22 2c0a 2020 2020  shed 2px;",.    
+00006520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006530: 2020 5d0a 0a20 2020 2020 2020 2023 2046    ]..        # F
+00006540: 696e 6420 616c 6c20 3c64 6976 3e20 656c  ind all <div> el
+00006550: 656d 656e 7473 2077 6974 6869 6e20 7468  ements within th
+00006560: 6520 3c62 6f64 793e 2074 6167 0a20 2020  e <body> tag.   
+00006570: 2020 2020 2064 6976 5f65 6c65 6d65 6e74       div_element
+00006580: 7320 3d20 626f 6479 2e78 7061 7468 2822  s = body.xpath("
+00006590: 2e2f 6469 7622 290a 0a20 2020 2020 2020  ./div")..       
+000065a0: 2023 2043 7265 6174 6520 6120 6e65 7720   # Create a new 
+000065b0: 726f 6f74 203c 6469 763e 2065 6c65 6d65  root <div> eleme
+000065c0: 6e74 2074 6f20 686f 6c64 2074 6865 2074  nt to hold the t
+000065d0: 7265 6520 7374 7275 6374 7572 650a 2020  ree structure.  
+000065e0: 2020 2020 2020 726f 6f74 5f64 6976 203d        root_div =
+000065f0: 2045 542e 456c 656d 656e 7428 2264 6976   ET.Element("div
+00006600: 2229 0a20 2020 2020 2020 2072 6f6f 745f  ").        root_
+00006610: 6469 762e 6174 7472 6962 5b22 636c 6173  div.attrib["clas
+00006620: 7322 5d20 3d20 2272 6f6f 7422 0a20 2020  s"] = "root".   
+00006630: 2020 2020 2072 6f6f 745f 6469 762e 6174       root_div.at
+00006640: 7472 6962 5b22 7469 746c 6522 5d20 3d20  trib["title"] = 
+00006650: 2272 6f6f 7422 0a0a 2020 2020 2020 2020  "root"..        
+00006660: 2320 496e 6974 6961 6c69 7a65 2076 6172  # Initialize var
+00006670: 6961 626c 6573 2074 6f20 6b65 6570 2074  iables to keep t
+00006680: 7261 636b 206f 6620 7468 6520 6375 7272  rack of the curr
+00006690: 656e 7420 7061 7265 6e74 203c 6469 763e  ent parent <div>
+000066a0: 2061 6e64 2069 7473 206c 6576 656c 0a20   and its level. 
+000066b0: 2020 2020 2020 2063 7572 7265 6e74 5f70         current_p
+000066c0: 6172 656e 7420 3d20 726f 6f74 5f64 6976  arent = root_div
+000066d0: 0a20 2020 2020 2020 2063 7572 7265 6e74  .        current
+000066e0: 5f6c 6576 656c 203d 2030 0a0a 2020 2020  _level = 0..    
+000066f0: 2020 2020 7061 7265 6e74 7320 3d20 5b72      parents = [r
+00006700: 6f6f 745f 6469 762c 204e 6f6e 652c 204e  oot_div, None, N
+00006710: 6f6e 652c 204e 6f6e 655d 0a20 2020 2020  one, None].     
+00006720: 2020 2073 7461 7274 5f65 6e64 7320 3d20     start_ends = 
+00006730: 5b5d 0a20 2020 2020 2020 2070 6172 656e  [].        paren
+00006740: 7420 3d20 726f 6f74 5f64 6976 0a20 2020  t = root_div.   
+00006750: 2020 2020 2066 6f72 2064 6976 2069 6e20       for div in 
+00006760: 6469 765f 656c 656d 656e 7473 3a0a 2020  div_elements:.  
+00006770: 2020 2020 2020 2020 2020 2320 4368 6563            # Chec
+00006780: 6b20 6966 2074 6865 2063 7572 7265 6e74  k if the current
+00006790: 203c 6469 763e 2068 6173 2061 2063 6c61   <div> has a cla
+000067a0: 7373 2061 7474 7269 6275 7465 0a20 2020  ss attribute.   
+000067b0: 2020 2020 2020 2020 2074 6578 7420 3d20           text = 
+000067c0: 2727 2e6a 6f69 6e28 6469 762e 6974 6572  ''.join(div.iter
+000067d0: 7465 7874 2829 290a 2020 2020 2020 2020  text()).        
+000067e0: 2020 2020 6966 2022 636c 6173 7322 2069      if "class" i
+000067f0: 6e20 6469 762e 6174 7472 6962 3a0a 2020  n div.attrib:.  
+00006800: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00006810: 7265 6e74 203d 2063 6c73 2e70 726f 6365  rent = cls.proce
+00006820: 7373 5f63 6c61 7373 5f64 6976 2864 6976  ss_class_div(div
+00006830: 2c20 6469 765f 7374 796c 6573 2c20 7061  , div_styles, pa
+00006840: 7265 6e74 2c20 7061 7265 6e74 732c 2074  rent, parents, t
+00006850: 6578 7429 0a0a 2020 2020 2020 2020 2020  ext)..          
+00006860: 2020 656c 6966 2074 6578 742e 7374 6172    elif text.star
+00006870: 7473 7769 7468 2853 5441 5254 293a 0a20  tswith(START):. 
+00006880: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00006890: 6172 656e 7420 3d20 636c 732e 7072 6f63  arent = cls.proc
+000068a0: 6573 735f 6970 6363 5f73 7461 7274 2846  ess_ipcc_start(F
+000068b0: 4c4f 4154 2c20 5354 4152 542c 2070 6172  LOAT, START, par
+000068c0: 656e 742c 2073 7461 7274 5f65 6e64 732c  ent, start_ends,
+000068d0: 2074 6578 7429 0a0a 2020 2020 2020 2020   text)..        
+000068e0: 2020 2020 656c 6966 2074 6578 742e 7374      elif text.st
+000068f0: 6172 7473 7769 7468 2845 4e44 293a 0a20  artswith(END):. 
+00006900: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00006910: 6172 656e 7420 3d20 636c 732e 7072 6f63  arent = cls.proc
+00006920: 6573 735f 6970 6363 5f65 6e64 2845 4e44  ess_ipcc_end(END
+00006930: 2c20 5354 4152 542c 2070 6172 656e 742c  , START, parent,
+00006940: 2073 7461 7274 5f65 6e64 732c 2074 6578   start_ends, tex
+00006950: 7429 0a0a 2020 2020 2020 2020 2020 2020  t)..            
+00006960: 656c 6966 2063 6c73 2e73 6b69 705f 636f  elif cls.skip_co
+00006970: 6e74 656e 7428 7465 7874 2c20 736b 6970  ntent(text, skip
+00006980: 5f72 6573 293a 0a20 2020 2020 2020 2020  _res):.         
+00006990: 2020 2020 2020 2070 7269 6e74 2866 2273         print(f"s
+000069a0: 6b69 7070 6564 207b 7465 7874 5b3a 3530  kipped {text[:50
+000069b0: 5d7d 2229 0a0a 2020 2020 2020 2020 2020  ]}")..          
+000069c0: 2020 2320 656c 6966 2063 6c73 2e69 735f    # elif cls.is_
+000069d0: 666f 6f74 6e6f 7465 2873 7061 6e29 3a0a  footnote(span):.
+000069e0: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+000069f0: 2020 7072 696e 7428 6622 736b 6970 7065    print(f"skippe
+00006a00: 6420 7b74 6578 745b 3a35 305d 7d22 290a  d {text[:50]}").
+00006a10: 2020 2020 2020 2020 2020 2020 230a 2020              #.  
+00006a20: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00006a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006a40: 7061 7265 6e74 2e61 7070 656e 6428 6469  parent.append(di
+00006a50: 7629 0a0a 2020 2020 2020 2020 7265 7475  v)..        retu
+00006a60: 726e 2072 6f6f 745f 6469 760a 0a20 2020  rn root_div..   
+00006a70: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+00006a80: 2020 6465 6620 7072 6f63 6573 735f 6970    def process_ip
+00006a90: 6363 5f65 6e64 2863 6c73 2c20 454e 442c  cc_end(cls, END,
+00006aa0: 2053 5441 5254 2c20 7061 7265 6e74 2c20   START, parent, 
+00006ab0: 7374 6172 745f 656e 6473 2c20 7465 7874  start_ends, text
+00006ac0: 293a 0a20 2020 2020 2020 2065 6e64 5f73  ):.        end_s
+00006ad0: 7472 203d 2074 6578 745b 6c65 6e28 454e  tr = text[len(EN
+00006ae0: 4429 3a5d 0a20 2020 2020 2020 2069 6620  D):].        if 
+00006af0: 7374 6172 745f 656e 6473 3a0a 2020 2020  start_ends:.    
+00006b00: 2020 2020 2020 2020 2320 736f 6d65 7469          # someti
+00006b10: 6d65 7320 756e 6261 6c61 6e63 6564 2069  mes unbalanced i
+00006b20: 6e20 646f 6375 6d65 6e74 0a20 2020 2020  n document.     
+00006b30: 2020 2020 2020 2073 7461 7274 5f73 7472         start_str
+00006b40: 203d 2073 7461 7274 5f65 6e64 732e 706f   = start_ends.po
+00006b50: 7028 290a 2020 2020 2020 2020 2020 2020  p().            
+00006b60: 6966 2073 7461 7274 5f73 7472 2021 3d20  if start_str != 
+00006b70: 656e 645f 7374 723a 0a20 2020 2020 2020  end_str:.       
+00006b80: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
+00006b90: 7761 726e 696e 6728 6622 756e 6261 6c61  warning(f"unbala
+00006ba0: 6e63 6564 3a20 7b53 5441 5254 202b 2073  nced: {START + s
+00006bb0: 7461 7274 5f73 7472 7d20 616e 6420 7b45  tart_str} and {E
+00006bc0: 4e44 202b 2065 6e64 5f73 7472 7d22 290a  ND + end_str}").
+00006bd0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00006be0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00006bf0: 2020 7061 7265 6e74 203d 2070 6172 656e    parent = paren
+00006c00: 742e 6765 7470 6172 656e 7428 290a 2020  t.getparent().  
+00006c10: 2020 2020 2020 7265 7475 726e 2070 6172        return par
+00006c20: 656e 740a 0a20 2020 2040 636c 6173 736d  ent..    @classm
+00006c30: 6574 686f 640a 2020 2020 6465 6620 7072  ethod.    def pr
+00006c40: 6f63 6573 735f 6970 6363 5f73 7461 7274  ocess_ipcc_start
+00006c50: 2863 6c73 2c20 464c 4f41 542c 2053 5441  (cls, FLOAT, STA
+00006c60: 5254 2c20 7061 7265 6e74 2c20 7374 6172  RT, parent, star
+00006c70: 745f 656e 6473 2c20 7465 7874 293a 0a20  t_ends, text):. 
+00006c80: 2020 2020 2020 2073 7461 7274 5f73 7472         start_str
+00006c90: 203d 2074 6578 745b 6c65 6e28 5354 4152   = text[len(STAR
+00006ca0: 5429 3a5d 0a20 2020 2020 2020 2073 7461  T):].        sta
+00006cb0: 7274 5f65 6e64 732e 6170 7065 6e64 2873  rt_ends.append(s
+00006cc0: 7461 7274 5f73 7472 290a 2020 2020 2020  tart_str).      
+00006cd0: 2020 7375 625f 6469 7620 3d20 4554 2e53    sub_div = ET.S
+00006ce0: 7562 456c 656d 656e 7428 7061 7265 6e74  ubElement(parent
+00006cf0: 2c20 2264 6976 2229 0a20 2020 2020 2020  , "div").       
+00006d00: 2073 7562 5f64 6976 2e61 7474 7269 625b   sub_div.attrib[
+00006d10: 2263 6c61 7373 225d 203d 2046 4c4f 4154  "class"] = FLOAT
+00006d20: 0a20 2020 2020 2020 2073 7562 5f64 6976  .        sub_div
+00006d30: 2e61 7474 7269 625b 2274 6974 6c65 225d  .attrib["title"]
+00006d40: 203d 2074 6578 740a 2020 2020 2020 2020   = text.        
+00006d50: 7375 625f 6469 762e 6174 7472 6962 5b22  sub_div.attrib["
+00006d60: 7374 796c 6522 5d20 3d20 2262 6f72 6465  style"] = "borde
+00006d70: 723a 2064 6173 6865 6420 626c 7565 2033  r: dashed blue 3
+00006d80: 7078 3b22 0a20 2020 2020 2020 2070 6172  px;".        par
+00006d90: 656e 7420 3d20 7375 625f 6469 760a 2020  ent = sub_div.  
+00006da0: 2020 2020 2020 7265 7475 726e 2070 6172        return par
+00006db0: 656e 740a 0a20 2020 2040 636c 6173 736d  ent..    @classm
+00006dc0: 6574 686f 640a 2020 2020 6465 6620 7072  ethod.    def pr
+00006dd0: 6f63 6573 735f 636c 6173 735f 6469 7628  ocess_class_div(
+00006de0: 636c 732c 2064 6976 2c20 6469 765f 7374  cls, div, div_st
+00006df0: 796c 6573 2c20 7061 7265 6e74 2c20 7061  yles, parent, pa
+00006e00: 7265 6e74 732c 2074 6578 7429 3a0a 2020  rents, text):.  
+00006e10: 2020 2020 2020 636c 6173 735f 7661 6c75        class_valu
+00006e20: 6520 3d20 6469 762e 6174 7472 6962 5b22  e = div.attrib["
+00006e30: 636c 6173 7322 5d0a 2020 2020 2020 2020  class"].        
+00006e40: 2320 4465 7465 726d 696e 6520 7468 6520  # Determine the 
+00006e50: 6c65 7665 6c20 6261 7365 6420 6f6e 2074  level based on t
+00006e60: 6865 2063 6c61 7373 2061 7474 7269 6275  he class attribu
+00006e70: 7465 0a20 2020 2020 2020 2069 6620 636c  te.        if cl
+00006e80: 6173 735f 7661 6c75 652e 7374 6172 7473  ass_value.starts
+00006e90: 7769 7468 2822 7365 6374 696f 6e22 293a  with("section"):
+00006ea0: 0a20 2020 2020 2020 2020 2020 206c 6576  .            lev
+00006eb0: 656c 203d 2031 0a20 2020 2020 2020 2065  el = 1.        e
+00006ec0: 6c69 6620 636c 6173 735f 7661 6c75 652e  lif class_value.
+00006ed0: 7374 6172 7473 7769 7468 2822 7375 625f  startswith("sub_
+00006ee0: 7365 6374 696f 6e22 293a 0a20 2020 2020  section"):.     
+00006ef0: 2020 2020 2020 206c 6576 656c 203d 2032         level = 2
+00006f00: 0a20 2020 2020 2020 2065 6c69 6620 636c  .        elif cl
+00006f10: 6173 735f 7661 6c75 652e 7374 6172 7473  ass_value.starts
+00006f20: 7769 7468 2822 7375 625f 7375 625f 7365  with("sub_sub_se
+00006f30: 6374 696f 6e22 293a 0a20 2020 2020 2020  ction"):.       
+00006f40: 2020 2020 206c 6576 656c 203d 2033 0a20       level = 3. 
+00006f50: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00006f60: 2020 2020 2020 2020 206c 6576 656c 203d           level =
+00006f70: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
+00006f80: 2020 2320 636f 6e74 696e 7565 2020 2320    # continue  # 
+00006f90: 536b 6970 203c 6469 763e 2065 6c65 6d65  Skip <div> eleme
+00006fa0: 6e74 7320 7769 7468 6f75 7420 7469 746c  nts without titl
+00006fb0: 6520 636c 6173 7365 730a 2020 2020 2020  e classes.      
+00006fc0: 2020 6966 206c 6576 656c 3a0a 2020 2020    if level:.    
+00006fd0: 2020 2020 2020 2020 7374 6163 6b5f 7061          stack_pa
+00006fe0: 7265 6e74 203d 2070 6172 656e 7473 5b6c  rent = parents[l
+00006ff0: 6576 656c 202d 2031 5d0a 2020 2020 2020  evel - 1].      
+00007000: 2020 2020 2020 6966 2073 7461 636b 5f70        if stack_p
+00007010: 6172 656e 7420 6973 206e 6f74 204e 6f6e  arent is not Non
+00007020: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00007030: 2020 206e 6577 5f64 6976 203d 2045 542e     new_div = ET.
+00007040: 5375 6245 6c65 6d65 6e74 2873 7461 636b  SubElement(stack
+00007050: 5f70 6172 656e 742c 2022 6469 7622 290a  _parent, "div").
+00007060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007070: 6e65 775f 6469 762e 6174 7472 6962 5b22  new_div.attrib["
+00007080: 7469 746c 6522 5d20 3d20 7465 7874 5b3a  title"] = text[:
+00007090: 3530 5d0a 2020 2020 2020 2020 2020 2020  50].            
+000070a0: 2020 2020 6e65 775f 6469 762e 6174 7472      new_div.attr
+000070b0: 6962 5b22 7374 796c 6522 5d20 3d20 6469  ib["style"] = di
+000070c0: 765f 7374 796c 6573 5b6c 6576 656c 202d  v_styles[level -
+000070d0: 2031 5d0a 0a20 2020 2020 2020 2020 2020   1]..           
+000070e0: 2020 2020 2070 6172 656e 7420 3d20 6e65       parent = ne
+000070f0: 775f 6469 760a 2020 2020 2020 2020 2020  w_div.          
+00007100: 2020 2020 2020 7061 7265 6e74 735b 6c65        parents[le
+00007110: 7665 6c5d 203d 206e 6577 5f64 6976 0a20  vel] = new_div. 
+00007120: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00007130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007140: 206c 6f67 6765 722e 696e 666f 2866 226e   logger.info(f"n
+00007150: 6f20 7061 7265 6e74 206f 6e20 7374 6163  o parent on stac
+00007160: 6b20 6c65 7665 6c20 7b6c 6576 656c 7d22  k level {level}"
+00007170: 290a 0a0a 0a20 2020 2020 2020 2070 6172  )....        par
+00007180: 656e 742e 6170 7065 6e64 2864 6976 290a  ent.append(div).
+00007190: 2020 2020 2020 2020 7265 7475 726e 2070          return p
+000071a0: 6172 656e 740a 0a20 2020 2040 636c 6173  arent..    @clas
+000071b0: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+000071c0: 736b 6970 5f63 6f6e 7465 6e74 2863 6c73  skip_content(cls
+000071d0: 2c20 7465 7874 2c20 736b 6970 5f72 6573  , text, skip_res
+000071e0: 293a 0a20 2020 2020 2020 2066 6f72 2073  ):.        for s
+000071f0: 6b69 705f 7265 2069 6e20 736b 6970 5f72  kip_re in skip_r
+00007200: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00007210: 6966 2073 6b69 705f 7265 2e6d 6174 6368  if skip_re.match
+00007220: 2874 6578 7429 3a0a 2020 2020 2020 2020  (text):.        
+00007230: 2020 2020 2020 2020 7265 7475 726e 2054          return T
+00007240: 7275 650a 2020 2020 2020 2020 7265 7475  rue.        retu
+00007250: 726e 2046 616c 7365 0a0a 2020 2020 6465  rn False..    de
+00007260: 6620 6d61 7463 685f 7265 6765 7828 6469  f match_regex(di
+00007270: 762c 2072 6567 6578 2c20 7365 6374 696f  v, regex, sectio
+00007280: 6e5f 636c 6173 732c 2074 6578 7429 3a0a  n_class, text):.
+00007290: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+000072a0: 2020 2020 2020 2020 2072 6567 203d 2072           reg = r
+000072b0: 652e 636f 6d70 696c 6528 7265 6765 7829  e.compile(regex)
+000072c0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+000072d0: 4578 6365 7074 696f 6e20 6173 2065 3a0a  Exception as e:.
+000072e0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000072f0: 6520 5661 6c75 6545 7272 6f72 2866 2242  e ValueError(f"B
+00007300: 4144 2052 4547 4558 207b 7265 6765 787d  AD REGEX {regex}
+00007310: 2062 6563 6175 7365 207b 657d 2229 0a20   because {e}"). 
+00007320: 2020 2020 2020 206d 6174 6368 203d 2072         match = r
+00007330: 6567 2e6d 6174 6368 2874 6578 7429 0a20  eg.match(text). 
+00007340: 2020 2020 2020 2069 6620 6d61 7463 683a         if match:
+00007350: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
+00007360: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00007370: 2020 6964 203d 206d 6174 6368 2e67 726f    id = match.gro
+00007380: 7570 2827 6964 2729 0a20 2020 2020 2020  up('id').       
+00007390: 2020 2020 2020 2020 2064 6976 2e61 7474           div.att
+000073a0: 7269 625b 2274 6974 6c65 225d 203d 2069  rib["title"] = i
+000073b0: 640a 2020 2020 2020 2020 2020 2020 6578  d.            ex
+000073c0: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
+000073d0: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+000073e0: 2020 2020 2070 7269 6e74 2866 2266 6169       print(f"fai
+000073f0: 6c65 6420 746f 206d 6174 6368 2069 6420  led to match id 
+00007400: 696e 207b 7265 6765 787d 2229 0a20 2020  in {regex}").   
+00007410: 2020 2020 2020 2020 2064 6976 2e61 7474           div.att
+00007420: 7269 625b 2263 6c61 7373 225d 203d 2073  rib["class"] = s
+00007430: 6563 7469 6f6e 5f63 6c61 7373 0a0a 0a20  ection_class... 
+00007440: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+00007450: 2020 2020 6465 6620 616e 6e6f 7461 7465      def annotate
+00007460: 5f74 6974 6c65 5f73 6563 7469 6f6e 7328  _title_sections(
+00007470: 636c 732c 2068 746d 6c5f 656c 656d 2c20  cls, html_elem, 
+00007480: 7365 6374 696f 6e5f 7265 6765 7865 733d  section_regexes=
+00007490: 4e6f 6e65 293a 0a20 2020 2020 2020 2069  None):.        i
+000074a0: 6620 7365 6374 696f 6e5f 7265 6765 7865  f section_regexe
+000074b0: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
+000074c0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+000074d0: 7565 4572 726f 7228 226d 7573 7420 6861  ueError("must ha
+000074e0: 7665 2073 6563 7469 6f6e 5f72 6567 6578  ve section_regex
+000074f0: 6573 2061 7267 756d 656e 7422 290a 2020  es argument").  
+00007500: 2020 2020 2020 2020 2020 2320 7468 6973            # this
+00007510: 206f 6e6c 7920 776f 726b 7320 666f 7220   only works for 
+00007520: 4950 4343 2064 7261 6674 0a20 2020 2020  IPCC draft.     
+00007530: 2020 2020 2020 2023 2073 6563 7469 6f6e         # section
+00007540: 5f72 6567 6578 6573 203d 205b 0a20 2020  _regexes = [.   
+00007550: 2020 2020 2020 2020 2023 2020 2020 2028           #     (
+00007560: 2273 6563 7469 6f6e 222c 2022 5365 6374  "section", "Sect
+00007570: 696f 6e5c 732a 283f 503c 6964 3e5c 6429  ion\s*(?P<id>\d)
+00007580: 3a5c 732b 2e2a 2229 2c0a 2020 2020 2020  :\s+.*"),.      
+00007590: 2020 2020 2020 2320 2020 2020 2822 7375        #     ("su
+000075a0: 625f 7365 6374 696f 6e22 2c20 2228 3f50  b_section", "(?P
+000075b0: 3c69 643e 5c64 2b5c 2e5c 642b 295c 732e  <id>\d+\.\d+)\s.
+000075c0: 2a22 292c 0a20 2020 2020 2020 2020 2020  *"),.           
+000075d0: 2023 2020 2020 2028 2273 7562 5f73 7562   #     ("sub_sub
+000075e0: 5f73 6563 7469 6f6e 222c 2022 283f 503c  _section", "(?P<
+000075f0: 6964 3e5c 642b 5c2e 5c64 2b5c 2e5c 642b  id>\d+\.\d+\.\d+
+00007600: 295c 732e 2a22 290a 2020 2020 2020 2020  )\s.*").        
+00007610: 2020 2020 2320 5d0a 0a20 2020 2020 2020      # ]..       
+00007620: 2062 6f64 7920 3d20 4874 6d6c 4c69 622e   body = HtmlLib.
+00007630: 6765 745f 626f 6479 2868 746d 6c5f 656c  get_body(html_el
+00007640: 656d 290a 2020 2020 2020 2020 666f 7220  em).        for 
+00007650: 6469 7620 696e 2062 6f64 792e 7870 6174  div in body.xpat
+00007660: 6828 222e 2f2f 6469 7622 293a 0a20 2020  h(".//div"):.   
+00007670: 2020 2020 2020 2020 2074 6578 7420 3d20           text = 
+00007680: 2727 2e6a 6f69 6e28 6469 762e 6974 6572  ''.join(div.iter
+00007690: 7465 7874 2829 290a 0a20 2020 2020 2020  text())..       
+000076a0: 2020 2020 2066 6f72 2073 6563 7469 6f6e       for section
+000076b0: 5f72 6567 6578 2069 6e20 7365 6374 696f  _regex in sectio
+000076c0: 6e5f 7265 6765 7865 733a 0a20 2020 2020  n_regexes:.     
+000076d0: 2020 2020 2020 2020 2020 2073 6563 7469             secti
+000076e0: 6f6e 5f63 6c61 7373 203d 2073 6563 7469  on_class = secti
+000076f0: 6f6e 5f72 6567 6578 5b30 5d0a 2020 2020  on_regex[0].    
+00007700: 2020 2020 2020 2020 2020 2020 7265 6765              rege
+00007710: 7820 3d20 4e6f 6e65 2069 6620 6e6f 7420  x = None if not 
+00007720: 7365 6374 696f 6e5f 7265 6765 7820 656c  section_regex el
+00007730: 7365 2073 6563 7469 6f6e 5f72 6567 6578  se section_regex
+00007740: 5b31 5d0a 2020 2020 2020 2020 2020 2020  [1].            
+00007750: 2020 2020 6966 206e 6f74 2072 6567 6578      if not regex
+00007760: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00007770: 2020 2020 2020 7072 696e 7428 6622 4e4f        print(f"NO
+00007780: 2052 4547 4558 3a20 7265 6765 7820 696e   REGEX: regex in
+00007790: 2073 6563 7469 6f6e 5f72 6567 6578 207b   section_regex {
+000077a0: 7365 6374 696f 6e5f 7265 6765 787d 2229  section_regex}")
+000077b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000077c0: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
+000077d0: 2020 2020 2020 2020 2020 2020 2020 636c                cl
+000077e0: 732e 6d61 7463 685f 7265 6765 7828 6469  s.match_regex(di
+000077f0: 762c 2072 6567 6578 2c20 7365 6374 696f  v, regex, sectio
+00007800: 6e5f 636c 6173 732c 2074 6578 7429 0a0a  n_class, text)..
+00007810: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+00007820: 0a20 2020 2064 6566 2063 6f6c 6c65 6374  .    def collect
+00007830: 5f66 6c6f 6174 735f 746f 5f62 6163 6b28  _floats_to_back(
+00007840: 636c 732c 2068 746d 6c5f 656c 656d 293a  cls, html_elem):
+00007850: 0a20 2020 2020 2020 2062 6163 6b20 3d20  .        back = 
+00007860: 4874 6d6c 4772 6f75 702e 6765 745f 6261  HtmlGroup.get_ba
+00007870: 636b 5f64 6976 2868 746d 6c5f 656c 656d  ck_div(html_elem
+00007880: 290a 2020 2020 2020 2020 666c 6f61 7473  ).        floats
+00007890: 203d 2068 746d 6c5f 656c 656d 2e78 7061   = html_elem.xpa
+000078a0: 7468 2822 2e2f 2f64 6976 5b40 636c 6173  th(".//div[@clas
+000078b0: 733d 2766 6c6f 6174 275d 2229 0a20 2020  s='float']").   
+000078c0: 2020 2020 206c 6f67 6765 722e 6465 6275       logger.debu
+000078d0: 6728 6622 666c 6f61 7473 207b 6c65 6e28  g(f"floats {len(
+000078e0: 666c 6f61 7473 297d 2229 0a20 2020 2020  floats)}").     
+000078f0: 2020 2066 6f72 2066 6c6f 6174 2069 6e20     for float in 
+00007900: 666c 6f61 7473 3a0a 2020 2020 2020 2020  floats:.        
+00007910: 2020 2020 6261 636b 2e61 7070 656e 6428      back.append(
+00007920: 666c 6f61 7429 0a0a 2020 2020 4063 6c61  float)..    @cla
+00007930: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+00007940: 2063 7265 6174 655f 6261 636b 5f64 6976   create_back_div
+00007950: 2863 6c73 2c20 6874 6d6c 5f65 6c65 6d29  (cls, html_elem)
+00007960: 3a0a 2020 2020 2020 2020 6261 636b 203d  :.        back =
+00007970: 2045 542e 5375 6245 6c65 6d65 6e74 2848   ET.SubElement(H
+00007980: 746d 6c4c 6962 2e67 6574 5f62 6f64 7928  tmlLib.get_body(
+00007990: 6874 6d6c 5f65 6c65 6d29 2c20 2264 6976  html_elem), "div
+000079a0: 2229 0a20 2020 2020 2020 2062 6163 6b2e  ").        back.
+000079b0: 6174 7472 6962 5b22 636c 6173 7322 5d20  attrib["class"] 
+000079c0: 3d20 2262 6163 6b22 0a20 2020 2020 2020  = "back".       
+000079d0: 2062 6163 6b2e 6174 7472 6962 5b22 7469   back.attrib["ti
+000079e0: 746c 6522 5d20 3d20 2262 6163 6b20 6d61  tle"] = "back ma
+000079f0: 7474 6572 220a 2020 2020 2020 2020 6261  tter".        ba
+00007a00: 636b 2e61 7474 7269 625b 2273 7479 6c65  ck.attrib["style
+00007a10: 225d 203d 2022 6261 636b 6772 6f75 6e64  "] = "background
+00007a20: 3a20 2366 6666 6664 643b 2062 6f72 6465  : #ffffdd; borde
+00007a30: 723a 2073 6f6c 6964 2070 7572 706c 6520  r: solid purple 
+00007a40: 312e 3570 783b 206d 6172 6769 6e3a 2032  1.5px; margin: 2
+00007a50: 7078 3b22 0a20 2020 2020 2020 2062 6163  px;".        bac
+00007a60: 6b5f 7469 746c 6520 3d20 4554 2e53 7562  k_title = ET.Sub
+00007a70: 456c 656d 656e 7428 6261 636b 2c20 2264  Element(back, "d
+00007a80: 6976 2229 0a20 2020 2020 2020 2062 6163  iv").        bac
+00007a90: 6b5f 7469 746c 652e 7465 7874 203d 2022  k_title.text = "
+00007aa0: 4261 636b 204d 6174 7465 722c 2046 6f6f  Back Matter, Foo
+00007ab0: 746e 6f74 6573 2c20 4669 6775 7265 732c  tnotes, Figures,
+00007ac0: 2054 6162 6c65 732c 2042 6f78 6573 220a   Tables, Boxes".
+00007ad0: 2020 2020 2020 2020 6261 636b 5f74 6974          back_tit
+00007ae0: 6c65 2e61 7474 7269 625b 2273 7479 6c65  le.attrib["style
+00007af0: 225d 203d 2022 666f 6e74 2d73 697a 653a  "] = "font-size:
+00007b00: 2032 3070 783b 2066 6f6e 742d 6661 6d69   20px; font-fami
+00007b10: 6c79 3a20 7361 6e73 6572 6966 3b22 0a20  ly: sanserif;". 
+00007b20: 2020 2020 2020 2072 6574 7572 6e20 6261         return ba
+00007b30: 636b 0a0a 2020 2020 4063 6c61 7373 6d65  ck..    @classme
+00007b40: 7468 6f64 0a20 2020 2064 6566 2067 6574  thod.    def get
+00007b50: 5f62 6163 6b5f 6469 7628 636c 732c 2068  _back_div(cls, h
+00007b60: 746d 6c5f 656c 656d 293a 0a20 2020 2020  tml_elem):.     
+00007b70: 2020 2022 2222 6765 7420 6f72 2063 7265     """get or cre
+00007b80: 6174 6520 626f 6479 2f64 6976 5b40 636c  ate body/div[@cl
+00007b90: 6173 733d 2762 6163 6b27 5d22 2222 0a20  ass='back']""". 
+00007ba0: 2020 2020 2020 2062 6163 6b73 203d 2048         backs = H
+00007bb0: 746d 6c4c 6962 2e67 6574 5f62 6f64 7928  tmlLib.get_body(
+00007bc0: 6874 6d6c 5f65 6c65 6d29 2e78 7061 7468  html_elem).xpath
+00007bd0: 2822 2e2f 6469 765b 636c 6173 733d 2762  ("./div[class='b
+00007be0: 6163 6b27 5d22 290a 2020 2020 2020 2020  ack']").        
+00007bf0: 7265 7475 726e 2062 6163 6b73 5b30 5d20  return backs[0] 
+00007c00: 6966 206c 656e 2862 6163 6b73 2920 3e20  if len(backs) > 
+00007c10: 3020 656c 7365 2048 746d 6c47 726f 7570  0 else HtmlGroup
+00007c20: 2e63 7265 6174 655f 6261 636b 5f64 6976  .create_back_div
+00007c30: 2868 746d 6c5f 656c 656d 290a 0a20 2020  (html_elem)..   
+00007c40: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+00007c50: 2020 6465 6620 6372 6561 7465 5f68 6561    def create_hea
+00007c60: 645f 7374 796c 655f 656c 656d 2863 6c73  d_style_elem(cls
+00007c70: 2c20 6e65 775f 6874 6d6c 2c20 7461 696c  , new_html, tail
+00007c80: 3d22 5a5a 5a22 293a 0a20 2020 2020 2020  ="ZZZ"):.       
+00007c90: 2073 7479 6c65 203d 2045 542e 5375 6245   style = ET.SubE
+00007ca0: 6c65 6d65 6e74 2848 746d 6c4c 6962 2e67  lement(HtmlLib.g
+00007cb0: 6574 5f68 6561 6428 6e65 775f 6874 6d6c  et_head(new_html
+00007cc0: 292c 2043 5353 5374 796c 652e 5354 594c  ), CSSStyle.STYL
+00007cd0: 4529 0a20 2020 2020 2020 2069 6620 7461  E).        if ta
+00007ce0: 696c 3a0a 2020 2020 2020 2020 2020 2020  il:.            
+00007cf0: 7374 796c 652e 7461 696c 203d 2074 6169  style.tail = tai
+00007d00: 6c0a 2020 2020 2020 2020 2320 6261 7369  l.        # basi
+00007d10: 6320 7374 796c 696e 6720 746f 2073 686f  c styling to sho
+00007d20: 7720 6469 7673 2061 6e64 2073 7061 6e73  w divs and spans
+00007d30: 0a20 2020 2020 2020 2073 7479 6c65 2e74  .        style.t
+00007d40: 6578 7420 3d20 2222 220a 2020 2020 2020  ext = """.      
+00007d50: 2020 6469 7620 7b62 6f72 6465 723a 2072    div {border: r
+00007d60: 6564 2073 6f6c 6964 2031 7078 3b20 6d61  ed solid 1px; ma
+00007d70: 7267 696e 3a20 3170 783b 7d0a 2020 2020  rgin: 1px;}.    
+00007d80: 2020 2020 7370 616e 207b 6261 636b 6772      span {backgr
+00007d90: 6f75 6e64 3a20 2365 6565 6565 653b 206d  ound: #eeeeee; m
+00007da0: 6172 6769 6e3a 2031 7078 3b7d 0a20 2020  argin: 1px;}.   
+00007db0: 2020 2020 2064 6976 2e66 6c6f 6174 207b       div.float {
+00007dc0: 6261 636b 6772 6f75 6e64 3a20 2364 6466  background: #ddf
+00007dd0: 6666 663b 7d0a 2020 2020 2020 2020 2020  fff;}.          
+00007de0: 2020 2020 2020 2020 2020 2022 2222 0a20             """. 
+00007df0: 2020 2020 2020 2072 6574 7572 6e20 7374         return st
+00007e00: 796c 650a 0a20 2020 2040 636c 6173 736d  yle..    @classm
+00007e10: 6574 686f 640a 2020 2020 6465 6620 6578  ethod.    def ex
+00007e20: 7472 6163 745f 666f 6f74 6e6f 7465 735f  tract_footnotes_
+00007e30: 746f 5f62 6163 6b28 636c 732c 2068 746d  to_back(cls, htm
+00007e40: 6c5f 656c 656d 293a 0a20 2020 2020 2020  l_elem):.       
+00007e50: 2048 746d 6c55 7469 6c2e 6578 7472 6163   HtmlUtil.extrac
+00007e60: 745f 666f 6f74 6e6f 7465 7328 6874 6d6c  t_footnotes(html
+00007e70: 5f65 6c65 6d2c 2022 666f 6e74 2d73 697a  _elem, "font-siz
+00007e80: 653a 2036 2e30 2229 0a0a 2020 2020 4063  e: 6.0")..    @c
+00007e90: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+00007ea0: 6566 2072 656d 6f76 655f 656d 7074 795f  ef remove_empty_
+00007eb0: 6469 7673 2863 6c73 2c20 656c 656d 293a  divs(cls, elem):
+00007ec0: 0a20 2020 2020 2020 2064 6976 7320 3d20  .        divs = 
+00007ed0: 656c 656d 2e78 7061 7468 2822 2e2f 2f64  elem.xpath(".//d
+00007ee0: 6976 2229 0a20 2020 2020 2020 2066 6f72  iv").        for
+00007ef0: 2064 6976 2069 6e20 6469 7673 3a0a 2020   div in divs:.  
+00007f00: 2020 2020 2020 2020 2020 7465 7874 203d            text =
+00007f10: 2027 272e 6a6f 696e 2864 6976 2e69 7465   ''.join(div.ite
+00007f20: 7274 6578 7428 2929 0a20 2020 2020 2020  rtext()).       
+00007f30: 2020 2020 2069 6620 6e6f 7420 7465 7874       if not text
+00007f40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00007f50: 2020 6469 762e 6765 7470 6172 656e 7428    div.getparent(
+00007f60: 292e 7265 6d6f 7665 2864 6976 290a 0a20  ).remove(div).. 
+00007f70: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+00007f80: 2020 2020 6465 6620 6a6f 696e 5f73 706c      def join_spl
+00007f90: 6974 5f64 6976 7328 636c 732c 2074 6f70  it_divs(cls, top
+00007fa0: 5f64 6976 293a 0a20 2020 2020 2020 2064  _div):.        d
+00007fb0: 6976 7320 3d20 746f 705f 6469 762e 7870  ivs = top_div.xp
+00007fc0: 6174 6828 222e 2f2f 6469 7622 290a 2020  ath(".//div").  
+00007fd0: 2020 2020 2020 666f 7220 692c 2064 6976        for i, div
+00007fe0: 2069 6e20 656e 756d 6572 6174 6528 6469   in enumerate(di
+00007ff0: 7673 293a 0a20 2020 2020 2020 2020 2020  vs):.           
+00008000: 2069 6620 6920 3e20 303a 0a20 2020 2020   if i > 0:.     
+00008010: 2020 2020 2020 2020 2020 2064 6976 3020             div0 
+00008020: 3d20 6469 7673 5b69 202d 2031 5d0a 2020  = divs[i - 1].  
+00008030: 2020 2020 2020 2020 2020 2020 2020 7370                sp
+00008040: 616e 3020 3d20 4874 6d6c 4772 6f75 702e  an0 = HtmlGroup.
+00008050: 6765 745f 6c61 7374 5f73 7061 6e28 6469  get_last_span(di
+00008060: 7630 290a 2020 2020 2020 2020 2020 2020  v0).            
+00008070: 2020 2020 7370 616e 3120 3d20 4874 6d6c      span1 = Html
+00008080: 4772 6f75 702e 6765 745f 6669 7273 745f  Group.get_first_
+00008090: 7370 616e 2864 6976 290a 2020 2020 2020  span(div).      
+000080a0: 2020 2020 2020 2020 2020 6966 2073 7061            if spa
+000080b0: 6e30 2069 7320 6e6f 7420 4e6f 6e65 2061  n0 is not None a
+000080c0: 6e64 2073 7061 6e31 2069 7320 6e6f 7420  nd span1 is not 
+000080d0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+000080e0: 2020 2020 2020 2020 2020 7374 796c 6530            style0
+000080f0: 203d 2043 5353 5374 796c 652e 6372 6561   = CSSStyle.crea
+00008100: 7465 5f63 7373 5f73 7479 6c65 5f66 726f  te_css_style_fro
+00008110: 6d5f 6174 7472 6962 7574 655f 6f66 5f62  m_attribute_of_b
+00008120: 6f64 795f 656c 656d 656e 7428 7370 616e  ody_element(span
+00008130: 3029 0a20 2020 2020 2020 2020 2020 2020  0).             
+00008140: 2020 2020 2020 2073 7479 6c65 3120 3d20         style1 = 
+00008150: 4353 5353 7479 6c65 2e63 7265 6174 655f  CSSStyle.create_
+00008160: 6373 735f 7374 796c 655f 6672 6f6d 5f61  css_style_from_a
+00008170: 7474 7269 6275 7465 5f6f 665f 626f 6479  ttribute_of_body
+00008180: 5f65 6c65 6d65 6e74 2873 7061 6e30 290a  _element(span0).
+00008190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000081a0: 2020 2020 6966 2073 7479 6c65 3020 3d3d      if style0 ==
+000081b0: 2073 7479 6c65 313a 0a20 2020 2020 2020   style1:.       
+000081c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000081d0: 2069 6620 7370 616e 3120 6973 206e 6f74   if span1 is not
+000081e0: 204e 6f6e 6520 616e 6420 6c65 6e28 7370   None and len(sp
+000081f0: 616e 312e 7465 7874 2920 3e20 3020 616e  an1.text) > 0 an
+00008200: 6420 7370 616e 312e 7465 7874 5b30 5d2e  d span1.text[0].
+00008210: 6973 6c6f 7765 7228 293a 0a20 2020 2020  islower():.     
+00008220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008230: 2020 2020 2020 2023 2070 7269 6e74 2866         # print(f
+00008240: 2220 6a6f 696e 6564 2073 6563 6f6e 645f  " joined second_
+00008250: 7370 616e 207b 7370 616e 312e 7465 7874  span {span1.text
+00008260: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+00008270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008280: 4874 6d6c 5574 696c 2e6a 6f69 6e5f 7370  HtmlUtil.join_sp
+00008290: 616e 735f 696e 5f73 616d 655f 6469 7628  ans_in_same_div(
+000082a0: 7370 616e 302c 2073 7061 6e31 290a 2020  span0, span1).  
+000082b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000082c0: 2020 2020 2020 2020 2020 666f 7220 7370            for sp
+000082d0: 616e 2069 6e20 6469 762e 7870 6174 6828  an in div.xpath(
+000082e0: 222e 2f73 7061 6e22 293a 0a20 2020 2020  "./span"):.     
+000082f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008300: 2020 2020 2020 2020 2020 2064 6976 302e             div0.
+00008310: 6170 7065 6e64 2873 7061 6e29 0a20 2020  append(span).   
+00008320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008330: 2020 2020 2020 2020 2064 6976 2e67 6574           div.get
+00008340: 7061 7265 6e74 2829 2e72 656d 6f76 6528  parent().remove(
+00008350: 6469 7629 0a0a 0a20 2020 2040 636c 6173  div)...    @clas
+00008360: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+00008370: 6765 745f 6c61 7374 5f73 7061 6e28 636c  get_last_span(cl
+00008380: 732c 2064 6976 293a 0a20 2020 2020 2020  s, div):.       
+00008390: 2073 7061 6e73 203d 2064 6976 2e78 7061   spans = div.xpa
+000083a0: 7468 2822 2e2f 7370 616e 2229 0a20 2020  th("./span").   
+000083b0: 2020 2020 2072 6574 7572 6e20 7370 616e       return span
+000083c0: 735b 2d31 5d20 6966 206c 656e 2873 7061  s[-1] if len(spa
+000083d0: 6e73 2920 3e20 3020 656c 7365 204e 6f6e  ns) > 0 else Non
+000083e0: 650a 0a20 2020 2040 636c 6173 736d 6574  e..    @classmet
+000083f0: 686f 640a 2020 2020 6465 6620 6765 745f  hod.    def get_
+00008400: 6669 7273 745f 7370 616e 2863 6c73 2c20  first_span(cls, 
+00008410: 6469 7629 3a0a 2020 2020 2020 2020 7370  div):.        sp
+00008420: 616e 7320 3d20 6469 762e 7870 6174 6828  ans = div.xpath(
+00008430: 222e 2f73 7061 6e22 290a 2020 2020 2020  "./span").      
+00008440: 2020 7265 7475 726e 2073 7061 6e73 5b30    return spans[0
+00008450: 5d20 6966 206c 656e 2873 7061 6e73 2920  ] if len(spans) 
+00008460: 3e20 3020 656c 7365 204e 6f6e 650a 0a20  > 0 else None.. 
+00008470: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+00008480: 2020 2020 6465 6620 6164 645f 7061 7261      def add_para
+00008490: 6772 6170 685f 6964 7328 636c 732c 2074  graph_ids(cls, t
+000084a0: 6f70 5f64 6976 293a 0a20 2020 2020 2020  op_div):.       
+000084b0: 2022 2222 6164 6473 2073 6571 7565 6e74   """adds sequent
+000084c0: 6961 6c20 7061 7261 6772 6170 6820 6e75  ial paragraph nu
+000084d0: 6d62 6572 696e 6720 2865 2e67 2e20 312e  mbering (e.g. 1.
+000084e0: 322e 3320 3d3e 2031 2e32 2e33 2e61 2c20  2.3 => 1.2.3.a, 
+000084f0: 312e 322e 332e 6220 6574 6322 2222 0a20  1.2.3.b etc""". 
+00008500: 2020 2020 2020 2074 6974 6c65 5f70 6172         title_par
+00008510: 615f 6469 7673 203d 2074 6f70 5f64 6976  a_divs = top_div
+00008520: 2e78 7061 7468 2822 2e2f 2f64 6976 5b40  .xpath(".//div[@
+00008530: 7469 746c 6520 616e 6420 636f 6e74 6169  title and contai
+00008540: 6e73 2840 636c 6173 732c 2027 7365 6374  ns(@class, 'sect
+00008550: 696f 6e27 295d 2229 0a20 2020 2020 2020  ion')]").       
+00008560: 2066 6f72 2074 6974 6c65 5f70 6172 615f   for title_para_
+00008570: 6469 7620 696e 2074 6974 6c65 5f70 6172  div in title_par
+00008580: 615f 6469 7673 3a0a 2020 2020 2020 2020  a_divs:.        
+00008590: 2020 2020 6c6f 6767 6572 2e64 6562 7567      logger.debug
+000085a0: 2866 2274 6974 6c65 2070 6172 6120 6469  (f"title para di
+000085b0: 7673 207b 6c65 6e28 7469 746c 655f 7061  vs {len(title_pa
+000085c0: 7261 5f64 6976 7329 7d22 290a 2020 2020  ra_divs)}").    
+000085d0: 2020 2020 2020 2020 7469 746c 655f 6964          title_id
+000085e0: 203d 2074 6974 6c65 5f70 6172 615f 6469   = title_para_di
+000085f0: 762e 6174 7472 6962 2e67 6574 2827 7469  v.attrib.get('ti
+00008600: 746c 6527 290a 2020 2020 2020 2020 2020  tle').          
+00008610: 2020 6966 206e 6f74 2074 6974 6c65 5f69    if not title_i
+00008620: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
+00008630: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
+00008640: 2020 2020 2020 2020 666f 6c6c 6f77 6572          follower
+00008650: 7320 3d20 7469 746c 655f 7061 7261 5f64  s = title_para_d
+00008660: 6976 2e78 7061 7468 2822 666f 6c6c 6f77  iv.xpath("follow
+00008670: 696e 672d 7369 626c 696e 673a 3a64 6976  ing-sibling::div
+00008680: 2229 0a20 2020 2020 2020 2020 2020 2066  ").            f
+00008690: 6f72 2069 2c20 666f 6c6c 6f77 6572 2069  or i, follower i
+000086a0: 6e20 656e 756d 6572 6174 6528 666f 6c6c  n enumerate(foll
+000086b0: 6f77 6572 7329 3a0a 2020 2020 2020 2020  owers):.        
+000086c0: 2020 2020 2020 2020 6c65 7474 6572 203d          letter =
+000086d0: 2048 746d 6c47 726f 7570 2e67 656e 6572   HtmlGroup.gener
+000086e0: 6174 655f 6c6f 7765 7263 6173 655f 6c65  ate_lowercase_le
+000086f0: 7474 6572 5f69 6428 6929 0a20 2020 2020  tter_id(i).     
+00008700: 2020 2020 2020 2020 2020 2069 6420 3d20             id = 
+00008710: 7469 746c 655f 6964 202b 2022 2e22 202b  title_id + "." +
+00008720: 206c 6574 7465 720a 2020 2020 2020 2020   letter.        
+00008730: 2020 2020 2020 2020 7370 616e 203d 2045          span = E
+00008740: 542e 456c 656d 656e 7428 2273 7061 6e22  T.Element("span"
+00008750: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00008760: 2020 7370 616e 2e61 7474 7269 625b 2273    span.attrib["s
+00008770: 7479 6c65 225d 203d 2022 6261 636b 6772  tyle"] = "backgr
+00008780: 6f75 6e64 3a20 2366 6666 6664 643b 2066  ound: #ffffdd; f
+00008790: 6f6e 742d 7369 7a65 3a20 3870 7822 0a20  ont-size: 8px". 
+000087a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000087b0: 7061 6e2e 7465 7874 203d 2069 640a 2020  pan.text = id.  
+000087c0: 2020 2020 2020 2020 2020 2020 2020 7370                sp
+000087d0: 616e 2e61 7474 7269 625b 2269 6422 5d20  an.attrib["id"] 
+000087e0: 3d20 6964 0a20 2020 2020 2020 2020 2020  = id.           
+000087f0: 2020 2020 2066 6f6c 6c6f 7765 722e 696e       follower.in
+00008800: 7365 7274 2830 2c20 7370 616e 290a 0a20  sert(0, span).. 
+00008810: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+00008820: 2020 2020 6465 6620 6d61 6b65 5f68 6965      def make_hie
+00008830: 7261 7263 6869 6361 6c5f 7365 6374 696f  rarchical_sectio
+00008840: 6e73 5f4b 4559 2863 6c73 2c20 6874 6d6c  ns_KEY(cls, html
+00008850: 5f65 6c65 6d2c 2073 7465 6d2c 2073 6563  _elem, stem, sec
+00008860: 7469 6f6e 5f72 6567 6578 6573 3d4e 6f6e  tion_regexes=Non
+00008870: 652c 206f 7574 6469 723d 4e6f 6e65 2c20  e, outdir=None, 
+00008880: 6465 6275 673d 4661 6c73 6529 3a0a 2020  debug=False):.  
+00008890: 2020 2020 2020 2222 224b 6579 2066 6f72        """Key for
+000088a0: 6d61 7474 696e 6720 726f 7574 696e 650a  matting routine.
+000088b0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000088c0: 2020 2020 4874 6d6c 5374 796c 652e 6578      HtmlStyle.ex
+000088d0: 7472 6163 745f 7374 796c 6573 5f61 6e64  tract_styles_and
+000088e0: 5f6e 6f72 6d61 6c69 7a65 5f63 6c61 7373  _normalize_class
+000088f0: 7265 6673 2868 746d 6c5f 656c 656d 2c20  refs(html_elem, 
+00008900: 6f75 7464 6972 3d6f 7574 6469 7229 0a20  outdir=outdir). 
+00008910: 2020 2020 2020 2069 6620 6f75 7464 6972         if outdir
+00008920: 3a0a 2020 2020 2020 2020 2020 2020 4874  :.            Ht
+00008930: 6d6c 4c69 622e 7772 6974 655f 6874 6d6c  mlLib.write_html
+00008940: 5f66 696c 6528 6874 6d6c 5f65 6c65 6d2c  _file(html_elem,
+00008950: 2050 6174 6828 6f75 7464 6972 2c20 6622   Path(outdir, f"
+00008960: 7b73 7465 6d7d 5f73 7479 6c65 732e 6874  {stem}_styles.ht
+00008970: 6d6c 2229 2c20 6465 6275 673d 5472 7565  ml"), debug=True
+00008980: 290a 2020 2020 2020 2020 4874 6d6c 4772  ).        HtmlGr
+00008990: 6f75 702e 616e 6e6f 7461 7465 5f74 6974  oup.annotate_tit
+000089a0: 6c65 5f73 6563 7469 6f6e 7328 6874 6d6c  le_sections(html
+000089b0: 5f65 6c65 6d2c 2073 6563 7469 6f6e 5f72  _elem, section_r
+000089c0: 6567 6578 6573 3d73 6563 7469 6f6e 5f72  egexes=section_r
+000089d0: 6567 6578 6573 290a 2020 2020 2020 2020  egexes).        
+000089e0: 4874 6d6c 4772 6f75 702e 6578 7472 6163  HtmlGroup.extrac
+000089f0: 745f 666f 6f74 6e6f 7465 735f 746f 5f62  t_footnotes_to_b
+00008a00: 6163 6b28 6874 6d6c 5f65 6c65 6d29 0a20  ack(html_elem). 
+00008a10: 2020 2020 2020 206e 6577 5f64 6976 203d         new_div =
+00008a20: 2048 746d 6c47 726f 7570 2e67 726f 7570   HtmlGroup.group
+00008a30: 5f64 6976 735f 696e 746f 5f74 7265 6528  _divs_into_tree(
+00008a40: 4874 6d6c 4c69 622e 6765 745f 626f 6479  HtmlLib.get_body
+00008a50: 2868 746d 6c5f 656c 656d 2929 0a20 2020  (html_elem)).   
+00008a60: 2020 2020 2048 746d 6c47 726f 7570 2e72       HtmlGroup.r
+00008a70: 656d 6f76 655f 656d 7074 795f 6469 7673  emove_empty_divs
+00008a80: 286e 6577 5f64 6976 290a 2020 2020 2020  (new_div).      
+00008a90: 2020 4874 6d6c 4772 6f75 702e 6a6f 696e    HtmlGroup.join
+00008aa0: 5f73 706c 6974 5f64 6976 7328 6e65 775f  _split_divs(new_
+00008ab0: 6469 7629 0a20 2020 2020 2020 2048 746d  div).        Htm
+00008ac0: 6c47 726f 7570 2e61 6464 5f70 6172 6167  lGroup.add_parag
+00008ad0: 7261 7068 5f69 6473 286e 6577 5f64 6976  raph_ids(new_div
+00008ae0: 290a 2020 2020 2020 2020 2320 7472 616e  ).        # tran
+00008af0: 7366 6572 2074 6f20 6e65 7720 656c 656d  sfer to new elem
+00008b00: 656e 7420 286d 6179 206e 6f74 2062 6520  ent (may not be 
+00008b10: 6e65 6365 7373 6172 793f 290a 2020 2020  necessary?).    
+00008b20: 2020 2020 6e65 775f 6874 6d6c 203d 2048      new_html = H
+00008b30: 746d 6c4c 6962 2e63 7265 6174 655f 6874  tmlLib.create_ht
+00008b40: 6d6c 5f77 6974 685f 656d 7074 795f 6865  ml_with_empty_he
+00008b50: 6164 5f62 6f64 7928 290a 2020 2020 2020  ad_body().      
+00008b60: 2020 4874 6d6c 4c69 622e 6765 745f 626f    HtmlLib.get_bo
+00008b70: 6479 286e 6577 5f68 746d 6c29 2e61 7070  dy(new_html).app
+00008b80: 656e 6428 6e65 775f 6469 7629 0a20 2020  end(new_div).   
+00008b90: 2020 2020 2048 746d 6c53 7479 6c65 2e74       HtmlStyle.t
+00008ba0: 7261 6e73 6665 725f 6865 6164 5f73 7479  ransfer_head_sty
+00008bb0: 6c65 7328 6874 6d6c 5f65 6c65 6d2c 206e  les(html_elem, n
+00008bc0: 6577 5f68 746d 6c29 0a20 2020 2020 2020  ew_html).       
+00008bd0: 2048 746d 6c47 726f 7570 2e63 6f6c 6c65   HtmlGroup.colle
+00008be0: 6374 5f66 6c6f 6174 735f 746f 5f62 6163  ct_floats_to_bac
+00008bf0: 6b28 6e65 775f 6874 6d6c 290a 2020 2020  k(new_html).    
+00008c00: 2020 2020 4874 6d6c 4772 6f75 702e 616e      HtmlGroup.an
+00008c10: 6e6f 7461 7465 5f69 7063 635f 7461 7267  notate_ipcc_targ
+00008c20: 6574 5f69 6473 286e 6577 5f68 746d 6c29  et_ids(new_html)
+00008c30: 0a20 2020 2020 2020 2069 6620 6f75 7464  .        if outd
+00008c40: 6972 3a0a 2020 2020 2020 2020 2020 2020  ir:.            
+00008c50: 4874 6d6c 4c69 622e 7772 6974 655f 6874  HtmlLib.write_ht
+00008c60: 6d6c 5f66 696c 6528 6e65 775f 6874 6d6c  ml_file(new_html
+00008c70: 2c20 5061 7468 286f 7574 6469 722c 2066  , Path(outdir, f
+00008c80: 227b 7374 656d 7d5f 6772 6f75 7073 2e68  "{stem}_groups.h
+00008c90: 746d 6c22 292c 2064 6562 7567 3d54 7275  tml"), debug=Tru
+00008ca0: 6529 0a20 2020 2020 2020 2073 706c 6974  e).        split
+00008cb0: 5f73 7061 6e5f 7265 6765 7820 3d20 2228  _span_regex = "(
+00008cc0: 3f50 3c70 7265 3e2e 2a28 3f3a 6869 6768  ?P<pre>.*(?:high
+00008cd0: 7c6d 6564 6975 6d7c 6c6f 7729 5c5c 732a  |medium|low)\\s*
+00008ce0: 2863 6f6e 6669 6465 6e63 6529 2928 3f50  (confidence))(?P
+00008cf0: 3c70 6f73 743e 2e2a 2922 0a20 2020 2020  <post>.*)".     
+00008d00: 2020 2048 746d 6c47 726f 7570 2e73 706c     HtmlGroup.spl
+00008d10: 6974 5f73 7061 6e73 286e 6577 5f68 746d  it_spans(new_htm
+00008d20: 6c2c 2073 706c 6974 5f73 7061 6e5f 7265  l, split_span_re
+00008d30: 6765 7829 0a20 2020 2020 2020 2069 6620  gex).        if 
+00008d40: 6f75 7464 6972 3a0a 2020 2020 2020 2020  outdir:.        
+00008d50: 2020 2020 4874 6d6c 4c69 622e 7772 6974      HtmlLib.writ
+00008d60: 655f 6874 6d6c 5f66 696c 6528 6e65 775f  e_html_file(new_
+00008d70: 6874 6d6c 2c20 5061 7468 286f 7574 6469  html, Path(outdi
+00008d80: 722c 2066 227b 7374 656d 7d5f 7374 6174  r, f"{stem}_stat
+00008d90: 656d 656e 7473 2e68 746d 6c22 292c 2064  ements.html"), d
+00008da0: 6562 7567 3d54 7275 6529 0a0a 2020 2020  ebug=True)..    
+00008db0: 2020 2020 7265 7475 726e 206e 6577 5f68      return new_h
+00008dc0: 746d 6c0a 0a20 2020 2040 636c 6173 736d  tml..    @classm
+00008dd0: 6574 686f 640a 2020 2020 6465 6620 6772  ethod.    def gr
+00008de0: 6f75 705f 6e65 7374 6564 5f73 6962 6c69  oup_nested_sibli
+00008df0: 6e67 7328 636c 732c 2068 746d 6c5f 656c  ngs(cls, html_el
+00008e00: 656d 2c20 7374 796c 6573 3d4e 6f6e 6529  em, styles=None)
+00008e10: 3a0a 2020 2020 2020 2020 6966 2073 7479  :.        if sty
+00008e20: 6c65 7320 6973 204e 6f6e 653a 0a20 2020  les is None:.   
+00008e30: 2020 2020 2020 2020 2073 7479 6c65 7320           styles 
+00008e40: 3d20 5b0a 2020 2020 2020 2020 2020 2020  = [.            
+00008e50: 2262 6f72 6465 7220 3a20 736f 6c69 6420  "border : solid 
+00008e60: 7075 7270 6c65 2032 7078 3b20 6d61 7267  purple 2px; marg
+00008e70: 696e 3a32 7078 3b22 2c0a 2020 2020 2020  in:2px;",.      
+00008e80: 2020 2020 2020 2262 6f72 6465 7220 3a20        "border : 
+00008e90: 6461 7368 6564 2067 7265 656e 2031 2e35  dashed green 1.5
+00008ea0: 7078 3b20 6d61 7267 696e 3a31 2e35 7078  px; margin:1.5px
+00008eb0: 3b22 2c0a 2020 2020 2020 2020 2020 2020  ;",.            
+00008ec0: 2262 6f72 6465 7220 3a20 646f 7474 6564  "border : dotted
+00008ed0: 2062 6c75 6520 3170 783b 206d 6172 6769   blue 1px; margi
+00008ee0: 6e3a 3170 783b 222c 0a20 2020 2020 2020  n:1px;",.       
+00008ef0: 2020 2020 205d 0a0a 2020 2020 2020 2020       ]..        
+00008f00: 4874 6d6c 4772 6f75 702e 6772 6f75 705f  HtmlGroup.group_
+00008f10: 7369 626c 696e 6773 2868 746d 6c5f 656c  siblings(html_el
+00008f20: 656d 2c20 6c6f 6361 746f 723d 2273 6563  em, locator="sec
+00008f30: 7469 6f6e 222c 2073 7479 6c65 3d73 7479  tion", style=sty
+00008f40: 6c65 735b 305d 290a 2020 2020 2020 2020  les[0]).        
+00008f50: 4874 6d6c 4772 6f75 702e 6772 6f75 705f  HtmlGroup.group_
+00008f60: 7369 626c 696e 6773 2868 746d 6c5f 656c  siblings(html_el
+00008f70: 656d 2c20 6c6f 6361 746f 723d 2273 7562  em, locator="sub
+00008f80: 5f73 6563 7469 6f6e 222c 2073 7479 6c65  _section", style
+00008f90: 3d73 7479 6c65 735b 315d 2c20 6465 6275  =styles[1], debu
+00008fa0: 673d 5472 7565 290a 2020 2020 2020 2020  g=True).        
+00008fb0: 4874 6d6c 4772 6f75 702e 6772 6f75 705f  HtmlGroup.group_
+00008fc0: 7369 626c 696e 6773 2868 746d 6c5f 656c  siblings(html_el
+00008fd0: 656d 2c20 6c6f 6361 746f 723d 2273 7562  em, locator="sub
+00008fe0: 5f73 7562 5f73 6563 7469 6f6e 222c 2073  _sub_section", s
+00008ff0: 7479 6c65 3d73 7479 6c65 735b 325d 290a  tyle=styles[2]).
+00009000: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+00009010: 640a 2020 2020 6465 6620 616e 6e6f 7461  d.    def annota
+00009020: 7465 5f69 7063 635f 7461 7267 6574 5f69  te_ipcc_target_i
+00009030: 6473 2863 6c73 2c20 6874 6d6c 5f65 6c65  ds(cls, html_ele
+00009040: 6d29 3a0a 2020 2020 2020 2020 2222 2266  m):.        """f
+00009050: 696e 6473 2073 6563 7469 6f6e 7320 6f66  inds sections of
+00009060: 2066 6f72 6d20 7b74 6172 6765 745f 6964   form {target_id
+00009070: 2c20 7461 7267 6574 5f69 642e 2e2e 7d20  , target_id...} 
+00009080: 616e 6420 6164 6473 2063 6c61 7373 3d74  and adds class=t
+00009090: 6172 6765 7473 0a20 2020 2020 2020 2054  argets.        T
+000090a0: 6869 7320 6973 2062 6574 7465 7220 646f  his is better do
+000090b0: 6e65 2069 6e20 7468 6520 616e 6e6f 7461  ne in the annota
+000090c0: 746f 7220 776f 726b 666c 6f77 2077 6865  tor workflow whe
+000090d0: 7265 2069 7420 776f 726b 732e 2054 6869  re it works. Thi
+000090e0: 7320 6973 2061 2068 6163 6b20 666f 720a  s is a hack for.
+000090f0: 2020 2020 2020 2020 6669 6c65 7320 7768          files wh
+00009100: 6963 6820 6861 7665 2062 6565 6e20 6d69  ich have been mi
+00009110: 7373 6564 2222 220a 2020 2020 2020 2020  ssed""".        
+00009120: 7265 5f63 7572 6c79 203d 2072 652e 636f  re_curly = re.co
+00009130: 6d70 696c 6528 7222 283f 503c 7072 653e  mpile(r"(?P<pre>
+00009140: 2e2a 297b 283f 503c 626f 6479 3e5b 5e7d  .*){(?P<body>[^}
+00009150: 5d2b 297d 283f 503c 706f 7374 3e2e 2a29  ]+)}(?P<post>.*)
+00009160: 2229 0a20 2020 2020 2020 2054 4152 4745  ").        TARGE
+00009170: 5453 203d 2022 7461 7267 6574 7322 0a20  TS = "targets". 
+00009180: 2020 2020 2020 2063 7572 6c79 5f73 7061         curly_spa
+00009190: 6e73 203d 2068 746d 6c5f 656c 656d 2e78  ns = html_elem.x
+000091a0: 7061 7468 2866 222e 2f2f 7370 616e 5b63  path(f".//span[c
+000091b0: 6f6e 7461 696e 7328 2e2c 2027 7b7b 2729  ontains(., '{{')
+000091c0: 2061 6e64 2063 6f6e 7461 696e 7328 2e2c   and contains(.,
+000091d0: 2027 7d7d 2729 5d22 290a 2020 2020 2020   '}}')]").      
+000091e0: 2020 6c6f 6767 6572 2e64 6562 7567 2866    logger.debug(f
+000091f0: 2266 6f75 6e64 2063 7572 6c69 6573 207b  "found curlies {
+00009200: 6c65 6e28 6375 726c 795f 7370 616e 7329  len(curly_spans)
+00009210: 7d22 290a 2020 2020 2020 2020 666f 7220  }").        for 
+00009220: 7370 616e 2069 6e20 6375 726c 795f 7370  span in curly_sp
+00009230: 616e 733a 0a20 2020 2020 2020 2020 2020  ans:.           
+00009240: 2070 6172 656e 7420 3d20 7370 616e 2e67   parent = span.g
+00009250: 6574 7061 7265 6e74 2829 0a20 2020 2020  etparent().     
+00009260: 2020 2020 2020 206d 6174 6368 203d 2072         match = r
+00009270: 655f 6375 726c 792e 6d61 7463 6828 7370  e_curly.match(sp
+00009280: 616e 2e74 6578 7429 0a20 2020 2020 2020  an.text).       
+00009290: 2020 2020 2069 6620 6d61 7463 683a 0a20       if match:. 
+000092a0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000092b0: 6f72 2067 7020 696e 205b 2270 7265 222c  or gp in ["pre",
+000092c0: 2022 626f 6479 222c 2022 706f 7374 225d   "body", "post"]
+000092d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000092e0: 2020 2020 2020 7420 3d20 6d61 7463 682e        t = match.
+000092f0: 6772 6f75 7028 6770 290a 2020 2020 2020  group(gp).      
+00009300: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00009310: 206c 656e 2874 2920 3e20 303a 0a20 2020   len(t) > 0:.   
+00009320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009330: 2020 2020 2069 6620 6770 203d 3d20 2262       if gp == "b
+00009340: 6f64 7922 3a0a 2020 2020 2020 2020 2020  ody":.          
 00009350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009360: 2020 2020 2020 7370 616e 2e61 6464 7072        span.addpr
-00009370: 6576 696f 7573 2861 290a 2020 2020 2020  evious(a).      
-00009380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009390: 2020 2020 2020 2020 2020 612e 7465 7874            a.text
-000093a0: 203d 2074 6172 6765 745f 6964 0a20 2020   = target_id.   
-000093b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000093c0: 2020 2020 2020 2020 2020 2020 2061 2e61               a.a
-000093d0: 7474 7269 625b 2268 7265 6622 5d20 3d20  ttrib["href"] = 
-000093e0: 6765 745f 7461 7267 6574 5f68 7265 6628  get_target_href(
-000093f0: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
-00009400: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00009410: 2070 6172 656e 742e 7265 6d6f 7665 2873   parent.remove(s
-00009420: 7061 6e29 0a20 2020 2020 2020 2020 2020  pan).           
-00009430: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00009440: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00009450: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00009460: 7061 6e78 203d 2045 542e 5375 6245 6c65  panx = ET.SubEle
-00009470: 6d65 6e74 2870 6172 656e 742c 2022 7370  ment(parent, "sp
-00009480: 616e 2229 0a20 2020 2020 2020 2020 2020  an").           
-00009490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000094a0: 2073 7061 6e78 2e74 6578 7420 3d20 740a   spanx.text = t.
+00009360: 2020 7461 7267 6574 5f69 6473 203d 2072    target_ids = r
+00009370: 652e 7370 6c69 7428 225b 2c3b 5d22 2c20  e.split("[,;]", 
+00009380: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
+00009390: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000093a0: 6f72 2074 6172 6765 745f 6964 2069 6e20  or target_id in 
+000093b0: 7461 7267 6574 5f69 6473 3a0a 2020 2020  target_ids:.    
+000093c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000093d0: 2020 2020 2020 2020 2020 2020 6120 3d20              a = 
+000093e0: 4554 2e53 7562 456c 656d 656e 7428 7061  ET.SubElement(pa
+000093f0: 7265 6e74 2c20 2261 2229 0a20 2020 2020  rent, "a").     
+00009400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009410: 2020 2020 2020 2020 2020 2073 7061 6e2e             span.
+00009420: 6164 6470 7265 7669 6f75 7328 6129 0a20  addprevious(a). 
+00009430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009440: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00009450: 2e74 6578 7420 3d20 7461 7267 6574 5f69  .text = target_i
+00009460: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
+00009470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009480: 2020 612e 6174 7472 6962 5b22 6872 6566    a.attrib["href
+00009490: 225d 203d 2067 6574 5f74 6172 6765 745f  "] = get_target_
+000094a0: 6872 6566 2874 290a 2020 2020 2020 2020  href(t).        
 000094b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000094c0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000094d0: 6174 7420 696e 2073 7061 6e2e 6174 7472  att in span.attr
-000094e0: 6962 3a0a 2020 2020 2020 2020 2020 2020  ib:.            
-000094f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009500: 2020 2020 7370 616e 782e 6174 7472 6962      spanx.attrib
-00009510: 5b61 7474 5d20 3d20 7370 616e 2e61 7474  [att] = span.att
-00009520: 7269 625b 6174 745d 0a20 2020 2020 2020  rib[att].       
-00009530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009540: 2020 2020 2073 7061 6e2e 6164 6470 7265       span.addpre
-00009550: 7669 6f75 7328 7370 616e 7829 0a20 2020  vious(spanx).   
-00009560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009570: 2020 2020 2020 2020 2073 7061 6e78 2e61           spanx.a
-00009580: 7474 7269 625b 2261 6e63 686f 7222 5d20  ttrib["anchor"] 
-00009590: 3d20 6770 0a0a 2020 2020 2020 2020 2020  = gp..          
-000095a0: 2020 2020 2020 7061 7265 6e74 2e72 656d        parent.rem
-000095b0: 6f76 6528 7370 616e 290a 0a20 2020 2020  ove(span)..     
-000095c0: 2020 2020 2020 2073 7061 6e2e 6174 7472         span.attr
-000095d0: 6962 5b22 636c 6173 7322 5d20 3d20 5441  ib["class"] = TA
-000095e0: 5247 4554 530a 0a20 2020 2040 636c 6173  RGETS..    @clas
-000095f0: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
-00009600: 6578 7472 6163 745f 7365 6374 696f 6e5f  extract_section_
-00009610: 6964 7328 636c 732c 2068 746d 6c5f 656c  ids(cls, html_el
-00009620: 656d 2c20 7870 6174 6873 3d5b 222e 2f2f  em, xpaths=[".//
-00009630: 6469 7622 2c20 222e 2f73 7061 6e22 5d2c  div", "./span"],
-00009640: 2072 6567 6578 6573 3d4e 6f6e 6529 3a0a   regexes=None):.
-00009650: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00009660: 2020 2020 6578 7472 6163 7473 2073 6563      extracts sec
-00009670: 7469 6f6e 7320 616e 6420 706f 7373 6962  tions and possib
-00009680: 6c79 2073 7562 7365 6374 696f 6e73 2066  ly subsections f
-00009690: 726f 6d20 636f 6d70 6f75 6e64 2065 6c65  rom compound ele
-000096a0: 6d65 6e74 7320 2865 2e67 2e20 6469 7629  ments (e.g. div)
-000096b0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-000096c0: 6874 6d6c 5f65 6c65 6d3a 2063 6f6d 706f  html_elem: compo
-000096d0: 756e 6420 656c 656d 656e 740a 2020 2020  und element.    
-000096e0: 2020 2020 3a70 6172 616d 2078 7061 7468      :param xpath
-000096f0: 733a 206c 6973 7420 6f66 2078 7061 7468  s: list of xpath
-00009700: 2066 6f72 2073 6563 7469 6f6e 2c20 6f70   for section, op
-00009710: 7469 6f6e 616c 2073 7562 7365 6374 696f  tional subsectio
-00009720: 6e2c 2063 7572 7265 6e74 6c79 206c 656e  n, currently len
-00009730: 2031 206f 7220 322c 0a20 2020 2020 2020   1 or 2,.       
-00009740: 2020 2073 696e 676c 6520 7870 6174 6820     single xpath 
-00009750: 6973 2074 6865 6e20 7772 6170 7065 6420  is then wrapped 
-00009760: 746f 206c 6973 743b 2064 6566 6175 6c74  to list; default
-00009770: 205b 222e 2f2f 6469 7622 2c20 222e 2f73   [".//div", "./s
-00009780: 7061 6e22 5d0a 2020 2020 2020 2020 3a70  pan"].        :p
-00009790: 6172 616d 2072 6567 6578 6573 3a20 6c69  aram regexes: li
-000097a0: 7374 206f 6620 7265 6765 7865 7320 666f  st of regexes fo
-000097b0: 7220 6561 6368 2064 6573 6365 6e74 3b20  r each descent; 
-000097c0: 7369 6e67 6c65 2069 7320 7772 6170 7065  single is wrappe
-000097d0: 6420 746f 206c 6973 7420 3b20 6966 206e  d to list ; if n
-000097e0: 6f6e 6520 6769 7665 6e0a 2020 2020 2020  one given.      
-000097f0: 2020 2020 6163 6365 7074 7320 616c 6c20      accepts all 
-00009800: 6465 7363 656e 6461 6e74 7320 6672 6f6d  descendants from
-00009810: 2078 7061 7468 0a20 2020 2020 2020 2022   xpath.        "
-00009820: 2222 0a20 2020 2020 2020 2069 6620 6e6f  "".        if no
-00009830: 7420 7870 6174 6873 3a0a 2020 2020 2020  t xpaths:.      
-00009840: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-00009850: 650a 2020 2020 2020 2020 6966 206e 6f74  e.        if not
-00009860: 2074 7970 6528 7870 6174 6873 2920 6973   type(xpaths) is
-00009870: 206c 6973 743a 0a20 2020 2020 2020 2020   list:.         
-00009880: 2020 2078 7061 7468 7320 3d20 5b78 7061     xpaths = [xpa
-00009890: 7468 735d 0a20 2020 2020 2020 2061 7373  ths].        ass
-000098a0: 6572 7420 3020 3c20 6c65 6e28 7870 6174  ert 0 < len(xpat
-000098b0: 6873 2920 3c3d 2032 2c20 6622 6e6f 2078  hs) <= 2, f"no x
-000098c0: 7061 7468 7320 6769 7665 6e22 0a0a 2020  paths given"..  
-000098d0: 2020 2020 2020 6966 206e 6f74 2072 6567        if not reg
-000098e0: 6578 6573 3a0a 2020 2020 2020 2020 2020  exes:.          
-000098f0: 2020 7265 6765 7865 7320 3d20 5b5d 0a20    regexes = []. 
-00009900: 2020 2020 2020 2069 6620 6e6f 7420 7479         if not ty
-00009910: 7065 2872 6567 6578 6573 2920 6973 206c  pe(regexes) is l
-00009920: 6973 743a 0a20 2020 2020 2020 2020 2020  ist:.           
-00009930: 2072 6567 6578 6573 203d 205b 7265 6765   regexes = [rege
-00009940: 7865 735d 0a0a 2020 2020 2020 2020 6469  xes]..        di
-00009950: 7673 203d 2068 746d 6c5f 656c 656d 2e78  vs = html_elem.x
-00009960: 7061 7468 2878 7061 7468 735b 305d 290a  path(xpaths[0]).
-00009970: 2020 2020 2020 2020 7365 6374 696f 6e73          sections
-00009980: 203d 205b 5d0a 2020 2020 2020 2020 7375   = [].        su
-00009990: 6273 6563 7469 6f6e 7320 3d20 5b5d 0a20  bsections = []. 
-000099a0: 2020 2020 2020 2066 6f72 2064 6976 2069         for div i
-000099b0: 6e20 6469 7673 3a0a 2020 2020 2020 2020  n divs:.        
-000099c0: 2020 2020 6966 206c 656e 2872 6567 6578      if len(regex
-000099d0: 6573 2920 3e20 3020 616e 6420 7265 6765  es) > 0 and rege
-000099e0: 7865 735b 305d 3a0a 2020 2020 2020 2020  xes[0]:.        
-000099f0: 2020 2020 2020 2020 7365 6374 696f 6e5f          section_
-00009a00: 6964 203d 2048 746d 6c55 7469 6c2e 6578  id = HtmlUtil.ex
-00009a10: 7472 6163 745f 7375 6273 7472 696e 6773  tract_substrings
-00009a20: 2864 6976 2c20 7870 6174 683d 7870 6174  (div, xpath=xpat
-00009a30: 6873 5b30 5d2c 2072 6567 6578 3d72 6567  hs[0], regex=reg
-00009a40: 6578 6573 5b30 5d29 0a20 2020 2020 2020  exes[0]).       
-00009a50: 2020 2020 2020 2020 2069 6620 7365 6374           if sect
-00009a60: 696f 6e5f 6964 3a0a 2020 2020 2020 2020  ion_id:.        
-00009a70: 2020 2020 2020 2020 2020 2020 7365 6374              sect
-00009a80: 696f 6e73 2e61 7070 656e 6428 7365 6374  ions.append(sect
-00009a90: 696f 6e5f 6964 290a 2020 2020 2020 2020  ion_id).        
-00009aa0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00009ab0: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
-00009ac0: 2069 6620 6c65 6e28 7265 6765 7865 7329   if len(regexes)
-00009ad0: 203e 2031 2061 6e64 2072 6567 6578 6573   > 1 and regexes
-00009ae0: 5b31 5d3a 0a20 2020 2020 2020 2020 2020  [1]:.           
-00009af0: 2020 2020 2073 7562 7365 6374 696f 6e5f       subsection_
-00009b00: 6964 203d 2048 746d 6c55 7469 6c2e 6578  id = HtmlUtil.ex
-00009b10: 7472 6163 745f 7375 6273 7472 696e 6773  tract_substrings
-00009b20: 2864 6976 2c20 7870 6174 683d 7870 6174  (div, xpath=xpat
-00009b30: 6873 5b31 5d2c 0a20 2020 2020 2020 2020  hs[1],.         
-00009b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009b70: 2020 2072 6567 6578 3d72 6567 6578 6573     regex=regexes
-00009b80: 5b31 5d2c 0a20 2020 2020 2020 2020 2020  [1],.           
-00009b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009bc0: 2072 656d 6f76 653d 4661 6c73 6529 0a20   remove=False). 
-00009bd0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00009be0: 6620 7375 6273 6563 7469 6f6e 5f69 643a  f subsection_id:
-00009bf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009c00: 2020 2020 2073 7562 7365 6374 696f 6e73       subsections
-00009c10: 2e61 7070 656e 6428 7375 6273 6563 7469  .append(subsecti
-00009c20: 6f6e 5f69 6429 0a20 2020 2020 2020 2072  on_id).        r
-00009c30: 6574 7572 6e20 7365 6374 696f 6e73 2c20  eturn sections, 
-00009c40: 7375 6273 6563 7469 6f6e 730a 0a20 2020  subsections..   
-00009c50: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-00009c60: 2020 6465 6620 616e 6e6f 7461 7465 5f64    def annotate_d
-00009c70: 6976 5f73 7061 6e73 5f77 7269 7465 5f66  iv_spans_write_f
-00009c80: 696e 616c 5f68 746d 6c28 636c 732c 2069  inal_html(cls, i
-00009c90: 6e70 7574 5f68 746d 6c2c 206f 7574 6669  nput_html, outfi
-00009ca0: 6c65 2c20 7374 796c 6573 3d4e 6f6e 6529  le, styles=None)
-00009cb0: 3a0a 2020 2020 2020 2020 6966 206e 6f74  :.        if not
-00009cc0: 2073 7479 6c65 733a 0a20 2020 2020 2020   styles:.       
-00009cd0: 2020 2020 2073 7479 6c65 7320 3d20 4874       styles = Ht
-00009ce0: 6d6c 4772 6f75 702e 4445 4641 554c 545f  mlGroup.DEFAULT_
-00009cf0: 5354 594c 4553 0a20 2020 2020 2020 2068  STYLES.        h
-00009d00: 746d 6c5f 656c 656d 203d 2045 542e 7061  tml_elem = ET.pa
-00009d10: 7273 6528 7374 7228 696e 7075 745f 6874  rse(str(input_ht
-00009d20: 6d6c 2929 2e67 6574 726f 6f74 2829 0a20  ml)).getroot(). 
-00009d30: 2020 2020 2020 2061 6e6e 6f74 6174 6f72         annotator
-00009d40: 203d 2048 746d 6c41 6e6e 6f74 6174 6f72   = HtmlAnnotator
-00009d50: 2e63 7265 6174 655f 6970 6363 5f61 6e6e  .create_ipcc_ann
-00009d60: 6f74 6174 6f72 2829 0a20 2020 2020 2020  otator().       
-00009d70: 2048 746d 6c53 7479 6c65 2e61 6464 5f68   HtmlStyle.add_h
-00009d80: 6561 645f 7374 796c 6573 5f6f 7269 6728  ead_styles_orig(
-00009d90: 6874 6d6c 5f65 6c65 6d2c 2073 7479 6c65  html_elem, style
-00009da0: 7329 0a20 2020 2020 2020 2073 7061 6e73  s).        spans
-00009db0: 203d 2068 746d 6c5f 656c 656d 2e78 7061   = html_elem.xpa
-00009dc0: 7468 2822 2e2f 2f73 7061 6e22 290a 2020  th(".//span").  
-00009dd0: 2020 2020 2020 666f 7220 7370 616e 2069        for span i
-00009de0: 6e20 7370 616e 733a 0a20 2020 2020 2020  n spans:.       
-00009df0: 2020 2020 2061 6e6e 6f74 6174 6f72 2e72       annotator.r
-00009e00: 756e 5f63 6f6d 6d61 6e64 7328 7370 616e  un_commands(span
-00009e10: 290a 2020 2020 2020 2020 4874 6d6c 4772  ).        HtmlGr
-00009e20: 6f75 702e 6772 6f75 705f 6e65 7374 6564  oup.group_nested
-00009e30: 5f73 6962 6c69 6e67 7328 6874 6d6c 5f65  _siblings(html_e
-00009e40: 6c65 6d2c 2073 7479 6c65 733d 4e6f 6e65  lem, styles=None
-00009e50: 290a 2020 2020 2020 2020 4874 6d6c 4c69  ).        HtmlLi
-00009e60: 622e 7772 6974 655f 6874 6d6c 5f66 696c  b.write_html_fil
-00009e70: 6528 6874 6d6c 5f65 6c65 6d2c 206f 7574  e(html_elem, out
-00009e80: 6669 6c65 2c20 6465 6275 673d 5472 7565  file, debug=True
-00009e90: 290a 0a20 2020 2040 636c 6173 736d 6574  )..    @classmet
-00009ea0: 686f 640a 2020 2020 6465 6620 7370 6c69  hod.    def spli
-00009eb0: 745f 7370 616e 7328 636c 732c 2068 746d  t_spans(cls, htm
-00009ec0: 6c2c 2073 706c 6974 5f73 7061 6e5f 7265  l, split_span_re
-00009ed0: 6765 7829 3a0a 2020 2020 2020 2020 7265  gex):.        re
-00009ee0: 5f73 706c 6974 203d 2072 652e 636f 6d70  _split = re.comp
-00009ef0: 696c 6528 7370 6c69 745f 7370 616e 5f72  ile(split_span_r
-00009f00: 6567 6578 290a 2020 2020 2020 2020 7370  egex).        sp
-00009f10: 616e 7320 3d20 6874 6d6c 2e78 7061 7468  ans = html.xpath
-00009f20: 2822 2f2f 7370 616e 2229 0a20 2020 2020  ("//span").     
-00009f30: 2020 206e 7370 616e 7320 3d20 6c65 6e28     nspans = len(
-00009f40: 7370 616e 7329 0a0a 2020 2020 2020 2020  spans)..        
-00009f50: 636c 732e 7363 616e 5f72 656d 6169 6e69  cls.scan_remaini
-00009f60: 6e67 5f73 7061 6e73 2872 655f 7370 6c69  ng_spans(re_spli
-00009f70: 742c 2073 7061 6e73 290a 0a20 2020 2040  t, spans)..    @
-00009f80: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-00009f90: 6465 6620 7363 616e 5f72 656d 6169 6e69  def scan_remaini
-00009fa0: 6e67 5f73 7061 6e73 2863 6c73 2c20 7265  ng_spans(cls, re
-00009fb0: 5f73 706c 6974 2c20 7370 616e 7329 3a0a  _split, spans):.
-00009fc0: 2020 2020 2020 2020 6469 7620 3d20 4e6f          div = No
-00009fd0: 6e65 0a20 2020 2020 2020 2077 6869 6c65  ne.        while
-00009fe0: 206c 656e 2873 7061 6e73 2920 3e20 303a   len(spans) > 0:
-00009ff0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0000a000: 2069 2c20 7370 616e 2069 6e20 656e 756d   i, span in enum
-0000a010: 6572 6174 6528 7370 616e 7329 3a0a 2020  erate(spans):.  
-0000a020: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000a030: 2064 6976 2069 7320 6e6f 7420 4e6f 6e65   div is not None
-0000a040: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000a050: 2020 2020 2020 6469 762e 6170 7065 6e64        div.append
-0000a060: 2873 7061 6e29 0a20 2020 2020 2020 2020  (span).         
-0000a070: 2020 2020 2020 206d 6174 6368 203d 2072         match = r
-0000a080: 655f 7370 6c69 742e 6d61 7463 6828 7370  e_split.match(sp
-0000a090: 616e 2e74 6578 7429 0a20 2020 2020 2020  an.text).       
-0000a0a0: 2020 2020 2020 2020 2069 6620 6d61 7463           if matc
-0000a0b0: 683a 0a20 2020 2020 2020 2020 2020 2020  h:.             
-0000a0c0: 2020 2020 2020 2070 7265 203d 206d 6174         pre = mat
-0000a0d0: 6368 2e67 726f 7570 2822 7072 6522 290a  ch.group("pre").
-0000a0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a0f0: 2020 2020 706f 7374 203d 206d 6174 6368      post = match
-0000a100: 2e67 726f 7570 2822 706f 7374 2229 0a20  .group("post"). 
-0000a110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a120: 2020 2073 7061 6e2e 7465 7874 203d 2070     span.text = p
-0000a130: 7265 0a20 2020 2020 2020 2020 2020 2020  re.             
-0000a140: 2020 2020 2020 2070 6172 656e 745f 6469         parent_di
-0000a150: 7620 3d20 7370 616e 2e67 6574 7061 7265  v = span.getpare
-0000a160: 6e74 2829 0a20 2020 2020 2020 2020 2020  nt().           
-0000a170: 2020 2020 2020 2020 206e 6578 745f 7370           next_sp
-0000a180: 616e 203d 2045 542e 5375 6245 6c65 6d65  an = ET.SubEleme
-0000a190: 6e74 2870 6172 656e 745f 6469 762c 2022  nt(parent_div, "
-0000a1a0: 7370 616e 2229 0a20 2020 2020 2020 2020  span").         
-0000a1b0: 2020 2020 2020 2020 2020 2066 6f72 2061             for a
-0000a1c0: 7474 2069 6e20 7370 616e 2e61 7474 7269  tt in span.attri
-0000a1d0: 623a 0a20 2020 2020 2020 2020 2020 2020  b:.             
-0000a1e0: 2020 2020 2020 2020 2020 206e 6578 745f             next_
-0000a1f0: 7370 616e 2e61 7474 7269 625b 6174 745b  span.attrib[att[
-0000a200: 305d 5d20 3d20 6174 745b 315d 0a20 2020  0]] = att[1].   
-0000a210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a220: 2020 2020 2073 7061 6e2e 6164 646e 6578       span.addnex
-0000a230: 7428 6e65 7874 5f73 7061 6e29 0a20 2020  t(next_span).   
-0000a240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a250: 2073 7061 6e73 203d 2073 7061 6e73 5b69   spans = spans[i
-0000a260: 202b 2031 3a5d 0a20 2020 2020 2020 2020   + 1:].         
-0000a270: 2020 2020 2020 2020 2020 2064 6976 203d             div =
-0000a280: 2045 542e 5375 6245 6c65 6d65 6e74 2870   ET.SubElement(p
-0000a290: 6172 656e 745f 6469 762e 6765 7470 6172  arent_div.getpar
-0000a2a0: 656e 7428 292c 2022 6469 7622 290a 0a20  ent(), "div").. 
-0000a2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a2c0: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
-0000a2d0: 2020 2020 2020 2020 2069 6620 6920 3d3d           if i ==
-0000a2e0: 206c 656e 2873 7061 6e73 2920 2d20 313a   len(spans) - 1:
-0000a2f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a300: 2020 2020 2073 7061 6e73 203d 205b 5d0a       spans = [].
-0000a310: 0a0a 636c 6173 7320 4874 6d6c 5574 696c  ..class HtmlUtil
-0000a320: 3a0a 2020 2020 5343 5249 5054 5f46 4143  :.    SCRIPT_FAC
-0000a330: 5420 3d20 302e 3920 2023 206d 6179 6265  T = 0.9  # maybe
-0000a340: 2073 686f 6c64 6e27 7420 6265 2068 6572   sholdn't be her
-0000a350: 653b 2061 766f 6964 2063 6972 6375 6c61  e; avoid circula
-0000a360: 720a 2020 2020 4d41 524b 4552 203d 2022  r.    MARKER = "
-0000a370: 6d61 726b 6572 220a 0a20 2020 2040 636c  marker"..    @cl
-0000a380: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-0000a390: 6620 7265 6d6f 7665 5f65 6d70 7479 5f65  f remove_empty_e
-0000a3a0: 6c65 6d65 6e74 7328 636c 732c 2065 6c65  lements(cls, ele
-0000a3b0: 6d2c 2074 6167 293a 0a20 2020 2020 2020  m, tag):.       
-0000a3c0: 2022 2222 0a20 2020 2020 2020 204d 6179   """.        May
-0000a3d0: 6265 206d 6f76 6520 746f 2048 544d 4c54  be move to HTMLT
-0000a3e0: 6964 790a 2020 2020 2020 2020 2222 220a  idy.        """.
-0000a3f0: 2020 2020 2020 2020 6966 2074 6167 3a0a          if tag:.
-0000a400: 2020 2020 2020 2020 2020 2020 6966 2074              if t
-0000a410: 7970 6528 7461 6729 2069 7320 6c69 7374  ype(tag) is list
-0000a420: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000a430: 2020 666f 7220 7420 696e 2074 6167 3a0a    for t in tag:.
-0000a440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a450: 2020 2020 636c 732e 7265 6d6f 7665 5f65      cls.remove_e
-0000a460: 6d70 7479 5f65 6c65 6d65 6e74 7328 656c  mpty_elements(el
-0000a470: 656d 2c20 7429 0a20 2020 2020 2020 2020  em, t).         
-0000a480: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000a490: 2020 2020 2020 2020 2078 7020 3d20 6622           xp = f"
-0000a4a0: 2e2f 2f7b 7461 677d 5b6e 6f72 6d61 6c69  .//{tag}[normali
-0000a4b0: 7a65 2d73 7061 6365 282e 293d 2727 2061  ze-space(.)='' a
-0000a4c0: 6e64 2063 6f75 6e74 287b 7461 677d 2f2a  nd count({tag}/*
-0000a4d0: 2920 3d20 305d 220a 2020 2020 2020 2020  ) = 0]".        
-0000a4e0: 2020 2020 2020 2020 656c 656d 7320 3d20          elems = 
-0000a4f0: 656c 656d 2e78 7061 7468 2878 7029 0a20  elem.xpath(xp). 
-0000a500: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000a510: 6f72 2065 6c20 696e 2065 6c65 6d73 3a0a  or el in elems:.
-0000a520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a530: 2020 2020 636c 732e 7265 6d6f 7665 5f65      cls.remove_e
-0000a540: 6c65 6d5f 6b65 6570 5f74 6169 6c28 656c  lem_keep_tail(el
-0000a550: 290a 0a20 2020 2040 636c 6173 736d 6574  )..    @classmet
-0000a560: 686f 640a 2020 2020 6465 6620 7265 6d6f  hod.    def remo
-0000a570: 7665 5f65 6c65 6d5f 6b65 6570 5f74 6169  ve_elem_keep_tai
-0000a580: 6c28 636c 732c 2065 6c29 3a0a 2020 2020  l(cls, el):.    
-0000a590: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000a5a0: 4d61 7962 6520 6d6f 7665 2074 6f20 4854  Maybe move to HT
-0000a5b0: 4d4c 5469 6479 0a20 2020 2020 2020 2022  MLTidy.        "
-0000a5c0: 2222 0a20 2020 2020 2020 2070 6172 656e  "".        paren
-0000a5d0: 7420 3d20 656c 2e67 6574 7061 7265 6e74  t = el.getparent
-0000a5e0: 2829 0a20 2020 2020 2020 2074 6169 6c20  ().        tail 
-0000a5f0: 3d20 656c 2e74 6169 6c0a 2020 2020 2020  = el.tail.      
-0000a600: 2020 6966 2074 6169 6c20 6973 206e 6f74    if tail is not
-0000a610: 204e 6f6e 6520 616e 6420 6c65 6e28 7461   None and len(ta
-0000a620: 696c 2e73 7472 6970 2829 2920 3e20 303a  il.strip()) > 0:
-0000a630: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
-0000a640: 7620 3d20 656c 2e67 6574 7072 6576 696f  v = el.getprevio
-0000a650: 7573 2829 0a20 2020 2020 2020 2020 2020  us().           
-0000a660: 2069 6620 7072 6576 2069 7320 6e6f 7420   if prev is not 
-0000a670: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0000a680: 2020 2020 2020 7072 6576 2e74 6169 6c20        prev.tail 
-0000a690: 3d20 2870 7265 762e 7461 696c 206f 7220  = (prev.tail or 
-0000a6a0: 2727 2920 2b20 656c 2e74 6169 6c0a 2020  '') + el.tail.  
-0000a6b0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0000a6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a6d0: 7061 7265 6e74 2e74 6578 7420 3d20 2870  parent.text = (p
-0000a6e0: 6172 656e 742e 7465 7874 206f 7220 2727  arent.text or ''
-0000a6f0: 2920 2b20 656c 2e74 6169 6c0a 0a20 2020  ) + el.tail..   
-0000a700: 2020 2020 2070 6172 656e 742e 7265 6d6f       parent.remo
-0000a710: 7665 2865 6c29 0a0a 2020 2020 4063 6c61  ve(el)..    @cla
-0000a720: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-0000a730: 2073 706c 6974 5f73 7061 6e5f 6174 5f6d   split_span_at_m
-0000a740: 6174 6368 2863 6c73 2c20 656c 656d 782c  atch(cls, elemx,
-0000a750: 2072 6567 6578 2c20 636f 7079 5f61 7474   regex, copy_att
-0000a760: 733d 5472 7565 2c20 7265 6375 7273 653d  s=True, recurse=
-0000a770: 5472 7565 2c20 6964 5f72 6f6f 743d 4e6f  True, id_root=No
-0000a780: 6e65 2c20 6964 5f63 6f75 6e74 6572 3d30  ne, id_counter=0
-0000a790: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000a7a0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-0000a7b0: 775f 7461 6773 3d4e 6f6e 6529 3a0a 2020  w_tags=None):.  
-0000a7c0: 2020 2020 2020 2222 2273 706c 6974 7320        """splits 
-0000a7d0: 616e 2065 6c65 6d20 286e 6f72 6d61 6c6c  an elem (normall
-0000a7e0: 7920 7370 616e 2920 696e 746f 2033 2063  y span) into 3 c
-0000a7f0: 6f6d 706f 6e65 6e74 7320 6279 2072 6567  omponents by reg
-0000a800: 6578 206d 6174 6368 0a20 2020 2020 2020  ex match.       
-0000a810: 203a 7061 7261 6d20 656c 656d 783a 2065   :param elemx: e
-0000a820: 6c65 6d20 746f 2073 706c 6974 2028 6e6f  lem to split (no
-0000a830: 726d 616c 6c79 2068 6173 2061 2070 6172  rmally has a par
-0000a840: 656e 7420 2865 2e67 2e20 6469 7629 0a20  ent (e.g. div). 
-0000a850: 2020 2020 2020 203a 7061 7261 6d20 7265         :param re
-0000a860: 6765 783a 2072 6567 6578 2074 6f20 7370  gex: regex to sp
-0000a870: 6c69 7420 656c 656d 2028 6f66 2066 6f72  lit elem (of for
-0000a880: 6d20 2870 7265 2928 6d61 7463 6829 2870  m (pre)(match)(p
-0000a890: 6f73 7429 0a20 2020 2020 2020 203a 7061  ost).        :pa
-0000a8a0: 7261 6d20 636f 7079 5f61 7474 733a 2069  ram copy_atts: i
-0000a8b0: 6620 5472 7565 2063 6f70 7920 6174 7473  f True copy atts
-0000a8c0: 2066 726f 6d20 656c 656d 0a20 2020 2020   from elem.     
-0000a8d0: 2020 203a 7061 7261 6d20 7265 6375 7273     :param recurs
-0000a8e0: 653a 2069 6620 5472 7565 2c20 7265 7365  e: if True, rese
-0000a8f0: 7473 2065 6c65 6d20 746f 2074 7261 696c  ts elem to trail
-0000a900: 696e 6720 656c 656d 2061 6e64 2072 6561  ing elem and rea
-0000a910: 6e6c 7973 6573 2075 6e74 696c 206e 6f20  nlyses until no 
-0000a920: 6d6f 7265 206d 6174 6368 0a20 2020 2020  more match.     
-0000a930: 2020 203a 7061 7261 6d20 6964 5f72 6f6f     :param id_roo
-0000a940: 743a 2061 7574 6f2d 6765 6e65 7261 7465  t: auto-generate
-0000a950: 2069 6473 2062 7569 6c64 696e 6720 6f6e   ids building on
-0000a960: 2069 645f 726f 6f74 0a20 2020 2020 2020   id_root.       
-0000a970: 203a 7061 7261 6d20 6964 5f63 6f75 6e74   :param id_count
-0000a980: 6572 3a20 636f 756e 7465 7220 666f 7220  er: counter for 
-0000a990: 6964 730a 2020 2020 2020 2020 3a70 6172  ids.        :par
-0000a9a0: 616d 206e 6577 5f74 6167 733a 206e 6577  am new_tags: new
-0000a9b0: 5f65 6c65 6d65 6e74 2074 6167 7320 2864  _element tags (d
-0000a9c0: 6566 6175 6c74 2073 7061 6e2c 2073 7061  efault span, spa
-0000a9d0: 6e2c 2073 7061 6e29 0a20 2020 2020 2020  n, span).       
-0000a9e0: 203a 7265 7475 726e 3a20 6c69 7374 206f   :return: list o
-0000a9f0: 6620 3320 656c 656d 733b 2069 6620 6e65  f 3 elems; if ne
-0000aa00: 775f 656c 656d 735b 325d 2069 7320 6e6f  w_elems[2] is no
-0000aa10: 7420 4e6f 6e65 2069 7427 7320 6176 6169  t None it's avai
-0000aa20: 6c61 626c 6520 666f 7220 7265 6375 7273  lable for recurs
-0000aa30: 696f 6e29 0a20 2020 2020 2020 2022 2222  ion).        """
-0000aa40: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0000aa50: 6e65 775f 7461 6773 3a0a 2020 2020 2020  new_tags:.      
-0000aa60: 2020 2020 2020 6e65 775f 7461 6773 203d        new_tags =
-0000aa70: 205b 485f 5350 414e 2c20 485f 5350 414e   [H_SPAN, H_SPAN
-0000aa80: 2c20 485f 5350 414e 5d0a 2020 2020 2020  , H_SPAN].      
-0000aa90: 2020 6173 7365 7274 2065 6c65 6d78 2069    assert elemx i
-0000aaa0: 7320 6e6f 7420 4e6f 6e65 0a20 2020 2020  s not None.     
-0000aab0: 2020 2074 6578 7478 203d 2048 746d 6c55     textx = HtmlU
-0000aac0: 7469 6c2e 6765 745f 7465 7874 5f63 6f6e  til.get_text_con
-0000aad0: 7465 6e74 2865 6c65 6d78 290a 2020 2020  tent(elemx).    
-0000aae0: 2020 2020 7265 6320 3d20 7265 2e63 6f6d      rec = re.com
-0000aaf0: 7069 6c65 2872 6567 6578 290a 2020 2020  pile(regex).    
-0000ab00: 2020 2020 6d61 7463 6820 3d20 7265 632e      match = rec.
-0000ab10: 6d61 7463 6828 7465 7874 7829 0a20 2020  match(textx).   
-0000ab20: 2020 2020 206e 6577 5f65 6c65 6d73 203d       new_elems =
-0000ab30: 205b 4e6f 6e65 2c20 4e6f 6e65 2c20 4e6f   [None, None, No
-0000ab40: 6e65 5d0a 2020 2020 2020 2020 6966 206d  ne].        if m
-0000ab50: 6174 6368 3a0a 2020 2020 2020 2020 2020  atch:.          
-0000ab60: 2020 7061 7265 6e74 203d 2065 6c65 6d78    parent = elemx
-0000ab70: 2e67 6574 7061 7265 6e74 2829 0a20 2020  .getparent().   
-0000ab80: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-0000ab90: 6d61 7463 682e 6772 6f75 7073 2829 2920  match.groups()) 
-0000aba0: 213d 2033 3a20 2023 2073 6f6d 6520 6d61  != 3:  # some ma
-0000abb0: 7920 6265 2065 6d70 7479 2073 7472 696e  y be empty strin
-0000abc0: 6773 0a20 2020 2020 2020 2020 2020 2020  gs.             
-0000abd0: 2020 206c 6f67 6769 6e67 2e77 6172 6e69     logging.warni
-0000abe0: 6e67 2866 2243 616e 6e6f 7420 6d61 7463  ng(f"Cannot matc
-0000abf0: 6820 7b74 6578 7478 7d20 6167 6169 6e73  h {textx} agains
-0000ac00: 7420 7b72 6567 6578 7d22 290a 2020 2020  t {regex}").    
-0000ac10: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000ac20: 726e 206e 6577 5f65 6c65 6d73 2c20 6964  rn new_elems, id
-0000ac30: 5f63 6f75 6e74 6572 0a20 2020 2020 2020  _counter.       
-0000ac40: 2020 2020 2067 726f 7570 3120 3d20 6d61       group1 = ma
-0000ac50: 7463 682e 6772 6f75 7028 3129 0a20 2020  tch.group(1).   
-0000ac60: 2020 2020 2020 2020 2069 6620 6772 6f75           if grou
-0000ac70: 7031 2021 3d20 2222 3a20 2023 2064 6f6e  p1 != "":  # don
-0000ac80: 2774 2061 6464 2065 6d70 7479 2073 7472  't add empty str
-0000ac90: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
-0000aca0: 2020 2020 656c 656d 7820 3d20 4874 6d6c      elemx = Html
-0000acb0: 5574 696c 2e61 6464 5f73 6962 6c69 6e67  Util.add_sibling
-0000acc0: 5f61 6674 6572 2865 6c65 6d78 2c20 6e65  _after(elemx, ne
-0000acd0: 775f 7461 6773 5b30 5d2c 2072 6570 6c61  w_tags[0], repla
-0000ace0: 6365 3d54 7275 652c 2063 6f70 795f 6174  ce=True, copy_at
-0000acf0: 7473 3d63 6f70 795f 6174 7473 2c0a 2020  ts=copy_atts,.  
-0000ad00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad30: 2074 6578 743d 6772 6f75 7031 290a 2020   text=group1).  
-0000ad40: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-0000ad50: 775f 656c 656d 735b 305d 203d 2065 6c65  w_elems[0] = ele
-0000ad60: 6d78 0a20 2020 2020 2020 2020 2020 2020  mx.             
-0000ad70: 2020 206e 6577 5f65 6c65 6d73 5b30 5d2e     new_elems[0].
-0000ad80: 6174 7472 6962 5b41 5f43 4c41 5353 5d20  attrib[A_CLASS] 
-0000ad90: 3d20 2272 655f 7072 6566 220a 2020 2020  = "re_pref".    
-0000ada0: 2020 2020 2020 2020 2020 2020 6964 5f63              id_c
-0000adb0: 6f75 6e74 6572 203d 2063 6c73 2e61 6464  ounter = cls.add
-0000adc0: 5f69 645f 696e 6372 656d 656e 745f 636f  _id_increment_co
-0000add0: 756e 7465 7228 6964 5f63 6f75 6e74 6572  unter(id_counter
-0000ade0: 2c20 6964 5f72 6f6f 742c 2065 6c65 6d78  , id_root, elemx
-0000adf0: 290a 2020 2020 2020 2020 2020 2020 6e65  ).            ne
-0000ae00: 775f 656c 656d 735b 315d 203d 2048 746d  w_elems[1] = Htm
-0000ae10: 6c55 7469 6c2e 6164 645f 7369 626c 696e  lUtil.add_siblin
-0000ae20: 675f 6166 7465 7228 656c 656d 782c 206e  g_after(elemx, n
-0000ae30: 6577 5f74 6167 735b 315d 2c20 636f 7079  ew_tags[1], copy
-0000ae40: 5f61 7474 733d 636f 7079 5f61 7474 732c  _atts=copy_atts,
-0000ae50: 2074 6578 743d 6d61 7463 682e 6772 6f75   text=match.grou
-0000ae60: 7028 3229 290a 2020 2020 2020 2020 2020  p(2)).          
-0000ae70: 2020 6e65 775f 656c 656d 735b 315d 2e61    new_elems[1].a
-0000ae80: 7474 7269 625b 415f 434c 4153 535d 203d  ttrib[A_CLASS] =
-0000ae90: 2022 7265 5f6d 6174 6368 220a 2020 2020   "re_match".    
-0000aea0: 2020 2020 2020 2020 6964 5f63 6f75 6e74          id_count
-0000aeb0: 6572 203d 2063 6c73 2e61 6464 5f69 645f  er = cls.add_id_
-0000aec0: 696e 6372 656d 656e 745f 636f 756e 7465  increment_counte
-0000aed0: 7228 6964 5f63 6f75 6e74 6572 2c20 6964  r(id_counter, id
-0000aee0: 5f72 6f6f 742c 206e 6577 5f65 6c65 6d73  _root, new_elems
-0000aef0: 5b31 5d29 0a20 2020 2020 2020 2020 2020  [1]).           
-0000af00: 2069 6620 6d61 7463 682e 6772 6f75 7028   if match.group(
-0000af10: 3329 2021 3d20 2222 3a20 2023 2064 6f6e  3) != "":  # don
-0000af20: 2774 2061 6464 2065 6d70 7479 2073 7472  't add empty str
-0000af30: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
-0000af40: 2020 2020 6e65 775f 656c 656d 735b 325d      new_elems[2]
-0000af50: 203d 2048 746d 6c55 7469 6c2e 6164 645f   = HtmlUtil.add_
-0000af60: 7369 626c 696e 675f 6166 7465 7228 6e65  sibling_after(ne
-0000af70: 775f 656c 656d 735b 315d 2c20 6e65 775f  w_elems[1], new_
-0000af80: 7461 6773 5b32 5d2c 2063 6f70 795f 6174  tags[2], copy_at
-0000af90: 7473 3d63 6f70 795f 6174 7473 2c0a 2020  ts=copy_atts,.  
-0000afa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000afb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000afc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000afd0: 2020 2020 2020 2020 7465 7874 3d6d 6174          text=mat
-0000afe0: 6368 2e67 726f 7570 2833 2929 0a20 2020  ch.group(3)).   
-0000aff0: 2020 2020 2020 2020 2020 2020 206e 6577               new
-0000b000: 5f65 6c65 6d73 5b32 5d2e 6174 7472 6962  _elems[2].attrib
-0000b010: 5b41 5f43 4c41 5353 5d20 3d20 2272 655f  [A_CLASS] = "re_
-0000b020: 706f 7374 220a 0a20 2020 2020 2020 2020  post"..         
-0000b030: 2020 2020 2020 2069 645f 636f 756e 7465         id_counte
-0000b040: 7220 3d20 636c 732e 6164 645f 6964 5f69  r = cls.add_id_i
-0000b050: 6e63 7265 6d65 6e74 5f63 6f75 6e74 6572  ncrement_counter
-0000b060: 2869 645f 636f 756e 7465 722c 2069 645f  (id_counter, id_
-0000b070: 726f 6f74 2c20 6e65 775f 656c 656d 735b  root, new_elems[
-0000b080: 325d 290a 2020 2020 2020 2020 2020 2020  2]).            
-0000b090: 2020 2020 6966 2072 6563 7572 7365 3a0a      if recurse:.
-0000b0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b0b0: 2020 2020 5f2c 2069 645f 636f 756e 7465      _, id_counte
-0000b0c0: 7220 3d20 4874 6d6c 5574 696c 2e73 706c  r = HtmlUtil.spl
-0000b0d0: 6974 5f73 7061 6e5f 6174 5f6d 6174 6368  it_span_at_match
-0000b0e0: 286e 6577 5f65 6c65 6d73 5b32 5d2c 2072  (new_elems[2], r
-0000b0f0: 6567 6578 2c20 636f 7079 5f61 7474 733d  egex, copy_atts=
-0000b100: 636f 7079 5f61 7474 732c 0a20 2020 2020  copy_atts,.     
-0000b110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b140: 2020 2020 2020 2020 2020 2020 7265 6375              recu
-0000b150: 7273 653d 7265 6375 7273 652c 2069 645f  rse=recurse, id_
-0000b160: 726f 6f74 3d69 645f 726f 6f74 2c0a 2020  root=id_root,.  
-0000b170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b1a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000b1b0: 645f 636f 756e 7465 723d 6964 5f63 6f75  d_counter=id_cou
-0000b1c0: 6e74 6572 290a 2020 2020 2020 2020 7265  nter).        re
-0000b1d0: 7475 726e 206e 6577 5f65 6c65 6d73 2c20  turn new_elems, 
-0000b1e0: 6964 5f63 6f75 6e74 6572 0a0a 2020 2020  id_counter..    
-0000b1f0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-0000b200: 2064 6566 2061 6464 5f69 645f 696e 6372   def add_id_incr
-0000b210: 656d 656e 745f 636f 756e 7465 7228 636c  ement_counter(cl
-0000b220: 732c 2069 645f 636f 756e 7465 722c 2069  s, id_counter, i
-0000b230: 645f 726f 6f74 2c20 6874 6d6c 5f65 6c65  d_root, html_ele
-0000b240: 6d29 3a0a 2020 2020 2020 2020 6966 2069  m):.        if i
-0000b250: 645f 726f 6f74 3a0a 2020 2020 2020 2020  d_root:.        
-0000b260: 2020 2020 6874 6d6c 5f65 6c65 6d2e 6174      html_elem.at
-0000b270: 7472 6962 5b41 5f49 445d 203d 2069 645f  trib[A_ID] = id_
-0000b280: 726f 6f74 202b 2073 7472 2869 645f 636f  root + str(id_co
-0000b290: 756e 7465 7229 0a20 2020 2020 2020 2020  unter).         
-0000b2a0: 2020 2069 645f 636f 756e 7465 7220 2b3d     id_counter +=
-0000b2b0: 2031 0a20 2020 2020 2020 2072 6574 7572   1.        retur
-0000b2c0: 6e20 6964 5f63 6f75 6e74 6572 0a0a 2020  n id_counter..  
-0000b2d0: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-0000b2e0: 2020 2064 6566 2061 6464 5f73 6962 6c69     def add_sibli
-0000b2f0: 6e67 5f61 6674 6572 2863 6c73 2c20 616e  ng_after(cls, an
-0000b300: 6368 6f72 5f65 6c65 6d2c 2074 6167 2c20  chor_elem, tag, 
-0000b310: 7265 706c 6163 653d 4661 6c73 652c 2063  replace=False, c
-0000b320: 6f70 795f 6174 7473 3d46 616c 7365 2c20  opy_atts=False, 
-0000b330: 7465 7874 3d4e 6f6e 6529 3a0a 2020 2020  text=None):.    
-0000b340: 2020 2020 2222 2261 6464 7320 6e65 7720      """adds new 
-0000b350: 7472 6169 6c69 6e67 2073 6962 6c69 6e67  trailing sibling
-0000b360: 206f 6620 616e 6368 6f72 5f65 6c65 6d20   of anchor_elem 
-0000b370: 7769 7468 2074 6167 0a20 2020 2020 2020  with tag.       
-0000b380: 203a 7061 7261 6d20 7461 673a 2074 6167   :param tag: tag
-0000b390: 2066 6f72 206e 6577 2065 6c65 6d65 6e74   for new element
-0000b3a0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0000b3b0: 616e 6368 6f72 5f65 6c65 6d3a 2072 6566  anchor_elem: ref
-0000b3c0: 6572 656e 6365 2065 6c65 6d65 6e74 2c20  erence element, 
-0000b3d0: 6d75 7374 2068 6176 6520 6120 7061 7265  must have a pare
-0000b3e0: 6e74 0a20 2020 2020 2020 203a 7061 7261  nt.        :para
-0000b3f0: 6d20 7265 706c 6163 653a 2069 6620 5472  m replace: if Tr
-0000b400: 7565 2c20 7265 6d6f 7665 2061 6e63 686f  ue, remove ancho
-0000b410: 7220 656c 656d 656e 740a 2020 2020 2020  r element.      
-0000b420: 2020 3a70 6172 616d 2063 6f70 795f 6174    :param copy_at
-0000b430: 7473 3a20 636f 7079 2061 7474 7269 6275  ts: copy attribu
-0000b440: 7465 7320 6672 6f6d 2061 6e63 686f 720a  tes from anchor.
-0000b450: 2020 2020 2020 2020 3a70 6172 616d 2074          :param t
-0000b460: 6578 743a 2069 6620 6e6f 7420 4e6f 6e65  ext: if not None
-0000b470: 2061 6464 2074 6578 7420 746f 206e 6577   add text to new
-0000b480: 2065 6c65 6d65 6e74 0a20 2020 2020 2020   element.       
-0000b490: 203a 7265 7475 726e 3a20 6e65 7720 7369   :return: new si
-0000b4a0: 626c 696e 6720 7769 7468 206f 7074 696f  bling with optio
-0000b4b0: 6e61 6c20 6179 7974 7269 6275 7465 7320  nal ayytributes 
-0000b4c0: 616e 6420 7465 7874 0a0a 0a0a 2020 2020  and text....    
-0000b4d0: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-0000b4e0: 2061 7373 6572 7420 616e 6368 6f72 5f65   assert anchor_e
-0000b4f0: 6c65 6d20 6973 206e 6f74 204e 6f6e 650a  lem is not None.
-0000b500: 2020 2020 2020 2020 6173 7365 7274 2074          assert t
-0000b510: 6167 0a20 2020 2020 2020 2070 6172 656e  ag.        paren
-0000b520: 7420 3d20 616e 6368 6f72 5f65 6c65 6d2e  t = anchor_elem.
-0000b530: 6765 7470 6172 656e 7428 290a 2020 2020  getparent().    
-0000b540: 2020 2020 6173 7365 7274 2070 6172 656e      assert paren
-0000b550: 7420 6973 206e 6f74 204e 6f6e 652c 2066  t is not None, f
-0000b560: 224e 6f20 7061 7265 6e74 2066 6f72 2061  "No parent for a
-0000b570: 6e63 686f 725f 656c 656d 220a 2020 2020  nchor_elem".    
-0000b580: 2020 2020 7369 626c 696e 6720 3d20 4554      sibling = ET
-0000b590: 2e53 7562 456c 656d 656e 7428 7061 7265  .SubElement(pare
-0000b5a0: 6e74 2c20 7461 6729 0a20 2020 2020 2020  nt, tag).       
-0000b5b0: 2069 6620 636f 7079 5f61 7474 733a 0a20   if copy_atts:. 
-0000b5c0: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
-0000b5d0: 2c20 7620 696e 2061 6e63 686f 725f 656c  , v in anchor_el
-0000b5e0: 656d 2e61 7474 7269 622e 6974 656d 7328  em.attrib.items(
-0000b5f0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000b600: 2020 2073 6962 6c69 6e67 2e61 7474 7269     sibling.attri
-0000b610: 625b 6b5d 203d 2076 0a20 2020 2020 2020  b[k] = v.       
-0000b620: 2061 6e63 686f 725f 656c 656d 2e61 6464   anchor_elem.add
-0000b630: 6e65 7874 2873 6962 6c69 6e67 290a 2020  next(sibling).  
-0000b640: 2020 2020 2020 6966 2074 6578 743a 0a20        if text:. 
-0000b650: 2020 2020 2020 2020 2020 2073 6962 6c69             sibli
-0000b660: 6e67 2e74 6578 7420 3d20 7465 7874 0a20  ng.text = text. 
-0000b670: 2020 2020 2020 2069 6620 7265 706c 6163         if replac
-0000b680: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
-0000b690: 6172 656e 742e 7265 6d6f 7665 2861 6e63  arent.remove(anc
-0000b6a0: 686f 725f 656c 656d 290a 2020 2020 2020  hor_elem).      
-0000b6b0: 2020 7265 7475 726e 2073 6962 6c69 6e67    return sibling
-0000b6c0: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-0000b6d0: 6f64 0a20 2020 2064 6566 2063 7265 6174  od.    def creat
-0000b6e0: 655f 6469 765f 7370 616e 2863 6c73 2c20  e_div_span(cls, 
-0000b6f0: 7465 7874 2c20 7374 796c 653d 4e6f 6e65  text, style=None
-0000b700: 293a 0a20 2020 2020 2020 2022 2222 7574  ):.        """ut
-0000b710: 696c 6974 7920 6d65 7468 6f64 2074 6f20  ility method to 
-0000b720: 6372 6561 7465 2061 2064 6976 2f73 7061  create a div/spa
-0000b730: 6e40 7465 7874 2028 7072 6f62 6162 6c79  n@text (probably
-0000b740: 206d 6169 6e6c 7920 666f 7220 7465 7374   mainly for test
-0000b750: 696e 6729 0a20 2020 2020 2020 203a 7061  ing).        :pa
-0000b760: 7261 6d20 7465 7874 3a20 746f 2061 6464  ram text: to add
-0000b770: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
-0000b780: 3a20 7468 6520 6469 7622 2222 0a20 2020  : the div""".   
-0000b790: 2020 2020 2064 6976 203d 2045 542e 456c       div = ET.El
-0000b7a0: 656d 656e 7428 485f 4449 5629 0a20 2020  ement(H_DIV).   
-0000b7b0: 2020 2020 2073 7061 6e20 3d20 4554 2e53       span = ET.S
-0000b7c0: 7562 456c 656d 656e 7428 6469 762c 2048  ubElement(div, H
-0000b7d0: 5f53 5041 4e29 0a20 2020 2020 2020 2069  _SPAN).        i
-0000b7e0: 6620 7374 796c 653a 0a20 2020 2020 2020  f style:.       
-0000b7f0: 2020 2020 2063 7373 5f73 7479 6c65 203d       css_style =
-0000b800: 2043 5353 5374 796c 652e 6372 6561 7465   CSSStyle.create
-0000b810: 5f63 7373 5f73 7479 6c65 5f66 726f 6d5f  _css_style_from_
-0000b820: 6373 735f 7374 7269 6e67 2822 666f 6e74  css_string("font
-0000b830: 2d73 697a 653a 3132 3b20 666f 6e74 2d77  -size:12; font-w
-0000b840: 6569 6768 743a 2062 6f6c 643b 2229 0a20  eight: bold;"). 
-0000b850: 2020 2020 2020 2020 2020 2048 746d 6c53             HtmlS
-0000b860: 7479 6c65 2e73 6574 5f73 7479 6c65 2873  tyle.set_style(s
-0000b870: 7061 6e2c 2063 7373 5f73 7479 6c65 2e67  pan, css_style.g
-0000b880: 6574 5f63 7373 5f76 616c 7565 2829 290a  et_css_value()).
-0000b890: 2020 2020 2020 2020 7370 616e 2e74 6578          span.tex
-0000b8a0: 7420 3d20 7465 7874 0a20 2020 2020 2020  t = text.       
-0000b8b0: 2072 6574 7572 6e20 6469 762c 2073 7061   return div, spa
-0000b8c0: 6e0a 0a20 2020 2040 636c 6173 736d 6574  n..    @classmet
-0000b8d0: 686f 640a 2020 2020 6465 6620 6973 5f73  hod.    def is_s
-0000b8e0: 7562 7363 7269 7074 2863 6c73 2c20 6c61  ubscript(cls, la
-0000b8f0: 7374 5f73 7061 6e2c 2074 6869 735f 7370  st_span, this_sp
-0000b900: 616e 2920 2d3e 2062 6f6f 6c3a 0a20 2020  an) -> bool:.   
-0000b910: 2020 2020 2022 2222 6973 2074 6869 735f       """is this_
-0000b920: 7370 616e 2061 2073 7562 7363 7269 7074  span a subscript
-0000b930: 3f0a 2020 2020 2020 2020 7573 6573 2068  ?.        uses h
-0000b940: 6575 7269 7374 6963 7320 696e 2069 735f  euristics in is_
-0000b950: 7363 7269 7074 5f74 7970 650a 2020 2020  script_type.    
-0000b960: 2020 2020 3a70 6172 616d 206c 6173 745f      :param last_
-0000b970: 7370 616e 3a20 7072 6563 6564 696e 6720  span: preceding 
-0000b980: 7370 616e 2028 6966 204e 6f6e 6520 7265  span (if None re
-0000b990: 7475 726e 7320 4661 6c73 6529 0a20 2020  turns False).   
-0000b9a0: 2020 2020 203a 7061 7261 6d20 7468 6973       :param this
-0000b9b0: 5f73 7061 6e3a 2073 7061 6e20 746f 2074  _span: span to t
-0000b9c0: 6573 740a 2020 2020 2020 2020 3a72 6574  est.        :ret
-0000b9d0: 7572 6e3a 2054 7275 6520 6966 2074 6869  urn: True if thi
-0000b9e0: 7320 7370 616e 2069 7320 736d 616c 6c65  s span is smalle
-0000b9f0: 7220 616e 6420 226c 6f77 6572 2220 7468  r and "lower" th
-0000ba00: 616e 206c 6173 7422 2222 0a20 2020 2020  an last""".     
-0000ba10: 2020 2072 6574 7572 6e20 636c 732e 6973     return cls.is
-0000ba20: 5f73 6372 6970 745f 7479 7065 286c 6173  _script_type(las
-0000ba30: 745f 7370 616e 2c20 7468 6973 5f73 7061  t_span, this_spa
-0000ba40: 6e2c 2073 6372 6970 745f 7479 7065 3d53  n, script_type=S
-0000ba50: 5363 7269 7074 2e53 5542 290a 0a20 2020  Script.SUB)..   
-0000ba60: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-0000ba70: 2020 6465 6620 6973 5f73 7570 6572 7363    def is_supersc
-0000ba80: 7269 7074 2863 6c73 2c20 6c61 7374 5f73  ript(cls, last_s
-0000ba90: 7061 6e2c 2074 6869 735f 7370 616e 2920  pan, this_span) 
-0000baa0: 2d3e 2062 6f6f 6c3a 0a20 2020 2020 2020  -> bool:.       
-0000bab0: 2022 2222 6973 2074 6869 735f 7370 616e   """is this_span
-0000bac0: 2061 2073 7570 6572 7363 7269 7074 3f0a   a superscript?.
-0000bad0: 2020 2020 2020 2020 7573 6573 2068 6575          uses heu
-0000bae0: 7269 7374 6963 7320 696e 2069 735f 7363  ristics in is_sc
-0000baf0: 7269 7074 5f74 7970 650a 2020 2020 2020  ript_type.      
-0000bb00: 2020 3a70 6172 616d 206c 6173 745f 7370    :param last_sp
-0000bb10: 616e 3a20 7072 6563 6564 696e 6720 7370  an: preceding sp
-0000bb20: 616e 2028 6966 204e 6f6e 6520 7265 7475  an (if None retu
-0000bb30: 726e 7320 4661 6c73 6529 0a20 2020 2020  rns False).     
-0000bb40: 2020 203a 7061 7261 6d20 7468 6973 5f73     :param this_s
-0000bb50: 7061 6e3a 2073 7061 6e20 746f 2074 6573  pan: span to tes
-0000bb60: 740a 2020 2020 2020 2020 3a72 6574 7572  t.        :retur
-0000bb70: 6e3a 2054 7275 6520 6966 2074 6869 7320  n: True if this 
-0000bb80: 7370 616e 2069 7320 736d 616c 6c65 7220  span is smaller 
-0000bb90: 616e 6420 2268 6967 6865 7222 2074 6861  and "higher" tha
-0000bba0: 6e20 6c61 7374 2222 220a 2020 2020 2020  n last""".      
-0000bbb0: 2020 7265 7475 726e 2063 6c73 2e69 735f    return cls.is_
-0000bbc0: 7363 7269 7074 5f74 7970 6528 6c61 7374  script_type(last
-0000bbd0: 5f73 7061 6e2c 2074 6869 735f 7370 616e  _span, this_span
-0000bbe0: 2c20 7363 7269 7074 5f74 7970 653d 5353  , script_type=SS
-0000bbf0: 6372 6970 742e 5355 5029 0a0a 2020 2020  cript.SUP)..    
-0000bc00: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-0000bc10: 2064 6566 2069 735f 7363 7269 7074 5f74   def is_script_t
-0000bc20: 7970 6528 636c 732c 206c 6173 745f 7370  ype(cls, last_sp
-0000bc30: 616e 2c20 7468 6973 5f73 7061 6e2c 2073  an, this_span, s
-0000bc40: 6372 6970 745f 7479 7065 2c20 7964 6f77  cript_type, ydow
-0000bc50: 6e3d 5472 7565 2c20 7072 6563 6564 696e  n=True, precedin
-0000bc60: 673d 4e6f 6e65 2920 2d3e 2062 6f6f 6c3a  g=None) -> bool:
-0000bc70: 0a20 2020 2020 2020 2022 2222 6865 7572  .        """heur
-0000bc80: 6973 7463 2074 6f20 6465 7465 726d 696e  istc to determin
-0000bc90: 6520 7768 6574 6865 7220 7468 6973 5f73  e whether this_s
-0000bca0: 7061 6e20 6973 2061 2073 7562 2f73 7570  pan is a sub/sup
-0000bcb0: 6572 7363 7269 7074 206f 6620 6c61 7374  erscript of last
-0000bcc0: 5f73 7061 6e0a 2020 2020 2020 2020 4e4f  _span.        NO
-0000bcd0: 5445 3a20 4946 2059 2069 7320 444f 574e  TE: IF Y is DOWN
-0000bce0: 2074 6865 2070 6167 652c 2061 2073 7570   the page, a sup
-0000bcf0: 6572 7363 7269 7074 2068 6173 2053 4d41  erscript has SMA
-0000bd00: 4c4c 4552 2079 2d76 616c 7565 2c20 6574  LLER y-value, et
-0000bd10: 632e 2028 6c6f 6769 6320 7265 7665 7273  c. (logic revers
-0000bd20: 6564 2069 6620 6e6f 7420 7964 6f77 6e29  ed if not ydown)
-0000bd30: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0000bd40: 6c61 7374 5f73 7061 6e3a 2069 6620 4e6f  last_span: if No
-0000bd50: 6e65 2c20 7265 7475 726e 7320 6661 6c73  ne, returns fals
-0000bd60: 650a 2020 2020 2020 2020 3a70 6172 616d  e.        :param
-0000bd70: 2074 6869 735f 7370 616e 3a20 6966 206e   this_span: if n
-0000bd80: 6f74 2073 6d61 6c6c 6572 2062 7920 5343  ot smaller by SC
-0000bd90: 5249 5054 5f46 4143 5420 7265 7475 726e  RIPT_FACT return
-0000bda0: 2046 616c 7365 0a20 2020 2020 2020 203a   False.        :
-0000bdb0: 7061 7261 6d20 7363 7269 7074 5f74 7970  param script_typ
-0000bdc0: 653a 2053 5363 7269 7074 2e53 5542 206f  e: SScript.SUB o
-0000bdd0: 7220 5353 6372 6970 742e 5355 500a 2020  r SScript.SUP.  
-0000bde0: 2020 2020 2020 3a70 6172 616d 2079 646f        :param ydo
-0000bdf0: 776e 3a20 5472 7565 2069 6620 7920 696e  wn: True if y in
-0000be00: 6372 6561 7365 7320 646f 776e 2074 6872  creases down thr
-0000be10: 2070 6167 6520 2865 2e67 2e20 5356 4729   page (e.g. SVG)
-0000be20: 2028 4445 4641 554c 5429 2065 6c73 6520   (DEFAULT) else 
-0000be30: 4661 6c73 650a 2020 2020 2020 2020 3a72  False.        :r
-0000be40: 6574 7572 6e3a 2054 7275 6520 6966 2073  eturn: True if s
-0000be50: 6d61 6c6c 6572 2061 6e64 206d 6f76 6564  maller and moved
-0000be60: 2069 6e20 7269 6768 7420 792d 6469 7265   in right y-dire
-0000be70: 6374 696f 6e0a 2020 2020 2020 2020 2222  ction.        ""
-0000be80: 220a 2020 2020 2020 2020 6966 2074 6869  ".        if thi
-0000be90: 735f 7370 616e 2069 7320 4e6f 6e65 3a0a  s_span is None:.
-0000bea0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000beb0: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
-0000bec0: 2023 2074 7279 2074 6f20 6669 6e64 206d   # try to find m
-0000bed0: 6973 7369 6e67 206c 6173 745f 7370 616e  issing last_span
-0000bee0: 0a20 2020 2020 2020 2069 6620 6c61 7374  .        if last
-0000bef0: 5f73 7061 6e20 6973 204e 6f6e 653a 0a20  _span is None:. 
-0000bf00: 2020 2020 2020 2020 2020 206c 6173 745f             last_
-0000bf10: 7370 616e 203d 2074 6869 735f 7370 616e  span = this_span
-0000bf20: 2e78 7061 7468 2866 227b 585f 5052 4543  .xpath(f"{X_PREC
-0000bf30: 4544 494e 477d 3a3a 7b48 5f53 5041 4e7d  EDING}::{H_SPAN}
-0000bf40: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
-0000bf50: 6620 6c65 6e28 6c61 7374 5f73 7061 6e29  f len(last_span)
-0000bf60: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-0000bf70: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-0000bf80: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-0000bf90: 6c61 7374 5f73 7061 6e20 3d20 6c61 7374  last_span = last
-0000bfa0: 5f73 7061 6e5b 305d 0a20 2020 2020 2020  _span[0].       
-0000bfb0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0000bfc0: 2020 6c61 7374 5f66 6f6e 745f 7369 7a65    last_font_size
-0000bfd0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-0000bfe0: 2020 2020 7468 6973 5f66 6f6e 745f 7369      this_font_si
-0000bff0: 7a65 203d 204e 6f6e 650a 2020 2020 2020  ze = None.      
-0000c000: 2020 2020 2020 6c61 7374 5f66 6f6e 745f        last_font_
-0000c010: 7369 7a65 203d 206c 6173 745f 7370 616e  size = last_span
-0000c020: 2e74 6578 745f 7374 796c 652e 5f66 6f6e  .text_style._fon
-0000c030: 745f 7369 7a65 0a20 2020 2020 2020 2020  t_size.         
-0000c040: 2020 2074 6869 735f 666f 6e74 5f73 697a     this_font_siz
-0000c050: 6520 3d20 7468 6973 5f73 7061 6e2e 7465  e = this_span.te
-0000c060: 7874 5f73 7479 6c65 2e5f 666f 6e74 5f73  xt_style._font_s
-0000c070: 697a 650a 2020 2020 2020 2020 6578 6365  ize.        exce
-0000c080: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
-0000c090: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
-0000c0a0: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
-0000c0b0: 2320 6e6f 2066 6f6e 7420 7374 796c 650a  # no font style.
-0000c0c0: 2020 2020 2020 2020 6973 5f73 6372 6970          is_scrip
-0000c0d0: 7420 3d20 636c 732e 6973 5f72 6571 7569  t = cls.is_requi
-0000c0e0: 7265 645f 7363 7269 7074 5f74 7970 6528  red_script_type(
-0000c0f0: 7363 7269 7074 5f74 7970 652c 206c 6173  script_type, las
-0000c100: 745f 666f 6e74 5f73 697a 652c 206c 6173  t_font_size, las
-0000c110: 745f 7370 616e 2c20 7468 6973 5f66 6f6e  t_span, this_fon
-0000c120: 745f 7369 7a65 2c20 7468 6973 5f73 7061  t_size, this_spa
-0000c130: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
-0000c140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c160: 2020 2079 646f 776e 290a 2020 2020 2020     ydown).      
-0000c170: 2020 7265 7475 726e 2069 735f 7363 7269    return is_scri
-0000c180: 7074 0a0a 2020 2020 4063 6c61 7373 6d65  pt..    @classme
-0000c190: 7468 6f64 0a20 2020 2064 6566 2069 735f  thod.    def is_
+000094c0: 2020 2020 2320 7061 7265 6e74 2e72 656d      # parent.rem
+000094d0: 6f76 6528 7370 616e 290a 2020 2020 2020  ove(span).      
+000094e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000094f0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00009500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009510: 2020 2020 7370 616e 7820 3d20 4554 2e53      spanx = ET.S
+00009520: 7562 456c 656d 656e 7428 7061 7265 6e74  ubElement(parent
+00009530: 2c20 2273 7061 6e22 290a 2020 2020 2020  , "span").      
+00009540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009550: 2020 2020 2020 7370 616e 782e 7465 7874        spanx.text
+00009560: 203d 2074 0a20 2020 2020 2020 2020 2020   = t.           
+00009570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009580: 2066 6f72 2061 7474 2069 6e20 7370 616e   for att in span
+00009590: 2e61 7474 7269 623a 0a20 2020 2020 2020  .attrib:.       
+000095a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000095b0: 2020 2020 2020 2020 2073 7061 6e78 2e61           spanx.a
+000095c0: 7474 7269 625b 6174 745d 203d 2073 7061  ttrib[att] = spa
+000095d0: 6e2e 6174 7472 6962 5b61 7474 5d0a 2020  n.attrib[att].  
+000095e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000095f0: 2020 2020 2020 2020 2020 7370 616e 2e61            span.a
+00009600: 6464 7072 6576 696f 7573 2873 7061 6e78  ddprevious(spanx
+00009610: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00009620: 2020 2020 2020 2020 2020 2020 2020 7370                sp
+00009630: 616e 782e 6174 7472 6962 5b22 616e 6368  anx.attrib["anch
+00009640: 6f72 225d 203d 2067 700a 0a20 2020 2020  or"] = gp..     
+00009650: 2020 2020 2020 2020 2020 2070 6172 656e             paren
+00009660: 742e 7265 6d6f 7665 2873 7061 6e29 0a0a  t.remove(span)..
+00009670: 0a0a 0a20 2020 2020 2020 2020 2020 2073  ...            s
+00009680: 7061 6e2e 6174 7472 6962 5b22 636c 6173  pan.attrib["clas
+00009690: 7322 5d20 3d20 5441 5247 4554 530a 0a0a  s"] = TARGETS...
+000096a0: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
+000096b0: 6f64 0a20 2020 2064 6566 2065 7874 7261  od.    def extra
+000096c0: 6374 5f73 6563 7469 6f6e 5f69 6473 2863  ct_section_ids(c
+000096d0: 6c73 2c20 6874 6d6c 5f65 6c65 6d2c 2078  ls, html_elem, x
+000096e0: 7061 7468 733d 4e6f 6e65 2c20 7265 6765  paths=None, rege
+000096f0: 7865 733d 4e6f 6e65 293a 0a20 2020 2020  xes=None):.     
+00009700: 2020 2022 2222 0a20 2020 2020 2020 2065     """.        e
+00009710: 7874 7261 6374 7320 7365 6374 696f 6e73  xtracts sections
+00009720: 2061 6e64 2070 6f73 7369 626c 7920 7375   and possibly su
+00009730: 6273 6563 7469 6f6e 7320 6672 6f6d 2063  bsections from c
+00009740: 6f6d 706f 756e 6420 656c 656d 656e 7473  ompound elements
+00009750: 2028 652e 672e 2064 6976 290a 2020 2020   (e.g. div).    
+00009760: 2020 2020 3a70 6172 616d 2068 746d 6c5f      :param html_
+00009770: 656c 656d 3a20 636f 6d70 6f75 6e64 2065  elem: compound e
+00009780: 6c65 6d65 6e74 0a20 2020 2020 2020 203a  lement.        :
+00009790: 7061 7261 6d20 7870 6174 6873 3a20 6c69  param xpaths: li
+000097a0: 7374 206f 6620 7870 6174 6820 666f 7220  st of xpath for 
+000097b0: 7365 6374 696f 6e2c 206f 7074 696f 6e61  section, optiona
+000097c0: 6c20 7375 6273 6563 7469 6f6e 2c20 6375  l subsection, cu
+000097d0: 7272 656e 746c 7920 6c65 6e20 3120 6f72  rrently len 1 or
+000097e0: 2032 2c0a 2020 2020 2020 2020 2020 7369   2,.          si
+000097f0: 6e67 6c65 2078 7061 7468 2069 7320 7468  ngle xpath is th
+00009800: 656e 2077 7261 7070 6564 2074 6f20 6c69  en wrapped to li
+00009810: 7374 3b20 6465 6661 756c 7473 2074 6f20  st; defaults to 
+00009820: 205b 222e 2f2f 6469 7622 2c20 222e 2f73   [".//div", "./s
+00009830: 7061 6e22 5d0a 2020 2020 2020 2020 3a70  pan"].        :p
+00009840: 6172 616d 2072 6567 6578 6573 3a20 6c69  aram regexes: li
+00009850: 7374 206f 6620 7265 6765 7865 7320 666f  st of regexes fo
+00009860: 7220 6561 6368 2064 6573 6365 6e74 3b20  r each descent; 
+00009870: 7369 6e67 6c65 2069 7320 7772 6170 7065  single is wrappe
+00009880: 6420 746f 206c 6973 7420 3b20 6966 206e  d to list ; if n
+00009890: 6f6e 6520 6769 7665 6e0a 2020 2020 2020  one given.      
+000098a0: 2020 2020 6163 6365 7074 7320 616c 6c20      accepts all 
+000098b0: 6465 7363 656e 6461 6e74 7320 6672 6f6d  descendants from
+000098c0: 2078 7061 7468 0a20 2020 2020 2020 2022   xpath.        "
+000098d0: 2222 0a20 2020 2020 2020 2069 6620 6e6f  "".        if no
+000098e0: 7420 7870 6174 6873 3a0a 2020 2020 2020  t xpaths:.      
+000098f0: 2020 2020 2020 7870 6174 6873 203d 205b        xpaths = [
+00009900: 222e 2f2f 6469 7622 2c20 222e 2f73 7061  ".//div", "./spa
+00009910: 6e22 5d0a 2020 2020 2020 2020 6966 206e  n"].        if n
+00009920: 6f74 2074 7970 6528 7870 6174 6873 2920  ot type(xpaths) 
+00009930: 6973 206c 6973 743a 0a20 2020 2020 2020  is list:.       
+00009940: 2020 2020 2078 7061 7468 7320 3d20 5b78       xpaths = [x
+00009950: 7061 7468 735d 0a20 2020 2020 2020 2061  paths].        a
+00009960: 7373 6572 7420 3020 3c20 6c65 6e28 7870  ssert 0 < len(xp
+00009970: 6174 6873 2920 3c3d 2032 2c20 6622 6e6f  aths) <= 2, f"no
+00009980: 2078 7061 7468 7320 6769 7665 6e22 0a0a   xpaths given"..
+00009990: 2020 2020 2020 2020 6966 206e 6f74 2072          if not r
+000099a0: 6567 6578 6573 3a0a 2020 2020 2020 2020  egexes:.        
+000099b0: 2020 2020 7265 6765 7865 7320 3d20 5b5d      regexes = []
+000099c0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+000099d0: 7479 7065 2872 6567 6578 6573 2920 6973  type(regexes) is
+000099e0: 206c 6973 743a 0a20 2020 2020 2020 2020   list:.         
+000099f0: 2020 2072 6567 6578 6573 203d 205b 7265     regexes = [re
+00009a00: 6765 7865 735d 0a0a 2020 2020 2020 2020  gexes]..        
+00009a10: 6469 7673 203d 2068 746d 6c5f 656c 656d  divs = html_elem
+00009a20: 2e78 7061 7468 2878 7061 7468 735b 305d  .xpath(xpaths[0]
+00009a30: 290a 2020 2020 2020 2020 7365 6374 696f  ).        sectio
+00009a40: 6e73 203d 205b 5d0a 2020 2020 2020 2020  ns = [].        
+00009a50: 7375 6273 6563 7469 6f6e 7320 3d20 5b5d  subsections = []
+00009a60: 0a20 2020 2020 2020 2066 6f72 2064 6976  .        for div
+00009a70: 2069 6e20 6469 7673 3a0a 2020 2020 2020   in divs:.      
+00009a80: 2020 2020 2020 6966 206c 656e 2872 6567        if len(reg
+00009a90: 6578 6573 2920 3e20 3020 616e 6420 7265  exes) > 0 and re
+00009aa0: 6765 7865 735b 305d 3a0a 2020 2020 2020  gexes[0]:.      
+00009ab0: 2020 2020 2020 2020 2020 7365 6374 696f            sectio
+00009ac0: 6e5f 6964 203d 2048 746d 6c55 7469 6c2e  n_id = HtmlUtil.
+00009ad0: 6578 7472 6163 745f 7375 6273 7472 696e  extract_substrin
+00009ae0: 6773 2864 6976 2c20 7870 6174 683d 7870  gs(div, xpath=xp
+00009af0: 6174 6873 5b30 5d2c 2072 6567 6578 3d72  aths[0], regex=r
+00009b00: 6567 6578 6573 5b30 5d29 0a20 2020 2020  egexes[0]).     
+00009b10: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00009b20: 6374 696f 6e5f 6964 3a0a 2020 2020 2020  ction_id:.      
+00009b30: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00009b40: 6374 696f 6e73 2e61 7070 656e 6428 7365  ctions.append(se
+00009b50: 6374 696f 6e5f 6964 290a 2020 2020 2020  ction_id).      
+00009b60: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00009b70: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
+00009b80: 2020 2069 6620 6c65 6e20 2872 6567 6578     if len (regex
+00009b90: 6573 2920 3e20 3120 616e 6420 7265 6765  es) > 1 and rege
+00009ba0: 7865 735b 315d 3a0a 2020 2020 2020 2020  xes[1]:.        
+00009bb0: 2020 2020 2020 2020 7375 6273 6563 7469          subsecti
+00009bc0: 6f6e 5f69 6420 3d20 4874 6d6c 5574 696c  on_id = HtmlUtil
+00009bd0: 2e65 7874 7261 6374 5f73 7562 7374 7269  .extract_substri
+00009be0: 6e67 7328 6469 762c 2078 7061 7468 3d78  ngs(div, xpath=x
+00009bf0: 7061 7468 735b 315d 2c0a 2020 2020 2020  paths[1],.      
+00009c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009c30: 2020 2020 2020 7265 6765 783d 7265 6765        regex=rege
+00009c40: 7865 735b 315d 2c0a 2020 2020 2020 2020  xes[1],.        
+00009c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009c80: 2020 2020 7265 6d6f 7665 3d46 616c 7365      remove=False
+00009c90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00009ca0: 2020 6966 2073 7562 7365 6374 696f 6e5f    if subsection_
+00009cb0: 6964 3a0a 2020 2020 2020 2020 2020 2020  id:.            
+00009cc0: 2020 2020 2020 2020 7375 6273 6563 7469          subsecti
+00009cd0: 6f6e 732e 6170 7065 6e64 2873 7562 7365  ons.append(subse
+00009ce0: 6374 696f 6e5f 6964 290a 2020 2020 2020  ction_id).      
+00009cf0: 2020 7265 7475 726e 2073 6563 7469 6f6e    return section
+00009d00: 732c 2073 7562 7365 6374 696f 6e73 0a0a  s, subsections..
+00009d10: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+00009d20: 0a20 2020 2064 6566 2061 6e6e 6f74 6174  .    def annotat
+00009d30: 655f 6469 765f 7370 616e 735f 7772 6974  e_div_spans_writ
+00009d40: 655f 6669 6e61 6c5f 6874 6d6c 2863 6c73  e_final_html(cls
+00009d50: 2c20 696e 7075 745f 6874 6d6c 2c20 6f75  , input_html, ou
+00009d60: 7466 696c 652c 2073 7479 6c65 733d 4e6f  tfile, styles=No
+00009d70: 6e65 293a 0a20 2020 2020 2020 2069 6620  ne):.        if 
+00009d80: 6e6f 7420 7374 796c 6573 3a0a 2020 2020  not styles:.    
+00009d90: 2020 2020 2020 2020 7374 796c 6573 203d          styles =
+00009da0: 2048 746d 6c47 726f 7570 2e44 4546 4155   HtmlGroup.DEFAU
+00009db0: 4c54 5f53 5459 4c45 530a 2020 2020 2020  LT_STYLES.      
+00009dc0: 2020 6874 6d6c 5f65 6c65 6d20 3d20 4554    html_elem = ET
+00009dd0: 2e70 6172 7365 2873 7472 2869 6e70 7574  .parse(str(input
+00009de0: 5f68 746d 6c29 292e 6765 7472 6f6f 7428  _html)).getroot(
+00009df0: 290a 2020 2020 2020 2020 616e 6e6f 7461  ).        annota
+00009e00: 746f 7220 3d20 4874 6d6c 416e 6e6f 7461  tor = HtmlAnnota
+00009e10: 746f 722e 6372 6561 7465 5f69 7063 635f  tor.create_ipcc_
+00009e20: 616e 6e6f 7461 746f 7228 290a 2020 2020  annotator().    
+00009e30: 2020 2020 4874 6d6c 5374 796c 652e 6164      HtmlStyle.ad
+00009e40: 645f 6865 6164 5f73 7479 6c65 735f 6f72  d_head_styles_or
+00009e50: 6967 2868 746d 6c5f 656c 656d 2c20 7374  ig(html_elem, st
+00009e60: 796c 6573 290a 2020 2020 2020 2020 7370  yles).        sp
+00009e70: 616e 7320 3d20 6874 6d6c 5f65 6c65 6d2e  ans = html_elem.
+00009e80: 7870 6174 6828 222e 2f2f 7370 616e 2229  xpath(".//span")
+00009e90: 0a20 2020 2020 2020 2066 6f72 2073 7061  .        for spa
+00009ea0: 6e20 696e 2073 7061 6e73 3a0a 2020 2020  n in spans:.    
+00009eb0: 2020 2020 2020 2020 616e 6e6f 7461 746f          annotato
+00009ec0: 722e 7275 6e5f 636f 6d6d 616e 6473 2873  r.run_commands(s
+00009ed0: 7061 6e29 0a20 2020 2020 2020 2048 746d  pan).        Htm
+00009ee0: 6c47 726f 7570 2e67 726f 7570 5f6e 6573  lGroup.group_nes
+00009ef0: 7465 645f 7369 626c 696e 6773 2868 746d  ted_siblings(htm
+00009f00: 6c5f 656c 656d 2c20 7374 796c 6573 3d4e  l_elem, styles=N
+00009f10: 6f6e 6529 0a20 2020 2020 2020 2048 746d  one).        Htm
+00009f20: 6c4c 6962 2e77 7269 7465 5f68 746d 6c5f  lLib.write_html_
+00009f30: 6669 6c65 2868 746d 6c5f 656c 656d 2c20  file(html_elem, 
+00009f40: 6f75 7466 696c 652c 2064 6562 7567 3d54  outfile, debug=T
+00009f50: 7275 6529 0a0a 2020 2020 4063 6c61 7373  rue)..    @class
+00009f60: 6d65 7468 6f64 0a20 2020 2064 6566 2073  method.    def s
+00009f70: 706c 6974 5f73 7061 6e73 2863 6c73 2c20  plit_spans(cls, 
+00009f80: 6874 6d6c 2c20 7370 6c69 745f 7370 616e  html, split_span
+00009f90: 5f72 6567 6578 293a 0a20 2020 2020 2020  _regex):.       
+00009fa0: 2072 655f 7370 6c69 7420 3d20 7265 2e63   re_split = re.c
+00009fb0: 6f6d 7069 6c65 2873 706c 6974 5f73 7061  ompile(split_spa
+00009fc0: 6e5f 7265 6765 7829 0a20 2020 2020 2020  n_regex).       
+00009fd0: 2073 7061 6e73 203d 2068 746d 6c2e 7870   spans = html.xp
+00009fe0: 6174 6828 222f 2f73 7061 6e22 290a 2020  ath("//span").  
+00009ff0: 2020 2020 2020 6e73 7061 6e73 203d 206c        nspans = l
+0000a000: 656e 2873 7061 6e73 290a 0a20 2020 2020  en(spans)..     
+0000a010: 2020 2063 6c73 2e73 6361 6e5f 7265 6d61     cls.scan_rema
+0000a020: 696e 696e 675f 7370 616e 7328 7265 5f73  ining_spans(re_s
+0000a030: 706c 6974 2c20 7370 616e 7329 0a0a 2020  plit, spans)..  
+0000a040: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+0000a050: 2020 2064 6566 2073 6361 6e5f 7265 6d61     def scan_rema
+0000a060: 696e 696e 675f 7370 616e 7328 636c 732c  ining_spans(cls,
+0000a070: 2072 655f 7370 6c69 742c 2073 7061 6e73   re_split, spans
+0000a080: 293a 0a20 2020 2020 2020 2064 6976 203d  ):.        div =
+0000a090: 204e 6f6e 650a 2020 2020 2020 2020 7768   None.        wh
+0000a0a0: 696c 6520 6c65 6e28 7370 616e 7329 203e  ile len(spans) >
+0000a0b0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0000a0c0: 666f 7220 692c 2073 7061 6e20 696e 2065  for i, span in e
+0000a0d0: 6e75 6d65 7261 7465 2873 7061 6e73 293a  numerate(spans):
+0000a0e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a0f0: 2069 6620 6469 7620 6973 206e 6f74 204e   if div is not N
+0000a100: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0000a110: 2020 2020 2020 2020 2064 6976 2e61 7070           div.app
+0000a120: 656e 6428 7370 616e 290a 2020 2020 2020  end(span).      
+0000a130: 2020 2020 2020 2020 2020 6d61 7463 6820            match 
+0000a140: 3d20 7265 5f73 706c 6974 2e6d 6174 6368  = re_split.match
+0000a150: 2873 7061 6e2e 7465 7874 290a 2020 2020  (span.text).    
+0000a160: 2020 2020 2020 2020 2020 2020 6966 206d              if m
+0000a170: 6174 6368 3a0a 2020 2020 2020 2020 2020  atch:.          
+0000a180: 2020 2020 2020 2020 2020 7072 6520 3d20            pre = 
+0000a190: 6d61 7463 682e 6772 6f75 7028 2270 7265  match.group("pre
+0000a1a0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0000a1b0: 2020 2020 2020 2070 6f73 7420 3d20 6d61         post = ma
+0000a1c0: 7463 682e 6772 6f75 7028 2270 6f73 7422  tch.group("post"
+0000a1d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000a1e0: 2020 2020 2020 7370 616e 2e74 6578 7420        span.text 
+0000a1f0: 3d20 7072 650a 2020 2020 2020 2020 2020  = pre.          
+0000a200: 2020 2020 2020 2020 2020 7061 7265 6e74            parent
+0000a210: 5f64 6976 203d 2073 7061 6e2e 6765 7470  _div = span.getp
+0000a220: 6172 656e 7428 290a 2020 2020 2020 2020  arent().        
+0000a230: 2020 2020 2020 2020 2020 2020 6e65 7874              next
+0000a240: 5f73 7061 6e20 3d20 4554 2e53 7562 456c  _span = ET.SubEl
+0000a250: 656d 656e 7428 7061 7265 6e74 5f64 6976  ement(parent_div
+0000a260: 2c20 2273 7061 6e22 290a 2020 2020 2020  , "span").      
+0000a270: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0000a280: 7220 6174 7420 696e 2073 7061 6e2e 6174  r att in span.at
+0000a290: 7472 6962 3a0a 2020 2020 2020 2020 2020  trib:.          
+0000a2a0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+0000a2b0: 7874 5f73 7061 6e2e 6174 7472 6962 5b61  xt_span.attrib[a
+0000a2c0: 7474 5b30 5d5d 203d 2061 7474 5b31 5d0a  tt[0]] = att[1].
+0000a2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a2e0: 2020 2020 2020 2020 7370 616e 2e61 6464          span.add
+0000a2f0: 6e65 7874 286e 6578 745f 7370 616e 290a  next(next_span).
+0000a300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a310: 2020 2020 7370 616e 7320 3d20 7370 616e      spans = span
+0000a320: 735b 6920 2b20 313a 5d0a 2020 2020 2020  s[i + 1:].      
+0000a330: 2020 2020 2020 2020 2020 2020 2020 6469                di
+0000a340: 7620 3d20 4554 2e53 7562 456c 656d 656e  v = ET.SubElemen
+0000a350: 7428 7061 7265 6e74 5f64 6976 2e67 6574  t(parent_div.get
+0000a360: 7061 7265 6e74 2829 2c20 2264 6976 2229  parent(), "div")
+0000a370: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000a380: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
+0000a390: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+0000a3a0: 203d 3d20 6c65 6e28 7370 616e 7329 202d   == len(spans) -
+0000a3b0: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+0000a3c0: 2020 2020 2020 2020 7370 616e 7320 3d20          spans = 
+0000a3d0: 5b5d 0a0a 0a0a 636c 6173 7320 4874 6d6c  []....class Html
+0000a3e0: 5574 696c 3a0a 2020 2020 5343 5249 5054  Util:.    SCRIPT
+0000a3f0: 5f46 4143 5420 3d20 302e 3920 2023 206d  _FACT = 0.9  # m
+0000a400: 6179 6265 2073 686f 6c64 6e27 7420 6265  aybe sholdn't be
+0000a410: 2068 6572 653b 2061 766f 6964 2063 6972   here; avoid cir
+0000a420: 6375 6c61 720a 2020 2020 4d41 524b 4552  cular.    MARKER
+0000a430: 203d 2022 6d61 726b 6572 220a 0a0a 2020   = "marker"...  
+0000a440: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+0000a450: 2020 2064 6566 2072 656d 6f76 655f 656d     def remove_em
+0000a460: 7074 795f 656c 656d 656e 7473 2863 6c73  pty_elements(cls
+0000a470: 2c20 656c 656d 2c20 7461 6729 3a0a 2020  , elem, tag):.  
+0000a480: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000a490: 2020 4d61 7962 6520 6d6f 7665 2074 6f20    Maybe move to 
+0000a4a0: 4854 4d4c 5469 6479 0a20 2020 2020 2020  HTMLTidy.       
+0000a4b0: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
+0000a4c0: 7461 673a 0a20 2020 2020 2020 2020 2020  tag:.           
+0000a4d0: 2069 6620 7479 7065 2874 6167 2920 6973   if type(tag) is
+0000a4e0: 206c 6973 743a 0a20 2020 2020 2020 2020   list:.         
+0000a4f0: 2020 2020 2020 2066 6f72 2074 2069 6e20         for t in 
+0000a500: 7461 673a 0a20 2020 2020 2020 2020 2020  tag:.           
+0000a510: 2020 2020 2020 2020 2063 6c73 2e72 656d           cls.rem
+0000a520: 6f76 655f 656d 7074 795f 656c 656d 656e  ove_empty_elemen
+0000a530: 7473 2865 6c65 6d2c 2074 290a 2020 2020  ts(elem, t).    
+0000a540: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000a550: 2020 2020 2020 2020 2020 2020 2020 7870                xp
+0000a560: 203d 2066 222e 2f2f 7b74 6167 7d5b 6e6f   = f".//{tag}[no
+0000a570: 726d 616c 697a 652d 7370 6163 6528 2e29  rmalize-space(.)
+0000a580: 3d27 2720 616e 6420 636f 756e 7428 7b74  ='' and count({t
+0000a590: 6167 7d2f 2a29 203d 2030 5d22 0a20 2020  ag}/*) = 0]".   
+0000a5a0: 2020 2020 2020 2020 2020 2020 2065 6c65               ele
+0000a5b0: 6d73 203d 2065 6c65 6d2e 7870 6174 6828  ms = elem.xpath(
+0000a5c0: 7870 290a 2020 2020 2020 2020 2020 2020  xp).            
+0000a5d0: 2020 2020 666f 7220 656c 2069 6e20 656c      for el in el
+0000a5e0: 656d 733a 0a20 2020 2020 2020 2020 2020  ems:.           
+0000a5f0: 2020 2020 2020 2020 2063 6c73 2e72 656d           cls.rem
+0000a600: 6f76 655f 656c 656d 5f6b 6565 705f 7461  ove_elem_keep_ta
+0000a610: 696c 2865 6c29 0a0a 2020 2020 4063 6c61  il(el)..    @cla
+0000a620: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+0000a630: 2072 656d 6f76 655f 656c 656d 5f6b 6565   remove_elem_kee
+0000a640: 705f 7461 696c 2863 6c73 2c20 656c 293a  p_tail(cls, el):
+0000a650: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000a660: 2020 2020 204d 6179 6265 206d 6f76 6520       Maybe move 
+0000a670: 746f 2048 544d 4c54 6964 790a 2020 2020  to HTMLTidy.    
+0000a680: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000a690: 7061 7265 6e74 203d 2065 6c2e 6765 7470  parent = el.getp
+0000a6a0: 6172 656e 7428 290a 2020 2020 2020 2020  arent().        
+0000a6b0: 7461 696c 203d 2065 6c2e 7461 696c 0a20  tail = el.tail. 
+0000a6c0: 2020 2020 2020 2069 6620 7461 696c 2069         if tail i
+0000a6d0: 7320 6e6f 7420 4e6f 6e65 2061 6e64 206c  s not None and l
+0000a6e0: 656e 2874 6169 6c2e 7374 7269 7028 2929  en(tail.strip())
+0000a6f0: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
+0000a700: 2020 7072 6576 203d 2065 6c2e 6765 7470    prev = el.getp
+0000a710: 7265 7669 6f75 7328 290a 2020 2020 2020  revious().      
+0000a720: 2020 2020 2020 6966 2070 7265 7620 6973        if prev is
+0000a730: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0000a740: 2020 2020 2020 2020 2020 2070 7265 762e             prev.
+0000a750: 7461 696c 203d 2028 7072 6576 2e74 6169  tail = (prev.tai
+0000a760: 6c20 6f72 2027 2729 202b 2065 6c2e 7461  l or '') + el.ta
+0000a770: 696c 0a20 2020 2020 2020 2020 2020 2065  il.            e
+0000a780: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000a790: 2020 2020 2070 6172 656e 742e 7465 7874       parent.text
+0000a7a0: 203d 2028 7061 7265 6e74 2e74 6578 7420   = (parent.text 
+0000a7b0: 6f72 2027 2729 202b 2065 6c2e 7461 696c  or '') + el.tail
+0000a7c0: 0a0a 2020 2020 2020 2020 7061 7265 6e74  ..        parent
+0000a7d0: 2e72 656d 6f76 6528 656c 290a 0a20 2020  .remove(el)..   
+0000a7e0: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+0000a7f0: 2020 6465 6620 7370 6c69 745f 7370 616e    def split_span
+0000a800: 5f61 745f 6d61 7463 6828 636c 732c 2065  _at_match(cls, e
+0000a810: 6c65 6d78 2c20 7265 6765 782c 2063 6f70  lemx, regex, cop
+0000a820: 795f 6174 7473 3d54 7275 652c 2072 6563  y_atts=True, rec
+0000a830: 7572 7365 3d54 7275 652c 2069 645f 726f  urse=True, id_ro
+0000a840: 6f74 3d4e 6f6e 652c 2069 645f 636f 756e  ot=None, id_coun
+0000a850: 7465 723d 302c 0a20 2020 2020 2020 2020  ter=0,.         
+0000a860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a870: 2020 206e 6577 5f74 6167 733d 4e6f 6e65     new_tags=None
+0000a880: 293a 0a20 2020 2020 2020 2022 2222 7370  ):.        """sp
+0000a890: 6c69 7473 2061 6e20 656c 656d 2028 6e6f  lits an elem (no
+0000a8a0: 726d 616c 6c79 2073 7061 6e29 2069 6e74  rmally span) int
+0000a8b0: 6f20 3320 636f 6d70 6f6e 656e 7473 2062  o 3 components b
+0000a8c0: 7920 7265 6765 7820 6d61 7463 680a 2020  y regex match.  
+0000a8d0: 2020 2020 2020 3a70 6172 616d 2065 6c65        :param ele
+0000a8e0: 6d78 3a20 656c 656d 2074 6f20 7370 6c69  mx: elem to spli
+0000a8f0: 7420 286e 6f72 6d61 6c6c 7920 6861 7320  t (normally has 
+0000a900: 6120 7061 7265 6e74 2028 652e 672e 2064  a parent (e.g. d
+0000a910: 6976 290a 2020 2020 2020 2020 3a70 6172  iv).        :par
+0000a920: 616d 2072 6567 6578 3a20 7265 6765 7820  am regex: regex 
+0000a930: 746f 2073 706c 6974 2065 6c65 6d20 286f  to split elem (o
+0000a940: 6620 666f 726d 2028 7072 6529 286d 6174  f form (pre)(mat
+0000a950: 6368 2928 706f 7374 290a 2020 2020 2020  ch)(post).      
+0000a960: 2020 3a70 6172 616d 2063 6f70 795f 6174    :param copy_at
+0000a970: 7473 3a20 6966 2054 7275 6520 636f 7079  ts: if True copy
+0000a980: 2061 7474 7320 6672 6f6d 2065 6c65 6d0a   atts from elem.
+0000a990: 2020 2020 2020 2020 3a70 6172 616d 2072          :param r
+0000a9a0: 6563 7572 7365 3a20 6966 2054 7275 652c  ecurse: if True,
+0000a9b0: 2072 6573 6574 7320 656c 656d 2074 6f20   resets elem to 
+0000a9c0: 7472 6169 6c69 6e67 2065 6c65 6d20 616e  trailing elem an
+0000a9d0: 6420 7265 616e 6c79 7365 7320 756e 7469  d reanlyses unti
+0000a9e0: 6c20 6e6f 206d 6f72 6520 6d61 7463 680a  l no more match.
+0000a9f0: 2020 2020 2020 2020 3a70 6172 616d 2069          :param i
+0000aa00: 645f 726f 6f74 3a20 6175 746f 2d67 656e  d_root: auto-gen
+0000aa10: 6572 6174 6520 6964 7320 6275 696c 6469  erate ids buildi
+0000aa20: 6e67 206f 6e20 6964 5f72 6f6f 740a 2020  ng on id_root.  
+0000aa30: 2020 2020 2020 3a70 6172 616d 2069 645f        :param id_
+0000aa40: 636f 756e 7465 723a 2063 6f75 6e74 6572  counter: counter
+0000aa50: 2066 6f72 2069 6473 0a20 2020 2020 2020   for ids.       
+0000aa60: 203a 7061 7261 6d20 6e65 775f 7461 6773   :param new_tags
+0000aa70: 3a20 6e65 775f 656c 656d 656e 7420 7461  : new_element ta
+0000aa80: 6773 2028 6465 6661 756c 7420 7370 616e  gs (default span
+0000aa90: 2c20 7370 616e 2c20 7370 616e 290a 2020  , span, span).  
+0000aaa0: 2020 2020 2020 3a72 6574 7572 6e3a 206c        :return: l
+0000aab0: 6973 7420 6f66 2033 2065 6c65 6d73 3b20  ist of 3 elems; 
+0000aac0: 6966 206e 6577 5f65 6c65 6d73 5b32 5d20  if new_elems[2] 
+0000aad0: 6973 206e 6f74 204e 6f6e 6520 6974 2773  is not None it's
+0000aae0: 2061 7661 696c 6162 6c65 2066 6f72 2072   available for r
+0000aaf0: 6563 7572 7369 6f6e 290a 2020 2020 2020  ecursion).      
+0000ab00: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+0000ab10: 206e 6f74 206e 6577 5f74 6167 733a 0a20   not new_tags:. 
+0000ab20: 2020 2020 2020 2020 2020 206e 6577 5f74             new_t
+0000ab30: 6167 7320 3d20 5b48 5f53 5041 4e2c 2048  ags = [H_SPAN, H
+0000ab40: 5f53 5041 4e2c 2048 5f53 5041 4e5d 0a20  _SPAN, H_SPAN]. 
+0000ab50: 2020 2020 2020 2061 7373 6572 7420 656c         assert el
+0000ab60: 656d 7820 6973 206e 6f74 204e 6f6e 650a  emx is not None.
+0000ab70: 2020 2020 2020 2020 7465 7874 7820 3d20          textx = 
+0000ab80: 4874 6d6c 5574 696c 2e67 6574 5f74 6578  HtmlUtil.get_tex
+0000ab90: 745f 636f 6e74 656e 7428 656c 656d 7829  t_content(elemx)
+0000aba0: 0a20 2020 2020 2020 2072 6563 203d 2072  .        rec = r
+0000abb0: 652e 636f 6d70 696c 6528 7265 6765 7829  e.compile(regex)
+0000abc0: 0a20 2020 2020 2020 206d 6174 6368 203d  .        match =
+0000abd0: 2072 6563 2e6d 6174 6368 2874 6578 7478   rec.match(textx
+0000abe0: 290a 2020 2020 2020 2020 6e65 775f 656c  ).        new_el
+0000abf0: 656d 7320 3d20 5b4e 6f6e 652c 204e 6f6e  ems = [None, Non
+0000ac00: 652c 204e 6f6e 655d 0a20 2020 2020 2020  e, None].       
+0000ac10: 2069 6620 6d61 7463 683a 0a20 2020 2020   if match:.     
+0000ac20: 2020 2020 2020 2070 6172 656e 7420 3d20         parent = 
+0000ac30: 656c 656d 782e 6765 7470 6172 656e 7428  elemx.getparent(
+0000ac40: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0000ac50: 206c 656e 286d 6174 6368 2e67 726f 7570   len(match.group
+0000ac60: 7328 2929 2021 3d20 333a 2020 2320 736f  s()) != 3:  # so
+0000ac70: 6d65 206d 6179 2062 6520 656d 7074 7920  me may be empty 
+0000ac80: 7374 7269 6e67 730a 2020 2020 2020 2020  strings.        
+0000ac90: 2020 2020 2020 2020 6c6f 6767 696e 672e          logging.
+0000aca0: 7761 726e 696e 6728 6622 4361 6e6e 6f74  warning(f"Cannot
+0000acb0: 206d 6174 6368 207b 7465 7874 787d 2061   match {textx} a
+0000acc0: 6761 696e 7374 207b 7265 6765 787d 2229  gainst {regex}")
+0000acd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ace0: 2072 6574 7572 6e20 6e65 775f 656c 656d   return new_elem
+0000acf0: 732c 2069 645f 636f 756e 7465 720a 2020  s, id_counter.  
+0000ad00: 2020 2020 2020 2020 2020 6772 6f75 7031            group1
+0000ad10: 203d 206d 6174 6368 2e67 726f 7570 2831   = match.group(1
+0000ad20: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0000ad30: 2067 726f 7570 3120 213d 2022 223a 2020   group1 != "":  
+0000ad40: 2320 646f 6e27 7420 6164 6420 656d 7074  # don't add empt
+0000ad50: 7920 7374 7269 6e67 0a20 2020 2020 2020  y string.       
+0000ad60: 2020 2020 2020 2020 2065 6c65 6d78 203d           elemx =
+0000ad70: 2048 746d 6c55 7469 6c2e 6164 645f 7369   HtmlUtil.add_si
+0000ad80: 626c 696e 675f 6166 7465 7228 656c 656d  bling_after(elem
+0000ad90: 782c 206e 6577 5f74 6167 735b 305d 2c20  x, new_tags[0], 
+0000ada0: 7265 706c 6163 653d 5472 7565 2c20 636f  replace=True, co
+0000adb0: 7079 5f61 7474 733d 636f 7079 5f61 7474  py_atts=copy_att
+0000adc0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+0000add0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ade0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000adf0: 2020 2020 2020 7465 7874 3d67 726f 7570        text=group
+0000ae00: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
+0000ae10: 2020 206e 6577 5f65 6c65 6d73 5b30 5d20     new_elems[0] 
+0000ae20: 3d20 656c 656d 780a 2020 2020 2020 2020  = elemx.        
+0000ae30: 2020 2020 2020 2020 6e65 775f 656c 656d          new_elem
+0000ae40: 735b 305d 2e61 7474 7269 625b 415f 434c  s[0].attrib[A_CL
+0000ae50: 4153 535d 203d 2022 7265 5f70 7265 6622  ASS] = "re_pref"
+0000ae60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ae70: 2069 645f 636f 756e 7465 7220 3d20 636c   id_counter = cl
+0000ae80: 732e 6164 645f 6964 5f69 6e63 7265 6d65  s.add_id_increme
+0000ae90: 6e74 5f63 6f75 6e74 6572 2869 645f 636f  nt_counter(id_co
+0000aea0: 756e 7465 722c 2069 645f 726f 6f74 2c20  unter, id_root, 
+0000aeb0: 656c 656d 7829 0a20 2020 2020 2020 2020  elemx).         
+0000aec0: 2020 206e 6577 5f65 6c65 6d73 5b31 5d20     new_elems[1] 
+0000aed0: 3d20 4874 6d6c 5574 696c 2e61 6464 5f73  = HtmlUtil.add_s
+0000aee0: 6962 6c69 6e67 5f61 6674 6572 2865 6c65  ibling_after(ele
+0000aef0: 6d78 2c20 6e65 775f 7461 6773 5b31 5d2c  mx, new_tags[1],
+0000af00: 2063 6f70 795f 6174 7473 3d63 6f70 795f   copy_atts=copy_
+0000af10: 6174 7473 2c20 7465 7874 3d6d 6174 6368  atts, text=match
+0000af20: 2e67 726f 7570 2832 2929 0a20 2020 2020  .group(2)).     
+0000af30: 2020 2020 2020 206e 6577 5f65 6c65 6d73         new_elems
+0000af40: 5b31 5d2e 6174 7472 6962 5b41 5f43 4c41  [1].attrib[A_CLA
+0000af50: 5353 5d20 3d20 2272 655f 6d61 7463 6822  SS] = "re_match"
+0000af60: 0a20 2020 2020 2020 2020 2020 2069 645f  .            id_
+0000af70: 636f 756e 7465 7220 3d20 636c 732e 6164  counter = cls.ad
+0000af80: 645f 6964 5f69 6e63 7265 6d65 6e74 5f63  d_id_increment_c
+0000af90: 6f75 6e74 6572 2869 645f 636f 756e 7465  ounter(id_counte
+0000afa0: 722c 2069 645f 726f 6f74 2c20 6e65 775f  r, id_root, new_
+0000afb0: 656c 656d 735b 315d 290a 2020 2020 2020  elems[1]).      
+0000afc0: 2020 2020 2020 6966 206d 6174 6368 2e67        if match.g
+0000afd0: 726f 7570 2833 2920 213d 2022 223a 2020  roup(3) != "":  
+0000afe0: 2320 646f 6e27 7420 6164 6420 656d 7074  # don't add empt
+0000aff0: 7920 7374 7269 6e67 0a20 2020 2020 2020  y string.       
+0000b000: 2020 2020 2020 2020 206e 6577 5f65 6c65           new_ele
+0000b010: 6d73 5b32 5d20 3d20 4874 6d6c 5574 696c  ms[2] = HtmlUtil
+0000b020: 2e61 6464 5f73 6962 6c69 6e67 5f61 6674  .add_sibling_aft
+0000b030: 6572 286e 6577 5f65 6c65 6d73 5b31 5d2c  er(new_elems[1],
+0000b040: 206e 6577 5f74 6167 735b 325d 2c20 636f   new_tags[2], co
+0000b050: 7079 5f61 7474 733d 636f 7079 5f61 7474  py_atts=copy_att
+0000b060: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+0000b070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b090: 2020 2020 2020 2020 2020 2020 2074 6578               tex
+0000b0a0: 743d 6d61 7463 682e 6772 6f75 7028 3329  t=match.group(3)
+0000b0b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000b0c0: 2020 6e65 775f 656c 656d 735b 325d 2e61    new_elems[2].a
+0000b0d0: 7474 7269 625b 415f 434c 4153 535d 203d  ttrib[A_CLASS] =
+0000b0e0: 2022 7265 5f70 6f73 7422 0a0a 2020 2020   "re_post"..    
+0000b0f0: 2020 2020 2020 2020 2020 2020 6964 5f63              id_c
+0000b100: 6f75 6e74 6572 203d 2063 6c73 2e61 6464  ounter = cls.add
+0000b110: 5f69 645f 696e 6372 656d 656e 745f 636f  _id_increment_co
+0000b120: 756e 7465 7228 6964 5f63 6f75 6e74 6572  unter(id_counter
+0000b130: 2c20 6964 5f72 6f6f 742c 206e 6577 5f65  , id_root, new_e
+0000b140: 6c65 6d73 5b32 5d29 0a20 2020 2020 2020  lems[2]).       
+0000b150: 2020 2020 2020 2020 2069 6620 7265 6375           if recu
+0000b160: 7273 653a 0a20 2020 2020 2020 2020 2020  rse:.           
+0000b170: 2020 2020 2020 2020 205f 2c20 6964 5f63           _, id_c
+0000b180: 6f75 6e74 6572 203d 2048 746d 6c55 7469  ounter = HtmlUti
+0000b190: 6c2e 7370 6c69 745f 7370 616e 5f61 745f  l.split_span_at_
+0000b1a0: 6d61 7463 6828 6e65 775f 656c 656d 735b  match(new_elems[
+0000b1b0: 325d 2c20 7265 6765 782c 2063 6f70 795f  2], regex, copy_
+0000b1c0: 6174 7473 3d63 6f70 795f 6174 7473 2c0a  atts=copy_atts,.
+0000b1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b210: 2072 6563 7572 7365 3d72 6563 7572 7365   recurse=recurse
+0000b220: 2c20 6964 5f72 6f6f 743d 6964 5f72 6f6f  , id_root=id_roo
+0000b230: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
+0000b240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b270: 2020 2020 6964 5f63 6f75 6e74 6572 3d69      id_counter=i
+0000b280: 645f 636f 756e 7465 7229 0a20 2020 2020  d_counter).     
+0000b290: 2020 2072 6574 7572 6e20 6e65 775f 656c     return new_el
+0000b2a0: 656d 732c 2069 645f 636f 756e 7465 720a  ems, id_counter.
+0000b2b0: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+0000b2c0: 640a 2020 2020 6465 6620 6164 645f 6964  d.    def add_id
+0000b2d0: 5f69 6e63 7265 6d65 6e74 5f63 6f75 6e74  _increment_count
+0000b2e0: 6572 2863 6c73 2c20 6964 5f63 6f75 6e74  er(cls, id_count
+0000b2f0: 6572 2c20 6964 5f72 6f6f 742c 2068 746d  er, id_root, htm
+0000b300: 6c5f 656c 656d 293a 0a20 2020 2020 2020  l_elem):.       
+0000b310: 2069 6620 6964 5f72 6f6f 743a 0a20 2020   if id_root:.   
+0000b320: 2020 2020 2020 2020 2068 746d 6c5f 656c           html_el
+0000b330: 656d 2e61 7474 7269 625b 415f 4944 5d20  em.attrib[A_ID] 
+0000b340: 3d20 6964 5f72 6f6f 7420 2b20 7374 7228  = id_root + str(
+0000b350: 6964 5f63 6f75 6e74 6572 290a 2020 2020  id_counter).    
+0000b360: 2020 2020 2020 2020 6964 5f63 6f75 6e74          id_count
+0000b370: 6572 202b 3d20 310a 2020 2020 2020 2020  er += 1.        
+0000b380: 7265 7475 726e 2069 645f 636f 756e 7465  return id_counte
+0000b390: 720a 0a20 2020 2040 636c 6173 736d 6574  r..    @classmet
+0000b3a0: 686f 640a 2020 2020 6465 6620 6164 645f  hod.    def add_
+0000b3b0: 7369 626c 696e 675f 6166 7465 7228 636c  sibling_after(cl
+0000b3c0: 732c 2061 6e63 686f 725f 656c 656d 2c20  s, anchor_elem, 
+0000b3d0: 7461 672c 2072 6570 6c61 6365 3d46 616c  tag, replace=Fal
+0000b3e0: 7365 2c20 636f 7079 5f61 7474 733d 4661  se, copy_atts=Fa
+0000b3f0: 6c73 652c 2074 6578 743d 4e6f 6e65 293a  lse, text=None):
+0000b400: 0a20 2020 2020 2020 2022 2222 6164 6473  .        """adds
+0000b410: 206e 6577 2074 7261 696c 696e 6720 7369   new trailing si
+0000b420: 626c 696e 6720 6f66 2061 6e63 686f 725f  bling of anchor_
+0000b430: 656c 656d 2077 6974 6820 7461 670a 2020  elem with tag.  
+0000b440: 2020 2020 2020 3a70 6172 616d 2074 6167        :param tag
+0000b450: 3a20 7461 6720 666f 7220 6e65 7720 656c  : tag for new el
+0000b460: 656d 656e 740a 2020 2020 2020 2020 3a70  ement.        :p
+0000b470: 6172 616d 2061 6e63 686f 725f 656c 656d  aram anchor_elem
+0000b480: 3a20 7265 6665 7265 6e63 6520 656c 656d  : reference elem
+0000b490: 656e 742c 206d 7573 7420 6861 7665 2061  ent, must have a
+0000b4a0: 2070 6172 656e 740a 2020 2020 2020 2020   parent.        
+0000b4b0: 3a70 6172 616d 2072 6570 6c61 6365 3a20  :param replace: 
+0000b4c0: 6966 2054 7275 652c 2072 656d 6f76 6520  if True, remove 
+0000b4d0: 616e 6368 6f72 2065 6c65 6d65 6e74 0a20  anchor element. 
+0000b4e0: 2020 2020 2020 203a 7061 7261 6d20 636f         :param co
+0000b4f0: 7079 5f61 7474 733a 2063 6f70 7920 6174  py_atts: copy at
+0000b500: 7472 6962 7574 6573 2066 726f 6d20 616e  tributes from an
+0000b510: 6368 6f72 0a20 2020 2020 2020 203a 7061  chor.        :pa
+0000b520: 7261 6d20 7465 7874 3a20 6966 206e 6f74  ram text: if not
+0000b530: 204e 6f6e 6520 6164 6420 7465 7874 2074   None add text t
+0000b540: 6f20 6e65 7720 656c 656d 656e 740a 2020  o new element.  
+0000b550: 2020 2020 2020 3a72 6574 7572 6e3a 206e        :return: n
+0000b560: 6577 2073 6962 6c69 6e67 2077 6974 6820  ew sibling with 
+0000b570: 6f70 7469 6f6e 616c 2061 7979 7472 6962  optional ayytrib
+0000b580: 7574 6573 2061 6e64 2074 6578 740a 0a0a  utes and text...
+0000b590: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+0000b5a0: 2020 2020 2020 6173 7365 7274 2061 6e63        assert anc
+0000b5b0: 686f 725f 656c 656d 2069 7320 6e6f 7420  hor_elem is not 
+0000b5c0: 4e6f 6e65 0a20 2020 2020 2020 2061 7373  None.        ass
+0000b5d0: 6572 7420 7461 670a 2020 2020 2020 2020  ert tag.        
+0000b5e0: 7061 7265 6e74 203d 2061 6e63 686f 725f  parent = anchor_
+0000b5f0: 656c 656d 2e67 6574 7061 7265 6e74 2829  elem.getparent()
+0000b600: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+0000b610: 7061 7265 6e74 2069 7320 6e6f 7420 4e6f  parent is not No
+0000b620: 6e65 2c20 6622 4e6f 2070 6172 656e 7420  ne, f"No parent 
+0000b630: 666f 7220 616e 6368 6f72 5f65 6c65 6d22  for anchor_elem"
+0000b640: 0a20 2020 2020 2020 2073 6962 6c69 6e67  .        sibling
+0000b650: 203d 2045 542e 5375 6245 6c65 6d65 6e74   = ET.SubElement
+0000b660: 2870 6172 656e 742c 2074 6167 290a 2020  (parent, tag).  
+0000b670: 2020 2020 2020 6966 2063 6f70 795f 6174        if copy_at
+0000b680: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+0000b690: 666f 7220 6b2c 2076 2069 6e20 616e 6368  for k, v in anch
+0000b6a0: 6f72 5f65 6c65 6d2e 6174 7472 6962 2e69  or_elem.attrib.i
+0000b6b0: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
+0000b6c0: 2020 2020 2020 2020 7369 626c 696e 672e          sibling.
+0000b6d0: 6174 7472 6962 5b6b 5d20 3d20 760a 2020  attrib[k] = v.  
+0000b6e0: 2020 2020 2020 616e 6368 6f72 5f65 6c65        anchor_ele
+0000b6f0: 6d2e 6164 646e 6578 7428 7369 626c 696e  m.addnext(siblin
+0000b700: 6729 0a20 2020 2020 2020 2069 6620 7465  g).        if te
+0000b710: 7874 3a0a 2020 2020 2020 2020 2020 2020  xt:.            
+0000b720: 7369 626c 696e 672e 7465 7874 203d 2074  sibling.text = t
+0000b730: 6578 740a 2020 2020 2020 2020 6966 2072  ext.        if r
+0000b740: 6570 6c61 6365 3a0a 2020 2020 2020 2020  eplace:.        
+0000b750: 2020 2020 7061 7265 6e74 2e72 656d 6f76      parent.remov
+0000b760: 6528 616e 6368 6f72 5f65 6c65 6d29 0a20  e(anchor_elem). 
+0000b770: 2020 2020 2020 2072 6574 7572 6e20 7369         return si
+0000b780: 626c 696e 670a 0a20 2020 2040 636c 6173  bling..    @clas
+0000b790: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+0000b7a0: 6372 6561 7465 5f64 6976 5f73 7061 6e28  create_div_span(
+0000b7b0: 636c 732c 2074 6578 742c 2073 7479 6c65  cls, text, style
+0000b7c0: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+0000b7d0: 2222 2275 7469 6c69 7479 206d 6574 686f  """utility metho
+0000b7e0: 6420 746f 2063 7265 6174 6520 6120 6469  d to create a di
+0000b7f0: 762f 7370 616e 4074 6578 7420 2870 726f  v/span@text (pro
+0000b800: 6261 626c 7920 6d61 696e 6c79 2066 6f72  bably mainly for
+0000b810: 2074 6573 7469 6e67 290a 2020 2020 2020   testing).      
+0000b820: 2020 3a70 6172 616d 2074 6578 743a 2074    :param text: t
+0000b830: 6f20 6164 640a 2020 2020 2020 2020 3a72  o add.        :r
+0000b840: 6574 7572 6e3a 2074 6865 2064 6976 2222  eturn: the div""
+0000b850: 220a 2020 2020 2020 2020 6469 7620 3d20  ".        div = 
+0000b860: 4554 2e45 6c65 6d65 6e74 2848 5f44 4956  ET.Element(H_DIV
+0000b870: 290a 2020 2020 2020 2020 7370 616e 203d  ).        span =
+0000b880: 2045 542e 5375 6245 6c65 6d65 6e74 2864   ET.SubElement(d
+0000b890: 6976 2c20 485f 5350 414e 290a 2020 2020  iv, H_SPAN).    
+0000b8a0: 2020 2020 6966 2073 7479 6c65 3a0a 2020      if style:.  
+0000b8b0: 2020 2020 2020 2020 2020 6373 735f 7374            css_st
+0000b8c0: 796c 6520 3d20 4353 5353 7479 6c65 2e63  yle = CSSStyle.c
+0000b8d0: 7265 6174 655f 6373 735f 7374 796c 655f  reate_css_style_
+0000b8e0: 6672 6f6d 5f63 7373 5f73 7472 696e 6728  from_css_string(
+0000b8f0: 2266 6f6e 742d 7369 7a65 3a31 323b 2066  "font-size:12; f
+0000b900: 6f6e 742d 7765 6967 6874 3a20 626f 6c64  ont-weight: bold
+0000b910: 3b22 290a 2020 2020 2020 2020 2020 2020  ;").            
+0000b920: 4874 6d6c 5374 796c 652e 7365 745f 7374  HtmlStyle.set_st
+0000b930: 796c 6528 7370 616e 2c20 6373 735f 7374  yle(span, css_st
+0000b940: 796c 652e 6765 745f 6373 735f 7661 6c75  yle.get_css_valu
+0000b950: 6528 2929 0a20 2020 2020 2020 2073 7061  e()).        spa
+0000b960: 6e2e 7465 7874 203d 2074 6578 740a 2020  n.text = text.  
+0000b970: 2020 2020 2020 7265 7475 726e 2064 6976        return div
+0000b980: 2c20 7370 616e 0a0a 2020 2020 4063 6c61  , span..    @cla
+0000b990: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+0000b9a0: 2069 735f 7375 6273 6372 6970 7428 636c   is_subscript(cl
+0000b9b0: 732c 206c 6173 745f 7370 616e 2c20 7468  s, last_span, th
+0000b9c0: 6973 5f73 7061 6e29 202d 3e20 626f 6f6c  is_span) -> bool
+0000b9d0: 3a0a 2020 2020 2020 2020 2222 2269 7320  :.        """is 
+0000b9e0: 7468 6973 5f73 7061 6e20 6120 7375 6273  this_span a subs
+0000b9f0: 6372 6970 743f 0a20 2020 2020 2020 2075  cript?.        u
+0000ba00: 7365 7320 6865 7572 6973 7469 6373 2069  ses heuristics i
+0000ba10: 6e20 6973 5f73 6372 6970 745f 7479 7065  n is_script_type
+0000ba20: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0000ba30: 6c61 7374 5f73 7061 6e3a 2070 7265 6365  last_span: prece
+0000ba40: 6469 6e67 2073 7061 6e20 2869 6620 4e6f  ding span (if No
+0000ba50: 6e65 2072 6574 7572 6e73 2046 616c 7365  ne returns False
+0000ba60: 290a 2020 2020 2020 2020 3a70 6172 616d  ).        :param
+0000ba70: 2074 6869 735f 7370 616e 3a20 7370 616e   this_span: span
+0000ba80: 2074 6f20 7465 7374 0a20 2020 2020 2020   to test.       
+0000ba90: 203a 7265 7475 726e 3a20 5472 7565 2069   :return: True i
+0000baa0: 6620 7468 6973 2073 7061 6e20 6973 2073  f this span is s
+0000bab0: 6d61 6c6c 6572 2061 6e64 2022 6c6f 7765  maller and "lowe
+0000bac0: 7222 2074 6861 6e20 6c61 7374 2222 220a  r" than last""".
+0000bad0: 2020 2020 2020 2020 7265 7475 726e 2063          return c
+0000bae0: 6c73 2e69 735f 7363 7269 7074 5f74 7970  ls.is_script_typ
+0000baf0: 6528 6c61 7374 5f73 7061 6e2c 2074 6869  e(last_span, thi
+0000bb00: 735f 7370 616e 2c20 7363 7269 7074 5f74  s_span, script_t
+0000bb10: 7970 653d 5353 6372 6970 742e 5355 4229  ype=SScript.SUB)
+0000bb20: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
+0000bb30: 6f64 0a20 2020 2064 6566 2069 735f 7375  od.    def is_su
+0000bb40: 7065 7273 6372 6970 7428 636c 732c 206c  perscript(cls, l
+0000bb50: 6173 745f 7370 616e 2c20 7468 6973 5f73  ast_span, this_s
+0000bb60: 7061 6e29 202d 3e20 626f 6f6c 3a0a 2020  pan) -> bool:.  
+0000bb70: 2020 2020 2020 2222 2269 7320 7468 6973        """is this
+0000bb80: 5f73 7061 6e20 6120 7375 7065 7273 6372  _span a superscr
+0000bb90: 6970 743f 0a20 2020 2020 2020 2075 7365  ipt?.        use
+0000bba0: 7320 6865 7572 6973 7469 6373 2069 6e20  s heuristics in 
+0000bbb0: 6973 5f73 6372 6970 745f 7479 7065 0a20  is_script_type. 
+0000bbc0: 2020 2020 2020 203a 7061 7261 6d20 6c61         :param la
+0000bbd0: 7374 5f73 7061 6e3a 2070 7265 6365 6469  st_span: precedi
+0000bbe0: 6e67 2073 7061 6e20 2869 6620 4e6f 6e65  ng span (if None
+0000bbf0: 2072 6574 7572 6e73 2046 616c 7365 290a   returns False).
+0000bc00: 2020 2020 2020 2020 3a70 6172 616d 2074          :param t
+0000bc10: 6869 735f 7370 616e 3a20 7370 616e 2074  his_span: span t
+0000bc20: 6f20 7465 7374 0a20 2020 2020 2020 203a  o test.        :
+0000bc30: 7265 7475 726e 3a20 5472 7565 2069 6620  return: True if 
+0000bc40: 7468 6973 2073 7061 6e20 6973 2073 6d61  this span is sma
+0000bc50: 6c6c 6572 2061 6e64 2022 6869 6768 6572  ller and "higher
+0000bc60: 2220 7468 616e 206c 6173 7422 2222 0a20  " than last""". 
+0000bc70: 2020 2020 2020 2072 6574 7572 6e20 636c         return cl
+0000bc80: 732e 6973 5f73 6372 6970 745f 7479 7065  s.is_script_type
+0000bc90: 286c 6173 745f 7370 616e 2c20 7468 6973  (last_span, this
+0000bca0: 5f73 7061 6e2c 2073 6372 6970 745f 7479  _span, script_ty
+0000bcb0: 7065 3d53 5363 7269 7074 2e53 5550 290a  pe=SScript.SUP).
+0000bcc0: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+0000bcd0: 640a 2020 2020 6465 6620 6973 5f73 6372  d.    def is_scr
+0000bce0: 6970 745f 7479 7065 2863 6c73 2c20 6c61  ipt_type(cls, la
+0000bcf0: 7374 5f73 7061 6e2c 2074 6869 735f 7370  st_span, this_sp
+0000bd00: 616e 2c20 7363 7269 7074 5f74 7970 652c  an, script_type,
+0000bd10: 2079 646f 776e 3d54 7275 652c 2070 7265   ydown=True, pre
+0000bd20: 6365 6469 6e67 3d4e 6f6e 6529 202d 3e20  ceding=None) -> 
+0000bd30: 626f 6f6c 3a0a 2020 2020 2020 2020 2222  bool:.        ""
+0000bd40: 2268 6575 7269 7374 6320 746f 2064 6574  "heuristc to det
+0000bd50: 6572 6d69 6e65 2077 6865 7468 6572 2074  ermine whether t
+0000bd60: 6869 735f 7370 616e 2069 7320 6120 7375  his_span is a su
+0000bd70: 622f 7375 7065 7273 6372 6970 7420 6f66  b/superscript of
+0000bd80: 206c 6173 745f 7370 616e 0a20 2020 2020   last_span.     
+0000bd90: 2020 204e 4f54 453a 2049 4620 5920 6973     NOTE: IF Y is
+0000bda0: 2044 4f57 4e20 7468 6520 7061 6765 2c20   DOWN the page, 
+0000bdb0: 6120 7375 7065 7273 6372 6970 7420 6861  a superscript ha
+0000bdc0: 7320 534d 414c 4c45 5220 792d 7661 6c75  s SMALLER y-valu
+0000bdd0: 652c 2065 7463 2e20 286c 6f67 6963 2072  e, etc. (logic r
+0000bde0: 6576 6572 7365 6420 6966 206e 6f74 2079  eversed if not y
+0000bdf0: 646f 776e 290a 2020 2020 2020 2020 3a70  down).        :p
+0000be00: 6172 616d 206c 6173 745f 7370 616e 3a20  aram last_span: 
+0000be10: 6966 204e 6f6e 652c 2072 6574 7572 6e73  if None, returns
+0000be20: 2066 616c 7365 0a20 2020 2020 2020 203a   false.        :
+0000be30: 7061 7261 6d20 7468 6973 5f73 7061 6e3a  param this_span:
+0000be40: 2069 6620 6e6f 7420 736d 616c 6c65 7220   if not smaller 
+0000be50: 6279 2053 4352 4950 545f 4641 4354 2072  by SCRIPT_FACT r
+0000be60: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
+0000be70: 2020 2020 3a70 6172 616d 2073 6372 6970      :param scrip
+0000be80: 745f 7479 7065 3a20 5353 6372 6970 742e  t_type: SScript.
+0000be90: 5355 4220 6f72 2053 5363 7269 7074 2e53  SUB or SScript.S
+0000bea0: 5550 0a20 2020 2020 2020 203a 7061 7261  UP.        :para
+0000beb0: 6d20 7964 6f77 6e3a 2054 7275 6520 6966  m ydown: True if
+0000bec0: 2079 2069 6e63 7265 6173 6573 2064 6f77   y increases dow
+0000bed0: 6e20 7468 7220 7061 6765 2028 652e 672e  n thr page (e.g.
+0000bee0: 2053 5647 2920 2844 4546 4155 4c54 2920   SVG) (DEFAULT) 
+0000bef0: 656c 7365 2046 616c 7365 0a20 2020 2020  else False.     
+0000bf00: 2020 203a 7265 7475 726e 3a20 5472 7565     :return: True
+0000bf10: 2069 6620 736d 616c 6c65 7220 616e 6420   if smaller and 
+0000bf20: 6d6f 7665 6420 696e 2072 6967 6874 2079  moved in right y
+0000bf30: 2d64 6972 6563 7469 6f6e 0a20 2020 2020  -direction.     
+0000bf40: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+0000bf50: 6620 7468 6973 5f73 7061 6e20 6973 204e  f this_span is N
+0000bf60: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0000bf70: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+0000bf80: 2020 2020 2020 2320 7472 7920 746f 2066        # try to f
+0000bf90: 696e 6420 6d69 7373 696e 6720 6c61 7374  ind missing last
+0000bfa0: 5f73 7061 6e0a 2020 2020 2020 2020 6966  _span.        if
+0000bfb0: 206c 6173 745f 7370 616e 2069 7320 4e6f   last_span is No
+0000bfc0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0000bfd0: 6c61 7374 5f73 7061 6e20 3d20 7468 6973  last_span = this
+0000bfe0: 5f73 7061 6e2e 7870 6174 6828 6622 7b58  _span.xpath(f"{X
+0000bff0: 5f50 5245 4345 4449 4e47 7d3a 3a7b 485f  _PRECEDING}::{H_
+0000c000: 5350 414e 7d22 290a 2020 2020 2020 2020  SPAN}").        
+0000c010: 2020 2020 6966 206c 656e 286c 6173 745f      if len(last_
+0000c020: 7370 616e 2920 3d3d 2030 3a0a 2020 2020  span) == 0:.    
+0000c030: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000c040: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
+0000c050: 2020 2020 206c 6173 745f 7370 616e 203d       last_span =
+0000c060: 206c 6173 745f 7370 616e 5b30 5d0a 2020   last_span[0].  
+0000c070: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0000c080: 2020 2020 2020 206c 6173 745f 666f 6e74         last_font
+0000c090: 5f73 697a 6520 3d20 4e6f 6e65 0a20 2020  _size = None.   
+0000c0a0: 2020 2020 2020 2020 2074 6869 735f 666f           this_fo
+0000c0b0: 6e74 5f73 697a 6520 3d20 4e6f 6e65 0a20  nt_size = None. 
+0000c0c0: 2020 2020 2020 2020 2020 206c 6173 745f             last_
+0000c0d0: 666f 6e74 5f73 697a 6520 3d20 6c61 7374  font_size = last
+0000c0e0: 5f73 7061 6e2e 7465 7874 5f73 7479 6c65  _span.text_style
+0000c0f0: 2e5f 666f 6e74 5f73 697a 650a 2020 2020  ._font_size.    
+0000c100: 2020 2020 2020 2020 7468 6973 5f66 6f6e          this_fon
+0000c110: 745f 7369 7a65 203d 2074 6869 735f 7370  t_size = this_sp
+0000c120: 616e 2e74 6578 745f 7374 796c 652e 5f66  an.text_style._f
+0000c130: 6f6e 745f 7369 7a65 0a20 2020 2020 2020  ont_size.       
+0000c140: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+0000c150: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
+0000c160: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
+0000c170: 2020 2020 2023 206e 6f20 666f 6e74 2073       # no font s
+0000c180: 7479 6c65 0a20 2020 2020 2020 2069 735f  tyle.        is_
+0000c190: 7363 7269 7074 203d 2063 6c73 2e69 735f  script = cls.is_
 0000c1a0: 7265 7175 6972 6564 5f73 6372 6970 745f  required_script_
-0000c1b0: 7479 7065 2863 6c73 2c20 7363 7269 7074  type(cls, script
-0000c1c0: 5f74 7970 652c 206c 6173 745f 666f 6e74  _type, last_font
-0000c1d0: 5f73 697a 652c 206c 6173 745f 7370 616e  _size, last_span
-0000c1e0: 2c20 7468 6973 5f66 6f6e 745f 7369 7a65  , this_font_size
-0000c1f0: 2c20 7468 6973 5f73 7061 6e2c 2079 646f  , this_span, ydo
-0000c200: 776e 3d54 7275 652c 2029 3a0a 2020 2020  wn=True, ):.    
-0000c210: 2020 2020 2222 226f 6c64 2061 7070 726f      """old appro
-0000c220: 6163 6820 7769 7468 2041 6d69 5370 616e  ach with AmiSpan
-0000c230: 0a20 2020 2020 2020 2054 6869 7320 6973  .        This is
-0000c240: 206e 6f74 2072 6967 6874 2122 2222 0a20   not right!""". 
-0000c250: 2020 2020 2020 2059 4641 4354 4f52 203d         YFACTOR =
-0000c260: 2033 2020 2320 7069 7865 6c73 0a20 2020   3  # pixels.   
-0000c270: 2020 2020 2069 735f 7363 7269 7074 203d       is_script =
-0000c280: 2046 616c 7365 0a20 2020 2020 2020 2073   False.        s
-0000c290: 6372 6970 745f 6661 6374 6f72 203d 2048  cript_factor = H
-0000c2a0: 746d 6c55 7469 6c2e 5343 5249 5054 5f46  tmlUtil.SCRIPT_F
-0000c2b0: 4143 540a 2020 2020 2020 2020 2320 6966  ACT.        # if
-0000c2c0: 2066 6f6e 7420 7369 7a65 7320 6e6f 7420   font sizes not 
-0000c2d0: 6769 7665 6e20 6173 7375 6d65 2074 6865  given assume the
-0000c2e0: 7920 646f 6e27 7420 6d61 7474 6572 0a20  y don't matter. 
-0000c2f0: 2020 2020 2020 2069 6620 6c61 7374 5f66         if last_f
-0000c300: 6f6e 745f 7369 7a65 2061 6e64 2074 6869  ont_size and thi
-0000c310: 735f 666f 6e74 5f73 697a 653a 0a20 2020  s_font_size:.   
-0000c320: 2020 2020 2020 2020 2070 6173 7365 645f           passed_
-0000c330: 666f 6e74 5f73 697a 655f 6368 616e 6765  font_size_change
-0000c340: 203d 2074 6869 735f 666f 6e74 5f73 697a   = this_font_siz
-0000c350: 6520 3c20 7363 7269 7074 5f66 6163 746f  e < script_facto
-0000c360: 7220 2a20 6c61 7374 5f66 6f6e 745f 7369  r * last_font_si
-0000c370: 7a65 0a20 2020 2020 2020 2065 6c73 653a  ze.        else:
-0000c380: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
-0000c390: 7365 645f 666f 6e74 5f73 697a 655f 6368  sed_font_size_ch
-0000c3a0: 616e 6765 203d 2054 7275 650a 2020 2020  ange = True.    
-0000c3b0: 2020 2020 2320 7573 6520 7920 636f 6f72      # use y coor
-0000c3c0: 6473 0a20 2020 2020 2020 2069 6620 7061  ds.        if pa
-0000c3d0: 7373 6564 5f66 6f6e 745f 7369 7a65 5f63  ssed_font_size_c
-0000c3e0: 6861 6e67 653a 0a20 2020 2020 2020 2020  hange:.         
-0000c3f0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0000c400: 2020 2020 2020 2020 6c61 7374 5f79 203d          last_y =
-0000c410: 206c 6173 745f 7370 616e 2e79 0a20 2020   last_span.y.   
-0000c420: 2020 2020 2020 2020 2020 2020 2074 6869               thi
-0000c430: 735f 7920 3d20 7468 6973 5f73 7061 6e2e  s_y = this_span.
-0000c440: 790a 2020 2020 2020 2020 2020 2020 6578  y.            ex
-0000c450: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
-0000c460: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-0000c470: 2020 2020 206c 6173 745f 7920 3d20 4874       last_y = Ht
-0000c480: 6d6c 5574 696c 2e67 6574 5f66 6c6f 6174  mlUtil.get_float
-0000c490: 286c 6173 745f 7370 616e 2c20 2279 3022  (last_span, "y0"
-0000c4a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000c4b0: 2020 7468 6973 5f79 203d 2048 746d 6c55    this_y = HtmlU
-0000c4c0: 7469 6c2e 6765 745f 666c 6f61 7428 7468  til.get_float(th
-0000c4d0: 6973 5f73 7061 6e2c 2022 7930 2229 0a20  is_span, "y0"). 
-0000c4e0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-0000c4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c500: 6c61 7374 5f78 203d 206c 6173 745f 7370  last_x = last_sp
-0000c510: 616e 2e78 0a20 2020 2020 2020 2020 2020  an.x.           
-0000c520: 2020 2020 2074 6869 735f 7820 3d20 7468       this_x = th
-0000c530: 6973 5f73 7061 6e2e 780a 2020 2020 2020  is_span.x.      
-0000c540: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-0000c550: 6570 7469 6f6e 2061 7320 653a 0a20 2020  eption as e:.   
-0000c560: 2020 2020 2020 2020 2020 2020 206c 6173               las
-0000c570: 745f 7820 3d20 4874 6d6c 5574 696c 2e67  t_x = HtmlUtil.g
-0000c580: 6574 5f66 6c6f 6174 286c 6173 745f 7370  et_float(last_sp
-0000c590: 616e 2c20 2278 3022 290a 2020 2020 2020  an, "x0").      
-0000c5a0: 2020 2020 2020 2020 2020 7468 6973 5f78            this_x
-0000c5b0: 203d 2048 746d 6c55 7469 6c2e 6765 745f   = HtmlUtil.get_
-0000c5c0: 666c 6f61 7428 7468 6973 5f73 7061 6e2c  float(this_span,
-0000c5d0: 2022 7830 2229 0a20 2020 2020 2020 2020   "x0").         
-0000c5e0: 2020 2069 6620 7363 7269 7074 5f74 7970     if script_typ
-0000c5f0: 6520 3d3d 2053 5363 7269 7074 2e53 5542  e == SScript.SUB
-0000c600: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000c610: 2020 2320 6973 2069 7420 6c6f 7765 7265    # is it lowere
-0000c620: 643f 2059 2044 4f57 4e0a 2020 2020 2020  d? Y DOWN.      
-0000c630: 2020 2020 2020 2020 2020 6973 5f73 6372            is_scr
-0000c640: 6970 7420 3d20 7964 6f77 6e20 616e 6420  ipt = ydown and 
-0000c650: 286c 6173 745f 7920 3c20 7468 6973 5f79  (last_y < this_y
-0000c660: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-0000c670: 6966 2073 6372 6970 745f 7479 7065 203d  if script_type =
-0000c680: 3d20 5353 6372 6970 742e 5355 503a 0a20  = SScript.SUP:. 
-0000c690: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000c6a0: 2069 7320 6974 2072 6169 7365 643f 2059   is it raised? Y
-0000c6b0: 2044 4f57 4e0a 2020 2020 2020 2020 2020   DOWN.          
-0000c6c0: 2020 2020 2020 6973 5f73 6372 6970 7420        is_script 
-0000c6d0: 3d20 7964 6f77 6e20 616e 6420 286c 6173  = ydown and (las
-0000c6e0: 745f 7920 2d20 7468 6973 5f79 2920 3e20  t_y - this_y) > 
-0000c6f0: 5946 4143 544f 520a 2020 2020 2020 2020  YFACTOR.        
-0000c700: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000c710: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0000c720: 5661 6c75 6545 7272 6f72 2822 6261 6420  ValueError("bad 
-0000c730: 7363 7269 7074 2074 7970 6520 222c 2073  script type ", s
-0000c740: 6372 6970 745f 7479 7065 290a 2020 2020  cript_type).    
-0000c750: 2020 2020 2020 2020 6966 2046 616c 7365          if False
-0000c760: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000c770: 2020 6966 2069 735f 7363 7269 7074 2061    if is_script a
-0000c780: 6e64 206c 6173 745f 7820 616e 6420 7468  nd last_x and th
-0000c790: 6973 5f78 3a0a 2020 2020 2020 2020 2020  is_x:.          
-0000c7a0: 2020 2020 2020 2020 2020 6973 5f73 6372            is_scr
-0000c7b0: 6970 7420 3d20 6c61 7374 5f78 203c 2074  ipt = last_x < t
-0000c7c0: 6869 735f 780a 2020 2020 2020 2020 7265  his_x.        re
-0000c7d0: 7475 726e 2069 735f 7363 7269 7074 0a0a  turn is_script..
-0000c7e0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-0000c7f0: 0a20 2020 2064 6566 2065 7874 7261 6374  .    def extract
-0000c800: 5f66 6f6f 746e 6f74 6573 2863 6c73 2c20  _footnotes(cls, 
-0000c810: 6874 6d6c 5f65 6c65 6d2c 2066 6f6e 745f  html_elem, font_
-0000c820: 7369 7a65 5f63 6f6e 6469 7469 6f6e 2c20  size_condition, 
-0000c830: 7469 746c 653d 2246 6f6f 746e 6f74 6573  title="Footnotes
-0000c840: 2229 3a0a 2020 2020 2020 2020 6469 7673  "):.        divs
-0000c850: 203d 2068 746d 6c5f 656c 656d 2e78 7061   = html_elem.xpa
-0000c860: 7468 2866 222f 2f64 6976 5b73 7061 6e5b  th(f"//div[span[
-0000c870: 636f 6e74 6169 6e73 2840 7374 796c 652c  contains(@style,
-0000c880: 2027 7b66 6f6e 745f 7369 7a65 5f63 6f6e   '{font_size_con
-0000c890: 6469 7469 6f6e 7d27 2920 616e 6420 6e75  dition}') and nu
-0000c8a0: 6d62 6572 282e 293d 6e75 6d62 6572 282e  mber(.)=number(.
-0000c8b0: 295d 5d22 290a 2020 2020 2020 2020 666f  )]]").        fo
-0000c8c0: 6f74 6e6f 7465 5f64 6976 203d 2048 746d  otnote_div = Htm
-0000c8d0: 6c47 726f 7570 2e67 6574 5f62 6163 6b5f  lGroup.get_back_
-0000c8e0: 6469 7628 6874 6d6c 5f65 6c65 6d29 0a20  div(html_elem). 
-0000c8f0: 2020 2020 2020 2066 6f6f 746e 6f74 655f         footnote_
-0000c900: 7469 746c 6520 3d20 4554 2e53 7562 456c  title = ET.SubEl
-0000c910: 656d 656e 7428 666f 6f74 6e6f 7465 5f64  ement(footnote_d
-0000c920: 6976 2c20 2264 6976 2229 0a20 2020 2020  iv, "div").     
-0000c930: 2020 2066 6f6f 746e 6f74 655f 7469 746c     footnote_titl
-0000c940: 652e 7465 7874 203d 2074 6974 6c65 0a20  e.text = title. 
-0000c950: 2020 2020 2020 2075 6c20 3d20 4554 2e53         ul = ET.S
-0000c960: 7562 456c 656d 656e 7428 666f 6f74 6e6f  ubElement(footno
-0000c970: 7465 5f64 6976 2c20 2275 6c22 290a 2020  te_div, "ul").  
-0000c980: 2020 2020 2020 6375 7272 656e 745f 6c69        current_li
-0000c990: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-0000c9a0: 666f 7220 6469 7620 696e 2064 6976 733a  for div in divs:
-0000c9b0: 0a20 2020 2020 2020 2020 2020 2073 7061  .            spa
-0000c9c0: 6e73 203d 2064 6976 2e78 7061 7468 2822  ns = div.xpath("
-0000c9d0: 2e2f 7370 616e 2229 0a20 2020 2020 2020  ./span").       
-0000c9e0: 2020 2020 2066 6f72 2069 2c20 7370 616e       for i, span
-0000c9f0: 2069 6e20 656e 756d 6572 6174 6528 7370   in enumerate(sp
-0000ca00: 616e 7329 3a0a 2020 2020 2020 2020 2020  ans):.          
-0000ca10: 2020 2020 2020 6966 2058 6d6c 4c69 622e        if XmlLib.
-0000ca20: 6973 5f69 6e74 6567 6572 2873 7061 6e29  is_integer(span)
-0000ca30: 2061 6e64 2028 6920 3d3d 2030 206f 7220   and (i == 0 or 
-0000ca40: 4874 6d6c 5574 696c 2e69 735f 7375 7065  HtmlUtil.is_supe
-0000ca50: 7273 6372 6970 7428 7370 616e 735b 6920  rscript(spans[i 
-0000ca60: 2d20 315d 2c20 7370 616e 2929 3a0a 2020  - 1], span)):.  
-0000ca70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca80: 2020 6375 7272 656e 745f 6c69 203d 2045    current_li = E
-0000ca90: 542e 5375 6245 6c65 6d65 6e74 2875 6c2c  T.SubElement(ul,
-0000caa0: 2022 6c69 2229 0a20 2020 2020 2020 2020   "li").         
-0000cab0: 2020 2020 2020 2069 6620 6375 7272 656e         if curren
-0000cac0: 745f 6c69 2069 7320 6e6f 7420 4e6f 6e65  t_li is not None
-0000cad0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000cae0: 2020 2020 2020 6375 7272 656e 745f 6c69        current_li
-0000caf0: 2e61 7070 656e 6428 7370 616e 290a 0a20  .append(span).. 
-0000cb00: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-0000cb10: 2020 2020 6465 6620 616e 6e6f 7461 7465      def annotate
-0000cb20: 5f73 6372 6970 745f 7479 7065 2863 6c73  _script_type(cls
-0000cb30: 2c20 7370 616e 2c20 7363 7269 7074 5f74  , span, script_t
-0000cb40: 7970 652c 2073 6372 6970 745f 6661 6374  ype, script_fact
-0000cb50: 6f72 3d4e 6f6e 652c 206c 6173 745f 7370  or=None, last_sp
-0000cb60: 616e 3d4e 6f6e 652c 2079 646f 776e 3d54  an=None, ydown=T
-0000cb70: 7275 6529 3a0a 2020 2020 2020 2020 2222  rue):.        ""
-0000cb80: 2269 7320 6120 7370 616e 2061 2073 7562  "is a span a sub
-0000cb90: 206f 7220 7375 7065 7273 6372 6970 743f   or superscript?
-0000cba0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0000cbb0: 7370 616e 3a20 746f 2074 6573 740a 2020  span: to test.  
-0000cbc0: 2020 2020 2020 3a70 6172 616d 2073 6372        :param scr
-0000cbd0: 6970 745f 7479 7065 3a20 5353 6372 6970  ipt_type: SScrip
-0000cbe0: 742e 5355 4220 6f72 2053 5363 7269 7074  t.SUB or SScript
-0000cbf0: 2e53 5550 4552 0a20 2020 2020 2020 203a  .SUPER.        :
-0000cc00: 7061 7261 6d20 7363 7269 7074 5f66 6163  param script_fac
-0000cc10: 746f 723a 2069 6620 4e6f 6e65 2c20 6465  tor: if None, de
-0000cc20: 6661 756c 7473 2074 6f20 4874 6d6c 5574  faults to HtmlUt
-0000cc30: 696c 2e53 4352 4950 545f 4641 4354 0a20  il.SCRIPT_FACT. 
-0000cc40: 2020 2020 2020 203a 7061 7261 6d20 6c61         :param la
-0000cc50: 7374 5f73 7061 6e3a 2070 7265 6365 6469  st_span: precedi
-0000cc60: 6e67 2073 7061 6e3b 2069 6620 4e6f 6e65  ng span; if None
-0000cc70: 2074 7269 6573 2078 7061 7468 2822 7072   tries xpath("pr
-0000cc80: 6563 6564 696e 673a 3a73 7061 6e22 290a  eceding::span").
-0000cc90: 2020 2020 2020 2020 3a70 6172 616d 2079          :param y
-0000cca0: 646f 776e 3a20 6973 2079 2072 756e 6e69  down: is y runni
-0000ccb0: 6e67 2064 6f6e 7720 7468 6520 7061 6765  ng donw the page
-0000ccc0: 3f0a 2020 2020 2020 2020 2222 220a 2020  ?.        """.  
-0000ccd0: 2020 2020 2020 6966 2073 7061 6e20 6973        if span is
-0000cce0: 204e 6f6e 6520 6f72 206e 6f74 2073 6372   None or not scr
-0000ccf0: 6970 745f 7479 7065 3a0a 2020 2020 2020  ipt_type:.      
-0000cd00: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-0000cd10: 650a 2020 2020 2020 2020 6966 206e 6f74  e.        if not
-0000cd20: 2073 6372 6970 745f 6661 6374 6f72 3a0a   script_factor:.
-0000cd30: 2020 2020 2020 2020 2020 2020 7363 7269              scri
-0000cd40: 7074 5f66 6163 746f 7220 3d20 4874 6d6c  pt_factor = Html
-0000cd50: 5574 696c 2e53 4352 4950 545f 4641 4354  Util.SCRIPT_FACT
-0000cd60: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0000cd70: 6c61 7374 5f73 7061 6e3a 0a20 2020 2020  last_span:.     
-0000cd80: 2020 2020 2020 206c 6173 745f 7370 616e         last_span
-0000cd90: 203d 2073 7061 6e2e 7870 6174 6828 2270   = span.xpath("p
-0000cda0: 7265 6365 6469 6e67 3a3a 7370 616e 2229  receding::span")
-0000cdb0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000cdc0: 6c65 6e28 6c61 7374 5f73 7061 6e29 203d  len(last_span) =
-0000cdd0: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-0000cde0: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-0000cdf0: 0a20 2020 2020 2020 2020 2020 206c 6173  .            las
-0000ce00: 745f 7370 616e 203d 206c 6173 745f 7370  t_span = last_sp
-0000ce10: 616e 5b2d 315d 0a20 2020 2020 2020 2063  an[-1].        c
-0000ce20: 7373 7320 3d20 4353 5353 7479 6c65 2e63  sss = CSSStyle.c
-0000ce30: 7265 6174 655f 6373 735f 7374 796c 655f  reate_css_style_
-0000ce40: 6672 6f6d 5f61 7474 7269 6275 7465 5f6f  from_attribute_o
-0000ce50: 665f 626f 6479 5f65 6c65 6d65 6e74 2873  f_body_element(s
-0000ce60: 7061 6e29 0a20 2020 2020 2020 206c 6173  pan).        las
-0000ce70: 745f 6373 7373 203d 2043 5353 5374 796c  t_csss = CSSStyl
-0000ce80: 652e 6372 6561 7465 5f63 7373 5f73 7479  e.create_css_sty
-0000ce90: 6c65 5f66 726f 6d5f 6174 7472 6962 7574  le_from_attribut
-0000cea0: 655f 6f66 5f62 6f64 795f 656c 656d 656e  e_of_body_elemen
-0000ceb0: 7428 6c61 7374 5f73 7061 6e29 0a20 2020  t(last_span).   
-0000cec0: 2020 2020 2066 6f6e 745f 7369 7a65 203d       font_size =
-0000ced0: 2063 7373 732e 666f 6e74 5f73 697a 650a   csss.font_size.
-0000cee0: 2020 2020 2020 2020 6c61 7374 5f66 6f6e          last_fon
-0000cef0: 745f 7369 7a65 203d 206c 6173 745f 6373  t_size = last_cs
-0000cf00: 7373 2e66 6f6e 745f 7369 7a65 0a20 2020  ss.font_size.   
-0000cf10: 2020 2020 2069 735f 7363 7269 7074 203d       is_script =
-0000cf20: 204e 6f6e 650a 2020 2020 2020 2020 6966   None.        if
-0000cf30: 2066 6f6e 745f 7369 7a65 2061 6e64 2066   font_size and f
-0000cf40: 6f6e 745f 7369 7a65 203c 2073 6372 6970  ont_size < scrip
-0000cf50: 745f 6661 6374 6f72 202a 206c 6173 745f  t_factor * last_
-0000cf60: 666f 6e74 5f73 697a 653a 0a20 2020 2020  font_size:.     
-0000cf70: 2020 2020 2020 206c 6173 745f 7920 3d20         last_y = 
-0000cf80: 4353 5353 7479 6c65 2e67 6574 5f79 3028  CSSStyle.get_y0(
-0000cf90: 6c61 7374 5f73 7061 6e29 0a20 2020 2020  last_span).     
-0000cfa0: 2020 2020 2020 2074 6869 735f 7920 3d20         this_y = 
-0000cfb0: 4353 5353 7479 6c65 2e67 6574 5f79 3028  CSSStyle.get_y0(
-0000cfc0: 7370 616e 290a 2020 2020 2020 2020 2020  span).          
-0000cfd0: 2020 6966 2073 6372 6970 745f 7479 7065    if script_type
-0000cfe0: 203d 3d20 5353 6372 6970 742e 5355 423a   == SScript.SUB:
-0000cff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d000: 2023 2069 7320 6974 206c 6f77 6572 6564   # is it lowered
-0000d010: 3f20 5920 444f 574e 0a20 2020 2020 2020  ? Y DOWN.       
-0000d020: 2020 2020 2020 2020 2069 735f 7363 7269           is_scri
-0000d030: 7074 203d 2079 646f 776e 203d 3d20 286c  pt = ydown == (l
-0000d040: 6173 745f 7920 3c20 7468 6973 5f79 290a  ast_y < this_y).
-0000d050: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0000d060: 2073 6372 6970 745f 7479 7065 203d 3d20   script_type == 
-0000d070: 5353 6372 6970 742e 5355 503a 0a20 2020  SScript.SUP:.   
-0000d080: 2020 2020 2020 2020 2020 2020 2023 2069               # i
-0000d090: 7320 6974 2072 6169 7365 643f 2059 2044  s it raised? Y D
-0000d0a0: 4f57 4e0a 2020 2020 2020 2020 2020 2020  OWN.            
-0000d0b0: 2020 2020 6973 5f73 6372 6970 7420 3d20      is_script = 
-0000d0c0: 7964 6f77 6e20 3d3d 2028 6c61 7374 5f79  ydown == (last_y
-0000d0d0: 203e 2074 6869 735f 7929 0a20 2020 2020   > this_y).     
-0000d0e0: 2020 2020 2020 2069 6620 6973 5f73 6372         if is_scr
-0000d0f0: 6970 743a 0a20 2020 2020 2020 2020 2020  ipt:.           
-0000d100: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
-0000d110: 2020 7265 7475 726e 2069 735f 7363 7269    return is_scri
-0000d120: 7074 0a0a 2020 2020 4063 6c61 7373 6d65  pt..    @classme
-0000d130: 7468 6f64 0a20 2020 2064 6566 2073 6574  thod.    def set
-0000d140: 5f61 7474 7269 6228 636c 732c 2065 6c65  _attrib(cls, ele
-0000d150: 6d65 6e74 2c20 6174 746e 616d 652c 2061  ment, attname, a
-0000d160: 7474 7661 6c75 6529 3a0a 2020 2020 2020  ttvalue):.      
-0000d170: 2020 2222 2263 6f6e 7665 6e69 656e 6365    """convenience
-0000d180: 206d 6574 686f 6420 746f 2073 6574 2061   method to set a
-0000d190: 7474 7269 6275 7465 2076 616c 7565 0a20  ttribute value. 
-0000d1a0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000d1b0: 2020 2069 6620 656c 656d 656e 7420 6973     if element is
-0000d1c0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000d1d0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-0000d1e0: 726f 7228 2265 6c65 6d65 6e74 2069 7320  ror("element is 
-0000d1f0: 4e6f 6e65 2229 0a20 2020 2020 2020 2069  None").        i
-0000d200: 6620 6174 746e 616d 6520 616e 6420 6174  f attname and at
-0000d210: 7476 616c 7565 3a0a 2020 2020 2020 2020  tvalue:.        
-0000d220: 2020 2020 656c 656d 656e 742e 7365 7428      element.set(
-0000d230: 6174 746e 616d 652c 2073 7472 2861 7474  attname, str(att
-0000d240: 7661 6c75 6529 290a 0a20 2020 2040 636c  value))..    @cl
-0000d250: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-0000d260: 6620 6765 745f 7465 7874 5f63 6f6e 7465  f get_text_conte
-0000d270: 6e74 2863 6c73 2c20 656c 656d 293a 0a20  nt(cls, elem):. 
-0000d280: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000d290: 2020 2063 6f6e 7665 6e69 656e 6365 206d     convenience m
-0000d2a0: 6574 686f 643b 2061 766f 6964 7320 6861  ethod; avoids ha
-0000d2b0: 7669 6e67 2074 6f20 7265 6d65 6d62 6572  ving to remember
-0000d2c0: 206a 6f69 6e2f 6974 6572 7465 7874 0a20   join/itertext. 
-0000d2d0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000d2e0: 2020 2072 6574 7572 6e20 2727 2e6a 6f69     return ''.joi
-0000d2f0: 6e28 656c 656d 2e69 7465 7274 6578 7428  n(elem.itertext(
-0000d300: 2929 0a0a 2020 2020 4063 6c61 7373 6d65  ))..    @classme
-0000d310: 7468 6f64 0a20 2020 2064 6566 2061 6464  thod.    def add
-0000d320: 5f67 656e 6572 6174 6564 5f69 6473 2863  _generated_ids(c
-0000d330: 6c73 2c20 726f 6f74 5f65 6c65 6d29 3a0a  ls, root_elem):.
-0000d340: 2020 2020 2020 2020 2222 2261 6464 7320          """adds 
-0000d350: 4944 7320 746f 2061 6c6c 2065 6c65 6d65  IDs to all eleme
-0000d360: 6e74 7320 696e 2064 6f63 756d 656e 7420  nts in document 
-0000d370: 6f72 6465 720a 2020 2020 2020 2020 3a70  order.        :p
-0000d380: 6172 616d 2072 6f6f 745f 656c 656d 3a20  aram root_elem: 
-0000d390: 656c 656d 656e 7420 6465 6669 6e69 6e67  element defining
-0000d3a0: 2074 7265 6520 6f66 2073 7562 656c 656d   tree of subelem
-0000d3b0: 656e 7473 2222 220a 2020 2020 2020 2020  ents""".        
-0000d3c0: 7870 6174 6820 3d20 222f 2f2a 220a 2020  xpath = "//*".  
-0000d3d0: 2020 2020 2020 656c 656d 7320 3d20 726f        elems = ro
-0000d3e0: 6f74 5f65 6c65 6d2e 7870 6174 6828 7870  ot_elem.xpath(xp
-0000d3f0: 6174 6829 0a20 2020 2020 2020 2066 6f72  ath).        for
-0000d400: 2069 2c20 656c 2069 6e20 656e 756d 6572   i, el in enumer
-0000d410: 6174 6528 656c 656d 7329 3a0a 2020 2020  ate(elems):.    
-0000d420: 2020 2020 2020 2020 656c 2e61 7474 7269          el.attri
-0000d430: 625b 415f 4944 5d20 3d20 415f 4944 202b  b[A_ID] = A_ID +
-0000d440: 2073 7472 2869 290a 0a20 2020 2040 636c   str(i)..    @cl
-0000d450: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-0000d460: 6620 6a6f 696e 5f73 7061 6e73 5f69 6e5f  f join_spans_in_
-0000d470: 7361 6d65 5f64 6976 2863 6c73 2c20 7370  same_div(cls, sp
-0000d480: 616e 302c 2073 7061 6e31 2c20 6164 6473  an0, span1, adds
-0000d490: 7061 6365 3d54 7275 652c 2072 656d 6f76  pace=True, remov
-0000d4a0: 653d 5472 7565 293a 0a20 2020 2020 2020  e=True):.       
-0000d4b0: 2022 2222 0a20 2020 2020 2020 206a 6f69   """.        joi
-0000d4c0: 6e74 203c 7370 616e 3e2e 2e2e 3c2f 7370  nt <span>...</sp
-0000d4d0: 616e 3e3c 7370 616e 3e2e 2e2e 3c2f 7370  an><span>...</sp
-0000d4e0: 616e 3e20 696e 746f 203c 7370 616e 3e2e  an> into <span>.
-0000d4f0: 2e2e 3c2f 7370 616e 3e0a 2020 2020 2020  ..</span>.      
-0000d500: 2020 7468 6973 2073 7472 7563 7475 7265    this structure
-0000d510: 2061 7269 7365 7320 7768 656e 2050 4446   arises when PDF
-0000d520: 206f 7220 696d 6167 6573 2069 7320 7061   or images is pa
-0000d530: 7273 6564 2061 6e64 2073 7061 6e73 2068  rsed and spans h
-0000d540: 6176 6520 7468 6520 7361 6d65 2073 7479  ave the same sty
-0000d550: 6c65 7320 2873 697a 652f 7374 796c 652f  les (size/style/
-0000d560: 7765 6967 6874 2920 616e 6420 6361 6e20  weight) and can 
-0000d570: 6265 206d 6572 6765 640a 2020 2020 2020  be merged.      
-0000d580: 2020 7765 2061 7373 756d 6520 7468 6174    we assume that
-0000d590: 2073 7479 6c65 2061 6e64 2067 656f 6d65   style and geome
-0000d5a0: 7472 7920 6368 656b 696e 6720 6861 7320  try cheking has 
-0000d5b0: 6265 656e 2064 6f6e 650a 2020 2020 2020  been done.      
-0000d5c0: 2020 3a70 6172 616d 2073 7061 6e30 3a20    :param span0: 
-0000d5d0: 6669 7273 7420 3c73 7061 6e3e 2c20 7465  first <span>, te
-0000d5e0: 7874 2077 696c 6c20 6265 2069 6e63 7265  xt will be incre
-0000d5f0: 6173 6564 2066 726f 6d20 7370 616e 310a  ased from span1.
-0000d600: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
-0000d610: 7061 6e31 3a20 7465 7874 2077 696c 6c20  pan1: text will 
-0000d620: 6265 2061 7070 656e 6465 6420 746f 2073  be appended to s
-0000d630: 7061 6e30 2074 6578 740a 2020 2020 2020  pan0 text.      
-0000d640: 2020 3a70 6172 616d 2072 656d 6f76 653a    :param remove:
-0000d650: 2072 656d 6f76 6520 7370 616e 3120 2864   remove span1 (d
-0000d660: 6566 6175 6c74 290a 2020 2020 2020 2020  efault).        
-0000d670: 2222 220a 2020 2020 2020 2020 6966 2048  """.        if H
-0000d680: 746d 6c55 7469 6c2e 6368 6563 6b5f 7461  tmlUtil.check_ta
-0000d690: 6728 7370 616e 302c 2022 7370 616e 2229  g(span0, "span")
-0000d6a0: 2061 6e64 2048 746d 6c55 7469 6c2e 6368   and HtmlUtil.ch
-0000d6b0: 6563 6b5f 7461 6728 7370 616e 312c 2022  eck_tag(span1, "
-0000d6c0: 7370 616e 2229 3a0a 2020 2020 2020 2020  span"):.        
-0000d6d0: 2020 2020 7061 7265 6e74 3120 3d20 7370      parent1 = sp
-0000d6e0: 616e 312e 6765 7470 6172 656e 7428 290a  an1.getparent().
-0000d6f0: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-0000d700: 6464 7370 6163 653a 0a20 2020 2020 2020  ddspace:.       
-0000d710: 2020 2020 2020 2020 2073 7061 6e30 5f6e           span0_n
-0000d720: 6f74 5f65 6e64 5f73 7061 6365 203d 206c  ot_end_space = l
-0000d730: 656e 2873 7061 6e30 2920 3e20 3020 616e  en(span0) > 0 an
-0000d740: 6420 7370 616e 305b 2d31 5d20 213d 2022  d span0[-1] != "
-0000d750: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-0000d760: 2020 2073 7061 6e31 5f6e 6f74 5f73 7461     span1_not_sta
-0000d770: 7274 5f73 7061 6365 203d 206c 656e 2873  rt_space = len(s
-0000d780: 7061 6e31 2920 3e20 3020 616e 6420 7370  pan1) > 0 and sp
-0000d790: 616e 315b 2d31 5d20 213d 2022 2022 0a20  an1[-1] != " ". 
-0000d7a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000d7b0: 6620 7370 616e 305f 6e6f 745f 656e 645f  f span0_not_end_
-0000d7c0: 7370 6163 6520 616e 6420 7370 616e 315f  space and span1_
-0000d7d0: 6e6f 745f 7374 6172 745f 7370 6163 653a  not_start_space:
-0000d7e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d7f0: 2020 2020 2073 7061 6e30 2e74 6578 7420       span0.text 
-0000d800: 2b3d 2022 2022 0a20 2020 2020 2020 2020  += " ".         
-0000d810: 2020 2073 7061 6e30 2e74 6578 7420 2b3d     span0.text +=
-0000d820: 2073 7061 6e31 2e74 6578 740a 2020 2020   span1.text.    
-0000d830: 2020 2020 2020 2020 6966 2072 656d 6f76          if remov
-0000d840: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000d850: 2020 2070 6172 656e 7431 2e72 656d 6f76     parent1.remov
-0000d860: 6528 7370 616e 3129 0a0a 2020 2020 4063  e(span1)..    @c
-0000d870: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-0000d880: 6566 2063 7265 6174 655f 736b 656c 6574  ef create_skelet
-0000d890: 6f6e 5f68 746d 6c28 636c 7329 3a0a 2020  on_html(cls):.  
-0000d8a0: 2020 2020 2020 2222 2263 7265 6174 6520        """create 
-0000d8b0: 656d 7074 7920 6874 6d6c 2074 7265 650a  empty html tree.
-0000d8c0: 2020 2020 2020 2020 6874 6d6c 0a20 2020          html.   
-0000d8d0: 2020 2020 2020 2020 2068 6561 640a 2020           head.  
-0000d8e0: 2020 2020 2020 2020 2020 2020 2020 6d65                me
-0000d8f0: 7461 0a20 2020 2020 2020 2020 2020 2020  ta.             
-0000d900: 2020 2023 2073 7479 6c65 0a20 2020 2020     # style.     
-0000d910: 2020 2020 2020 2062 6f64 790a 0a20 2020         body..   
-0000d920: 2020 2020 203a 7265 7475 726e 3a20 7468       :return: th
-0000d930: 6973 2068 746d 6c0a 2020 2020 2020 2020  is html.        
-0000d940: 2222 220a 0a20 2020 2020 2020 2068 746d  """..        htm
-0000d950: 6c20 3d20 4554 2e45 6c65 6d65 6e74 2848  l = ET.Element(H
-0000d960: 5f48 544d 4c29 0a20 2020 2020 2020 2068  _HTML).        h
-0000d970: 6561 6420 3d20 4554 2e45 6c65 6d65 6e74  ead = ET.Element
-0000d980: 2848 5f48 4541 4429 0a20 2020 2020 2020  (H_HEAD).       
-0000d990: 2068 746d 6c2e 6170 7065 6e64 2868 6561   html.append(hea
-0000d9a0: 6429 0a20 2020 2020 2020 206d 6574 6120  d).        meta 
-0000d9b0: 3d20 4554 2e45 6c65 6d65 6e74 2848 5f4d  = ET.Element(H_M
-0000d9c0: 4554 4129 0a20 2020 2020 2020 2068 6561  ETA).        hea
-0000d9d0: 642e 6170 7065 6e64 286d 6574 6129 0a20  d.append(meta). 
-0000d9e0: 2020 2020 2020 2073 7479 6c65 203d 2045         style = E
-0000d9f0: 542e 456c 656d 656e 7428 485f 5354 594c  T.Element(H_STYL
-0000da00: 4529 2020 2320 656d 7074 7920 3c73 7479  E)  # empty <sty
-0000da10: 6c65 3e20 6d65 616e 7320 6e6f 2064 6973  le> means no dis
-0000da20: 706c 6179 0a20 2020 2020 2020 2023 2068  play.        # h
-0000da30: 6561 642e 6170 7065 6e64 2873 7479 6c65  ead.append(style
-0000da40: 290a 2020 2020 2020 2020 626f 6479 203d  ).        body =
-0000da50: 2045 542e 456c 656d 656e 7428 485f 424f   ET.Element(H_BO
-0000da60: 4459 290a 2020 2020 2020 2020 6874 6d6c  DY).        html
-0000da70: 2e61 7070 656e 6428 626f 6479 290a 2020  .append(body).  
-0000da80: 2020 2020 2020 7265 7475 726e 2068 746d        return htm
-0000da90: 6c0a 0a20 2020 2040 636c 6173 736d 6574  l..    @classmet
-0000daa0: 686f 640a 2020 2020 6465 6620 6669 6e64  hod.    def find
-0000dab0: 5f65 6c65 6d65 6e74 735f 7769 7468 5f73  _elements_with_s
-0000dac0: 7479 6c65 2863 6c73 2c20 656c 656d 2c20  tyle(cls, elem, 
-0000dad0: 7870 6174 682c 2063 6f6e 6469 7469 6f6e  xpath, condition
-0000dae0: 3d4e 6f6e 652c 2072 656d 6f76 653d 4661  =None, remove=Fa
-0000daf0: 6c73 6529 3a0a 2020 2020 2020 2020 2222  lse):.        ""
-0000db00: 2272 656d 6f76 6520 616c 6c20 656c 656d  "remove all elem
-0000db10: 656e 7473 2077 6974 6820 7374 796c 6520  ents with style 
-0000db20: 6675 6c66 696c 6c69 6e67 2063 6f6e 6469  fulfilling condi
-0000db30: 7469 6f6e 0a20 2020 2020 2020 203a 7061  tion.        :pa
-0000db40: 7261 6d20 656c 656d 3a20 726f 6f74 2065  ram elem: root e
-0000db50: 6c65 6d65 6e74 2066 6f72 2078 7061 7468  lement for xpath
-0000db60: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0000db70: 7870 6174 683a 2065 6c65 6d65 6e74 7320  xpath: elements 
-0000db80: 746f 2073 6361 6e20 2c20 7368 6f75 6c64  to scan , should
-0000db90: 206e 6f72 6d61 6c6c 7920 636f 6e74 6169   normally contai
-0000dba0: 6e20 7468 6520 4073 7479 6c65 2063 6f6e  n the @style con
-0000dbb0: 6469 7469 6f6e 0a20 2020 2020 2020 2020  dition.         
-0000dbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dbd0: 2069 6620 4e6f 6e65 2075 7365 730a 2020   if None uses.  
-0000dbe0: 2020 2020 2020 3a70 6172 616d 2063 6f6e        :param con
-0000dbf0: 6469 7469 6f6e 3a20 7374 796c 6520 636f  dition: style co
-0000dc00: 6e64 6974 696f 6e20 7072 696d 6974 6976  ndition primitiv
-0000dc10: 6520 6174 2070 7265 7365 6e74 0a20 2020  e at present.   
-0000dc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dc30: 2020 2020 2020 2028 7661 7269 6162 6c65         (variable
-0000dc40: 2c20 6f72 2076 6172 6961 626c 6520 206f  , or variable  o
-0000dc50: 7065 7261 746f 7220 7661 6c75 6520 2865  perator value (e
-0000dc60: 7661 6c20 6973 2065 7669 6c29 0a20 2020  val is evil).   
-0000dc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dc80: 2020 2020 2020 2065 7861 6d70 6c65 2022         example "
-0000dc90: 5f66 6f6e 742d 7369 7a65 203e 2033 3022  _font-size > 30"
-0000dca0: 206f 7220 225f 706f 7369 7469 6f6e 2220   or "_position" 
-0000dcb0: 286d 6561 6e73 2068 6173 2070 6f73 6974  (means has posit
-0000dcc0: 696f 6e29 0a20 2020 2020 2020 203a 7061  ion).        :pa
-0000dcd0: 7261 6d20 7265 6d6f 7665 3a20 7265 6d6f  ram remove: remo
-0000dce0: 7665 2074 6865 7365 2065 6c65 6d65 6e74  ve these element
-0000dcf0: 7320 286e 6f74 2074 6865 6972 2074 6169  s (not their tai
-0000dd00: 6c29 0a20 2020 2020 2020 2022 2222 0a20  l).        """. 
-0000dd10: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000dd20: 2020 204d 6179 6265 206d 6f76 6520 746f     Maybe move to
-0000dd30: 2048 544d 4c54 6964 790a 2020 2020 2020   HTMLTidy.      
-0000dd40: 2020 2222 220a 2020 2020 2020 2020 6173    """.        as
-0000dd50: 7365 7274 2065 6c65 6d20 6973 206e 6f74  sert elem is not
-0000dd60: 204e 6f6e 652c 2066 226d 7573 7420 6861   None, f"must ha
-0000dd70: 7665 2065 6c65 6d22 0a20 2020 2020 2020  ve elem".       
-0000dd80: 2069 6620 7870 6174 683a 0a20 2020 2020   if xpath:.     
-0000dd90: 2020 2020 2020 2065 6c73 203d 2065 6c65         els = ele
-0000dda0: 6d2e 7870 6174 6828 7870 6174 6829 0a20  m.xpath(xpath). 
-0000ddb0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000ddc0: 2020 2020 2020 2020 2065 6c73 203d 205b           els = [
-0000ddd0: 656c 656d 5d0a 2020 2020 2020 2020 656c  elem].        el
-0000dde0: 656d 7320 3d20 5b5d 0a20 2020 2020 2020  ems = [].       
-0000ddf0: 2066 6f72 2065 6c20 696e 2065 6c73 3a0a   for el in els:.
-0000de00: 2020 2020 2020 2020 2020 2020 6373 735f              css_
-0000de10: 7374 796c 6520 3d20 4353 5353 7479 6c65  style = CSSStyle
-0000de20: 2e63 7265 6174 655f 6373 735f 7374 796c  .create_css_styl
-0000de30: 655f 6672 6f6d 5f61 7474 7269 6275 7465  e_from_attribute
-0000de40: 5f6f 665f 626f 6479 5f65 6c65 6d65 6e74  _of_body_element
-0000de50: 2865 6c29 0a20 2020 2020 2020 2020 2020  (el).           
-0000de60: 2069 6620 636f 6e64 6974 696f 6e3a 0a20   if condition:. 
-0000de70: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000de80: 6620 6373 735f 7374 796c 652e 6f62 6579  f css_style.obey
-0000de90: 7328 636f 6e64 6974 696f 6e29 3a0a 2020  s(condition):.  
-0000dea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000deb0: 2020 6966 2072 656d 6f76 653a 0a20 2020    if remove:.   
-0000dec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ded0: 2020 2020 2063 6c73 2e72 656d 6f76 655f       cls.remove_
-0000dee0: 656c 656d 5f6b 6565 705f 7461 696c 2865  elem_keep_tail(e
-0000def0: 6c29 0a0a 2020 2020 4063 6c61 7373 6d65  l)..    @classme
-0000df00: 7468 6f64 0a20 2020 2064 6566 2072 656d  thod.    def rem
-0000df10: 6f76 655f 6865 6164 6572 735f 616e 645f  ove_headers_and_
-0000df20: 666f 6f74 6572 735f 7573 696e 675f 7064  footers_using_pd
-0000df30: 666d 696e 6572 5f63 6f6f 7264 7328 636c  fminer_coords(cl
-0000df40: 732c 2072 6566 5f65 6c65 6d2c 2070 6167  s, ref_elem, pag
-0000df50: 6573 697a 652c 2068 6561 6465 725f 6865  esize, header_he
-0000df60: 6967 6874 2c20 666f 6f74 6572 5f68 6569  ight, footer_hei
-0000df70: 6768 742c 0a20 2020 2020 2020 2020 2020  ght,.           
-0000df80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000df90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dfa0: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-0000dfb0: 726b 6572 5f78 7061 7468 2c20 7061 6765  rker_xpath, page
-0000dfc0: 5f74 6f70 733d 4e6f 6e65 293a 0a20 2020  _tops=None):.   
-0000dfd0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000dfe0: 204e 4f54 2043 4f4d 504c 4554 4520 2d20   NOT COMPLETE - 
-0000dff0: 7468 6572 6520 6172 6520 6e6f 2066 6f6f  there are no foo
-0000e000: 7465 7273 2062 6563 6175 7365 206f 6620  ters because of 
-0000e010: 7468 6520 636f 6f72 6469 6e61 7465 2073  the coordinate s
-0000e020: 7973 7465 6d2e 0a0a 2020 2020 2020 2020  ystem...        
-0000e030: 4d61 7962 6520 6d6f 7665 2074 6f20 4854  Maybe move to HT
-0000e040: 4d4c 5469 6479 0a0a 2020 2020 2020 2020  MLTidy..        
-0000e050: 7468 6520 4074 6f70 2072 6570 7265 7365  the @top represe
-0000e060: 6e74 7320 7468 6520 792d 636f 6f72 6469  nts the y-coordi
-0000e070: 6e61 7465 2066 726f 6d20 7468 6520 7374  nate from the st
-0000e080: 6172 7420 6f66 2074 6865 2064 6f63 756d  art of the docum
-0000e090: 656e 7420 2870 6466 6d69 6e65 723f 292e  ent (pdfminer?).
-0000e0a0: 0a20 2020 2020 2020 2074 6869 7320 6d65  .        this me
-0000e0b0: 616e 7320 7765 2068 6176 6520 746f 2073  ans we have to s
-0000e0c0: 7562 7472 6163 7420 7061 6765 7369 7a65  ubtract pagesize
-0000e0d0: 7320 6672 6f6d 2069 742e 0a20 2020 2020  s from it..     
-0000e0e0: 2020 2022 2222 0a20 2020 2020 2020 2064     """.        d
-0000e0f0: 6562 7567 203d 2046 616c 7365 0a20 2020  ebug = False.   
-0000e100: 2020 2020 2065 6c65 6d73 203d 2072 6566       elems = ref
-0000e110: 5f65 6c65 6d2e 7870 6174 6828 6d61 726b  _elem.xpath(mark
-0000e120: 6572 5f78 7061 7468 290a 0a20 2020 2020  er_xpath)..     
-0000e130: 2020 206c 6173 745f 746f 7020 3d20 300a     last_top = 0.
-0000e140: 2020 2020 2020 2020 666f 7220 656c 656d          for elem
-0000e150: 2069 6e20 7265 665f 656c 656d 2e78 7061   in ref_elem.xpa
-0000e160: 7468 2822 2f2f 2a5b 4073 7479 6c65 5d22  th("//*[@style]"
-0000e170: 293a 0a20 2020 2020 2020 2020 2020 2079  ):.            y
-0000e180: 636f 6f72 6430 203d 2048 746d 6c55 7469  coord0 = HtmlUti
-0000e190: 6c2e 6765 745f 7930 2865 6c65 6d29 0a20  l.get_y0(elem). 
-0000e1a0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0000e1b0: 7420 7963 6f6f 7264 303a 0a20 2020 2020  t ycoord0:.     
-0000e1c0: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-0000e1d0: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
-0000e1e0: 7465 7874 203d 2058 6d6c 4c69 622e 6765  text = XmlLib.ge
-0000e1f0: 745f 7465 7874 2865 6c65 6d29 2e73 7472  t_text(elem).str
-0000e200: 6970 2829 0a20 2020 2020 2020 2020 2020  ip().           
-0000e210: 2070 6167 655f 746f 705f 7920 3d20 4874   page_top_y = Ht
-0000e220: 6d6c 5574 696c 2e67 6574 5f6c 6172 6765  mlUtil.get_large
-0000e230: 7374 5f63 6f6f 7264 5f6c 6573 735f 7468  st_coord_less_th
-0000e240: 616e 2870 6167 655f 746f 7073 2c20 7963  an(page_tops, yc
-0000e250: 6f6f 7264 3029 0a20 2020 2020 2020 2020  oord0).         
-0000e260: 2020 2069 6620 7061 6765 5f74 6f70 5f79     if page_top_y
-0000e270: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0000e280: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0000e290: 6622 6361 6e6e 6f74 2066 696e 6420 7061  f"cannot find pa
-0000e2a0: 6765 2074 6f70 207b 7963 6f6f 7264 307d  ge top {ycoord0}
-0000e2b0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0000e2c0: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
-0000e2d0: 2020 2020 2020 2020 7061 6765 5f74 6f70          page_top
-0000e2e0: 5f79 203d 2066 6c6f 6174 2870 6167 655f  _y = float(page_
-0000e2f0: 746f 705f 7929 0a20 2020 2020 2020 2020  top_y).         
-0000e300: 2020 2079 636f 6f72 6420 3d20 7963 6f6f     ycoord = ycoo
-0000e310: 7264 3020 2d20 7061 6765 5f74 6f70 5f79  rd0 - page_top_y
-0000e320: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-0000e330: 7072 696e 7428 6622 544f 5020 7b79 636f  print(f"TOP {yco
-0000e340: 6f72 6430 7d20 7b79 636f 6f72 647d 207b  ord0} {ycoord} {
-0000e350: 7061 6765 7369 7a65 7d20 7b79 636f 6f72  pagesize} {ycoor
-0000e360: 6420 2520 7061 6765 7369 7a65 7d22 290a  d % pagesize}").
-0000e370: 2020 2020 2020 2020 2020 2020 696e 5f74              in_t
-0000e380: 6f70 203d 2079 636f 6f72 6420 3c20 6865  op = ycoord < he
-0000e390: 6164 6572 5f68 6569 6768 740a 2020 2020  ader_height.    
-0000e3a0: 2020 2020 2020 2020 6966 2069 6e5f 746f          if in_to
-0000e3b0: 703a 0a20 2020 2020 2020 2020 2020 2020  p:.             
-0000e3c0: 2020 2069 6620 6465 6275 673a 0a20 2020     if debug:.   
-0000e3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e3e0: 2070 7269 6e74 2866 2254 4f50 2020 7b74   print(f"TOP  {t
-0000e3f0: 6578 747d 2229 0a20 2020 2020 2020 2020  ext}").         
-0000e400: 2020 2069 6e5f 626f 7474 6f6d 203d 2079     in_bottom = y
-0000e410: 636f 6f72 6420 3e20 7061 6765 7369 7a65  coord > pagesize
-0000e420: 5b30 5d20 2d20 666f 6f74 6572 5f68 6569  [0] - footer_hei
-0000e430: 6768 740a 2020 2020 2020 2020 2020 2020  ght.            
-0000e440: 6966 2069 6e5f 626f 7474 6f6d 3a0a 2020  if in_bottom:.  
-0000e450: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000e460: 2064 6562 7567 3a0a 2020 2020 2020 2020   debug:.        
-0000e470: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0000e480: 7428 6622 424f 5454 4f4d 2020 7b74 6578  t(f"BOTTOM  {tex
-0000e490: 747d 2229 0a20 2020 2020 2020 2020 2020  t}").           
-0000e4a0: 2069 6620 696e 5f74 6f70 206f 7220 696e   if in_top or in
-0000e4b0: 5f62 6f74 746f 6d3a 0a20 2020 2020 2020  _bottom:.       
-0000e4c0: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-0000e4d0: 7465 7874 2e73 7472 6970 2829 2920 3e20  text.strip()) > 
-0000e4e0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-0000e4f0: 2020 2020 2020 206c 6f67 6769 6e67 2e77         logging.w
-0000e500: 6172 6e69 6e67 2866 2272 656d 6f76 696e  arning(f"removin
-0000e510: 6720 746f 7020 7465 7874 207b 7465 7874  g top text {text
-0000e520: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-0000e530: 2020 2020 636c 732e 7265 6d6f 7665 5f65      cls.remove_e
-0000e540: 6c65 6d5f 6b65 6570 5f74 6169 6c28 656c  lem_keep_tail(el
-0000e550: 656d 290a 2020 2020 2020 2020 2020 2020  em).            
-0000e560: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000e570: 2020 2020 2020 2320 736b 6970 7065 640a        # skipped.
-0000e580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e590: 7061 7373 0a0a 2020 2020 4063 6c61 7373  pass..    @class
-0000e5a0: 6d65 7468 6f64 0a20 2020 2064 6566 2067  method.    def g
-0000e5b0: 6574 5f6c 6172 6765 7374 5f63 6f6f 7264  et_largest_coord
-0000e5c0: 5f6c 6573 735f 7468 616e 2863 6c73 2c20  _less_than(cls, 
-0000e5d0: 7061 6765 5f74 6f70 732c 2063 6f6f 7264  page_tops, coord
-0000e5e0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-0000e5f0: 2020 2020 2020 2069 7465 7261 7465 2074         iterate t
-0000e600: 6872 6f75 6768 2073 6f72 7465 6420 6c69  hrough sorted li
-0000e610: 7374 206f 6620 7061 6765 5f74 6f70 7320  st of page_tops 
-0000e620: 616e 6420 6669 6e64 2074 6865 206c 6172  and find the lar
-0000e630: 6765 7374 206c 6573 7320 7468 616e 2063  gest less than c
-0000e640: 6f6f 7264 0a20 2020 2020 2020 203a 7061  oord.        :pa
-0000e650: 7261 6d20 7061 6765 5f74 6f70 733a 2073  ram page_tops: s
-0000e660: 6f72 7465 6420 696e 6372 6561 7369 6e67  orted increasing
-0000e670: 206c 6973 7420 6f66 2070 6167 6520 746f   list of page to
-0000e680: 7073 0a20 2020 2020 2020 203a 7061 7261  ps.        :para
-0000e690: 6d20 636f 6f72 643a 2061 6374 7561 6c20  m coord: actual 
-0000e6a0: 636f 6f72 6469 6e61 7465 0a20 2020 2020  coordinate.     
-0000e6b0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-0000e6c0: 6620 7061 6765 5f74 6f70 7320 6973 204e  f page_tops is N
-0000e6d0: 6f6e 6520 6f72 2063 6f6f 7264 2069 7320  one or coord is 
-0000e6e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0000e6f0: 2020 7265 7475 726e 204e 6f6e 650a 2020    return None.  
-0000e700: 2020 2020 2020 666f 7220 692c 2070 6167        for i, pag
-0000e710: 655f 746f 7020 696e 2065 6e75 6d65 7261  e_top in enumera
-0000e720: 7465 2870 6167 655f 746f 7073 293a 0a20  te(page_tops):. 
-0000e730: 2020 2020 2020 2020 2020 2069 6620 666c             if fl
-0000e740: 6f61 7428 7061 6765 5f74 6f70 2920 3e20  oat(page_top) > 
-0000e750: 666c 6f61 7428 636f 6f72 6429 3a0a 2020  float(coord):.  
-0000e760: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000e770: 2069 203d 3d20 303a 0a20 2020 2020 2020   i == 0:.       
-0000e780: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000e790: 7572 6e20 4e6f 6e65 0a20 2020 2020 2020  urn None.       
-0000e7a0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000e7b0: 7061 6765 5f74 6f70 735b 6920 2d20 315d  page_tops[i - 1]
-0000e7c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000e7d0: 4e6f 6e65 0a0a 2020 2020 4063 6c61 7373  None..    @class
-0000e7e0: 6d65 7468 6f64 0a20 2020 2064 6566 2072  method.    def r
-0000e7f0: 656d 6f76 655f 6c68 5f6c 696e 655f 6e75  emove_lh_line_nu
-0000e800: 6d62 6572 7328 636c 732c 2072 6566 5f65  mbers(cls, ref_e
-0000e810: 6c65 6d29 3a0a 2020 2020 2020 2020 636c  lem):.        cl
-0000e820: 732e 6669 6e64 5f65 6c65 6d65 6e74 735f  s.find_elements_
-0000e830: 7769 7468 5f73 7479 6c65 2872 6566 5f65  with_style(ref_e
-0000e840: 6c65 6d2c 2022 2e2f 2f2a 5b40 7374 796c  lem, ".//*[@styl
-0000e850: 655d 222c 2022 6c65 6674 3c34 3922 2c20  e]", "left<49", 
-0000e860: 7265 6d6f 7665 3d54 7275 6529 0a20 2020  remove=True).   
-0000e870: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000e880: 204d 6179 6265 206d 6f76 6520 746f 2048   Maybe move to H
-0000e890: 544d 4c54 6964 790a 2020 2020 2020 2020  TMLTidy.        
-0000e8a0: 2222 220a 0a20 2020 2040 636c 6173 736d  """..    @classm
-0000e8b0: 6574 686f 640a 2020 2020 6465 6620 7265  ethod.    def re
-0000e8c0: 6d6f 7665 5f61 7474 7269 6275 7465 2863  move_attribute(c
-0000e8d0: 6c73 2c20 656c 656d 2c20 6174 745f 6e61  ls, elem, att_na
-0000e8e0: 6d65 293a 0a20 2020 2020 2020 2022 2222  me):.        """
-0000e8f0: 0a20 2020 2020 2020 2072 656d 6f76 6573  .        removes
-0000e900: 2061 7474 7269 6275 7465 2077 6974 6820   attribute with 
-0000e910: 6769 7665 6e20 6e61 6d65 0a20 2020 2020  given name.     
-0000e920: 2020 2049 6620 6e6f 7420 7072 6573 656e     If not presen
-0000e930: 742c 206e 6f2d 6f70 0a20 2020 2020 2020  t, no-op.       
-0000e940: 203a 7061 7261 6d20 656c 656d 3a20 656c   :param elem: el
-0000e950: 656d 656e 7420 636f 6e74 6169 6e69 6e67  ement containing
-0000e960: 2061 7474 7269 6275 7465 0a20 2020 2020   attribute.     
-0000e970: 2020 203a 7061 7261 6d20 6174 745f 6e61     :param att_na
-0000e980: 6d65 3a20 6e61 6d65 206f 6620 6174 7472  me: name of attr
-0000e990: 6962 7574 650a 2020 2020 2020 2020 3a72  ibute.        :r
-0000e9a0: 6574 7572 6e3a 204e 6f6e 650a 2020 2020  eturn: None.    
-0000e9b0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000e9c0: 2222 220a 2020 2020 2020 2020 726f 6f74  """.        root
-0000e9d0: 2e61 7474 7269 622e 706f 7028 2278 797a  .attrib.pop("xyz
-0000e9e0: 222c 204e 6f6e 6529 2022 2222 0a20 2020  ", None) """.   
-0000e9f0: 2020 2020 2069 6620 656c 656d 2069 7320       if elem is 
-0000ea00: 4e6f 6e65 206f 7220 6174 745f 6e61 6d65  None or att_name
-0000ea10: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0000ea20: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
-0000ea30: 2020 2020 2065 6c65 6d2e 6174 7472 6962       elem.attrib
-0000ea40: 2e70 6f70 2861 7474 5f6e 616d 652c 204e  .pop(att_name, N
-0000ea50: 6f6e 6529 0a0a 2020 2020 4063 6c61 7373  one)..    @class
-0000ea60: 6d65 7468 6f64 0a20 2020 2064 6566 2072  method.    def r
-0000ea70: 656d 6f76 655f 7374 796c 655f 6174 7472  emove_style_attr
-0000ea80: 6962 7574 6528 636c 732c 2072 6566 5f65  ibute(cls, ref_e
-0000ea90: 6c65 6d2c 2073 7479 6c65 5f6e 616d 6529  lem, style_name)
-0000eaa0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0000eab0: 2020 2020 2020 4d61 7962 6520 6d6f 7665        Maybe move
-0000eac0: 2074 6f20 4854 4d4c 5469 6479 0a20 2020   to HTMLTidy.   
-0000ead0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-0000eae0: 2020 656c 656d 7320 3d20 7265 665f 656c    elems = ref_el
-0000eaf0: 656d 2e78 7061 7468 2822 2e2f 2f2a 2229  em.xpath(".//*")
-0000eb00: 0a20 2020 2020 2020 2066 6f72 2065 6c20  .        for el 
-0000eb10: 696e 2065 6c65 6d73 3a0a 2020 2020 2020  in elems:.      
-0000eb20: 2020 2020 2020 6373 735f 7374 796c 6520        css_style 
-0000eb30: 3d20 4353 5353 7479 6c65 2e63 7265 6174  = CSSStyle.creat
-0000eb40: 655f 6373 735f 7374 796c 655f 6672 6f6d  e_css_style_from
-0000eb50: 5f61 7474 7269 6275 7465 5f6f 665f 626f  _attribute_of_bo
-0000eb60: 6479 5f65 6c65 6d65 6e74 2865 6c29 0a20  dy_element(el). 
-0000eb70: 2020 2020 2020 2020 2020 2069 6620 6373             if cs
-0000eb80: 735f 7374 796c 652e 6e61 6d65 5f76 616c  s_style.name_val
-0000eb90: 7565 5f64 6963 742e 6765 7428 7374 796c  ue_dict.get(styl
-0000eba0: 655f 6e61 6d65 293a 0a20 2020 2020 2020  e_name):.       
-0000ebb0: 2020 2020 2020 2020 2063 7373 5f73 7479           css_sty
-0000ebc0: 6c65 2e6e 616d 655f 7661 6c75 655f 6469  le.name_value_di
-0000ebd0: 6374 2e70 6f70 2873 7479 6c65 5f6e 616d  ct.pop(style_nam
-0000ebe0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-0000ebf0: 2020 2063 7373 5f73 7479 6c65 2e61 7070     css_style.app
-0000ec00: 6c79 5f74 6f28 656c 290a 0a20 2020 2040  ly_to(el)..    @
-0000ec10: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-0000ec20: 6465 6620 7265 6d6f 7665 5f6c 6172 6765  def remove_large
-0000ec30: 5f66 6f6e 7465 645f 656c 656d 656e 7473  _fonted_elements
-0000ec40: 2863 6c73 2c20 7265 665f 656c 656d 293a  (cls, ref_elem):
-0000ec50: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000ec60: 2020 2020 204d 6179 6265 206d 6f76 6520       Maybe move 
-0000ec70: 746f 2048 544d 4c54 6964 790a 2020 2020  to HTMLTidy.    
-0000ec80: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000ec90: 636c 732e 6669 6e64 5f65 6c65 6d65 6e74  cls.find_element
-0000eca0: 735f 7769 7468 5f73 7479 6c65 2872 6566  s_with_style(ref
-0000ecb0: 5f65 6c65 6d2c 2022 2e2f 2f2a 5b40 7374  _elem, ".//*[@st
-0000ecc0: 796c 655d 222c 2022 666f 6e74 2d73 697a  yle]", "font-siz
-0000ecd0: 653e 3330 222c 2072 656d 6f76 653d 5472  e>30", remove=Tr
-0000ece0: 7565 290a 0a20 2020 2040 636c 6173 736d  ue)..    @classm
-0000ecf0: 6574 686f 640a 2020 2020 6465 6620 6669  ethod.    def fi
-0000ed00: 6e64 5f63 6f6e 7374 616e 745f 636f 6f72  nd_constant_coor
-0000ed10: 6469 6e61 7465 5f6d 6172 6b65 7273 2863  dinate_markers(c
-0000ed20: 6c73 2c20 7265 665f 656c 656d 2c20 7870  ls, ref_elem, xp
-0000ed30: 6174 682c 2073 7479 6c65 3d22 746f 7022  ath, style="top"
-0000ed40: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-0000ed50: 2020 2020 2020 2066 696e 6473 2061 206c         finds a l
-0000ed60: 696e 6520 7769 7468 2063 6f6e 7374 616e  ine with constan
-0000ed70: 7420 6469 6666 6572 656e 6365 2066 726f  t difference fro
-0000ed80: 6d20 746f 7020 6f66 2070 6167 650a 3c64  m top of page.<d
-0000ed90: 6976 2073 7479 6c65 3d22 746f 703a 2035  iv style="top: 5
-0000eda0: 3070 783b 223e 3c61 206e 616d 653d 2231  0px;"><a name="1
-0000edb0: 223e 5061 6765 2031 3c2f 613e 3c2f 6469  ">Page 1</a></di
-0000edc0: 763e 0a20 2020 2020 2020 2022 2222 0a20  v>.        """. 
-0000edd0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000ede0: 2020 204d 6179 6265 206d 6f76 6520 746f     Maybe move to
-0000edf0: 2048 544d 4c54 6964 790a 2020 2020 2020   HTMLTidy.      
-0000ee00: 2020 2222 220a 0a20 2020 2020 2020 2065    """..        e
-0000ee10: 6c65 6d73 203d 2072 6566 5f65 6c65 6d2e  lems = ref_elem.
-0000ee20: 7870 6174 6828 7870 6174 6829 0a20 2020  xpath(xpath).   
-0000ee30: 2020 2020 2063 6f6f 7264 7320 3d20 5b5d       coords = []
-0000ee40: 0a20 2020 2020 2020 2066 6f72 2065 6c65  .        for ele
-0000ee50: 6d20 696e 2065 6c65 6d73 3a0a 2020 2020  m in elems:.    
-0000ee60: 2020 2020 2020 2020 6373 735f 7374 796c          css_styl
-0000ee70: 6520 3d20 4353 5353 7479 6c65 2e63 7265  e = CSSStyle.cre
-0000ee80: 6174 655f 6373 735f 7374 796c 655f 6672  ate_css_style_fr
-0000ee90: 6f6d 5f61 7474 7269 6275 7465 5f6f 665f  om_attribute_of_
-0000eea0: 626f 6479 5f65 6c65 6d65 6e74 2865 6c65  body_element(ele
-0000eeb0: 6d29 0a20 2020 2020 2020 2020 2020 2063  m).            c
-0000eec0: 6f6f 7264 203d 2063 7373 5f73 7479 6c65  oord = css_style
-0000eed0: 2e6e 616d 655f 7661 6c75 655f 6469 6374  .name_value_dict
-0000eee0: 2e67 6574 2873 7479 6c65 290a 2020 2020  .get(style).    
-0000eef0: 2020 2020 2020 2020 6966 2063 6f6f 7264          if coord
-0000ef00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000ef10: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0000ef20: 2020 2020 2020 2020 2020 2063 6f6f 7264             coord
-0000ef30: 732e 6170 7065 6e64 2866 6c6f 6174 2863  s.append(float(c
-0000ef40: 6f6f 7264 5b3a 2d32 5d29 290a 2020 2020  oord[:-2])).    
-0000ef50: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-0000ef60: 7074 2045 7863 6570 7469 6f6e 3a0a 2020  pt Exception:.  
-0000ef70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef80: 2020 6c6f 6767 696e 672e 7761 726e 696e    logging.warnin
-0000ef90: 6728 6622 6361 6e6e 6f74 2070 6172 7365  g(f"cannot parse
-0000efa0: 207b 636f 6f72 647d 2066 6f72 207b 7374   {coord} for {st
-0000efb0: 796c 657d 2229 0a20 2020 2020 2020 2069  yle}").        i
-0000efc0: 6620 6e6f 7420 636f 6f72 6473 3a0a 2020  f not coords:.  
-0000efd0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000efe0: 204e 6f6e 652c 204e 6f6e 652c 205b 5d0a   None, None, [].
-0000eff0: 2020 2020 2020 2020 6e70 5f63 6f6f 7264          np_coord
-0000f000: 7320 3d20 6e70 2e61 7272 6179 2863 6f6f  s = np.array(coo
-0000f010: 7264 7329 0a0a 2020 2020 2020 2020 7820  rds)..        x 
-0000f020: 3d20 6e70 2e61 7272 6179 2872 616e 6765  = np.array(range
-0000f030: 286e 705f 636f 6f72 6473 2e73 697a 6529  (np_coords.size)
-0000f040: 292e 7265 7368 6170 6528 282d 312c 2031  ).reshape((-1, 1
-0000f050: 2929 0a20 2020 2020 2020 206d 6f64 656c  )).        model
-0000f060: 203d 204c 696e 6561 7252 6567 7265 7373   = LinearRegress
-0000f070: 696f 6e28 292e 6669 7428 782c 2063 6f6f  ion().fit(x, coo
-0000f080: 7264 7329 0a20 2020 2020 2020 2072 5f73  rds).        r_s
-0000f090: 7120 3d20 6d6f 6465 6c2e 7363 6f72 6528  q = model.score(
-0000f0a0: 782c 2063 6f6f 7264 7329 0a20 2020 2020  x, coords).     
-0000f0b0: 2020 2069 6620 725f 7371 203c 2030 2e39     if r_sq < 0.9
-0000f0c0: 383a 0a20 2020 2020 2020 2020 2020 206c  8:.            l
-0000f0d0: 6f67 6769 6e67 2e77 6172 6e69 6e67 2866  ogging.warning(f
-0000f0e0: 2263 616e 6e6f 7420 6361 6c63 756c 6174  "cannot calculat
-0000f0f0: 6520 6f66 6673 6574 2072 656c 6961 626c  e offset reliabl
-0000f100: 7922 290a 2020 2020 2020 2020 7265 7475  y").        retu
-0000f110: 726e 206d 6f64 656c 2e69 6e74 6572 6365  rn model.interce
-0000f120: 7074 5f2c 206d 6f64 656c 2e63 6f65 665f  pt_, model.coef_
-0000f130: 2c20 6e70 5f63 6f6f 7264 730a 0a20 2020  , np_coords..   
-0000f140: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-0000f150: 2020 6465 6620 7265 6d6f 7665 5f75 6e77    def remove_unw
-0000f160: 616e 7465 6473 2863 6c73 2c20 746f 705f  anteds(cls, top_
-0000f170: 656c 656d 2c20 756e 7761 6e74 6564 7329  elem, unwanteds)
-0000f180: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0000f190: 2020 2020 2020 4d61 7962 6520 6d6f 7665        Maybe move
-0000f1a0: 2074 6f20 4854 4d4c 5469 6479 0a20 2020   to HTMLTidy.   
-0000f1b0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000f1c0: 2069 6620 6e6f 7420 756e 7761 6e74 6564   if not unwanted
-0000f1d0: 733a 0a20 2020 2020 2020 2020 2020 206c  s:.            l
-0000f1e0: 6f67 6769 6e67 2e77 6172 6e69 6e67 2866  ogging.warning(f
-0000f1f0: 226e 6f20 756e 7761 6e74 6564 7320 746f  "no unwanteds to
-0000f200: 2072 656d 6f76 6522 290a 2020 2020 2020   remove").      
-0000f210: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
-0000f220: 2020 2020 2066 6f72 206b 6579 2069 6e20       for key in 
-0000f230: 756e 7761 6e74 6564 733a 0a20 2020 2020  unwanteds:.     
-0000f240: 2020 2020 2020 2075 6e77 616e 7465 6420         unwanted 
-0000f250: 3d20 756e 7761 6e74 6564 735b 6b65 795d  = unwanteds[key]
-0000f260: 0a20 2020 2020 2020 2020 2020 2078 7061  .            xpa
-0000f270: 7468 203d 2075 6e77 616e 7465 645b 555f  th = unwanted[U_
-0000f280: 5850 4154 485d 0a20 2020 2020 2020 2020  XPATH].         
-0000f290: 2020 2069 6620 7870 6174 683a 0a20 2020     if xpath:.   
-0000f2a0: 2020 2020 2020 2020 2020 2020 2072 6567               reg
-0000f2b0: 6578 203d 2075 6e77 616e 7465 645b 555f  ex = unwanted[U_
-0000f2c0: 5245 4745 585d 0a20 2020 2020 2020 2020  REGEX].         
-0000f2d0: 2020 2020 2020 2072 6567 6578 5f63 6f6d         regex_com
-0000f2e0: 7020 3d20 7265 2e63 6f6d 7069 6c65 2872  p = re.compile(r
-0000f2f0: 6567 6578 2920 6966 2072 6567 6578 2065  egex) if regex e
-0000f300: 6c73 6520 4e6f 6e65 0a20 2020 2020 2020  lse None.       
-0000f310: 2020 2020 2020 2020 2065 6c65 6d73 203d           elems =
-0000f320: 2074 6f70 5f65 6c65 6d2e 7870 6174 6828   top_elem.xpath(
-0000f330: 7870 6174 6829 0a20 2020 2020 2020 2020  xpath).         
-0000f340: 2020 2020 2020 2066 6f72 2065 6c65 6d20         for elem 
-0000f350: 696e 2065 6c65 6d73 3a0a 2020 2020 2020  in elems:.      
-0000f360: 2020 2020 2020 2020 2020 2020 2020 7465                te
-0000f370: 7874 203d 2048 746d 6c55 7469 6c2e 6765  xt = HtmlUtil.ge
-0000f380: 745f 7465 7874 5f63 6f6e 7465 6e74 2865  t_text_content(e
-0000f390: 6c65 6d29 0a20 2020 2020 2020 2020 2020  lem).           
-0000f3a0: 2020 2020 2020 2020 206d 6174 6368 6564           matched
-0000f3b0: 203d 2072 6567 6578 5f63 6f6d 702e 7365   = regex_comp.se
-0000f3c0: 6172 6368 2874 6578 7429 2069 6620 7265  arch(text) if re
-0000f3d0: 6765 785f 636f 6d70 2065 6c73 6520 5472  gex_comp else Tr
-0000f3e0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-0000f3f0: 2020 2020 2020 2069 6620 6d61 7463 6865         if matche
-0000f400: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
-0000f410: 2020 2020 2020 2020 2020 2063 6c73 2e72             cls.r
-0000f420: 656d 6f76 655f 656c 656d 5f6b 6565 705f  emove_elem_keep_
-0000f430: 7461 696c 2865 6c65 6d29 0a0a 2020 2020  tail(elem)..    
-0000f440: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-0000f450: 2064 6566 2072 656d 6f76 655f 6e65 776c   def remove_newl
-0000f460: 696e 6573 2863 6c73 2c20 656c 656d 293a  ines(cls, elem):
-0000f470: 0a20 2020 2020 2020 2022 2222 7265 6d6f  .        """remo
-0000f480: 7665 205c 6e22 2222 0a20 2020 2020 2020  ve \n""".       
-0000f490: 2022 2222 0a20 2020 2020 2020 204d 6179   """.        May
-0000f4a0: 6265 206d 6f76 6520 746f 2048 544d 4c54  be move to HTMLT
-0000f4b0: 6964 790a 2020 2020 2020 2020 2222 220a  idy.        """.
-0000f4c0: 0a20 2020 2020 2020 2066 6f72 2065 6c20  .        for el 
-0000f4d0: 696e 2065 6c65 6d2e 7870 6174 6828 222e  in elem.xpath(".
-0000f4e0: 2f2f 2a5b 6e6f 7428 2a29 5d22 293a 0a20  //*[not(*)]"):. 
-0000f4f0: 2020 2020 2020 2020 2020 2074 6578 7420             text 
-0000f500: 3d20 4874 6d6c 5574 696c 2e67 6574 5f74  = HtmlUtil.get_t
-0000f510: 6578 745f 636f 6e74 656e 7428 656c 290a  ext_content(el).
-0000f520: 2020 2020 2020 2020 2020 2020 7465 7874              text
-0000f530: 3120 3d20 7465 7874 2e72 6570 6c61 6365  1 = text.replace
-0000f540: 2827 5c6e 272c 2027 2729 0a20 2020 2020  ('\n', '').     
-0000f550: 2020 2020 2020 2069 6620 7465 7874 3120         if text1 
-0000f560: 213d 2074 6578 743a 0a20 2020 2020 2020  != text:.       
-0000f570: 2020 2020 2020 2020 2065 6c2e 7465 7874           el.text
-0000f580: 203d 2074 6578 7431 0a0a 2020 2020 4063   = text1..    @c
-0000f590: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-0000f5a0: 6566 2072 656d 6f76 655f 7374 796c 6528  ef remove_style(
-0000f5b0: 636c 732c 2078 7061 7468 5f72 6f6f 745f  cls, xpath_root_
-0000f5c0: 656c 656d 2c20 6e61 6d65 7329 3a0a 2020  elem, names):.  
-0000f5d0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000f5e0: 2020 7265 6d6f 7665 7320 6e61 6d65 2d76    removes name-v
-0000f5f0: 616c 7565 2070 6169 7273 2066 726f 6d20  alue pairs from 
-0000f600: 6373 732d 7374 796c 6520 616e 6420 7265  css-style and re
-0000f610: 6170 706c 7920 746f 2078 7061 7468 2765  apply to xpath'e
-0000f620: 6420 656c 656d 656e 7473 2222 220a 2020  d elements""".  
-0000f630: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000f640: 2020 4d61 7962 6520 6d6f 7665 2074 6f20    Maybe move to 
-0000f650: 4854 4d4c 5469 6479 0a20 2020 2020 2020  HTMLTidy.       
-0000f660: 2022 2222 0a0a 2020 2020 2020 2020 7870   """..        xp
-0000f670: 6174 6820 3d20 6622 2e2f 2f2a 5b40 7374  ath = f".//*[@st
-0000f680: 796c 655d 220a 2020 2020 2020 2020 7472  yle]".        tr
-0000f690: 793a 0a20 2020 2020 2020 2020 2020 2073  y:.            s
-0000f6a0: 7479 6c65 645f 656c 656d 7320 3d20 7870  tyled_elems = xp
-0000f6b0: 6174 685f 726f 6f74 5f65 6c65 6d2e 7870  ath_root_elem.xp
-0000f6c0: 6174 6828 7870 6174 6829 0a20 2020 2020  ath(xpath).     
-0000f6d0: 2020 2065 7863 6570 7420 4554 2e58 5061     except ET.XPa
-0000f6e0: 7468 4576 616c 4572 726f 7220 6173 2078  thEvalError as x
-0000f6f0: 7065 653a 0a20 2020 2020 2020 2020 2020  pee:.           
-0000f700: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-0000f710: 7228 6622 4261 6420 7870 6174 6820 7b78  r(f"Bad xpath {x
-0000f720: 7061 7468 7d22 290a 0a20 2020 2020 2020  path}")..       
-0000f730: 2066 6f72 2073 7479 6c65 645f 656c 656d   for styled_elem
-0000f740: 2069 6e20 7374 796c 6564 5f65 6c65 6d73   in styled_elems
-0000f750: 3a0a 2020 2020 2020 2020 2020 2020 6373  :.            cs
-0000f760: 735f 7374 796c 6520 3d20 4353 5353 7479  s_style = CSSSty
-0000f770: 6c65 2e63 7265 6174 655f 6373 735f 7374  le.create_css_st
-0000f780: 796c 655f 6672 6f6d 5f61 7474 7269 6275  yle_from_attribu
-0000f790: 7465 5f6f 665f 626f 6479 5f65 6c65 6d65  te_of_body_eleme
-0000f7a0: 6e74 2873 7479 6c65 645f 656c 656d 290a  nt(styled_elem).
-0000f7b0: 2020 2020 2020 2020 2020 2020 6373 735f              css_
-0000f7c0: 7374 796c 652e 7265 6d6f 7665 286e 616d  style.remove(nam
-0000f7d0: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
-0000f7e0: 6373 735f 7374 796c 652e 6170 706c 795f  css_style.apply_
-0000f7f0: 746f 2873 7479 6c65 645f 656c 656d 290a  to(styled_elem).
-0000f800: 2020 2020 2020 2020 2020 2020 7374 796c              styl
-0000f810: 6520 3d20 4874 6d6c 5374 796c 652e 6765  e = HtmlStyle.ge
-0000f820: 745f 6373 7373 7479 6c65 5f73 7472 696e  t_cssstyle_strin
-0000f830: 6728 7374 796c 6564 5f65 6c65 6d29 0a0a  g(styled_elem)..
-0000f840: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-0000f850: 0a20 2020 2064 6566 2065 7874 7261 6374  .    def extract
-0000f860: 5f73 7562 7374 7269 6e67 7328 636c 732c  _substrings(cls,
-0000f870: 2065 6c65 6d2c 2078 7061 7468 3d4e 6f6e   elem, xpath=Non
-0000f880: 652c 2072 6567 6578 3d4e 6f6e 652c 2072  e, regex=None, r
-0000f890: 656d 6f76 653d 4661 6c73 652c 2069 6e63  emove=False, inc
-0000f8a0: 6c75 6465 5f6e 6f6e 653d 4661 6c73 652c  lude_none=False,
-0000f8b0: 2061 6464 5f69 643d 4661 6c73 6529 3a0a   add_id=False):.
-0000f8c0: 2020 2020 2020 2020 2222 2267 6574 7320          """gets 
-0000f8d0: 7375 6273 7472 696e 6720 6672 6f6d 2062  substring from b
-0000f8e0: 6f64 7920 6f66 2074 6578 7420 696e 2065  ody of text in e
-0000f8f0: 6c65 6d0a 2020 2020 2020 2020 7265 6765  lem.        rege
-0000f900: 7820 6f66 2066 6f72 6d20 283f 503c 7072  x of form (?P<pr
-0000f910: 653e 2928 3f50 3c62 6f64 793e 2928 3f50  e>)(?P<body>)(?P
-0000f920: 3c70 6f73 743e 290a 2020 2020 2020 2020  <post>).        
-0000f930: 7072 6520 616e 6420 6f72 2070 6f73 7420  pre and or post 
-0000f940: 6361 6e20 6265 206d 6973 7369 6e67 0a20  can be missing. 
-0000f950: 2020 2020 2020 2028 5468 6572 6520 7769         (There wi
-0000f960: 6c6c 2062 6520 6265 7474 6572 2077 6179  ll be better way
-0000f970: 7320 6f66 2064 6f69 6e67 2074 6869 7321  s of doing this!
-0000f980: 290a 2020 2020 2020 2020 3a70 6172 616d  ).        :param
-0000f990: 2065 6c65 6d3a 746f 2071 7565 7279 0a20   elem:to query. 
-0000f9a0: 2020 2020 2020 203a 7061 7261 6d20 7870         :param xp
-0000f9b0: 6174 683a 2074 6f20 6669 6e64 2064 6573  ath: to find des
-0000f9c0: 6365 6e64 616e 7420 7375 6265 6c65 6d65  cendant subeleme
-0000f9d0: 6e74 0a20 2020 2020 2020 203a 7061 7261  nt.        :para
-0000f9e0: 6d20 7265 6765 783a 2074 6f20 6669 6e64  m regex: to find
-0000f9f0: 2073 7472 696e 6720 696e 2073 7562 656c   string in subel
-0000fa00: 656d 656e 7420 286d 7573 7420 6861 7665  ement (must have
-0000fa10: 2033 2063 6170 7475 7265 2067 726f 7570   3 capture group
-0000fa20: 7329 0a20 2020 2020 2020 203a 7061 7261  s).        :para
-0000fa30: 6d20 7265 6d6f 7665 3a20 7265 6d6f 7665  m remove: remove
-0000fa40: 7320 626f 6479 2074 6578 7420 616e 6420  s body text and 
-0000fa50: 6a6f 696e 7320 7072 6520 746f 2070 6f73  joins pre to pos
-0000fa60: 7420 2875 7365 2077 6974 6820 6361 7265  t (use with care
-0000fa70: 2c20 6465 6661 756c 7420 4661 6c73 6529  , default False)
-0000fa80: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0000fa90: 696e 636c 7564 655f 6e6f 6e65 3a20 4966  include_none: If
-0000faa0: 2074 7275 6520 696e 636c 7564 6520 6661   true include fa
-0000fab0: 696c 6564 206d 6174 6368 6573 2061 7320  iled matches as 
-0000fac0: 4e6f 6e65 3b20 6465 6661 756c 7420 4661  None; default Fa
-0000fad0: 6c73 650a 2020 2020 2020 2020 3a70 6172  lse.        :par
-0000fae0: 616d 5f61 6464 5f69 643a 2061 6464 2065  am_add_id: add e
-0000faf0: 7874 7261 6374 6564 2074 6578 7420 6173  xtracted text as
-0000fb00: 2061 7474 7269 6275 7465 206f 6e20 7375   attribute on su
-0000fb10: 6265 6c65 6d65 6e74 0a20 2020 2020 2020  belement.       
-0000fb20: 2069 6620 7072 6520 616e 6420 7461 696c   if pre and tail
-0000fb30: 2061 7265 2070 7265 7365 6e74 2c20 656c   are present, el
-0000fb40: 656d 2e74 6578 7420 3d3c 2070 7265 2b70  em.text =< pre+p
-0000fb50: 6f73 740a 2020 2020 2020 2020 6966 2070  ost.        if p
-0000fb60: 7265 2069 7320 6d69 7373 696e 6720 656c  re is missing el
-0000fb70: 656d 2e74 6578 7420 3d3e 2070 6f73 740a  em.text => post.
-0000fb80: 2020 2020 2020 2020 6966 2074 6169 6c20          if tail 
-0000fb90: 6973 206d 6973 7369 6e67 2065 6c65 6d2e  is missing elem.
-0000fba0: 7465 7874 203d 3e20 7072 650a 2020 2020  text => pre.    
-0000fbb0: 2020 2020 6966 2062 6f74 6820 6172 6520      if both are 
-0000fbc0: 6d69 7373 696e 6720 6e6f 2072 656d 6f76  missing no remov
-0000fbd0: 616c 0a20 2020 2020 2020 203a 7265 7475  al.        :retu
-0000fbe0: 726e 3a20 7265 6765 782e 6d61 7463 682e  rn: regex.match.
-0000fbf0: 6772 6f75 7069 6e64 6578 283f 503c 626f  groupindex(?P<bo
-0000fc00: 6479 3e29 2069 6620 6d61 7463 6865 6420  dy>) if matched 
-0000fc10: 656c 7365 204e 6f6e 650a 2020 2020 2020  else None.      
-0000fc20: 2020 2222 220a 2020 2020 2020 2020 7375    """.        su
-0000fc30: 625f 656c 656d 7320 3d20 656c 656d 2e78  b_elems = elem.x
-0000fc40: 7061 7468 2878 7061 7468 290a 2020 2020  path(xpath).    
-0000fc50: 2020 2020 7375 625f 656c 656d 203d 2073      sub_elem = s
-0000fc60: 7562 5f65 6c65 6d73 5b30 5d20 6966 206c  ub_elems[0] if l
-0000fc70: 656e 2873 7562 5f65 6c65 6d73 2920 3e20  en(sub_elems) > 
-0000fc80: 3020 656c 7365 204e 6f6e 650a 2020 2020  0 else None.    
-0000fc90: 2020 2020 7375 6273 7472 696e 6773 203d      substrings =
-0000fca0: 205b 5d0a 2020 2020 2020 2020 7265 3020   [].        re0 
-0000fcb0: 3d20 7265 2e63 6f6d 7069 6c65 2872 6567  = re.compile(reg
-0000fcc0: 6578 290a 2020 2020 2020 2020 666f 7220  ex).        for 
-0000fcd0: 7375 625f 656c 656d 2069 6e20 7375 625f  sub_elem in sub_
-0000fce0: 656c 656d 733a 0a20 2020 2020 2020 2020  elems:.         
-0000fcf0: 2020 2073 7562 7374 7269 6e67 203d 2063     substring = c
-0000fd00: 6c73 2e65 7874 7261 6374 5f73 7562 7374  ls.extract_subst
-0000fd10: 7269 6e67 2872 6530 2c20 7265 6d6f 7665  ring(re0, remove
-0000fd20: 2c20 7375 625f 656c 656d 290a 2020 2020  , sub_elem).    
-0000fd30: 2020 2020 2020 2020 6966 2073 7562 7374          if subst
-0000fd40: 7269 6e67 2061 6e64 2061 6464 5f69 643a  ring and add_id:
-0000fd50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fd60: 2073 7562 5f65 6c65 6d2e 6174 7472 6962   sub_elem.attrib
-0000fd70: 5b22 6964 225d 203d 2073 7562 7374 7269  ["id"] = substri
-0000fd80: 6e67 0a20 2020 2020 2020 2020 2020 2069  ng.            i
-0000fd90: 6620 7375 6273 7472 696e 6720 6f72 2069  f substring or i
-0000fda0: 6e63 6c75 6465 5f6e 6f6e 653a 0a20 2020  nclude_none:.   
-0000fdb0: 2020 2020 2020 2020 2020 2020 2073 7562               sub
-0000fdc0: 7374 7269 6e67 732e 6170 7065 6e64 2873  strings.append(s
-0000fdd0: 7562 7374 7269 6e67 290a 2020 2020 2020  ubstring).      
-0000fde0: 2020 7265 7475 726e 2073 7562 7374 7269    return substri
-0000fdf0: 6e67 730a 0a20 2020 2040 636c 6173 736d  ngs..    @classm
-0000fe00: 6574 686f 640a 2020 2020 6465 6620 6578  ethod.    def ex
-0000fe10: 7472 6163 745f 7375 6273 7472 696e 6728  tract_substring(
-0000fe20: 636c 732c 2072 6530 2c20 7265 6d6f 7665  cls, re0, remove
-0000fe30: 2c20 7375 625f 656c 656d 293a 0a20 2020  , sub_elem):.   
-0000fe40: 2020 2020 206d 6174 6368 203d 2072 6530       match = re0
-0000fe50: 2e6d 6174 6368 2873 7562 5f65 6c65 6d2e  .match(sub_elem.
-0000fe60: 7465 7874 290a 2020 2020 2020 2020 7375  text).        su
-0000fe70: 6273 7472 696e 6720 3d20 4e6f 6e65 0a20  bstring = None. 
-0000fe80: 2020 2020 2020 2069 6620 6d61 7463 683a         if match:
-0000fe90: 0a20 2020 2020 2020 2020 2020 2073 7562  .            sub
-0000fea0: 7374 7269 6e67 203d 206d 6174 6368 2e67  string = match.g
-0000feb0: 726f 7570 2822 626f 6479 2229 0a20 2020  roup("body").   
-0000fec0: 2020 2020 2020 2020 2069 6620 7265 6d6f           if remo
-0000fed0: 7665 3a0a 2020 2020 2020 2020 2020 2020  ve:.            
-0000fee0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0000fef0: 2020 2020 2020 2020 2020 2020 2070 7265               pre
-0000ff00: 203d 206d 6174 6368 2e67 726f 7570 2822   = match.group("
-0000ff10: 7072 6522 290a 2020 2020 2020 2020 2020  pre").          
-0000ff20: 2020 2020 2020 2020 2020 706f 7374 203d            post =
-0000ff30: 206d 6174 6368 2e67 726f 7570 2822 706f   match.group("po
-0000ff40: 7374 2229 0a20 2020 2020 2020 2020 2020  st").           
-0000ff50: 2020 2020 2020 2020 2073 7562 5f65 6c65           sub_ele
-0000ff60: 6d2e 7465 7874 203d 2070 7265 202b 2070  m.text = pre + p
-0000ff70: 6f73 740a 2020 2020 2020 2020 2020 2020  ost.            
-0000ff80: 2020 2020 6578 6365 7074 3a0a 2020 2020      except:.    
-0000ff90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ffa0: 7061 7373 0a20 2020 2020 2020 2072 6574  pass.        ret
-0000ffb0: 7572 6e20 7375 6273 7472 696e 670a 0a20  urn substring.. 
-0000ffc0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-0000ffd0: 2020 2020 6465 6620 6765 745f 666c 6f61      def get_floa
-0000ffe0: 7428 636c 732c 2065 6c65 6d2c 2061 7474  t(cls, elem, att
-0000fff0: 7269 625f 6e61 6d65 293a 0a20 2020 2020  rib_name):.     
-00010000: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00010010: 2020 2020 7661 6c20 3d20 656c 656d 2e61      val = elem.a
-00010020: 7474 7269 625b 6174 7472 6962 5f6e 616d  ttrib[attrib_nam
-00010030: 655d 0a20 2020 2020 2020 2020 2020 2072  e].            r
-00010040: 6574 7572 6e20 666c 6f61 7428 7661 6c29  eturn float(val)
-00010050: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-00010060: 4578 6365 7074 696f 6e20 6173 2065 3a0a  Exception as e:.
-00010070: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00010080: 726e 204e 6f6e 650a 0a20 2020 2040 636c  rn None..    @cl
-00010090: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-000100a0: 6620 6368 6563 6b5f 7461 6728 636c 732c  f check_tag(cls,
-000100b0: 2065 6c65 6d2c 2074 6167 293a 0a20 2020   elem, tag):.   
-000100c0: 2020 2020 2022 2222 6368 6563 6b73 2074       """checks t
-000100d0: 6861 7420 656c 656d 2069 7320 616e 2045  hat elem is an E
-000100e0: 6c65 6d65 6e74 2077 6974 6820 6769 7665  lement with give
-000100f0: 6e20 7461 6722 2222 0a20 2020 2020 2020  n tag""".       
-00010100: 2072 6574 7572 6e20 7479 7065 2865 6c65   return type(ele
-00010110: 6d29 2069 7320 4554 2e5f 456c 656d 656e  m) is ET._Elemen
-00010120: 7420 616e 6420 656c 656d 2e74 6167 203d  t and elem.tag =
-00010130: 3d20 7461 670a 0a20 2020 2040 636c 6173  = tag..    @clas
-00010140: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
-00010150: 6765 745f 6964 2863 6c73 2c20 6469 7629  get_id(cls, div)
-00010160: 3a0a 2020 2020 2020 2020 2222 2267 6574  :.        """get
-00010170: 7320 7661 6c75 6520 6f66 2022 6964 2220  s value of "id" 
-00010180: 6174 7472 6962 7574 650a 2020 2020 2020  attribute.      
-00010190: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
-000101a0: 7475 726e 204e 6f6e 6520 6966 2064 6976  turn None if div
-000101b0: 2069 7320 4e6f 6e65 2065 6c73 6520 6469   is None else di
-000101c0: 762e 6174 7472 6962 2e67 6574 2822 6964  v.attrib.get("id
-000101d0: 2229 0a0a 2020 2020 4063 6c61 7373 6d65  ")..    @classme
-000101e0: 7468 6f64 0a20 2020 2064 6566 2061 6e61  thod.    def ana
-000101f0: 6c79 7a65 5f73 7479 6c65 7328 636c 732c  lyze_styles(cls,
-00010200: 2065 6c65 6d29 3a0a 2020 2020 2020 2020   elem):.        
-00010210: 6865 6164 5f73 7479 6c65 5f65 6c65 6d73  head_style_elems
-00010220: 203d 2048 746d 6c53 7479 6c65 2e67 6574   = HtmlStyle.get
-00010230: 5f68 6561 645f 7374 796c 6573 2865 6c65  _head_styles(ele
-00010240: 6d29 0a20 2020 2020 2020 2070 7269 6e74  m).        print
-00010250: 2866 2268 6561 6420 7374 796c 6520 656c  (f"head style el
-00010260: 656d 7320 7b6c 656e 2868 6561 645f 7374  ems {len(head_st
-00010270: 796c 655f 656c 656d 7329 7d22 290a 2020  yle_elems)}").  
-00010280: 2020 2020 2020 626f 6479 5f63 6c61 7373        body_class
-00010290: 7265 6673 203d 2048 746d 6c53 7479 6c65  refs = HtmlStyle
-000102a0: 2e67 6574 5f62 6f64 795f 636c 6173 7372  .get_body_classr
-000102b0: 6566 7328 656c 656d 290a 2020 2020 2020  efs(elem).      
-000102c0: 2020 7072 696e 7428 6622 626f 6479 2063    print(f"body c
-000102d0: 6c61 7373 7265 6673 207b 6c65 6e28 626f  lassrefs {len(bo
-000102e0: 6479 5f63 6c61 7373 7265 6673 297d 2229  dy_classrefs)}")
-000102f0: 0a20 2020 2020 2020 2066 6f6e 745f 7369  .        font_si
-00010300: 7a65 5f64 6963 7420 3d20 6465 6661 756c  ze_dict = defaul
-00010310: 7464 6963 7428 6c69 7374 290a 2020 2020  tdict(list).    
-00010320: 2020 2020 6661 6d69 6c79 5f64 6963 7420      family_dict 
-00010330: 3d20 6465 6661 756c 7464 6963 7428 6c69  = defaultdict(li
-00010340: 7374 290a 2020 2020 2020 2020 666f 7220  st).        for 
-00010350: 6865 6164 5f73 7479 6c65 5f65 6c65 6d20  head_style_elem 
-00010360: 696e 2068 6561 645f 7374 796c 655f 656c  in head_style_el
-00010370: 656d 733a 0a20 2020 2020 2020 2020 2020  ems:.           
-00010380: 2068 6561 645f 7374 796c 652c 2063 7373   head_style, css
-00010390: 7374 7220 3d20 4874 6d6c 5374 796c 652e  str = HtmlStyle.
-000103a0: 6578 7472 6163 745f 636c 6173 7372 6566  extract_classref
-000103b0: 5f61 6e64 5f63 7373 7374 7269 6e67 5f66  _and_cssstring_f
-000103c0: 726f 6d5f 6874 6d6c 5f73 7479 6c65 2868  rom_html_style(h
-000103d0: 6561 645f 7374 796c 655f 656c 656d 290a  ead_style_elem).
-000103e0: 2020 2020 2020 2020 2020 2020 6373 735f              css_
-000103f0: 7374 796c 6520 3d20 4353 5353 7479 6c65  style = CSSStyle
-00010400: 2e63 7265 6174 655f 6373 735f 7374 796c  .create_css_styl
-00010410: 655f 6672 6f6d 5f63 7373 5f73 7472 696e  e_from_css_strin
-00010420: 6728 6373 7373 7472 290a 2020 2020 2020  g(cssstr).      
-00010430: 2020 2020 2020 666f 6e74 5f73 697a 6520        font_size 
-00010440: 3d20 6373 735f 7374 796c 652e 666f 6e74  = css_style.font
-00010450: 5f73 697a 650a 2020 2020 2020 2020 2020  _size.          
-00010460: 2020 666f 6e74 5f73 697a 655f 6469 6374    font_size_dict
-00010470: 5b73 7472 2866 6f6e 745f 7369 7a65 295d  [str(font_size)]
-00010480: 2e61 7070 656e 6428 6373 7373 7472 290a  .append(cssstr).
-00010490: 2020 2020 2020 2020 2020 2020 666f 6e74              font
-000104a0: 5f66 616d 696c 7920 3d20 6373 735f 7374  _family = css_st
-000104b0: 796c 652e 666f 6e74 5f66 616d 696c 790a  yle.font_family.
-000104c0: 2020 2020 2020 2020 2020 2020 6661 6d69              fami
-000104d0: 6c79 5f64 6963 745b 666f 6e74 5f66 616d  ly_dict[font_fam
-000104e0: 696c 795d 2e61 7070 656e 6428 6373 7373  ily].append(csss
-000104f0: 7472 290a 0a20 2020 2020 2020 2020 2020  tr)..           
-00010500: 2062 6f64 795f 656c 656d 7320 3d20 636c   body_elems = cl
-00010510: 732e 6765 745f 626f 6479 5f65 6c65 6d65  s.get_body_eleme
-00010520: 6e74 735f 6279 5f63 6c61 7373 2865 6c65  nts_by_class(ele
-00010530: 6d2c 2068 6561 645f 7374 796c 6529 0a20  m, head_style). 
-00010540: 2020 2020 2020 2020 2020 2062 6f64 795f             body_
-00010550: 656c 656d 735f 7374 7220 3d20 275c 6e20  elems_str = '\n 
-00010560: 2020 2020 272e 6a6f 696e 285b 656c 656d      '.join([elem
-00010570: 2e74 6578 7420 666f 7220 656c 656d 2069  .text for elem i
-00010580: 6e20 626f 6479 5f65 6c65 6d73 5b3a 335d  n body_elems[:3]
-00010590: 5d29 0a20 2020 2020 2020 2020 2020 2070  ]).            p
-000105a0: 7269 6e74 2866 227b 6865 6164 5f73 7479  rint(f"{head_sty
-000105b0: 6c65 7d3a 207b 6c65 6e28 626f 6479 5f65  le}: {len(body_e
-000105c0: 6c65 6d73 297d 207b 6373 7373 7472 7d5c  lems)} {cssstr}\
-000105d0: 6e20 2020 2020 7b62 6f64 795f 656c 656d  n     {body_elem
-000105e0: 735f 7374 727d 2229 0a20 2020 2020 2020  s_str}").       
-000105f0: 2070 7072 696e 7428 6622 7369 7a65 207b   pprint(f"size {
-00010600: 666f 6e74 5f73 697a 655f 6469 6374 7d22  font_size_dict}"
-00010610: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
-00010620: 290a 2020 2020 2020 2020 666f 7220 7369  ).        for si
-00010630: 7a65 2069 6e20 666f 6e74 5f73 697a 655f  ze in font_size_
-00010640: 6469 6374 3a0a 2020 2020 2020 2020 2020  dict:.          
-00010650: 2020 666f 6e74 7320 3d20 666f 6e74 5f73    fonts = font_s
-00010660: 697a 655f 6469 6374 5b73 697a 655d 0a20  ize_dict[size]. 
-00010670: 2020 2020 2020 2020 2020 2069 6620 7479             if ty
-00010680: 7065 2866 6f6e 7473 2920 6973 206c 6973  pe(fonts) is lis
-00010690: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-000106a0: 2020 2070 7269 6e74 2866 2273 697a 6520     print(f"size 
-000106b0: 7b6c 656e 2866 6f6e 7473 297d 2022 290a  {len(fonts)} ").
-000106c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000106d0: 666f 6e74 737a 203d 2027 5c6e 272e 6a6f  fontsz = '\n'.jo
-000106e0: 696e 2866 6f6e 7473 290a 2020 2020 2020  in(fonts).      
-000106f0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00010700: 2020 2020 2020 2020 2020 2020 666f 6e74              font
-00010710: 737a 203d 2066 6f6e 7473 0a20 2020 2020  sz = fonts.     
-00010720: 2020 2020 2020 2070 7269 6e74 2866 2220         print(f" 
-00010730: 207b 7369 7a65 7d20 3d3e 2020 7b66 6f6e   {size} =>  {fon
-00010740: 7473 7a7d 2229 0a20 2020 2020 2020 2070  tsz}").        p
-00010750: 7269 6e74 2829 0a20 2020 2020 2020 2070  rint().        p
-00010760: 7072 696e 7428 6622 6661 6d69 6c79 207b  print(f"family {
-00010770: 6661 6d69 6c79 5f64 6963 747d 2229 0a0a  family_dict}")..
-00010780: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-00010790: 0a20 2020 2064 6566 2061 6e61 6c79 7a65  .    def analyze
-000107a0: 5f63 6f6f 7264 696e 6174 6573 2863 6c73  _coordinates(cls
-000107b0: 2c20 656c 656d 293a 0a20 2020 2020 2020  , elem):.       
-000107c0: 2023 2068 6561 645f 7374 796c 655f 656c   # head_style_el
-000107d0: 656d 7320 3d20 4874 6d6c 5374 796c 652e  ems = HtmlStyle.
-000107e0: 6765 745f 6865 6164 5f73 7479 6c65 7328  get_head_styles(
-000107f0: 656c 656d 290a 2020 2020 2020 2020 2320  elem).        # 
-00010800: 7072 696e 7428 6622 6865 6164 2073 7479  print(f"head sty
-00010810: 6c65 2065 6c65 6d73 207b 6c65 6e28 6865  le elems {len(he
-00010820: 6164 5f73 7479 6c65 5f65 6c65 6d73 297d  ad_style_elems)}
-00010830: 2229 0a20 2020 2020 2020 2023 2062 6f64  ").        # bod
-00010840: 795f 7374 796c 6573 203d 2048 746d 6c53  y_styles = HtmlS
-00010850: 7479 6c65 2e67 6574 5f62 6f64 795f 636c  tyle.get_body_cl
-00010860: 6173 7372 6566 7328 656c 656d 290a 2020  assrefs(elem).  
-00010870: 2020 2020 2020 2320 7072 696e 7428 6622        # print(f"
-00010880: 626f 6479 2073 7479 6c65 7320 7b6c 656e  body styles {len
-00010890: 2862 6f64 795f 7374 796c 6573 297d 2229  (body_styles)}")
-000108a0: 0a20 2020 2020 2020 206d 6178 6368 6172  .        maxchar
-000108b0: 203d 2035 300a 0a20 2020 2020 2020 2063   = 50..        c
-000108c0: 6c73 2e67 6574 5f6c 7274 6228 656c 656d  ls.get_lrtb(elem
-000108d0: 2c20 226c 6566 7422 290a 2020 2020 2020  , "left").      
-000108e0: 2020 636c 732e 6765 745f 6c72 7462 2865    cls.get_lrtb(e
-000108f0: 6c65 6d2c 2022 7269 6768 7422 290a 2020  lem, "right").  
-00010900: 2020 2020 2020 636c 732e 6765 745f 6c72        cls.get_lr
-00010910: 7462 2865 6c65 6d2c 2022 7930 222c 2063  tb(elem, "y0", c
-00010920: 6f6c 3d30 290a 2020 2020 2020 2020 636c  ol=0).        cl
-00010930: 732e 6765 745f 6c72 7462 2865 6c65 6d2c  s.get_lrtb(elem,
-00010940: 2022 746f 7022 2c20 6d61 7267 696e 3d38   "top", margin=8
-00010950: 3029 0a0a 2020 2020 4063 6c61 7373 6d65  0)..    @classme
-00010960: 7468 6f64 0a20 2020 2064 6566 2067 6574  thod.    def get
-00010970: 5f6c 7274 6228 636c 732c 2065 6c65 6d2c  _lrtb(cls, elem,
-00010980: 2064 6972 6563 7469 6f6e 2c20 6d61 7863   direction, maxc
-00010990: 6861 723d 3530 2c20 6d69 6e5f 636f 756e  har=50, min_coun
-000109a0: 743d 3130 2c20 6d61 785f 7465 7874 733d  t=10, max_texts=
-000109b0: 332c 206d 6172 6769 6e3d 3830 2c0a 2020  3, margin=80,.  
-000109c0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000109d0: 6564 6961 626f 783d 5b5b 302c 2031 3030  ediabox=[[0, 100
-000109e0: 305d 2c20 5b30 2c20 3130 3030 5d5d 2c20  0], [0, 1000]], 
-000109f0: 636f 6c3d 3129 3a0a 2020 2020 2020 2020  col=1):.        
-00010a00: 656c 656d 7320 3d20 4874 6d6c 4c69 622e  elems = HtmlLib.
-00010a10: 6765 745f 626f 6479 2865 6c65 6d29 2e78  get_body(elem).x
-00010a20: 7061 7468 2866 222e 2f2f 2a5b 407b 6469  path(f".//*[@{di
-00010a30: 7265 6374 696f 6e7d 5d22 290a 2020 2020  rection}]").    
-00010a40: 2020 2020 6469 6374 7820 3d20 6465 6661      dictx = defa
-00010a50: 756c 7464 6963 7428 6c69 7374 290a 2020  ultdict(list).  
-00010a60: 2020 2020 2020 666f 7220 656c 656d 2069        for elem i
-00010a70: 6e20 656c 656d 733a 0a20 2020 2020 2020  n elems:.       
-00010a80: 2020 2020 206c 6566 7420 3d20 4874 6d6c       left = Html
-00010a90: 5574 696c 2e67 6574 5f66 6c6f 6174 2865  Util.get_float(e
-00010aa0: 6c65 6d2c 2064 6972 6563 7469 6f6e 290a  lem, direction).
-00010ab0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00010ac0: 6566 743a 0a20 2020 2020 2020 2020 2020  eft:.           
-00010ad0: 2020 2020 2064 6963 7478 5b6c 6566 745d       dictx[left]
-00010ae0: 2e61 7070 656e 6428 656c 656d 290a 2020  .append(elem).  
-00010af0: 2020 2020 2020 7072 696e 7428 6622 5c6e        print(f"\n
-00010b00: 7b64 6972 6563 7469 6f6e 7d22 290a 2020  {direction}").  
-00010b10: 2020 2020 2020 726f 7773 203d 205b 5d0a        rows = [].
-00010b20: 2020 2020 2020 2020 666f 7220 6b65 7920          for key 
-00010b30: 696e 2064 6963 7478 2e6b 6579 7328 293a  in dictx.keys():
-00010b40: 0a20 2020 2020 2020 2020 2020 2065 6c65  .            ele
-00010b50: 6d73 203d 2064 6963 7478 5b6b 6579 5d0a  ms = dictx[key].
-00010b60: 2020 2020 2020 2020 2020 2020 7465 7874              text
-00010b70: 7320 3d20 5b65 6c65 6d2e 7870 6174 6828  s = [elem.xpath(
-00010b80: 222e 2f2f 7465 7874 2829 2229 5b30 5d5b  ".//text()")[0][
-00010b90: 3a6d 6178 6368 6172 5d20 666f 7220 656c  :maxchar] for el
-00010ba0: 656d 2069 6e20 656c 656d 735d 0a20 2020  em in elems].   
-00010bb0: 2020 2020 2020 2020 2065 6c65 6d63 6f75           elemcou
-00010bc0: 6e74 203d 206c 656e 2865 6c65 6d73 290a  nt = len(elems).
-00010bd0: 2020 2020 2020 2020 2020 2020 6966 2065              if e
-00010be0: 6c65 6d63 6f75 6e74 203e 206d 696e 5f63  lemcount > min_c
-00010bf0: 6f75 6e74 3a0a 2020 2020 2020 2020 2020  ount:.          
-00010c00: 2020 2020 2020 7465 7874 735f 203d 2074        texts_ = t
-00010c10: 6578 7473 5b3a 6d61 785f 7465 7874 735d  exts[:max_texts]
-00010c20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010c30: 2070 7269 6e74 2866 227b 6b65 797d 3a20   print(f"{key}: 
-00010c40: 7b65 6c65 6d63 6f75 6e74 7d20 7b74 6578  {elemcount} {tex
-00010c50: 7473 5f7d 2229 0a20 2020 2020 2020 2020  ts_}").         
-00010c60: 2020 2020 2020 2072 6f77 732e 6170 7065         rows.appe
-00010c70: 6e64 285b 6b65 792c 2065 6c65 6d63 6f75  nd([key, elemcou
-00010c80: 6e74 2c20 7465 7874 735f 5d29 0a20 2020  nt, texts_]).   
-00010c90: 2020 2020 2072 6f77 735f 203d 2073 6f72       rows_ = sor
-00010ca0: 7465 6428 726f 7773 2c20 6b65 793d 6c61  ted(rows, key=la
-00010cb0: 6d62 6461 2063 3a20 635b 636f 6c5d 290a  mbda c: c[col]).
-00010cc0: 2020 2020 2020 2020 7072 696e 7428 6622          print(f"
-00010cd0: 726f 7773 5c6e 7b72 6f77 735f 7d22 290a  rows\n{rows_}").
-00010ce0: 0a20 2020 2020 2020 2023 2073 6f72 7465  .        # sorte
-00010cf0: 6428 7374 7564 656e 745f 7475 706c 6573  d(student_tuples
-00010d00: 2c20 6b65 793d 6c61 6d62 6461 2073 7475  , key=lambda stu
-00010d10: 6465 6e74 3a20 7374 7564 656e 745b 325d  dent: student[2]
-00010d20: 290a 0a20 2020 2040 636c 6173 736d 6574  )..    @classmet
-00010d30: 686f 640a 2020 2020 6465 6620 6765 745f  hod.    def get_
-00010d40: 626f 6479 5f65 6c65 6d65 6e74 735f 6279  body_elements_by
-00010d50: 5f63 6c61 7373 2863 6c73 2c20 656c 656d  _class(cls, elem
-00010d60: 2c20 6865 6164 5f73 7479 6c65 293a 0a20  , head_style):. 
-00010d70: 2020 2020 2020 2069 6620 6865 6164 5f73         if head_s
-00010d80: 7479 6c65 2e73 7461 7274 7377 6974 6828  tyle.startswith(
-00010d90: 272e 2729 3a0a 2020 2020 2020 2020 2020  '.'):.          
-00010da0: 2020 6865 6164 5f73 7479 6c65 203d 2068    head_style = h
-00010db0: 6561 645f 7374 796c 655b 313a 5d0a 2020  ead_style[1:].  
-00010dc0: 2020 2020 2020 626f 6479 5f65 6c65 6d73        body_elems
-00010dd0: 203d 2065 6c65 6d2e 7870 6174 6828 6622   = elem.xpath(f"
-00010de0: 2e2f 626f 6479 2f2f 2a5b 4063 6c61 7373  ./body//*[@class
-00010df0: 3d27 7b68 6561 645f 7374 796c 657d 275d  ='{head_style}']
-00010e00: 2229 0a20 2020 2020 2020 2072 6574 7572  ").        retur
-00010e10: 6e20 626f 6479 5f65 6c65 6d73 0a0a 2020  n body_elems..  
-00010e20: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-00010e30: 2020 2064 6566 2063 6c65 616e 5f77 7269     def clean_wri
-00010e40: 7465 5f68 746d 6c28 636c 732c 2069 6e5f  te_html(cls, in_
-00010e50: 6874 6d6c 2c20 6f75 745f 6874 6d6c 2c20  html, out_html, 
-00010e60: 7072 6574 7479 5f70 7269 6e74 3d54 7275  pretty_print=Tru
-00010e70: 6529 3a0a 2020 2020 2020 2020 2222 220a  e):.        """.
-00010e80: 2020 2020 2020 2020 5061 7273 6520 7261          Parse ra
-00010e90: 7720 4854 4d4c 2028 6e6f 7420 616c 7761  w HTML (not alwa
-00010ea0: 7973 2077 656c 6c2d 666f 726d 6564 2920  ys well-formed) 
-00010eb0: 2c20 6d61 6b65 2077 656c 6c66 6f72 6d65  , make wellforme
-00010ec0: 6420 616e 6420 6f70 7469 6f6e 616c 6c79  d and optionally
-00010ed0: 2070 7265 7474 7920 7072 696e 740a 2020   pretty print.  
-00010ee0: 2020 2020 2020 3a70 6172 616d 2069 6e5f        :param in_
-00010ef0: 6874 6d6c 3a20 696e 7075 7420 6874 6d6c  html: input html
-00010f00: 2066 696c 650a 2020 2020 2020 2020 3a70   file.        :p
-00010f10: 6172 616d 206f 7574 5f68 746d 6c3a 206f  aram out_html: o
-00010f20: 7574 7075 7420 6669 6c65 0a20 2020 2020  utput file.     
-00010f30: 2020 203a 7061 7261 6d20 7072 6574 7479     :param pretty
-00010f40: 5f70 7269 6e74 3a20 6f75 7470 7574 2066  _print: output f
-00010f50: 6f72 6d61 740a 2020 2020 2020 2020 3a72  ormat.        :r
-00010f60: 6574 7572 6e3a 2070 6172 7365 6420 6874  eturn: parsed ht
-00010f70: 6d6c 2065 6c65 6d65 6e74 0a20 2020 2020  ml element.     
-00010f80: 2020 2022 2222 0a20 2020 2020 2020 2068     """.        h
-00010f90: 746d 6c5f 656c 656d 203d 2063 6c73 2e70  tml_elem = cls.p
-00010fa0: 6172 7365 5f68 746d 6c5f 6669 6c65 5f74  arse_html_file_t
-00010fb0: 6f5f 786d 6c28 696e 5f68 746d 6c29 0a20  o_xml(in_html). 
-00010fc0: 2020 2020 2020 2063 6c73 2e77 7269 7465         cls.write
-00010fd0: 5f68 746d 6c5f 656c 656d 2868 746d 6c5f  _html_elem(html_
-00010fe0: 656c 656d 2c20 6f75 745f 6874 6d6c 2c20  elem, out_html, 
-00010ff0: 7072 6574 7479 5f70 7269 6e74 3d70 7265  pretty_print=pre
-00011000: 7474 795f 7072 696e 7429 0a20 2020 2020  tty_print).     
-00011010: 2020 2072 6574 7572 6e20 6874 6d6c 5f65     return html_e
-00011020: 6c65 6d0a 0a20 2020 2040 636c 6173 736d  lem..    @classm
-00011030: 6574 686f 640a 2020 2020 6465 6620 7061  ethod.    def pa
-00011040: 7273 655f 6874 6d6c 5f66 696c 655f 746f  rse_html_file_to
-00011050: 5f78 6d6c 2863 6c73 2c20 696e 5f68 746d  _xml(cls, in_htm
-00011060: 6c29 3a0a 2020 2020 2020 2020 2222 2272  l):.        """r
-00011070: 6561 6420 756e 7469 6479 2048 544d 4c20  ead untidy HTML 
-00011080: 696e 746f 2058 4d4c 0a20 2020 2020 2020  into XML.       
-00011090: 2075 7365 7320 4854 4d4c 5061 7273 6572   uses HTMLParser
-000110a0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-000110b0: 696e 5f68 746d 6c3a 2048 544d 4c20 6669  in_html: HTML fi
-000110c0: 6c65 0a20 2020 2020 2020 203a 7265 7475  le.        :retu
-000110d0: 726e 3a20 7765 6c6c 5f66 6f72 6d65 6420  rn: well_formed 
-000110e0: 5848 544d 4c0a 2020 2020 2020 2020 2222  XHTML.        ""
-000110f0: 220a 2020 2020 2020 2020 6874 6d6c 5f65  ".        html_e
-00011100: 6c65 6d20 3d20 4554 2e70 6172 7365 2873  lem = ET.parse(s
-00011110: 7472 2869 6e5f 6874 6d6c 292c 2045 542e  tr(in_html), ET.
-00011120: 4854 4d4c 5061 7273 6572 2829 292e 7870  HTMLParser()).xp
-00011130: 6174 6828 222f 2a22 295b 305d 0a20 2020  ath("/*")[0].   
-00011140: 2020 2020 2072 6574 7572 6e20 6874 6d6c       return html
-00011150: 5f65 6c65 6d0a 0a20 2020 2040 636c 6173  _elem..    @clas
-00011160: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
-00011170: 7772 6974 655f 6874 6d6c 5f65 6c65 6d28  write_html_elem(
-00011180: 636c 732c 2065 6c65 6d2c 206f 7574 5f68  cls, elem, out_h
-00011190: 746d 6c2c 2070 7265 7474 795f 7072 696e  tml, pretty_prin
-000111a0: 743d 4661 6c73 6529 3a0a 2020 2020 2020  t=False):.      
-000111b0: 2020 2222 2277 7269 7465 2048 544d 4c20    """write HTML 
-000111c0: 7769 7468 206f 7074 696f 6e61 6c20 7072  with optional pr
-000111d0: 6574 7479 5f70 7269 6e74 0a20 2020 2020  etty_print.     
-000111e0: 2020 203a 7061 7261 6d20 656c 656d 3a20     :param elem: 
-000111f0: 4854 4d4c 2065 6c65 6d65 6e74 0a20 2020  HTML element.   
-00011200: 2020 2020 203a 7061 7261 6d20 6f75 745f       :param out_
-00011210: 6874 6d6c 3a20 6569 7468 6572 2061 2066  html: either a f
-00011220: 696c 6520 6f72 2073 7973 2e73 7464 6f75  ile or sys.stdou
-00011230: 740a 2020 2020 2020 2020 3a70 6172 616d  t.        :param
-00011240: 2070 7265 7474 795f 7072 696e 743a 0a20   pretty_print:. 
-00011250: 2020 2020 2020 2022 7265 7475 726e 3a20         "return: 
-00011260: 4e6f 6e65 0a20 2020 2020 2020 2022 2222  None.        """
-00011270: 0a20 2020 2020 2020 2069 6620 6f75 745f  .        if out_
-00011280: 6874 6d6c 203d 3d20 7379 732e 7374 646f  html == sys.stdo
-00011290: 7574 3a0a 2020 2020 2020 2020 2020 2020  ut:.            
-000112a0: 7072 696e 7428 4554 2e74 6f73 7472 696e  print(ET.tostrin
-000112b0: 6728 656c 656d 2c20 7072 6574 7479 5f70  g(elem, pretty_p
-000112c0: 7269 6e74 3d54 7275 652c 2065 6e63 6f64  rint=True, encod
-000112d0: 696e 673d 2275 6e69 636f 6465 2229 290a  ing="unicode")).
-000112e0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000112f0: 2020 2020 2020 2020 2020 7373 203d 2045            ss = E
-00011300: 542e 746f 7374 7269 6e67 2865 6c65 6d2c  T.tostring(elem,
-00011310: 2070 7265 7474 795f 7072 696e 743d 7072   pretty_print=pr
-00011320: 6574 7479 5f70 7269 6e74 290a 2020 2020  etty_print).    
-00011330: 2020 2020 2020 2020 5061 7468 286f 7574          Path(out
-00011340: 5f68 746d 6c29 2e70 6172 656e 742e 6d6b  _html).parent.mk
-00011350: 6469 7228 7061 7265 6e74 733d 5472 7565  dir(parents=True
-00011360: 2c20 6578 6973 745f 6f6b 3d54 7275 6529  , exist_ok=True)
-00011370: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
-00011380: 6820 6f70 656e 286f 7574 5f68 746d 6c2c  h open(out_html,
-00011390: 2022 7762 2229 2061 7320 663a 0a20 2020   "wb") as f:.   
-000113a0: 2020 2020 2020 2020 2020 2020 2066 2e77               f.w
-000113b0: 7269 7465 2873 7329 0a0a 2020 2020 4063  rite(ss)..    @c
-000113c0: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-000113d0: 6566 2072 656d 6f76 655f 7374 796c 655f  ef remove_style_
-000113e0: 6174 7472 6962 7574 6573 2863 6c73 2c20  attributes(cls, 
-000113f0: 6874 6d6c 5f65 6c65 6d29 3a0a 2020 2020  html_elem):.    
-00011400: 2020 2020 2222 2272 656d 6f76 6520 4073      """remove @s
-00011410: 7479 6c65 2061 7474 7269 6275 7465 7320  tyle attributes 
-00011420: 6672 6f6d 2065 6c65 6d65 6e74 7320 696e  from elements in
-00011430: 2068 746d 6c5f 656c 656d 0a20 2020 2020   html_elem.     
-00011440: 2020 203a 7061 7261 6d20 6874 6d6c 5f65     :param html_e
-00011450: 6c65 6d3a 2065 6c65 6d65 6e74 2074 6f20  lem: element to 
-00011460: 7374 7269 700a 2020 2020 2020 2020 2222  strip.        ""
-00011470: 220a 2020 2020 2020 2020 6966 2068 746d  ".        if htm
-00011480: 6c5f 656c 656d 2069 7320 4e6f 6e65 3a0a  l_elem is None:.
-00011490: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000114a0: 726e 0a20 2020 2020 2020 2073 7479 6c65  rn.        style
-000114b0: 5f65 6c65 6d73 203d 2068 746d 6c5f 656c  _elems = html_el
-000114c0: 656d 2e78 7061 7468 2822 2e2f 2f2a 5b40  em.xpath(".//*[@
-000114d0: 7374 796c 655d 2229 0a20 2020 2020 2020  style]").       
-000114e0: 2066 6f72 2073 7479 6c65 5f65 6c65 6d20   for style_elem 
-000114f0: 696e 2073 7479 6c65 5f65 6c65 6d73 3a0a  in style_elems:.
-00011500: 2020 2020 2020 2020 2020 2020 4874 6d6c              Html
-00011510: 5574 696c 2e72 656d 6f76 655f 6174 7472  Util.remove_attr
-00011520: 6962 7574 6528 7374 796c 655f 656c 656d  ibute(style_elem
-00011530: 2c20 2273 7479 6c65 2229 0a0a 2020 2020  , "style")..    
-00011540: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-00011550: 2064 6566 2072 656d 6f76 655f 656c 656d   def remove_elem
-00011560: 7328 636c 732c 2068 746d 6c5f 656c 656d  s(cls, html_elem
-00011570: 2c20 7870 6174 683d 4e6f 6e65 293a 0a20  , xpath=None):. 
-00011580: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00011590: 2020 2072 656d 6f76 6520 656c 656d 656e     remove elemen
-000115a0: 7473 2062 7920 7870 6174 680a 2020 2020  ts by xpath.    
-000115b0: 2020 2020 3a70 6172 616d 2068 746d 6c5f      :param html_
-000115c0: 656c 656d 3a20 656c 656d 656e 7420 746f  elem: element to
-000115d0: 2072 656d 6f76 6520 656c 656d 656e 7420   remove element 
-000115e0: 6672 6f6d 0a20 2020 2020 2020 203a 7061  from.        :pa
-000115f0: 7261 6d20 7870 6174 683a 0a20 2020 2020  ram xpath:.     
-00011600: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-00011610: 6620 6874 6d6c 5f65 6c65 6d20 6973 204e  f html_elem is N
-00011620: 6f6e 6520 6f72 2078 7061 7468 2069 7320  one or xpath is 
-00011630: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00011640: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
-00011650: 2065 6c65 6d73 203d 2068 746d 6c5f 656c   elems = html_el
-00011660: 656d 2e78 7061 7468 2878 7061 7468 290a  em.xpath(xpath).
-00011670: 2020 2020 2020 2020 666f 7220 656c 656d          for elem
-00011680: 2069 6e20 656c 656d 733a 0a20 2020 2020   in elems:.     
-00011690: 2020 2020 2020 2048 746d 6c55 7469 6c2e         HtmlUtil.
-000116a0: 7265 6d6f 7665 5f65 6c65 6d5f 6b65 6570  remove_elem_keep
-000116b0: 5f74 6169 6c28 656c 656d 290a 0a20 2020  _tail(elem)..   
-000116c0: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-000116d0: 2020 6465 6620 7265 6d6f 7665 5f65 6c65    def remove_ele
-000116e0: 6d65 6e74 5f69 6e5f 6869 6572 6172 6368  ment_in_hierarch
-000116f0: 7928 636c 732c 2065 6c65 6d29 3a0a 2020  y(cls, elem):.  
-00011700: 2020 2020 2020 2222 2272 656d 6f76 6573        """removes
-00011710: 2064 6976 7320 6672 6f6d 206e 6573 7469   divs from nesti
-00011720: 6e67 0a20 2020 2020 2020 2045 7861 6d70  ng.        Examp
-00011730: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
-00011740: 3c64 6976 2069 643d 2264 3122 3e0a 2020  <div id="d1">.  
-00011750: 2020 2020 2020 2020 2020 2020 3c64 6976              <div
-00011760: 2069 643d 2264 3222 3e0a 2020 2020 2020   id="d2">.      
-00011770: 2020 2020 2020 2020 2020 3c73 7061 6e20            <span 
-00011780: 6964 3d22 7331 223e 626c 6168 3c2f 7370  id="s1">blah</sp
-00011790: 616e 3e0a 2020 2020 2020 2020 2020 2020  an>.            
-000117a0: 2020 3c2f 6469 763e 0a20 2020 2020 2020    </div>.       
-000117b0: 2020 2020 203c 2f64 6976 3e0a 2020 2020       </div>.    
-000117c0: 2020 2020 2020 2020 6132 2069 7320 706c          a2 is pl
-000117d0: 6179 696e 6720 6e6f 2072 6f6c 6520 696e  aying no role in
-000117e0: 2067 726f 7570 696e 672c 2073 6f20 6361   grouping, so ca
-000117f0: 6e20 6265 2072 656d 6f76 6564 2074 6f20  n be removed to 
-00011800: 6769 7665 3a0a 2020 2020 2020 2020 2020  give:.          
-00011810: 2020 3c64 6976 2069 643d 2264 3122 3e0a    <div id="d1">.
-00011820: 2020 2020 2020 2020 2020 2020 2020 3c73                <s
-00011830: 7061 6e20 6964 3d22 7331 223e 626c 6168  pan id="s1">blah
-00011840: 3c2f 7370 616e 3e0a 2020 2020 2020 2020  </span>.        
-00011850: 2020 2020 3c2f 6469 763e 0a20 2020 2020      </div>.     
-00011860: 2020 2020 2020 2054 6869 7320 6361 6e20         This can 
-00011870: 6265 2072 6563 7572 7369 7665 2062 7574  be recursive but
-00011880: 2073 7061 6e73 2073 686f 756c 6420 616c   spans should al
-00011890: 7761 7973 2068 6176 6520 6469 7620 7061  ways have div pa
-000118a0: 7265 6e74 730a 2020 2020 2020 2020 2020  rents.          
-000118b0: 2020 3a70 6172 616d 2065 6c65 6d3a 2065    :param elem: e
-000118c0: 6c65 6d20 746f 2072 656d 6f76 652e 2049  lem to remove. I
-000118d0: 7473 2063 6869 6c64 7265 6e20 6172 6520  ts children are 
-000118e0: 7472 616e 7366 6572 6564 2074 6f20 7061  transfered to pa
-000118f0: 7265 6e74 0a20 2020 2020 2020 2020 2020  rent.           
-00011900: 2065 2e67 2e0a 2020 2020 2020 2020 2020   e.g..          
-00011910: 2020 7028 612c 656c 656d 286c 2c6d 2c6e    p(a,elem(l,m,n
-00011920: 292c 7a29 203d 3e20 7028 612c 6c2c 6d2c  ),z) => p(a,l,m,
-00011930: 6e2c 7a29 0a20 2020 2020 2020 2020 2020  n,z).           
-00011940: 203a 7265 7475 726e 3a4e 6f6e 650a 2020   :return:None.  
-00011950: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00011960: 2020 7061 7265 6e74 203d 2065 6c65 6d2e    parent = elem.
-00011970: 6765 7470 6172 656e 7428 290a 2020 2020  getparent().    
-00011980: 2020 2020 6966 2070 6172 656e 7420 6973      if parent is
-00011990: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-000119a0: 2020 2070 7269 6e74 2866 2265 6c65 6d20     print(f"elem 
-000119b0: 6861 7320 6e6f 2070 6172 656e 7422 290a  has no parent").
-000119c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000119d0: 726e 0a20 2020 2020 2020 2069 6478 203d  rn.        idx =
-000119e0: 2070 6172 656e 742e 696e 6465 7828 656c   parent.index(el
-000119f0: 656d 290a 2020 2020 2020 2020 6368 696c  em).        chil
-00011a00: 645f 656c 656d 7320 3d20 656c 656d 2e78  d_elems = elem.x
-00011a10: 7061 7468 2822 2a22 290a 2020 2020 2020  path("*").      
-00011a20: 2020 666f 7220 6368 696c 645f 656c 656d    for child_elem
-00011a30: 2069 6e20 6368 696c 645f 656c 656d 733a   in child_elems:
-00011a40: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
-00011a50: 656e 742e 696e 7365 7274 2869 6478 2c20  ent.insert(idx, 
-00011a60: 6368 696c 645f 656c 656d 290a 2020 2020  child_elem).    
-00011a70: 2020 2020 7061 7265 6e74 2e72 656d 6f76      parent.remov
-00011a80: 6528 656c 656d 290a 0a20 2020 2040 636c  e(elem)..    @cl
-00011a90: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-00011aa0: 6620 7265 6d6f 7665 5f65 6c65 6d65 6e74  f remove_element
-00011ab0: 735f 696e 5f68 6965 7261 7263 6879 5f62  s_in_hierarchy_b
-00011ac0: 795f 7870 6174 6828 636c 732c 2068 746d  y_xpath(cls, htm
-00011ad0: 6c2c 2078 7061 7468 293a 0a20 2020 2020  l, xpath):.     
-00011ae0: 2020 2022 2222 6669 6e64 7320 656c 656d     """finds elem
-00011af0: 656e 7473 2062 7920 7870 6174 6820 616e  ents by xpath an
-00011b00: 6420 6465 6c65 7465 7320 7468 656d 2075  d deletes them u
-00011b10: 7369 6e67 2072 656d 6f76 655f 656c 656d  sing remove_elem
-00011b20: 656e 7473 5f69 6e5f 6869 6572 6172 6368  ents_in_hierarch
-00011b30: 7928 290a 2020 2020 2020 2020 3a70 6172  y().        :par
-00011b40: 616d 2068 746d 6c3a 2065 6c65 6d65 6e74  am html: element
-00011b50: 7320 746f 2064 656c 6574 6520 6672 6f6d  s to delete from
-00011b60: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00011b70: 7870 6174 683a 2078 7061 7468 2074 6f20  xpath: xpath to 
-00011b80: 7365 6172 6368 2077 6974 680a 2020 2020  search with.    
-00011b90: 2020 2020 3a72 6574 7572 6e3a 2065 6c65      :return: ele
-00011ba0: 6d73 2074 6861 7420 6861 7665 2062 6565  ms that have bee
-00011bb0: 6e20 6465 6c65 7465 640a 2020 2020 2020  n deleted.      
-00011bc0: 2020 2222 220a 2020 2020 2020 2020 656c    """.        el
-00011bd0: 656d 7320 3d20 6874 6d6c 2e78 7061 7468  ems = html.xpath
-00011be0: 2878 7061 7468 290a 2020 2020 2020 2020  (xpath).        
-00011bf0: 666f 7220 656c 656d 2069 6e20 656c 656d  for elem in elem
-00011c00: 733a 0a20 2020 2020 2020 2020 2020 2048  s:.            H
-00011c10: 746d 6c55 7469 6c2e 7265 6d6f 7665 5f65  tmlUtil.remove_e
-00011c20: 6c65 6d65 6e74 5f69 6e5f 6869 6572 6172  lement_in_hierar
-00011c30: 6368 7928 656c 656d 290a 2020 2020 2020  chy(elem).      
-00011c40: 2020 7265 7475 726e 2065 6c65 6d73 0a0a    return elems..
-00011c50: 0a63 6c61 7373 2048 746d 6c41 6e6e 6f74  .class HtmlAnnot
-00011c60: 6174 6f72 3a0a 2020 2020 2222 2269 6e6c  ator:.    """inl
-00011c70: 696e 6520 616e 6e6f 7461 746f 7220 666f  ine annotator fo
-00011c80: 7220 4854 4d4c 2065 6c65 6d65 6e74 730a  r HTML elements.
-00011c90: 2020 2020 7374 6f72 6573 2061 6e64 2072      stores and r
-00011ca0: 756e 7320 416e 6e6f 7461 746f 7243 6f6d  uns AnnotatorCom
-00011cb0: 6d61 6e64 730a 0a20 2020 2061 6e6e 6f74  mands..    annot
-00011cc0: 6174 6f72 203d 2041 6e6e 6f74 6174 6f72  ator = Annotator
-00011cd0: 2829 0a20 2020 2063 6f6d 6d61 6e64 203d  ().    command =
-00011ce0: 2041 6e6e 6f74 6174 6f72 436f 6d6d 616e   AnnotatorComman
-00011cf0: 6428 6874 6d6c 5f63 6c61 7373 3d22 7365  d(html_class="se
-00011d00: 6374 696f 6e5f 7469 746c 6522 2c20 7265  ction_title", re
-00011d10: 6765 783d 2253 6563 7469 6f6e 5c5c 732b  gex="Section\\s+
-00011d20: 283f 503c 6964 3e5c 5c64 2b29 3a5c 5c73  (?P<id>\\d+):\\s
-00011d30: 2b28 3f50 3c74 6974 6c65 3e2e 2a29 222c  +(?P<title>.*)",
-00011d40: 2061 6464 5f69 643d 5472 7565 2c20 6164   add_id=True, ad
-00011d50: 645f 7469 746c 653d 5472 7565 290a 2020  d_title=True).  
-00011d60: 2020 616e 6e6f 7461 746f 722e 6164 645f    annotator.add_
-00011d70: 636f 6d6d 616e 6428 636f 6d6d 616e 6429  command(command)
-00011d80: 0a20 2020 2061 6e6e 6f74 6174 6f72 2e72  .    annotator.r
-00011d90: 756e 5f63 6f6d 6d61 6e64 7328 656c 656d  un_commands(elem
-00011da0: 290a 0a20 2020 2022 2222 0a0a 2020 2020  )..    """..    
-00011db0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-00011dc0: 6629 3a0a 2020 2020 2020 2020 7365 6c66  f):.        self
-00011dd0: 2e63 6f6d 6d61 6e64 7320 3d20 5b5d 0a0a  .commands = []..
-00011de0: 2020 2020 6465 6620 6164 645f 636f 6d6d      def add_comm
-00011df0: 616e 6428 7365 6c66 2c20 636f 6d6d 616e  and(self, comman
-00011e00: 6429 3a0a 2020 2020 2020 2020 6966 2063  d):.        if c
-00011e10: 6f6d 6d61 6e64 3a0a 2020 2020 2020 2020  ommand:.        
-00011e20: 2020 2020 7365 6c66 2e63 6f6d 6d61 6e64      self.command
-00011e30: 732e 6170 7065 6e64 2863 6f6d 6d61 6e64  s.append(command
-00011e40: 290a 0a20 2020 2064 6566 2072 756e 5f63  )..    def run_c
-00011e50: 6f6d 6d61 6e64 7328 7365 6c66 2c20 7461  ommands(self, ta
-00011e60: 7267 6574 5f65 6c65 6d29 3a0a 2020 2020  rget_elem):.    
-00011e70: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00011e80: 6974 6572 6174 6520 636f 6d6d 616e 6473  iterate commands
-00011e90: 2028 6f72 6465 7220 6973 206f 7264 6572   (order is order
-00011ea0: 206f 6620 7468 6569 7220 6164 6469 7469   of their additi
-00011eb0: 6f6e 0a20 2020 2020 2020 2022 2222 0a20  on.        """. 
-00011ec0: 2020 2020 2020 2066 6f72 2063 6f6d 6d61         for comma
-00011ed0: 6e64 2069 6e20 7365 6c66 2e63 6f6d 6d61  nd in self.comma
-00011ee0: 6e64 733a 0a20 2020 2020 2020 2020 2020  nds:.           
-00011ef0: 2063 6f6d 6d61 6e64 2e72 756e 5f63 6f6d   command.run_com
-00011f00: 6d61 6e64 2874 6172 6765 745f 656c 656d  mand(target_elem
-00011f10: 290a 0a20 2020 2040 636c 6173 736d 6574  )..    @classmet
-00011f20: 686f 640a 2020 2020 6465 6620 6372 6561  hod.    def crea
-00011f30: 7465 5f69 7063 635f 616e 6e6f 7461 746f  te_ipcc_annotato
-00011f40: 7228 636c 7329 3a0a 2020 2020 2020 2020  r(cls):.        
-00011f50: 2222 2261 2073 6574 206f 6620 6765 6e65  """a set of gene
-00011f60: 7261 6c20 6f70 6572 6174 696f 6e73 2066  ral operations f
-00011f70: 6f72 2049 5043 4322 2222 0a20 2020 2020  or IPCC""".     
-00011f80: 2020 2061 6e6e 6f74 6174 6f72 203d 2048     annotator = H
-00011f90: 746d 6c41 6e6e 6f74 6174 6f72 2829 0a20  tmlAnnotator(). 
-00011fa0: 2020 2020 2020 2061 6e6e 6f74 6174 6f72         annotator
-00011fb0: 2e61 6464 5f63 6f6d 6d61 6e64 280a 2020  .add_command(.  
-00011fc0: 2020 2020 2020 2020 2020 416e 6e6f 7461            Annota
-00011fd0: 746f 7243 6f6d 6d61 6e64 2868 746d 6c5f  torCommand(html_
-00011fe0: 636c 6173 733d 2273 6563 7469 6f6e 5f74  class="section_t
-00011ff0: 6974 6c65 222c 2072 6567 6578 3d22 5365  itle", regex="Se
-00012000: 6374 696f 6e5c 5c73 2b28 3f50 3c69 643e  ction\\s+(?P<id>
-00012010: 5c5c 642b 293a 5c5c 732b 283f 503c 7469  \\d+):\\s+(?P<ti
-00012020: 746c 653e 2e2a 2922 2c0a 2020 2020 2020  tle>.*)",.      
-00012030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012040: 2020 2020 2020 2061 6464 5f69 643d 2273         add_id="s
-00012050: 6563 7469 6f6e 5f7c 222c 2061 6464 5f74  ection_|", add_t
-00012060: 6974 6c65 3d22 7c22 2c20 7374 796c 653d  itle="|", style=
-00012070: 227b 636f 6c6f 7220 3a20 626c 7565 3b20  "{color : blue; 
-00012080: 6261 636b 6772 6f75 6e64 203a 2070 696e  background : pin
-00012090: 6b3b 7d22 2c0a 2020 2020 2020 2020 2020  k;}",.          
-000120a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000120b0: 2020 2064 6573 633d 2261 6464 2069 6420     desc="add id 
-000120c0: 616e 6420 7469 746c 6520 666f 7220 2753  and title for 'S
-000120d0: 6563 7469 6f6e 3a20 2e2e 2e27 2229 0a20  ection: ...'"). 
-000120e0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-000120f0: 2061 6e6e 6f74 6174 6f72 2e61 6464 5f63   annotator.add_c
-00012100: 6f6d 6d61 6e64 280a 2020 2020 2020 2020  ommand(.        
-00012110: 2020 2020 416e 6e6f 7461 746f 7243 6f6d      AnnotatorCom
-00012120: 6d61 6e64 2868 746d 6c5f 636c 6173 733d  mand(html_class=
-00012130: 2273 7562 5f73 6563 7469 6f6e 5f74 6974  "sub_section_tit
-00012140: 6c65 222c 2072 6567 6578 3d22 5c5c 732a  le", regex="\\s*
-00012150: 283f 503c 6964 3e5c 5c64 2b5c 5c2e 5c5c  (?P<id>\\d+\\.\\
-00012160: 642b 295c 5c73 2b28 3f50 3c74 6974 6c65  d+)\\s+(?P<title
-00012170: 3e2e 2a29 222c 0a20 2020 2020 2020 2020  >.*)",.         
-00012180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012190: 2020 2020 6164 645f 6964 3d22 7375 6273      add_id="subs
-000121a0: 6563 7469 6f6e 5f7c 222c 2061 6464 5f74  ection_|", add_t
-000121b0: 6974 6c65 3d22 7c22 2c20 7374 796c 653d  itle="|", style=
-000121c0: 227b 636f 6c6f 7220 3a20 6772 6565 6e3b  "{color : green;
-000121d0: 2062 6163 6b67 726f 756e 6420 3a20 7965   background : ye
-000121e0: 6c6c 6f77 3b7d 2229 290a 2020 2020 2020  llow;}")).      
-000121f0: 2020 616e 6e6f 7461 746f 722e 6164 645f    annotator.add_
-00012200: 636f 6d6d 616e 6428 0a20 2020 2020 2020  command(.       
-00012210: 2020 2020 2041 6e6e 6f74 6174 6f72 436f       AnnotatorCo
-00012220: 6d6d 616e 6428 6874 6d6c 5f63 6c61 7373  mmand(html_class
-00012230: 3d22 7375 625f 7375 625f 7365 6374 696f  ="sub_sub_sectio
-00012240: 6e5f 7469 746c 6522 2c0a 2020 2020 2020  n_title",.      
-00012250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012260: 2020 2020 2020 2072 6567 6578 3d22 5e5c         regex="^\
-00012270: 5c73 2a28 3f50 3c69 643e 5c5c 642b 5c5c  \s*(?P<id>\\d+\\
-00012280: 2e5c 5c64 2b5c 5c2e 5c5c 642b 295c 5c73  .\\d+\\.\\d+)\\s
-00012290: 2b28 3f50 3c74 6974 6c65 3e2e 2a29 222c  +(?P<title>.*)",
-000122a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000122b0: 2020 2020 2020 2020 2020 2020 2020 6164                ad
-000122c0: 645f 6964 3d22 7375 6273 6563 7469 6f6e  d_id="subsection
-000122d0: 5f7c 222c 2061 6464 5f74 6974 6c65 3d22  _|", add_title="
-000122e0: 7c22 2c20 7374 796c 653d 227b 636f 6c6f  |", style="{colo
-000122f0: 7220 3a20 626c 6163 6b3b 2062 6163 6b67  r : black; backg
-00012300: 726f 756e 6420 3a20 2364 6464 6464 643b  round : #dddddd;
-00012310: 7d22 2929 0a20 2020 2020 2020 2061 6e6e  }")).        ann
-00012320: 6f74 6174 6f72 2e61 6464 5f63 6f6d 6d61  otator.add_comma
-00012330: 6e64 280a 2020 2020 2020 2020 2020 2020  nd(.            
-00012340: 416e 6e6f 7461 746f 7243 6f6d 6d61 6e64  AnnotatorCommand
-00012350: 2868 746d 6c5f 636c 6173 733d 2263 6f6e  (html_class="con
-00012360: 6669 6465 6e63 6522 2c0a 2020 2020 2020  fidence",.      
-00012370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012380: 2020 2020 2020 2072 6567 6578 3d22 5e5c         regex="^\
-00012390: 5c73 2a5c 5c28 3f28 3f50 3c74 6974 6c65  \s*\\(?(?P<title
-000123a0: 3e28 7665 7279 2068 6967 687c 6869 6768  >(very high|high
-000123b0: 7c6d 6564 6975 6d7c 6c6f 7729 2063 6f6e  |medium|low) con
-000123c0: 6669 6465 6e63 6529 5c5c 293f 222c 0a20  fidence)\\)?",. 
-000123d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000123e0: 2020 2020 2020 2020 2020 2020 6164 645f              add_
-000123f0: 6964 3d22 636f 6e66 6964 656e 6365 5f7c  id="confidence_|
-00012400: 222c 2061 6464 5f74 6974 6c65 3d22 7c22  ", add_title="|"
-00012410: 2c20 7374 796c 653d 227b 636f 6c6f 7220  , style="{color 
-00012420: 3a20 626c 6163 6b3b 2062 6163 6b67 726f  : black; backgro
-00012430: 756e 6420 3a20 2364 6438 3864 643b 7d22  und : #dd88dd;}"
-00012440: 2929 0a20 2020 2020 2020 2061 6e6e 6f74  )).        annot
-00012450: 6174 6f72 2e61 6464 5f63 6f6d 6d61 6e64  ator.add_command
-00012460: 280a 2020 2020 2020 2020 2020 2020 416e  (.            An
-00012470: 6e6f 7461 746f 7243 6f6d 6d61 6e64 2868  notatorCommand(h
-00012480: 746d 6c5f 636c 6173 733d 2270 726f 6261  tml_class="proba
-00012490: 6269 6c69 7479 222c 0a20 2020 2020 2020  bility",.       
-000124a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000124b0: 2020 2020 2020 7265 6765 783d 225e 5c5c        regex="^\\
-000124c0: 732a 5c5c 283f 283f 503c 7469 746c 653e  s*\\(?(?P<title>
-000124d0: 286c 696b 656c 797c 7665 7279 206c 696b  (likely|very lik
-000124e0: 656c 797c 6578 7472 656d 656c 7920 6c69  ely|extremely li
-000124f0: 6b65 6c79 7c76 6972 7475 616c 6c79 2063  kely|virtually c
-00012500: 6572 7461 696e 2929 5c5c 293f 222c 0a20  ertain))\\)?",. 
-00012510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012520: 2020 2020 2020 2020 2020 2020 6164 645f              add_
-00012530: 6964 3d22 7072 6f62 6162 696c 6974 795f  id="probability_
-00012540: 7c22 2c20 6164 645f 7469 746c 653d 227c  |", add_title="|
-00012550: 222c 2073 7479 6c65 3d22 7b63 6f6c 6f72  ", style="{color
-00012560: 203a 2063 7961 6e3b 2062 6163 6b67 726f   : cyan; backgro
-00012570: 756e 6420 3a20 2364 6438 3838 383b 7d22  und : #dd8888;}"
-00012580: 2929 0a20 2020 2020 2020 2061 6e6e 6f74  )).        annot
-00012590: 6174 6f72 2e61 6464 5f63 6f6d 6d61 6e64  ator.add_command
-000125a0: 280a 2020 2020 2020 2020 2020 2020 416e  (.            An
-000125b0: 6e6f 7461 746f 7243 6f6d 6d61 6e64 2868  notatorCommand(h
-000125c0: 746d 6c5f 636c 6173 733d 2273 7570 6572  tml_class="super
-000125d0: 7363 7269 7074 222c 2073 6372 6970 743d  script", script=
-000125e0: 2273 7570 6572 222c 2061 6464 5f69 643d  "super", add_id=
-000125f0: 2273 7570 6572 5f7c 222c 2061 6464 5f74  "super_|", add_t
-00012600: 6974 6c65 3d22 7c22 2c0a 2020 2020 2020  itle="|",.      
-00012610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012620: 2020 2020 2020 2073 7479 6c65 3d22 7b63         style="{c
-00012630: 6f6c 6f72 203a 2062 6c75 653b 2062 6163  olor : blue; bac
-00012640: 6b67 726f 6f75 6e64 3a20 7965 6c6c 6f77  kgroound: yellow
-00012650: 7d22 2929 0a20 2020 2020 2020 2061 6e6e  }")).        ann
-00012660: 6f74 6174 6f72 2e61 6464 5f63 6f6d 6d61  otator.add_comma
-00012670: 6e64 280a 2020 2020 2020 2020 2020 2020  nd(.            
-00012680: 416e 6e6f 7461 746f 7243 6f6d 6d61 6e64  AnnotatorCommand
-00012690: 2868 746d 6c5f 636c 6173 733d 2273 7461  (html_class="sta
-000126a0: 7274 222c 0a20 2020 2020 2020 2020 2020  rt",.           
+0000c1b0: 7479 7065 2873 6372 6970 745f 7479 7065  type(script_type
+0000c1c0: 2c20 6c61 7374 5f66 6f6e 745f 7369 7a65  , last_font_size
+0000c1d0: 2c20 6c61 7374 5f73 7061 6e2c 2074 6869  , last_span, thi
+0000c1e0: 735f 666f 6e74 5f73 697a 652c 2074 6869  s_font_size, thi
+0000c1f0: 735f 7370 616e 2c0a 2020 2020 2020 2020  s_span,.        
+0000c200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c220: 2020 2020 7964 6f77 6e29 0a20 2020 2020      ydown).     
+0000c230: 2020 2072 6574 7572 6e20 6973 5f73 6372     return is_scr
+0000c240: 6970 740a 0a20 2020 2040 636c 6173 736d  ipt..    @classm
+0000c250: 6574 686f 640a 2020 2020 6465 6620 6973  ethod.    def is
+0000c260: 5f72 6571 7569 7265 645f 7363 7269 7074  _required_script
+0000c270: 5f74 7970 6528 636c 732c 2073 6372 6970  _type(cls, scrip
+0000c280: 745f 7479 7065 2c20 6c61 7374 5f66 6f6e  t_type, last_fon
+0000c290: 745f 7369 7a65 2c20 6c61 7374 5f73 7061  t_size, last_spa
+0000c2a0: 6e2c 2074 6869 735f 666f 6e74 5f73 697a  n, this_font_siz
+0000c2b0: 652c 2074 6869 735f 7370 616e 2c20 7964  e, this_span, yd
+0000c2c0: 6f77 6e3d 5472 7565 2c20 293a 0a20 2020  own=True, ):.   
+0000c2d0: 2020 2020 2022 2222 6f6c 6420 6170 7072       """old appr
+0000c2e0: 6f61 6368 2077 6974 6820 416d 6953 7061  oach with AmiSpa
+0000c2f0: 6e0a 2020 2020 2020 2020 5468 6973 2069  n.        This i
+0000c300: 7320 6e6f 7420 7269 6768 7421 2222 220a  s not right!""".
+0000c310: 2020 2020 2020 2020 5946 4143 544f 5220          YFACTOR 
+0000c320: 3d20 3320 2320 7069 7865 6c73 0a20 2020  = 3 # pixels.   
+0000c330: 2020 2020 2069 735f 7363 7269 7074 203d       is_script =
+0000c340: 2046 616c 7365 0a20 2020 2020 2020 2073   False.        s
+0000c350: 6372 6970 745f 6661 6374 6f72 203d 2048  cript_factor = H
+0000c360: 746d 6c55 7469 6c2e 5343 5249 5054 5f46  tmlUtil.SCRIPT_F
+0000c370: 4143 540a 2020 2020 2020 2020 2320 6966  ACT.        # if
+0000c380: 2066 6f6e 7420 7369 7a65 7320 6e6f 7420   font sizes not 
+0000c390: 6769 7665 6e20 6173 7375 6d65 2074 6865  given assume the
+0000c3a0: 7920 646f 6e27 7420 6d61 7474 6572 0a20  y don't matter. 
+0000c3b0: 2020 2020 2020 2069 6620 6c61 7374 5f66         if last_f
+0000c3c0: 6f6e 745f 7369 7a65 2061 6e64 2074 6869  ont_size and thi
+0000c3d0: 735f 666f 6e74 5f73 697a 653a 0a20 2020  s_font_size:.   
+0000c3e0: 2020 2020 2020 2020 2070 6173 7365 645f           passed_
+0000c3f0: 666f 6e74 5f73 697a 655f 6368 616e 6765  font_size_change
+0000c400: 203d 2074 6869 735f 666f 6e74 5f73 697a   = this_font_siz
+0000c410: 6520 3c20 7363 7269 7074 5f66 6163 746f  e < script_facto
+0000c420: 7220 2a20 6c61 7374 5f66 6f6e 745f 7369  r * last_font_si
+0000c430: 7a65 0a20 2020 2020 2020 2065 6c73 653a  ze.        else:
+0000c440: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
+0000c450: 7365 645f 666f 6e74 5f73 697a 655f 6368  sed_font_size_ch
+0000c460: 616e 6765 203d 2054 7275 650a 2020 2020  ange = True.    
+0000c470: 2020 2020 2320 7573 6520 7920 636f 6f72      # use y coor
+0000c480: 6473 0a20 2020 2020 2020 2069 6620 7061  ds.        if pa
+0000c490: 7373 6564 5f66 6f6e 745f 7369 7a65 5f63  ssed_font_size_c
+0000c4a0: 6861 6e67 653a 0a20 2020 2020 2020 2020  hange:.         
+0000c4b0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0000c4c0: 2020 2020 2020 2020 6c61 7374 5f79 203d          last_y =
+0000c4d0: 206c 6173 745f 7370 616e 2e79 0a20 2020   last_span.y.   
+0000c4e0: 2020 2020 2020 2020 2020 2020 2074 6869               thi
+0000c4f0: 735f 7920 3d20 7468 6973 5f73 7061 6e2e  s_y = this_span.
+0000c500: 790a 2020 2020 2020 2020 2020 2020 6578  y.            ex
+0000c510: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
+0000c520: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+0000c530: 2020 2020 206c 6173 745f 7920 3d20 4874       last_y = Ht
+0000c540: 6d6c 5574 696c 2e67 6574 5f66 6c6f 6174  mlUtil.get_float
+0000c550: 286c 6173 745f 7370 616e 2c20 2279 3022  (last_span, "y0"
+0000c560: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000c570: 2020 7468 6973 5f79 203d 2048 746d 6c55    this_y = HtmlU
+0000c580: 7469 6c2e 6765 745f 666c 6f61 7428 7468  til.get_float(th
+0000c590: 6973 5f73 7061 6e2c 2022 7930 2229 0a20  is_span, "y0"). 
+0000c5a0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+0000c5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c5c0: 6c61 7374 5f78 203d 206c 6173 745f 7370  last_x = last_sp
+0000c5d0: 616e 2e78 0a20 2020 2020 2020 2020 2020  an.x.           
+0000c5e0: 2020 2020 2074 6869 735f 7820 3d20 7468       this_x = th
+0000c5f0: 6973 5f73 7061 6e2e 780a 2020 2020 2020  is_span.x.      
+0000c600: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
+0000c610: 6570 7469 6f6e 2061 7320 653a 0a20 2020  eption as e:.   
+0000c620: 2020 2020 2020 2020 2020 2020 206c 6173               las
+0000c630: 745f 7820 3d20 4874 6d6c 5574 696c 2e67  t_x = HtmlUtil.g
+0000c640: 6574 5f66 6c6f 6174 286c 6173 745f 7370  et_float(last_sp
+0000c650: 616e 2c20 2278 3022 290a 2020 2020 2020  an, "x0").      
+0000c660: 2020 2020 2020 2020 2020 7468 6973 5f78            this_x
+0000c670: 203d 2048 746d 6c55 7469 6c2e 6765 745f   = HtmlUtil.get_
+0000c680: 666c 6f61 7428 7468 6973 5f73 7061 6e2c  float(this_span,
+0000c690: 2022 7830 2229 0a20 2020 2020 2020 2020   "x0").         
+0000c6a0: 2020 2069 6620 7363 7269 7074 5f74 7970     if script_typ
+0000c6b0: 6520 3d3d 2053 5363 7269 7074 2e53 5542  e == SScript.SUB
+0000c6c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000c6d0: 2020 2320 6973 2069 7420 6c6f 7765 7265    # is it lowere
+0000c6e0: 643f 2059 2044 4f57 4e0a 2020 2020 2020  d? Y DOWN.      
+0000c6f0: 2020 2020 2020 2020 2020 6973 5f73 6372            is_scr
+0000c700: 6970 7420 3d20 7964 6f77 6e20 616e 6420  ipt = ydown and 
+0000c710: 286c 6173 745f 7920 3c20 7468 6973 5f79  (last_y < this_y
+0000c720: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+0000c730: 6966 2073 6372 6970 745f 7479 7065 203d  if script_type =
+0000c740: 3d20 5353 6372 6970 742e 5355 503a 0a20  = SScript.SUP:. 
+0000c750: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000c760: 2069 7320 6974 2072 6169 7365 643f 2059   is it raised? Y
+0000c770: 2044 4f57 4e0a 2020 2020 2020 2020 2020   DOWN.          
+0000c780: 2020 2020 2020 6973 5f73 6372 6970 7420        is_script 
+0000c790: 3d20 7964 6f77 6e20 616e 6420 286c 6173  = ydown and (las
+0000c7a0: 745f 7920 2d20 7468 6973 5f79 2920 3e20  t_y - this_y) > 
+0000c7b0: 5946 4143 544f 520a 2020 2020 2020 2020  YFACTOR.        
+0000c7c0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000c7d0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000c7e0: 5661 6c75 6545 7272 6f72 2822 6261 6420  ValueError("bad 
+0000c7f0: 7363 7269 7074 2074 7970 6520 222c 2073  script type ", s
+0000c800: 6372 6970 745f 7479 7065 290a 2020 2020  cript_type).    
+0000c810: 2020 2020 2020 2020 6966 2046 616c 7365          if False
+0000c820: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000c830: 2020 6966 2069 735f 7363 7269 7074 2061    if is_script a
+0000c840: 6e64 206c 6173 745f 7820 616e 6420 7468  nd last_x and th
+0000c850: 6973 5f78 3a0a 2020 2020 2020 2020 2020  is_x:.          
+0000c860: 2020 2020 2020 2020 2020 6973 5f73 6372            is_scr
+0000c870: 6970 7420 3d20 6c61 7374 5f78 203c 2074  ipt = last_x < t
+0000c880: 6869 735f 780a 2020 2020 2020 2020 7265  his_x.        re
+0000c890: 7475 726e 2069 735f 7363 7269 7074 0a0a  turn is_script..
+0000c8a0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+0000c8b0: 0a20 2020 2064 6566 2065 7874 7261 6374  .    def extract
+0000c8c0: 5f66 6f6f 746e 6f74 6573 2863 6c73 2c20  _footnotes(cls, 
+0000c8d0: 6874 6d6c 5f65 6c65 6d2c 2066 6f6e 745f  html_elem, font_
+0000c8e0: 7369 7a65 5f63 6f6e 6469 7469 6f6e 2c20  size_condition, 
+0000c8f0: 7469 746c 653d 2246 6f6f 746e 6f74 6573  title="Footnotes
+0000c900: 2229 3a0a 2020 2020 2020 2020 6469 7673  "):.        divs
+0000c910: 203d 2068 746d 6c5f 656c 656d 2e78 7061   = html_elem.xpa
+0000c920: 7468 2866 222f 2f64 6976 5b73 7061 6e5b  th(f"//div[span[
+0000c930: 636f 6e74 6169 6e73 2840 7374 796c 652c  contains(@style,
+0000c940: 2027 7b66 6f6e 745f 7369 7a65 5f63 6f6e   '{font_size_con
+0000c950: 6469 7469 6f6e 7d27 2920 616e 6420 6e75  dition}') and nu
+0000c960: 6d62 6572 282e 293d 6e75 6d62 6572 282e  mber(.)=number(.
+0000c970: 295d 5d22 290a 2020 2020 2020 2020 666f  )]]").        fo
+0000c980: 6f74 6e6f 7465 5f64 6976 203d 2048 746d  otnote_div = Htm
+0000c990: 6c47 726f 7570 2e67 6574 5f62 6163 6b5f  lGroup.get_back_
+0000c9a0: 6469 7628 6874 6d6c 5f65 6c65 6d29 0a20  div(html_elem). 
+0000c9b0: 2020 2020 2020 2066 6f6f 746e 6f74 655f         footnote_
+0000c9c0: 7469 746c 6520 3d20 4554 2e53 7562 456c  title = ET.SubEl
+0000c9d0: 656d 656e 7428 666f 6f74 6e6f 7465 5f64  ement(footnote_d
+0000c9e0: 6976 2c20 2264 6976 2229 0a20 2020 2020  iv, "div").     
+0000c9f0: 2020 2066 6f6f 746e 6f74 655f 7469 746c     footnote_titl
+0000ca00: 652e 7465 7874 203d 2074 6974 6c65 0a20  e.text = title. 
+0000ca10: 2020 2020 2020 2075 6c20 3d20 4554 2e53         ul = ET.S
+0000ca20: 7562 456c 656d 656e 7428 666f 6f74 6e6f  ubElement(footno
+0000ca30: 7465 5f64 6976 2c20 2275 6c22 290a 2020  te_div, "ul").  
+0000ca40: 2020 2020 2020 6375 7272 656e 745f 6c69        current_li
+0000ca50: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+0000ca60: 666f 7220 6469 7620 696e 2064 6976 733a  for div in divs:
+0000ca70: 0a20 2020 2020 2020 2020 2020 2073 7061  .            spa
+0000ca80: 6e73 203d 2064 6976 2e78 7061 7468 2822  ns = div.xpath("
+0000ca90: 2e2f 7370 616e 2229 0a20 2020 2020 2020  ./span").       
+0000caa0: 2020 2020 2066 6f72 2069 2c20 7370 616e       for i, span
+0000cab0: 2069 6e20 656e 756d 6572 6174 6528 7370   in enumerate(sp
+0000cac0: 616e 7329 3a0a 2020 2020 2020 2020 2020  ans):.          
+0000cad0: 2020 2020 2020 6966 2058 6d6c 4c69 622e        if XmlLib.
+0000cae0: 6973 5f69 6e74 6567 6572 2873 7061 6e29  is_integer(span)
+0000caf0: 2061 6e64 2028 6920 3d3d 2030 206f 7220   and (i == 0 or 
+0000cb00: 4874 6d6c 5574 696c 2e69 735f 7375 7065  HtmlUtil.is_supe
+0000cb10: 7273 6372 6970 7428 7370 616e 735b 6920  rscript(spans[i 
+0000cb20: 2d20 315d 2c20 7370 616e 2929 3a0a 2020  - 1], span)):.  
+0000cb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cb40: 2020 6375 7272 656e 745f 6c69 203d 2045    current_li = E
+0000cb50: 542e 5375 6245 6c65 6d65 6e74 2875 6c2c  T.SubElement(ul,
+0000cb60: 2022 6c69 2229 0a20 2020 2020 2020 2020   "li").         
+0000cb70: 2020 2020 2020 2069 6620 6375 7272 656e         if curren
+0000cb80: 745f 6c69 2069 7320 6e6f 7420 4e6f 6e65  t_li is not None
+0000cb90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000cba0: 2020 2020 2020 6375 7272 656e 745f 6c69        current_li
+0000cbb0: 2e61 7070 656e 6428 7370 616e 290a 0a0a  .append(span)...
+0000cbc0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+0000cbd0: 0a20 2020 2064 6566 2061 6e6e 6f74 6174  .    def annotat
+0000cbe0: 655f 7363 7269 7074 5f74 7970 6528 636c  e_script_type(cl
+0000cbf0: 732c 2073 7061 6e2c 2073 6372 6970 745f  s, span, script_
+0000cc00: 7479 7065 2c20 7363 7269 7074 5f66 6163  type, script_fac
+0000cc10: 746f 723d 4e6f 6e65 2c20 6c61 7374 5f73  tor=None, last_s
+0000cc20: 7061 6e3d 4e6f 6e65 2c20 7964 6f77 6e3d  pan=None, ydown=
+0000cc30: 5472 7565 293a 0a20 2020 2020 2020 2022  True):.        "
+0000cc40: 2222 6973 2061 2073 7061 6e20 6120 7375  ""is a span a su
+0000cc50: 6220 6f72 2073 7570 6572 7363 7269 7074  b or superscript
+0000cc60: 3f0a 2020 2020 2020 2020 3a70 6172 616d  ?.        :param
+0000cc70: 2073 7061 6e3a 2074 6f20 7465 7374 0a20   span: to test. 
+0000cc80: 2020 2020 2020 203a 7061 7261 6d20 7363         :param sc
+0000cc90: 7269 7074 5f74 7970 653a 2053 5363 7269  ript_type: SScri
+0000cca0: 7074 2e53 5542 206f 7220 5353 6372 6970  pt.SUB or SScrip
+0000ccb0: 742e 5355 5045 520a 2020 2020 2020 2020  t.SUPER.        
+0000ccc0: 3a70 6172 616d 2073 6372 6970 745f 6661  :param script_fa
+0000ccd0: 6374 6f72 3a20 6966 204e 6f6e 652c 2064  ctor: if None, d
+0000cce0: 6566 6175 6c74 7320 746f 2048 746d 6c55  efaults to HtmlU
+0000ccf0: 7469 6c2e 5343 5249 5054 5f46 4143 540a  til.SCRIPT_FACT.
+0000cd00: 2020 2020 2020 2020 3a70 6172 616d 206c          :param l
+0000cd10: 6173 745f 7370 616e 3a20 7072 6563 6564  ast_span: preced
+0000cd20: 696e 6720 7370 616e 3b20 6966 204e 6f6e  ing span; if Non
+0000cd30: 6520 7472 6965 7320 7870 6174 6828 2270  e tries xpath("p
+0000cd40: 7265 6365 6469 6e67 3a3a 7370 616e 2229  receding::span")
+0000cd50: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0000cd60: 7964 6f77 6e3a 2069 7320 7920 7275 6e6e  ydown: is y runn
+0000cd70: 696e 6720 646f 6e77 2074 6865 2070 6167  ing donw the pag
+0000cd80: 653f 0a20 2020 2020 2020 2022 2222 0a20  e?.        """. 
+0000cd90: 2020 2020 2020 2069 6620 7370 616e 2069         if span i
+0000cda0: 7320 4e6f 6e65 206f 7220 6e6f 7420 7363  s None or not sc
+0000cdb0: 7269 7074 5f74 7970 653a 0a20 2020 2020  ript_type:.     
+0000cdc0: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+0000cdd0: 6e65 0a20 2020 2020 2020 2069 6620 6e6f  ne.        if no
+0000cde0: 7420 7363 7269 7074 5f66 6163 746f 723a  t script_factor:
+0000cdf0: 0a20 2020 2020 2020 2020 2020 2073 6372  .            scr
+0000ce00: 6970 745f 6661 6374 6f72 203d 2048 746d  ipt_factor = Htm
+0000ce10: 6c55 7469 6c2e 5343 5249 5054 5f46 4143  lUtil.SCRIPT_FAC
+0000ce20: 540a 2020 2020 2020 2020 6966 206e 6f74  T.        if not
+0000ce30: 206c 6173 745f 7370 616e 3a0a 2020 2020   last_span:.    
+0000ce40: 2020 2020 2020 2020 6c61 7374 5f73 7061          last_spa
+0000ce50: 6e20 3d20 7370 616e 2e78 7061 7468 2822  n = span.xpath("
+0000ce60: 7072 6563 6564 696e 673a 3a73 7061 6e22  preceding::span"
+0000ce70: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0000ce80: 206c 656e 286c 6173 745f 7370 616e 2920   len(last_span) 
+0000ce90: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
+0000cea0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+0000ceb0: 650a 2020 2020 2020 2020 2020 2020 6c61  e.            la
+0000cec0: 7374 5f73 7061 6e20 3d20 6c61 7374 5f73  st_span = last_s
+0000ced0: 7061 6e5b 2d31 5d0a 2020 2020 2020 2020  pan[-1].        
+0000cee0: 6373 7373 203d 2043 5353 5374 796c 652e  csss = CSSStyle.
+0000cef0: 6372 6561 7465 5f63 7373 5f73 7479 6c65  create_css_style
+0000cf00: 5f66 726f 6d5f 6174 7472 6962 7574 655f  _from_attribute_
+0000cf10: 6f66 5f62 6f64 795f 656c 656d 656e 7428  of_body_element(
+0000cf20: 7370 616e 290a 2020 2020 2020 2020 6c61  span).        la
+0000cf30: 7374 5f63 7373 7320 3d20 4353 5353 7479  st_csss = CSSSty
+0000cf40: 6c65 2e63 7265 6174 655f 6373 735f 7374  le.create_css_st
+0000cf50: 796c 655f 6672 6f6d 5f61 7474 7269 6275  yle_from_attribu
+0000cf60: 7465 5f6f 665f 626f 6479 5f65 6c65 6d65  te_of_body_eleme
+0000cf70: 6e74 286c 6173 745f 7370 616e 290a 2020  nt(last_span).  
+0000cf80: 2020 2020 2020 666f 6e74 5f73 697a 6520        font_size 
+0000cf90: 3d20 6373 7373 2e66 6f6e 745f 7369 7a65  = csss.font_size
+0000cfa0: 0a20 2020 2020 2020 206c 6173 745f 666f  .        last_fo
+0000cfb0: 6e74 5f73 697a 6520 3d20 6c61 7374 5f63  nt_size = last_c
+0000cfc0: 7373 732e 666f 6e74 5f73 697a 650a 2020  sss.font_size.  
+0000cfd0: 2020 2020 2020 6973 5f73 6372 6970 7420        is_script 
+0000cfe0: 3d20 4e6f 6e65 0a20 2020 2020 2020 2069  = None.        i
+0000cff0: 6620 666f 6e74 5f73 697a 6520 616e 6420  f font_size and 
+0000d000: 666f 6e74 5f73 697a 6520 3c20 7363 7269  font_size < scri
+0000d010: 7074 5f66 6163 746f 7220 2a20 6c61 7374  pt_factor * last
+0000d020: 5f66 6f6e 745f 7369 7a65 3a0a 2020 2020  _font_size:.    
+0000d030: 2020 2020 2020 2020 6c61 7374 5f79 203d          last_y =
+0000d040: 2043 5353 5374 796c 652e 6765 745f 7930   CSSStyle.get_y0
+0000d050: 286c 6173 745f 7370 616e 290a 2020 2020  (last_span).    
+0000d060: 2020 2020 2020 2020 7468 6973 5f79 203d          this_y =
+0000d070: 2043 5353 5374 796c 652e 6765 745f 7930   CSSStyle.get_y0
+0000d080: 2873 7061 6e29 0a20 2020 2020 2020 2020  (span).         
+0000d090: 2020 2069 6620 7363 7269 7074 5f74 7970     if script_typ
+0000d0a0: 6520 3d3d 2053 5363 7269 7074 2e53 5542  e == SScript.SUB
+0000d0b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000d0c0: 2020 2320 6973 2069 7420 6c6f 7765 7265    # is it lowere
+0000d0d0: 643f 2059 2044 4f57 4e0a 2020 2020 2020  d? Y DOWN.      
+0000d0e0: 2020 2020 2020 2020 2020 6973 5f73 6372            is_scr
+0000d0f0: 6970 7420 3d20 7964 6f77 6e20 3d3d 2028  ipt = ydown == (
+0000d100: 6c61 7374 5f79 203c 2074 6869 735f 7929  last_y < this_y)
+0000d110: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+0000d120: 6620 7363 7269 7074 5f74 7970 6520 3d3d  f script_type ==
+0000d130: 2053 5363 7269 7074 2e53 5550 3a0a 2020   SScript.SUP:.  
+0000d140: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000d150: 6973 2069 7420 7261 6973 6564 3f20 5920  is it raised? Y 
+0000d160: 444f 574e 0a20 2020 2020 2020 2020 2020  DOWN.           
+0000d170: 2020 2020 2069 735f 7363 7269 7074 203d       is_script =
+0000d180: 2079 646f 776e 203d 3d20 286c 6173 745f   ydown == (last_
+0000d190: 7920 3e20 7468 6973 5f79 290a 2020 2020  y > this_y).    
+0000d1a0: 2020 2020 2020 2020 6966 2069 735f 7363          if is_sc
+0000d1b0: 7269 7074 3a0a 2020 2020 2020 2020 2020  ript:.          
+0000d1c0: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
+0000d1d0: 2020 2072 6574 7572 6e20 6973 5f73 6372     return is_scr
+0000d1e0: 6970 740a 0a0a 2020 2020 4063 6c61 7373  ipt...    @class
+0000d1f0: 6d65 7468 6f64 0a20 2020 2064 6566 2073  method.    def s
+0000d200: 6574 5f61 7474 7269 6228 636c 732c 2065  et_attrib(cls, e
+0000d210: 6c65 6d65 6e74 2c20 6174 746e 616d 652c  lement, attname,
+0000d220: 2061 7474 7661 6c75 6529 3a0a 2020 2020   attvalue):.    
+0000d230: 2020 2020 2222 2263 6f6e 7665 6e69 656e      """convenien
+0000d240: 6365 206d 6574 686f 6420 746f 2073 6574  ce method to set
+0000d250: 2061 7474 7269 6275 7465 2076 616c 7565   attribute value
+0000d260: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000d270: 2020 2020 2069 6620 656c 656d 656e 7420       if element 
+0000d280: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0000d290: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+0000d2a0: 4572 726f 7228 2265 6c65 6d65 6e74 2069  Error("element i
+0000d2b0: 7320 4e6f 6e65 2229 0a20 2020 2020 2020  s None").       
+0000d2c0: 2069 6620 6174 746e 616d 6520 616e 6420   if attname and 
+0000d2d0: 6174 7476 616c 7565 3a0a 2020 2020 2020  attvalue:.      
+0000d2e0: 2020 2020 2020 656c 656d 656e 742e 7365        element.se
+0000d2f0: 7428 6174 746e 616d 652c 2073 7472 2861  t(attname, str(a
+0000d300: 7474 7661 6c75 6529 290a 0a20 2020 2040  ttvalue))..    @
+0000d310: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+0000d320: 6465 6620 6765 745f 7465 7874 5f63 6f6e  def get_text_con
+0000d330: 7465 6e74 2863 6c73 2c20 656c 656d 293a  tent(cls, elem):
+0000d340: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000d350: 2020 2020 2063 6f6e 7665 6e69 656e 6365       convenience
+0000d360: 206d 6574 686f 643b 2061 766f 6964 7320   method; avoids 
+0000d370: 6861 7669 6e67 2074 6f20 7265 6d65 6d62  having to rememb
+0000d380: 6572 206a 6f69 6e2f 6974 6572 7465 7874  er join/itertext
+0000d390: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000d3a0: 2020 2020 2072 6574 7572 6e20 2727 2e6a       return ''.j
+0000d3b0: 6f69 6e28 656c 656d 2e69 7465 7274 6578  oin(elem.itertex
+0000d3c0: 7428 2929 0a0a 2020 2020 4063 6c61 7373  t())..    @class
+0000d3d0: 6d65 7468 6f64 0a20 2020 2064 6566 2061  method.    def a
+0000d3e0: 6464 5f67 656e 6572 6174 6564 5f69 6473  dd_generated_ids
+0000d3f0: 2863 6c73 2c20 726f 6f74 5f65 6c65 6d29  (cls, root_elem)
+0000d400: 3a0a 2020 2020 2020 2020 2222 2261 6464  :.        """add
+0000d410: 7320 4944 7320 746f 2061 6c6c 2065 6c65  s IDs to all ele
+0000d420: 6d65 6e74 7320 696e 2064 6f63 756d 656e  ments in documen
+0000d430: 7420 6f72 6465 720a 2020 2020 2020 2020  t order.        
+0000d440: 3a70 6172 616d 2072 6f6f 745f 656c 656d  :param root_elem
+0000d450: 3a20 656c 656d 656e 7420 6465 6669 6e69  : element defini
+0000d460: 6e67 2074 7265 6520 6f66 2073 7562 656c  ng tree of subel
+0000d470: 656d 656e 7473 2222 220a 2020 2020 2020  ements""".      
+0000d480: 2020 7870 6174 6820 3d20 222f 2f2a 220a    xpath = "//*".
+0000d490: 2020 2020 2020 2020 656c 656d 7320 3d20          elems = 
+0000d4a0: 726f 6f74 5f65 6c65 6d2e 7870 6174 6828  root_elem.xpath(
+0000d4b0: 7870 6174 6829 0a20 2020 2020 2020 2066  xpath).        f
+0000d4c0: 6f72 2069 2c20 656c 2069 6e20 656e 756d  or i, el in enum
+0000d4d0: 6572 6174 6528 656c 656d 7329 3a0a 2020  erate(elems):.  
+0000d4e0: 2020 2020 2020 2020 2020 656c 2e61 7474            el.att
+0000d4f0: 7269 625b 415f 4944 5d20 3d20 415f 4944  rib[A_ID] = A_ID
+0000d500: 202b 2073 7472 2869 290a 2020 2020 4063   + str(i).    @c
+0000d510: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+0000d520: 6566 206a 6f69 6e5f 7370 616e 735f 696e  ef join_spans_in
+0000d530: 5f73 616d 655f 6469 7628 636c 732c 2073  _same_div(cls, s
+0000d540: 7061 6e30 2c20 7370 616e 312c 2061 6464  pan0, span1, add
+0000d550: 7370 6163 653d 5472 7565 2c20 7265 6d6f  space=True, remo
+0000d560: 7665 3d54 7275 6529 3a0a 2020 2020 2020  ve=True):.      
+0000d570: 2020 2222 220a 2020 2020 2020 2020 6a6f    """.        jo
+0000d580: 696e 7420 3c73 7061 6e3e 2e2e 2e3c 2f73  int <span>...</s
+0000d590: 7061 6e3e 3c73 7061 6e3e 2e2e 2e3c 2f73  pan><span>...</s
+0000d5a0: 7061 6e3e 2069 6e74 6f20 3c73 7061 6e3e  pan> into <span>
+0000d5b0: 2e2e 2e3c 2f73 7061 6e3e 0a20 2020 2020  ...</span>.     
+0000d5c0: 2020 2074 6869 7320 7374 7275 6374 7572     this structur
+0000d5d0: 6520 6172 6973 6573 2077 6865 6e20 5044  e arises when PD
+0000d5e0: 4620 6f72 2069 6d61 6765 7320 6973 2070  F or images is p
+0000d5f0: 6172 7365 6420 616e 6420 7370 616e 7320  arsed and spans 
+0000d600: 6861 7665 2074 6865 2073 616d 6520 7374  have the same st
+0000d610: 796c 6573 2028 7369 7a65 2f73 7479 6c65  yles (size/style
+0000d620: 2f77 6569 6768 7429 2061 6e64 2063 616e  /weight) and can
+0000d630: 2062 6520 6d65 7267 6564 0a20 2020 2020   be merged.     
+0000d640: 2020 2077 6520 6173 7375 6d65 2074 6861     we assume tha
+0000d650: 7420 7374 796c 6520 616e 6420 6765 6f6d  t style and geom
+0000d660: 6574 7279 2063 6865 6b69 6e67 2068 6173  etry cheking has
+0000d670: 2062 6565 6e20 646f 6e65 0a20 2020 2020   been done.     
+0000d680: 2020 203a 7061 7261 6d20 7370 616e 303a     :param span0:
+0000d690: 2066 6972 7374 203c 7370 616e 3e2c 2074   first <span>, t
+0000d6a0: 6578 7420 7769 6c6c 2062 6520 696e 6372  ext will be incr
+0000d6b0: 6561 7365 6420 6672 6f6d 2073 7061 6e31  eased from span1
+0000d6c0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0000d6d0: 7370 616e 313a 2074 6578 7420 7769 6c6c  span1: text will
+0000d6e0: 2062 6520 6170 7065 6e64 6564 2074 6f20   be appended to 
+0000d6f0: 7370 616e 3020 7465 7874 0a20 2020 2020  span0 text.     
+0000d700: 2020 203a 7061 7261 6d20 7265 6d6f 7665     :param remove
+0000d710: 3a20 7265 6d6f 7665 2073 7061 6e31 2028  : remove span1 (
+0000d720: 6465 6661 756c 7429 0a20 2020 2020 2020  default).       
+0000d730: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
+0000d740: 4874 6d6c 5574 696c 2e63 6865 636b 5f74  HtmlUtil.check_t
+0000d750: 6167 2873 7061 6e30 2c20 2273 7061 6e22  ag(span0, "span"
+0000d760: 2920 616e 6420 4874 6d6c 5574 696c 2e63  ) and HtmlUtil.c
+0000d770: 6865 636b 5f74 6167 2873 7061 6e31 2c20  heck_tag(span1, 
+0000d780: 2273 7061 6e22 293a 0a20 2020 2020 2020  "span"):.       
+0000d790: 2020 2020 2070 6172 656e 7431 203d 2073       parent1 = s
+0000d7a0: 7061 6e31 2e67 6574 7061 7265 6e74 2829  pan1.getparent()
+0000d7b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000d7c0: 6164 6473 7061 6365 3a0a 2020 2020 2020  addspace:.      
+0000d7d0: 2020 2020 2020 2020 2020 7370 616e 305f            span0_
+0000d7e0: 6e6f 745f 656e 645f 7370 6163 6520 3d20  not_end_space = 
+0000d7f0: 6c65 6e28 7370 616e 3029 203e 2030 2061  len(span0) > 0 a
+0000d800: 6e64 2073 7061 6e30 5b2d 315d 2021 3d20  nd span0[-1] != 
+0000d810: 2220 220a 2020 2020 2020 2020 2020 2020  " ".            
+0000d820: 2020 2020 7370 616e 315f 6e6f 745f 7374      span1_not_st
+0000d830: 6172 745f 7370 6163 6520 3d20 6c65 6e28  art_space = len(
+0000d840: 7370 616e 3129 203e 2030 2061 6e64 2073  span1) > 0 and s
+0000d850: 7061 6e31 5b2d 315d 2021 3d20 2220 220a  pan1[-1] != " ".
+0000d860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d870: 6966 2073 7061 6e30 5f6e 6f74 5f65 6e64  if span0_not_end
+0000d880: 5f73 7061 6365 2061 6e64 2073 7061 6e31  _space and span1
+0000d890: 5f6e 6f74 5f73 7461 7274 5f73 7061 6365  _not_start_space
+0000d8a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000d8b0: 2020 2020 2020 7370 616e 302e 7465 7874        span0.text
+0000d8c0: 202b 3d20 2220 220a 2020 2020 2020 2020   += " ".        
+0000d8d0: 2020 2020 7370 616e 302e 7465 7874 202b      span0.text +
+0000d8e0: 3d20 7370 616e 312e 7465 7874 0a20 2020  = span1.text.   
+0000d8f0: 2020 2020 2020 2020 2069 6620 7265 6d6f           if remo
+0000d900: 7665 3a0a 2020 2020 2020 2020 2020 2020  ve:.            
+0000d910: 2020 2020 7061 7265 6e74 312e 7265 6d6f      parent1.remo
+0000d920: 7665 2873 7061 6e31 290a 0a0a 0a0a 2020  ve(span1).....  
+0000d930: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+0000d940: 2020 2064 6566 2063 7265 6174 655f 736b     def create_sk
+0000d950: 656c 6574 6f6e 5f68 746d 6c28 636c 7329  eleton_html(cls)
+0000d960: 3a0a 2020 2020 2020 2020 2222 2263 7265  :.        """cre
+0000d970: 6174 6520 656d 7074 7920 6874 6d6c 2074  ate empty html t
+0000d980: 7265 650a 2020 2020 2020 2020 6874 6d6c  ree.        html
+0000d990: 0a20 2020 2020 2020 2020 2020 2068 6561  .            hea
+0000d9a0: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
+0000d9b0: 2020 6d65 7461 0a20 2020 2020 2020 2020    meta.         
+0000d9c0: 2020 2020 2020 2023 2073 7479 6c65 0a20         # style. 
+0000d9d0: 2020 2020 2020 2020 2020 2062 6f64 790a             body.
+0000d9e0: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+0000d9f0: 3a20 7468 6973 2068 746d 6c0a 2020 2020  : this html.    
+0000da00: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+0000da10: 2068 746d 6c20 3d20 4554 2e45 6c65 6d65   html = ET.Eleme
+0000da20: 6e74 2848 5f48 544d 4c29 0a20 2020 2020  nt(H_HTML).     
+0000da30: 2020 2068 6561 6420 3d20 4554 2e45 6c65     head = ET.Ele
+0000da40: 6d65 6e74 2848 5f48 4541 4429 0a20 2020  ment(H_HEAD).   
+0000da50: 2020 2020 2068 746d 6c2e 6170 7065 6e64       html.append
+0000da60: 2868 6561 6429 0a20 2020 2020 2020 206d  (head).        m
+0000da70: 6574 6120 3d20 4554 2e45 6c65 6d65 6e74  eta = ET.Element
+0000da80: 2848 5f4d 4554 4129 0a20 2020 2020 2020  (H_META).       
+0000da90: 2068 6561 642e 6170 7065 6e64 286d 6574   head.append(met
+0000daa0: 6129 0a20 2020 2020 2020 2073 7479 6c65  a).        style
+0000dab0: 203d 2045 542e 456c 656d 656e 7428 485f   = ET.Element(H_
+0000dac0: 5354 594c 4529 2020 2320 656d 7074 7920  STYLE)  # empty 
+0000dad0: 3c73 7479 6c65 3e20 6d65 616e 7320 6e6f  <style> means no
+0000dae0: 2064 6973 706c 6179 0a20 2020 2020 2020   display.       
+0000daf0: 2023 2068 6561 642e 6170 7065 6e64 2873   # head.append(s
+0000db00: 7479 6c65 290a 2020 2020 2020 2020 626f  tyle).        bo
+0000db10: 6479 203d 2045 542e 456c 656d 656e 7428  dy = ET.Element(
+0000db20: 485f 424f 4459 290a 2020 2020 2020 2020  H_BODY).        
+0000db30: 6874 6d6c 2e61 7070 656e 6428 626f 6479  html.append(body
+0000db40: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0000db50: 2068 746d 6c0a 0a20 2020 2040 636c 6173   html..    @clas
+0000db60: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+0000db70: 6669 6e64 5f65 6c65 6d65 6e74 735f 7769  find_elements_wi
+0000db80: 7468 5f73 7479 6c65 2863 6c73 2c20 656c  th_style(cls, el
+0000db90: 656d 2c20 7870 6174 682c 2063 6f6e 6469  em, xpath, condi
+0000dba0: 7469 6f6e 3d4e 6f6e 652c 2072 656d 6f76  tion=None, remov
+0000dbb0: 653d 4661 6c73 6529 3a0a 2020 2020 2020  e=False):.      
+0000dbc0: 2020 2222 2272 656d 6f76 6520 616c 6c20    """remove all 
+0000dbd0: 656c 656d 656e 7473 2077 6974 6820 7374  elements with st
+0000dbe0: 796c 6520 6675 6c66 696c 6c69 6e67 2063  yle fulfilling c
+0000dbf0: 6f6e 6469 7469 6f6e 0a20 2020 2020 2020  ondition.       
+0000dc00: 203a 7061 7261 6d20 656c 656d 3a20 726f   :param elem: ro
+0000dc10: 6f74 2065 6c65 6d65 6e74 2066 6f72 2078  ot element for x
+0000dc20: 7061 7468 0a20 2020 2020 2020 203a 7061  path.        :pa
+0000dc30: 7261 6d20 7870 6174 683a 2065 6c65 6d65  ram xpath: eleme
+0000dc40: 6e74 7320 746f 2073 6361 6e20 2c20 7368  nts to scan , sh
+0000dc50: 6f75 6c64 206e 6f72 6d61 6c6c 7920 636f  ould normally co
+0000dc60: 6e74 6169 6e20 7468 6520 4073 7479 6c65  ntain the @style
+0000dc70: 2063 6f6e 6469 7469 6f6e 0a20 2020 2020   condition.     
+0000dc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dc90: 2020 2020 2069 6620 4e6f 6e65 2075 7365       if None use
+0000dca0: 730a 2020 2020 2020 2020 3a70 6172 616d  s.        :param
+0000dcb0: 2063 6f6e 6469 7469 6f6e 3a20 7374 796c   condition: styl
+0000dcc0: 6520 636f 6e64 6974 696f 6e20 7072 696d  e condition prim
+0000dcd0: 6974 6976 6520 6174 2070 7265 7365 6e74  itive at present
+0000dce0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dcf0: 2020 2020 2020 2020 2020 2028 7661 7269             (vari
+0000dd00: 6162 6c65 2c20 6f72 2076 6172 6961 626c  able, or variabl
+0000dd10: 6520 206f 7065 7261 746f 7220 7661 6c75  e  operator valu
+0000dd20: 6520 2865 7661 6c20 6973 2065 7669 6c29  e (eval is evil)
+0000dd30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dd40: 2020 2020 2020 2020 2020 2065 7861 6d70             examp
+0000dd50: 6c65 2022 5f66 6f6e 742d 7369 7a65 203e  le "_font-size >
+0000dd60: 2033 3022 206f 7220 225f 706f 7369 7469   30" or "_positi
+0000dd70: 6f6e 2220 286d 6561 6e73 2068 6173 2070  on" (means has p
+0000dd80: 6f73 6974 696f 6e29 0a20 2020 2020 2020  osition).       
+0000dd90: 203a 7061 7261 6d20 7265 6d6f 7665 3a20   :param remove: 
+0000dda0: 7265 6d6f 7665 2074 6865 7365 2065 6c65  remove these ele
+0000ddb0: 6d65 6e74 7320 286e 6f74 2074 6865 6972  ments (not their
+0000ddc0: 2074 6169 6c29 0a20 2020 2020 2020 2022   tail).        "
+0000ddd0: 2222 0a20 2020 2020 2020 2022 2222 0a20  "".        """. 
+0000dde0: 2020 2020 2020 204d 6179 6265 206d 6f76         Maybe mov
+0000ddf0: 6520 746f 2048 544d 4c54 6964 790a 2020  e to HTMLTidy.  
+0000de00: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000de10: 2020 6173 7365 7274 2065 6c65 6d20 6973    assert elem is
+0000de20: 206e 6f74 204e 6f6e 652c 2066 226d 7573   not None, f"mus
+0000de30: 7420 6861 7665 2065 6c65 6d22 0a20 2020  t have elem".   
+0000de40: 2020 2020 2069 6620 7870 6174 683a 0a20       if xpath:. 
+0000de50: 2020 2020 2020 2020 2020 2065 6c73 203d             els =
+0000de60: 2065 6c65 6d2e 7870 6174 6828 7870 6174   elem.xpath(xpat
+0000de70: 6829 0a20 2020 2020 2020 2065 6c73 653a  h).        else:
+0000de80: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+0000de90: 203d 205b 656c 656d 5d0a 2020 2020 2020   = [elem].      
+0000dea0: 2020 656c 656d 7320 3d20 5b5d 0a20 2020    elems = [].   
+0000deb0: 2020 2020 2066 6f72 2065 6c20 696e 2065       for el in e
+0000dec0: 6c73 3a0a 2020 2020 2020 2020 2020 2020  ls:.            
+0000ded0: 6373 735f 7374 796c 6520 3d20 4353 5353  css_style = CSSS
+0000dee0: 7479 6c65 2e63 7265 6174 655f 6373 735f  tyle.create_css_
+0000def0: 7374 796c 655f 6672 6f6d 5f61 7474 7269  style_from_attri
+0000df00: 6275 7465 5f6f 665f 626f 6479 5f65 6c65  bute_of_body_ele
+0000df10: 6d65 6e74 2865 6c29 0a20 2020 2020 2020  ment(el).       
+0000df20: 2020 2020 2069 6620 636f 6e64 6974 696f       if conditio
+0000df30: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
+0000df40: 2020 2069 6620 6373 735f 7374 796c 652e     if css_style.
+0000df50: 6f62 6579 7328 636f 6e64 6974 696f 6e29  obeys(condition)
+0000df60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000df70: 2020 2020 2020 6966 2072 656d 6f76 653a        if remove:
+0000df80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000df90: 2020 2020 2020 2020 2063 6c73 2e72 656d           cls.rem
+0000dfa0: 6f76 655f 656c 656d 5f6b 6565 705f 7461  ove_elem_keep_ta
+0000dfb0: 696c 2865 6c29 0a0a 2020 2020 4063 6c61  il(el)..    @cla
+0000dfc0: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+0000dfd0: 2072 656d 6f76 655f 6865 6164 6572 735f   remove_headers_
+0000dfe0: 616e 645f 666f 6f74 6572 735f 7573 696e  and_footers_usin
+0000dff0: 675f 7064 666d 696e 6572 5f63 6f6f 7264  g_pdfminer_coord
+0000e000: 7328 636c 732c 2072 6566 5f65 6c65 6d2c  s(cls, ref_elem,
+0000e010: 2070 6167 6573 697a 652c 2068 6561 6465   pagesize, heade
+0000e020: 725f 6865 6967 6874 2c20 666f 6f74 6572  r_height, footer
+0000e030: 5f68 6569 6768 742c 0a20 2020 2020 2020  _height,.       
+0000e040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e070: 2020 6d61 726b 6572 5f78 7061 7468 2c20    marker_xpath, 
+0000e080: 7061 6765 5f74 6f70 733d 4e6f 6e65 293a  page_tops=None):
+0000e090: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000e0a0: 2020 2020 204e 4f54 2043 4f4d 504c 4554       NOT COMPLET
+0000e0b0: 4520 2d20 7468 6572 6520 6172 6520 6e6f  E - there are no
+0000e0c0: 2066 6f6f 7465 7273 2062 6563 6175 7365   footers because
+0000e0d0: 206f 6620 7468 6520 636f 6f72 6469 6e61   of the coordina
+0000e0e0: 7465 2073 7973 7465 6d2e 0a0a 2020 2020  te system...    
+0000e0f0: 2020 2020 4d61 7962 6520 6d6f 7665 2074      Maybe move t
+0000e100: 6f20 4854 4d4c 5469 6479 0a0a 2020 2020  o HTMLTidy..    
+0000e110: 2020 2020 7468 6520 4074 6f70 2072 6570      the @top rep
+0000e120: 7265 7365 6e74 7320 7468 6520 792d 636f  resents the y-co
+0000e130: 6f72 6469 6e61 7465 2066 726f 6d20 7468  ordinate from th
+0000e140: 6520 7374 6172 7420 6f66 2074 6865 2064  e start of the d
+0000e150: 6f63 756d 656e 7420 2870 6466 6d69 6e65  ocument (pdfmine
+0000e160: 723f 292e 0a20 2020 2020 2020 2074 6869  r?)..        thi
+0000e170: 7320 6d65 616e 7320 7765 2068 6176 6520  s means we have 
+0000e180: 746f 2073 7562 7472 6163 7420 7061 6765  to subtract page
+0000e190: 7369 7a65 7320 6672 6f6d 2069 742e 0a20  sizes from it.. 
+0000e1a0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000e1b0: 2020 2064 6562 7567 203d 2046 616c 7365     debug = False
+0000e1c0: 0a20 2020 2020 2020 2065 6c65 6d73 203d  .        elems =
+0000e1d0: 2072 6566 5f65 6c65 6d2e 7870 6174 6828   ref_elem.xpath(
+0000e1e0: 6d61 726b 6572 5f78 7061 7468 290a 0a20  marker_xpath).. 
+0000e1f0: 2020 2020 2020 206c 6173 745f 746f 7020         last_top 
+0000e200: 3d20 300a 2020 2020 2020 2020 666f 7220  = 0.        for 
+0000e210: 656c 656d 2069 6e20 7265 665f 656c 656d  elem in ref_elem
+0000e220: 2e78 7061 7468 2822 2f2f 2a5b 4073 7479  .xpath("//*[@sty
+0000e230: 6c65 5d22 293a 0a20 2020 2020 2020 2020  le]"):.         
+0000e240: 2020 2079 636f 6f72 6430 203d 2048 746d     ycoord0 = Htm
+0000e250: 6c55 7469 6c2e 6765 745f 7930 2865 6c65  lUtil.get_y0(ele
+0000e260: 6d29 0a20 2020 2020 2020 2020 2020 2069  m).            i
+0000e270: 6620 6e6f 7420 7963 6f6f 7264 303a 0a20  f not ycoord0:. 
+0000e280: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000e290: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
+0000e2a0: 2020 2020 7465 7874 203d 2058 6d6c 4c69      text = XmlLi
+0000e2b0: 622e 6765 745f 7465 7874 2865 6c65 6d29  b.get_text(elem)
+0000e2c0: 2e73 7472 6970 2829 0a20 2020 2020 2020  .strip().       
+0000e2d0: 2020 2020 2070 6167 655f 746f 705f 7920       page_top_y 
+0000e2e0: 3d20 4874 6d6c 5574 696c 2e67 6574 5f6c  = HtmlUtil.get_l
+0000e2f0: 6172 6765 7374 5f63 6f6f 7264 5f6c 6573  argest_coord_les
+0000e300: 735f 7468 616e 2870 6167 655f 746f 7073  s_than(page_tops
+0000e310: 2c20 7963 6f6f 7264 3029 0a20 2020 2020  , ycoord0).     
+0000e320: 2020 2020 2020 2069 6620 7061 6765 5f74         if page_t
+0000e330: 6f70 5f79 2069 7320 4e6f 6e65 3a0a 2020  op_y is None:.  
+0000e340: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0000e350: 696e 7428 6622 6361 6e6e 6f74 2066 696e  int(f"cannot fin
+0000e360: 6420 7061 6765 2074 6f70 207b 7963 6f6f  d page top {ycoo
+0000e370: 7264 307d 2229 0a20 2020 2020 2020 2020  rd0}").         
+0000e380: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+0000e390: 2020 2020 2020 2020 2020 2020 7061 6765              page
+0000e3a0: 5f74 6f70 5f79 203d 2066 6c6f 6174 2870  _top_y = float(p
+0000e3b0: 6167 655f 746f 705f 7929 0a20 2020 2020  age_top_y).     
+0000e3c0: 2020 2020 2020 2079 636f 6f72 6420 3d20         ycoord = 
+0000e3d0: 7963 6f6f 7264 3020 2d20 7061 6765 5f74  ycoord0 - page_t
+0000e3e0: 6f70 5f79 0a0a 2020 2020 2020 2020 2020  op_y..          
+0000e3f0: 2020 2320 7072 696e 7428 6622 544f 5020    # print(f"TOP 
+0000e400: 7b79 636f 6f72 6430 7d20 7b79 636f 6f72  {ycoord0} {ycoor
+0000e410: 647d 207b 7061 6765 7369 7a65 7d20 7b79  d} {pagesize} {y
+0000e420: 636f 6f72 6420 2520 7061 6765 7369 7a65  coord % pagesize
+0000e430: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+0000e440: 696e 5f74 6f70 203d 2079 636f 6f72 6420  in_top = ycoord 
+0000e450: 3c20 6865 6164 6572 5f68 6569 6768 740a  < header_height.
+0000e460: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+0000e470: 6e5f 746f 703a 0a20 2020 2020 2020 2020  n_top:.         
+0000e480: 2020 2020 2020 2069 6620 6465 6275 673a         if debug:
+0000e490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e4a0: 2020 2020 2070 7269 6e74 2866 2254 4f50       print(f"TOP
+0000e4b0: 2020 7b74 6578 747d 2229 0a20 2020 2020    {text}").     
+0000e4c0: 2020 2020 2020 2069 6e5f 626f 7474 6f6d         in_bottom
+0000e4d0: 203d 2079 636f 6f72 6420 3e20 7061 6765   = ycoord > page
+0000e4e0: 7369 7a65 5b30 5d20 2d20 666f 6f74 6572  size[0] - footer
+0000e4f0: 5f68 6569 6768 740a 2020 2020 2020 2020  _height.        
+0000e500: 2020 2020 6966 2069 6e5f 626f 7474 6f6d      if in_bottom
+0000e510: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000e520: 2020 6966 2064 6562 7567 3a0a 2020 2020    if debug:.    
+0000e530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e540: 7072 696e 7428 6622 424f 5454 4f4d 2020  print(f"BOTTOM  
+0000e550: 7b74 6578 747d 2229 0a20 2020 2020 2020  {text}").       
+0000e560: 2020 2020 2069 6620 696e 5f74 6f70 206f       if in_top o
+0000e570: 7220 696e 5f62 6f74 746f 6d3a 0a20 2020  r in_bottom:.   
+0000e580: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000e590: 6c65 6e28 7465 7874 2e73 7472 6970 2829  len(text.strip()
+0000e5a0: 2920 3e20 303a 0a20 2020 2020 2020 2020  ) > 0:.         
+0000e5b0: 2020 2020 2020 2020 2020 206c 6f67 6769             loggi
+0000e5c0: 6e67 2e77 6172 6e69 6e67 2866 2272 656d  ng.warning(f"rem
+0000e5d0: 6f76 696e 6720 746f 7020 7465 7874 207b  oving top text {
+0000e5e0: 7465 7874 7d22 290a 2020 2020 2020 2020  text}").        
+0000e5f0: 2020 2020 2020 2020 636c 732e 7265 6d6f          cls.remo
+0000e600: 7665 5f65 6c65 6d5f 6b65 6570 5f74 6169  ve_elem_keep_tai
+0000e610: 6c28 656c 656d 290a 2020 2020 2020 2020  l(elem).        
+0000e620: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000e630: 2020 2020 2020 2020 2020 2320 736b 6970            # skip
+0000e640: 7065 640a 2020 2020 2020 2020 2020 2020  ped.            
+0000e650: 2020 2020 7061 7373 0a0a 2020 2020 4063      pass..    @c
+0000e660: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+0000e670: 6566 2067 6574 5f6c 6172 6765 7374 5f63  ef get_largest_c
+0000e680: 6f6f 7264 5f6c 6573 735f 7468 616e 2863  oord_less_than(c
+0000e690: 6c73 2c20 7061 6765 5f74 6f70 732c 2063  ls, page_tops, c
+0000e6a0: 6f6f 7264 293a 0a20 2020 2020 2020 2022  oord):.        "
+0000e6b0: 2222 0a20 2020 2020 2020 2069 7465 7261  "".        itera
+0000e6c0: 7465 2074 6872 6f75 6768 2073 6f72 7465  te through sorte
+0000e6d0: 6420 6c69 7374 206f 6620 7061 6765 5f74  d list of page_t
+0000e6e0: 6f70 7320 616e 6420 6669 6e64 2074 6865  ops and find the
+0000e6f0: 206c 6172 6765 7374 206c 6573 7320 7468   largest less th
+0000e700: 616e 2063 6f6f 7264 0a20 2020 2020 2020  an coord.       
+0000e710: 203a 7061 7261 6d20 7061 6765 5f74 6f70   :param page_top
+0000e720: 733a 2073 6f72 7465 6420 696e 6372 6561  s: sorted increa
+0000e730: 7369 6e67 206c 6973 7420 6f66 2070 6167  sing list of pag
+0000e740: 6520 746f 7073 0a20 2020 2020 2020 203a  e tops.        :
+0000e750: 7061 7261 6d20 636f 6f72 643a 2061 6374  param coord: act
+0000e760: 7561 6c20 636f 6f72 6469 6e61 7465 0a20  ual coordinate. 
+0000e770: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000e780: 2020 2069 6620 7061 6765 5f74 6f70 7320     if page_tops 
+0000e790: 6973 204e 6f6e 6520 6f72 2063 6f6f 7264  is None or coord
+0000e7a0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0000e7b0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+0000e7c0: 650a 2020 2020 2020 2020 666f 7220 692c  e.        for i,
+0000e7d0: 2070 6167 655f 746f 7020 696e 2065 6e75   page_top in enu
+0000e7e0: 6d65 7261 7465 2870 6167 655f 746f 7073  merate(page_tops
+0000e7f0: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
+0000e800: 6620 666c 6f61 7428 7061 6765 5f74 6f70  f float(page_top
+0000e810: 2920 3e20 666c 6f61 7428 636f 6f72 6429  ) > float(coord)
+0000e820: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000e830: 2020 6966 2069 203d 3d20 303a 0a20 2020    if i == 0:.   
+0000e840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e850: 2072 6574 7572 6e20 4e6f 6e65 0a20 2020   return None.   
+0000e860: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000e870: 7572 6e20 7061 6765 5f74 6f70 735b 6920  urn page_tops[i 
+0000e880: 2d20 315d 0a20 2020 2020 2020 2072 6574  - 1].        ret
+0000e890: 7572 6e20 4e6f 6e65 0a0a 2020 2020 4063  urn None..    @c
+0000e8a0: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+0000e8b0: 6566 2072 656d 6f76 655f 6c68 5f6c 696e  ef remove_lh_lin
+0000e8c0: 655f 6e75 6d62 6572 7328 636c 732c 2072  e_numbers(cls, r
+0000e8d0: 6566 5f65 6c65 6d29 3a0a 2020 2020 2020  ef_elem):.      
+0000e8e0: 2020 636c 732e 6669 6e64 5f65 6c65 6d65    cls.find_eleme
+0000e8f0: 6e74 735f 7769 7468 5f73 7479 6c65 2872  nts_with_style(r
+0000e900: 6566 5f65 6c65 6d2c 2022 2e2f 2f2a 5b40  ef_elem, ".//*[@
+0000e910: 7374 796c 655d 222c 2022 6c65 6674 3c34  style]", "left<4
+0000e920: 3922 2c20 7265 6d6f 7665 3d54 7275 6529  9", remove=True)
+0000e930: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000e940: 2020 2020 204d 6179 6265 206d 6f76 6520       Maybe move 
+0000e950: 746f 2048 544d 4c54 6964 790a 2020 2020  to HTMLTidy.    
+0000e960: 2020 2020 2222 220a 0a20 2020 2040 636c      """..    @cl
+0000e970: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+0000e980: 6620 7265 6d6f 7665 5f61 7474 7269 6275  f remove_attribu
+0000e990: 7465 2863 6c73 2c20 656c 656d 2c20 6174  te(cls, elem, at
+0000e9a0: 745f 6e61 6d65 293a 0a20 2020 2020 2020  t_name):.       
+0000e9b0: 2022 2222 0a20 2020 2020 2020 2072 656d   """.        rem
+0000e9c0: 6f76 6573 2061 7474 7269 6275 7465 2077  oves attribute w
+0000e9d0: 6974 6820 6769 7665 6e20 6e61 6d65 0a20  ith given name. 
+0000e9e0: 2020 2020 2020 2049 6620 6e6f 7420 7072         If not pr
+0000e9f0: 6573 656e 742c 206e 6f2d 6f70 0a20 2020  esent, no-op.   
+0000ea00: 2020 2020 203a 7061 7261 6d20 656c 656d       :param elem
+0000ea10: 3a20 656c 656d 656e 7420 636f 6e74 6169  : element contai
+0000ea20: 6e69 6e67 2061 7474 7269 6275 7465 0a20  ning attribute. 
+0000ea30: 2020 2020 2020 203a 7061 7261 6d20 6174         :param at
+0000ea40: 745f 6e61 6d65 3a20 6e61 6d65 206f 6620  t_name: name of 
+0000ea50: 6174 7472 6962 7574 650a 2020 2020 2020  attribute.      
+0000ea60: 2020 3a72 6574 7572 6e3a 204e 6f6e 650a    :return: None.
+0000ea70: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000ea80: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000ea90: 726f 6f74 2e61 7474 7269 622e 706f 7028  root.attrib.pop(
+0000eaa0: 2278 797a 222c 204e 6f6e 6529 2022 2222  "xyz", None) """
+0000eab0: 0a20 2020 2020 2020 2069 6620 656c 656d  .        if elem
+0000eac0: 2069 7320 4e6f 6e65 206f 7220 6174 745f   is None or att_
+0000ead0: 6e61 6d65 2069 7320 4e6f 6e65 3a0a 2020  name is None:.  
+0000eae0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000eaf0: 0a20 2020 2020 2020 2065 6c65 6d2e 6174  .        elem.at
+0000eb00: 7472 6962 2e70 6f70 2861 7474 5f6e 616d  trib.pop(att_nam
+0000eb10: 652c 204e 6f6e 6529 0a0a 2020 2020 4063  e, None)..    @c
+0000eb20: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+0000eb30: 6566 2072 656d 6f76 655f 7374 796c 655f  ef remove_style_
+0000eb40: 6174 7472 6962 7574 6528 636c 732c 2072  attribute(cls, r
+0000eb50: 6566 5f65 6c65 6d2c 2073 7479 6c65 5f6e  ef_elem, style_n
+0000eb60: 616d 6529 3a0a 2020 2020 2020 2020 2222  ame):.        ""
+0000eb70: 220a 2020 2020 2020 2020 4d61 7962 6520  ".        Maybe 
+0000eb80: 6d6f 7665 2074 6f20 4854 4d4c 5469 6479  move to HTMLTidy
+0000eb90: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+0000eba0: 2020 2020 2020 656c 656d 7320 3d20 7265        elems = re
+0000ebb0: 665f 656c 656d 2e78 7061 7468 2822 2e2f  f_elem.xpath("./
+0000ebc0: 2f2a 2229 0a20 2020 2020 2020 2066 6f72  /*").        for
+0000ebd0: 2065 6c20 696e 2065 6c65 6d73 3a0a 2020   el in elems:.  
+0000ebe0: 2020 2020 2020 2020 2020 6373 735f 7374            css_st
+0000ebf0: 796c 6520 3d20 4353 5353 7479 6c65 2e63  yle = CSSStyle.c
+0000ec00: 7265 6174 655f 6373 735f 7374 796c 655f  reate_css_style_
+0000ec10: 6672 6f6d 5f61 7474 7269 6275 7465 5f6f  from_attribute_o
+0000ec20: 665f 626f 6479 5f65 6c65 6d65 6e74 2865  f_body_element(e
+0000ec30: 6c29 0a20 2020 2020 2020 2020 2020 2069  l).            i
+0000ec40: 6620 6373 735f 7374 796c 652e 6e61 6d65  f css_style.name
+0000ec50: 5f76 616c 7565 5f64 6963 742e 6765 7428  _value_dict.get(
+0000ec60: 7374 796c 655f 6e61 6d65 293a 0a20 2020  style_name):.   
+0000ec70: 2020 2020 2020 2020 2020 2020 2063 7373               css
+0000ec80: 5f73 7479 6c65 2e6e 616d 655f 7661 6c75  _style.name_valu
+0000ec90: 655f 6469 6374 2e70 6f70 2873 7479 6c65  e_dict.pop(style
+0000eca0: 5f6e 616d 6529 0a20 2020 2020 2020 2020  _name).         
+0000ecb0: 2020 2020 2020 2063 7373 5f73 7479 6c65         css_style
+0000ecc0: 2e61 7070 6c79 5f74 6f28 656c 290a 0a20  .apply_to(el).. 
+0000ecd0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+0000ece0: 2020 2020 6465 6620 7265 6d6f 7665 5f6c      def remove_l
+0000ecf0: 6172 6765 5f66 6f6e 7465 645f 656c 656d  arge_fonted_elem
+0000ed00: 656e 7473 2863 6c73 2c20 7265 665f 656c  ents(cls, ref_el
+0000ed10: 656d 293a 0a20 2020 2020 2020 2022 2222  em):.        """
+0000ed20: 0a20 2020 2020 2020 204d 6179 6265 206d  .        Maybe m
+0000ed30: 6f76 6520 746f 2048 544d 4c54 6964 790a  ove to HTMLTidy.
+0000ed40: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000ed50: 2020 2020 636c 732e 6669 6e64 5f65 6c65      cls.find_ele
+0000ed60: 6d65 6e74 735f 7769 7468 5f73 7479 6c65  ments_with_style
+0000ed70: 2872 6566 5f65 6c65 6d2c 2022 2e2f 2f2a  (ref_elem, ".//*
+0000ed80: 5b40 7374 796c 655d 222c 2022 666f 6e74  [@style]", "font
+0000ed90: 2d73 697a 653e 3330 222c 2072 656d 6f76  -size>30", remov
+0000eda0: 653d 5472 7565 290a 0a20 2020 2040 636c  e=True)..    @cl
+0000edb0: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+0000edc0: 6620 6669 6e64 5f63 6f6e 7374 616e 745f  f find_constant_
+0000edd0: 636f 6f72 6469 6e61 7465 5f6d 6172 6b65  coordinate_marke
+0000ede0: 7273 2863 6c73 2c20 7265 665f 656c 656d  rs(cls, ref_elem
+0000edf0: 2c20 7870 6174 682c 2073 7479 6c65 3d22  , xpath, style="
+0000ee00: 746f 7022 293a 0a20 2020 2020 2020 2022  top"):.        "
+0000ee10: 2222 0a20 2020 2020 2020 2066 696e 6473  "".        finds
+0000ee20: 2061 206c 696e 6520 7769 7468 2063 6f6e   a line with con
+0000ee30: 7374 616e 7420 6469 6666 6572 656e 6365  stant difference
+0000ee40: 2066 726f 6d20 746f 7020 6f66 2070 6167   from top of pag
+0000ee50: 650a 3c64 6976 2073 7479 6c65 3d22 746f  e.<div style="to
+0000ee60: 703a 2035 3070 783b 223e 3c61 206e 616d  p: 50px;"><a nam
+0000ee70: 653d 2231 223e 5061 6765 2031 3c2f 613e  e="1">Page 1</a>
+0000ee80: 3c2f 6469 763e 0a20 2020 2020 2020 2022  </div>.        "
+0000ee90: 2222 0a20 2020 2020 2020 2022 2222 0a20  "".        """. 
+0000eea0: 2020 2020 2020 204d 6179 6265 206d 6f76         Maybe mov
+0000eeb0: 6520 746f 2048 544d 4c54 6964 790a 2020  e to HTMLTidy.  
+0000eec0: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+0000eed0: 2020 2065 6c65 6d73 203d 2072 6566 5f65     elems = ref_e
+0000eee0: 6c65 6d2e 7870 6174 6828 7870 6174 6829  lem.xpath(xpath)
+0000eef0: 0a20 2020 2020 2020 2063 6f6f 7264 7320  .        coords 
+0000ef00: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
+0000ef10: 2065 6c65 6d20 696e 2065 6c65 6d73 3a0a   elem in elems:.
+0000ef20: 2020 2020 2020 2020 2020 2020 6373 735f              css_
+0000ef30: 7374 796c 6520 3d20 4353 5353 7479 6c65  style = CSSStyle
+0000ef40: 2e63 7265 6174 655f 6373 735f 7374 796c  .create_css_styl
+0000ef50: 655f 6672 6f6d 5f61 7474 7269 6275 7465  e_from_attribute
+0000ef60: 5f6f 665f 626f 6479 5f65 6c65 6d65 6e74  _of_body_element
+0000ef70: 2865 6c65 6d29 0a20 2020 2020 2020 2020  (elem).         
+0000ef80: 2020 2063 6f6f 7264 203d 2063 7373 5f73     coord = css_s
+0000ef90: 7479 6c65 2e6e 616d 655f 7661 6c75 655f  tyle.name_value_
+0000efa0: 6469 6374 2e67 6574 2873 7479 6c65 290a  dict.get(style).
+0000efb0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+0000efc0: 6f6f 7264 3a0a 2020 2020 2020 2020 2020  oord:.          
+0000efd0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0000efe0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000eff0: 6f6f 7264 732e 6170 7065 6e64 2866 6c6f  oords.append(flo
+0000f000: 6174 2863 6f6f 7264 5b3a 2d32 5d29 290a  at(coord[:-2])).
+0000f010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f020: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+0000f030: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000f040: 2020 2020 2020 6c6f 6767 696e 672e 7761        logging.wa
+0000f050: 726e 696e 6728 6622 6361 6e6e 6f74 2070  rning(f"cannot p
+0000f060: 6172 7365 207b 636f 6f72 647d 2066 6f72  arse {coord} for
+0000f070: 207b 7374 796c 657d 2229 0a20 2020 2020   {style}").     
+0000f080: 2020 2069 6620 6e6f 7420 636f 6f72 6473     if not coords
+0000f090: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000f0a0: 7475 726e 204e 6f6e 652c 204e 6f6e 652c  turn None, None,
+0000f0b0: 205b 5d0a 2020 2020 2020 2020 6e70 5f63   [].        np_c
+0000f0c0: 6f6f 7264 7320 3d20 6e70 2e61 7272 6179  oords = np.array
+0000f0d0: 2863 6f6f 7264 7329 0a0a 2020 2020 2020  (coords)..      
+0000f0e0: 2020 7820 3d20 6e70 2e61 7272 6179 2872    x = np.array(r
+0000f0f0: 616e 6765 286e 705f 636f 6f72 6473 2e73  ange(np_coords.s
+0000f100: 697a 6529 292e 7265 7368 6170 6528 282d  ize)).reshape((-
+0000f110: 312c 2031 2929 0a20 2020 2020 2020 206d  1, 1)).        m
+0000f120: 6f64 656c 203d 204c 696e 6561 7252 6567  odel = LinearReg
+0000f130: 7265 7373 696f 6e28 292e 6669 7428 782c  ression().fit(x,
+0000f140: 2063 6f6f 7264 7329 0a20 2020 2020 2020   coords).       
+0000f150: 2072 5f73 7120 3d20 6d6f 6465 6c2e 7363   r_sq = model.sc
+0000f160: 6f72 6528 782c 2063 6f6f 7264 7329 0a20  ore(x, coords). 
+0000f170: 2020 2020 2020 2069 6620 725f 7371 203c         if r_sq <
+0000f180: 2030 2e39 383a 0a20 2020 2020 2020 2020   0.98:.         
+0000f190: 2020 206c 6f67 6769 6e67 2e77 6172 6e69     logging.warni
+0000f1a0: 6e67 2866 2263 616e 6e6f 7420 6361 6c63  ng(f"cannot calc
+0000f1b0: 756c 6174 6520 6f66 6673 6574 2072 656c  ulate offset rel
+0000f1c0: 6961 626c 7922 290a 2020 2020 2020 2020  iably").        
+0000f1d0: 7265 7475 726e 206d 6f64 656c 2e69 6e74  return model.int
+0000f1e0: 6572 6365 7074 5f2c 206d 6f64 656c 2e63  ercept_, model.c
+0000f1f0: 6f65 665f 2c20 6e70 5f63 6f6f 7264 730a  oef_, np_coords.
+0000f200: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+0000f210: 640a 2020 2020 6465 6620 7265 6d6f 7665  d.    def remove
+0000f220: 5f75 6e77 616e 7465 6473 2863 6c73 2c20  _unwanteds(cls, 
+0000f230: 746f 705f 656c 656d 2c20 756e 7761 6e74  top_elem, unwant
+0000f240: 6564 7329 3a0a 2020 2020 2020 2020 2222  eds):.        ""
+0000f250: 220a 2020 2020 2020 2020 4d61 7962 6520  ".        Maybe 
+0000f260: 6d6f 7665 2074 6f20 4854 4d4c 5469 6479  move to HTMLTidy
+0000f270: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000f280: 2020 2020 2069 6620 6e6f 7420 756e 7761       if not unwa
+0000f290: 6e74 6564 733a 0a20 2020 2020 2020 2020  nteds:.         
+0000f2a0: 2020 206c 6f67 6769 6e67 2e77 6172 6e69     logging.warni
+0000f2b0: 6e67 2866 226e 6f20 756e 7761 6e74 6564  ng(f"no unwanted
+0000f2c0: 7320 746f 2072 656d 6f76 6522 290a 2020  s to remove").  
+0000f2d0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000f2e0: 0a20 2020 2020 2020 2066 6f72 206b 6579  .        for key
+0000f2f0: 2069 6e20 756e 7761 6e74 6564 733a 0a20   in unwanteds:. 
+0000f300: 2020 2020 2020 2020 2020 2075 6e77 616e             unwan
+0000f310: 7465 6420 3d20 756e 7761 6e74 6564 735b  ted = unwanteds[
+0000f320: 6b65 795d 0a20 2020 2020 2020 2020 2020  key].           
+0000f330: 2078 7061 7468 203d 2075 6e77 616e 7465   xpath = unwante
+0000f340: 645b 555f 5850 4154 485d 0a20 2020 2020  d[U_XPATH].     
+0000f350: 2020 2020 2020 2069 6620 7870 6174 683a         if xpath:
+0000f360: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f370: 2072 6567 6578 203d 2075 6e77 616e 7465   regex = unwante
+0000f380: 645b 555f 5245 4745 585d 0a20 2020 2020  d[U_REGEX].     
+0000f390: 2020 2020 2020 2020 2020 2072 6567 6578             regex
+0000f3a0: 5f63 6f6d 7020 3d20 7265 2e63 6f6d 7069  _comp = re.compi
+0000f3b0: 6c65 2872 6567 6578 2920 6966 2072 6567  le(regex) if reg
+0000f3c0: 6578 2065 6c73 6520 4e6f 6e65 0a20 2020  ex else None.   
+0000f3d0: 2020 2020 2020 2020 2020 2020 2065 6c65               ele
+0000f3e0: 6d73 203d 2074 6f70 5f65 6c65 6d2e 7870  ms = top_elem.xp
+0000f3f0: 6174 6828 7870 6174 6829 0a20 2020 2020  ath(xpath).     
+0000f400: 2020 2020 2020 2020 2020 2066 6f72 2065             for e
+0000f410: 6c65 6d20 696e 2065 6c65 6d73 3a0a 2020  lem in elems:.  
+0000f420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f430: 2020 7465 7874 203d 2048 746d 6c55 7469    text = HtmlUti
+0000f440: 6c2e 6765 745f 7465 7874 5f63 6f6e 7465  l.get_text_conte
+0000f450: 6e74 2865 6c65 6d29 0a20 2020 2020 2020  nt(elem).       
+0000f460: 2020 2020 2020 2020 2020 2020 206d 6174               mat
+0000f470: 6368 6564 203d 2072 6567 6578 5f63 6f6d  ched = regex_com
+0000f480: 702e 7365 6172 6368 2874 6578 7429 2069  p.search(text) i
+0000f490: 6620 7265 6765 785f 636f 6d70 2065 6c73  f regex_comp els
+0000f4a0: 6520 5472 7565 0a20 2020 2020 2020 2020  e True.         
+0000f4b0: 2020 2020 2020 2020 2020 2069 6620 6d61             if ma
+0000f4c0: 7463 6865 643a 0a20 2020 2020 2020 2020  tched:.         
+0000f4d0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000f4e0: 6c73 2e72 656d 6f76 655f 656c 656d 5f6b  ls.remove_elem_k
+0000f4f0: 6565 705f 7461 696c 2865 6c65 6d29 0a0a  eep_tail(elem)..
+0000f500: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+0000f510: 0a20 2020 2064 6566 2072 656d 6f76 655f  .    def remove_
+0000f520: 6e65 776c 696e 6573 2863 6c73 2c20 656c  newlines(cls, el
+0000f530: 656d 293a 0a20 2020 2020 2020 2022 2222  em):.        """
+0000f540: 7265 6d6f 7665 205c 6e22 2222 0a20 2020  remove \n""".   
+0000f550: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000f560: 204d 6179 6265 206d 6f76 6520 746f 2048   Maybe move to H
+0000f570: 544d 4c54 6964 790a 2020 2020 2020 2020  TMLTidy.        
+0000f580: 2222 220a 0a20 2020 2020 2020 2066 6f72  """..        for
+0000f590: 2065 6c20 696e 2065 6c65 6d2e 7870 6174   el in elem.xpat
+0000f5a0: 6828 222e 2f2f 2a5b 6e6f 7428 2a29 5d22  h(".//*[not(*)]"
+0000f5b0: 293a 0a20 2020 2020 2020 2020 2020 2074  ):.            t
+0000f5c0: 6578 7420 3d20 4874 6d6c 5574 696c 2e67  ext = HtmlUtil.g
+0000f5d0: 6574 5f74 6578 745f 636f 6e74 656e 7428  et_text_content(
+0000f5e0: 656c 290a 2020 2020 2020 2020 2020 2020  el).            
+0000f5f0: 7465 7874 3120 3d20 7465 7874 2e72 6570  text1 = text.rep
+0000f600: 6c61 6365 2827 5c6e 272c 2027 2729 0a20  lace('\n', ''). 
+0000f610: 2020 2020 2020 2020 2020 2069 6620 7465             if te
+0000f620: 7874 3120 213d 2074 6578 743a 0a20 2020  xt1 != text:.   
+0000f630: 2020 2020 2020 2020 2020 2020 2065 6c2e               el.
+0000f640: 7465 7874 203d 2074 6578 7431 0a0a 2020  text = text1..  
+0000f650: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+0000f660: 2020 2064 6566 2072 656d 6f76 655f 7374     def remove_st
+0000f670: 796c 6528 636c 732c 2078 7061 7468 5f72  yle(cls, xpath_r
+0000f680: 6f6f 745f 656c 656d 2c20 6e61 6d65 7329  oot_elem, names)
+0000f690: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0000f6a0: 2020 2020 2020 7265 6d6f 7665 7320 6e61        removes na
+0000f6b0: 6d65 2d76 616c 7565 2070 6169 7273 2066  me-value pairs f
+0000f6c0: 726f 6d20 6373 732d 7374 796c 6520 616e  rom css-style an
+0000f6d0: 6420 7265 6170 706c 7920 746f 2078 7061  d reapply to xpa
+0000f6e0: 7468 2765 6420 656c 656d 656e 7473 2222  th'ed elements""
+0000f6f0: 220a 2020 2020 2020 2020 2222 220a 2020  ".        """.  
+0000f700: 2020 2020 2020 4d61 7962 6520 6d6f 7665        Maybe move
+0000f710: 2074 6f20 4854 4d4c 5469 6479 0a20 2020   to HTMLTidy.   
+0000f720: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+0000f730: 2020 7870 6174 6820 3d20 6622 2e2f 2f2a    xpath = f".//*
+0000f740: 5b40 7374 796c 655d 220a 2020 2020 2020  [@style]".      
+0000f750: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+0000f760: 2020 2073 7479 6c65 645f 656c 656d 7320     styled_elems 
+0000f770: 3d20 7870 6174 685f 726f 6f74 5f65 6c65  = xpath_root_ele
+0000f780: 6d2e 7870 6174 6828 7870 6174 6829 0a20  m.xpath(xpath). 
+0000f790: 2020 2020 2020 2065 7863 6570 7420 4554         except ET
+0000f7a0: 2e58 5061 7468 4576 616c 4572 726f 7220  .XPathEvalError 
+0000f7b0: 6173 2078 7065 653a 0a20 2020 2020 2020  as xpee:.       
+0000f7c0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+0000f7d0: 4572 726f 7228 6622 4261 6420 7870 6174  Error(f"Bad xpat
+0000f7e0: 6820 7b78 7061 7468 7d22 290a 0a20 2020  h {xpath}")..   
+0000f7f0: 2020 2020 2066 6f72 2073 7479 6c65 645f       for styled_
+0000f800: 656c 656d 2069 6e20 7374 796c 6564 5f65  elem in styled_e
+0000f810: 6c65 6d73 3a0a 2020 2020 2020 2020 2020  lems:.          
+0000f820: 2020 6373 735f 7374 796c 6520 3d20 4353    css_style = CS
+0000f830: 5353 7479 6c65 2e63 7265 6174 655f 6373  SStyle.create_cs
+0000f840: 735f 7374 796c 655f 6672 6f6d 5f61 7474  s_style_from_att
+0000f850: 7269 6275 7465 5f6f 665f 626f 6479 5f65  ribute_of_body_e
+0000f860: 6c65 6d65 6e74 2873 7479 6c65 645f 656c  lement(styled_el
+0000f870: 656d 290a 2020 2020 2020 2020 2020 2020  em).            
+0000f880: 6373 735f 7374 796c 652e 7265 6d6f 7665  css_style.remove
+0000f890: 286e 616d 6573 290a 2020 2020 2020 2020  (names).        
+0000f8a0: 2020 2020 6373 735f 7374 796c 652e 6170      css_style.ap
+0000f8b0: 706c 795f 746f 2873 7479 6c65 645f 656c  ply_to(styled_el
+0000f8c0: 656d 290a 2020 2020 2020 2020 2020 2020  em).            
+0000f8d0: 7374 796c 6520 3d20 4874 6d6c 5374 796c  style = HtmlStyl
+0000f8e0: 652e 6765 745f 6373 7373 7479 6c65 5f73  e.get_cssstyle_s
+0000f8f0: 7472 696e 6728 7374 796c 6564 5f65 6c65  tring(styled_ele
+0000f900: 6d29 0a0a 2020 2020 4063 6c61 7373 6d65  m)..    @classme
+0000f910: 7468 6f64 0a20 2020 2064 6566 2065 7874  thod.    def ext
+0000f920: 7261 6374 5f73 7562 7374 7269 6e67 7328  ract_substrings(
+0000f930: 636c 732c 2065 6c65 6d2c 2078 7061 7468  cls, elem, xpath
+0000f940: 3d4e 6f6e 652c 2072 6567 6578 3d4e 6f6e  =None, regex=Non
+0000f950: 652c 2072 656d 6f76 653d 4661 6c73 652c  e, remove=False,
+0000f960: 2069 6e63 6c75 6465 5f6e 6f6e 653d 4661   include_none=Fa
+0000f970: 6c73 652c 2061 6464 5f69 643d 4661 6c73  lse, add_id=Fals
+0000f980: 6529 3a0a 2020 2020 2020 2020 2222 2267  e):.        """g
+0000f990: 6574 7320 7375 6273 7472 696e 6720 6672  ets substring fr
+0000f9a0: 6f6d 2062 6f64 7920 6f66 2074 6578 7420  om body of text 
+0000f9b0: 696e 2065 6c65 6d0a 2020 2020 2020 2020  in elem.        
+0000f9c0: 7265 6765 7820 6f66 2066 6f72 6d20 283f  regex of form (?
+0000f9d0: 503c 7072 653e 2928 3f50 3c62 6f64 793e  P<pre>)(?P<body>
+0000f9e0: 2928 3f50 3c70 6f73 743e 290a 2020 2020  )(?P<post>).    
+0000f9f0: 2020 2020 7072 6520 616e 6420 6f72 2070      pre and or p
+0000fa00: 6f73 7420 6361 6e20 6265 206d 6973 7369  ost can be missi
+0000fa10: 6e67 0a20 2020 2020 2020 2028 5468 6572  ng.        (Ther
+0000fa20: 6520 7769 6c6c 2062 6520 6265 7474 6572  e will be better
+0000fa30: 2077 6179 7320 6f66 2064 6f69 6e67 2074   ways of doing t
+0000fa40: 6869 7321 290a 2020 2020 2020 2020 3a70  his!).        :p
+0000fa50: 6172 616d 2065 6c65 6d3a 746f 2071 7565  aram elem:to que
+0000fa60: 7279 0a20 2020 2020 2020 203a 7061 7261  ry.        :para
+0000fa70: 6d20 7870 6174 683a 2074 6f20 6669 6e64  m xpath: to find
+0000fa80: 2064 6573 6365 6e64 616e 7420 7375 6265   descendant sube
+0000fa90: 6c65 6d65 6e74 0a20 2020 2020 2020 203a  lement.        :
+0000faa0: 7061 7261 6d20 7265 6765 783a 2074 6f20  param regex: to 
+0000fab0: 6669 6e64 2073 7472 696e 6720 696e 2073  find string in s
+0000fac0: 7562 656c 656d 656e 7420 286d 7573 7420  ubelement (must 
+0000fad0: 6861 7665 2033 2063 6170 7475 7265 2067  have 3 capture g
+0000fae0: 726f 7570 7329 0a20 2020 2020 2020 203a  roups).        :
+0000faf0: 7061 7261 6d20 7265 6d6f 7665 3a20 7265  param remove: re
+0000fb00: 6d6f 7665 7320 626f 6479 2074 6578 7420  moves body text 
+0000fb10: 616e 6420 6a6f 696e 7320 7072 6520 746f  and joins pre to
+0000fb20: 2070 6f73 7420 2875 7365 2077 6974 6820   post (use with 
+0000fb30: 6361 7265 2c20 6465 6661 756c 7420 4661  care, default Fa
+0000fb40: 6c73 6529 0a20 2020 2020 2020 203a 7061  lse).        :pa
+0000fb50: 7261 6d20 696e 636c 7564 655f 6e6f 6e65  ram include_none
+0000fb60: 3a20 4966 2074 7275 6520 696e 636c 7564  : If true includ
+0000fb70: 6520 6661 696c 6564 206d 6174 6368 6573  e failed matches
+0000fb80: 2061 7320 4e6f 6e65 3b20 6465 6661 756c   as None; defaul
+0000fb90: 7420 4661 6c73 650a 2020 2020 2020 2020  t False.        
+0000fba0: 3a70 6172 616d 5f61 6464 5f69 643a 2061  :param_add_id: a
+0000fbb0: 6464 2065 7874 7261 6374 6564 2074 6578  dd extracted tex
+0000fbc0: 7420 6173 2061 7474 7269 6275 7465 206f  t as attribute o
+0000fbd0: 6e20 7375 6265 6c65 6d65 6e74 0a20 2020  n subelement.   
+0000fbe0: 2020 2020 2069 6620 7072 6520 616e 6420       if pre and 
+0000fbf0: 7461 696c 2061 7265 2070 7265 7365 6e74  tail are present
+0000fc00: 2c20 656c 656d 2e74 6578 7420 3d3c 2070  , elem.text =< p
+0000fc10: 7265 2b70 6f73 740a 2020 2020 2020 2020  re+post.        
+0000fc20: 6966 2070 7265 2069 7320 6d69 7373 696e  if pre is missin
+0000fc30: 6720 656c 656d 2e74 6578 7420 3d3e 2070  g elem.text => p
+0000fc40: 6f73 740a 2020 2020 2020 2020 6966 2074  ost.        if t
+0000fc50: 6169 6c20 6973 206d 6973 7369 6e67 2065  ail is missing e
+0000fc60: 6c65 6d2e 7465 7874 203d 3e20 7072 650a  lem.text => pre.
+0000fc70: 2020 2020 2020 2020 6966 2062 6f74 6820          if both 
+0000fc80: 6172 6520 6d69 7373 696e 6720 6e6f 2072  are missing no r
+0000fc90: 656d 6f76 616c 0a20 2020 2020 2020 203a  emoval.        :
+0000fca0: 7265 7475 726e 3a20 7265 6765 782e 6d61  return: regex.ma
+0000fcb0: 7463 682e 6772 6f75 7069 6e64 6578 283f  tch.groupindex(?
+0000fcc0: 503c 626f 6479 3e29 2069 6620 6d61 7463  P<body>) if matc
+0000fcd0: 6865 6420 656c 7365 204e 6f6e 650a 2020  hed else None.  
+0000fce0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000fcf0: 2020 7375 625f 656c 656d 7320 3d20 656c    sub_elems = el
+0000fd00: 656d 2e78 7061 7468 2878 7061 7468 290a  em.xpath(xpath).
+0000fd10: 2020 2020 2020 2020 7375 625f 656c 656d          sub_elem
+0000fd20: 203d 2073 7562 5f65 6c65 6d73 5b30 5d20   = sub_elems[0] 
+0000fd30: 6966 206c 656e 2873 7562 5f65 6c65 6d73  if len(sub_elems
+0000fd40: 2920 3e20 3020 656c 7365 204e 6f6e 650a  ) > 0 else None.
+0000fd50: 2020 2020 2020 2020 7375 6273 7472 696e          substrin
+0000fd60: 6773 203d 205b 5d0a 2020 2020 2020 2020  gs = [].        
+0000fd70: 7265 3020 3d20 7265 2e63 6f6d 7069 6c65  re0 = re.compile
+0000fd80: 2872 6567 6578 290a 2020 2020 2020 2020  (regex).        
+0000fd90: 666f 7220 7375 625f 656c 656d 2069 6e20  for sub_elem in 
+0000fda0: 7375 625f 656c 656d 733a 0a20 2020 2020  sub_elems:.     
+0000fdb0: 2020 2020 2020 2073 7562 7374 7269 6e67         substring
+0000fdc0: 203d 2063 6c73 2e65 7874 7261 6374 5f73   = cls.extract_s
+0000fdd0: 7562 7374 7269 6e67 2872 6530 2c20 7265  ubstring(re0, re
+0000fde0: 6d6f 7665 2c20 7375 625f 656c 656d 290a  move, sub_elem).
+0000fdf0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0000fe00: 7562 7374 7269 6e67 2061 6e64 2061 6464  ubstring and add
+0000fe10: 5f69 643a 0a20 2020 2020 2020 2020 2020  _id:.           
+0000fe20: 2020 2020 2073 7562 5f65 6c65 6d2e 6174       sub_elem.at
+0000fe30: 7472 6962 5b22 6964 225d 203d 2073 7562  trib["id"] = sub
+0000fe40: 7374 7269 6e67 0a20 2020 2020 2020 2020  string.         
+0000fe50: 2020 2069 6620 7375 6273 7472 696e 6720     if substring 
+0000fe60: 6f72 2069 6e63 6c75 6465 5f6e 6f6e 653a  or include_none:
+0000fe70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fe80: 2073 7562 7374 7269 6e67 732e 6170 7065   substrings.appe
+0000fe90: 6e64 2873 7562 7374 7269 6e67 290a 2020  nd(substring).  
+0000fea0: 2020 2020 2020 7265 7475 726e 2073 7562        return sub
+0000feb0: 7374 7269 6e67 730a 0a20 2020 2040 636c  strings..    @cl
+0000fec0: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+0000fed0: 6620 6578 7472 6163 745f 7375 6273 7472  f extract_substr
+0000fee0: 696e 6728 636c 732c 2072 6530 2c20 7265  ing(cls, re0, re
+0000fef0: 6d6f 7665 2c20 7375 625f 656c 656d 293a  move, sub_elem):
+0000ff00: 0a20 2020 2020 2020 206d 6174 6368 203d  .        match =
+0000ff10: 2072 6530 2e6d 6174 6368 2873 7562 5f65   re0.match(sub_e
+0000ff20: 6c65 6d2e 7465 7874 290a 2020 2020 2020  lem.text).      
+0000ff30: 2020 7375 6273 7472 696e 6720 3d20 4e6f    substring = No
+0000ff40: 6e65 0a20 2020 2020 2020 2069 6620 6d61  ne.        if ma
+0000ff50: 7463 683a 0a20 2020 2020 2020 2020 2020  tch:.           
+0000ff60: 2073 7562 7374 7269 6e67 203d 206d 6174   substring = mat
+0000ff70: 6368 2e67 726f 7570 2822 626f 6479 2229  ch.group("body")
+0000ff80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000ff90: 7265 6d6f 7665 3a0a 2020 2020 2020 2020  remove:.        
+0000ffa0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+0000ffb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ffc0: 2070 7265 203d 206d 6174 6368 2e67 726f   pre = match.gro
+0000ffd0: 7570 2822 7072 6522 290a 2020 2020 2020  up("pre").      
+0000ffe0: 2020 2020 2020 2020 2020 2020 2020 706f                po
+0000fff0: 7374 203d 206d 6174 6368 2e67 726f 7570  st = match.group
+00010000: 2822 706f 7374 2229 0a20 2020 2020 2020  ("post").       
+00010010: 2020 2020 2020 2020 2020 2020 2073 7562               sub
+00010020: 5f65 6c65 6d2e 7465 7874 203d 2070 7265  _elem.text = pre
+00010030: 202b 2070 6f73 740a 2020 2020 2020 2020   + post.        
+00010040: 2020 2020 2020 2020 6578 6365 7074 3a0a          except:.
+00010050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010060: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
+00010070: 2072 6574 7572 6e20 7375 6273 7472 696e   return substrin
+00010080: 670a 0a20 2020 2040 636c 6173 736d 6574  g..    @classmet
+00010090: 686f 640a 2020 2020 6465 6620 6765 745f  hod.    def get_
+000100a0: 666c 6f61 7428 636c 732c 2065 6c65 6d2c  float(cls, elem,
+000100b0: 2061 7474 7269 625f 6e61 6d65 293a 0a20   attrib_name):. 
+000100c0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+000100d0: 2020 2020 2020 2020 7661 6c20 3d20 656c          val = el
+000100e0: 656d 2e61 7474 7269 625b 6174 7472 6962  em.attrib[attrib
+000100f0: 5f6e 616d 655d 0a20 2020 2020 2020 2020  _name].         
+00010100: 2020 2072 6574 7572 6e20 666c 6f61 7428     return float(
+00010110: 7661 6c29 0a20 2020 2020 2020 2065 7863  val).        exc
+00010120: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
+00010130: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+00010140: 7265 7475 726e 204e 6f6e 650a 0a20 2020  return None..   
+00010150: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+00010160: 2020 6465 6620 6368 6563 6b5f 7461 6728    def check_tag(
+00010170: 636c 732c 2065 6c65 6d2c 2074 6167 293a  cls, elem, tag):
+00010180: 0a20 2020 2020 2020 2022 2222 6368 6563  .        """chec
+00010190: 6b73 2074 6861 7420 656c 656d 2069 7320  ks that elem is 
+000101a0: 616e 2045 6c65 6d65 6e74 2077 6974 6820  an Element with 
+000101b0: 6769 7665 6e20 7461 6722 2222 0a20 2020  given tag""".   
+000101c0: 2020 2020 2072 6574 7572 6e20 7479 7065       return type
+000101d0: 2865 6c65 6d29 2069 7320 4554 2e5f 456c  (elem) is ET._El
+000101e0: 656d 656e 7420 616e 6420 656c 656d 2e74  ement and elem.t
+000101f0: 6167 203d 3d20 7461 670a 0a20 2020 2040  ag == tag..    @
+00010200: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+00010210: 6465 6620 6765 745f 6964 2863 6c73 2c20  def get_id(cls, 
+00010220: 6469 7629 3a0a 2020 2020 2020 2020 2222  div):.        ""
+00010230: 2267 6574 7320 7661 6c75 6520 6f66 2022  "gets value of "
+00010240: 6964 2220 6174 7472 6962 7574 650a 2020  id" attribute.  
+00010250: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00010260: 2020 7265 7475 726e 204e 6f6e 6520 6966    return None if
+00010270: 2064 6976 2069 7320 4e6f 6e65 2065 6c73   div is None els
+00010280: 6520 6469 762e 6174 7472 6962 2e67 6574  e div.attrib.get
+00010290: 2822 6964 2229 0a0a 2020 2020 4063 6c61  ("id")..    @cla
+000102a0: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+000102b0: 2061 6e61 6c79 7a65 5f73 7479 6c65 7328   analyze_styles(
+000102c0: 636c 732c 2065 6c65 6d29 3a0a 2020 2020  cls, elem):.    
+000102d0: 2020 2020 6865 6164 5f73 7479 6c65 5f65      head_style_e
+000102e0: 6c65 6d73 203d 2048 746d 6c53 7479 6c65  lems = HtmlStyle
+000102f0: 2e67 6574 5f68 6561 645f 7374 796c 6573  .get_head_styles
+00010300: 2865 6c65 6d29 0a20 2020 2020 2020 2070  (elem).        p
+00010310: 7269 6e74 2866 2268 6561 6420 7374 796c  rint(f"head styl
+00010320: 6520 656c 656d 7320 7b6c 656e 2868 6561  e elems {len(hea
+00010330: 645f 7374 796c 655f 656c 656d 7329 7d22  d_style_elems)}"
+00010340: 290a 2020 2020 2020 2020 626f 6479 5f63  ).        body_c
+00010350: 6c61 7373 7265 6673 203d 2048 746d 6c53  lassrefs = HtmlS
+00010360: 7479 6c65 2e67 6574 5f62 6f64 795f 636c  tyle.get_body_cl
+00010370: 6173 7372 6566 7328 656c 656d 290a 2020  assrefs(elem).  
+00010380: 2020 2020 2020 7072 696e 7428 6622 626f        print(f"bo
+00010390: 6479 2063 6c61 7373 7265 6673 207b 6c65  dy classrefs {le
+000103a0: 6e28 626f 6479 5f63 6c61 7373 7265 6673  n(body_classrefs
+000103b0: 297d 2229 0a20 2020 2020 2020 2066 6f6e  )}").        fon
+000103c0: 745f 7369 7a65 5f64 6963 7420 3d20 6465  t_size_dict = de
+000103d0: 6661 756c 7464 6963 7428 6c69 7374 290a  faultdict(list).
+000103e0: 2020 2020 2020 2020 6661 6d69 6c79 5f64          family_d
+000103f0: 6963 7420 3d20 6465 6661 756c 7464 6963  ict = defaultdic
+00010400: 7428 6c69 7374 290a 2020 2020 2020 2020  t(list).        
+00010410: 666f 7220 6865 6164 5f73 7479 6c65 5f65  for head_style_e
+00010420: 6c65 6d20 696e 2068 6561 645f 7374 796c  lem in head_styl
+00010430: 655f 656c 656d 733a 0a20 2020 2020 2020  e_elems:.       
+00010440: 2020 2020 2068 6561 645f 7374 796c 652c       head_style,
+00010450: 2063 7373 7374 7220 3d20 4874 6d6c 5374   cssstr = HtmlSt
+00010460: 796c 652e 6578 7472 6163 745f 636c 6173  yle.extract_clas
+00010470: 7372 6566 5f61 6e64 5f63 7373 7374 7269  sref_and_cssstri
+00010480: 6e67 5f66 726f 6d5f 6874 6d6c 5f73 7479  ng_from_html_sty
+00010490: 6c65 2868 6561 645f 7374 796c 655f 656c  le(head_style_el
+000104a0: 656d 290a 2020 2020 2020 2020 2020 2020  em).            
+000104b0: 6373 735f 7374 796c 6520 3d20 4353 5353  css_style = CSSS
+000104c0: 7479 6c65 2e63 7265 6174 655f 6373 735f  tyle.create_css_
+000104d0: 7374 796c 655f 6672 6f6d 5f63 7373 5f73  style_from_css_s
+000104e0: 7472 696e 6728 6373 7373 7472 290a 2020  tring(cssstr).  
+000104f0: 2020 2020 2020 2020 2020 666f 6e74 5f73            font_s
+00010500: 697a 6520 3d20 6373 735f 7374 796c 652e  ize = css_style.
+00010510: 666f 6e74 5f73 697a 650a 2020 2020 2020  font_size.      
+00010520: 2020 2020 2020 666f 6e74 5f73 697a 655f        font_size_
+00010530: 6469 6374 5b73 7472 2866 6f6e 745f 7369  dict[str(font_si
+00010540: 7a65 295d 2e61 7070 656e 6428 6373 7373  ze)].append(csss
+00010550: 7472 290a 2020 2020 2020 2020 2020 2020  tr).            
+00010560: 666f 6e74 5f66 616d 696c 7920 3d20 6373  font_family = cs
+00010570: 735f 7374 796c 652e 666f 6e74 5f66 616d  s_style.font_fam
+00010580: 696c 790a 2020 2020 2020 2020 2020 2020  ily.            
+00010590: 6661 6d69 6c79 5f64 6963 745b 666f 6e74  family_dict[font
+000105a0: 5f66 616d 696c 795d 2e61 7070 656e 6428  _family].append(
+000105b0: 6373 7373 7472 290a 0a20 2020 2020 2020  cssstr)..       
+000105c0: 2020 2020 2062 6f64 795f 656c 656d 7320       body_elems 
+000105d0: 3d20 636c 732e 6765 745f 626f 6479 5f65  = cls.get_body_e
+000105e0: 6c65 6d65 6e74 735f 6279 5f63 6c61 7373  lements_by_class
+000105f0: 2865 6c65 6d2c 2068 6561 645f 7374 796c  (elem, head_styl
+00010600: 6529 0a20 2020 2020 2020 2020 2020 2062  e).            b
+00010610: 6f64 795f 656c 656d 735f 7374 7220 3d20  ody_elems_str = 
+00010620: 275c 6e20 2020 2020 272e 6a6f 696e 285b  '\n     '.join([
+00010630: 656c 656d 2e74 6578 7420 666f 7220 656c  elem.text for el
+00010640: 656d 2069 6e20 626f 6479 5f65 6c65 6d73  em in body_elems
+00010650: 5b3a 335d 5d29 0a20 2020 2020 2020 2020  [:3]]).         
+00010660: 2020 2070 7269 6e74 2866 227b 6865 6164     print(f"{head
+00010670: 5f73 7479 6c65 7d3a 207b 6c65 6e28 626f  _style}: {len(bo
+00010680: 6479 5f65 6c65 6d73 297d 207b 6373 7373  dy_elems)} {csss
+00010690: 7472 7d5c 6e20 2020 2020 7b62 6f64 795f  tr}\n     {body_
+000106a0: 656c 656d 735f 7374 727d 2229 0a20 2020  elems_str}").   
+000106b0: 2020 2020 2070 7072 696e 7428 6622 7369       pprint(f"si
+000106c0: 7a65 207b 666f 6e74 5f73 697a 655f 6469  ze {font_size_di
+000106d0: 6374 7d22 290a 2020 2020 2020 2020 7072  ct}").        pr
+000106e0: 696e 7428 290a 2020 2020 2020 2020 666f  int().        fo
+000106f0: 7220 7369 7a65 2069 6e20 666f 6e74 5f73  r size in font_s
+00010700: 697a 655f 6469 6374 3a0a 2020 2020 2020  ize_dict:.      
+00010710: 2020 2020 2020 666f 6e74 7320 3d20 666f        fonts = fo
+00010720: 6e74 5f73 697a 655f 6469 6374 5b73 697a  nt_size_dict[siz
+00010730: 655d 0a20 2020 2020 2020 2020 2020 2069  e].            i
+00010740: 6620 7479 7065 2866 6f6e 7473 2920 6973  f type(fonts) is
+00010750: 206c 6973 743a 0a20 2020 2020 2020 2020   list:.         
+00010760: 2020 2020 2020 2070 7269 6e74 2866 2273         print(f"s
+00010770: 697a 6520 7b6c 656e 2866 6f6e 7473 297d  ize {len(fonts)}
+00010780: 2022 290a 2020 2020 2020 2020 2020 2020   ").            
+00010790: 2020 2020 666f 6e74 737a 203d 2027 5c6e      fontsz = '\n
+000107a0: 272e 6a6f 696e 2866 6f6e 7473 290a 2020  '.join(fonts).  
+000107b0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+000107c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000107d0: 666f 6e74 737a 203d 2066 6f6e 7473 0a20  fontsz = fonts. 
+000107e0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+000107f0: 2866 2220 207b 7369 7a65 7d20 3d3e 2020  (f"  {size} =>  
+00010800: 7b66 6f6e 7473 7a7d 2229 0a20 2020 2020  {fontsz}").     
+00010810: 2020 2070 7269 6e74 2829 0a20 2020 2020     print().     
+00010820: 2020 2070 7072 696e 7428 6622 6661 6d69     pprint(f"fami
+00010830: 6c79 207b 6661 6d69 6c79 5f64 6963 747d  ly {family_dict}
+00010840: 2229 0a0a 2020 2020 4063 6c61 7373 6d65  ")..    @classme
+00010850: 7468 6f64 0a20 2020 2064 6566 2061 6e61  thod.    def ana
+00010860: 6c79 7a65 5f63 6f6f 7264 696e 6174 6573  lyze_coordinates
+00010870: 2863 6c73 2c20 656c 656d 293a 0a20 2020  (cls, elem):.   
+00010880: 2020 2020 2023 2068 6561 645f 7374 796c       # head_styl
+00010890: 655f 656c 656d 7320 3d20 4874 6d6c 5374  e_elems = HtmlSt
+000108a0: 796c 652e 6765 745f 6865 6164 5f73 7479  yle.get_head_sty
+000108b0: 6c65 7328 656c 656d 290a 2020 2020 2020  les(elem).      
+000108c0: 2020 2320 7072 696e 7428 6622 6865 6164    # print(f"head
+000108d0: 2073 7479 6c65 2065 6c65 6d73 207b 6c65   style elems {le
+000108e0: 6e28 6865 6164 5f73 7479 6c65 5f65 6c65  n(head_style_ele
+000108f0: 6d73 297d 2229 0a20 2020 2020 2020 2023  ms)}").        #
+00010900: 2062 6f64 795f 7374 796c 6573 203d 2048   body_styles = H
+00010910: 746d 6c53 7479 6c65 2e67 6574 5f62 6f64  tmlStyle.get_bod
+00010920: 795f 636c 6173 7372 6566 7328 656c 656d  y_classrefs(elem
+00010930: 290a 2020 2020 2020 2020 2320 7072 696e  ).        # prin
+00010940: 7428 6622 626f 6479 2073 7479 6c65 7320  t(f"body styles 
+00010950: 7b6c 656e 2862 6f64 795f 7374 796c 6573  {len(body_styles
+00010960: 297d 2229 0a20 2020 2020 2020 206d 6178  )}").        max
+00010970: 6368 6172 203d 2035 300a 0a20 2020 2020  char = 50..     
+00010980: 2020 2063 6c73 2e67 6574 5f6c 7274 6228     cls.get_lrtb(
+00010990: 656c 656d 2c20 226c 6566 7422 290a 2020  elem, "left").  
+000109a0: 2020 2020 2020 636c 732e 6765 745f 6c72        cls.get_lr
+000109b0: 7462 2865 6c65 6d2c 2022 7269 6768 7422  tb(elem, "right"
+000109c0: 290a 2020 2020 2020 2020 636c 732e 6765  ).        cls.ge
+000109d0: 745f 6c72 7462 2865 6c65 6d2c 2022 7930  t_lrtb(elem, "y0
+000109e0: 222c 2063 6f6c 3d30 290a 2020 2020 2020  ", col=0).      
+000109f0: 2020 636c 732e 6765 745f 6c72 7462 2865    cls.get_lrtb(e
+00010a00: 6c65 6d2c 2022 746f 7022 2c20 6d61 7267  lem, "top", marg
+00010a10: 696e 3d38 3029 0a0a 2020 2020 4063 6c61  in=80)..    @cla
+00010a20: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+00010a30: 2067 6574 5f6c 7274 6228 636c 732c 2065   get_lrtb(cls, e
+00010a40: 6c65 6d2c 2064 6972 6563 7469 6f6e 2c20  lem, direction, 
+00010a50: 6d61 7863 6861 723d 3530 2c20 6d69 6e5f  maxchar=50, min_
+00010a60: 636f 756e 743d 3130 2c20 6d61 785f 7465  count=10, max_te
+00010a70: 7874 733d 332c 206d 6172 6769 6e3d 3830  xts=3, margin=80
+00010a80: 2c20 6d65 6469 6162 6f78 3d5b 5b30 2c31  , mediabox=[[0,1
+00010a90: 3030 305d 2c20 5b30 2c31 3030 305d 5d2c  000], [0,1000]],
+00010aa0: 2063 6f6c 3d31 2029 3a0a 2020 2020 2020   col=1 ):.      
+00010ab0: 2020 656c 656d 7320 3d20 4874 6d6c 4c69    elems = HtmlLi
+00010ac0: 622e 6765 745f 626f 6479 2865 6c65 6d29  b.get_body(elem)
+00010ad0: 2e78 7061 7468 2866 222e 2f2f 2a5b 407b  .xpath(f".//*[@{
+00010ae0: 6469 7265 6374 696f 6e7d 5d22 290a 2020  direction}]").  
+00010af0: 2020 2020 2020 6469 6374 7820 3d20 6465        dictx = de
+00010b00: 6661 756c 7464 6963 7428 6c69 7374 290a  faultdict(list).
+00010b10: 2020 2020 2020 2020 666f 7220 656c 656d          for elem
+00010b20: 2069 6e20 656c 656d 733a 0a20 2020 2020   in elems:.     
+00010b30: 2020 2020 2020 206c 6566 7420 3d20 4874         left = Ht
+00010b40: 6d6c 5574 696c 2e67 6574 5f66 6c6f 6174  mlUtil.get_float
+00010b50: 2865 6c65 6d2c 2064 6972 6563 7469 6f6e  (elem, direction
+00010b60: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00010b70: 206c 6566 743a 0a20 2020 2020 2020 2020   left:.         
+00010b80: 2020 2020 2020 2064 6963 7478 5b6c 6566         dictx[lef
+00010b90: 745d 2e61 7070 656e 6428 656c 656d 290a  t].append(elem).
+00010ba0: 2020 2020 2020 2020 7072 696e 7428 6622          print(f"
+00010bb0: 5c6e 7b64 6972 6563 7469 6f6e 7d22 290a  \n{direction}").
+00010bc0: 2020 2020 2020 2020 726f 7773 203d 205b          rows = [
+00010bd0: 5d0a 2020 2020 2020 2020 666f 7220 6b65  ].        for ke
+00010be0: 7920 696e 2064 6963 7478 2e6b 6579 7328  y in dictx.keys(
+00010bf0: 293a 0a20 2020 2020 2020 2020 2020 2065  ):.            e
+00010c00: 6c65 6d73 203d 2064 6963 7478 5b6b 6579  lems = dictx[key
+00010c10: 5d0a 2020 2020 2020 2020 2020 2020 7465  ].            te
+00010c20: 7874 7320 3d20 5b65 6c65 6d2e 7870 6174  xts = [elem.xpat
+00010c30: 6828 222e 2f2f 7465 7874 2829 2229 5b30  h(".//text()")[0
+00010c40: 5d5b 3a6d 6178 6368 6172 5d20 666f 7220  ][:maxchar] for 
+00010c50: 656c 656d 2069 6e20 656c 656d 735d 0a20  elem in elems]. 
+00010c60: 2020 2020 2020 2020 2020 2065 6c65 6d63             elemc
+00010c70: 6f75 6e74 203d 206c 656e 2865 6c65 6d73  ount = len(elems
+00010c80: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00010c90: 2065 6c65 6d63 6f75 6e74 203e 206d 696e   elemcount > min
+00010ca0: 5f63 6f75 6e74 3a0a 2020 2020 2020 2020  _count:.        
+00010cb0: 2020 2020 2020 2020 7465 7874 735f 203d          texts_ =
+00010cc0: 2074 6578 7473 5b3a 6d61 785f 7465 7874   texts[:max_text
+00010cd0: 735d 0a20 2020 2020 2020 2020 2020 2020  s].             
+00010ce0: 2020 2070 7269 6e74 2866 227b 6b65 797d     print(f"{key}
+00010cf0: 3a20 7b65 6c65 6d63 6f75 6e74 7d20 7b74  : {elemcount} {t
+00010d00: 6578 7473 5f7d 2229 0a20 2020 2020 2020  exts_}").       
+00010d10: 2020 2020 2020 2020 2072 6f77 732e 6170           rows.ap
+00010d20: 7065 6e64 285b 6b65 792c 2065 6c65 6d63  pend([key, elemc
+00010d30: 6f75 6e74 2c20 7465 7874 735f 5d29 0a20  ount, texts_]). 
+00010d40: 2020 2020 2020 2072 6f77 735f 203d 2073         rows_ = s
+00010d50: 6f72 7465 6428 726f 7773 2c20 6b65 793d  orted(rows, key=
+00010d60: 6c61 6d62 6461 2063 3a20 635b 636f 6c5d  lambda c: c[col]
+00010d70: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
+00010d80: 6622 726f 7773 5c6e 7b72 6f77 735f 7d22  f"rows\n{rows_}"
+00010d90: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+00010da0: 2020 2023 2073 6f72 7465 6428 7374 7564     # sorted(stud
+00010db0: 656e 745f 7475 706c 6573 2c20 6b65 793d  ent_tuples, key=
+00010dc0: 6c61 6d62 6461 2073 7475 6465 6e74 3a20  lambda student: 
+00010dd0: 7374 7564 656e 745b 325d 290a 0a20 2020  student[2])..   
+00010de0: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+00010df0: 2020 6465 6620 6765 745f 626f 6479 5f65    def get_body_e
+00010e00: 6c65 6d65 6e74 735f 6279 5f63 6c61 7373  lements_by_class
+00010e10: 2863 6c73 2c20 656c 656d 2c20 6865 6164  (cls, elem, head
+00010e20: 5f73 7479 6c65 293a 0a20 2020 2020 2020  _style):.       
+00010e30: 2069 6620 6865 6164 5f73 7479 6c65 2e73   if head_style.s
+00010e40: 7461 7274 7377 6974 6828 272e 2729 3a0a  tartswith('.'):.
+00010e50: 2020 2020 2020 2020 2020 2020 6865 6164              head
+00010e60: 5f73 7479 6c65 203d 2068 6561 645f 7374  _style = head_st
+00010e70: 796c 655b 313a 5d0a 2020 2020 2020 2020  yle[1:].        
+00010e80: 626f 6479 5f65 6c65 6d73 203d 2065 6c65  body_elems = ele
+00010e90: 6d2e 7870 6174 6828 6622 2e2f 626f 6479  m.xpath(f"./body
+00010ea0: 2f2f 2a5b 4063 6c61 7373 3d27 7b68 6561  //*[@class='{hea
+00010eb0: 645f 7374 796c 657d 275d 2229 0a20 2020  d_style}']").   
+00010ec0: 2020 2020 2072 6574 7572 6e20 626f 6479       return body
+00010ed0: 5f65 6c65 6d73 0a0a 2020 2020 4063 6c61  _elems..    @cla
+00010ee0: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+00010ef0: 2063 6c65 616e 5f77 7269 7465 5f68 746d   clean_write_htm
+00010f00: 6c28 636c 732c 2069 6e5f 6874 6d6c 2c20  l(cls, in_html, 
+00010f10: 6f75 745f 6874 6d6c 2c20 7072 6574 7479  out_html, pretty
+00010f20: 5f70 7269 6e74 3d54 7275 6529 3a0a 2020  _print=True):.  
+00010f30: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00010f40: 2020 5061 7273 6520 7261 7720 4854 4d4c    Parse raw HTML
+00010f50: 2028 6e6f 7420 616c 7761 7973 2077 656c   (not always wel
+00010f60: 6c2d 666f 726d 6564 2920 2c20 6d61 6b65  l-formed) , make
+00010f70: 2077 656c 6c66 6f72 6d65 6420 616e 6420   wellformed and 
+00010f80: 6f70 7469 6f6e 616c 6c79 2070 7265 7474  optionally prett
+00010f90: 7920 7072 696e 740a 2020 2020 2020 2020  y print.        
+00010fa0: 3a70 6172 616d 2069 6e5f 6874 6d6c 3a20  :param in_html: 
+00010fb0: 696e 7075 7420 6874 6d6c 2066 696c 650a  input html file.
+00010fc0: 2020 2020 2020 2020 3a70 6172 616d 206f          :param o
+00010fd0: 7574 5f68 746d 6c3a 206f 7574 7075 7420  ut_html: output 
+00010fe0: 6669 6c65 0a20 2020 2020 2020 203a 7061  file.        :pa
+00010ff0: 7261 6d20 7072 6574 7479 5f70 7269 6e74  ram pretty_print
+00011000: 3a20 6f75 7470 7574 2066 6f72 6d61 740a  : output format.
+00011010: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
+00011020: 2070 6172 7365 6420 6874 6d6c 2065 6c65   parsed html ele
+00011030: 6d65 6e74 0a20 2020 2020 2020 2022 2222  ment.        """
+00011040: 0a20 2020 2020 2020 2068 746d 6c5f 656c  .        html_el
+00011050: 656d 203d 2063 6c73 2e70 6172 7365 5f68  em = cls.parse_h
+00011060: 746d 6c5f 6669 6c65 5f74 6f5f 786d 6c28  tml_file_to_xml(
+00011070: 696e 5f68 746d 6c29 0a20 2020 2020 2020  in_html).       
+00011080: 2063 6c73 2e77 7269 7465 5f68 746d 6c5f   cls.write_html_
+00011090: 656c 656d 2868 746d 6c5f 656c 656d 2c20  elem(html_elem, 
+000110a0: 6f75 745f 6874 6d6c 2c20 7072 6574 7479  out_html, pretty
+000110b0: 5f70 7269 6e74 3d70 7265 7474 795f 7072  _print=pretty_pr
+000110c0: 696e 7429 0a20 2020 2020 2020 2072 6574  int).        ret
+000110d0: 7572 6e20 6874 6d6c 5f65 6c65 6d0a 0a20  urn html_elem.. 
+000110e0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+000110f0: 2020 2020 6465 6620 7061 7273 655f 6874      def parse_ht
+00011100: 6d6c 5f66 696c 655f 746f 5f78 6d6c 2863  ml_file_to_xml(c
+00011110: 6c73 2c20 696e 5f68 746d 6c29 3a0a 2020  ls, in_html):.  
+00011120: 2020 2020 2020 2222 2272 6561 6420 756e        """read un
+00011130: 7469 6479 2048 544d 4c20 696e 746f 2058  tidy HTML into X
+00011140: 4d4c 0a20 2020 2020 2020 2075 7365 7320  ML.        uses 
+00011150: 4854 4d4c 5061 7273 6572 0a20 2020 2020  HTMLParser.     
+00011160: 2020 203a 7061 7261 6d20 696e 5f68 746d     :param in_htm
+00011170: 6c3a 2048 544d 4c20 6669 6c65 0a20 2020  l: HTML file.   
+00011180: 2020 2020 203a 7265 7475 726e 3a20 7765       :return: we
+00011190: 6c6c 5f66 6f72 6d65 6420 5848 544d 4c0a  ll_formed XHTML.
+000111a0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000111b0: 2020 2020 6874 6d6c 5f65 6c65 6d20 3d20      html_elem = 
+000111c0: 4554 2e70 6172 7365 2873 7472 2869 6e5f  ET.parse(str(in_
+000111d0: 6874 6d6c 292c 2045 542e 4854 4d4c 5061  html), ET.HTMLPa
+000111e0: 7273 6572 2829 292e 7870 6174 6828 222f  rser()).xpath("/
+000111f0: 2a22 295b 305d 0a20 2020 2020 2020 2072  *")[0].        r
+00011200: 6574 7572 6e20 6874 6d6c 5f65 6c65 6d0a  eturn html_elem.
+00011210: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+00011220: 640a 2020 2020 6465 6620 7772 6974 655f  d.    def write_
+00011230: 6874 6d6c 5f65 6c65 6d28 636c 732c 2065  html_elem(cls, e
+00011240: 6c65 6d2c 206f 7574 5f68 746d 6c2c 2070  lem, out_html, p
+00011250: 7265 7474 795f 7072 696e 743d 4661 6c73  retty_print=Fals
+00011260: 6529 3a0a 2020 2020 2020 2020 2222 2277  e):.        """w
+00011270: 7269 7465 2048 544d 4c20 7769 7468 206f  rite HTML with o
+00011280: 7074 696f 6e61 6c20 7072 6574 7479 5f70  ptional pretty_p
+00011290: 7269 6e74 0a20 2020 2020 2020 203a 7061  rint.        :pa
+000112a0: 7261 6d20 656c 656d 3a20 4854 4d4c 2065  ram elem: HTML e
+000112b0: 6c65 6d65 6e74 0a20 2020 2020 2020 203a  lement.        :
+000112c0: 7061 7261 6d20 6f75 745f 6874 6d6c 3a20  param out_html: 
+000112d0: 6569 7468 6572 2061 2066 696c 6520 6f72  either a file or
+000112e0: 2073 7973 2e73 7464 6f75 740a 2020 2020   sys.stdout.    
+000112f0: 2020 2020 3a70 6172 616d 2070 7265 7474      :param prett
+00011300: 795f 7072 696e 743a 0a20 2020 2020 2020  y_print:.       
+00011310: 2022 7265 7475 726e 3a20 4e6f 6e65 0a20   "return: None. 
+00011320: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00011330: 2020 2069 6620 6f75 745f 6874 6d6c 203d     if out_html =
+00011340: 3d20 7379 732e 7374 646f 7574 3a0a 2020  = sys.stdout:.  
+00011350: 2020 2020 2020 2020 2020 7072 696e 7420            print 
+00011360: 2845 542e 746f 7374 7269 6e67 2865 6c65  (ET.tostring(ele
+00011370: 6d2c 2070 7265 7474 795f 7072 696e 743d  m, pretty_print=
+00011380: 5472 7565 2c20 656e 636f 6469 6e67 3d22  True, encoding="
+00011390: 756e 6963 6f64 6522 2929 0a20 2020 2020  unicode")).     
+000113a0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000113b0: 2020 2020 2073 7320 3d20 4554 2e74 6f73       ss = ET.tos
+000113c0: 7472 696e 6728 656c 656d 2c20 7072 6574  tring(elem, pret
+000113d0: 7479 5f70 7269 6e74 3d70 7265 7474 795f  ty_print=pretty_
+000113e0: 7072 696e 7429 0a20 2020 2020 2020 2020  print).         
+000113f0: 2020 2050 6174 6828 6f75 745f 6874 6d6c     Path(out_html
+00011400: 292e 7061 7265 6e74 2e6d 6b64 6972 2870  ).parent.mkdir(p
+00011410: 6172 656e 7473 3d54 7275 652c 2065 7869  arents=True, exi
+00011420: 7374 5f6f 6b3d 5472 7565 290a 2020 2020  st_ok=True).    
+00011430: 2020 2020 2020 2020 7769 7468 206f 7065          with ope
+00011440: 6e28 6f75 745f 6874 6d6c 2c20 2277 6222  n(out_html, "wb"
+00011450: 2920 6173 2066 3a0a 2020 2020 2020 2020  ) as f:.        
+00011460: 2020 2020 2020 2020 662e 7772 6974 6528          f.write(
+00011470: 7373 290a 0a20 2020 2040 636c 6173 736d  ss)..    @classm
+00011480: 6574 686f 640a 2020 2020 6465 6620 7265  ethod.    def re
+00011490: 6d6f 7665 5f73 7479 6c65 5f61 7474 7269  move_style_attri
+000114a0: 6275 7465 7328 636c 732c 2068 746d 6c5f  butes(cls, html_
+000114b0: 656c 656d 293a 0a20 2020 2020 2020 2022  elem):.        "
+000114c0: 2222 7265 6d6f 7665 2040 7374 796c 6520  ""remove @style 
+000114d0: 6174 7472 6962 7574 6573 2066 726f 6d20  attributes from 
+000114e0: 656c 656d 656e 7473 2069 6e20 6874 6d6c  elements in html
+000114f0: 5f65 6c65 6d0a 2020 2020 2020 2020 3a70  _elem.        :p
+00011500: 6172 616d 2068 746d 6c5f 656c 656d 3a20  aram html_elem: 
+00011510: 656c 656d 656e 7420 746f 2073 7472 6970  element to strip
+00011520: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00011530: 2020 2020 2069 6620 6874 6d6c 5f65 6c65       if html_ele
+00011540: 6d20 6973 204e 6f6e 653a 0a20 2020 2020  m is None:.     
+00011550: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
+00011560: 2020 2020 2020 7374 796c 655f 656c 656d        style_elem
+00011570: 7320 3d20 6874 6d6c 5f65 6c65 6d2e 7870  s = html_elem.xp
+00011580: 6174 6828 222e 2f2f 2a5b 4073 7479 6c65  ath(".//*[@style
+00011590: 5d22 290a 2020 2020 2020 2020 666f 7220  ]").        for 
+000115a0: 7374 796c 655f 656c 656d 2069 6e20 7374  style_elem in st
+000115b0: 796c 655f 656c 656d 733a 0a20 2020 2020  yle_elems:.     
+000115c0: 2020 2020 2020 2048 746d 6c55 7469 6c2e         HtmlUtil.
+000115d0: 7265 6d6f 7665 5f61 7474 7269 6275 7465  remove_attribute
+000115e0: 2873 7479 6c65 5f65 6c65 6d2c 2022 7374  (style_elem, "st
+000115f0: 796c 6522 290a 0a20 2020 2040 636c 6173  yle")..    @clas
+00011600: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+00011610: 7265 6d6f 7665 5f65 6c65 6d73 2863 6c73  remove_elems(cls
+00011620: 2c20 6874 6d6c 5f65 6c65 6d2c 2078 7061  , html_elem, xpa
+00011630: 7468 3d4e 6f6e 6529 3a0a 2020 2020 2020  th=None):.      
+00011640: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
+00011650: 6d6f 7665 2065 6c65 6d65 6e74 7320 6279  move elements by
+00011660: 2078 7061 7468 0a20 2020 2020 2020 203a   xpath.        :
+00011670: 7061 7261 6d20 6874 6d6c 5f65 6c65 6d3a  param html_elem:
+00011680: 2065 6c65 6d65 6e74 2074 6f20 7265 6d6f   element to remo
+00011690: 7665 2065 6c65 6d65 6e74 2066 726f 6d0a  ve element from.
+000116a0: 2020 2020 2020 2020 3a70 6172 616d 2078          :param x
+000116b0: 7061 7468 3a0a 2020 2020 2020 2020 2222  path:.        ""
+000116c0: 220a 2020 2020 2020 2020 6966 2068 746d  ".        if htm
+000116d0: 6c5f 656c 656d 2069 7320 4e6f 6e65 206f  l_elem is None o
+000116e0: 7220 7870 6174 6820 6973 204e 6f6e 653a  r xpath is None:
+000116f0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00011700: 7572 6e0a 2020 2020 2020 2020 656c 656d  urn.        elem
+00011710: 7320 3d20 6874 6d6c 5f65 6c65 6d2e 7870  s = html_elem.xp
+00011720: 6174 6828 7870 6174 6829 0a20 2020 2020  ath(xpath).     
+00011730: 2020 2066 6f72 2065 6c65 6d20 696e 2065     for elem in e
+00011740: 6c65 6d73 3a0a 2020 2020 2020 2020 2020  lems:.          
+00011750: 2020 4874 6d6c 5574 696c 2e72 656d 6f76    HtmlUtil.remov
+00011760: 655f 656c 656d 5f6b 6565 705f 7461 696c  e_elem_keep_tail
+00011770: 2865 6c65 6d29 0a0a 2020 2020 4063 6c61  (elem)..    @cla
+00011780: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+00011790: 2072 656d 6f76 655f 656c 656d 656e 745f   remove_element_
+000117a0: 696e 5f68 6965 7261 7263 6879 2863 6c73  in_hierarchy(cls
+000117b0: 2c20 656c 656d 293a 0a20 2020 2020 2020  , elem):.       
+000117c0: 2022 2222 7265 6d6f 7665 7320 6469 7673   """removes divs
+000117d0: 2066 726f 6d20 6e65 7374 696e 670a 2020   from nesting.  
+000117e0: 2020 2020 2020 4578 616d 706c 653a 0a20        Example:. 
+000117f0: 2020 2020 2020 2020 2020 203c 6469 7620             <div 
+00011800: 6964 3d22 6431 223e 0a20 2020 2020 2020  id="d1">.       
+00011810: 2020 2020 2020 203c 6469 7620 6964 3d22         <div id="
+00011820: 6432 223e 0a20 2020 2020 2020 2020 2020  d2">.           
+00011830: 2020 2020 203c 7370 616e 2069 643d 2273       <span id="s
+00011840: 3122 3e62 6c61 683c 2f73 7061 6e3e 0a20  1">blah</span>. 
+00011850: 2020 2020 2020 2020 2020 2020 203c 2f64               </d
+00011860: 6976 3e0a 2020 2020 2020 2020 2020 2020  iv>.            
+00011870: 3c2f 6469 763e 0a20 2020 2020 2020 2020  </div>.         
+00011880: 2020 2061 3220 6973 2070 6c61 7969 6e67     a2 is playing
+00011890: 206e 6f20 726f 6c65 2069 6e20 6772 6f75   no role in grou
+000118a0: 7069 6e67 2c20 736f 2063 616e 2062 6520  ping, so can be 
+000118b0: 7265 6d6f 7665 6420 746f 2067 6976 653a  removed to give:
+000118c0: 0a20 2020 2020 2020 2020 2020 203c 6469  .            <di
+000118d0: 7620 6964 3d22 6431 223e 0a20 2020 2020  v id="d1">.     
+000118e0: 2020 2020 2020 2020 203c 7370 616e 2069           <span i
+000118f0: 643d 2273 3122 3e62 6c61 683c 2f73 7061  d="s1">blah</spa
+00011900: 6e3e 0a20 2020 2020 2020 2020 2020 203c  n>.            <
+00011910: 2f64 6976 3e0a 2020 2020 2020 2020 2020  /div>.          
+00011920: 2020 5468 6973 2063 616e 2062 6520 7265    This can be re
+00011930: 6375 7273 6976 6520 6275 7420 7370 616e  cursive but span
+00011940: 7320 7368 6f75 6c64 2061 6c77 6179 7320  s should always 
+00011950: 6861 7665 2064 6976 2070 6172 656e 7473  have div parents
+00011960: 0a20 2020 2020 2020 2020 2020 203a 7061  .            :pa
+00011970: 7261 6d20 656c 656d 3a20 656c 656d 2074  ram elem: elem t
+00011980: 6f20 7265 6d6f 7665 2e20 4974 7320 6368  o remove. Its ch
+00011990: 696c 6472 656e 2061 7265 2074 7261 6e73  ildren are trans
+000119a0: 6665 7265 6420 746f 2070 6172 656e 740a  fered to parent.
+000119b0: 2020 2020 2020 2020 2020 2020 652e 672e              e.g.
+000119c0: 0a20 2020 2020 2020 2020 2020 2070 2861  .            p(a
+000119d0: 2c65 6c65 6d28 6c2c 6d2c 6e29 2c7a 2920  ,elem(l,m,n),z) 
+000119e0: 3d3e 2070 2861 2c6c 2c6d 2c6e 2c7a 290a  => p(a,l,m,n,z).
+000119f0: 2020 2020 2020 2020 2020 2020 3a72 6574              :ret
+00011a00: 7572 6e3a 4e6f 6e65 0a20 2020 2020 2020  urn:None.       
+00011a10: 2022 2222 0a20 2020 2020 2020 2070 6172   """.        par
+00011a20: 656e 7420 3d20 656c 656d 2e67 6574 7061  ent = elem.getpa
+00011a30: 7265 6e74 2829 0a20 2020 2020 2020 2069  rent().        i
+00011a40: 6620 7061 7265 6e74 2069 7320 4e6f 6e65  f parent is None
+00011a50: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+00011a60: 696e 7428 6622 656c 656d 2068 6173 206e  int(f"elem has n
+00011a70: 6f20 7061 7265 6e74 2229 0a20 2020 2020  o parent").     
+00011a80: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
+00011a90: 2020 2020 2020 6964 7820 3d20 7061 7265        idx = pare
+00011aa0: 6e74 2e69 6e64 6578 2865 6c65 6d29 0a20  nt.index(elem). 
+00011ab0: 2020 2020 2020 2063 6869 6c64 5f65 6c65         child_ele
+00011ac0: 6d73 203d 2065 6c65 6d2e 7870 6174 6828  ms = elem.xpath(
+00011ad0: 222a 2229 0a20 2020 2020 2020 2066 6f72  "*").        for
+00011ae0: 2063 6869 6c64 5f65 6c65 6d20 696e 2063   child_elem in c
+00011af0: 6869 6c64 5f65 6c65 6d73 3a0a 2020 2020  hild_elems:.    
+00011b00: 2020 2020 2020 2020 7061 7265 6e74 2e69          parent.i
+00011b10: 6e73 6572 7428 6964 782c 2063 6869 6c64  nsert(idx, child
+00011b20: 5f65 6c65 6d29 0a20 2020 2020 2020 2070  _elem).        p
+00011b30: 6172 656e 742e 7265 6d6f 7665 2865 6c65  arent.remove(ele
+00011b40: 6d29 0a0a 2020 2020 4063 6c61 7373 6d65  m)..    @classme
+00011b50: 7468 6f64 0a20 2020 2064 6566 2072 656d  thod.    def rem
+00011b60: 6f76 655f 656c 656d 656e 7473 5f69 6e5f  ove_elements_in_
+00011b70: 6869 6572 6172 6368 795f 6279 5f78 7061  hierarchy_by_xpa
+00011b80: 7468 2863 6c73 2c20 6874 6d6c 2c20 7870  th(cls, html, xp
+00011b90: 6174 6829 3a0a 2020 2020 2020 2020 2222  ath):.        ""
+00011ba0: 2266 696e 6473 2065 6c65 6d65 6e74 7320  "finds elements 
+00011bb0: 6279 2078 7061 7468 2061 6e64 2064 656c  by xpath and del
+00011bc0: 6574 6573 2074 6865 6d20 7573 696e 6720  etes them using 
+00011bd0: 7265 6d6f 7665 5f65 6c65 6d65 6e74 735f  remove_elements_
+00011be0: 696e 5f68 6965 7261 7263 6879 2829 0a20  in_hierarchy(). 
+00011bf0: 2020 2020 2020 203a 7061 7261 6d20 6874         :param ht
+00011c00: 6d6c 3a20 656c 656d 656e 7473 2074 6f20  ml: elements to 
+00011c10: 6465 6c65 7465 2066 726f 6d0a 2020 2020  delete from.    
+00011c20: 2020 2020 3a70 6172 616d 2078 7061 7468      :param xpath
+00011c30: 3a20 7870 6174 6820 746f 2073 6561 7263  : xpath to searc
+00011c40: 6820 7769 7468 0a20 2020 2020 2020 203a  h with.        :
+00011c50: 7265 7475 726e 3a20 656c 656d 7320 7468  return: elems th
+00011c60: 6174 2068 6176 6520 6265 656e 2064 656c  at have been del
+00011c70: 6574 6564 0a20 2020 2020 2020 2022 2222  eted.        """
+00011c80: 0a20 2020 2020 2020 2065 6c65 6d73 203d  .        elems =
+00011c90: 2068 746d 6c2e 7870 6174 6828 7870 6174   html.xpath(xpat
+00011ca0: 6829 0a20 2020 2020 2020 2066 6f72 2065  h).        for e
+00011cb0: 6c65 6d20 696e 2065 6c65 6d73 3a0a 2020  lem in elems:.  
+00011cc0: 2020 2020 2020 2020 2020 4874 6d6c 5574            HtmlUt
+00011cd0: 696c 2e72 656d 6f76 655f 656c 656d 656e  il.remove_elemen
+00011ce0: 745f 696e 5f68 6965 7261 7263 6879 2865  t_in_hierarchy(e
+00011cf0: 6c65 6d29 0a20 2020 2020 2020 2072 6574  lem).        ret
+00011d00: 7572 6e20 656c 656d 730a 0a20 2020 2040  urn elems..    @
+00011d10: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+00011d20: 6465 6620 7061 7273 655f 6874 6d6c 5f6c  def parse_html_l
+00011d30: 786d 6c28 636c 732c 2069 6e66 696c 6529  xml(cls, infile)
+00011d40: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00011d50: 2020 2020 2020 7061 7273 6520 4854 4d4c        parse HTML
+00011d60: 2077 6974 6820 6c78 6d6c 2063 6f6e 7665   with lxml conve
+00011d70: 6e69 656e 6365 206d 6574 686f 640a 2020  nience method.  
+00011d80: 2020 2020 2020 3a70 6172 616d 2069 6e66        :param inf
+00011d90: 696c 653a 2073 7472 206f 7220 7061 7468  ile: str or path
+00011da0: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+00011db0: 3a20 4854 4d4c 2074 7265 650a 2020 2020  : HTML tree.    
+00011dc0: 2020 2020 3a65 7863 6570 743a 2063 616e      :except: can
+00011dd0: 6e6f 7420 6669 6e64 2f70 6172 7365 0a20  not find/parse. 
+00011de0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00011df0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00011e00: 2020 2020 6874 6d6c 7820 3d20 4554 2e70      htmlx = ET.p
+00011e10: 6172 7365 2873 7472 2869 6e66 696c 6529  arse(str(infile)
+00011e20: 2c20 4854 4d4c 5061 7273 6572 2829 290a  , HTMLParser()).
+00011e30: 2020 2020 2020 2020 6578 6365 7074 2045          except E
+00011e40: 7863 6570 7469 6f6e 2061 7320 653a 0a20  xception as e:. 
+00011e50: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00011e60: 2065 0a20 2020 2020 2020 2072 6574 7572   e.        retur
+00011e70: 6e20 6874 6d6c 780a 0a0a 0a63 6c61 7373  n htmlx....class
+00011e80: 2048 746d 6c41 6e6e 6f74 6174 6f72 3a0a   HtmlAnnotator:.
+00011e90: 2020 2020 2222 2269 6e6c 696e 6520 616e      """inline an
+00011ea0: 6e6f 7461 746f 7220 666f 7220 4854 4d4c  notator for HTML
+00011eb0: 2065 6c65 6d65 6e74 730a 2020 2020 7374   elements.    st
+00011ec0: 6f72 6573 2061 6e64 2072 756e 7320 416e  ores and runs An
+00011ed0: 6e6f 7461 746f 7243 6f6d 6d61 6e64 730a  notatorCommands.
+00011ee0: 0a20 2020 2061 6e6e 6f74 6174 6f72 203d  .    annotator =
+00011ef0: 2041 6e6e 6f74 6174 6f72 2829 0a20 2020   Annotator().   
+00011f00: 2063 6f6d 6d61 6e64 203d 2041 6e6e 6f74   command = Annot
+00011f10: 6174 6f72 436f 6d6d 616e 6428 6874 6d6c  atorCommand(html
+00011f20: 5f63 6c61 7373 3d22 7365 6374 696f 6e5f  _class="section_
+00011f30: 7469 746c 6522 2c20 7265 6765 783d 2253  title", regex="S
+00011f40: 6563 7469 6f6e 5c5c 732b 283f 503c 6964  ection\\s+(?P<id
+00011f50: 3e5c 5c64 2b29 3a5c 5c73 2b28 3f50 3c74  >\\d+):\\s+(?P<t
+00011f60: 6974 6c65 3e2e 2a29 222c 2061 6464 5f69  itle>.*)", add_i
+00011f70: 643d 5472 7565 2c20 6164 645f 7469 746c  d=True, add_titl
+00011f80: 653d 5472 7565 290a 2020 2020 616e 6e6f  e=True).    anno
+00011f90: 7461 746f 722e 6164 645f 636f 6d6d 616e  tator.add_comman
+00011fa0: 6428 636f 6d6d 616e 6429 0a20 2020 2061  d(command).    a
+00011fb0: 6e6e 6f74 6174 6f72 2e72 756e 5f63 6f6d  nnotator.run_com
+00011fc0: 6d61 6e64 7328 656c 656d 290a 0a20 2020  mands(elem)..   
+00011fd0: 2022 2222 0a0a 2020 2020 6465 6620 5f5f   """..    def __
+00011fe0: 696e 6974 5f5f 2873 656c 6629 3a0a 2020  init__(self):.  
+00011ff0: 2020 2020 2020 7365 6c66 2e63 6f6d 6d61        self.comma
+00012000: 6e64 7320 3d20 5b5d 0a0a 2020 2020 6465  nds = []..    de
+00012010: 6620 6164 645f 636f 6d6d 616e 6428 7365  f add_command(se
+00012020: 6c66 2c20 636f 6d6d 616e 6429 3a0a 2020  lf, command):.  
+00012030: 2020 2020 2020 6966 2063 6f6d 6d61 6e64        if command
+00012040: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00012050: 6c66 2e63 6f6d 6d61 6e64 732e 6170 7065  lf.commands.appe
+00012060: 6e64 2863 6f6d 6d61 6e64 290a 0a20 2020  nd(command)..   
+00012070: 2064 6566 2072 756e 5f63 6f6d 6d61 6e64   def run_command
+00012080: 7328 7365 6c66 2c20 7461 7267 6574 5f65  s(self, target_e
+00012090: 6c65 6d29 3a0a 2020 2020 2020 2020 2222  lem):.        ""
+000120a0: 220a 2020 2020 2020 2020 6974 6572 6174  ".        iterat
+000120b0: 6520 636f 6d6d 616e 6473 2028 6f72 6465  e commands (orde
+000120c0: 7220 6973 206f 7264 6572 206f 6620 7468  r is order of th
+000120d0: 6569 7220 6164 6469 7469 6f6e 0a20 2020  eir addition.   
+000120e0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000120f0: 2066 6f72 2063 6f6d 6d61 6e64 2069 6e20   for command in 
+00012100: 7365 6c66 2e63 6f6d 6d61 6e64 733a 0a20  self.commands:. 
+00012110: 2020 2020 2020 2020 2020 2063 6f6d 6d61             comma
+00012120: 6e64 2e72 756e 5f63 6f6d 6d61 6e64 2874  nd.run_command(t
+00012130: 6172 6765 745f 656c 656d 290a 0a20 2020  arget_elem)..   
+00012140: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+00012150: 2020 6465 6620 6372 6561 7465 5f69 7063    def create_ipc
+00012160: 635f 616e 6e6f 7461 746f 7228 636c 7329  c_annotator(cls)
+00012170: 3a0a 2020 2020 2020 2020 2222 2261 2073  :.        """a s
+00012180: 6574 206f 6620 6765 6e65 7261 6c20 6f70  et of general op
+00012190: 6572 6174 696f 6e73 2066 6f72 2049 5043  erations for IPC
+000121a0: 4322 2222 0a20 2020 2020 2020 2061 6e6e  C""".        ann
+000121b0: 6f74 6174 6f72 203d 2048 746d 6c41 6e6e  otator = HtmlAnn
+000121c0: 6f74 6174 6f72 2829 0a20 2020 2020 2020  otator().       
+000121d0: 2061 6e6e 6f74 6174 6f72 2e61 6464 5f63   annotator.add_c
+000121e0: 6f6d 6d61 6e64 280a 2020 2020 2020 2020  ommand(.        
+000121f0: 2020 2020 416e 6e6f 7461 746f 7243 6f6d      AnnotatorCom
+00012200: 6d61 6e64 2868 746d 6c5f 636c 6173 733d  mand(html_class=
+00012210: 2273 6563 7469 6f6e 5f74 6974 6c65 222c  "section_title",
+00012220: 2072 6567 6578 3d22 5365 6374 696f 6e5c   regex="Section\
+00012230: 5c73 2b28 3f50 3c69 643e 5c5c 642b 293a  \s+(?P<id>\\d+):
+00012240: 5c5c 732b 283f 503c 7469 746c 653e 2e2a  \\s+(?P<title>.*
+00012250: 2922 2c0a 2020 2020 2020 2020 2020 2020  )",.            
+00012260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012270: 2061 6464 5f69 643d 2273 6563 7469 6f6e   add_id="section
+00012280: 5f7c 222c 2061 6464 5f74 6974 6c65 3d22  _|", add_title="
+00012290: 7c22 2c20 7374 796c 653d 227b 636f 6c6f  |", style="{colo
+000122a0: 7220 3a20 626c 7565 3b20 6261 636b 6772  r : blue; backgr
+000122b0: 6f75 6e64 203a 2070 696e 6b3b 7d22 2c0a  ound : pink;}",.
+000122c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000122d0: 2020 2020 2020 2020 2020 2020 6465 7363              desc
+000122e0: 3d22 6164 6420 6964 2061 6e64 2074 6974  ="add id and tit
+000122f0: 6c65 2066 6f72 2027 5365 6374 696f 6e3a  le for 'Section:
+00012300: 202e 2e2e 2722 290a 2020 2020 2020 2020   ...'").        
+00012310: 290a 2020 2020 2020 2020 616e 6e6f 7461  ).        annota
+00012320: 746f 722e 6164 645f 636f 6d6d 616e 6428  tor.add_command(
+00012330: 0a20 2020 2020 2020 2020 2020 2041 6e6e  .            Ann
+00012340: 6f74 6174 6f72 436f 6d6d 616e 6428 6874  otatorCommand(ht
+00012350: 6d6c 5f63 6c61 7373 3d22 7375 625f 7365  ml_class="sub_se
+00012360: 6374 696f 6e5f 7469 746c 6522 2c20 7265  ction_title", re
+00012370: 6765 783d 225c 5c73 2a28 3f50 3c69 643e  gex="\\s*(?P<id>
+00012380: 5c5c 642b 5c5c 2e5c 5c64 2b29 5c5c 732b  \\d+\\.\\d+)\\s+
+00012390: 283f 503c 7469 746c 653e 2e2a 2922 2c0a  (?P<title>.*)",.
+000123a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000123b0: 2020 2020 2020 2020 2020 2020 2061 6464               add
+000123c0: 5f69 643d 2273 7562 7365 6374 696f 6e5f  _id="subsection_
+000123d0: 7c22 2c20 6164 645f 7469 746c 653d 227c  |", add_title="|
+000123e0: 222c 2073 7479 6c65 3d22 7b63 6f6c 6f72  ", style="{color
+000123f0: 203a 2067 7265 656e 3b20 6261 636b 6772   : green; backgr
+00012400: 6f75 6e64 203a 2079 656c 6c6f 773b 7d22  ound : yellow;}"
+00012410: 2929 0a20 2020 2020 2020 2061 6e6e 6f74  )).        annot
+00012420: 6174 6f72 2e61 6464 5f63 6f6d 6d61 6e64  ator.add_command
+00012430: 280a 2020 2020 2020 2020 2020 2020 416e  (.            An
+00012440: 6e6f 7461 746f 7243 6f6d 6d61 6e64 2868  notatorCommand(h
+00012450: 746d 6c5f 636c 6173 733d 2273 7562 5f73  tml_class="sub_s
+00012460: 7562 5f73 6563 7469 6f6e 5f74 6974 6c65  ub_section_title
+00012470: 222c 2072 6567 6578 3d22 5e5c 5c73 2a28  ", regex="^\\s*(
+00012480: 3f50 3c69 643e 5c5c 642b 5c5c 2e5c 5c64  ?P<id>\\d+\\.\\d
+00012490: 2b5c 5c2e 5c5c 642b 295c 5c73 2b28 3f50  +\\.\\d+)\\s+(?P
+000124a0: 3c74 6974 6c65 3e2e 2a29 222c 0a20 2020  <title>.*)",.   
+000124b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000124c0: 2020 2020 2020 2020 2020 6164 645f 6964            add_id
+000124d0: 3d22 7375 6273 6563 7469 6f6e 5f7c 222c  ="subsection_|",
+000124e0: 2061 6464 5f74 6974 6c65 3d22 7c22 2c20   add_title="|", 
+000124f0: 7374 796c 653d 227b 636f 6c6f 7220 3a20  style="{color : 
+00012500: 626c 6163 6b3b 2062 6163 6b67 726f 756e  black; backgroun
+00012510: 6420 3a20 2364 6464 6464 643b 7d22 2929  d : #dddddd;}"))
+00012520: 0a20 2020 2020 2020 2061 6e6e 6f74 6174  .        annotat
+00012530: 6f72 2e61 6464 5f63 6f6d 6d61 6e64 280a  or.add_command(.
+00012540: 2020 2020 2020 2020 2020 2020 416e 6e6f              Anno
+00012550: 7461 746f 7243 6f6d 6d61 6e64 2868 746d  tatorCommand(htm
+00012560: 6c5f 636c 6173 733d 2263 6f6e 6669 6465  l_class="confide
+00012570: 6e63 6522 2c0a 2020 2020 2020 2020 2020  nce",.          
+00012580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012590: 2020 2072 6567 6578 3d22 5e5c 5c73 2a5c     regex="^\\s*\
+000125a0: 5c28 3f28 3f50 3c74 6974 6c65 3e28 7665  \(?(?P<title>(ve
+000125b0: 7279 2068 6967 687c 6869 6768 7c6d 6564  ry high|high|med
+000125c0: 6975 6d7c 6c6f 7729 2063 6f6e 6669 6465  ium|low) confide
+000125d0: 6e63 6529 5c5c 293f 222c 0a20 2020 2020  nce)\\)?",.     
+000125e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000125f0: 2020 2020 2020 2020 6164 645f 6964 3d22          add_id="
+00012600: 636f 6e66 6964 656e 6365 5f7c 222c 2061  confidence_|", a
+00012610: 6464 5f74 6974 6c65 3d22 7c22 2c20 7374  dd_title="|", st
+00012620: 796c 653d 227b 636f 6c6f 7220 3a20 626c  yle="{color : bl
+00012630: 6163 6b3b 2062 6163 6b67 726f 756e 6420  ack; background 
+00012640: 3a20 2364 6438 3864 643b 7d22 2929 0a20  : #dd88dd;}")). 
+00012650: 2020 2020 2020 2061 6e6e 6f74 6174 6f72         annotator
+00012660: 2e61 6464 5f63 6f6d 6d61 6e64 280a 2020  .add_command(.  
+00012670: 2020 2020 2020 2020 2020 416e 6e6f 7461            Annota
+00012680: 746f 7243 6f6d 6d61 6e64 2868 746d 6c5f  torCommand(html_
+00012690: 636c 6173 733d 2270 726f 6261 6269 6c69  class="probabili
+000126a0: 7479 222c 0a20 2020 2020 2020 2020 2020  ty",.           
 000126b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000126c0: 2020 7265 6765 783d 225c 5c73 2a5c 5c5b    regex="\\s*\\[
-000126d0: 3f53 5441 5254 5c5c 732a 283f 503c 7469  ?START\\s*(?P<ti
-000126e0: 746c 653e 4649 4755 5245 7c54 4142 4c45  tle>FIGURE|TABLE
-000126f0: 295c 5c73 2a28 3f50 3c69 643e 5c5c 642b  )\\s*(?P<id>\\d+
-00012700: 5c5c 2e5c 5c64 2b29 5c5c 732a 2848 4552  \\.\\d+)\\s*(HER
-00012710: 4529 3f5c 5c5d 3f22 2c0a 2020 2020 2020  E)?\\]?",.      
+000126c0: 2020 7265 6765 783d 225e 5c5c 732a 5c5c    regex="^\\s*\\
+000126d0: 283f 283f 503c 7469 746c 653e 286c 696b  (?(?P<title>(lik
+000126e0: 656c 797c 7665 7279 206c 696b 656c 797c  ely|very likely|
+000126f0: 6578 7472 656d 656c 7920 6c69 6b65 6c79  extremely likely
+00012700: 7c76 6972 7475 616c 6c79 2063 6572 7461  |virtually certa
+00012710: 696e 2929 5c5c 293f 222c 0a20 2020 2020  in))\\)?",.     
 00012720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012730: 2020 2020 2020 2061 6464 5f69 643d 2273         add_id="s
-00012740: 7461 7274 5f7c 222c 2061 6464 5f74 6974  tart_|", add_tit
-00012750: 6c65 3d22 7374 6172 745f 7c22 2c20 7374  le="start_|", st
-00012760: 796c 653d 227b 636f 6c6f 7220 3a20 6772  yle="{color : gr
-00012770: 6565 6e3b 2062 6163 6b67 726f 756e 643a  een; background:
-00012780: 2070 696e 6b7d 2229 290a 2020 2020 2020   pink}")).      
-00012790: 2020 616e 6e6f 7461 746f 722e 6164 645f    annotator.add_
-000127a0: 636f 6d6d 616e 6428 0a20 2020 2020 2020  command(.       
-000127b0: 2020 2020 2041 6e6e 6f74 6174 6f72 436f       AnnotatorCo
-000127c0: 6d6d 616e 6428 6874 6d6c 5f63 6c61 7373  mmand(html_class
-000127d0: 3d22 656e 6422 2c0a 2020 2020 2020 2020  ="end",.        
-000127e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000127f0: 2020 2020 2072 6567 6578 3d22 5c5c 732a       regex="\\s*
-00012800: 5c5c 5b3f 454e 445c 5c73 2a28 3f50 3c74  \\[?END\\s*(?P<t
-00012810: 6974 6c65 3e46 4947 5552 457c 5441 424c  itle>FIGURE|TABL
-00012820: 4529 5c5c 732a 283f 503c 6964 3e5c 5c64  E)\\s*(?P<id>\\d
-00012830: 2b5c 5c2e 5c5c 642b 295c 5c73 2a28 4845  +\\.\\d+)\\s*(HE
-00012840: 5245 293f 5c5c 5d3f 222c 0a20 2020 2020  RE)?\\]?",.     
-00012850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012860: 2020 2020 2020 2020 6164 645f 6964 3d22          add_id="
-00012870: 656e 645f 7c22 2c20 6164 645f 7469 746c  end_|", add_titl
-00012880: 653d 2265 6e64 5f7c 222c 2073 7479 6c65  e="end_|", style
-00012890: 3d22 7b63 6f6c 6f72 203a 2067 7265 656e  ="{color : green
-000128a0: 3b20 6261 636b 6772 6f75 6e64 3a20 626c  ; background: bl
-000128b0: 7565 7d22 2929 0a20 2020 2020 2020 2061  ue}")).        a
-000128c0: 6e6e 6f74 6174 6f72 2e61 6464 5f63 6f6d  nnotator.add_com
-000128d0: 6d61 6e64 280a 2020 2020 2020 2020 2020  mand(.          
-000128e0: 2020 416e 6e6f 7461 746f 7243 6f6d 6d61    AnnotatorComma
-000128f0: 6e64 2868 746d 6c5f 636c 6173 733d 2274  nd(html_class="t
-00012900: 6172 6765 7473 222c 2072 6567 6578 3d22  argets", regex="
-00012910: 2e2a 5c5c 7b28 3f50 3c74 6974 6c65 3e2e  .*\\{(?P<title>.
-00012920: 2b29 5c5c 7d2e 2a22 2c0a 2020 2020 2020  +)\\}.*",.      
-00012930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012940: 2020 2020 2020 2061 6464 5f69 643d 2263         add_id="c
-00012950: 6875 6e6b 5f7c 222c 2061 6464 5f74 6974  hunk_|", add_tit
-00012960: 6c65 3d22 7c22 2c20 7374 796c 653d 227b  le="|", style="{
-00012970: 636f 6c6f 7220 3a20 6772 6565 6e3b 2062  color : green; b
-00012980: 6163 6b67 726f 756e 643a 206f 7261 6e67  ackground: orang
-00012990: 657d 222c 0a20 2020 2020 2020 2020 2020  e}",.           
-000129a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000129b0: 2020 6465 7363 3d22 4950 4343 2074 6172    desc="IPCC tar
-000129c0: 6765 7420 4944 7320 696e 2063 7572 6c79  get IDs in curly
-000129d0: 2062 7261 636b 6574 7320 7b57 4731 2053   brackets {WG1 S
-000129e0: 504d 2041 2e31 2e32 2c20 5747 4949 2053  PM A.1.2, WGII S
-000129f0: 504d 2042 2e32 2e33 7d22 2929 0a20 2020  PM B.2.3}")).   
-00012a00: 2020 2020 2061 6e6e 6f74 6174 6f72 2e61       annotator.a
-00012a10: 6464 5f63 6f6d 6d61 6e64 280a 2020 2020  dd_command(.    
-00012a20: 2020 2020 2020 2020 416e 6e6f 7461 746f          Annotato
-00012a30: 7243 6f6d 6d61 6e64 2868 746d 6c5f 636c  rCommand(html_cl
-00012a40: 6173 733d 2263 7275 6674 222c 0a20 2020  ass="cruft",.   
-00012a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012a60: 2020 2020 2020 2020 2020 7265 6765 783d            regex=
-00012a70: 225e 2e2a 2853 7562 6a65 6374 2074 6f20  "^.*(Subject to 
-00012a80: 436f 7079 2045 6469 7420 7c41 646f 7074  Copy Edit |Adopt
-00012a90: 6564 204c 6f6e 6765 7220 5265 706f 7274  ed Longer Report
-00012aa0: 2049 5043 4320 4152 3620 5359 5229 2e2a   IPCC AR6 SYR).*
-00012ab0: 2422 2c0a 2020 2020 2020 2020 2020 2020  $",.            
-00012ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ad0: 2061 6464 5f69 643d 2263 7275 6674 5f7c   add_id="cruft_|
-00012ae0: 222c 2061 6464 5f74 6974 6c65 3d22 7c22  ", add_title="|"
-00012af0: 2c20 6465 6c65 7465 3d54 7275 652c 2073  , delete=True, s
-00012b00: 7479 6c65 3d22 7b63 6f6c 6f72 203a 2067  tyle="{color : g
-00012b10: 7265 656e 3b20 6261 636b 6772 6f75 6e64  reen; background
-00012b20: 3a20 626c 6163 6b7d 2229 290a 2020 2020  : black}")).    
-00012b30: 2020 2020 616e 6e6f 7461 746f 722e 6164      annotator.ad
-00012b40: 645f 636f 6d6d 616e 6428 0a20 2020 2020  d_command(.     
-00012b50: 2020 2020 2020 2041 6e6e 6f74 6174 6f72         Annotator
-00012b60: 436f 6d6d 616e 6428 6874 6d6c 5f63 6c61  Command(html_cla
-00012b70: 7373 3d22 7061 6765 222c 2072 6567 6578  ss="page", regex
-00012b80: 3d22 5e28 3f50 3c74 6974 6c65 3e70 5c5c  ="^(?P<title>p\\
-00012b90: 2e5c 5c64 2b29 222c 0a20 2020 2020 2020  .\\d+)",.       
-00012ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012bb0: 2020 2020 2020 6164 645f 7469 746c 653d        add_title=
-00012bc0: 227c 222c 2073 7479 6c65 3d22 7b63 6f6c  "|", style="{col
-00012bd0: 6f72 203a 2070 7572 706c 657d 2229 290a  or : purple}")).
-00012be0: 2020 2020 2020 2020 616e 6e6f 7461 746f          annotato
-00012bf0: 722e 6164 645f 636f 6d6d 616e 6428 0a20  r.add_command(. 
-00012c00: 2020 2020 2020 2020 2020 2041 6e6e 6f74             Annot
-00012c10: 6174 6f72 436f 6d6d 616e 6428 6874 6d6c  atorCommand(html
-00012c20: 5f63 6c61 7373 3d22 6661 6374 222c 0a20  _class="fact",. 
-00012c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012c40: 2020 2020 2020 2020 2020 2020 7870 6174              xpat
-00012c50: 683d 2273 656c 663a 3a73 7061 6e5b 636f  h="self::span[co
-00012c60: 6e74 6169 6e73 2840 636c 6173 732c 2027  ntains(@class, '
-00012c70: 636f 6e66 6964 656e 6365 2729 5d2f 7072  confidence')]/pr
-00012c80: 6563 6564 696e 672d 7369 626c 696e 673a  eceding-sibling:
-00012c90: 3a73 7061 6e5b 315d 222c 0a20 2020 2020  :span[1]",.     
-00012ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012cb0: 2020 2020 2020 2020 7374 796c 653d 227b          style="{
-00012cc0: 636f 6c6f 7220 3a20 7075 7270 6c65 7d22  color : purple}"
-00012cd0: 2929 0a20 2020 2020 2020 2061 6e6e 6f74  )).        annot
-00012ce0: 6174 6f72 2e61 6464 5f63 6f6d 6d61 6e64  ator.add_command
-00012cf0: 280a 2020 2020 2020 2020 2020 2020 416e  (.            An
-00012d00: 6e6f 7461 746f 7243 6f6d 6d61 6e64 2868  notatorCommand(h
-00012d10: 746d 6c5f 636c 6173 733d 2267 726f 7570  tml_class="group
-00012d20: 222c 2067 726f 7570 5f78 7061 7468 3d22  ", group_xpath="
-00012d30: 6469 765b 7370 616e 5b63 6f6e 7461 696e  div[span[contain
-00012d40: 7328 4063 6c61 7373 2c20 2773 7461 7274  s(@class, 'start
-00012d50: 2729 5d5d 222c 0a20 2020 2020 2020 2020  ')]]",.         
-00012d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012d70: 2020 2020 656e 645f 7870 6174 683d 2273      end_xpath="s
-00012d80: 656c 663a 3a64 6976 5b73 7061 6e5b 636f  elf::div[span[co
-00012d90: 6e74 6169 6e73 2874 6578 7428 292c 2745  ntains(text(),'E
-00012da0: 4e44 2729 5d5d 222c 0a20 2020 2020 2020  ND')]]",.       
-00012db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012dc0: 2020 2020 2020 6465 7363 3d22 3f65 7874        desc="?ext
-00012dd0: 7261 6374 7320 6772 6f75 7073 2061 6e64  racts groups and
-00012de0: 206d 6d6f 7665 7320 746f 2065 6e64 2229   mmoves to end")
-00012df0: 290a 2020 2020 2020 2020 616e 6e6f 7461  ).        annota
-00012e00: 746f 722e 6164 645f 636f 6d6d 616e 6428  tor.add_command(
-00012e10: 0a20 2020 2020 2020 2020 2020 2041 6e6e  .            Ann
-00012e20: 6f74 6174 6f72 436f 6d6d 616e 6428 6874  otatorCommand(ht
-00012e30: 6d6c 5f63 6c61 7373 3d22 7375 6273 7562  ml_class="subsub
-00012e40: 7365 6374 696f 6e22 2c0a 2020 2020 2020  section",.      
-00012e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e60: 2020 2020 2020 2067 726f 7570 5f78 7061         group_xpa
-00012e70: 7468 3d22 6469 765b 7370 616e 5b63 6f6e  th="div[span[con
-00012e80: 7461 696e 7328 4063 6c61 7373 2c20 2773  tains(@class, 's
-00012e90: 7562 7375 6273 6563 7469 6f6e 5f74 6974  ubsubsection_tit
-00012ea0: 6c65 2729 5d5d 222c 0a20 2020 2020 2020  le')]]",.       
-00012eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ec0: 2020 2020 2020 656e 645f 7870 6174 683d        end_xpath=
-00012ed0: 2273 656c 663a 3a64 6976 5b73 7061 6e5b  "self::div[span[
-00012ee0: 636f 6e74 6169 6e73 2874 6578 7428 292c  contains(text(),
-00012ef0: 2773 6563 7469 6f6e 5f74 6974 6c65 2729  'section_title')
-00012f00: 5d5d 2229 290a 2020 2020 2020 2020 616e  ]]")).        an
-00012f10: 6e6f 7461 746f 722e 6164 645f 636f 6d6d  notator.add_comm
-00012f20: 616e 6428 0a20 2020 2020 2020 2020 2020  and(.           
-00012f30: 2041 6e6e 6f74 6174 6f72 436f 6d6d 616e   AnnotatorComman
-00012f40: 6428 6874 6d6c 5f63 6c61 7373 3d22 666f  d(html_class="fo
-00012f50: 6f74 6e6f 7465 222c 0a20 2020 2020 2020  otnote",.       
-00012f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012f70: 2020 2020 2020 7870 6174 683d 222f 2f64        xpath="//d
-00012f80: 6976 5b73 7061 6e5b 636f 6e74 6169 6e73  iv[span[contains
-00012f90: 2840 7374 796c 652c 2027 666f 6e74 2d73  (@style, 'font-s
-00012fa0: 697a 653a 2036 2e30 2729 2061 6e64 206e  ize: 6.0') and n
-00012fb0: 756d 6265 7228 2e29 3d6e 756d 6265 7228  umber(.)=number(
-00012fc0: 2e29 5d5d 222c 0a20 2020 2020 2020 2020  .)]]",.         
-00012fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012fe0: 2020 2020 6465 7363 3d22 686f 7272 6962      desc="horrib
-00012ff0: 6c65 2068 6163 6b20 7465 7374 696e 6720  le hack testing 
-00013000: 666f 6e74 2d73 697a 6522 2929 0a0a 2020  font-size"))..  
-00013010: 2020 2020 2020 7265 7475 726e 2061 6e6e        return ann
-00013020: 6f74 6174 6f72 0a0a 0a41 4e4e 5f53 504c  otator...ANN_SPL
-00013030: 4954 203d 2022 7c22 0a4c 454e 5f54 4954  IT = "|".LEN_TIT
-00013040: 4c45 203d 2035 300a 0a0a 636c 6173 7320  LE = 50...class 
-00013050: 416e 6e6f 7461 746f 7243 6f6d 6d61 6e64  AnnotatorCommand
-00013060: 3a0a 2020 2020 2222 2261 6e20 616e 6e6f  :.    """an anno
-00013070: 7461 7469 6f6e 2063 6f6d 6d61 6e64 0a20  tation command. 
-00013080: 2020 2065 2e67 2e0a 2020 2020 636f 6d6d     e.g..    comm
-00013090: 616e 6420 3d20 416e 6e6f 7461 746f 7243  and = AnnotatorC
-000130a0: 6f6d 6d61 6e64 2868 746d 6c5f 636c 6173  ommand(html_clas
-000130b0: 733d 2273 6563 7469 6f6e 5f74 6974 6c65  s="section_title
-000130c0: 222c 2072 6567 6578 3d22 5365 6374 696f  ", regex="Sectio
-000130d0: 6e5c 5c73 2b28 3f50 3c69 643e 5c5c 642b  n\\s+(?P<id>\\d+
-000130e0: 293a 5c5c 732b 283f 503c 7469 746c 653e  ):\\s+(?P<title>
-000130f0: 2e2a 2922 2c20 6164 645f 6964 3d54 7275  .*)", add_id=Tru
-00013100: 652c 2061 6464 5f74 6974 6c65 3d54 7275  e, add_title=Tru
-00013110: 6529 0a20 2020 2061 6e6e 6f74 6174 6f72  e).    annotator
-00013120: 2e61 6464 5f63 6f6d 6d61 6e64 2863 6f6d  .add_command(com
-00013130: 6d61 6e64 290a 2020 2020 616e 6e6f 7461  mand).    annota
-00013140: 746f 722e 7275 6e5f 636f 6d6d 616e 6473  tor.run_commands
-00013150: 0a0a 2020 2020 2222 220a 0a20 2020 2064  ..    """..    d
-00013160: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
-00013170: 2c20 6874 6d6c 5f63 6c61 7373 3d4e 6f6e  , html_class=Non
-00013180: 652c 2072 6567 6578 3d4e 6f6e 652c 2061  e, regex=None, a
-00013190: 6464 5f69 643d 4e6f 6e65 2c20 6164 645f  dd_id=None, add_
-000131a0: 7469 746c 653d 4e6f 6e65 2c20 7363 7269  title=None, scri
-000131b0: 7074 3d4e 6f6e 652c 2073 7479 6c65 3d4e  pt=None, style=N
-000131c0: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
-000131d0: 2020 2020 2020 6465 6c65 7465 3d46 616c        delete=Fal
-000131e0: 7365 2c20 7870 6174 683d 4e6f 6e65 2c20  se, xpath=None, 
-000131f0: 6772 6f75 705f 7870 6174 683d 4e6f 6e65  group_xpath=None
-00013200: 2c20 656e 645f 7870 6174 683d 4e6f 6e65  , end_xpath=None
-00013210: 2c20 6465 7363 3d4e 6f6e 6529 3a0a 2020  , desc=None):.  
-00013220: 2020 2020 2020 7365 6c66 2e68 746d 6c5f        self.html_
-00013230: 636c 6173 7320 3d20 6874 6d6c 5f63 6c61  class = html_cla
-00013240: 7373 0a20 2020 2020 2020 2073 656c 662e  ss.        self.
-00013250: 7265 203d 204e 6f6e 650a 2020 2020 2020  re = None.      
-00013260: 2020 6966 2072 6567 6578 3a0a 2020 2020    if regex:.    
-00013270: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00013280: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00013290: 662e 7265 203d 2072 652e 636f 6d70 696c  f.re = re.compil
-000132a0: 6528 7265 6765 7829 0a20 2020 2020 2020  e(regex).       
-000132b0: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-000132c0: 7074 696f 6e20 6173 2065 3a0a 2020 2020  ption as e:.    
-000132d0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-000132e0: 6520 5661 6c75 6545 7272 6f72 2866 2243  e ValueError(f"C
-000132f0: 616e 6e6f 7420 636f 6d70 696c 6520 7265  annot compile re
-00013300: 6765 7820 7b72 6567 6578 7d20 6265 6361  gex {regex} beca
-00013310: 7573 6520 7b65 7d22 290a 0a20 2020 2020  use {e}")..     
-00013320: 2020 2023 2061 6464 5f69 6420 616e 6420     # add_id and 
-00013330: 6164 645f 7469 746c 6520 6172 6520 6f66  add_title are of
-00013340: 2066 6f72 6d20 666f 6f7c 6261 7220 7768   form foo|bar wh
-00013350: 6572 6520 6578 7472 6163 7465 6420 6964  ere extracted id
-00013360: 2072 6570 6c61 6365 7320 7c0a 2020 2020   replaces |.    
-00013370: 2020 2020 6966 2061 6464 5f69 643a 0a20      if add_id:. 
-00013380: 2020 2020 2020 2020 2020 2061 6464 5f69             add_i
-00013390: 6420 3d20 6164 645f 6964 2e73 706c 6974  d = add_id.split
-000133a0: 2841 4e4e 5f53 504c 4954 290a 2020 2020  (ANN_SPLIT).    
-000133b0: 2020 2020 7365 6c66 2e61 6464 5f69 6420      self.add_id 
-000133c0: 3d20 4e6f 6e65 2069 6620 6e6f 7420 6164  = None if not ad
-000133d0: 645f 6964 206f 7220 6c65 6e28 6164 645f  d_id or len(add_
-000133e0: 6964 2920 213d 2032 2065 6c73 6520 6164  id) != 2 else ad
-000133f0: 645f 6964 0a20 2020 2020 2020 2069 6620  d_id.        if 
-00013400: 6164 645f 7469 746c 653a 0a20 2020 2020  add_title:.     
-00013410: 2020 2020 2020 2061 6464 5f74 6974 6c65         add_title
-00013420: 203d 2061 6464 5f74 6974 6c65 2e73 706c   = add_title.spl
-00013430: 6974 2841 4e4e 5f53 504c 4954 290a 2020  it(ANN_SPLIT).  
-00013440: 2020 2020 2020 7365 6c66 2e61 6464 5f74        self.add_t
-00013450: 6974 6c65 203d 204e 6f6e 6520 6966 206e  itle = None if n
-00013460: 6f74 2061 6464 5f74 6974 6c65 206f 7220  ot add_title or 
-00013470: 6c65 6e28 6164 645f 7469 746c 6529 2021  len(add_title) !
-00013480: 3d20 3220 656c 7365 2061 6464 5f74 6974  = 2 else add_tit
-00013490: 6c65 0a0a 2020 2020 2020 2020 7365 6c66  le..        self
-000134a0: 2e68 746d 6c5f 636c 6173 7320 3d20 6874  .html_class = ht
-000134b0: 6d6c 5f63 6c61 7373 0a20 2020 2020 2020  ml_class.       
-000134c0: 2073 656c 662e 7363 7269 7074 203d 2073   self.script = s
-000134d0: 6372 6970 740a 2020 2020 2020 2020 7365  cript.        se
-000134e0: 6c66 2e73 7479 6c65 203d 2073 7479 6c65  lf.style = style
-000134f0: 0a20 2020 2020 2020 2073 656c 662e 6465  .        self.de
-00013500: 6c65 7465 203d 2064 656c 6574 650a 2020  lete = delete.  
-00013510: 2020 2020 2020 7365 6c66 2e78 7061 7468        self.xpath
-00013520: 203d 2078 7061 7468 0a20 2020 2020 2020   = xpath.       
-00013530: 2073 656c 662e 6772 6f75 705f 7870 6174   self.group_xpat
-00013540: 6820 3d20 6772 6f75 705f 7870 6174 680a  h = group_xpath.
-00013550: 2020 2020 2020 2020 7365 6c66 2e65 6e64          self.end
-00013560: 5f78 7061 7468 203d 2065 6e64 5f78 7061  _xpath = end_xpa
-00013570: 7468 0a20 2020 2020 2020 2073 656c 662e  th.        self.
-00013580: 6465 7363 203d 2064 6573 630a 0a20 2020  desc = desc..   
-00013590: 2023 2063 6c61 7373 2041 6e6e 6f74 6174   # class Annotat
-000135a0: 6f72 436f 6d6d 616e 640a 0a20 2020 2064  orCommand..    d
-000135b0: 6566 2072 756e 5f63 6f6d 6d61 6e64 2873  ef run_command(s
-000135c0: 656c 662c 2065 6c65 6d29 3a0a 2020 2020  elf, elem):.    
-000135d0: 2020 2020 2320 7072 696e 7428 6622 7275      # print(f"ru
-000135e0: 6e5f 636f 6d6d 616e 6420 2c20 7461 672c  n_command , tag,
-000135f0: 207b 656c 656d 2e74 6167 7d20 7061 7265   {elem.tag} pare
-00013600: 6e74 3a20 7b65 6c65 6d2e 6765 7470 6172  nt: {elem.getpar
-00013610: 656e 7428 297d 2229 0a20 2020 2020 2020  ent()}").       
-00013620: 2069 6620 7365 6c66 2e72 653a 0a20 2020   if self.re:.   
-00013630: 2020 2020 2020 2020 2073 656c 662e 7275           self.ru
-00013640: 6e5f 7265 6765 7828 656c 656d 290a 2020  n_regex(elem).  
-00013650: 2020 2020 2020 2320 656c 6966 2073 656c        # elif sel
-00013660: 662e 6578 7472 6163 743a 0a20 2020 2020  f.extract:.     
-00013670: 2020 2023 2020 2020 2073 656c 662e 7275     #     self.ru
-00013680: 6e5f 6578 7472 6163 7428 656c 656d 290a  n_extract(elem).
-00013690: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
-000136a0: 662e 7870 6174 683a 0a20 2020 2020 2020  f.xpath:.       
-000136b0: 2020 2020 2073 656c 662e 7275 6e5f 7870       self.run_xp
-000136c0: 6174 6828 656c 656d 290a 2020 2020 2020  ath(elem).      
-000136d0: 2020 656c 6966 2073 656c 662e 7363 7269    elif self.scri
-000136e0: 7074 203d 3d20 2273 7562 223a 0a20 2020  pt == "sub":.   
-000136f0: 2020 2020 2020 2020 2073 656c 662e 7275           self.ru
-00013700: 6e5f 7375 6273 6372 6970 7428 656c 656d  n_subscript(elem
-00013710: 290a 2020 2020 2020 2020 656c 6966 2073  ).        elif s
-00013720: 656c 662e 7363 7269 7074 203d 3d20 2273  elf.script == "s
-00013730: 7570 6572 223a 0a20 2020 2020 2020 2020  uper":.         
-00013740: 2020 2073 656c 662e 7275 6e5f 7375 7065     self.run_supe
-00013750: 7273 6372 6970 7428 656c 656d 290a 2020  rscript(elem).  
-00013760: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
-00013770: 6772 6f75 705f 7870 6174 6820 6973 206e  group_xpath is n
-00013780: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00013790: 2020 2020 2073 656c 662e 7275 6e5f 6772       self.run_gr
-000137a0: 6f75 705f 7870 6174 6828 656c 656d 290a  oup_xpath(elem).
-000137b0: 0a20 2020 2023 2063 6c61 7373 2041 6e6e  .    # class Ann
-000137c0: 6f74 6174 6f72 436f 6d6d 616e 640a 0a20  otatorCommand.. 
-000137d0: 2020 2064 6566 2072 756e 5f72 6567 6578     def run_regex
-000137e0: 2873 656c 662c 2065 6c65 6d29 3a0a 2020  (self, elem):.  
-000137f0: 2020 2020 2020 7465 7874 203d 2065 6c65        text = ele
-00013800: 6d2e 7465 7874 0a20 2020 2020 2020 2069  m.text.        i
-00013810: 6620 7465 7874 2069 7320 4e6f 6e65 3a0a  f text is None:.
-00013820: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00013830: 7428 6622 7265 6765 783a 204e 6f6e 6520  t(f"regex: None 
-00013840: 7465 7874 2069 6e20 7b65 6c65 6d7d 207b  text in {elem} {
-00013850: 656c 656d 2e74 6167 7d22 290a 2020 2020  elem.tag}").    
-00013860: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
-00013870: 2020 2020 2020 206d 6174 6368 203d 204e         match = N
-00013880: 6f6e 650a 2020 2020 2020 2020 7472 793a  one.        try:
-00013890: 0a20 2020 2020 2020 2020 2020 206d 6174  .            mat
-000138a0: 6368 203d 2073 656c 662e 7265 2e6d 6174  ch = self.re.mat
-000138b0: 6368 2874 6578 7429 0a20 2020 2020 2020  ch(text).       
-000138c0: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-000138d0: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
-000138e0: 2020 2020 7072 696e 7428 6622 6d61 7463      print(f"matc
-000138f0: 6820 6661 696c 207b 657d 2229 0a20 2020  h fail {e}").   
-00013900: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
-00013910: 2020 2020 2020 2020 6966 206d 6174 6368          if match
-00013920: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00013930: 2073 656c 662e 6465 6c65 7465 3a0a 2020   self.delete:.  
-00013940: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00013950: 6c66 2e72 656d 6f76 655f 656c 656d 2865  lf.remove_elem(e
-00013960: 6c65 6d29 0a20 2020 2020 2020 2020 2020  lem).           
-00013970: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
-00013980: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00013990: 6164 645f 6964 2061 6e64 2022 6964 2220  add_id and "id" 
-000139a0: 696e 206d 6174 6368 2e67 726f 7570 6469  in match.groupdi
-000139b0: 6374 2829 3a0a 2020 2020 2020 2020 2020  ct():.          
-000139c0: 2020 2020 2020 656c 656d 2e61 7474 7269        elem.attri
-000139d0: 625b 2269 6422 5d20 3d20 7365 6c66 2e61  b["id"] = self.a
-000139e0: 6464 5f69 645b 305d 202b 206d 6174 6368  dd_id[0] + match
-000139f0: 2e67 726f 7570 2822 6964 2229 202b 2073  .group("id") + s
-00013a00: 656c 662e 6164 645f 6964 5b31 5d0a 2020  elf.add_id[1].  
-00013a10: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00013a20: 662e 6164 645f 7469 746c 6520 616e 6420  f.add_title and 
-00013a30: 2274 6974 6c65 2220 696e 206d 6174 6368  "title" in match
-00013a40: 2e67 726f 7570 6469 6374 2829 3a0a 2020  .groupdict():.  
-00013a50: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00013a60: 656d 2e61 7474 7269 625b 2274 6974 6c65  em.attrib["title
-00013a70: 225d 203d 2073 656c 662e 6164 645f 7469  "] = self.add_ti
-00013a80: 746c 655b 305d 202b 206d 6174 6368 2e67  tle[0] + match.g
-00013a90: 726f 7570 2822 7469 746c 6522 2920 2b20  roup("title") + 
-00013aa0: 7365 6c66 2e61 6464 5f74 6974 6c65 5b31  self.add_title[1
-00013ab0: 5d5b 3a4c 454e 5f54 4954 4c45 5d0a 2020  ][:LEN_TITLE].  
-00013ac0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00013ad0: 662e 6874 6d6c 5f63 6c61 7373 3a0a 2020  f.html_class:.  
-00013ae0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00013af0: 6c66 2e75 7064 6174 655f 636c 6173 7328  lf.update_class(
-00013b00: 656c 656d 2c20 7365 6c66 2e68 746d 6c5f  elem, self.html_
-00013b10: 636c 6173 7329 0a0a 2020 2020 2320 636c  class)..    # cl
-00013b20: 6173 7320 416e 6e6f 7461 746f 7243 6f6d  ass AnnotatorCom
-00013b30: 6d61 6e64 0a0a 2020 2020 6465 6620 7275  mand..    def ru
-00013b40: 6e5f 7870 6174 6828 7365 6c66 2c20 656c  n_xpath(self, el
-00013b50: 656d 293a 0a20 2020 2020 2020 2078 705f  em):.        xp_
-00013b60: 656c 656d 7320 3d20 656c 656d 2e78 7061  elems = elem.xpa
-00013b70: 7468 2873 656c 662e 7870 6174 6829 0a20  th(self.xpath). 
-00013b80: 2020 2020 2020 2069 6620 6e6f 7420 7870         if not xp
-00013b90: 5f65 6c65 6d73 3a0a 2020 2020 2020 2020  _elems:.        
-00013ba0: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
-00013bb0: 2020 2066 6f72 2078 705f 656c 656d 2069     for xp_elem i
-00013bc0: 6e20 7870 5f65 6c65 6d73 3a0a 2020 2020  n xp_elems:.    
-00013bd0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00013be0: 6465 6c65 7465 3a0a 2020 2020 2020 2020  delete:.        
-00013bf0: 2020 2020 2020 2020 7870 5f65 6c65 6d2e          xp_elem.
-00013c00: 6765 7470 6172 656e 7428 292e 7265 6d6f  getparent().remo
-00013c10: 7665 2878 705f 656c 656d 290a 2020 2020  ve(xp_elem).    
-00013c20: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00013c30: 726e 0a20 2020 2020 2020 2020 2020 2069  rn.            i
-00013c40: 6620 7365 6c66 2e68 746d 6c5f 636c 6173  f self.html_clas
-00013c50: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00013c60: 2020 2073 656c 662e 7570 6461 7465 5f63     self.update_c
-00013c70: 6c61 7373 2878 705f 656c 656d 2c20 7365  lass(xp_elem, se
-00013c80: 6c66 2e68 746d 6c5f 636c 6173 7329 0a20  lf.html_class). 
-00013c90: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00013ca0: 6f73 7472 696e 6720 3d20 4554 2e74 6f73  ostring = ET.tos
-00013cb0: 7472 696e 6728 7870 5f65 6c65 6d29 0a20  tring(xp_elem). 
-00013cc0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00013cd0: 6173 730a 0a20 2020 2023 2063 6c61 7373  ass..    # class
-00013ce0: 2041 6e6e 6f74 6174 6f72 436f 6d6d 616e   AnnotatorComman
-00013cf0: 640a 0a20 2020 2064 6566 2075 7064 6174  d..    def updat
-00013d00: 655f 636c 6173 7328 7365 6c66 2c20 656c  e_class(self, el
-00013d10: 656d 2c20 6874 6d6c 5f63 6c61 7373 293a  em, html_class):
-00013d20: 0a20 2020 2020 2020 2063 6c61 7373 6573  .        classes
-00013d30: 203d 205b 5d0a 2020 2020 2020 2020 4874   = [].        Ht
-00013d40: 6d6c 436c 6173 732e 7365 745f 636c 6173  mlClass.set_clas
-00013d50: 735f 6f6e 5f65 6c65 6d65 6e74 2865 6c65  s_on_element(ele
-00013d60: 6d2c 2068 746d 6c5f 636c 6173 7329 0a20  m, html_class). 
-00013d70: 2020 2020 2020 2069 6620 4661 6c73 653a         if False:
-00013d80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00013d90: 656c 656d 2e61 7474 7269 622e 6765 7428  elem.attrib.get(
-00013da0: 2263 6c61 7373 2229 3a0a 2020 2020 2020  "class"):.      
-00013db0: 2020 2020 2020 2020 2020 636c 6173 7365            classe
-00013dc0: 7320 3d20 656c 656d 2e61 7474 7269 625b  s = elem.attrib[
-00013dd0: 2263 6c61 7373 225d 2e73 706c 6974 2822  "class"].split("
-00013de0: 2022 290a 2020 2020 2020 2020 2020 2020   ").            
-00013df0: 6966 2068 746d 6c5f 636c 6173 7320 6e6f  if html_class no
-00013e00: 7420 696e 2063 6c61 7373 6573 3a0a 2020  t in classes:.  
-00013e10: 2020 2020 2020 2020 2020 2020 2020 636c                cl
-00013e20: 6173 7365 732e 6170 7065 6e64 2868 746d  asses.append(htm
-00013e30: 6c5f 636c 6173 7329 0a20 2020 2020 2020  l_class).       
-00013e40: 2020 2020 2020 2020 2065 6c65 6d2e 6174           elem.at
-00013e50: 7472 6962 5b22 636c 6173 7322 5d20 3d20  trib["class"] = 
-00013e60: 2220 222e 6a6f 696e 2863 6c61 7373 6573  " ".join(classes
-00013e70: 290a 0a20 2020 2064 6566 2072 756e 5f73  )..    def run_s
-00013e80: 7562 7363 7269 7074 2873 656c 662c 2073  ubscript(self, s
-00013e90: 7061 6e29 3a0a 2020 2020 2020 2020 6973  pan):.        is
-00013ea0: 5f73 7562 203d 2048 746d 6c55 7469 6c2e  _sub = HtmlUtil.
-00013eb0: 616e 6e6f 7461 7465 5f73 6372 6970 745f  annotate_script_
-00013ec0: 7479 7065 2873 7061 6e2c 2053 5363 7269  type(span, SScri
-00013ed0: 7074 2e53 5542 2c20 7964 6f77 6e3d 4661  pt.SUB, ydown=Fa
-00013ee0: 6c73 6529 0a20 2020 2020 2020 2069 6620  lse).        if 
-00013ef0: 6973 5f73 7562 3a0a 2020 2020 2020 2020  is_sub:.        
-00013f00: 2020 2020 7370 616e 2e61 7474 7269 625b      span.attrib[
-00013f10: 2274 6974 6c65 225d 203d 2022 7375 6273  "title"] = "subs
-00013f20: 6372 6970 745f 7b73 7061 6e2e 7465 7874  cript_{span.text
-00013f30: 7d22 0a20 2020 2020 2020 2020 2020 2070  }".            p
-00013f40: 7269 6e74 2866 2253 5542 207b 7370 616e  rint(f"SUB {span
-00013f50: 2e74 6578 747d 2229 0a0a 2020 2020 2320  .text}")..    # 
-00013f60: 636c 6173 7320 416e 6e6f 7461 746f 7243  class AnnotatorC
-00013f70: 6f6d 6d61 6e64 0a0a 2020 2020 6465 6620  ommand..    def 
-00013f80: 7275 6e5f 7375 7065 7273 6372 6970 7428  run_superscript(
-00013f90: 7365 6c66 2c20 7370 616e 293a 0a20 2020  self, span):.   
-00013fa0: 2020 2020 2069 735f 7375 7065 7220 3d20       is_super = 
-00013fb0: 4874 6d6c 5574 696c 2e61 6e6e 6f74 6174  HtmlUtil.annotat
-00013fc0: 655f 7363 7269 7074 5f74 7970 6528 7370  e_script_type(sp
-00013fd0: 616e 2c20 5353 6372 6970 742e 5355 502c  an, SScript.SUP,
-00013fe0: 2079 646f 776e 3d46 616c 7365 290a 2020   ydown=False).  
-00013ff0: 2020 2020 2020 6966 2069 735f 7375 7065        if is_supe
-00014000: 723a 0a20 2020 2020 2020 2020 2020 2073  r:.            s
-00014010: 7061 6e2e 6174 7472 6962 5b22 7469 746c  pan.attrib["titl
-00014020: 6522 5d20 3d20 6622 7375 7065 7273 6372  e"] = f"superscr
-00014030: 6970 745f 7b73 7061 6e2e 7465 7874 7d22  ipt_{span.text}"
-00014040: 0a0a 2020 2020 2320 636c 6173 7320 416e  ..    # class An
-00014050: 6e6f 7461 746f 7243 6f6d 6d61 6e64 0a0a  notatorCommand..
-00014060: 2020 2020 6465 6620 7275 6e5f 6772 6f75      def run_grou
-00014070: 705f 7870 6174 6828 7365 6c66 2c20 6368  p_xpath(self, ch
-00014080: 696c 645f 656c 656d 293a 0a20 2020 2020  ild_elem):.     
-00014090: 2020 2022 2222 6772 6f75 7020 666f 6c6c     """group foll
-000140a0: 6f77 696e 6720 7369 626c 696e 6773 206f  owing siblings o
-000140b0: 6620 656c 656d 2222 220a 0a20 2020 2020  f elem"""..     
-000140c0: 2020 2072 6573 756c 7420 3d20 4e6f 6e65     result = None
-000140d0: 0a20 2020 2020 2020 2069 6620 6368 696c  .        if chil
-000140e0: 645f 656c 656d 2069 7320 4e6f 6e65 3a0a  d_elem is None:.
-000140f0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00014100: 726e 204e 6f6e 650a 2020 2020 2020 2020  rn None.        
-00014110: 7061 7265 6e74 5f65 6c65 6d20 3d20 6368  parent_elem = ch
-00014120: 696c 645f 656c 656d 2e67 6574 7061 7265  ild_elem.getpare
-00014130: 6e74 2829 0a20 2020 2020 2020 2069 6620  nt().        if 
-00014140: 7061 7265 6e74 5f65 6c65 6d20 6973 204e  parent_elem is N
-00014150: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00014160: 2072 6574 7572 6e20 4e6f 6e65 0a20 2020   return None.   
-00014170: 2020 2020 2067 726f 7570 5f6c 6561 6473       group_leads
-00014180: 203d 2070 6172 656e 745f 656c 656d 2e78   = parent_elem.x
-00014190: 7061 7468 2873 656c 662e 6772 6f75 705f  path(self.group_
-000141a0: 7870 6174 6829 0a20 2020 2020 2020 2069  xpath).        i
-000141b0: 6620 6c65 6e28 6772 6f75 705f 6c65 6164  f len(group_lead
-000141c0: 7329 203e 2030 3a0a 2020 2020 2020 2020  s) > 0:.        
-000141d0: 2020 2020 7072 696e 7428 6622 6772 6f75      print(f"grou
-000141e0: 7020 6c65 6164 2063 6f75 6e74 207b 6c65  p lead count {le
-000141f0: 6e28 6772 6f75 705f 6c65 6164 7329 7d20  n(group_leads)} 
-00014200: 7b73 656c 662e 6772 6f75 705f 7870 6174  {self.group_xpat
-00014210: 687d 2229 0a20 2020 2020 2020 2065 6c73  h}").        els
-00014220: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
-00014230: 6173 730a 2020 2020 2020 2020 666f 7220  ass.        for 
-00014240: 692c 2067 726f 7570 5f6c 6561 6420 696e  i, group_lead in
-00014250: 2065 6e75 6d65 7261 7465 2867 726f 7570   enumerate(group
-00014260: 5f6c 6561 6473 293a 0a20 2020 2020 2020  _leads):.       
-00014270: 2020 2020 2023 2070 7269 6e74 2866 2267       # print(f"g
-00014280: 726f 7570 206c 6561 6420 7b45 542e 746f  roup lead {ET.to
-00014290: 7374 7269 6e67 2867 726f 7570 5f6c 6561  string(group_lea
-000142a0: 6429 7d22 290a 2020 2020 2020 2020 2020  d)}").          
-000142b0: 2020 2320 656e 645f 6772 6f75 6f20 3d20    # end_grouo = 
-000142c0: 6772 6f75 705f 6c65 6164 735b 6920 2b20  group_leads[i + 
-000142d0: 315d 2069 6620 6920 3c20 6c65 6e28 6772  1] if i < len(gr
-000142e0: 6f75 705f 6c65 6164 7329 202d 2031 2065  oup_leads) - 1 e
-000142f0: 6c73 6520 4e6f 6e65 0a20 2020 2020 2020  lse None.       
-00014300: 2020 2020 2073 656c 662e 6d61 6b65 5f67       self.make_g
-00014310: 726f 7570 2870 6172 656e 745f 656c 656d  roup(parent_elem
-00014320: 2c20 6772 6f75 705f 6c65 6164 290a 0a20  , group_lead).. 
-00014330: 2020 2023 2063 6c61 7373 2041 6e6e 6f74     # class Annot
-00014340: 6174 6f72 436f 6d6d 616e 640a 0a20 2020  atorCommand..   
-00014350: 2064 6566 206d 616b 655f 6772 6f75 7028   def make_group(
-00014360: 7365 6c66 2c20 656c 656d 2c20 6772 6f75  self, elem, grou
-00014370: 705f 6c65 6164 2c20 656e 645f 6772 6f75  p_lead, end_grou
-00014380: 703d 4e6f 6e65 293a 0a20 2020 2020 2020  p=None):.       
-00014390: 2070 6172 656e 7420 3d20 586d 6c4c 6962   parent = XmlLib
-000143a0: 2e67 6574 7061 7265 6e74 2865 6c65 6d2c  .getparent(elem,
-000143b0: 2064 6562 7567 3d54 7275 6529 0a20 2020   debug=True).   
-000143c0: 2020 2020 2069 6620 7061 7265 6e74 2069       if parent i
-000143d0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-000143e0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-000143f0: 7272 6f72 2822 6e75 6c6c 2070 6172 656e  rror("null paren
-00014400: 7422 290a 2020 2020 2020 2020 7369 626c  t").        sibl
-00014410: 696e 6773 203d 2067 726f 7570 5f6c 6561  ings = group_lea
-00014420: 642e 7870 6174 6828 2266 6f6c 6c6f 7769  d.xpath("followi
-00014430: 6e67 2d73 6962 6c69 6e67 3a3a 2a22 290a  ng-sibling::*").
-00014440: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
-00014450: 6962 6c69 6e67 7329 203d 3d20 303a 0a20  iblings) == 0:. 
-00014460: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00014470: 2866 226e 6f20 7369 626c 696e 6773 3a20  (f"no siblings: 
-00014480: 7b67 726f 7570 5f6c 6561 642e 7465 7874  {group_lead.text
-00014490: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-000144a0: 7061 7373 0a20 2020 2020 2020 2065 6c73  pass.        els
-000144b0: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
-000144c0: 7269 6e74 2866 2273 6962 6c69 6e67 7320  rint(f"siblings 
-000144d0: 7b6c 656e 2873 6962 6c69 6e67 7329 7d21  {len(siblings)}!
-000144e0: 2121 2229 0a20 2020 2020 2020 2064 6976  !!").        div
-000144f0: 203d 2045 542e 5375 6245 6c65 6d65 6e74   = ET.SubElement
-00014500: 2870 6172 656e 742c 2022 6469 7622 290a  (parent, "div").
-00014510: 2020 2020 2020 2020 6469 762e 6170 7065          div.appe
-00014520: 6e64 2867 726f 7570 5f6c 6561 6429 0a20  nd(group_lead). 
-00014530: 2020 2020 2020 2064 6976 2e61 7474 7269         div.attri
-00014540: 625b 2274 6974 6c65 225d 203d 2067 726f  b["title"] = gro
-00014550: 7570 5f6c 6561 642e 7465 7874 2069 6620  up_lead.text if 
-00014560: 6772 6f75 705f 6c65 6164 2e74 6578 7420  group_lead.text 
-00014570: 656c 7365 2022 3f22 0a20 2020 2020 2020  else "?".       
-00014580: 2064 6976 2e61 7474 7269 625b 2273 7479   div.attrib["sty
-00014590: 6c65 225d 203d 2022 626f 7264 6572 3a62  le"] = "border:b
-000145a0: 6c61 636b 2064 6173 6865 6420 3270 783b  lack dashed 2px;
-000145b0: 220a 2020 2020 2020 2020 7870 203d 2073  ".        xp = s
-000145c0: 656c 662e 656e 645f 7870 6174 680a 2020  elf.end_xpath.  
-000145d0: 2020 2020 2020 7870 203d 2022 7365 6c66        xp = "self
-000145e0: 3a3a 6469 765b 7370 616e 5b63 6f6e 7461  ::div[span[conta
-000145f0: 696e 7328 7465 7874 2829 2c27 454e 4427  ins(text(),'END'
-00014600: 295d 5d22 0a20 2020 2020 2020 2023 2070  )]]".        # p
-00014610: 7269 6e74 2866 2265 6e64 5f78 7061 7468  rint(f"end_xpath
-00014620: 207b 7870 7d22 290a 2020 2020 2020 2020   {xp}").        
-00014630: 666f 7220 7369 626c 696e 6720 696e 2073  for sibling in s
-00014640: 6962 6c69 6e67 733a 0a20 2020 2020 2020  iblings:.       
-00014650: 2020 2020 2070 7269 6e74 2866 2273 6962       print(f"sib
-00014660: 6c69 6e67 3a20 7b27 272e 6a6f 696e 2873  ling: {''.join(s
-00014670: 6962 6c69 6e67 2e69 7465 7274 6578 7428  ibling.itertext(
-00014680: 2929 7d22 290a 2020 2020 2020 2020 2020  ))}").          
-00014690: 2020 656e 645f 7369 6220 3d20 4e6f 6e65    end_sib = None
-000146a0: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
-000146b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000146c0: 2020 656e 645f 7369 6220 3d20 7369 626c    end_sib = sibl
-000146d0: 696e 672e 7870 6174 6828 7870 290a 2020  ing.xpath(xp).  
-000146e0: 2020 2020 2020 2020 2020 6578 6365 7074            except
-000146f0: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
-00014700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014710: 2070 7269 6e74 2866 2266 6169 6c65 6420   print(f"failed 
-00014720: 7870 6174 6820 7b78 707d 207b 657d 2229  xpath {xp} {e}")
-00014730: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00014740: 656e 645f 7369 6220 616e 6420 6c65 6e28  end_sib and len(
-00014750: 656e 645f 7369 6229 203e 2030 3a0a 2020  end_sib) > 0:.  
-00014760: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00014770: 6966 2073 6962 6c69 6e67 2021 3d20 656e  if sibling != en
-00014780: 645f 6772 6f75 703a 0a20 2020 2020 2020  d_group:.       
-00014790: 2020 2020 2020 2020 2023 2020 2020 2070           #     p
-000147a0: 7269 6e74 2866 2273 6962 6c69 6e67 207b  rint(f"sibling {
-000147b0: 7369 626c 696e 677d 2229 0a20 2020 2020  sibling}").     
-000147c0: 2020 2020 2020 2020 2020 2062 7265 616b             break
-000147d0: 0a20 2020 2020 2020 2020 2020 2064 6976  .            div
-000147e0: 2e61 7070 656e 6428 7369 626c 696e 6729  .append(sibling)
-000147f0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00014800: 6469 760a 0a20 2020 2023 2063 6c61 7373  div..    # class
-00014810: 2041 6e6e 6f74 6174 6f72 436f 6d6d 616e   AnnotatorComman
-00014820: 640a 0a20 2020 2064 6566 2072 756e 5f65  d..    def run_e
-00014830: 7874 7261 6374 2873 656c 662c 2065 6c65  xtract(self, ele
-00014840: 6d29 3a0a 0a20 2020 2020 2020 2022 2222  m):..        """
-00014850: 6578 7472 6163 7420 6772 6f75 702e 206f  extract group. o
-00014860: 7074 696e 616c 6c79 2077 7269 7465 2074  ptinally write t
-00014870: 6f20 6669 6c65 2e20 6375 7272 656e 746c  o file. currentl
-00014880: 7920 4e4f 2d4f 5022 2222 0a20 2020 2020  y NO-OP""".     
-00014890: 2020 2070 7269 6e74 2866 2272 756e 5f65     print(f"run_e
-000148a0: 7874 7261 6374 2069 7320 4e4f 2d4f 5022  xtract is NO-OP"
-000148b0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-000148c0: 204e 6f6e 650a 0a20 2020 2023 2063 6c61   None..    # cla
-000148d0: 7373 2041 6e6e 6f74 6174 6f72 436f 6d6d  ss AnnotatorComm
-000148e0: 616e 640a 0a20 2020 2064 6566 2072 656d  and..    def rem
-000148f0: 6f76 655f 656c 656d 2873 656c 662c 2065  ove_elem(self, e
-00014900: 6c65 6d2c 2064 6562 7567 3d46 616c 7365  lem, debug=False
-00014910: 293a 0a20 2020 2020 2020 2069 6620 656c  ):.        if el
-00014920: 656d 2069 7320 4e6f 6e65 3a0a 2020 2020  em is None:.    
-00014930: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
-00014940: 2020 2020 2020 2070 6172 656e 7420 3d20         parent = 
-00014950: 656c 656d 2e67 6574 7061 7265 6e74 2829  elem.getparent()
-00014960: 0a20 2020 2020 2020 2069 6620 7061 7265  .        if pare
-00014970: 6e74 2069 7320 4e6f 6e65 3a0a 2020 2020  nt is None:.    
-00014980: 2020 2020 2020 2020 6966 2064 6562 7567          if debug
-00014990: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000149a0: 2020 7072 696e 7428 6622 656c 656d 656e    print(f"elemen
-000149b0: 7420 7b65 6c65 6d7d 2068 6173 206e 6f20  t {elem} has no 
-000149c0: 7061 7265 6e74 2229 0a20 2020 2020 2020  parent").       
-000149d0: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
-000149e0: 2020 2020 7061 7265 6e74 2e72 656d 6f76      parent.remov
-000149f0: 6528 656c 656d 290a 0a0a 5354 594c 455f  e(elem)...STYLE_
-00014a00: 4355 524c 595f 5245 203d 2072 652e 636f  CURLY_RE = re.co
-00014a10: 6d70 696c 6528 2228 3f50 3c70 7265 3e2e  mpile("(?P<pre>.
-00014a20: 2a29 7b28 3f50 3c76 616c 7565 3e5b 5e7d  *){(?P<value>[^}
-00014a30: 5d2a 297d 283f 503c 706f 7374 3e2e 2a29  ]*)}(?P<post>.*)
-00014a40: 2229 0a0a 0a63 6c61 7373 2048 746d 6c53  ")...class HtmlS
-00014a50: 7479 6c65 3a0a 2020 2020 2222 220a 2020  tyle:.    """.  
-00014a60: 2020 6d65 7468 6f64 7320 746f 2070 726f    methods to pro
-00014a70: 6365 7373 2073 7479 6c65 2061 7474 7269  cess style attri
-00014a80: 6275 7465 7320 616e 6420 3c73 7479 6c65  butes and <style
-00014a90: 3e20 656c 656d 656e 7473 0a20 2020 206e  > elements.    n
-00014aa0: 6f20 696e 7374 616e 6365 2064 6174 610a  o instance data.
-00014ab0: 2020 2020 2222 220a 0a20 2020 2064 6566      """..    def
-00014ac0: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
-00014ad0: 6373 735f 7374 7269 6e67 3d4e 6f6e 6529  css_string=None)
-00014ae0: 3a0a 2020 2020 2020 2020 7365 6c66 2e63  :.        self.c
-00014af0: 7373 5f73 7472 696e 6720 3d20 6373 735f  ss_string = css_
-00014b00: 7374 7269 6e67 0a0a 2020 2020 4063 6c61  string..    @cla
-00014b10: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-00014b20: 2067 6574 5f63 7373 7374 796c 655f 7374   get_cssstyle_st
-00014b30: 7269 6e67 2863 6c73 2c20 656c 656d 293a  ring(cls, elem):
-00014b40: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00014b50: 2020 2020 2063 6f6e 7665 6e69 656e 6365       convenience
-00014b60: 206d 6574 686f 6420 746f 2067 6574 2065   method to get e
-00014b70: 6c65 6d65 6e74 2073 7479 6c65 0a20 2020  lement style.   
-00014b80: 2020 2020 203a 7061 7261 6d20 656c 656d       :param elem
-00014b90: 3a20 746f 2067 6574 2073 7479 6c65 2066  : to get style f
-00014ba0: 726f 6d0a 2020 2020 2020 2020 3a72 6574  rom.        :ret
-00014bb0: 7572 6e3a 2073 7479 6c65 206f 7220 4e6f  urn: style or No
-00014bc0: 6e65 0a20 2020 2020 2020 2022 2222 0a20  ne.        """. 
-00014bd0: 2020 2020 2020 2072 6574 7572 6e20 656c         return el
-00014be0: 656d 2e61 7474 7269 622e 6765 7428 2273  em.attrib.get("s
-00014bf0: 7479 6c65 2229 0a0a 2020 2020 2320 636c  tyle")..    # cl
-00014c00: 6173 7320 4874 6d6c 5374 796c 650a 0a20  ass HtmlStyle.. 
-00014c10: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-00014c20: 2020 2020 6465 6620 7365 745f 7374 796c      def set_styl
-00014c30: 6528 636c 732c 2065 6c65 6d2c 2076 616c  e(cls, elem, val
-00014c40: 7565 293a 0a20 2020 2020 2020 2022 2222  ue):.        """
-00014c50: 0a20 2020 2020 2020 2063 6f6e 7665 6e69  .        conveni
-00014c60: 656e 6365 206d 6574 686f 6420 746f 2073  ence method to s
-00014c70: 6574 2073 7479 6c65 206f 6e20 656c 656d  et style on elem
-00014c80: 656e 740a 2020 2020 2020 2020 3a70 6172  ent.        :par
-00014c90: 616d 2065 6c65 6d3a 656c 656d 656e 7420  am elem:element 
-00014ca0: 746f 2073 6574 2073 7479 6c65 206f 6e0a  to set style on.
-00014cb0: 2020 2020 2020 2020 3a70 6172 616d 2076          :param v
-00014cc0: 616c 7565 3a20 6373 7320 7374 7269 6e67  alue: css string
-00014cd0: 3b20 6966 2022 2220 6f72 204e 6f6e 6520  ; if "" or None 
-00014ce0: 7265 6d6c 7665 7320 6174 7472 6962 7574  remlves attribut
-00014cf0: 650a 2020 2020 2020 2020 2222 220a 2020  e.        """.  
-00014d00: 2020 2020 2020 6966 2065 6c65 6d20 6973        if elem is
-00014d10: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00014d20: 2020 2020 2020 2058 6d6c 4c69 622e 7365         XmlLib.se
-00014d30: 745f 6174 746e 616d 655f 7661 6c75 6528  t_attname_value(
-00014d40: 656c 656d 2c20 2273 7479 6c65 222c 2076  elem, "style", v
-00014d50: 616c 7565 290a 0a20 2020 2023 2063 6c61  alue)..    # cla
-00014d60: 7373 2048 746d 6c53 7479 6c65 0a0a 2020  ss HtmlStyle..  
-00014d70: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-00014d80: 2020 2064 6566 2065 7874 7261 6374 5f61     def extract_a
-00014d90: 6c6c 5f73 7479 6c65 5f61 7474 7269 6275  ll_style_attribu
-00014da0: 7465 735f 746f 5f68 6561 6428 636c 732c  tes_to_head(cls,
-00014db0: 2068 746d 6c5f 656c 656d 293a 0a20 2020   html_elem):.   
-00014dc0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00014dd0: 2046 696e 6473 2061 6c6c 2065 6c65 6d65   Finds all eleme
-00014de0: 6e74 7320 7769 7468 2040 7374 796c 6520  nts with @style 
-00014df0: 6174 7472 6962 7574 6520 616e 6420 6578  attribute and ex
-00014e00: 7461 6374 7320 7468 6520 7464 7874 2073  tacts the tdxt s
-00014e10: 7479 6c65 7320 746f 203c 6865 6164 3e0a  tyles to <head>.
-00014e20: 2020 2020 2020 2020 416c 736f 2073 6574          Also set
-00014e30: 7320 626f 6479 2073 7479 6c65 7320 746f  s body styles to
-00014e40: 206e 6f72 6d61 6c0a 2020 2020 2020 2020   normal.        
-00014e50: 3a70 6172 616d 2068 746d 6c5f 656c 656d  :param html_elem
-00014e60: 3a20 746f 7461 6c20 6874 6d6c 206f 626a  : total html obj
-00014e70: 6563 7420 746f 206e 6f72 6d61 6c69 7a65  ect to normalize
-00014e80: 2e20 4d75 7374 2068 6176 6520 3c68 6561  . Must have <hea
-00014e90: 643e 2061 6e64 203c 626f 6479 3e0a 2020  d> and <body>.  
-00014ea0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00014eb0: 2020 4874 6d6c 5374 796c 652e 7265 6d6f    HtmlStyle.remo
-00014ec0: 7665 5f65 6d70 7479 5f73 7479 6c65 7328  ve_empty_styles(
-00014ed0: 6874 6d6c 5f65 6c65 6d29 0a20 2020 2020  html_elem).     
-00014ee0: 2020 2073 7479 6c65 645f 656c 656d 7320     styled_elems 
-00014ef0: 3d20 6874 6d6c 5f65 6c65 6d2e 7870 6174  = html_elem.xpat
-00014f00: 6828 222e 2f2f 2a5b 4073 7479 6c65 5d22  h(".//*[@style]"
-00014f10: 290a 2020 2020 2020 2020 666f 7220 692c  ).        for i,
-00014f20: 2073 7479 6c65 645f 656c 656d 2069 6e20   styled_elem in 
-00014f30: 656e 756d 6572 6174 6528 7374 796c 6564  enumerate(styled
-00014f40: 5f65 6c65 6d73 293a 0a20 2020 2020 2020  _elems):.       
-00014f50: 2020 2020 2063 6c61 7373 7265 6620 3d20       classref = 
-00014f60: 6622 737b 697d 220a 2020 2020 2020 2020  f"s{i}".        
-00014f70: 2020 2020 4874 6d6c 5374 796c 652e 6164      HtmlStyle.ad
-00014f80: 645f 656c 656d 656e 745f 7769 7468 5f73  d_element_with_s
-00014f90: 7479 6c65 2863 6c61 7373 7265 662c 2068  tyle(classref, h
-00014fa0: 746d 6c5f 656c 656d 2c20 7374 796c 6564  tml_elem, styled
-00014fb0: 5f65 6c65 6d29 0a20 2020 2020 2020 2023  _elem).        #
-00014fc0: 2064 6f65 7320 7468 6973 2064 6f20 616e   does this do an
-00014fd0: 7974 6869 6e67 3f3f 3f0a 2020 2020 2020  ything???.      
-00014fe0: 2020 626f 6479 203d 2068 746d 6c5f 656c    body = html_el
-00014ff0: 656d 2e78 7061 7468 2822 2f68 746d 6c2f  em.xpath("/html/
-00015000: 626f 6479 2229 0a20 2020 2020 2020 2069  body").        i
-00015010: 6620 6c65 6e28 626f 6479 2920 213d 2031  f len(body) != 1
-00015020: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-00015030: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
-00015040: 2264 6f63 756d 656e 7420 7368 6f75 6c64  "document should
-00015050: 2068 6176 6520 6578 6163 746c 7920 3120   have exactly 1 
-00015060: 626f 6479 2074 6167 2229 0a20 2020 2020  body tag").     
-00015070: 2020 2073 7479 6c65 203d 2043 5353 5374     style = CSSSt
-00015080: 796c 6528 290a 2020 2020 2020 2020 7374  yle().        st
-00015090: 796c 652e 6372 6561 7465 5f63 7373 5f73  yle.create_css_s
-000150a0: 7479 6c65 5f66 726f 6d5f 6373 735f 7374  tyle_from_css_st
-000150b0: 7269 6e67 280a 2020 2020 2020 2020 2020  ring(.          
-000150c0: 2020 2266 6f6e 742d 7374 796c 653a 206e    "font-style: n
-000150d0: 6f72 6d61 6c3b 2022 0a20 2020 2020 2020  ormal; ".       
-000150e0: 2020 2020 2022 666f 6e74 2d77 6569 6768       "font-weigh
-000150f0: 743a 206e 6f72 6d61 6c3b 2022 0a20 2020  t: normal; ".   
-00015100: 2020 2020 2020 2020 2022 666f 6e74 2d73           "font-s
-00015110: 7472 6574 6368 6564 3a20 6e6f 726d 616c  tretched: normal
-00015120: 3b20 220a 2020 2020 2020 2020 2020 2020  ; ".            
-00015130: 226f 7061 6369 7479 3a20 313b 2022 0a20  "opacity: 1; ". 
-00015140: 2020 2020 2020 2020 2020 2022 636f 6c6f             "colo
-00015150: 723a 2062 6c61 636b 3b22 0a20 2020 2020  r: black;".     
-00015160: 2020 2029 0a0a 2020 2020 2320 636c 6173     )..    # clas
-00015170: 7320 4874 6d6c 5374 796c 650a 0a20 2020  s HtmlStyle..   
-00015180: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-00015190: 2020 6465 6620 6164 645f 656c 656d 656e    def add_elemen
-000151a0: 745f 7769 7468 5f73 7479 6c65 2863 6c73  t_with_style(cls
-000151b0: 2c20 636c 6173 7372 6566 2c20 6874 6d6c  , classref, html
-000151c0: 5f65 6c65 6d2c 2073 7479 6c65 645f 656c  _elem, styled_el
-000151d0: 656d 293a 0a20 2020 2020 2020 2022 2222  em):.        """
-000151e0: 0a20 2020 2020 2020 2061 6464 730a 2020  .        adds.  
-000151f0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00015200: 2020 6865 6164 203d 2068 746d 6c5f 656c    head = html_el
-00015210: 656d 2e78 7061 7468 2822 2f68 746d 6c2f  em.xpath("/html/
-00015220: 6865 6164 2229 5b30 5d0a 2020 2020 2020  head")[0].      
-00015230: 2020 656c 656d 5f73 7479 6c65 203d 2048    elem_style = H
-00015240: 746d 6c53 7479 6c65 2e67 6574 5f63 7373  tmlStyle.get_css
-00015250: 7374 796c 655f 7374 7269 6e67 2873 7479  style_string(sty
-00015260: 6c65 645f 656c 656d 290a 2020 2020 2020  led_elem).      
-00015270: 2020 6966 2065 6c65 6d5f 7374 796c 6520    if elem_style 
-00015280: 6973 204e 6f6e 6520 6f72 2065 6c65 6d5f  is None or elem_
-00015290: 7374 796c 6520 3d3d 2022 223a 0a20 2020  style == "":.   
-000152a0: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
-000152b0: 2020 2020 2020 2020 6373 7320 3d20 4353          css = CS
-000152c0: 5353 7479 6c65 2e63 7265 6174 655f 6373  SStyle.create_cs
-000152d0: 735f 7374 796c 655f 6672 6f6d 5f63 7373  s_style_from_css
-000152e0: 5f73 7472 696e 6728 656c 656d 5f73 7479  _string(elem_sty
-000152f0: 6c65 290a 2020 2020 2020 2020 6966 2063  le).        if c
-00015300: 7373 2069 7320 4e6f 6e65 3a0a 2020 2020  ss is None:.    
-00015310: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00015320: 6c75 6545 7272 6f72 2866 2263 7373 2069  lueError(f"css i
-00015330: 7320 4e6f 6e65 2229 0a0a 2020 2020 2020  s None")..      
-00015340: 2020 6578 7472 6163 7465 645f 7374 796c    extracted_styl
-00015350: 655f 656c 656d 2c20 7265 6d61 696e 696e  e_elem, remainin
-00015360: 675f 7374 796c 652c 206e 6577 5f63 6c61  g_style, new_cla
-00015370: 7373 203d 2063 7373 2e65 7874 7261 6374  ss = css.extract
-00015380: 5f74 6578 745f 7374 796c 6573 5f69 6e74  _text_styles_int
-00015390: 6f5f 636c 6173 7328 636c 6173 7372 6566  o_class(classref
-000153a0: 290a 2020 2020 2020 2020 6966 2065 7874  ).        if ext
-000153b0: 7261 6374 6564 5f73 7479 6c65 5f65 6c65  racted_style_ele
-000153c0: 6d20 6973 206e 6f74 204e 6f6e 653a 0a20  m is not None:. 
-000153d0: 2020 2020 2020 2020 2020 2048 746d 6c53             HtmlS
-000153e0: 7479 6c65 2e73 6574 5f73 7479 6c65 2873  tyle.set_style(s
-000153f0: 7479 6c65 645f 656c 656d 2c20 7265 6d61  tyled_elem, rema
-00015400: 696e 696e 675f 7374 796c 6529 0a20 2020  ining_style).   
-00015410: 2020 2020 2020 2020 2048 746d 6c43 6c61           HtmlCla
-00015420: 7373 2e73 6574 5f63 6c61 7373 5f6f 6e5f  ss.set_class_on_
-00015430: 656c 656d 656e 7428 7374 796c 6564 5f65  element(styled_e
-00015440: 6c65 6d2c 2063 6c61 7373 7265 662c 2072  lem, classref, r
-00015450: 6570 6c61 6365 3d46 616c 7365 290a 2020  eplace=False).  
-00015460: 2020 2020 2020 2020 2020 6865 6164 2e61            head.a
-00015470: 7070 656e 6428 6578 7472 6163 7465 645f  ppend(extracted_
-00015480: 7374 796c 655f 656c 656d 290a 0a20 2020  style_elem)..   
-00015490: 2023 2063 6c61 7373 2048 746d 6c53 7479   # class HtmlSty
-000154a0: 6c65 0a0a 2020 2020 4063 6c61 7373 6d65  le..    @classme
-000154b0: 7468 6f64 0a20 2020 2064 6566 2072 656d  thod.    def rem
-000154c0: 6f76 655f 656d 7074 795f 7374 796c 6573  ove_empty_styles
-000154d0: 2863 6c73 2c20 6874 6d6c 5f65 6c65 6d29  (cls, html_elem)
-000154e0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-000154f0: 2020 2020 2020 7265 6d6f 7665 7320 616c        removes al
-00015500: 6c20 656d 7074 7920 7374 796c 6520 6174  l empty style at
-00015510: 7472 6962 7574 6573 2028 7374 796c 653d  tributes (style=
-00015520: 2222 290a 2020 2020 2020 2020 2222 220a  "").        """.
-00015530: 2020 2020 2020 2020 656d 7074 795f 7374          empty_st
-00015540: 796c 6564 5f65 6c65 6d73 203d 2068 746d  yled_elems = htm
-00015550: 6c5f 656c 656d 2e78 7061 7468 2822 2e2f  l_elem.xpath("./
-00015560: 2f2a 5b6e 6f72 6d61 6c69 7a65 2d73 7061  /*[normalize-spa
-00015570: 6365 2840 7374 796c 6529 3d27 275d 2229  ce(@style)='']")
-00015580: 0a20 2020 2020 2020 2066 6f72 2065 6c65  .        for ele
-00015590: 6d20 696e 2065 6d70 7479 5f73 7479 6c65  m in empty_style
-000155a0: 645f 656c 656d 733a 0a20 2020 2020 2020  d_elems:.       
-000155b0: 2020 2020 2048 746d 6c53 7479 6c65 2e64       HtmlStyle.d
-000155c0: 656c 6574 655f 7374 796c 6528 656c 656d  elete_style(elem
-000155d0: 290a 0a20 2020 2023 2063 6c61 7373 2048  )..    # class H
-000155e0: 746d 6c53 7479 6c65 0a0a 2020 2020 4063  tmlStyle..    @c
-000155f0: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-00015600: 6566 2064 656c 6574 655f 7374 796c 6528  ef delete_style(
-00015610: 636c 732c 2065 6c65 6d29 3a0a 2020 2020  cls, elem):.    
-00015620: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00015630: 636f 6e76 656e 6965 6e6e 6365 206d 6574  conveniennce met
-00015640: 686f 6420 746f 2064 656c 6574 6520 7374  hod to delete st
-00015650: 796c 6520 6174 7472 6962 7574 650a 2020  yle attribute.  
-00015660: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00015670: 2020 586d 6c4c 6962 2e72 656d 6f76 655f    XmlLib.remove_
-00015680: 6174 7472 6962 7574 6528 656c 656d 2c20  attribute(elem, 
-00015690: 2273 7479 6c65 2229 0a0a 2020 2020 2320  "style")..    # 
-000156a0: 5448 4553 4520 4341 4e20 4245 434f 4d45  THESE CAN BECOME
-000156b0: 2049 4e53 5441 4e43 4520 4d45 5448 4f44   INSTANCE METHOD
-000156c0: 530a 0a20 2020 2023 2063 6c61 7373 2048  S..    # class H
-000156d0: 746d 6c53 7479 6c65 0a0a 2020 2020 4063  tmlStyle..    @c
-000156e0: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-000156f0: 6566 206e 6f72 6d61 6c69 7a65 5f68 6561  ef normalize_hea
-00015700: 645f 7374 796c 6573 2863 6c73 2c20 656c  d_styles(cls, el
-00015710: 656d 2c20 6974 616c 6963 5f62 6f6c 643d  em, italic_bold=
-00015720: 5472 7565 2c20 6f75 7464 6972 3d4e 6f6e  True, outdir=Non
-00015730: 6529 3a0a 2020 2020 2020 2020 2222 220a  e):.        """.
-00015740: 2020 2020 2020 2020 6372 6561 7465 7320          creates 
-00015750: 6d75 6c74 6964 6963 7420 666f 7420 6865  multidict fot he
-00015760: 6164 2073 7479 6c65 730a 2020 2020 2020  ad styles.      
-00015770: 2020 3a70 6172 616d 2065 6c65 6d3a 2064    :param elem: d
-00015780: 6f63 756d 656e 7420 746f 2061 6e61 6c79  ocument to analy
-00015790: 7365 0a20 2020 2020 2020 203a 7265 7475  se.        :retu
-000157a0: 726e 3a20 6469 6374 206f 6620 636c 6173  rn: dict of clas
-000157b0: 7372 6566 5f73 6574 7320 696e 6465 7865  sref_sets indexe
-000157c0: 6420 6279 2073 7479 6c65 2073 7472 696e  d by style strin
-000157d0: 6773 0a0a 2020 2020 2020 2020 652e 672e  gs..        e.g.
-000157e0: 2069 7465 6d20 7b66 6f6e 742d 6661 6d69   item {font-fami
-000157f0: 6c79 3a20 5469 6d65 734e 6577 526f 6d61  ly: TimesNewRoma
-00015800: 6e50 534d 543b 2066 6f6e 742d 7369 7a65  nPSMT; font-size
-00015810: 3a20 3670 783b 7d3a 205b 272e 7331 3727  : 6px;}: ['.s17'
-00015820: 2c20 272e 7331 3927 2c20 272e 7332 3127  , '.s19', '.s21'
-00015830: 2c20 272e 7332 3727 2c20 272e 7335 272c  , '.s27', '.s5',
-00015840: 2027 2e73 3727 5d0a 2020 2020 2020 2020   '.s7'].        
-00015850: 2222 220a 2020 2020 2020 2020 7374 796c  """.        styl
-00015860: 655f 746f 5f63 6c61 7373 7265 665f 7365  e_to_classref_se
-00015870: 7420 3d20 6465 6661 756c 7464 6963 7428  t = defaultdict(
-00015880: 7365 7429 0a20 2020 2020 2020 2068 6561  set).        hea
-00015890: 645f 7374 796c 6573 203d 2048 746d 6c53  d_styles = HtmlS
-000158a0: 7479 6c65 2e67 6574 5f68 6561 645f 7374  tyle.get_head_st
-000158b0: 796c 6573 2865 6c65 6d29 0a20 2020 2020  yles(elem).     
-000158c0: 2020 2023 2077 6520 7573 6520 6f6e 6520     # we use one 
-000158d0: 636c 6173 7372 6566 202d 2073 7479 6c65  classref - style
-000158e0: 2070 6572 2048 544d 4c20 7374 796c 650a   per HTML style.
-000158f0: 2020 2020 2020 2020 666f 7220 6874 6d6c          for html
-00015900: 5f73 7479 6c65 2069 6e20 6865 6164 5f73  _style in head_s
-00015910: 7479 6c65 733a 0a20 2020 2020 2020 2020  tyles:.         
-00015920: 2020 2023 2063 6f6e 7369 7374 7320 6f66     # consists of
-00015930: 2063 6c61 7373 7265 6620 736e 6420 7374   classref snd st
-00015940: 796c 655f 7374 7269 6e67 0a20 2020 2020  yle_string.     
-00015950: 2020 2020 2020 2063 6c61 7373 7265 662c         classref,
-00015960: 2073 7479 6c65 5f73 203d 2063 6c73 2e65   style_s = cls.e
-00015970: 7874 7261 6374 5f63 6c61 7373 7265 665f  xtract_classref_
-00015980: 616e 645f 6373 7373 7472 696e 675f 6672  and_cssstring_fr
-00015990: 6f6d 5f68 746d 6c5f 7374 796c 6528 6874  om_html_style(ht
-000159a0: 6d6c 5f73 7479 6c65 290a 2020 2020 2020  ml_style).      
-000159b0: 2020 2020 2020 7374 796c 655f 7661 6c75        style_valu
-000159c0: 6520 3d20 7374 796c 655f 730a 2020 2020  e = style_s.    
-000159d0: 2020 2020 2020 2020 6966 2069 7461 6c69          if itali
-000159e0: 635f 626f 6c64 3a0a 2020 2020 2020 2020  c_bold:.        
-000159f0: 2020 2020 2020 2020 6e65 775f 6373 735f          new_css_
-00015a00: 7320 3d20 416d 6946 6f6e 742e 6372 6561  s = AmiFont.crea
-00015a10: 7465 5f66 6f6e 745f 6564 6974 6564 5f73  te_font_edited_s
-00015a20: 7479 6c65 5f66 726f 6d5f 6373 735f 7374  tyle_from_css_st
-00015a30: 796c 655f 6f62 6a65 6374 2873 7479 6c65  yle_object(style
-00015a40: 5f73 290a 2020 2020 2020 2020 2020 2020  _s).            
-00015a50: 2020 2020 6373 735f 7374 796c 6520 3d20      css_style = 
-00015a60: 4353 5353 7479 6c65 2e63 7265 6174 655f  CSSStyle.create_
-00015a70: 6373 735f 7374 796c 655f 6672 6f6d 5f63  css_style_from_c
-00015a80: 7373 5f73 7472 696e 6728 6e65 775f 6373  ss_string(new_cs
-00015a90: 735f 7329 0a20 2020 2020 2020 2020 2020  s_s).           
-00015aa0: 2020 2020 2069 6620 6373 735f 7374 796c       if css_styl
-00015ab0: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
-00015ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015ad0: 2020 2063 7373 5f73 7479 6c65 2e65 7874     css_style.ext
-00015ae0: 7261 6374 5f62 6f6c 645f 6974 616c 6963  ract_bold_italic
-00015af0: 5f66 726f 6d5f 666f 6e74 5f66 616d 696c  _from_font_famil
-00015b00: 7928 290a 2020 2020 2020 2020 2020 2020  y().            
-00015b10: 2020 2020 2020 2020 7374 796c 655f 7661          style_va
-00015b20: 6c75 6520 3d20 6373 735f 7374 796c 652e  lue = css_style.
-00015b30: 6765 745f 6373 735f 7661 6c75 6528 7772  get_css_value(wr
-00015b40: 6170 5f77 6974 685f 6375 726c 793d 5472  ap_with_curly=Tr
-00015b50: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-00015b60: 2020 2020 2020 2020 4874 6d6c 5374 796c          HtmlStyl
-00015b70: 652e 7265 706c 6163 655f 6375 726c 7928  e.replace_curly(
-00015b80: 6874 6d6c 5f73 7479 6c65 2c20 7374 796c  html_style, styl
-00015b90: 655f 7661 6c75 6529 0a20 2020 2020 2020  e_value).       
-00015ba0: 2020 2020 2068 746d 6c5f 7374 796c 652e       html_style.
-00015bb0: 6174 7472 6962 5b43 4c41 5353 5245 465d  attrib[CLASSREF]
-00015bc0: 203d 2063 6c61 7373 7265 660a 2020 2020   = classref.    
-00015bd0: 2020 2020 2020 2020 7374 796c 655f 746f          style_to
-00015be0: 5f63 6c61 7373 7265 665f 7365 745b 7374  _classref_set[st
-00015bf0: 796c 655f 7661 6c75 655d 2e61 6464 2863  yle_value].add(c
-00015c00: 6c61 7373 7265 6629 0a20 2020 2020 2020  lassref).       
-00015c10: 2069 6620 6f75 7464 6972 3a0a 2020 2020   if outdir:.    
-00015c20: 2020 2020 2020 2020 4874 6d6c 4c69 622e          HtmlLib.
-00015c30: 7772 6974 655f 6874 6d6c 5f66 696c 6528  write_html_file(
-00015c40: 656c 656d 2c20 5061 7468 286f 7574 6469  elem, Path(outdi
-00015c50: 722c 2022 6e6f 726d 616c 697a 6564 2e68  r, "normalized.h
-00015c60: 746d 6c22 2929 0a20 2020 2020 2020 2072  tml")).        r
-00015c70: 6574 7572 6e20 7374 796c 655f 746f 5f63  eturn style_to_c
-00015c80: 6c61 7373 7265 665f 7365 740a 0a20 2020  lassref_set..   
-00015c90: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-00015ca0: 2020 6465 6620 6765 745f 6865 6164 5f73    def get_head_s
-00015cb0: 7479 6c65 7328 636c 732c 2065 6c65 6d29  tyles(cls, elem)
-00015cc0: 3a0a 2020 2020 2020 2020 2222 2267 6574  :.        """get
-00015cd0: 2061 6c6c 203c 7374 796c 653e 2065 6c65   all <style> ele
-00015ce0: 6d65 6e74 7320 6666 726f 6d20 3c68 6561  ments ffrom <hea
-00015cf0: 643e 0a20 2020 2020 2020 203a 7061 7461  d>.        :pata
-00015d00: 6d20 656c 656d 3a20 6874 6d6c 2065 6c65  m elem: html ele
-00015d10: 6d6e 656e 7420 746f 2073 6561 7263 680a  mnent to search.
-00015d20: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
-00015d30: 2073 7479 6c65 2065 6c65 6d65 6e74 7320   style elements 
-00015d40: 656c 7365 205b 5d20 6966 2065 6c65 6d20  else [] if elem 
-00015d50: 6973 204e 6f6e 650a 2020 2020 2020 2020  is None.        
-00015d60: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-00015d70: 726e 205b 5d20 6966 2065 6c65 6d20 6973  rn [] if elem is
-00015d80: 204e 6f6e 6520 656c 7365 2065 6c65 6d2e   None else elem.
-00015d90: 7870 6174 6828 222f 6874 6d6c 2f68 6561  xpath("/html/hea
-00015da0: 642f 7374 796c 6522 290a 0a20 2020 2040  d/style")..    @
-00015db0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-00015dc0: 6465 6620 6578 7472 6163 745f 636c 6173  def extract_clas
-00015dd0: 7372 6566 5f61 6e64 5f63 7373 7374 7269  sref_and_cssstri
-00015de0: 6e67 5f66 726f 6d5f 7374 796c 655f 7465  ng_from_style_te
-00015df0: 7874 2863 6c73 2c20 6874 6d6c 5f73 7479  xt(cls, html_sty
-00015e00: 6c65 5f73 7472 696e 6729 3a0a 2020 2020  le_string):.    
-00015e10: 2020 2020 2222 2270 6172 7365 7320 7465      """parses te
-00015e20: 7874 2069 6e20 6874 6d6c 203c 7374 796c  xt in html <styl
-00015e30: 653e 2069 6e74 6f20 636c 6173 7372 6566  e> into classref
-00015e40: 2061 6e64 2063 7373 7374 7269 6e67 0a20   and cssstring. 
-00015e50: 2020 2020 2020 206f 6e6c 7920 6f6e 6520         only one 
-00015e60: 7374 796c 6520 7065 7220 6874 6d6c 2065  style per html e
-00015e70: 6c65 6d65 6e74 0a20 2020 2020 2020 203a  lement.        :
-00015e80: 7061 7261 6d20 6874 6d6c 5f73 7479 6c65  param html_style
-00015e90: 5f73 7472 696e 673a 206f 6620 666f 726d  _string: of form
-00015ea0: 203c 7365 6c65 6374 6f72 3e20 7b3c 7661   <selector> {<va
-00015eb0: 6c75 653e 7d0a 2020 2020 2020 2020 3a72  lue>}.        :r
-00015ec0: 6574 7572 6e20 7365 6c65 6374 6f72 202c  eturn selector ,
-00015ed0: 2076 616c 7565 0a20 2020 2020 2020 2022   value.        "
-00015ee0: 2222 0a0a 2020 2020 2020 2020 7374 796c  ""..        styl
-00015ef0: 655f 7265 203d 2072 652e 636f 6d70 696c  e_re = re.compil
-00015f00: 6528 225c 5c73 2a28 3f50 3c63 6c61 7373  e("\\s*(?P<class
-00015f10: 7265 663e 5b5e 5c5c 735d 2a29 5c5c 732b  ref>[^\\s]*)\\s+
-00015f20: 7b5c 5c73 2a28 3f50 3c63 7373 7374 7269  {\\s*(?P<cssstri
-00015f30: 6e67 3e2e 2a29 7d5c 5c73 2a22 290a 2020  ng>.*)}\\s*").  
-00015f40: 2020 2020 2020 6d61 7463 6820 3d20 7374        match = st
-00015f50: 796c 655f 7265 2e6d 6174 6368 2868 746d  yle_re.match(htm
-00015f60: 6c5f 7374 796c 655f 7374 7269 6e67 290a  l_style_string).
-00015f70: 2020 2020 2020 2020 6966 206e 6f74 206d          if not m
-00015f80: 6174 6368 3a0a 2020 2020 2020 2020 2020  atch:.          
-00015f90: 2020 7265 7475 726e 204e 6f6e 652c 204e    return None, N
-00015fa0: 6f6e 650a 2020 2020 2020 2020 7265 7475  one.        retu
-00015fb0: 726e 206d 6174 6368 2e67 726f 7570 2822  rn match.group("
-00015fc0: 636c 6173 7372 6566 2229 2c20 6d61 7463  classref"), matc
-00015fd0: 682e 6772 6f75 7028 2263 7373 7374 7269  h.group("cssstri
-00015fe0: 6e67 2229 0a0a 2020 2020 2320 636c 6173  ng")..    # clas
-00015ff0: 7320 4874 6d6c 5374 796c 650a 0a20 2020  s HtmlStyle..   
-00016000: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-00016010: 2020 6465 6620 6578 7472 6163 745f 7374    def extract_st
-00016020: 796c 6573 5f61 6e64 5f6e 6f72 6d61 6c69  yles_and_normali
-00016030: 7a65 5f63 6c61 7373 7265 6673 2863 6c73  ze_classrefs(cls
-00016040: 2c20 6874 6d6c 5f65 6c65 6d2c 2066 6f6e  , html_elem, fon
-00016050: 745f 7374 796c 6573 3d46 616c 7365 2c20  t_styles=False, 
-00016060: 6f75 7464 6972 3d4e 6f6e 6529 3a0a 2020  outdir=None):.  
-00016070: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00016080: 2020 4578 7472 6163 7420 7374 796c 6573    Extract styles
-00016090: 2066 726f 6d20 646f 6375 6d65 6e74 0a20   from document. 
-000160a0: 2020 2020 2020 206d 6f76 6520 746f 2068         move to h
-000160b0: 6561 6420 616e 6420 6e6f 726d 616c 697a  ead and normaliz
-000160c0: 6520 636c 6173 7372 6566 730a 2020 2020  e classrefs.    
-000160d0: 2020 2020 6465 6c65 7465 2072 6564 756e      delete redun
-000160e0: 6461 6e74 2063 6c61 7373 7265 6673 2061  dant classrefs a
-000160f0: 6e64 2073 7479 6c65 730a 2020 2020 2020  nd styles.      
-00016100: 2020 6d61 7020 646f 6375 6d65 6e74 2069    map document i
-00016110: 6e73 7461 6d63 6573 206f 6620 7374 796c  nstamces of styl
-00016120: 6573 206f 6e74 6f20 6e6f 726d 616c 697a  es onto normaliz
-00016130: 6564 2063 6c61 7373 7265 6673 0a20 2020  ed classrefs.   
-00016140: 2020 2020 203a 7061 7261 6d20 6874 6d6c       :param html
-00016150: 5f65 6c65 6d3a 2068 746d 6c20 646f 6375  _elem: html docu
-00016160: 6d65 6e74 2074 6f20 6e6f 726d 616c 697a  ment to normaliz
-00016170: 650a 0a20 2020 2020 2020 2053 686f 756c  e..        Shoul
-00016180: 6420 6265 2069 6e20 616e 206f 626a 6563  d be in an objec
-00016190: 740a 2020 2020 2020 2020 544f 444f 0a53  t.        TODO.S
-000161a0: 6f6d 6520 7370 616e 7320 6172 6520 6e6f  ome spans are no
-000161b0: 7420 6a6f 696e 6564 2c20 7831 206f 6e20  t joined, x1 on 
-000161c0: 6f6e 6520 7370 616e 2061 6e64 2078 3020  one span and x0 
-000161d0: 6f6e 2066 6f6c 6c6f 7769 6e67 2061 7265  on following are
-000161e0: 2065 7175 616c 0a20 2020 2020 2020 203c   equal.        <
-000161f0: 6469 7620 6c65 6674 3d22 3134 312e 3732  div left="141.72
-00016200: 2220 7269 6768 743d 2231 3933 2e33 2220  " right="193.3" 
-00016210: 746f 703d 2236 3332 2e32 3222 3e3c 7370  top="632.22"><sp
-00016220: 616e 2078 303d 2231 3431 2e37 3222 2079  an x0="141.72" y
-00016230: 303d 2236 3332 2e32 3222 2078 313d 2231  0="632.22" x1="1
-00016240: 3933 2e33 2220 7374 796c 653d 2278 303a  93.3" style="x0:
-00016250: 2031 3431 2e37 323b 2078 313a 2031 3435   141.72; x1: 145
-00016260: 2e30 333b 2079 303a 2036 3332 2e32 323b  .03; y0: 632.22;
-00016270: 2079 313a 2036 3432 2e31 383b 2077 6964   y1: 642.18; wid
-00016280: 7468 3a20 332e 3332 3b22 2063 6c61 7373  th: 3.32;" class
-00016290: 3d22 7331 3022 3e28 6129 416e 20e2 809c  ="s10">(a)An ...
-000162a0: 3c2f 7370 616e 3e0a 2020 2020 2020 2020  </span>.        
-000162b0: 3c73 7061 6e20 7830 3d22 3232 342e 3034  <span x0="224.04
-000162c0: 2220 7930 3d22 3632 302e 3232 2220 7831  " y0="620.22" x1
-000162d0: 3d22 3338 372e 3934 2220 7374 796c 653d  ="387.94" style=
-000162e0: 2278 303a 2032 3234 2e30 343b 2078 313a  "x0: 224.04; x1:
-000162f0: 2032 3239 2e30 323b 2079 303a 2036 3230   229.02; y0: 620
-00016300: 2e32 323b 2079 313a 2036 3330 2e31 383b  .22; y1: 630.18;
-00016310: 2077 6964 7468 3a20 342e 3938 3b22 2063   width: 4.98;" c
-00016320: 6c61 7373 3d22 7331 3022 3e70 6172 6167  lass="s10">parag
-00016330: 7261 7068 7320 34e2 8092 362c 2074 6865  raphs 4...6, the
-00016340: 7365 2072 756c 6573 2c20 6d6f 6461 6c69  se rules, modali
-00016350: 7469 6573 2061 3c2f 7370 616e 3e0a 2020  ties a</span>.  
-00016360: 2020 2020 2020 3c73 7061 6e20 7830 3d22        <span x0="
-00016370: 3338 372e 3936 2220 7930 3d22 3632 302e  387.96" y0="620.
-00016380: 3232 2220 7831 3d22 3438 342e 3238 2220  22" x1="484.28" 
-00016390: 7374 796c 653d 2278 303a 2033 3837 2e39  style="x0: 387.9
-000163a0: 363b 2078 313a 2033 3932 2e39 343b 2079  6; x1: 392.94; y
-000163b0: 303a 2036 3230 2e32 323b 2079 313a 2036  0: 620.22; y1: 6
-000163c0: 3330 2e31 383b 2077 6964 7468 3a20 342e  30.18; width: 4.
-000163d0: 3938 3b22 2063 6c61 7373 3d22 7331 3022  98;" class="s10"
-000163e0: 3e6e 6420 7072 6f63 6564 7572 6573 2c20  >nd procedures, 
-000163f0: 616e 6420 616e 7920 6675 7274 6865 7220  and any further 
-00016400: 7265 6c65 7661 6e74 2064 6563 6973 696f  relevant decisio
-00016410: 6e73 206f 6620 7468 6520 436f 6e66 6572  ns of the Confer
-00016420: 656e 6365 206f 6620 7468 6520 5061 7274  ence of the Part
-00016430: 6965 7320 7365 7276 696e 6720 6173 2074  ies serving as t
-00016440: 6865 206d 6565 7469 6e67 206f 6620 7468  he meeting of th
-00016450: 6520 5061 7274 6965 7320 746f 2074 6865  e Parties to the
-00016460: 2050 6172 6973 2041 6772 6565 6d65 6e74   Paris Agreement
-00016470: 2028 434d 4129 3b20 3c2f 7370 616e 3e3c   (CMA); </span><
-00016480: 2f64 6976 3e0a 2020 2020 2020 2020 2222  /div>.        ""
-00016490: 220a 0a20 2020 2020 2020 2023 2068 746d  "..        # htm
-000164a0: 6c5f 656c 656d 203d 2068 746d 6c5f 656c  l_elem = html_el
-000164b0: 656d 2e78 7061 7468 2822 2f2a 2229 5b30  em.xpath("/*")[0
-000164c0: 5d20 6966 2074 7970 6528 6874 6d6c 5f65  ] if type(html_e
-000164d0: 6c65 6d29 2069 7320 5f45 6c65 6d65 6e74  lem) is _Element
-000164e0: 5472 6565 2065 6c73 6520 6874 6d6c 5f65  Tree else html_e
-000164f0: 6c65 6d0a 2020 2020 2020 2020 636c 732e  lem.        cls.
-00016500: 6578 7472 6163 745f 616c 6c5f 7374 796c  extract_all_styl
-00016510: 655f 6174 7472 6962 7574 6573 5f74 6f5f  e_attributes_to_
-00016520: 6865 6164 2868 746d 6c5f 656c 656d 290a  head(html_elem).
-00016530: 2020 2020 2020 2020 6966 206f 7574 6469          if outdi
-00016540: 723a 0a20 2020 2020 2020 2020 2020 2048  r:.            H
-00016550: 746d 6c4c 6962 2e77 7269 7465 5f68 746d  tmlLib.write_htm
-00016560: 6c5f 6669 6c65 2868 746d 6c5f 656c 656d  l_file(html_elem
-00016570: 2c20 5061 7468 286f 7574 6469 722c 2022  , Path(outdir, "
-00016580: 7374 796c 6573 312e 6874 6d6c 2229 2c20  styles1.html"), 
-00016590: 6465 6275 673d 5472 7565 290a 2020 2020  debug=True).    
-000165a0: 2020 2020 7374 796c 655f 746f 5f63 6c61      style_to_cla
-000165b0: 7373 7265 665f 7365 7420 3d20 636c 732e  ssref_set = cls.
-000165c0: 6e6f 726d 616c 697a 655f 6865 6164 5f73  normalize_head_s
-000165d0: 7479 6c65 7328 6874 6d6c 5f65 6c65 6d2c  tyles(html_elem,
-000165e0: 206f 7574 6469 723d 6f75 7464 6972 290a   outdir=outdir).
-000165f0: 2020 2020 2020 2020 636c 6173 7372 6566          classref
-00016600: 5f69 6e64 6578 203d 2063 6c73 2e63 7265  _index = cls.cre
-00016610: 6174 655f 636c 6173 7372 6566 5f69 6e64  ate_classref_ind
-00016620: 6578 2873 7479 6c65 5f74 6f5f 636c 6173  ex(style_to_clas
-00016630: 7372 6566 5f73 6574 290a 2020 2020 2020  sref_set).      
-00016640: 2020 6465 6c65 7461 626c 655f 636c 6173    deletable_clas
-00016650: 7372 6566 7320 3d20 636c 732e 6765 745f  srefs = cls.get_
-00016660: 7265 6475 6e64 616e 745f 636c 6173 7372  redundant_classr
-00016670: 6566 7328 636c 6173 7372 6566 5f69 6e64  efs(classref_ind
-00016680: 6578 290a 2020 2020 2020 2020 636c 732e  ex).        cls.
-00016690: 6465 6c65 7465 5f72 6564 756e 6461 6e74  delete_redundant
-000166a0: 5f73 7479 6c65 7328 6465 6c65 7461 626c  _styles(deletabl
-000166b0: 655f 636c 6173 7372 6566 732c 2068 746d  e_classrefs, htm
-000166c0: 6c5f 656c 656d 290a 2020 2020 2020 2020  l_elem).        
-000166d0: 636c 732e 6e6f 726d 616c 697a 655f 636c  cls.normalize_cl
-000166e0: 6173 7372 6566 735f 6f6e 5f65 6c65 6d65  assrefs_on_eleme
-000166f0: 6e74 7328 6874 6d6c 5f65 6c65 6d2c 2063  nts(html_elem, c
-00016700: 6c61 7373 7265 665f 696e 6465 7829 0a20  lassref_index). 
-00016710: 2020 2020 2020 2069 6620 666f 6e74 5f73         if font_s
-00016720: 7479 6c65 733a 0a20 2020 2020 2020 2020  tyles:.         
-00016730: 2020 2063 6c73 2e63 7265 6174 655f 6162     cls.create_ab
-00016740: 6272 6576 6961 7465 645f 666f 6e74 5f73  breviated_font_s
-00016750: 7479 6c65 7328 6874 6d6c 5f65 6c65 6d29  tyles(html_elem)
-00016760: 0a0a 2020 2020 2320 636c 6173 7320 4874  ..    # class Ht
-00016770: 6d6c 5374 796c 650a 0a20 2020 2040 636c  mlStyle..    @cl
-00016780: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-00016790: 6620 6e6f 726d 616c 697a 655f 636c 6173  f normalize_clas
-000167a0: 7372 6566 735f 6f6e 5f65 6c65 6d65 6e74  srefs_on_element
-000167b0: 7328 636c 732c 2068 746d 6c5f 656c 656d  s(cls, html_elem
-000167c0: 2c20 636c 6173 7372 6566 5f69 6e64 6578  , classref_index
-000167d0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-000167e0: 2020 2020 2020 2046 696e 6473 2061 6c6c         Finds all
-000167f0: 2065 6c6d 656e 7473 2077 6974 6820 4063   elments with @c
-00016800: 6c61 7373 2061 7474 7269 6275 7465 2061  lass attribute a
-00016810: 6e64 206e 6f72 6d61 6c69 7a65 2074 6f20  nd normalize to 
-00016820: 6d69 6e69 6d61 6c20 7365 740a 2020 2020  minimal set.    
-00016830: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00016840: 636c 6173 7365 645f 656c 656d 7320 3d20  classed_elems = 
-00016850: 6874 6d6c 5f65 6c65 6d2e 7870 6174 6828  html_elem.xpath(
-00016860: 222f 2f2a 5b40 636c 6173 735d 2229 0a20  "//*[@class]"). 
-00016870: 2020 2020 2020 2066 6f72 2063 6c61 7373         for class
-00016880: 6564 5f65 6c65 6d20 696e 2063 6c61 7373  ed_elem in class
-00016890: 6564 5f65 6c65 6d73 3a0a 2020 2020 2020  ed_elems:.      
-000168a0: 2020 2020 2020 6874 6d6c 5f63 6c61 7373        html_class
-000168b0: 203d 2048 746d 6c43 6c61 7373 2e63 7265   = HtmlClass.cre
-000168c0: 6174 655f 6672 6f6d 5f63 6c61 7373 6564  ate_from_classed
-000168d0: 5f65 6c65 6d65 6e74 2863 6c61 7373 6564  _element(classed
-000168e0: 5f65 6c65 6d29 0a20 2020 2020 2020 2020  _elem).         
-000168f0: 2020 2063 6c61 7373 7265 6620 3d20 6874     classref = ht
-00016900: 6d6c 5f63 6c61 7373 2e63 7265 6174 655f  ml_class.create_
-00016910: 636c 6173 7372 6566 2829 0a20 2020 2020  classref().     
-00016920: 2020 2020 2020 206e 6f72 6d61 6c69 7a65         normalize
-00016930: 645f 636c 6173 7372 6566 203d 2048 746d  d_classref = Htm
-00016940: 6c43 6c61 7373 2e72 656d 6f76 655f 646f  lClass.remove_do
-00016950: 7428 636c 6173 7372 6566 5f69 6e64 6578  t(classref_index
-00016960: 2e67 6574 2863 6c61 7373 7265 6629 290a  .get(classref)).
-00016970: 2020 2020 2020 2020 2020 2020 636c 6173              clas
-00016980: 7372 6566 203d 2048 746d 6c43 6c61 7373  sref = HtmlClass
-00016990: 2e72 656d 6f76 655f 646f 7428 636c 6173  .remove_dot(clas
-000169a0: 7372 6566 290a 2020 2020 2020 2020 2020  sref).          
-000169b0: 2020 6966 206e 6f72 6d61 6c69 7a65 645f    if normalized_
-000169c0: 636c 6173 7372 6566 2021 3d20 636c 6173  classref != clas
-000169d0: 7372 6566 3a0a 2020 2020 2020 2020 2020  sref:.          
-000169e0: 2020 2020 2020 6874 6d6c 5f63 6c61 7373        html_class
-000169f0: 2e72 6570 6c61 6365 5f63 6c61 7373 2863  .replace_class(c
-00016a00: 6c61 7373 7265 662c 206e 6f72 6d61 6c69  lassref, normali
-00016a10: 7a65 645f 636c 6173 7372 6566 290a 2020  zed_classref).  
-00016a20: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00016a30: 2068 746d 6c5f 636c 6173 732e 636c 6173   html_class.clas
-00016a40: 735f 7374 7269 6e67 3a0a 2020 2020 2020  s_string:.      
-00016a50: 2020 2020 2020 2020 2020 2020 2020 4874                Ht
-00016a60: 6d6c 436c 6173 732e 7365 745f 636c 6173  mlClass.set_clas
-00016a70: 735f 6f6e 5f65 6c65 6d65 6e74 2863 6c61  s_on_element(cla
-00016a80: 7373 6564 5f65 6c65 6d2c 2068 746d 6c5f  ssed_elem, html_
-00016a90: 636c 6173 732e 636c 6173 735f 7374 7269  class.class_stri
-00016aa0: 6e67 290a 0a20 2020 2023 2063 6c61 7373  ng)..    # class
-00016ab0: 2048 746d 6c53 7479 6c65 0a0a 2020 2020   HtmlStyle..    
-00016ac0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-00016ad0: 2064 6566 2064 656c 6574 655f 7265 6475   def delete_redu
-00016ae0: 6e64 616e 745f 7374 796c 6573 2863 6c73  ndant_styles(cls
-00016af0: 2c20 6465 6c65 7461 626c 655f 636c 6173  , deletable_clas
-00016b00: 7372 6566 732c 2068 746d 6c5f 656c 656d  srefs, html_elem
-00016b10: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-00016b20: 2020 2020 2020 2064 656c 6574 6573 2072         deletes r
-00016b30: 6564 756e 6461 6e74 203c 7374 796c 653e  edundant <style>
-00016b40: 7320 696e 2068 6561 640a 2020 2020 2020  s in head.      
-00016b50: 2020 2222 220a 2020 2020 2020 2020 7374    """.        st
-00016b60: 796c 6573 5f77 6974 685f 636c 6173 7372  yles_with_classr
-00016b70: 6566 7320 3d20 6874 6d6c 5f65 6c65 6d2e  efs = html_elem.
-00016b80: 7870 6174 6828 222f 6874 6d6c 2f68 6561  xpath("/html/hea
-00016b90: 642f 7374 796c 655b 4063 6c61 7373 7265  d/style[@classre
-00016ba0: 665d 2229 0a20 2020 2020 2020 2066 6f72  f]").        for
-00016bb0: 2073 7479 6c65 2069 6e20 7374 796c 6573   style in styles
-00016bc0: 5f77 6974 685f 636c 6173 7372 6566 733a  _with_classrefs:
-00016bd0: 0a20 2020 2020 2020 2020 2020 2063 6c61  .            cla
-00016be0: 7373 7265 6620 3d20 7374 796c 652e 6174  ssref = style.at
-00016bf0: 7472 6962 2e67 6574 2843 4c41 5353 5245  trib.get(CLASSRE
-00016c00: 4629 0a20 2020 2020 2020 2020 2020 2069  F).            i
-00016c10: 6620 636c 6173 7372 6566 2069 6e20 6465  f classref in de
-00016c20: 6c65 7461 626c 655f 636c 6173 7372 6566  letable_classref
-00016c30: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00016c40: 2020 2058 6d6c 4c69 622e 7265 6d6f 7665     XmlLib.remove
-00016c50: 5f65 6c65 6d65 6e74 2873 7479 6c65 290a  _element(style).
-00016c60: 0a20 2020 2023 2063 6c61 7373 2048 746d  .    # class Htm
-00016c70: 6c53 7479 6c65 0a0a 2020 2020 4063 6c61  lStyle..    @cla
-00016c80: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-00016c90: 2067 6574 5f72 6564 756e 6461 6e74 5f63   get_redundant_c
-00016ca0: 6c61 7373 7265 6673 2863 6c73 2c20 636c  lassrefs(cls, cl
-00016cb0: 6173 7372 6566 5f69 6e64 6578 293a 0a20  assref_index):. 
-00016cc0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00016cd0: 2020 206d 616b 6573 206c 6973 7420 6f66     makes list of
-00016ce0: 2072 6564 756e 6461 6e74 2063 6c61 7373   redundant class
-00016cf0: 7265 6673 0a20 2020 2020 2020 203a 7061  refs.        :pa
-00016d00: 7261 6d20 636c 6173 7372 6566 5f69 6e64  ram classref_ind
-00016d10: 6578 3a20 6469 6374 696f 6e61 7279 206d  ex: dictionary m
-00016d20: 6170 7069 6e67 2063 6c61 7373 7265 6673  apping classrefs
-00016d30: 206f 6e74 6f20 6e6f 726d 616c 697a 6564   onto normalized
-00016d40: 2063 6c61 7373 7265 660a 2020 2020 2020   classref.      
-00016d50: 2020 3a72 6574 7572 6e3a 206c 6973 7420    :return: list 
-00016d60: 6f66 2072 6564 756e 6461 6e74 2063 6c61  of redundant cla
-00016d70: 7373 7265 6673 0a20 2020 2020 2020 2022  ssrefs.        "
-00016d80: 2222 0a20 2020 2020 2020 2072 6564 756e  "".        redun
-00016d90: 6461 6e74 5f63 6c61 7373 7265 6673 203d  dant_classrefs =
-00016da0: 205b 5d0a 2020 2020 2020 2020 666f 7220   [].        for 
-00016db0: 6974 656d 2069 6e20 636c 6173 7372 6566  item in classref
-00016dc0: 5f69 6e64 6578 2e69 7465 6d73 2829 3a0a  _index.items():.
-00016dd0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00016de0: 7465 6d5b 305d 2021 3d20 6974 656d 5b31  tem[0] != item[1
-00016df0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00016e00: 2020 2072 6564 756e 6461 6e74 5f63 6c61     redundant_cla
-00016e10: 7373 7265 6673 2e61 7070 656e 6428 6974  ssrefs.append(it
-00016e20: 656d 5b30 5d29 0a20 2020 2020 2020 2072  em[0]).        r
-00016e30: 6574 7572 6e20 7265 6475 6e64 616e 745f  eturn redundant_
-00016e40: 636c 6173 7372 6566 730a 0a20 2020 2023  classrefs..    #
-00016e50: 2063 6c61 7373 2048 746d 6c53 7479 6c65   class HtmlStyle
-00016e60: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-00016e70: 6f64 0a20 2020 2064 6566 2063 7265 6174  od.    def creat
-00016e80: 655f 636c 6173 7372 6566 5f69 6e64 6578  e_classref_index
-00016e90: 2863 6c73 2c20 7374 796c 655f 746f 5f63  (cls, style_to_c
-00016ea0: 6c61 7373 7265 665f 7365 7429 3a0a 2020  lassref_set):.  
-00016eb0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00016ec0: 2020 6d61 7073 2061 6c6c 2069 7465 6d73    maps all items
-00016ed0: 2069 6e20 636c 6173 7372 6566 2073 6574   in classref set
-00016ee0: 7320 6f6e 746f 2028 6172 6269 7472 6172  s onto (arbitrar
-00016ef0: 696c 7929 2074 6865 2066 6972 7374 0a20  ily) the first. 
-00016f00: 2020 2020 2020 203a 7061 7261 6d20 7374         :param st
-00016f10: 796c 655f 746f 5f63 6c61 7373 7265 665f  yle_to_classref_
-00016f20: 7365 743a 2063 6c61 7373 7265 665f 7365  set: classref_se
-00016f30: 7473 206d 6d61 7070 6564 2062 7920 7374  ts mmapped by st
-00016f40: 796c 6520 7661 6c75 650a 2020 2020 2020  yle value.      
-00016f50: 2020 3a72 6574 7572 6e3a 6469 6374 206d    :return:dict m
-00016f60: 6170 7069 6e67 2072 6564 756e 6461 6e74  apping redundant
-00016f70: 2063 6c61 7373 7265 6673 206f 6e74 6f20   classrefs onto 
-00016f80: 6e6f 726d 616c 697a 6564 2063 6c61 7373  normalized class
-00016f90: 7265 660a 2020 2020 2020 2020 4d61 7920  ref.        May 
-00016fa0: 6265 6e65 6669 7420 6672 6f6d 2062 6569  benefit from bei
-00016fb0: 6e67 2069 6e20 6120 636c 6173 730a 2020  ng in a class.  
-00016fc0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00016fd0: 2020 636c 6173 7372 6566 5f69 6e64 6578    classref_index
-00016fe0: 203d 2064 6963 7428 290a 2020 2020 2020   = dict().      
-00016ff0: 2020 666f 7220 6974 656d 2069 6e20 7374    for item in st
-00017000: 796c 655f 746f 5f63 6c61 7373 7265 665f  yle_to_classref_
-00017010: 7365 742e 6974 656d 7328 293a 0a20 2020  set.items():.   
-00017020: 2020 2020 2020 2020 2063 6c61 7373 7265           classre
-00017030: 665f 6c69 7374 203d 206c 6973 7428 736f  f_list = list(so
-00017040: 7274 6564 2869 7465 6d5b 315d 2929 0a20  rted(item[1])). 
-00017050: 2020 2020 2020 2020 2020 2063 6c61 7373             class
-00017060: 7265 6630 203d 206c 6973 7428 636c 6173  ref0 = list(clas
-00017070: 7372 6566 5f6c 6973 7429 5b30 5d0a 2020  sref_list)[0].  
-00017080: 2020 2020 2020 2020 2020 666f 7220 636c            for cl
-00017090: 6173 7372 6566 2069 6e20 636c 6173 7372  assref in classr
-000170a0: 6566 5f6c 6973 743a 0a20 2020 2020 2020  ef_list:.       
-000170b0: 2020 2020 2020 2020 2063 6c61 7373 7265           classre
-000170c0: 665f 696e 6465 785b 636c 6173 7372 6566  f_index[classref
-000170d0: 5d20 3d20 636c 6173 7372 6566 300a 2020  ] = classref0.  
-000170e0: 2020 2020 2020 7265 7475 726e 2063 6c61        return cla
-000170f0: 7373 7265 665f 696e 6465 780a 0a20 2020  ssref_index..   
-00017100: 2023 2063 6c61 7373 2048 746d 6c53 7479   # class HtmlSty
-00017110: 6c65 0a0a 2020 2020 4063 6c61 7373 6d65  le..    @classme
-00017120: 7468 6f64 0a20 2020 2064 6566 2061 6464  thod.    def add
-00017130: 5f68 6561 645f 7374 796c 6573 5f6f 7269  _head_styles_ori
-00017140: 6728 636c 732c 2068 746d 6c5f 656c 656d  g(cls, html_elem
-00017150: 2c20 7374 796c 6573 2c20 6e6f 726d 616c  , styles, normal
-00017160: 697a 655f 666f 6e74 3d54 7275 6529 3a0a  ize_font=True):.
-00017170: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00017180: 2020 2020 7468 6973 2069 7320 6372 7564      this is crud
-00017190: 650a 2020 2020 2020 2020 2773 7479 6c65  e.        'style
-000171a0: 206f 6620 666f 726d 0a20 2020 2020 2020   of form.       
-000171b0: 2020 2020 2022 6469 7622 2c20 5b28 2262       "div", [("b
-000171c0: 6f72 6465 7222 2c20 2272 6564 2073 6f6c  order", "red sol
-000171d0: 6964 2030 2e35 7078 2229 2c20 2822 6261  id 0.5px"), ("ba
-000171e0: 636b 6772 6f75 6e64 222c 2022 7965 6c6c  ckground", "yell
-000171f0: 6f77 295d 290a 2020 2020 2020 2020 2222  ow)]).        ""
-00017200: 220a 2020 2020 2020 2020 666f 7220 7374  ".        for st
-00017210: 796c 6520 696e 2073 7479 6c65 733a 0a20  yle in styles:. 
-00017220: 2020 2020 2020 2020 2020 2023 2070 7269             # pri
-00017230: 6e74 2866 2273 7479 6c65 207b 7374 796c  nt(f"style {styl
-00017240: 657d 2229 0a20 2020 2020 2020 2020 2020  e}").           
-00017250: 2048 746d 6c4c 6962 2e61 6464 5f68 6561   HtmlLib.add_hea
-00017260: 645f 7374 796c 6528 6874 6d6c 5f65 6c65  d_style(html_ele
-00017270: 6d2c 2073 7479 6c65 5b30 5d2c 2073 7479  m, style[0], sty
-00017280: 6c65 5b31 5d29 0a0a 2020 2020 4063 6c61  le[1])..    @cla
-00017290: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-000172a0: 2061 6464 5f68 6561 645f 7374 796c 6573   add_head_styles
-000172b0: 2863 6c73 2c20 6874 6d6c 5f65 6c65 6d2c  (cls, html_elem,
-000172c0: 2073 7479 6c65 5f74 6578 7473 2c20 6e6f   style_texts, no
-000172d0: 726d 616c 697a 655f 666f 6e74 3d54 7275  rmalize_font=Tru
-000172e0: 6529 3a0a 2020 2020 2020 2020 2222 220a  e):.        """.
-000172f0: 2020 2020 2020 2020 6164 6473 2074 6578          adds tex
-00017300: 7420 6f66 2066 6f72 6d0a 2020 2020 2020  t of form.      
-00017310: 2020 6c6f 6361 746f 7220 6373 730a 2020    locator css.  
-00017320: 2020 2020 2020 652e 672e 2073 7061 6e2e        e.g. span.
-00017330: 7465 6d70 207b 6261 636b 6772 6f75 6e64  temp {background
-00017340: 3a20 7265 643b 2066 6f6e 742d 7369 7a65  : red; font-size
-00017350: 3a20 3132 7078 3b7d 0a20 2020 2020 2020  : 12px;}.       
-00017360: 2022 2222 0a20 2020 2020 2020 2068 746d   """.        htm
-00017370: 6c5f 6865 6164 203d 2048 746d 6c4c 6962  l_head = HtmlLib
-00017380: 2e67 6574 5f68 6561 6428 6874 6d6c 5f65  .get_head(html_e
-00017390: 6c65 6d29 0a20 2020 2020 2020 2066 6f72  lem).        for
-000173a0: 2073 7479 6c65 5f74 2069 6e20 7374 796c   style_t in styl
-000173b0: 655f 7465 7874 733a 0a20 2020 2020 2020  e_texts:.       
-000173c0: 2020 2020 2073 7479 6c65 203d 2045 542e       style = ET.
-000173d0: 5375 6245 6c65 6d65 6e74 2868 746d 6c5f  SubElement(html_
-000173e0: 6865 6164 2c20 2273 7479 6c65 2229 0a20  head, "style"). 
-000173f0: 2020 2020 2020 2020 2020 2073 7479 6c65             style
-00017400: 2e74 6578 7420 3d20 7374 796c 655f 740a  .text = style_t.
-00017410: 0a20 2020 2023 2054 4f44 4f0a 2020 2020  .    # TODO.    
-00017420: 2320 6372 6561 7465 5f66 6f6e 745f 6564  # create_font_ed
-00017430: 6974 6564 5f73 7479 6c65 5f66 726f 6d5f  ited_style_from_
-00017440: 6373 735f 7374 796c 655f 6f62 6a65 6374  css_style_object
-00017450: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-00017460: 6f64 0a20 2020 2064 6566 2074 7261 6e73  od.    def trans
-00017470: 6665 725f 6865 6164 5f73 7479 6c65 7328  fer_head_styles(
-00017480: 636c 732c 2068 746d 6c5f 656c 656d 2c20  cls, html_elem, 
-00017490: 6e65 775f 6874 6d6c 293a 0a20 2020 2020  new_html):.     
-000174a0: 2020 2022 2222 636f 7069 6573 2068 746d     """copies htm
-000174b0: 6c2f 6865 6164 2f22 2222 0a20 2020 2020  l/head/""".     
-000174c0: 2020 206e 6577 5f73 7479 6c65 5f65 6c65     new_style_ele
-000174d0: 6d20 3d20 4874 6d6c 4772 6f75 702e 6372  m = HtmlGroup.cr
-000174e0: 6561 7465 5f68 6561 645f 7374 796c 655f  eate_head_style_
-000174f0: 656c 656d 286e 6577 5f68 746d 6c2c 2074  elem(new_html, t
-00017500: 6169 6c3d 225c 6e22 290a 2020 2020 2020  ail="\n").      
-00017510: 2020 7374 796c 6573 203d 2048 746d 6c53    styles = HtmlS
-00017520: 7479 6c65 2e67 6574 5f68 6561 645f 7374  tyle.get_head_st
-00017530: 796c 6573 2868 746d 6c5f 656c 656d 290a  yles(html_elem).
-00017540: 2020 2020 2020 2020 666f 7220 7374 796c          for styl
-00017550: 6520 696e 2073 7479 6c65 733a 0a20 2020  e in styles:.   
-00017560: 2020 2020 2020 2020 206e 6577 5f73 7479           new_sty
-00017570: 6c65 5f65 6c65 6d2e 6765 7470 6172 656e  le_elem.getparen
-00017580: 7428 292e 6170 7065 6e64 2863 6f70 792e  t().append(copy.
-00017590: 6465 6570 636f 7079 2873 7479 6c65 2929  deepcopy(style))
-000175a0: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-000175b0: 6f64 0a20 2020 2064 6566 2065 7874 7261  od.    def extra
-000175c0: 6374 5f63 6c61 7373 7265 665f 616e 645f  ct_classref_and_
-000175d0: 6373 7373 7472 696e 675f 6672 6f6d 5f68  cssstring_from_h
-000175e0: 746d 6c5f 7374 796c 6528 636c 732c 2068  tml_style(cls, h
-000175f0: 746d 6c5f 7374 796c 655f 656c 656d 293a  tml_style_elem):
-00017600: 0a20 2020 2020 2020 2069 6620 6874 6d6c  .        if html
-00017610: 5f73 7479 6c65 5f65 6c65 6d20 6973 204e  _style_elem is N
-00017620: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00017630: 2072 6574 7572 6e20 4e6f 6e65 2c20 4e6f   return None, No
-00017640: 6e65 0a20 2020 2020 2020 2072 6574 7572  ne.        retur
-00017650: 6e20 636c 732e 6578 7472 6163 745f 636c  n cls.extract_cl
-00017660: 6173 7372 6566 5f61 6e64 5f63 7373 7374  assref_and_cssst
-00017670: 7269 6e67 5f66 726f 6d5f 7374 796c 655f  ring_from_style_
-00017680: 7465 7874 2868 746d 6c5f 7374 796c 655f  text(html_style_
-00017690: 656c 656d 2e74 6578 7429 0a0a 2020 2020  elem.text)..    
-000176a0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-000176b0: 2064 6566 2063 7265 6174 655f 636c 6173   def create_clas
-000176c0: 7372 6566 5f63 7373 7374 7269 6e67 5f74  sref_cssstring_t
-000176d0: 6162 6c65 2863 6c73 2c20 6874 6d6c 5f73  able(cls, html_s
-000176e0: 7479 6c65 7329 3a0a 2020 2020 2020 2020  tyles):.        
-000176f0: 7461 626c 6520 3d20 5b5d 0a20 2020 2020  table = [].     
-00017700: 2020 2066 6f72 2068 746d 6c5f 7374 796c     for html_styl
-00017710: 6520 696e 2068 746d 6c5f 7374 796c 6573  e in html_styles
-00017720: 3a0a 2020 2020 2020 2020 2020 2020 7461  :.            ta
-00017730: 626c 652e 6170 7065 6e64 2848 746d 6c53  ble.append(HtmlS
-00017740: 7479 6c65 2e65 7874 7261 6374 5f63 6c61  tyle.extract_cla
-00017750: 7373 7265 665f 616e 645f 6373 7373 7472  ssref_and_cssstr
-00017760: 696e 675f 6672 6f6d 5f68 746d 6c5f 7374  ing_from_html_st
-00017770: 796c 6528 6874 6d6c 5f73 7479 6c65 2929  yle(html_style))
-00017780: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00017790: 7461 626c 650a 0a20 2020 2040 636c 6173  table..    @clas
-000177a0: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
-000177b0: 7265 706c 6163 655f 6375 726c 7928 636c  replace_curly(cl
-000177c0: 732c 2065 6c65 6d2c 206e 6577 5f63 7572  s, elem, new_cur
-000177d0: 6c79 293a 0a20 2020 2020 2020 2022 2222  ly):.        """
-000177e0: 0a20 2020 2020 2020 2072 6570 6c61 6365  .        replace
-000177f0: 2063 6f6e 7465 6e74 7320 6f66 207b 2e2e   contents of {..
-00017800: 2e7d 0a20 2020 2020 2020 203a 7061 7261  .}.        :para
-00017810: 6d20 656c 656d 3a20 6874 6d6c 203c 7374  m elem: html <st
-00017820: 796c 653e 2065 6c65 6d65 6e74 0a20 2020  yle> element.   
-00017830: 2020 2020 203a 7061 7261 6d20 656c 656d       :param elem
-00017840: 3a20 6e65 7720 636f 6e74 656e 740a 2020  : new content.  
-00017850: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-00017860: 2020 2069 6620 656c 656d 2069 7320 6e6f     if elem is no
-00017870: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00017880: 2020 2020 6d61 7463 6820 3d20 5354 594c      match = STYL
-00017890: 455f 4355 524c 595f 5245 2e6d 6174 6368  E_CURLY_RE.match
-000178a0: 2865 6c65 6d2e 7465 7874 290a 2020 2020  (elem.text).    
-000178b0: 2020 2020 2020 2020 6966 206d 6174 6368          if match
-000178c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000178d0: 2020 6e65 775f 7465 7874 203d 206d 6174    new_text = mat
-000178e0: 6368 2e67 726f 7570 2822 7072 6522 2920  ch.group("pre") 
-000178f0: 2b20 6e65 775f 6375 726c 7920 2b20 6d61  + new_curly + ma
-00017900: 7463 682e 6772 6f75 7028 2270 6f73 7422  tch.group("post"
-00017910: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00017920: 2020 656c 656d 2e74 6578 7420 3d20 6e65    elem.text = ne
-00017930: 775f 7465 7874 0a0a 2020 2020 4063 6c61  w_text..    @cla
-00017940: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-00017950: 206c 6f6f 6b75 705f 6865 6164 5f73 7479   lookup_head_sty
-00017960: 6c65 5f62 795f 636c 6173 7372 6566 2863  le_by_classref(c
-00017970: 6c73 2c20 656c 656d 293a 0a20 2020 2020  ls, elem):.     
-00017980: 2020 2022 2222 0a20 2020 2020 2020 203a     """.        :
-00017990: 7061 7261 6d20 656c 656d 3a20 656c 656d  param elem: elem
-000179a0: 656e 7473 2077 6974 6820 4063 6c61 7373  ents with @class
-000179b0: 2061 7474 7269 6275 7465 0a20 2020 2020   attribute.     
-000179c0: 2020 203a 7265 7475 726e 3a20 4353 5353     :return: CSSS
-000179d0: 7479 6c65 206f 626a 6563 7420 7769 7468  tyle object with
-000179e0: 2048 746d 6c53 7479 6c65 0a20 2020 2020   HtmlStyle.     
-000179f0: 2020 2022 2222 0a20 2020 2020 2020 2063     """.        c
-00017a00: 6c61 7a7a 203d 2065 6c65 6d2e 6765 7428  lazz = elem.get(
-00017a10: 2263 6c61 7373 2229 0a20 2020 2020 2020  "class").       
-00017a20: 2063 7373 5f73 7479 6c65 203d 2048 746d   css_style = Htm
-00017a30: 6c53 7479 6c65 2e6c 6f6f 6b75 705f 6865  lStyle.lookup_he
-00017a40: 6164 5f73 7479 6c65 5f62 795f 636c 6173  ad_style_by_clas
-00017a50: 7328 656c 656d 2c20 636c 617a 7a29 0a20  s(elem, clazz). 
-00017a60: 2020 2020 2020 2072 6574 7572 6e20 6373         return cs
-00017a70: 735f 7374 796c 650a 0a20 2020 2040 636c  s_style..    @cl
-00017a80: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-00017a90: 6620 6c6f 6f6b 7570 5f68 6561 645f 7374  f lookup_head_st
-00017aa0: 796c 655f 6279 5f63 6c61 7373 2863 6c73  yle_by_class(cls
-00017ab0: 2c20 6874 6d6c 2c20 636c 617a 7a29 3a0a  , html, clazz):.
+00012730: 2020 2020 2020 2020 6164 645f 6964 3d22          add_id="
+00012740: 7072 6f62 6162 696c 6974 795f 7c22 2c20  probability_|", 
+00012750: 6164 645f 7469 746c 653d 227c 222c 2073  add_title="|", s
+00012760: 7479 6c65 3d22 7b63 6f6c 6f72 203a 2063  tyle="{color : c
+00012770: 7961 6e3b 2062 6163 6b67 726f 756e 6420  yan; background 
+00012780: 3a20 2364 6438 3838 383b 7d22 2929 0a20  : #dd8888;}")). 
+00012790: 2020 2020 2020 2061 6e6e 6f74 6174 6f72         annotator
+000127a0: 2e61 6464 5f63 6f6d 6d61 6e64 280a 2020  .add_command(.  
+000127b0: 2020 2020 2020 2020 2020 416e 6e6f 7461            Annota
+000127c0: 746f 7243 6f6d 6d61 6e64 2868 746d 6c5f  torCommand(html_
+000127d0: 636c 6173 733d 2273 7570 6572 7363 7269  class="superscri
+000127e0: 7074 222c 2073 6372 6970 743d 2273 7570  pt", script="sup
+000127f0: 6572 222c 2061 6464 5f69 643d 2273 7570  er", add_id="sup
+00012800: 6572 5f7c 222c 2061 6464 5f74 6974 6c65  er_|", add_title
+00012810: 3d22 7c22 2c0a 2020 2020 2020 2020 2020  ="|",.          
+00012820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012830: 2020 2073 7479 6c65 3d22 7b63 6f6c 6f72     style="{color
+00012840: 203a 2062 6c75 653b 2062 6163 6b67 726f   : blue; backgro
+00012850: 6f75 6e64 3a20 7965 6c6c 6f77 7d22 2929  ound: yellow}"))
+00012860: 0a20 2020 2020 2020 2061 6e6e 6f74 6174  .        annotat
+00012870: 6f72 2e61 6464 5f63 6f6d 6d61 6e64 280a  or.add_command(.
+00012880: 2020 2020 2020 2020 2020 2020 416e 6e6f              Anno
+00012890: 7461 746f 7243 6f6d 6d61 6e64 2868 746d  tatorCommand(htm
+000128a0: 6c5f 636c 6173 733d 2273 7461 7274 222c  l_class="start",
+000128b0: 2072 6567 6578 3d22 5c5c 732a 5c5c 5b3f   regex="\\s*\\[?
+000128c0: 5354 4152 545c 5c73 2a28 3f50 3c74 6974  START\\s*(?P<tit
+000128d0: 6c65 3e46 4947 5552 457c 5441 424c 4529  le>FIGURE|TABLE)
+000128e0: 5c5c 732a 283f 503c 6964 3e5c 5c64 2b5c  \\s*(?P<id>\\d+\
+000128f0: 5c2e 5c5c 642b 295c 5c73 2a28 4845 5245  \.\\d+)\\s*(HERE
+00012900: 293f 5c5c 5d3f 222c 0a20 2020 2020 2020  )?\\]?",.       
+00012910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012920: 2020 2020 2020 6164 645f 6964 3d22 7374        add_id="st
+00012930: 6172 745f 7c22 2c20 6164 645f 7469 746c  art_|", add_titl
+00012940: 653d 2273 7461 7274 5f7c 222c 2073 7479  e="start_|", sty
+00012950: 6c65 3d22 7b63 6f6c 6f72 203a 2067 7265  le="{color : gre
+00012960: 656e 3b20 6261 636b 6772 6f75 6e64 3a20  en; background: 
+00012970: 7069 6e6b 7d22 2929 0a20 2020 2020 2020  pink}")).       
+00012980: 2061 6e6e 6f74 6174 6f72 2e61 6464 5f63   annotator.add_c
+00012990: 6f6d 6d61 6e64 280a 2020 2020 2020 2020  ommand(.        
+000129a0: 2020 2020 416e 6e6f 7461 746f 7243 6f6d      AnnotatorCom
+000129b0: 6d61 6e64 2868 746d 6c5f 636c 6173 733d  mand(html_class=
+000129c0: 2265 6e64 222c 2072 6567 6578 3d22 5c5c  "end", regex="\\
+000129d0: 732a 5c5c 5b3f 454e 445c 5c73 2a28 3f50  s*\\[?END\\s*(?P
+000129e0: 3c74 6974 6c65 3e46 4947 5552 457c 5441  <title>FIGURE|TA
+000129f0: 424c 4529 5c5c 732a 283f 503c 6964 3e5c  BLE)\\s*(?P<id>\
+00012a00: 5c64 2b5c 5c2e 5c5c 642b 295c 5c73 2a28  \d+\\.\\d+)\\s*(
+00012a10: 4845 5245 293f 5c5c 5d3f 222c 0a20 2020  HERE)?\\]?",.   
+00012a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a30: 2020 2020 2020 2020 2020 6164 645f 6964            add_id
+00012a40: 3d22 656e 645f 7c22 2c20 6164 645f 7469  ="end_|", add_ti
+00012a50: 746c 653d 2265 6e64 5f7c 222c 2073 7479  tle="end_|", sty
+00012a60: 6c65 3d22 7b63 6f6c 6f72 203a 2067 7265  le="{color : gre
+00012a70: 656e 3b20 6261 636b 6772 6f75 6e64 3a20  en; background: 
+00012a80: 626c 7565 7d22 2929 0a20 2020 2020 2020  blue}")).       
+00012a90: 2061 6e6e 6f74 6174 6f72 2e61 6464 5f63   annotator.add_c
+00012aa0: 6f6d 6d61 6e64 280a 2020 2020 2020 2020  ommand(.        
+00012ab0: 2020 2020 416e 6e6f 7461 746f 7243 6f6d      AnnotatorCom
+00012ac0: 6d61 6e64 2868 746d 6c5f 636c 6173 733d  mand(html_class=
+00012ad0: 2274 6172 6765 7473 222c 2072 6567 6578  "targets", regex
+00012ae0: 3d22 2e2a 5c5c 7b28 3f50 3c74 6974 6c65  =".*\\{(?P<title
+00012af0: 3e2e 2b29 5c5c 7d2e 2a22 2c0a 2020 2020  >.+)\\}.*",.    
+00012b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012b10: 2020 2020 2020 2020 2061 6464 5f69 643d           add_id=
+00012b20: 2263 6875 6e6b 5f7c 222c 2061 6464 5f74  "chunk_|", add_t
+00012b30: 6974 6c65 3d22 7c22 2c20 7374 796c 653d  itle="|", style=
+00012b40: 227b 636f 6c6f 7220 3a20 6772 6565 6e3b  "{color : green;
+00012b50: 2062 6163 6b67 726f 756e 643a 206f 7261   background: ora
+00012b60: 6e67 657d 222c 0a20 2020 2020 2020 2020  nge}",.         
+00012b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012b80: 2020 2064 6573 633d 2249 5043 4320 7461     desc="IPCC ta
+00012b90: 7267 6574 2049 4473 2069 6e20 6375 726c  rget IDs in curl
+00012ba0: 7920 6272 6163 6b65 7473 207b 5747 3120  y brackets {WG1 
+00012bb0: 5350 4d20 412e 312e 322c 2057 4749 4920  SPM A.1.2, WGII 
+00012bc0: 5350 4d20 422e 322e 337d 2229 290a 2020  SPM B.2.3}")).  
+00012bd0: 2020 2020 2020 616e 6e6f 7461 746f 722e        annotator.
+00012be0: 6164 645f 636f 6d6d 616e 6428 0a20 2020  add_command(.   
+00012bf0: 2020 2020 2020 2020 2041 6e6e 6f74 6174           Annotat
+00012c00: 6f72 436f 6d6d 616e 6428 6874 6d6c 5f63  orCommand(html_c
+00012c10: 6c61 7373 3d22 6372 7566 7422 2c20 7265  lass="cruft", re
+00012c20: 6765 783d 225e 2e2a 2853 7562 6a65 6374  gex="^.*(Subject
+00012c30: 2074 6f20 436f 7079 2045 6469 7420 7c41   to Copy Edit |A
+00012c40: 646f 7074 6564 204c 6f6e 6765 7220 5265  dopted Longer Re
+00012c50: 706f 7274 2049 5043 4320 4152 3620 5359  port IPCC AR6 SY
+00012c60: 5229 2e2a 2422 2c0a 2020 2020 2020 2020  R).*$",.        
+00012c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012c80: 2020 2020 2061 6464 5f69 643d 2263 7275       add_id="cru
+00012c90: 6674 5f7c 222c 2061 6464 5f74 6974 6c65  ft_|", add_title
+00012ca0: 3d22 7c22 2c20 6465 6c65 7465 3d54 7275  ="|", delete=Tru
+00012cb0: 652c 2073 7479 6c65 3d22 7b63 6f6c 6f72  e, style="{color
+00012cc0: 203a 2067 7265 656e 3b20 6261 636b 6772   : green; backgr
+00012cd0: 6f75 6e64 3a20 626c 6163 6b7d 2229 290a  ound: black}")).
+00012ce0: 2020 2020 2020 2020 616e 6e6f 7461 746f          annotato
+00012cf0: 722e 6164 645f 636f 6d6d 616e 6428 0a20  r.add_command(. 
+00012d00: 2020 2020 2020 2020 2020 2041 6e6e 6f74             Annot
+00012d10: 6174 6f72 436f 6d6d 616e 6428 6874 6d6c  atorCommand(html
+00012d20: 5f63 6c61 7373 3d22 7061 6765 222c 2072  _class="page", r
+00012d30: 6567 6578 3d22 5e28 3f50 3c74 6974 6c65  egex="^(?P<title
+00012d40: 3e70 5c5c 2e5c 5c64 2b29 222c 0a20 2020  >p\\.\\d+)",.   
+00012d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012d60: 2020 2020 2020 2020 2020 2061 6464 5f74             add_t
+00012d70: 6974 6c65 3d22 7c22 2c20 7374 796c 653d  itle="|", style=
+00012d80: 227b 636f 6c6f 7220 3a20 7075 7270 6c65  "{color : purple
+00012d90: 7d22 2929 0a20 2020 2020 2020 2061 6e6e  }")).        ann
+00012da0: 6f74 6174 6f72 2e61 6464 5f63 6f6d 6d61  otator.add_comma
+00012db0: 6e64 280a 2020 2020 2020 2020 2020 2020  nd(.            
+00012dc0: 416e 6e6f 7461 746f 7243 6f6d 6d61 6e64  AnnotatorCommand
+00012dd0: 2868 746d 6c5f 636c 6173 733d 2266 6163  (html_class="fac
+00012de0: 7422 2c20 7870 6174 683d 2273 656c 663a  t", xpath="self:
+00012df0: 3a73 7061 6e5b 636f 6e74 6169 6e73 2840  :span[contains(@
+00012e00: 636c 6173 732c 2027 636f 6e66 6964 656e  class, 'confiden
+00012e10: 6365 2729 5d2f 7072 6563 6564 696e 672d  ce')]/preceding-
+00012e20: 7369 626c 696e 673a 3a73 7061 6e5b 315d  sibling::span[1]
+00012e30: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00012e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012e50: 2073 7479 6c65 3d22 7b63 6f6c 6f72 203a   style="{color :
+00012e60: 2070 7572 706c 657d 2229 290a 2020 2020   purple}")).    
+00012e70: 2020 2020 616e 6e6f 7461 746f 722e 6164      annotator.ad
+00012e80: 645f 636f 6d6d 616e 6428 0a20 2020 2020  d_command(.     
+00012e90: 2020 2020 2020 2041 6e6e 6f74 6174 6f72         Annotator
+00012ea0: 436f 6d6d 616e 6428 6874 6d6c 5f63 6c61  Command(html_cla
+00012eb0: 7373 3d22 6772 6f75 7022 2c20 6772 6f75  ss="group", grou
+00012ec0: 705f 7870 6174 683d 2264 6976 5b73 7061  p_xpath="div[spa
+00012ed0: 6e5b 636f 6e74 6169 6e73 2840 636c 6173  n[contains(@clas
+00012ee0: 732c 2027 7374 6172 7427 295d 5d22 2c0a  s, 'start')]]",.
+00012ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012f00: 2020 2020 2020 2020 2020 2020 2065 6e64               end
+00012f10: 5f78 7061 7468 3d22 7365 6c66 3a3a 6469  _xpath="self::di
+00012f20: 765b 7370 616e 5b63 6f6e 7461 696e 7328  v[span[contains(
+00012f30: 7465 7874 2829 2c27 454e 4427 295d 5d22  text(),'END')]]"
+00012f40: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00012f50: 2020 2020 2020 2020 2020 2020 2020 6465                de
+00012f60: 7363 3d22 3f65 7874 7261 6374 7320 6772  sc="?extracts gr
+00012f70: 6f75 7073 2061 6e64 206d 6d6f 7665 7320  oups and mmoves 
+00012f80: 746f 2065 6e64 2229 290a 2020 2020 2020  to end")).      
+00012f90: 2020 616e 6e6f 7461 746f 722e 6164 645f    annotator.add_
+00012fa0: 636f 6d6d 616e 6428 0a20 2020 2020 2020  command(.       
+00012fb0: 2020 2020 2041 6e6e 6f74 6174 6f72 436f       AnnotatorCo
+00012fc0: 6d6d 616e 6428 6874 6d6c 5f63 6c61 7373  mmand(html_class
+00012fd0: 3d22 7375 6273 7562 7365 6374 696f 6e22  ="subsubsection"
+00012fe0: 2c20 6772 6f75 705f 7870 6174 683d 2264  , group_xpath="d
+00012ff0: 6976 5b73 7061 6e5b 636f 6e74 6169 6e73  iv[span[contains
+00013000: 2840 636c 6173 732c 2027 7375 6273 7562  (@class, 'subsub
+00013010: 7365 6374 696f 6e5f 7469 746c 6527 295d  section_title')]
+00013020: 5d22 2c0a 2020 2020 2020 2020 2020 2020  ]",.            
+00013030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013040: 2065 6e64 5f78 7061 7468 3d22 7365 6c66   end_xpath="self
+00013050: 3a3a 6469 765b 7370 616e 5b63 6f6e 7461  ::div[span[conta
+00013060: 696e 7328 7465 7874 2829 2c27 7365 6374  ins(text(),'sect
+00013070: 696f 6e5f 7469 746c 6527 295d 5d22 2929  ion_title')]]"))
+00013080: 0a20 2020 2020 2020 2061 6e6e 6f74 6174  .        annotat
+00013090: 6f72 2e61 6464 5f63 6f6d 6d61 6e64 280a  or.add_command(.
+000130a0: 2020 2020 2020 2020 2020 2020 416e 6e6f              Anno
+000130b0: 7461 746f 7243 6f6d 6d61 6e64 2868 746d  tatorCommand(htm
+000130c0: 6c5f 636c 6173 733d 2266 6f6f 746e 6f74  l_class="footnot
+000130d0: 6522 2c20 7870 6174 683d 222f 2f64 6976  e", xpath="//div
+000130e0: 5b73 7061 6e5b 636f 6e74 6169 6e73 2840  [span[contains(@
+000130f0: 7374 796c 652c 2027 666f 6e74 2d73 697a  style, 'font-siz
+00013100: 653a 2036 2e30 2729 2061 6e64 206e 756d  e: 6.0') and num
+00013110: 6265 7228 2e29 3d6e 756d 6265 7228 2e29  ber(.)=number(.)
+00013120: 5d5d 222c 0a20 2020 2020 2020 2020 2020  ]]",.           
+00013130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013140: 2020 6465 7363 3d22 686f 7272 6962 6c65    desc="horrible
+00013150: 2068 6163 6b20 7465 7374 696e 6720 666f   hack testing fo
+00013160: 6e74 2d73 697a 6522 2929 0a0a 0a20 2020  nt-size"))...   
+00013170: 2020 2020 2072 6574 7572 6e20 616e 6e6f       return anno
+00013180: 7461 746f 720a 0a0a 414e 4e5f 5350 4c49  tator...ANN_SPLI
+00013190: 5420 3d20 227c 220a 4c45 4e5f 5449 544c  T = "|".LEN_TITL
+000131a0: 4520 3d20 3530 0a63 6c61 7373 2041 6e6e  E = 50.class Ann
+000131b0: 6f74 6174 6f72 436f 6d6d 616e 643a 0a20  otatorCommand:. 
+000131c0: 2020 2022 2222 616e 2061 6e6e 6f74 6174     """an annotat
+000131d0: 696f 6e20 636f 6d6d 616e 640a 2020 2020  ion command.    
+000131e0: 652e 672e 0a20 2020 2063 6f6d 6d61 6e64  e.g..    command
+000131f0: 203d 2041 6e6e 6f74 6174 6f72 436f 6d6d   = AnnotatorComm
+00013200: 616e 6428 6874 6d6c 5f63 6c61 7373 3d22  and(html_class="
+00013210: 7365 6374 696f 6e5f 7469 746c 6522 2c20  section_title", 
+00013220: 7265 6765 783d 2253 6563 7469 6f6e 5c5c  regex="Section\\
+00013230: 732b 283f 503c 6964 3e5c 5c64 2b29 3a5c  s+(?P<id>\\d+):\
+00013240: 5c73 2b28 3f50 3c74 6974 6c65 3e2e 2a29  \s+(?P<title>.*)
+00013250: 222c 2061 6464 5f69 643d 5472 7565 2c20  ", add_id=True, 
+00013260: 6164 645f 7469 746c 653d 5472 7565 290a  add_title=True).
+00013270: 2020 2020 616e 6e6f 7461 746f 722e 6164      annotator.ad
+00013280: 645f 636f 6d6d 616e 6428 636f 6d6d 616e  d_command(comman
+00013290: 6429 0a20 2020 2061 6e6e 6f74 6174 6f72  d).    annotator
+000132a0: 2e72 756e 5f63 6f6d 6d61 6e64 730a 0a20  .run_commands.. 
+000132b0: 2020 2022 2222 0a0a 2020 2020 6465 6620     """..    def 
+000132c0: 5f5f 696e 6974 5f5f 2873 656c 662c 2068  __init__(self, h
+000132d0: 746d 6c5f 636c 6173 733d 4e6f 6e65 2c20  tml_class=None, 
+000132e0: 7265 6765 783d 4e6f 6e65 2c20 6164 645f  regex=None, add_
+000132f0: 6964 3d4e 6f6e 652c 2061 6464 5f74 6974  id=None, add_tit
+00013300: 6c65 3d4e 6f6e 652c 2073 6372 6970 743d  le=None, script=
+00013310: 4e6f 6e65 2c20 7374 796c 653d 4e6f 6e65  None, style=None
+00013320: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00013330: 2020 2064 656c 6574 653d 4661 6c73 652c     delete=False,
+00013340: 2078 7061 7468 3d4e 6f6e 652c 2067 726f   xpath=None, gro
+00013350: 7570 5f78 7061 7468 3d4e 6f6e 652c 2065  up_xpath=None, e
+00013360: 6e64 5f78 7061 7468 3d4e 6f6e 652c 2064  nd_xpath=None, d
+00013370: 6573 633d 4e6f 6e65 293a 0a20 2020 2020  esc=None):.     
+00013380: 2020 2073 656c 662e 6874 6d6c 5f63 6c61     self.html_cla
+00013390: 7373 203d 2068 746d 6c5f 636c 6173 730a  ss = html_class.
+000133a0: 2020 2020 2020 2020 7365 6c66 2e72 6520          self.re 
+000133b0: 3d20 4e6f 6e65 0a20 2020 2020 2020 2069  = None.        i
+000133c0: 6620 7265 6765 783a 0a20 2020 2020 2020  f regex:.       
+000133d0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+000133e0: 2020 2020 2020 2020 2020 7365 6c66 2e72            self.r
+000133f0: 6520 3d20 7265 2e63 6f6d 7069 6c65 2872  e = re.compile(r
+00013400: 6567 6578 290a 2020 2020 2020 2020 2020  egex).          
+00013410: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+00013420: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
+00013430: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00013440: 616c 7565 4572 726f 7228 6622 4361 6e6e  alueError(f"Cann
+00013450: 6f74 2063 6f6d 7069 6c65 2072 6567 6578  ot compile regex
+00013460: 207b 7265 6765 787d 2062 6563 6175 7365   {regex} because
+00013470: 207b 657d 2229 0a0a 2020 2020 2020 2020   {e}")..        
+00013480: 2320 6164 645f 6964 2061 6e64 2061 6464  # add_id and add
+00013490: 5f74 6974 6c65 2061 7265 206f 6620 666f  _title are of fo
+000134a0: 726d 2066 6f6f 7c62 6172 2077 6865 7265  rm foo|bar where
+000134b0: 2065 7874 7261 6374 6564 2069 6420 7265   extracted id re
+000134c0: 706c 6163 6573 207c 0a20 2020 2020 2020  places |.       
+000134d0: 2069 6620 6164 645f 6964 3a0a 2020 2020   if add_id:.    
+000134e0: 2020 2020 2020 2020 6164 645f 6964 203d          add_id =
+000134f0: 2061 6464 5f69 642e 7370 6c69 7428 414e   add_id.split(AN
+00013500: 4e5f 5350 4c49 5429 0a20 2020 2020 2020  N_SPLIT).       
+00013510: 2073 656c 662e 6164 645f 6964 203d 204e   self.add_id = N
+00013520: 6f6e 6520 6966 206e 6f74 2061 6464 5f69  one if not add_i
+00013530: 6420 6f72 206c 656e 2861 6464 5f69 6429  d or len(add_id)
+00013540: 2021 3d20 3220 656c 7365 2061 6464 5f69   != 2 else add_i
+00013550: 640a 2020 2020 2020 2020 6966 2061 6464  d.        if add
+00013560: 5f74 6974 6c65 3a0a 2020 2020 2020 2020  _title:.        
+00013570: 2020 2020 6164 645f 7469 746c 6520 3d20      add_title = 
+00013580: 6164 645f 7469 746c 652e 7370 6c69 7428  add_title.split(
+00013590: 414e 4e5f 5350 4c49 5429 0a20 2020 2020  ANN_SPLIT).     
+000135a0: 2020 2073 656c 662e 6164 645f 7469 746c     self.add_titl
+000135b0: 653d 204e 6f6e 6520 6966 206e 6f74 2061  e= None if not a
+000135c0: 6464 5f74 6974 6c65 206f 7220 6c65 6e28  dd_title or len(
+000135d0: 6164 645f 7469 746c 6529 2021 3d20 3220  add_title) != 2 
+000135e0: 656c 7365 2061 6464 5f74 6974 6c65 0a0a  else add_title..
+000135f0: 2020 2020 2020 2020 7365 6c66 2e68 746d          self.htm
+00013600: 6c5f 636c 6173 7320 3d20 6874 6d6c 5f63  l_class = html_c
+00013610: 6c61 7373 0a20 2020 2020 2020 2073 656c  lass.        sel
+00013620: 662e 7363 7269 7074 203d 2073 6372 6970  f.script = scrip
+00013630: 740a 2020 2020 2020 2020 7365 6c66 2e73  t.        self.s
+00013640: 7479 6c65 203d 2073 7479 6c65 0a20 2020  tyle = style.   
+00013650: 2020 2020 2073 656c 662e 6465 6c65 7465       self.delete
+00013660: 203d 2064 656c 6574 650a 2020 2020 2020   = delete.      
+00013670: 2020 7365 6c66 2e78 7061 7468 203d 2078    self.xpath = x
+00013680: 7061 7468 0a20 2020 2020 2020 2073 656c  path.        sel
+00013690: 662e 6772 6f75 705f 7870 6174 6820 3d20  f.group_xpath = 
+000136a0: 6772 6f75 705f 7870 6174 680a 2020 2020  group_xpath.    
+000136b0: 2020 2020 7365 6c66 2e65 6e64 5f78 7061      self.end_xpa
+000136c0: 7468 203d 2065 6e64 5f78 7061 7468 0a20  th = end_xpath. 
+000136d0: 2020 2020 2020 2073 656c 662e 6465 7363         self.desc
+000136e0: 203d 2064 6573 630a 0a23 2063 6c61 7373   = desc..# class
+000136f0: 2041 6e6e 6f74 6174 6f72 436f 6d6d 616e   AnnotatorComman
+00013700: 640a 0a20 2020 2064 6566 2072 756e 5f63  d..    def run_c
+00013710: 6f6d 6d61 6e64 2873 656c 662c 2065 6c65  ommand(self, ele
+00013720: 6d29 3a0a 2020 2020 2020 2020 2320 7072  m):.        # pr
+00013730: 696e 7428 6622 7275 6e5f 636f 6d6d 616e  int(f"run_comman
+00013740: 6420 2c20 7461 672c 207b 656c 656d 2e74  d , tag, {elem.t
+00013750: 6167 7d20 7061 7265 6e74 3a20 7b65 6c65  ag} parent: {ele
+00013760: 6d2e 6765 7470 6172 656e 7428 297d 2229  m.getparent()}")
+00013770: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00013780: 2e72 653a 0a20 2020 2020 2020 2020 2020  .re:.           
+00013790: 2073 656c 662e 7275 6e5f 7265 6765 7828   self.run_regex(
+000137a0: 656c 656d 290a 2020 2020 2020 2020 2320  elem).        # 
+000137b0: 656c 6966 2073 656c 662e 6578 7472 6163  elif self.extrac
+000137c0: 743a 0a20 2020 2020 2020 2023 2020 2020  t:.        #    
+000137d0: 2073 656c 662e 7275 6e5f 6578 7472 6163   self.run_extrac
+000137e0: 7428 656c 656d 290a 2020 2020 2020 2020  t(elem).        
+000137f0: 656c 6966 2073 656c 662e 7870 6174 6820  elif self.xpath 
+00013800: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00013810: 6c66 2e72 756e 5f78 7061 7468 2865 6c65  lf.run_xpath(ele
+00013820: 6d29 0a20 2020 2020 2020 2065 6c69 6620  m).        elif 
+00013830: 7365 6c66 2e73 6372 6970 7420 3d3d 2022  self.script == "
+00013840: 7375 6222 3a0a 2020 2020 2020 2020 2020  sub":.          
+00013850: 2020 7365 6c66 2e72 756e 5f73 7562 7363    self.run_subsc
+00013860: 7269 7074 2865 6c65 6d29 0a20 2020 2020  ript(elem).     
+00013870: 2020 2065 6c69 6620 7365 6c66 2e73 6372     elif self.scr
+00013880: 6970 7420 3d3d 2022 7375 7065 7222 3a0a  ipt == "super":.
+00013890: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000138a0: 2e72 756e 5f73 7570 6572 7363 7269 7074  .run_superscript
+000138b0: 2865 6c65 6d29 0a20 2020 2020 2020 2065  (elem).        e
+000138c0: 6c69 6620 7365 6c66 2e67 726f 7570 5f78  lif self.group_x
+000138d0: 7061 7468 2069 7320 6e6f 7420 4e6f 6e65  path is not None
+000138e0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+000138f0: 6c66 2e72 756e 5f67 726f 7570 5f78 7061  lf.run_group_xpa
+00013900: 7468 2865 6c65 6d29 0a0a 2020 2020 2320  th(elem)..    # 
+00013910: 636c 6173 7320 416e 6e6f 7461 746f 7243  class AnnotatorC
+00013920: 6f6d 6d61 6e64 0a0a 2020 2020 6465 6620  ommand..    def 
+00013930: 7275 6e5f 7265 6765 7828 7365 6c66 2c20  run_regex(self, 
+00013940: 656c 656d 293a 0a20 2020 2020 2020 2074  elem):.        t
+00013950: 6578 7420 3d20 656c 656d 2e74 6578 740a  ext = elem.text.
+00013960: 2020 2020 2020 2020 6966 2074 6578 7420          if text 
+00013970: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00013980: 2020 2020 2070 7269 6e74 2866 2272 6567       print(f"reg
+00013990: 6578 3a20 4e6f 6e65 2074 6578 7420 696e  ex: None text in
+000139a0: 207b 656c 656d 7d20 7b65 6c65 6d2e 7461   {elem} {elem.ta
+000139b0: 677d 2229 0a20 2020 2020 2020 2020 2020  g}").           
+000139c0: 2072 6574 7572 6e0a 2020 2020 2020 2020   return.        
+000139d0: 6d61 7463 6820 3d20 4e6f 6e65 0a20 2020  match = None.   
+000139e0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+000139f0: 2020 2020 2020 6d61 7463 6820 3d20 7365        match = se
+00013a00: 6c66 2e72 652e 6d61 7463 6828 7465 7874  lf.re.match(text
+00013a10: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
+00013a20: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
+00013a30: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+00013a40: 6e74 2866 226d 6174 6368 2066 6169 6c20  nt(f"match fail 
+00013a50: 7b65 7d22 290a 2020 2020 2020 2020 2020  {e}").          
+00013a60: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
+00013a70: 2069 6620 6d61 7463 683a 0a20 2020 2020   if match:.     
+00013a80: 2020 2020 2020 2069 6620 7365 6c66 2e64         if self.d
+00013a90: 656c 6574 653a 0a20 2020 2020 2020 2020  elete:.         
+00013aa0: 2020 2020 2020 2073 656c 662e 7265 6d6f         self.remo
+00013ab0: 7665 5f65 6c65 6d28 656c 656d 290a 2020  ve_elem(elem).  
+00013ac0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00013ad0: 7475 726e 0a20 2020 2020 2020 2020 2020  turn.           
+00013ae0: 2069 6620 7365 6c66 2e61 6464 5f69 6420   if self.add_id 
+00013af0: 616e 6420 2269 6422 2069 6e20 6d61 7463  and "id" in matc
+00013b00: 682e 6772 6f75 7064 6963 7428 293a 0a20  h.groupdict():. 
+00013b10: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00013b20: 6c65 6d2e 6174 7472 6962 5b22 6964 225d  lem.attrib["id"]
+00013b30: 203d 2073 656c 662e 6164 645f 6964 5b30   = self.add_id[0
+00013b40: 5d20 2b20 6d61 7463 682e 6772 6f75 7028  ] + match.group(
+00013b50: 2269 6422 2920 2b20 7365 6c66 2e61 6464  "id") + self.add
+00013b60: 5f69 645b 315d 0a20 2020 2020 2020 2020  _id[1].         
+00013b70: 2020 2069 6620 7365 6c66 2e61 6464 5f74     if self.add_t
+00013b80: 6974 6c65 2061 6e64 2022 7469 746c 6522  itle and "title"
+00013b90: 2069 6e20 6d61 7463 682e 6772 6f75 7064   in match.groupd
+00013ba0: 6963 7428 293a 0a20 2020 2020 2020 2020  ict():.         
+00013bb0: 2020 2020 2020 2065 6c65 6d2e 6174 7472         elem.attr
+00013bc0: 6962 5b22 7469 746c 6522 5d20 3d20 7365  ib["title"] = se
+00013bd0: 6c66 2e61 6464 5f74 6974 6c65 5b30 5d20  lf.add_title[0] 
+00013be0: 2b20 6d61 7463 682e 6772 6f75 7028 2274  + match.group("t
+00013bf0: 6974 6c65 2229 202b 2073 656c 662e 6164  itle") + self.ad
+00013c00: 645f 7469 746c 655b 315d 5b3a 4c45 4e5f  d_title[1][:LEN_
+00013c10: 5449 544c 455d 0a20 2020 2020 2020 2020  TITLE].         
+00013c20: 2020 2069 6620 7365 6c66 2e68 746d 6c5f     if self.html_
+00013c30: 636c 6173 733a 0a20 2020 2020 2020 2020  class:.         
+00013c40: 2020 2020 2020 2073 656c 662e 7570 6461         self.upda
+00013c50: 7465 5f63 6c61 7373 2865 6c65 6d2c 2073  te_class(elem, s
+00013c60: 656c 662e 6874 6d6c 5f63 6c61 7373 290a  elf.html_class).
+00013c70: 0a20 2020 2023 2063 6c61 7373 2041 6e6e  .    # class Ann
+00013c80: 6f74 6174 6f72 436f 6d6d 616e 640a 0a20  otatorCommand.. 
+00013c90: 2020 2064 6566 2072 756e 5f78 7061 7468     def run_xpath
+00013ca0: 2873 656c 662c 2065 6c65 6d29 3a0a 2020  (self, elem):.  
+00013cb0: 2020 2020 2020 7870 5f65 6c65 6d73 203d        xp_elems =
+00013cc0: 2065 6c65 6d2e 7870 6174 6828 7365 6c66   elem.xpath(self
+00013cd0: 2e78 7061 7468 290a 2020 2020 2020 2020  .xpath).        
+00013ce0: 6966 206e 6f74 2078 705f 656c 656d 733a  if not xp_elems:
+00013cf0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00013d00: 7572 6e0a 2020 2020 2020 2020 666f 7220  urn.        for 
+00013d10: 7870 5f65 6c65 6d20 696e 2078 705f 656c  xp_elem in xp_el
+00013d20: 656d 733a 0a20 2020 2020 2020 2020 2020  ems:.           
+00013d30: 2069 6620 7365 6c66 2e64 656c 6574 653a   if self.delete:
+00013d40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013d50: 2078 705f 656c 656d 2e67 6574 7061 7265   xp_elem.getpare
+00013d60: 6e74 2829 2e72 656d 6f76 6528 7870 5f65  nt().remove(xp_e
+00013d70: 6c65 6d29 0a20 2020 2020 2020 2020 2020  lem).           
+00013d80: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
+00013d90: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00013da0: 6874 6d6c 5f63 6c61 7373 3a0a 2020 2020  html_class:.    
+00013db0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00013dc0: 2e75 7064 6174 655f 636c 6173 7328 7870  .update_class(xp
+00013dd0: 5f65 6c65 6d2c 2073 656c 662e 6874 6d6c  _elem, self.html
+00013de0: 5f63 6c61 7373 290a 2020 2020 2020 2020  _class).        
+00013df0: 2020 2020 2020 2020 746f 7374 7269 6e67          tostring
+00013e00: 203d 2045 542e 746f 7374 7269 6e67 2878   = ET.tostring(x
+00013e10: 705f 656c 656d 290a 2020 2020 2020 2020  p_elem).        
+00013e20: 2020 2020 2020 2020 7061 7373 0a0a 2020          pass..  
+00013e30: 2020 2320 636c 6173 7320 416e 6e6f 7461    # class Annota
+00013e40: 746f 7243 6f6d 6d61 6e64 0a0a 2020 2020  torCommand..    
+00013e50: 6465 6620 7570 6461 7465 5f63 6c61 7373  def update_class
+00013e60: 2873 656c 662c 2065 6c65 6d2c 2068 746d  (self, elem, htm
+00013e70: 6c5f 636c 6173 7329 3a0a 2020 2020 2020  l_class):.      
+00013e80: 2020 636c 6173 7365 7320 3d20 5b5d 0a20    classes = []. 
+00013e90: 2020 2020 2020 2048 746d 6c43 6c61 7373         HtmlClass
+00013ea0: 2e73 6574 5f63 6c61 7373 5f6f 6e5f 656c  .set_class_on_el
+00013eb0: 656d 656e 7428 656c 656d 2c20 6874 6d6c  ement(elem, html
+00013ec0: 5f63 6c61 7373 290a 2020 2020 2020 2020  _class).        
+00013ed0: 6966 2046 616c 7365 3a0a 2020 2020 2020  if False:.      
+00013ee0: 2020 2020 2020 6966 2065 6c65 6d2e 6174        if elem.at
+00013ef0: 7472 6962 2e67 6574 2822 636c 6173 7322  trib.get("class"
+00013f00: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00013f10: 2020 2063 6c61 7373 6573 203d 2065 6c65     classes = ele
+00013f20: 6d2e 6174 7472 6962 5b22 636c 6173 7322  m.attrib["class"
+00013f30: 5d2e 7370 6c69 7428 2220 2229 0a20 2020  ].split(" ").   
+00013f40: 2020 2020 2020 2020 2069 6620 6874 6d6c           if html
+00013f50: 5f63 6c61 7373 206e 6f74 2069 6e20 636c  _class not in cl
+00013f60: 6173 7365 733a 0a20 2020 2020 2020 2020  asses:.         
+00013f70: 2020 2020 2020 2063 6c61 7373 6573 2e61         classes.a
+00013f80: 7070 656e 6428 6874 6d6c 5f63 6c61 7373  ppend(html_class
+00013f90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00013fa0: 2020 656c 656d 2e61 7474 7269 625b 2263    elem.attrib["c
+00013fb0: 6c61 7373 225d 203d 2022 2022 2e6a 6f69  lass"] = " ".joi
+00013fc0: 6e28 636c 6173 7365 7329 0a0a 2020 2020  n(classes)..    
+00013fd0: 6465 6620 7275 6e5f 7375 6273 6372 6970  def run_subscrip
+00013fe0: 7428 7365 6c66 2c20 7370 616e 293a 0a20  t(self, span):. 
+00013ff0: 2020 2020 2020 2069 735f 7375 6220 3d20         is_sub = 
+00014000: 4874 6d6c 5574 696c 2e61 6e6e 6f74 6174  HtmlUtil.annotat
+00014010: 655f 7363 7269 7074 5f74 7970 6528 7370  e_script_type(sp
+00014020: 616e 2c20 5353 6372 6970 742e 5355 422c  an, SScript.SUB,
+00014030: 2079 646f 776e 3d46 616c 7365 290a 2020   ydown=False).  
+00014040: 2020 2020 2020 6966 2069 735f 7375 623a        if is_sub:
+00014050: 0a20 2020 2020 2020 2020 2020 2073 7061  .            spa
+00014060: 6e2e 6174 7472 6962 5b22 7469 746c 6522  n.attrib["title"
+00014070: 5d20 3d20 2273 7562 7363 7269 7074 5f7b  ] = "subscript_{
+00014080: 7370 616e 2e74 6578 747d 220a 2020 2020  span.text}".    
+00014090: 2020 2020 2020 2020 7072 696e 7428 6622          print(f"
+000140a0: 5355 4220 7b73 7061 6e2e 7465 7874 7d22  SUB {span.text}"
+000140b0: 290a 0a20 2020 2023 2063 6c61 7373 2041  )..    # class A
+000140c0: 6e6e 6f74 6174 6f72 436f 6d6d 616e 640a  nnotatorCommand.
+000140d0: 0a20 2020 2064 6566 2072 756e 5f73 7570  .    def run_sup
+000140e0: 6572 7363 7269 7074 2873 656c 662c 2073  erscript(self, s
+000140f0: 7061 6e29 3a0a 2020 2020 2020 2020 6973  pan):.        is
+00014100: 5f73 7570 6572 203d 2048 746d 6c55 7469  _super = HtmlUti
+00014110: 6c2e 616e 6e6f 7461 7465 5f73 6372 6970  l.annotate_scrip
+00014120: 745f 7479 7065 2873 7061 6e2c 2053 5363  t_type(span, SSc
+00014130: 7269 7074 2e53 5550 2c20 7964 6f77 6e3d  ript.SUP, ydown=
+00014140: 4661 6c73 6529 0a20 2020 2020 2020 2069  False).        i
+00014150: 6620 6973 5f73 7570 6572 3a0a 2020 2020  f is_super:.    
+00014160: 2020 2020 2020 2020 7370 616e 2e61 7474          span.att
+00014170: 7269 625b 2274 6974 6c65 225d 203d 2066  rib["title"] = f
+00014180: 2273 7570 6572 7363 7269 7074 5f7b 7370  "superscript_{sp
+00014190: 616e 2e74 6578 747d 220a 0a20 2020 2023  an.text}"..    #
+000141a0: 2063 6c61 7373 2041 6e6e 6f74 6174 6f72   class Annotator
+000141b0: 436f 6d6d 616e 640a 0a20 2020 2064 6566  Command..    def
+000141c0: 2072 756e 5f67 726f 7570 5f78 7061 7468   run_group_xpath
+000141d0: 2873 656c 662c 2063 6869 6c64 5f65 6c65  (self, child_ele
+000141e0: 6d29 3a0a 2020 2020 2020 2020 2222 2267  m):.        """g
+000141f0: 726f 7570 2066 6f6c 6c6f 7769 6e67 2073  roup following s
+00014200: 6962 6c69 6e67 7320 6f66 2065 6c65 6d22  iblings of elem"
+00014210: 2222 0a0a 2020 2020 2020 2020 7265 7375  ""..        resu
+00014220: 6c74 203d 204e 6f6e 650a 2020 2020 2020  lt = None.      
+00014230: 2020 6966 2063 6869 6c64 5f65 6c65 6d20    if child_elem 
+00014240: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00014250: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+00014260: 0a20 2020 2020 2020 2070 6172 656e 745f  .        parent_
+00014270: 656c 656d 203d 2063 6869 6c64 5f65 6c65  elem = child_ele
+00014280: 6d2e 6765 7470 6172 656e 7428 290a 2020  m.getparent().  
+00014290: 2020 2020 2020 6966 2070 6172 656e 745f        if parent_
+000142a0: 656c 656d 2069 7320 4e6f 6e65 3a0a 2020  elem is None:.  
+000142b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000142c0: 204e 6f6e 650a 2020 2020 2020 2020 6772   None.        gr
+000142d0: 6f75 705f 6c65 6164 7320 3d20 7061 7265  oup_leads = pare
+000142e0: 6e74 5f65 6c65 6d2e 7870 6174 6828 7365  nt_elem.xpath(se
+000142f0: 6c66 2e67 726f 7570 5f78 7061 7468 290a  lf.group_xpath).
+00014300: 2020 2020 2020 2020 6966 206c 656e 2867          if len(g
+00014310: 726f 7570 5f6c 6561 6473 2920 3e20 303a  roup_leads) > 0:
+00014320: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+00014330: 6e74 2866 2267 726f 7570 206c 6561 6420  nt(f"group lead 
+00014340: 636f 756e 7420 7b6c 656e 2867 726f 7570  count {len(group
+00014350: 5f6c 6561 6473 297d 207b 7365 6c66 2e67  _leads)} {self.g
+00014360: 726f 7570 5f78 7061 7468 7d22 290a 2020  roup_xpath}").  
+00014370: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00014380: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
+00014390: 2020 2020 2066 6f72 2069 2c20 6772 6f75       for i, grou
+000143a0: 705f 6c65 6164 2069 6e20 656e 756d 6572  p_lead in enumer
+000143b0: 6174 6528 6772 6f75 705f 6c65 6164 7329  ate(group_leads)
+000143c0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+000143d0: 7072 696e 7428 6622 6772 6f75 7020 6c65  print(f"group le
+000143e0: 6164 207b 4554 2e74 6f73 7472 696e 6728  ad {ET.tostring(
+000143f0: 6772 6f75 705f 6c65 6164 297d 2229 0a20  group_lead)}"). 
+00014400: 2020 2020 2020 2020 2020 2023 2065 6e64             # end
+00014410: 5f67 726f 756f 203d 2067 726f 7570 5f6c  _grouo = group_l
+00014420: 6561 6473 5b69 202b 2031 5d20 6966 2069  eads[i + 1] if i
+00014430: 203c 206c 656e 2867 726f 7570 5f6c 6561   < len(group_lea
+00014440: 6473 2920 2d20 3120 656c 7365 204e 6f6e  ds) - 1 else Non
+00014450: 650a 2020 2020 2020 2020 2020 2020 7365  e.            se
+00014460: 6c66 2e6d 616b 655f 6772 6f75 7028 7061  lf.make_group(pa
+00014470: 7265 6e74 5f65 6c65 6d2c 2067 726f 7570  rent_elem, group
+00014480: 5f6c 6561 6429 0a0a 2020 2020 2320 636c  _lead)..    # cl
+00014490: 6173 7320 416e 6e6f 7461 746f 7243 6f6d  ass AnnotatorCom
+000144a0: 6d61 6e64 0a0a 2020 2020 6465 6620 6d61  mand..    def ma
+000144b0: 6b65 5f67 726f 7570 2873 656c 662c 2065  ke_group(self, e
+000144c0: 6c65 6d2c 2067 726f 7570 5f6c 6561 642c  lem, group_lead,
+000144d0: 2065 6e64 5f67 726f 7570 3d4e 6f6e 6529   end_group=None)
+000144e0: 3a0a 2020 2020 2020 2020 7061 7265 6e74  :.        parent
+000144f0: 203d 2058 6d6c 4c69 622e 6765 7470 6172   = XmlLib.getpar
+00014500: 656e 7428 656c 656d 2c20 6465 6275 673d  ent(elem, debug=
+00014510: 5472 7565 290a 2020 2020 2020 2020 6966  True).        if
+00014520: 2070 6172 656e 7420 6973 204e 6f6e 653a   parent is None:
+00014530: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00014540: 7365 2056 616c 7565 4572 726f 7228 226e  se ValueError("n
+00014550: 756c 6c20 7061 7265 6e74 2229 0a20 2020  ull parent").   
+00014560: 2020 2020 2073 6962 6c69 6e67 7320 3d20       siblings = 
+00014570: 6772 6f75 705f 6c65 6164 2e78 7061 7468  group_lead.xpath
+00014580: 2822 666f 6c6c 6f77 696e 672d 7369 626c  ("following-sibl
+00014590: 696e 673a 3a2a 2229 0a20 2020 2020 2020  ing::*").       
+000145a0: 2069 6620 6c65 6e28 7369 626c 696e 6773   if len(siblings
+000145b0: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
+000145c0: 2020 2020 7072 696e 7428 6622 6e6f 2073      print(f"no s
+000145d0: 6962 6c69 6e67 733a 207b 6772 6f75 705f  iblings: {group_
+000145e0: 6c65 6164 2e74 6578 747d 2229 0a20 2020  lead.text}").   
+000145f0: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
+00014600: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00014610: 2020 2020 2020 2020 7072 696e 7428 6622          print(f"
+00014620: 7369 626c 696e 6773 207b 6c65 6e28 7369  siblings {len(si
+00014630: 626c 696e 6773 297d 2121 2122 290a 2020  blings)}!!!").  
+00014640: 2020 2020 2020 6469 7620 3d20 4554 2e53        div = ET.S
+00014650: 7562 456c 656d 656e 7428 7061 7265 6e74  ubElement(parent
+00014660: 2c20 2264 6976 2229 0a20 2020 2020 2020  , "div").       
+00014670: 2064 6976 2e61 7070 656e 6428 6772 6f75   div.append(grou
+00014680: 705f 6c65 6164 290a 2020 2020 2020 2020  p_lead).        
+00014690: 6469 762e 6174 7472 6962 5b22 7469 746c  div.attrib["titl
+000146a0: 6522 5d20 3d20 6772 6f75 705f 6c65 6164  e"] = group_lead
+000146b0: 2e74 6578 7420 6966 2067 726f 7570 5f6c  .text if group_l
+000146c0: 6561 642e 7465 7874 2065 6c73 6520 223f  ead.text else "?
+000146d0: 220a 2020 2020 2020 2020 6469 762e 6174  ".        div.at
+000146e0: 7472 6962 5b22 7374 796c 6522 5d20 3d20  trib["style"] = 
+000146f0: 2262 6f72 6465 723a 626c 6163 6b20 6461  "border:black da
+00014700: 7368 6564 2032 7078 3b22 0a20 2020 2020  shed 2px;".     
+00014710: 2020 2078 7020 3d20 7365 6c66 2e65 6e64     xp = self.end
+00014720: 5f78 7061 7468 0a20 2020 2020 2020 2078  _xpath.        x
+00014730: 7020 3d20 2273 656c 663a 3a64 6976 5b73  p = "self::div[s
+00014740: 7061 6e5b 636f 6e74 6169 6e73 2874 6578  pan[contains(tex
+00014750: 7428 292c 2745 4e44 2729 5d5d 220a 2020  t(),'END')]]".  
+00014760: 2020 2020 2020 2320 7072 696e 7428 6622        # print(f"
+00014770: 656e 645f 7870 6174 6820 7b78 707d 2229  end_xpath {xp}")
+00014780: 0a20 2020 2020 2020 2066 6f72 2073 6962  .        for sib
+00014790: 6c69 6e67 2069 6e20 7369 626c 696e 6773  ling in siblings
+000147a0: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+000147b0: 696e 7428 6622 7369 626c 696e 673a 207b  int(f"sibling: {
+000147c0: 2727 2e6a 6f69 6e28 7369 626c 696e 672e  ''.join(sibling.
+000147d0: 6974 6572 7465 7874 2829 297d 2229 0a20  itertext())}"). 
+000147e0: 2020 2020 2020 2020 2020 2065 6e64 5f73             end_s
+000147f0: 6962 203d 204e 6f6e 650a 2020 2020 2020  ib = None.      
+00014800: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00014810: 2020 2020 2020 2020 2020 2065 6e64 5f73             end_s
+00014820: 6962 203d 2073 6962 6c69 6e67 2e78 7061  ib = sibling.xpa
+00014830: 7468 2878 7029 0a20 2020 2020 2020 2020  th(xp).         
+00014840: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+00014850: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
+00014860: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00014870: 6622 6661 696c 6564 2078 7061 7468 207b  f"failed xpath {
+00014880: 7870 7d20 7b65 7d22 290a 2020 2020 2020  xp} {e}").      
+00014890: 2020 2020 2020 6966 2065 6e64 5f73 6962        if end_sib
+000148a0: 2061 6e64 206c 656e 2865 6e64 5f73 6962   and len(end_sib
+000148b0: 2920 3e20 303a 0a20 2020 2020 2020 2020  ) > 0:.         
+000148c0: 2020 2023 2069 6620 7369 626c 696e 6720     # if sibling 
+000148d0: 213d 2065 6e64 5f67 726f 7570 3a0a 2020  != end_group:.  
+000148e0: 2020 2020 2020 2020 2020 2320 2020 2020            #     
+000148f0: 7072 696e 7428 6622 7369 626c 696e 6720  print(f"sibling 
+00014900: 7b73 6962 6c69 6e67 7d22 290a 2020 2020  {sibling}").    
+00014910: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+00014920: 6b0a 2020 2020 2020 2020 2020 2020 6469  k.            di
+00014930: 762e 6170 7065 6e64 2873 6962 6c69 6e67  v.append(sibling
+00014940: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00014950: 2064 6976 0a0a 2020 2020 2320 636c 6173   div..    # clas
+00014960: 7320 416e 6e6f 7461 746f 7243 6f6d 6d61  s AnnotatorComma
+00014970: 6e64 0a0a 2020 2020 6465 6620 7275 6e5f  nd..    def run_
+00014980: 6578 7472 6163 7428 7365 6c66 2c20 656c  extract(self, el
+00014990: 656d 293a 0a0a 2020 2020 2020 2020 2222  em):..        ""
+000149a0: 2265 7874 7261 6374 2067 726f 7570 2e20  "extract group. 
+000149b0: 6f70 7469 6e61 6c6c 7920 7772 6974 6520  optinally write 
+000149c0: 746f 2066 696c 652e 2063 7572 7265 6e74  to file. current
+000149d0: 6c79 204e 4f2d 4f50 2222 220a 2020 2020  ly NO-OP""".    
+000149e0: 2020 2020 7072 696e 7428 6622 7275 6e5f      print(f"run_
+000149f0: 6578 7472 6163 7420 6973 204e 4f2d 4f50  extract is NO-OP
+00014a00: 2229 0a20 2020 2020 2020 2072 6574 7572  ").        retur
+00014a10: 6e20 4e6f 6e65 0a0a 2020 2020 2320 636c  n None..    # cl
+00014a20: 6173 7320 416e 6e6f 7461 746f 7243 6f6d  ass AnnotatorCom
+00014a30: 6d61 6e64 0a0a 2020 2020 6465 6620 7265  mand..    def re
+00014a40: 6d6f 7665 5f65 6c65 6d28 7365 6c66 2c20  move_elem(self, 
+00014a50: 656c 656d 2c20 6465 6275 673d 4661 6c73  elem, debug=Fals
+00014a60: 6529 3a0a 2020 2020 2020 2020 6966 2065  e):.        if e
+00014a70: 6c65 6d20 6973 204e 6f6e 653a 0a20 2020  lem is None:.   
+00014a80: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+00014a90: 2020 2020 2020 2020 7061 7265 6e74 203d          parent =
+00014aa0: 2065 6c65 6d2e 6765 7470 6172 656e 7428   elem.getparent(
+00014ab0: 290a 2020 2020 2020 2020 6966 2070 6172  ).        if par
+00014ac0: 656e 7420 6973 204e 6f6e 653a 0a20 2020  ent is None:.   
+00014ad0: 2020 2020 2020 2020 2069 6620 6465 6275           if debu
+00014ae0: 673a 0a20 2020 2020 2020 2020 2020 2020  g:.             
+00014af0: 2020 2070 7269 6e74 2866 2265 6c65 6d65     print(f"eleme
+00014b00: 6e74 207b 656c 656d 7d20 6861 7320 6e6f  nt {elem} has no
+00014b10: 2070 6172 656e 7422 290a 2020 2020 2020   parent").      
+00014b20: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
+00014b30: 2020 2020 2070 6172 656e 742e 7265 6d6f       parent.remo
+00014b40: 7665 2865 6c65 6d29 0a0a 0a0a 5354 594c  ve(elem)....STYL
+00014b50: 455f 4355 524c 595f 5245 203d 2072 652e  E_CURLY_RE = re.
+00014b60: 636f 6d70 696c 6528 2228 3f50 3c70 7265  compile("(?P<pre
+00014b70: 3e2e 2a29 7b28 3f50 3c76 616c 7565 3e5b  >.*){(?P<value>[
+00014b80: 5e7d 5d2a 297d 283f 503c 706f 7374 3e2e  ^}]*)}(?P<post>.
+00014b90: 2a29 2229 0a63 6c61 7373 2048 746d 6c53  *)").class HtmlS
+00014ba0: 7479 6c65 3a0a 2020 2020 2222 220a 2020  tyle:.    """.  
+00014bb0: 2020 6d65 7468 6f64 7320 746f 2070 726f    methods to pro
+00014bc0: 6365 7373 2073 7479 6c65 2061 7474 7269  cess style attri
+00014bd0: 6275 7465 7320 616e 6420 3c73 7479 6c65  butes and <style
+00014be0: 3e20 656c 656d 656e 7473 0a20 2020 206e  > elements.    n
+00014bf0: 6f20 696e 7374 616e 6365 2064 6174 610a  o instance data.
+00014c00: 2020 2020 2222 220a 0a20 2020 2064 6566      """..    def
+00014c10: 205f 5f69 6e69 745f 5f28 7365 6c66 2c63   __init__(self,c
+00014c20: 7373 5f73 7472 696e 673d 4e6f 6e65 293a  ss_string=None):
+00014c30: 0a20 2020 2020 2020 2073 656c 662e 6373  .        self.cs
+00014c40: 735f 7374 7269 6e67 203d 2063 7373 5f73  s_string = css_s
+00014c50: 7472 696e 670a 0a0a 0a20 2020 2040 636c  tring....    @cl
+00014c60: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+00014c70: 6620 6765 745f 6373 7373 7479 6c65 5f73  f get_cssstyle_s
+00014c80: 7472 696e 6728 636c 732c 2065 6c65 6d29  tring(cls, elem)
+00014c90: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00014ca0: 2020 2020 2020 636f 6e76 656e 6965 6e63        convenienc
+00014cb0: 6520 6d65 7468 6f64 2074 6f20 6765 7420  e method to get 
+00014cc0: 656c 656d 656e 7420 7374 796c 650a 2020  element style.  
+00014cd0: 2020 2020 2020 3a70 6172 616d 2065 6c65        :param ele
+00014ce0: 6d3a 2074 6f20 6765 7420 7374 796c 6520  m: to get style 
+00014cf0: 6672 6f6d 0a20 2020 2020 2020 203a 7265  from.        :re
+00014d00: 7475 726e 3a20 7374 796c 6520 6f72 204e  turn: style or N
+00014d10: 6f6e 650a 2020 2020 2020 2020 2222 220a  one.        """.
+00014d20: 2020 2020 2020 2020 7265 7475 726e 2065          return e
+00014d30: 6c65 6d2e 6174 7472 6962 2e67 6574 2822  lem.attrib.get("
+00014d40: 7374 796c 6522 290a 0a23 2063 6c61 7373  style")..# class
+00014d50: 2048 746d 6c53 7479 6c65 0a0a 2020 2020   HtmlStyle..    
+00014d60: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+00014d70: 2064 6566 2073 6574 5f73 7479 6c65 2863   def set_style(c
+00014d80: 6c73 2c20 656c 656d 2c20 7661 6c75 6529  ls, elem, value)
+00014d90: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00014da0: 2020 2020 2020 636f 6e76 656e 6965 6e63        convenienc
+00014db0: 6520 6d65 7468 6f64 2074 6f20 7365 7420  e method to set 
+00014dc0: 7374 796c 6520 6f6e 2065 6c65 6d65 6e74  style on element
+00014dd0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00014de0: 656c 656d 3a65 6c65 6d65 6e74 2074 6f20  elem:element to 
+00014df0: 7365 7420 7374 796c 6520 6f6e 0a20 2020  set style on.   
+00014e00: 2020 2020 203a 7061 7261 6d20 7661 6c75       :param valu
+00014e10: 653a 2063 7373 2073 7472 696e 673b 2069  e: css string; i
+00014e20: 6620 2222 206f 7220 4e6f 6e65 2072 656d  f "" or None rem
+00014e30: 6c76 6573 2061 7474 7269 6275 7465 0a20  lves attribute. 
+00014e40: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00014e50: 2020 2069 6620 656c 656d 2069 7320 6e6f     if elem is no
+00014e60: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00014e70: 2020 2020 586d 6c4c 6962 2e73 6574 5f61      XmlLib.set_a
+00014e80: 7474 6e61 6d65 5f76 616c 7565 2865 6c65  ttname_value(ele
+00014e90: 6d2c 2022 7374 796c 6522 2c20 7661 6c75  m, "style", valu
+00014ea0: 6529 0a0a 2020 2020 2320 636c 6173 7320  e)..    # class 
+00014eb0: 4874 6d6c 5374 796c 650a 0a20 2020 2040  HtmlStyle..    @
+00014ec0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+00014ed0: 6465 6620 6578 7472 6163 745f 616c 6c5f  def extract_all_
+00014ee0: 7374 796c 655f 6174 7472 6962 7574 6573  style_attributes
+00014ef0: 5f74 6f5f 6865 6164 2863 6c73 2c20 6874  _to_head(cls, ht
+00014f00: 6d6c 5f65 6c65 6d29 3a0a 2020 2020 2020  ml_elem):.      
+00014f10: 2020 2222 220a 2020 2020 2020 2020 4669    """.        Fi
+00014f20: 6e64 7320 616c 6c20 656c 656d 656e 7473  nds all elements
+00014f30: 2077 6974 6820 4073 7479 6c65 2061 7474   with @style att
+00014f40: 7269 6275 7465 2061 6e64 2065 7874 6163  ribute and extac
+00014f50: 7473 2074 6865 2074 6478 7420 7374 796c  ts the tdxt styl
+00014f60: 6573 2074 6f20 3c68 6561 643e 0a20 2020  es to <head>.   
+00014f70: 2020 2020 2041 6c73 6f20 7365 7473 2062       Also sets b
+00014f80: 6f64 7920 7374 796c 6573 2074 6f20 6e6f  ody styles to no
+00014f90: 726d 616c 0a20 2020 2020 2020 203a 7061  rmal.        :pa
+00014fa0: 7261 6d20 6874 6d6c 5f65 6c65 6d3a 2074  ram html_elem: t
+00014fb0: 6f74 616c 2068 746d 6c20 6f62 6a65 6374  otal html object
+00014fc0: 2074 6f20 6e6f 726d 616c 697a 652e 204d   to normalize. M
+00014fd0: 7573 7420 6861 7665 203c 6865 6164 3e20  ust have <head> 
+00014fe0: 616e 6420 3c62 6f64 793e 0a20 2020 2020  and <body>.     
+00014ff0: 2020 2022 2222 0a20 2020 2020 2020 2048     """.        H
+00015000: 746d 6c53 7479 6c65 2e72 656d 6f76 655f  tmlStyle.remove_
+00015010: 656d 7074 795f 7374 796c 6573 2868 746d  empty_styles(htm
+00015020: 6c5f 656c 656d 290a 2020 2020 2020 2020  l_elem).        
+00015030: 7374 796c 6564 5f65 6c65 6d73 203d 2068  styled_elems = h
+00015040: 746d 6c5f 656c 656d 2e78 7061 7468 2822  tml_elem.xpath("
+00015050: 2e2f 2f2a 5b40 7374 796c 655d 2229 0a20  .//*[@style]"). 
+00015060: 2020 2020 2020 2066 6f72 2069 2c20 7374         for i, st
+00015070: 796c 6564 5f65 6c65 6d20 696e 2065 6e75  yled_elem in enu
+00015080: 6d65 7261 7465 2873 7479 6c65 645f 656c  merate(styled_el
+00015090: 656d 7329 3a0a 2020 2020 2020 2020 2020  ems):.          
+000150a0: 2020 636c 6173 7372 6566 203d 2066 2273    classref = f"s
+000150b0: 7b69 7d22 0a20 2020 2020 2020 2020 2020  {i}".           
+000150c0: 2048 746d 6c53 7479 6c65 2e61 6464 5f65   HtmlStyle.add_e
+000150d0: 6c65 6d65 6e74 5f77 6974 685f 7374 796c  lement_with_styl
+000150e0: 6528 636c 6173 7372 6566 2c20 6874 6d6c  e(classref, html
+000150f0: 5f65 6c65 6d2c 2073 7479 6c65 645f 656c  _elem, styled_el
+00015100: 656d 290a 2020 2020 2020 2020 2320 646f  em).        # do
+00015110: 6573 2074 6869 7320 646f 2061 6e79 7468  es this do anyth
+00015120: 696e 673f 3f3f 0a20 2020 2020 2020 2062  ing???.        b
+00015130: 6f64 7920 3d20 6874 6d6c 5f65 6c65 6d2e  ody = html_elem.
+00015140: 7870 6174 6828 222f 6874 6d6c 2f62 6f64  xpath("/html/bod
+00015150: 7922 290a 2020 2020 2020 2020 6966 206c  y").        if l
+00015160: 656e 2862 6f64 7929 2021 3d20 313a 0a20  en(body) != 1:. 
+00015170: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00015180: 2056 616c 7565 4572 726f 7228 6622 646f   ValueError(f"do
+00015190: 6375 6d65 6e74 2073 686f 756c 6420 6861  cument should ha
+000151a0: 7665 2065 7861 6374 6c79 2031 2062 6f64  ve exactly 1 bod
+000151b0: 7920 7461 6722 290a 2020 2020 2020 2020  y tag").        
+000151c0: 7374 796c 6520 3d20 4353 5353 7479 6c65  style = CSSStyle
+000151d0: 2829 0a20 2020 2020 2020 2073 7479 6c65  ().        style
+000151e0: 2e63 7265 6174 655f 6373 735f 7374 796c  .create_css_styl
+000151f0: 655f 6672 6f6d 5f63 7373 5f73 7472 696e  e_from_css_strin
+00015200: 6728 0a20 2020 2020 2020 2020 2020 2022  g(.            "
+00015210: 666f 6e74 2d73 7479 6c65 3a20 6e6f 726d  font-style: norm
+00015220: 616c 3b20 220a 2020 2020 2020 2020 2020  al; ".          
+00015230: 2020 2266 6f6e 742d 7765 6967 6874 3a20    "font-weight: 
+00015240: 6e6f 726d 616c 3b20 220a 2020 2020 2020  normal; ".      
+00015250: 2020 2020 2020 2266 6f6e 742d 7374 7265        "font-stre
+00015260: 7463 6865 643a 206e 6f72 6d61 6c3b 2022  tched: normal; "
+00015270: 0a20 2020 2020 2020 2020 2020 2022 6f70  .            "op
+00015280: 6163 6974 793a 2031 3b20 220a 2020 2020  acity: 1; ".    
+00015290: 2020 2020 2020 2020 2263 6f6c 6f72 3a20          "color: 
+000152a0: 626c 6163 6b3b 220a 2020 2020 2020 2020  black;".        
+000152b0: 290a 0a20 2020 2023 2063 6c61 7373 2048  )..    # class H
+000152c0: 746d 6c53 7479 6c65 0a0a 2020 2020 4063  tmlStyle..    @c
+000152d0: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+000152e0: 6566 2061 6464 5f65 6c65 6d65 6e74 5f77  ef add_element_w
+000152f0: 6974 685f 7374 796c 6528 636c 732c 2063  ith_style(cls, c
+00015300: 6c61 7373 7265 662c 2068 746d 6c5f 656c  lassref, html_el
+00015310: 656d 2c20 7374 796c 6564 5f65 6c65 6d29  em, styled_elem)
+00015320: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00015330: 2020 2020 2020 6164 6473 0a20 2020 2020        adds.     
+00015340: 2020 2022 2222 0a20 2020 2020 2020 2068     """.        h
+00015350: 6561 6420 3d20 6874 6d6c 5f65 6c65 6d2e  ead = html_elem.
+00015360: 7870 6174 6828 222f 6874 6d6c 2f68 6561  xpath("/html/hea
+00015370: 6422 295b 305d 0a20 2020 2020 2020 2065  d")[0].        e
+00015380: 6c65 6d5f 7374 796c 6520 3d20 4874 6d6c  lem_style = Html
+00015390: 5374 796c 652e 6765 745f 6373 7373 7479  Style.get_csssty
+000153a0: 6c65 5f73 7472 696e 6728 7374 796c 6564  le_string(styled
+000153b0: 5f65 6c65 6d29 0a20 2020 2020 2020 2069  _elem).        i
+000153c0: 6620 656c 656d 5f73 7479 6c65 2069 7320  f elem_style is 
+000153d0: 4e6f 6e65 206f 7220 656c 656d 5f73 7479  None or elem_sty
+000153e0: 6c65 203d 3d20 2222 3a0a 2020 2020 2020  le == "":.      
+000153f0: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
+00015400: 2020 2020 2063 7373 203d 2043 5353 5374       css = CSSSt
+00015410: 796c 652e 6372 6561 7465 5f63 7373 5f73  yle.create_css_s
+00015420: 7479 6c65 5f66 726f 6d5f 6373 735f 7374  tyle_from_css_st
+00015430: 7269 6e67 2865 6c65 6d5f 7374 796c 6529  ring(elem_style)
+00015440: 0a20 2020 2020 2020 2069 6620 6373 7320  .        if css 
+00015450: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00015460: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00015470: 4572 726f 7228 6622 6373 7320 6973 204e  Error(f"css is N
+00015480: 6f6e 6522 290a 0a20 2020 2020 2020 2065  one")..        e
+00015490: 7874 7261 6374 6564 5f73 7479 6c65 5f65  xtracted_style_e
+000154a0: 6c65 6d2c 2072 656d 6169 6e69 6e67 5f73  lem, remaining_s
+000154b0: 7479 6c65 2c20 6e65 775f 636c 6173 7320  tyle, new_class 
+000154c0: 3d20 6373 732e 6578 7472 6163 745f 7465  = css.extract_te
+000154d0: 7874 5f73 7479 6c65 735f 696e 746f 5f63  xt_styles_into_c
+000154e0: 6c61 7373 2863 6c61 7373 7265 6629 0a20  lass(classref). 
+000154f0: 2020 2020 2020 2069 6620 6578 7472 6163         if extrac
+00015500: 7465 645f 7374 796c 655f 656c 656d 2069  ted_style_elem i
+00015510: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00015520: 2020 2020 2020 2020 4874 6d6c 5374 796c          HtmlStyl
+00015530: 652e 7365 745f 7374 796c 6528 7374 796c  e.set_style(styl
+00015540: 6564 5f65 6c65 6d2c 2072 656d 6169 6e69  ed_elem, remaini
+00015550: 6e67 5f73 7479 6c65 290a 2020 2020 2020  ng_style).      
+00015560: 2020 2020 2020 4874 6d6c 436c 6173 732e        HtmlClass.
+00015570: 7365 745f 636c 6173 735f 6f6e 5f65 6c65  set_class_on_ele
+00015580: 6d65 6e74 2873 7479 6c65 645f 656c 656d  ment(styled_elem
+00015590: 2c20 636c 6173 7372 6566 2c20 7265 706c  , classref, repl
+000155a0: 6163 653d 4661 6c73 6529 0a20 2020 2020  ace=False).     
+000155b0: 2020 2020 2020 2068 6561 642e 6170 7065         head.appe
+000155c0: 6e64 2865 7874 7261 6374 6564 5f73 7479  nd(extracted_sty
+000155d0: 6c65 5f65 6c65 6d29 0a0a 2020 2020 2320  le_elem)..    # 
+000155e0: 636c 6173 7320 4874 6d6c 5374 796c 650a  class HtmlStyle.
+000155f0: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+00015600: 640a 2020 2020 6465 6620 7265 6d6f 7665  d.    def remove
+00015610: 5f65 6d70 7479 5f73 7479 6c65 7328 636c  _empty_styles(cl
+00015620: 732c 2068 746d 6c5f 656c 656d 293a 0a20  s, html_elem):. 
+00015630: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00015640: 2020 2072 656d 6f76 6573 2061 6c6c 2065     removes all e
+00015650: 6d70 7479 2073 7479 6c65 2061 7474 7269  mpty style attri
+00015660: 6275 7465 7320 2873 7479 6c65 3d22 2229  butes (style="")
+00015670: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00015680: 2020 2020 2065 6d70 7479 5f73 7479 6c65       empty_style
+00015690: 645f 656c 656d 7320 3d20 6874 6d6c 5f65  d_elems = html_e
+000156a0: 6c65 6d2e 7870 6174 6828 222e 2f2f 2a5b  lem.xpath(".//*[
+000156b0: 6e6f 726d 616c 697a 652d 7370 6163 6528  normalize-space(
+000156c0: 4073 7479 6c65 293d 2727 5d22 290a 2020  @style)='']").  
+000156d0: 2020 2020 2020 666f 7220 656c 656d 2069        for elem i
+000156e0: 6e20 656d 7074 795f 7374 796c 6564 5f65  n empty_styled_e
+000156f0: 6c65 6d73 3a0a 2020 2020 2020 2020 2020  lems:.          
+00015700: 2020 4874 6d6c 5374 796c 652e 6465 6c65    HtmlStyle.dele
+00015710: 7465 5f73 7479 6c65 2865 6c65 6d29 0a0a  te_style(elem)..
+00015720: 2020 2020 2320 636c 6173 7320 4874 6d6c      # class Html
+00015730: 5374 796c 650a 0a20 2020 2040 636c 6173  Style..    @clas
+00015740: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+00015750: 6465 6c65 7465 5f73 7479 6c65 2863 6c73  delete_style(cls
+00015760: 2c20 656c 656d 293a 0a20 2020 2020 2020  , elem):.       
+00015770: 2022 2222 0a20 2020 2020 2020 2063 6f6e   """.        con
+00015780: 7665 6e69 656e 6e63 6520 6d65 7468 6f64  veniennce method
+00015790: 2074 6f20 6465 6c65 7465 2073 7479 6c65   to delete style
+000157a0: 2061 7474 7269 6275 7465 0a20 2020 2020   attribute.     
+000157b0: 2020 2022 2222 0a20 2020 2020 2020 2058     """.        X
+000157c0: 6d6c 4c69 622e 7265 6d6f 7665 5f61 7474  mlLib.remove_att
+000157d0: 7269 6275 7465 2865 6c65 6d2c 2022 7374  ribute(elem, "st
+000157e0: 796c 6522 290a 0a20 2020 2023 2054 4845  yle")..    # THE
+000157f0: 5345 2043 414e 2042 4543 4f4d 4520 494e  SE CAN BECOME IN
+00015800: 5354 414e 4345 204d 4554 484f 4453 0a0a  STANCE METHODS..
+00015810: 2020 2020 2320 636c 6173 7320 4874 6d6c      # class Html
+00015820: 5374 796c 650a 0a20 2020 2040 636c 6173  Style..    @clas
+00015830: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+00015840: 6e6f 726d 616c 697a 655f 6865 6164 5f73  normalize_head_s
+00015850: 7479 6c65 7328 636c 732c 2065 6c65 6d2c  tyles(cls, elem,
+00015860: 2069 7461 6c69 635f 626f 6c64 3d54 7275   italic_bold=Tru
+00015870: 652c 206f 7574 6469 723d 4e6f 6e65 293a  e, outdir=None):
+00015880: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00015890: 2020 2020 2063 7265 6174 6573 206d 756c       creates mul
+000158a0: 7469 6469 6374 2066 6f74 2068 6561 6420  tidict fot head 
+000158b0: 7374 796c 6573 0a20 2020 2020 2020 203a  styles.        :
+000158c0: 7061 7261 6d20 656c 656d 3a20 646f 6375  param elem: docu
+000158d0: 6d65 6e74 2074 6f20 616e 616c 7973 650a  ment to analyse.
+000158e0: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
+000158f0: 2064 6963 7420 6f66 2063 6c61 7373 7265   dict of classre
+00015900: 665f 7365 7473 2069 6e64 6578 6564 2062  f_sets indexed b
+00015910: 7920 7374 796c 6520 7374 7269 6e67 730a  y style strings.
+00015920: 0a20 2020 2020 2020 2065 2e67 2e20 6974  .        e.g. it
+00015930: 656d 207b 666f 6e74 2d66 616d 696c 793a  em {font-family:
+00015940: 2054 696d 6573 4e65 7752 6f6d 616e 5053   TimesNewRomanPS
+00015950: 4d54 3b20 666f 6e74 2d73 697a 653a 2036  MT; font-size: 6
+00015960: 7078 3b7d 3a20 5b27 2e73 3137 272c 2027  px;}: ['.s17', '
+00015970: 2e73 3139 272c 2027 2e73 3231 272c 2027  .s19', '.s21', '
+00015980: 2e73 3237 272c 2027 2e73 3527 2c20 272e  .s27', '.s5', '.
+00015990: 7337 275d 0a20 2020 2020 2020 2022 2222  s7'].        """
+000159a0: 0a20 2020 2020 2020 2073 7479 6c65 5f74  .        style_t
+000159b0: 6f5f 636c 6173 7372 6566 5f73 6574 203d  o_classref_set =
+000159c0: 2064 6566 6175 6c74 6469 6374 2873 6574   defaultdict(set
+000159d0: 290a 2020 2020 2020 2020 6865 6164 5f73  ).        head_s
+000159e0: 7479 6c65 7320 3d20 4874 6d6c 5374 796c  tyles = HtmlStyl
+000159f0: 652e 6765 745f 6865 6164 5f73 7479 6c65  e.get_head_style
+00015a00: 7328 656c 656d 290a 2020 2020 2020 2020  s(elem).        
+00015a10: 2320 7765 2075 7365 206f 6e65 2063 6c61  # we use one cla
+00015a20: 7373 7265 6620 2d20 7374 796c 6520 7065  ssref - style pe
+00015a30: 7220 4854 4d4c 2073 7479 6c65 0a20 2020  r HTML style.   
+00015a40: 2020 2020 2066 6f72 2068 746d 6c5f 7374       for html_st
+00015a50: 796c 6520 696e 2068 6561 645f 7374 796c  yle in head_styl
+00015a60: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00015a70: 2320 636f 6e73 6973 7473 206f 6620 636c  # consists of cl
+00015a80: 6173 7372 6566 2073 6e64 2073 7479 6c65  assref snd style
+00015a90: 5f73 7472 696e 670a 2020 2020 2020 2020  _string.        
+00015aa0: 2020 2020 636c 6173 7372 6566 2c20 7374      classref, st
+00015ab0: 796c 655f 7320 3d20 636c 732e 6578 7472  yle_s = cls.extr
+00015ac0: 6163 745f 636c 6173 7372 6566 5f61 6e64  act_classref_and
+00015ad0: 5f63 7373 7374 7269 6e67 5f66 726f 6d5f  _cssstring_from_
+00015ae0: 6874 6d6c 5f73 7479 6c65 2868 746d 6c5f  html_style(html_
+00015af0: 7374 796c 6529 0a20 2020 2020 2020 2020  style).         
+00015b00: 2020 2073 7479 6c65 5f76 616c 7565 203d     style_value =
+00015b10: 2073 7479 6c65 5f73 0a20 2020 2020 2020   style_s.       
+00015b20: 2020 2020 2069 6620 6974 616c 6963 5f62       if italic_b
+00015b30: 6f6c 643a 0a20 2020 2020 2020 2020 2020  old:.           
+00015b40: 2020 2020 206e 6577 5f63 7373 5f73 203d       new_css_s =
+00015b50: 2041 6d69 466f 6e74 2e63 7265 6174 655f   AmiFont.create_
+00015b60: 666f 6e74 5f65 6469 7465 645f 7374 796c  font_edited_styl
+00015b70: 655f 6672 6f6d 5f63 7373 5f73 7479 6c65  e_from_css_style
+00015b80: 5f6f 626a 6563 7428 7374 796c 655f 7329  _object(style_s)
+00015b90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015ba0: 2063 7373 5f73 7479 6c65 203d 2043 5353   css_style = CSS
+00015bb0: 5374 796c 652e 6372 6561 7465 5f63 7373  Style.create_css
+00015bc0: 5f73 7479 6c65 5f66 726f 6d5f 6373 735f  _style_from_css_
+00015bd0: 7374 7269 6e67 286e 6577 5f63 7373 5f73  string(new_css_s
+00015be0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00015bf0: 2020 6966 2063 7373 5f73 7479 6c65 2069    if css_style i
+00015c00: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00015c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015c20: 6373 735f 7374 796c 652e 6578 7472 6163  css_style.extrac
+00015c30: 745f 626f 6c64 5f69 7461 6c69 635f 6672  t_bold_italic_fr
+00015c40: 6f6d 5f66 6f6e 745f 6661 6d69 6c79 2829  om_font_family()
+00015c50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015c60: 2020 2020 2073 7479 6c65 5f76 616c 7565       style_value
+00015c70: 203d 2063 7373 5f73 7479 6c65 2e67 6574   = css_style.get
+00015c80: 5f63 7373 5f76 616c 7565 2877 7261 705f  _css_value(wrap_
+00015c90: 7769 7468 5f63 7572 6c79 3d54 7275 6529  with_curly=True)
+00015ca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015cb0: 2020 2020 2048 746d 6c53 7479 6c65 2e72       HtmlStyle.r
+00015cc0: 6570 6c61 6365 5f63 7572 6c79 2868 746d  eplace_curly(htm
+00015cd0: 6c5f 7374 796c 652c 2073 7479 6c65 5f76  l_style, style_v
+00015ce0: 616c 7565 290a 2020 2020 2020 2020 2020  alue).          
+00015cf0: 2020 6874 6d6c 5f73 7479 6c65 2e61 7474    html_style.att
+00015d00: 7269 625b 434c 4153 5352 4546 5d20 3d20  rib[CLASSREF] = 
+00015d10: 636c 6173 7372 6566 0a20 2020 2020 2020  classref.       
+00015d20: 2020 2020 2073 7479 6c65 5f74 6f5f 636c       style_to_cl
+00015d30: 6173 7372 6566 5f73 6574 5b73 7479 6c65  assref_set[style
+00015d40: 5f76 616c 7565 5d2e 6164 6428 636c 6173  _value].add(clas
+00015d50: 7372 6566 290a 2020 2020 2020 2020 6966  sref).        if
+00015d60: 206f 7574 6469 723a 0a20 2020 2020 2020   outdir:.       
+00015d70: 2020 2020 2048 746d 6c4c 6962 2e77 7269       HtmlLib.wri
+00015d80: 7465 5f68 746d 6c5f 6669 6c65 2865 6c65  te_html_file(ele
+00015d90: 6d2c 2050 6174 6828 6f75 7464 6972 2c20  m, Path(outdir, 
+00015da0: 226e 6f72 6d61 6c69 7a65 642e 6874 6d6c  "normalized.html
+00015db0: 2229 290a 2020 2020 2020 2020 7265 7475  ")).        retu
+00015dc0: 726e 2073 7479 6c65 5f74 6f5f 636c 6173  rn style_to_clas
+00015dd0: 7372 6566 5f73 6574 0a0a 2020 2020 4063  sref_set..    @c
+00015de0: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+00015df0: 6566 2067 6574 5f68 6561 645f 7374 796c  ef get_head_styl
+00015e00: 6573 2863 6c73 2c20 656c 656d 293a 0a20  es(cls, elem):. 
+00015e10: 2020 2020 2020 2022 2222 6765 7420 616c         """get al
+00015e20: 6c20 3c73 7479 6c65 3e20 656c 656d 656e  l <style> elemen
+00015e30: 7473 2066 6672 6f6d 203c 6865 6164 3e0a  ts ffrom <head>.
+00015e40: 2020 2020 2020 2020 3a70 6174 616d 2065          :patam e
+00015e50: 6c65 6d3a 2068 746d 6c20 656c 656d 6e65  lem: html elemne
+00015e60: 6e74 2074 6f20 7365 6172 6368 0a20 2020  nt to search.   
+00015e70: 2020 2020 203a 7265 7475 726e 3a20 7374       :return: st
+00015e80: 796c 6520 656c 656d 656e 7473 2065 6c73  yle elements els
+00015e90: 6520 5b5d 2069 6620 656c 656d 2069 7320  e [] if elem is 
+00015ea0: 4e6f 6e65 0a20 2020 2020 2020 2022 2222  None.        """
+00015eb0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00015ec0: 5b5d 2069 6620 656c 656d 2069 7320 4e6f  [] if elem is No
+00015ed0: 6e65 2065 6c73 6520 656c 656d 2e78 7061  ne else elem.xpa
+00015ee0: 7468 2822 2f68 746d 6c2f 6865 6164 2f73  th("/html/head/s
+00015ef0: 7479 6c65 2229 0a0a 2020 2020 4063 6c61  tyle")..    @cla
+00015f00: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+00015f10: 2065 7874 7261 6374 5f63 6c61 7373 7265   extract_classre
+00015f20: 665f 616e 645f 6373 7373 7472 696e 675f  f_and_cssstring_
+00015f30: 6672 6f6d 5f73 7479 6c65 5f74 6578 7428  from_style_text(
+00015f40: 636c 732c 2068 746d 6c5f 7374 796c 655f  cls, html_style_
+00015f50: 7374 7269 6e67 293a 0a20 2020 2020 2020  string):.       
+00015f60: 2022 2222 7061 7273 6573 2074 6578 7420   """parses text 
+00015f70: 696e 2068 746d 6c20 3c73 7479 6c65 3e20  in html <style> 
+00015f80: 696e 746f 2063 6c61 7373 7265 6620 616e  into classref an
+00015f90: 6420 6373 7373 7472 696e 670a 2020 2020  d cssstring.    
+00015fa0: 2020 2020 6f6e 6c79 206f 6e65 2073 7479      only one sty
+00015fb0: 6c65 2070 6572 2068 746d 6c20 656c 656d  le per html elem
+00015fc0: 656e 740a 2020 2020 2020 2020 3a70 6172  ent.        :par
+00015fd0: 616d 2068 746d 6c5f 7374 796c 655f 7374  am html_style_st
+00015fe0: 7269 6e67 3a20 6f66 2066 6f72 6d20 3c73  ring: of form <s
+00015ff0: 656c 6563 746f 723e 207b 3c76 616c 7565  elector> {<value
+00016000: 3e7d 0a20 2020 2020 2020 203a 7265 7475  >}.        :retu
+00016010: 726e 2073 656c 6563 746f 7220 2c20 7661  rn selector , va
+00016020: 6c75 650a 2020 2020 2020 2020 2222 220a  lue.        """.
+00016030: 0a20 2020 2020 2020 2073 7479 6c65 5f72  .        style_r
+00016040: 6520 3d20 7265 2e63 6f6d 7069 6c65 2822  e = re.compile("
+00016050: 5c5c 732a 283f 503c 636c 6173 7372 6566  \\s*(?P<classref
+00016060: 3e5b 5e5c 5c73 5d2a 295c 5c73 2b7b 5c5c  >[^\\s]*)\\s+{\\
+00016070: 732a 283f 503c 6373 7373 7472 696e 673e  s*(?P<cssstring>
+00016080: 2e2a 297d 5c5c 732a 2229 0a20 2020 2020  .*)}\\s*").     
+00016090: 2020 206d 6174 6368 203d 2073 7479 6c65     match = style
+000160a0: 5f72 652e 6d61 7463 6828 6874 6d6c 5f73  _re.match(html_s
+000160b0: 7479 6c65 5f73 7472 696e 6729 0a20 2020  tyle_string).   
+000160c0: 2020 2020 2069 6620 6e6f 7420 6d61 7463       if not matc
+000160d0: 683a 0a20 2020 2020 2020 2020 2020 2072  h:.            r
+000160e0: 6574 7572 6e20 4e6f 6e65 2c20 4e6f 6e65  eturn None, None
+000160f0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00016100: 6d61 7463 682e 6772 6f75 7028 2263 6c61  match.group("cla
+00016110: 7373 7265 6622 292c 206d 6174 6368 2e67  ssref"), match.g
+00016120: 726f 7570 2822 6373 7373 7472 696e 6722  roup("cssstring"
+00016130: 290a 0a20 2020 2023 2063 6c61 7373 2048  )..    # class H
+00016140: 746d 6c53 7479 6c65 0a0a 2020 2020 4063  tmlStyle..    @c
+00016150: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+00016160: 6566 2065 7874 7261 6374 5f73 7479 6c65  ef extract_style
+00016170: 735f 616e 645f 6e6f 726d 616c 697a 655f  s_and_normalize_
+00016180: 636c 6173 7372 6566 7328 636c 732c 2068  classrefs(cls, h
+00016190: 746d 6c5f 656c 656d 2c20 666f 6e74 5f73  tml_elem, font_s
+000161a0: 7479 6c65 733d 4661 6c73 652c 206f 7574  tyles=False, out
+000161b0: 6469 723d 4e6f 6e65 293a 0a20 2020 2020  dir=None):.     
+000161c0: 2020 2022 2222 0a20 2020 2020 2020 2045     """.        E
+000161d0: 7874 7261 6374 2073 7479 6c65 7320 6672  xtract styles fr
+000161e0: 6f6d 2064 6f63 756d 656e 740a 2020 2020  om document.    
+000161f0: 2020 2020 6d6f 7665 2074 6f20 6865 6164      move to head
+00016200: 2061 6e64 206e 6f72 6d61 6c69 7a65 2063   and normalize c
+00016210: 6c61 7373 7265 6673 0a20 2020 2020 2020  lassrefs.       
+00016220: 2064 656c 6574 6520 7265 6475 6e64 616e   delete redundan
+00016230: 7420 636c 6173 7372 6566 7320 616e 6420  t classrefs and 
+00016240: 7374 796c 6573 0a20 2020 2020 2020 206d  styles.        m
+00016250: 6170 2064 6f63 756d 656e 7420 696e 7374  ap document inst
+00016260: 616d 6365 7320 6f66 2073 7479 6c65 7320  amces of styles 
+00016270: 6f6e 746f 206e 6f72 6d61 6c69 7a65 6420  onto normalized 
+00016280: 636c 6173 7372 6566 730a 2020 2020 2020  classrefs.      
+00016290: 2020 3a70 6172 616d 2068 746d 6c5f 656c    :param html_el
+000162a0: 656d 3a20 6874 6d6c 2064 6f63 756d 656e  em: html documen
+000162b0: 7420 746f 206e 6f72 6d61 6c69 7a65 0a0a  t to normalize..
+000162c0: 2020 2020 2020 2020 5368 6f75 6c64 2062          Should b
+000162d0: 6520 696e 2061 6e20 6f62 6a65 6374 0a20  e in an object. 
+000162e0: 2020 2020 2020 2054 4f44 4f0a 536f 6d65         TODO.Some
+000162f0: 2073 7061 6e73 2061 7265 206e 6f74 206a   spans are not j
+00016300: 6f69 6e65 642c 2078 3120 6f6e 206f 6e65  oined, x1 on one
+00016310: 2073 7061 6e20 616e 6420 7830 206f 6e20   span and x0 on 
+00016320: 666f 6c6c 6f77 696e 6720 6172 6520 6571  following are eq
+00016330: 7561 6c0a 2020 2020 2020 2020 3c64 6976  ual.        <div
+00016340: 206c 6566 743d 2231 3431 2e37 3222 2072   left="141.72" r
+00016350: 6967 6874 3d22 3139 332e 3322 2074 6f70  ight="193.3" top
+00016360: 3d22 3633 322e 3232 223e 3c73 7061 6e20  ="632.22"><span 
+00016370: 7830 3d22 3134 312e 3732 2220 7930 3d22  x0="141.72" y0="
+00016380: 3633 322e 3232 2220 7831 3d22 3139 332e  632.22" x1="193.
+00016390: 3322 2073 7479 6c65 3d22 7830 3a20 3134  3" style="x0: 14
+000163a0: 312e 3732 3b20 7831 3a20 3134 352e 3033  1.72; x1: 145.03
+000163b0: 3b20 7930 3a20 3633 322e 3232 3b20 7931  ; y0: 632.22; y1
+000163c0: 3a20 3634 322e 3138 3b20 7769 6474 683a  : 642.18; width:
+000163d0: 2033 2e33 323b 2220 636c 6173 733d 2273   3.32;" class="s
+000163e0: 3130 223e 2861 2941 6e20 e280 9c3c 2f73  10">(a)An ...</s
+000163f0: 7061 6e3e 0a20 2020 2020 2020 203c 7370  pan>.        <sp
+00016400: 616e 2078 303d 2232 3234 2e30 3422 2079  an x0="224.04" y
+00016410: 303d 2236 3230 2e32 3222 2078 313d 2233  0="620.22" x1="3
+00016420: 3837 2e39 3422 2073 7479 6c65 3d22 7830  87.94" style="x0
+00016430: 3a20 3232 342e 3034 3b20 7831 3a20 3232  : 224.04; x1: 22
+00016440: 392e 3032 3b20 7930 3a20 3632 302e 3232  9.02; y0: 620.22
+00016450: 3b20 7931 3a20 3633 302e 3138 3b20 7769  ; y1: 630.18; wi
+00016460: 6474 683a 2034 2e39 383b 2220 636c 6173  dth: 4.98;" clas
+00016470: 733d 2273 3130 223e 7061 7261 6772 6170  s="s10">paragrap
+00016480: 6873 2034 e280 9236 2c20 7468 6573 6520  hs 4...6, these 
+00016490: 7275 6c65 732c 206d 6f64 616c 6974 6965  rules, modalitie
+000164a0: 7320 613c 2f73 7061 6e3e 0a20 2020 2020  s a</span>.     
+000164b0: 2020 203c 7370 616e 2078 303d 2233 3837     <span x0="387
+000164c0: 2e39 3622 2079 303d 2236 3230 2e32 3222  .96" y0="620.22"
+000164d0: 2078 313d 2234 3834 2e32 3822 2073 7479   x1="484.28" sty
+000164e0: 6c65 3d22 7830 3a20 3338 372e 3936 3b20  le="x0: 387.96; 
+000164f0: 7831 3a20 3339 322e 3934 3b20 7930 3a20  x1: 392.94; y0: 
+00016500: 3632 302e 3232 3b20 7931 3a20 3633 302e  620.22; y1: 630.
+00016510: 3138 3b20 7769 6474 683a 2034 2e39 383b  18; width: 4.98;
+00016520: 2220 636c 6173 733d 2273 3130 223e 6e64  " class="s10">nd
+00016530: 2070 726f 6365 6475 7265 732c 2061 6e64   procedures, and
+00016540: 2061 6e79 2066 7572 7468 6572 2072 656c   any further rel
+00016550: 6576 616e 7420 6465 6369 7369 6f6e 7320  evant decisions 
+00016560: 6f66 2074 6865 2043 6f6e 6665 7265 6e63  of the Conferenc
+00016570: 6520 6f66 2074 6865 2050 6172 7469 6573  e of the Parties
+00016580: 2073 6572 7669 6e67 2061 7320 7468 6520   serving as the 
+00016590: 6d65 6574 696e 6720 6f66 2074 6865 2050  meeting of the P
+000165a0: 6172 7469 6573 2074 6f20 7468 6520 5061  arties to the Pa
+000165b0: 7269 7320 4167 7265 656d 656e 7420 2843  ris Agreement (C
+000165c0: 4d41 293b 203c 2f73 7061 6e3e 3c2f 6469  MA); </span></di
+000165d0: 763e 0a20 2020 2020 2020 2022 2222 0a0a  v>.        """..
+000165e0: 2020 2020 2020 2020 2320 6874 6d6c 5f65          # html_e
+000165f0: 6c65 6d20 3d20 6874 6d6c 5f65 6c65 6d2e  lem = html_elem.
+00016600: 7870 6174 6828 222f 2a22 295b 305d 2069  xpath("/*")[0] i
+00016610: 6620 7479 7065 2868 746d 6c5f 656c 656d  f type(html_elem
+00016620: 2920 6973 205f 456c 656d 656e 7454 7265  ) is _ElementTre
+00016630: 6520 656c 7365 2068 746d 6c5f 656c 656d  e else html_elem
+00016640: 0a20 2020 2020 2020 2063 6c73 2e65 7874  .        cls.ext
+00016650: 7261 6374 5f61 6c6c 5f73 7479 6c65 5f61  ract_all_style_a
+00016660: 7474 7269 6275 7465 735f 746f 5f68 6561  ttributes_to_hea
+00016670: 6428 6874 6d6c 5f65 6c65 6d29 0a20 2020  d(html_elem).   
+00016680: 2020 2020 2069 6620 6f75 7464 6972 3a0a       if outdir:.
+00016690: 2020 2020 2020 2020 2020 2020 4874 6d6c              Html
+000166a0: 4c69 622e 7772 6974 655f 6874 6d6c 5f66  Lib.write_html_f
+000166b0: 696c 6528 6874 6d6c 5f65 6c65 6d2c 2050  ile(html_elem, P
+000166c0: 6174 6828 6f75 7464 6972 2c20 2273 7479  ath(outdir, "sty
+000166d0: 6c65 7331 2e68 746d 6c22 292c 2064 6562  les1.html"), deb
+000166e0: 7567 3d54 7275 6529 0a20 2020 2020 2020  ug=True).       
+000166f0: 2073 7479 6c65 5f74 6f5f 636c 6173 7372   style_to_classr
+00016700: 6566 5f73 6574 203d 2063 6c73 2e6e 6f72  ef_set = cls.nor
+00016710: 6d61 6c69 7a65 5f68 6561 645f 7374 796c  malize_head_styl
+00016720: 6573 2868 746d 6c5f 656c 656d 2c20 6f75  es(html_elem, ou
+00016730: 7464 6972 3d6f 7574 6469 7229 0a20 2020  tdir=outdir).   
+00016740: 2020 2020 2063 6c61 7373 7265 665f 696e       classref_in
+00016750: 6465 7820 3d20 636c 732e 6372 6561 7465  dex = cls.create
+00016760: 5f63 6c61 7373 7265 665f 696e 6465 7828  _classref_index(
+00016770: 7374 796c 655f 746f 5f63 6c61 7373 7265  style_to_classre
+00016780: 665f 7365 7429 0a20 2020 2020 2020 2064  f_set).        d
+00016790: 656c 6574 6162 6c65 5f63 6c61 7373 7265  eletable_classre
+000167a0: 6673 203d 2063 6c73 2e67 6574 5f72 6564  fs = cls.get_red
+000167b0: 756e 6461 6e74 5f63 6c61 7373 7265 6673  undant_classrefs
+000167c0: 2863 6c61 7373 7265 665f 696e 6465 7829  (classref_index)
+000167d0: 0a20 2020 2020 2020 2063 6c73 2e64 656c  .        cls.del
+000167e0: 6574 655f 7265 6475 6e64 616e 745f 7374  ete_redundant_st
+000167f0: 796c 6573 2864 656c 6574 6162 6c65 5f63  yles(deletable_c
+00016800: 6c61 7373 7265 6673 2c20 6874 6d6c 5f65  lassrefs, html_e
+00016810: 6c65 6d29 0a20 2020 2020 2020 2063 6c73  lem).        cls
+00016820: 2e6e 6f72 6d61 6c69 7a65 5f63 6c61 7373  .normalize_class
+00016830: 7265 6673 5f6f 6e5f 656c 656d 656e 7473  refs_on_elements
+00016840: 2868 746d 6c5f 656c 656d 2c20 636c 6173  (html_elem, clas
+00016850: 7372 6566 5f69 6e64 6578 290a 2020 2020  sref_index).    
+00016860: 2020 2020 6966 2066 6f6e 745f 7374 796c      if font_styl
+00016870: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00016880: 636c 732e 6372 6561 7465 5f61 6262 7265  cls.create_abbre
+00016890: 7669 6174 6564 5f66 6f6e 745f 7374 796c  viated_font_styl
+000168a0: 6573 2868 746d 6c5f 656c 656d 290a 0a20  es(html_elem).. 
+000168b0: 2020 2023 2063 6c61 7373 2048 746d 6c53     # class HtmlS
+000168c0: 7479 6c65 0a0a 2020 2020 4063 6c61 7373  tyle..    @class
+000168d0: 6d65 7468 6f64 0a20 2020 2064 6566 206e  method.    def n
+000168e0: 6f72 6d61 6c69 7a65 5f63 6c61 7373 7265  ormalize_classre
+000168f0: 6673 5f6f 6e5f 656c 656d 656e 7473 2863  fs_on_elements(c
+00016900: 6c73 2c20 6874 6d6c 5f65 6c65 6d2c 2063  ls, html_elem, c
+00016910: 6c61 7373 7265 665f 696e 6465 7829 3a0a  lassref_index):.
+00016920: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00016930: 2020 2020 4669 6e64 7320 616c 6c20 656c      Finds all el
+00016940: 6d65 6e74 7320 7769 7468 2040 636c 6173  ments with @clas
+00016950: 7320 6174 7472 6962 7574 6520 616e 6420  s attribute and 
+00016960: 6e6f 726d 616c 697a 6520 746f 206d 696e  normalize to min
+00016970: 696d 616c 2073 6574 0a20 2020 2020 2020  imal set.       
+00016980: 2022 2222 0a20 2020 2020 2020 2063 6c61   """.        cla
+00016990: 7373 6564 5f65 6c65 6d73 203d 2068 746d  ssed_elems = htm
+000169a0: 6c5f 656c 656d 2e78 7061 7468 2822 2f2f  l_elem.xpath("//
+000169b0: 2a5b 4063 6c61 7373 5d22 290a 2020 2020  *[@class]").    
+000169c0: 2020 2020 666f 7220 636c 6173 7365 645f      for classed_
+000169d0: 656c 656d 2069 6e20 636c 6173 7365 645f  elem in classed_
+000169e0: 656c 656d 733a 0a20 2020 2020 2020 2020  elems:.         
+000169f0: 2020 2068 746d 6c5f 636c 6173 7320 3d20     html_class = 
+00016a00: 4874 6d6c 436c 6173 732e 6372 6561 7465  HtmlClass.create
+00016a10: 5f66 726f 6d5f 636c 6173 7365 645f 656c  _from_classed_el
+00016a20: 656d 656e 7428 636c 6173 7365 645f 656c  ement(classed_el
+00016a30: 656d 290a 2020 2020 2020 2020 2020 2020  em).            
+00016a40: 636c 6173 7372 6566 203d 2068 746d 6c5f  classref = html_
+00016a50: 636c 6173 732e 6372 6561 7465 5f63 6c61  class.create_cla
+00016a60: 7373 7265 6628 290a 2020 2020 2020 2020  ssref().        
+00016a70: 2020 2020 6e6f 726d 616c 697a 6564 5f63      normalized_c
+00016a80: 6c61 7373 7265 6620 3d20 4874 6d6c 436c  lassref = HtmlCl
+00016a90: 6173 732e 7265 6d6f 7665 5f64 6f74 2863  ass.remove_dot(c
+00016aa0: 6c61 7373 7265 665f 696e 6465 782e 6765  lassref_index.ge
+00016ab0: 7428 636c 6173 7372 6566 2929 0a20 2020  t(classref)).   
+00016ac0: 2020 2020 2020 2020 2063 6c61 7373 7265           classre
+00016ad0: 6620 3d20 4874 6d6c 436c 6173 732e 7265  f = HtmlClass.re
+00016ae0: 6d6f 7665 5f64 6f74 2863 6c61 7373 7265  move_dot(classre
+00016af0: 6629 0a20 2020 2020 2020 2020 2020 2069  f).            i
+00016b00: 6620 6e6f 726d 616c 697a 6564 5f63 6c61  f normalized_cla
+00016b10: 7373 7265 6620 213d 2063 6c61 7373 7265  ssref != classre
+00016b20: 663a 0a20 2020 2020 2020 2020 2020 2020  f:.             
+00016b30: 2020 2068 746d 6c5f 636c 6173 732e 7265     html_class.re
+00016b40: 706c 6163 655f 636c 6173 7328 636c 6173  place_class(clas
+00016b50: 7372 6566 2c20 6e6f 726d 616c 697a 6564  sref, normalized
+00016b60: 5f63 6c61 7373 7265 6629 0a20 2020 2020  _classref).     
+00016b70: 2020 2020 2020 2020 2020 2069 6620 6874             if ht
+00016b80: 6d6c 5f63 6c61 7373 2e63 6c61 7373 5f73  ml_class.class_s
+00016b90: 7472 696e 673a 0a20 2020 2020 2020 2020  tring:.         
+00016ba0: 2020 2020 2020 2020 2020 2048 746d 6c43             HtmlC
+00016bb0: 6c61 7373 2e73 6574 5f63 6c61 7373 5f6f  lass.set_class_o
+00016bc0: 6e5f 656c 656d 656e 7428 636c 6173 7365  n_element(classe
+00016bd0: 645f 656c 656d 2c20 6874 6d6c 5f63 6c61  d_elem, html_cla
+00016be0: 7373 2e63 6c61 7373 5f73 7472 696e 6729  ss.class_string)
+00016bf0: 0a0a 2020 2020 2320 636c 6173 7320 4874  ..    # class Ht
+00016c00: 6d6c 5374 796c 650a 0a20 2020 2040 636c  mlStyle..    @cl
+00016c10: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+00016c20: 6620 6465 6c65 7465 5f72 6564 756e 6461  f delete_redunda
+00016c30: 6e74 5f73 7479 6c65 7328 636c 732c 2064  nt_styles(cls, d
+00016c40: 656c 6574 6162 6c65 5f63 6c61 7373 7265  eletable_classre
+00016c50: 6673 2c20 6874 6d6c 5f65 6c65 6d29 3a0a  fs, html_elem):.
+00016c60: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00016c70: 2020 2020 6465 6c65 7465 7320 7265 6475      deletes redu
+00016c80: 6e64 616e 7420 3c73 7479 6c65 3e73 2069  ndant <style>s i
+00016c90: 6e20 6865 6164 0a20 2020 2020 2020 2022  n head.        "
+00016ca0: 2222 0a20 2020 2020 2020 2073 7479 6c65  "".        style
+00016cb0: 735f 7769 7468 5f63 6c61 7373 7265 6673  s_with_classrefs
+00016cc0: 203d 2068 746d 6c5f 656c 656d 2e78 7061   = html_elem.xpa
+00016cd0: 7468 2822 2f68 746d 6c2f 6865 6164 2f73  th("/html/head/s
+00016ce0: 7479 6c65 5b40 636c 6173 7372 6566 5d22  tyle[@classref]"
+00016cf0: 290a 2020 2020 2020 2020 666f 7220 7374  ).        for st
+00016d00: 796c 6520 696e 2073 7479 6c65 735f 7769  yle in styles_wi
+00016d10: 7468 5f63 6c61 7373 7265 6673 3a0a 2020  th_classrefs:.  
+00016d20: 2020 2020 2020 2020 2020 636c 6173 7372            classr
+00016d30: 6566 203d 2073 7479 6c65 2e61 7474 7269  ef = style.attri
+00016d40: 622e 6765 7428 434c 4153 5352 4546 290a  b.get(CLASSREF).
+00016d50: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+00016d60: 6c61 7373 7265 6620 696e 2064 656c 6574  lassref in delet
+00016d70: 6162 6c65 5f63 6c61 7373 7265 6673 3a0a  able_classrefs:.
+00016d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016d90: 586d 6c4c 6962 2e72 656d 6f76 655f 656c  XmlLib.remove_el
+00016da0: 656d 656e 7428 7374 796c 6529 0a0a 2020  ement(style)..  
+00016db0: 2020 2320 636c 6173 7320 4874 6d6c 5374    # class HtmlSt
+00016dc0: 796c 650a 0a20 2020 2040 636c 6173 736d  yle..    @classm
+00016dd0: 6574 686f 640a 2020 2020 6465 6620 6765  ethod.    def ge
+00016de0: 745f 7265 6475 6e64 616e 745f 636c 6173  t_redundant_clas
+00016df0: 7372 6566 7328 636c 732c 2063 6c61 7373  srefs(cls, class
+00016e00: 7265 665f 696e 6465 7829 3a0a 2020 2020  ref_index):.    
+00016e10: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00016e20: 6d61 6b65 7320 6c69 7374 206f 6620 7265  makes list of re
+00016e30: 6475 6e64 616e 7420 636c 6173 7372 6566  dundant classref
+00016e40: 730a 2020 2020 2020 2020 3a70 6172 616d  s.        :param
+00016e50: 2063 6c61 7373 7265 665f 696e 6465 783a   classref_index:
+00016e60: 2064 6963 7469 6f6e 6172 7920 6d61 7070   dictionary mapp
+00016e70: 696e 6720 636c 6173 7372 6566 7320 6f6e  ing classrefs on
+00016e80: 746f 206e 6f72 6d61 6c69 7a65 6420 636c  to normalized cl
+00016e90: 6173 7372 6566 0a20 2020 2020 2020 203a  assref.        :
+00016ea0: 7265 7475 726e 3a20 6c69 7374 206f 6620  return: list of 
+00016eb0: 7265 6475 6e64 616e 7420 636c 6173 7372  redundant classr
+00016ec0: 6566 730a 2020 2020 2020 2020 2222 220a  efs.        """.
+00016ed0: 2020 2020 2020 2020 7265 6475 6e64 616e          redundan
+00016ee0: 745f 636c 6173 7372 6566 7320 3d20 5b5d  t_classrefs = []
+00016ef0: 0a20 2020 2020 2020 2066 6f72 2069 7465  .        for ite
+00016f00: 6d20 696e 2063 6c61 7373 7265 665f 696e  m in classref_in
+00016f10: 6465 782e 6974 656d 7328 293a 0a20 2020  dex.items():.   
+00016f20: 2020 2020 2020 2020 2069 6620 6974 656d           if item
+00016f30: 5b30 5d20 213d 2069 7465 6d5b 315d 3a0a  [0] != item[1]:.
+00016f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016f50: 7265 6475 6e64 616e 745f 636c 6173 7372  redundant_classr
+00016f60: 6566 732e 6170 7065 6e64 2869 7465 6d5b  efs.append(item[
+00016f70: 305d 290a 2020 2020 2020 2020 7265 7475  0]).        retu
+00016f80: 726e 2072 6564 756e 6461 6e74 5f63 6c61  rn redundant_cla
+00016f90: 7373 7265 6673 0a0a 2020 2020 2320 636c  ssrefs..    # cl
+00016fa0: 6173 7320 4874 6d6c 5374 796c 650a 0a20  ass HtmlStyle.. 
+00016fb0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+00016fc0: 2020 2020 6465 6620 6372 6561 7465 5f63      def create_c
+00016fd0: 6c61 7373 7265 665f 696e 6465 7828 636c  lassref_index(cl
+00016fe0: 732c 2073 7479 6c65 5f74 6f5f 636c 6173  s, style_to_clas
+00016ff0: 7372 6566 5f73 6574 293a 0a20 2020 2020  sref_set):.     
+00017000: 2020 2022 2222 0a20 2020 2020 2020 206d     """.        m
+00017010: 6170 7320 616c 6c20 6974 656d 7320 696e  aps all items in
+00017020: 2063 6c61 7373 7265 6620 7365 7473 206f   classref sets o
+00017030: 6e74 6f20 2861 7262 6974 7261 7269 6c79  nto (arbitrarily
+00017040: 2920 7468 6520 6669 7273 740a 2020 2020  ) the first.    
+00017050: 2020 2020 3a70 6172 616d 2073 7479 6c65      :param style
+00017060: 5f74 6f5f 636c 6173 7372 6566 5f73 6574  _to_classref_set
+00017070: 3a20 636c 6173 7372 6566 5f73 6574 7320  : classref_sets 
+00017080: 6d6d 6170 7065 6420 6279 2073 7479 6c65  mmapped by style
+00017090: 2076 616c 7565 0a20 2020 2020 2020 203a   value.        :
+000170a0: 7265 7475 726e 3a64 6963 7420 6d61 7070  return:dict mapp
+000170b0: 696e 6720 7265 6475 6e64 616e 7420 636c  ing redundant cl
+000170c0: 6173 7372 6566 7320 6f6e 746f 206e 6f72  assrefs onto nor
+000170d0: 6d61 6c69 7a65 6420 636c 6173 7372 6566  malized classref
+000170e0: 0a20 2020 2020 2020 204d 6179 2062 656e  .        May ben
+000170f0: 6566 6974 2066 726f 6d20 6265 696e 6720  efit from being 
+00017100: 696e 2061 2063 6c61 7373 0a20 2020 2020  in a class.     
+00017110: 2020 2022 2222 0a20 2020 2020 2020 2063     """.        c
+00017120: 6c61 7373 7265 665f 696e 6465 7820 3d20  lassref_index = 
+00017130: 6469 6374 2829 0a20 2020 2020 2020 2066  dict().        f
+00017140: 6f72 2069 7465 6d20 696e 2073 7479 6c65  or item in style
+00017150: 5f74 6f5f 636c 6173 7372 6566 5f73 6574  _to_classref_set
+00017160: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
+00017170: 2020 2020 2020 636c 6173 7372 6566 5f6c        classref_l
+00017180: 6973 7420 3d20 6c69 7374 2873 6f72 7465  ist = list(sorte
+00017190: 6428 6974 656d 5b31 5d29 290a 2020 2020  d(item[1])).    
+000171a0: 2020 2020 2020 2020 636c 6173 7372 6566          classref
+000171b0: 3020 3d20 6c69 7374 2863 6c61 7373 7265  0 = list(classre
+000171c0: 665f 6c69 7374 295b 305d 0a20 2020 2020  f_list)[0].     
+000171d0: 2020 2020 2020 2066 6f72 2063 6c61 7373         for class
+000171e0: 7265 6620 696e 2063 6c61 7373 7265 665f  ref in classref_
+000171f0: 6c69 7374 3a0a 2020 2020 2020 2020 2020  list:.          
+00017200: 2020 2020 2020 636c 6173 7372 6566 5f69        classref_i
+00017210: 6e64 6578 5b63 6c61 7373 7265 665d 203d  ndex[classref] =
+00017220: 2063 6c61 7373 7265 6630 0a20 2020 2020   classref0.     
+00017230: 2020 2072 6574 7572 6e20 636c 6173 7372     return classr
+00017240: 6566 5f69 6e64 6578 0a0a 2020 2020 2320  ef_index..    # 
+00017250: 636c 6173 7320 4874 6d6c 5374 796c 650a  class HtmlStyle.
+00017260: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+00017270: 640a 2020 2020 6465 6620 6164 645f 6865  d.    def add_he
+00017280: 6164 5f73 7479 6c65 735f 6f72 6967 2863  ad_styles_orig(c
+00017290: 6c73 2c20 6874 6d6c 5f65 6c65 6d2c 2073  ls, html_elem, s
+000172a0: 7479 6c65 732c 206e 6f72 6d61 6c69 7a65  tyles, normalize
+000172b0: 5f66 6f6e 743d 5472 7565 293a 0a20 2020  _font=True):.   
+000172c0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000172d0: 2074 6869 7320 6973 2063 7275 6465 0a20   this is crude. 
+000172e0: 2020 2020 2020 2027 7374 796c 6520 6f66         'style of
+000172f0: 2066 6f72 6d0a 2020 2020 2020 2020 2020   form.          
+00017300: 2020 2264 6976 222c 205b 2822 626f 7264    "div", [("bord
+00017310: 6572 222c 2022 7265 6420 736f 6c69 6420  er", "red solid 
+00017320: 302e 3570 7822 292c 2028 2262 6163 6b67  0.5px"), ("backg
+00017330: 726f 756e 6422 2c20 2279 656c 6c6f 7729  round", "yellow)
+00017340: 5d29 0a20 2020 2020 2020 2022 2222 0a20  ]).        """. 
+00017350: 2020 2020 2020 2066 6f72 2073 7479 6c65         for style
+00017360: 2069 6e20 7374 796c 6573 3a0a 2020 2020   in styles:.    
+00017370: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
+00017380: 6622 7374 796c 6520 7b73 7479 6c65 7d22  f"style {style}"
+00017390: 290a 2020 2020 2020 2020 2020 2020 4874  ).            Ht
+000173a0: 6d6c 4c69 622e 6164 645f 6865 6164 5f73  mlLib.add_head_s
+000173b0: 7479 6c65 2868 746d 6c5f 656c 656d 2c20  tyle(html_elem, 
+000173c0: 7374 796c 655b 305d 2c20 7374 796c 655b  style[0], style[
+000173d0: 315d 290a 0a20 2020 2040 636c 6173 736d  1])..    @classm
+000173e0: 6574 686f 640a 2020 2020 6465 6620 6164  ethod.    def ad
+000173f0: 645f 6865 6164 5f73 7479 6c65 7328 636c  d_head_styles(cl
+00017400: 732c 2068 746d 6c5f 656c 656d 2c20 7374  s, html_elem, st
+00017410: 796c 655f 7465 7874 732c 206e 6f72 6d61  yle_texts, norma
+00017420: 6c69 7a65 5f66 6f6e 743d 5472 7565 293a  lize_font=True):
+00017430: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00017440: 2020 2020 2061 6464 7320 7465 7874 206f       adds text o
+00017450: 6620 666f 726d 0a20 2020 2020 2020 206c  f form.        l
+00017460: 6f63 6174 6f72 2063 7373 0a20 2020 2020  ocator css.     
+00017470: 2020 2065 2e67 2e20 7370 616e 2e74 656d     e.g. span.tem
+00017480: 7020 7b62 6163 6b67 726f 756e 643a 2072  p {background: r
+00017490: 6564 3b20 666f 6e74 2d73 697a 653a 2031  ed; font-size: 1
+000174a0: 3270 783b 7d0a 2020 2020 2020 2020 2222  2px;}.        ""
+000174b0: 220a 2020 2020 2020 2020 6874 6d6c 5f68  ".        html_h
+000174c0: 6561 6420 3d20 4874 6d6c 4c69 622e 6765  ead = HtmlLib.ge
+000174d0: 745f 6865 6164 2868 746d 6c5f 656c 656d  t_head(html_elem
+000174e0: 290a 2020 2020 2020 2020 666f 7220 7374  ).        for st
+000174f0: 796c 655f 7420 696e 2073 7479 6c65 5f74  yle_t in style_t
+00017500: 6578 7473 3a0a 2020 2020 2020 2020 2020  exts:.          
+00017510: 2020 7374 796c 6520 3d20 4554 2e53 7562    style = ET.Sub
+00017520: 456c 656d 656e 7428 6874 6d6c 5f68 6561  Element(html_hea
+00017530: 642c 2022 7374 796c 6522 290a 2020 2020  d, "style").    
+00017540: 2020 2020 2020 2020 7374 796c 652e 7465          style.te
+00017550: 7874 203d 2073 7479 6c65 5f74 0a0a 2320  xt = style_t..# 
+00017560: 544f 444f 0a23 2063 7265 6174 655f 666f  TODO.# create_fo
+00017570: 6e74 5f65 6469 7465 645f 7374 796c 655f  nt_edited_style_
+00017580: 6672 6f6d 5f63 7373 5f73 7479 6c65 5f6f  from_css_style_o
+00017590: 626a 6563 740a 0a20 2020 2040 636c 6173  bject..    @clas
+000175a0: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+000175b0: 7472 616e 7366 6572 5f68 6561 645f 7374  transfer_head_st
+000175c0: 796c 6573 2863 6c73 2c20 6874 6d6c 5f65  yles(cls, html_e
+000175d0: 6c65 6d2c 206e 6577 5f68 746d 6c29 3a0a  lem, new_html):.
+000175e0: 2020 2020 2020 2020 2222 2263 6f70 6965          """copie
+000175f0: 7320 6874 6d6c 2f68 6561 642f 2222 220a  s html/head/""".
+00017600: 2020 2020 2020 2020 6e65 775f 7374 796c          new_styl
+00017610: 655f 656c 656d 203d 2048 746d 6c47 726f  e_elem = HtmlGro
+00017620: 7570 2e63 7265 6174 655f 6865 6164 5f73  up.create_head_s
+00017630: 7479 6c65 5f65 6c65 6d28 6e65 775f 6874  tyle_elem(new_ht
+00017640: 6d6c 2c20 7461 696c 3d22 5c6e 2229 0a20  ml, tail="\n"). 
+00017650: 2020 2020 2020 2073 7479 6c65 7320 3d20         styles = 
+00017660: 4874 6d6c 5374 796c 652e 6765 745f 6865  HtmlStyle.get_he
+00017670: 6164 5f73 7479 6c65 7328 6874 6d6c 5f65  ad_styles(html_e
+00017680: 6c65 6d29 0a20 2020 2020 2020 2066 6f72  lem).        for
+00017690: 2073 7479 6c65 2069 6e20 7374 796c 6573   style in styles
+000176a0: 3a0a 2020 2020 2020 2020 2020 2020 6e65  :.            ne
+000176b0: 775f 7374 796c 655f 656c 656d 2e67 6574  w_style_elem.get
+000176c0: 7061 7265 6e74 2829 2e61 7070 656e 6428  parent().append(
+000176d0: 636f 7079 2e64 6565 7063 6f70 7928 7374  copy.deepcopy(st
+000176e0: 796c 6529 290a 0a20 2020 2040 636c 6173  yle))..    @clas
+000176f0: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+00017700: 6578 7472 6163 745f 636c 6173 7372 6566  extract_classref
+00017710: 5f61 6e64 5f63 7373 7374 7269 6e67 5f66  _and_cssstring_f
+00017720: 726f 6d5f 6874 6d6c 5f73 7479 6c65 2863  rom_html_style(c
+00017730: 6c73 2c20 6874 6d6c 5f73 7479 6c65 5f65  ls, html_style_e
+00017740: 6c65 6d29 3a0a 2020 2020 2020 2020 6966  lem):.        if
+00017750: 2068 746d 6c5f 7374 796c 655f 656c 656d   html_style_elem
+00017760: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00017770: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+00017780: 652c 204e 6f6e 650a 2020 2020 2020 2020  e, None.        
+00017790: 7265 7475 726e 2063 6c73 2e65 7874 7261  return cls.extra
+000177a0: 6374 5f63 6c61 7373 7265 665f 616e 645f  ct_classref_and_
+000177b0: 6373 7373 7472 696e 675f 6672 6f6d 5f73  cssstring_from_s
+000177c0: 7479 6c65 5f74 6578 7428 6874 6d6c 5f73  tyle_text(html_s
+000177d0: 7479 6c65 5f65 6c65 6d2e 7465 7874 290a  tyle_elem.text).
+000177e0: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+000177f0: 640a 2020 2020 6465 6620 6372 6561 7465  d.    def create
+00017800: 5f63 6c61 7373 7265 665f 6373 7373 7472  _classref_cssstr
+00017810: 696e 675f 7461 626c 6528 636c 732c 2068  ing_table(cls, h
+00017820: 746d 6c5f 7374 796c 6573 293a 0a20 2020  tml_styles):.   
+00017830: 2020 2020 2074 6162 6c65 203d 205b 5d0a       table = [].
+00017840: 2020 2020 2020 2020 666f 7220 6874 6d6c          for html
+00017850: 5f73 7479 6c65 2069 6e20 6874 6d6c 5f73  _style in html_s
+00017860: 7479 6c65 733a 0a20 2020 2020 2020 2020  tyles:.         
+00017870: 2020 2074 6162 6c65 2e61 7070 656e 6428     table.append(
+00017880: 4874 6d6c 5374 796c 652e 6578 7472 6163  HtmlStyle.extrac
+00017890: 745f 636c 6173 7372 6566 5f61 6e64 5f63  t_classref_and_c
+000178a0: 7373 7374 7269 6e67 5f66 726f 6d5f 6874  ssstring_from_ht
+000178b0: 6d6c 5f73 7479 6c65 2868 746d 6c5f 7374  ml_style(html_st
+000178c0: 796c 6529 290a 2020 2020 2020 2020 7265  yle)).        re
+000178d0: 7475 726e 2074 6162 6c65 0a0a 2020 2020  turn table..    
+000178e0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+000178f0: 2064 6566 2072 6570 6c61 6365 5f63 7572   def replace_cur
+00017900: 6c79 2863 6c73 2c20 656c 656d 2c20 6e65  ly(cls, elem, ne
+00017910: 775f 6375 726c 7929 3a0a 2020 2020 2020  w_curly):.      
+00017920: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
+00017930: 706c 6163 6520 636f 6e74 656e 7473 206f  place contents o
+00017940: 6620 7b2e 2e2e 7d0a 2020 2020 2020 2020  f {...}.        
+00017950: 3a70 6172 616d 2065 6c65 6d3a 2068 746d  :param elem: htm
+00017960: 6c20 3c73 7479 6c65 3e20 656c 656d 656e  l <style> elemen
+00017970: 740a 2020 2020 2020 2020 3a70 6172 616d  t.        :param
+00017980: 2065 6c65 6d3a 206e 6577 2063 6f6e 7465   elem: new conte
+00017990: 6e74 0a20 2020 2020 2020 2022 2222 0a0a  nt.        """..
+000179a0: 2020 2020 2020 2020 6966 2065 6c65 6d20          if elem 
+000179b0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+000179c0: 2020 2020 2020 2020 206d 6174 6368 203d           match =
+000179d0: 2053 5459 4c45 5f43 5552 4c59 5f52 452e   STYLE_CURLY_RE.
+000179e0: 6d61 7463 6828 656c 656d 2e74 6578 7429  match(elem.text)
+000179f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00017a00: 6d61 7463 683a 0a20 2020 2020 2020 2020  match:.         
+00017a10: 2020 2020 2020 206e 6577 5f74 6578 7420         new_text 
+00017a20: 3d20 6d61 7463 682e 6772 6f75 7028 2270  = match.group("p
+00017a30: 7265 2229 202b 206e 6577 5f63 7572 6c79  re") + new_curly
+00017a40: 202b 206d 6174 6368 2e67 726f 7570 2822   + match.group("
+00017a50: 706f 7374 2229 0a20 2020 2020 2020 2020  post").         
+00017a60: 2020 2020 2020 2065 6c65 6d2e 7465 7874         elem.text
+00017a70: 203d 206e 6577 5f74 6578 740a 0a20 2020   = new_text..   
+00017a80: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+00017a90: 2020 6465 6620 6c6f 6f6b 7570 5f68 6561    def lookup_hea
+00017aa0: 645f 7374 796c 655f 6279 5f63 6c61 7373  d_style_by_class
+00017ab0: 7265 6628 636c 732c 2065 6c65 6d29 3a0a  ref(cls, elem):.
 00017ac0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00017ad0: 2020 2020 3a70 6172 616d 2068 746d 6c3a      :param html:
-00017ae0: 2048 544d 4c20 656c 656d 656e 7420 7769   HTML element wi
-00017af0: 7468 2068 6561 642f 7374 796c 650a 2020  th head/style.  
-00017b00: 2020 2020 2020 3a70 6172 616d 2063 6c61        :param cla
-00017b10: 7a7a 3a20 636c 6173 7320 746f 2072 6574  zz: class to ret
-00017b20: 6972 7665 2073 7479 6c65 2065 6c65 6d65  irve style eleme
-00017b30: 6e74 0a20 2020 2020 2020 2022 2222 0a20  nt.        """. 
-00017b40: 2020 2020 2020 2073 7479 6c65 7320 3d20         styles = 
-00017b50: 6874 6d6c 2e78 7061 7468 2866 222f 6874  html.xpath(f"/ht
-00017b60: 6d6c 2f68 6561 642f 7374 796c 655b 636f  ml/head/style[co
-00017b70: 6e74 6169 6e73 282e 2c27 2e7b 636c 617a  ntains(.,'.{claz
-00017b80: 7a7d 2027 295d 2229 0a20 2020 2020 2020  z} ')]").       
-00017b90: 2069 6620 6c65 6e28 7374 796c 6573 2920   if len(styles) 
-00017ba0: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-00017bb0: 2020 7072 696e 7428 6622 6e6f 2073 7479    print(f"no sty
-00017bc0: 6c65 7320 666f 7220 7b63 6c61 7a7a 7d22  les for {clazz}"
-00017bd0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00017be0: 7475 726e 204e 6f6e 650a 2020 2020 2020  turn None.      
-00017bf0: 2020 6865 6164 5f73 7479 6c65 203d 2073    head_style = s
-00017c00: 7479 6c65 735b 305d 0a20 2020 2020 2020  tyles[0].       
-00017c10: 205f 2c20 6373 735f 7374 796c 6520 3d20   _, css_style = 
-00017c20: 4353 5353 7479 6c65 2e63 7265 6174 655f  CSSStyle.create_
-00017c30: 6373 735f 7374 796c 655f 6672 6f6d 5f68  css_style_from_h
-00017c40: 746d 6c5f 6865 6164 5f73 7479 6c65 5f65  tml_head_style_e
-00017c50: 6c65 6d28 6865 6164 5f73 7479 6c65 290a  lem(head_style).
-00017c60: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-00017c70: 7373 5f73 7479 6c65 0a0a 2020 2020 4063  ss_style..    @c
-00017c80: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-00017c90: 6566 2069 735f 626f 6c64 2863 6c73 2c20  ef is_bold(cls, 
-00017ca0: 656c 656d 293a 0a20 2020 2020 2020 2022  elem):.        "
-00017cb0: 2222 0a20 2020 2020 2020 2066 696e 6473  "".        finds
-00017cc0: 2040 636c 6173 7320 696e 2065 6c65 6d20   @class in elem 
-00017cd0: 616e 6420 6c6f 6f6b 7320 7570 2073 7479  and looks up sty
-00017ce0: 6c65 2069 6e20 6874 6d6c 2f68 6561 640a  le in html/head.
-00017cf0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00017d00: 2020 2020 6966 2065 6c65 6d20 6973 204e      if elem is N
-00017d10: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00017d20: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
-00017d30: 2020 2020 2020 6373 735f 7374 796c 6520        css_style 
-00017d40: 3d20 4874 6d6c 5374 796c 652e 6c6f 6f6b  = HtmlStyle.look
-00017d50: 7570 5f68 6561 645f 7374 796c 655f 6279  up_head_style_by
-00017d60: 5f63 6c61 7373 7265 6628 656c 656d 290a  _classref(elem).
-00017d70: 2020 2020 2020 2020 6966 206e 6f74 2063          if not c
-00017d80: 7373 5f73 7479 6c65 3a0a 2020 2020 2020  ss_style:.      
-00017d90: 2020 2020 2020 7072 696e 7428 6622 6e6f        print(f"no
-00017da0: 2073 7479 6c65 2072 6573 6f6c 7665 6420   style resolved 
-00017db0: 666f 7220 7b45 542e 746f 7374 7269 6e67  for {ET.tostring
-00017dc0: 2865 6c65 6d29 7d22 290a 2020 2020 2020  (elem)}").      
-00017dd0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-00017de0: 7365 0a20 2020 2020 2020 2072 6574 7572  se.        retur
-00017df0: 6e20 6373 735f 7374 796c 652e 6973 5f62  n css_style.is_b
-00017e00: 6f6c 640a 0a20 2020 2040 636c 6173 736d  old..    @classm
-00017e10: 6574 686f 640a 2020 2020 6465 6620 6973  ethod.    def is
-00017e20: 5f69 7461 6c69 6328 636c 732c 2065 6c65  _italic(cls, ele
-00017e30: 6d29 3a0a 2020 2020 2020 2020 2222 220a  m):.        """.
-00017e40: 2020 2020 2020 2020 6669 6e64 7320 4063          finds @c
-00017e50: 6c61 7373 2069 6e20 656c 656d 2061 6e64  lass in elem and
-00017e60: 206c 6f6f 6b73 2075 7020 7374 796c 6520   looks up style 
-00017e70: 696e 2068 746d 6c2f 6865 6164 0a20 2020  in html/head.   
-00017e80: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00017e90: 2069 6620 656c 656d 2069 7320 4e6f 6e65   if elem is None
-00017ea0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00017eb0: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
-00017ec0: 2020 2063 7373 5f73 7479 6c65 203d 2048     css_style = H
-00017ed0: 746d 6c53 7479 6c65 2e6c 6f6f 6b75 705f  tmlStyle.lookup_
-00017ee0: 6865 6164 5f73 7479 6c65 5f62 795f 636c  head_style_by_cl
-00017ef0: 6173 7372 6566 2865 6c65 6d29 0a20 2020  assref(elem).   
-00017f00: 2020 2020 2069 6620 6e6f 7420 6373 735f       if not css_
-00017f10: 7374 796c 653a 0a20 2020 2020 2020 2020  style:.         
-00017f20: 2020 2070 7269 6e74 2866 226e 6f20 7374     print(f"no st
-00017f30: 796c 6520 7265 736f 6c76 6564 2066 6f72  yle resolved for
-00017f40: 207b 4554 2e74 6f73 7472 696e 6728 656c   {ET.tostring(el
-00017f50: 656d 297d 2229 0a20 2020 2020 2020 2020  em)}").         
-00017f60: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-00017f70: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-00017f80: 7373 5f73 7479 6c65 2e69 735f 6974 616c  ss_style.is_ital
-00017f90: 6963 0a0a 2020 2020 4063 6c61 7373 6d65  ic..    @classme
-00017fa0: 7468 6f64 0a20 2020 2064 6566 2067 6574  thod.    def get
-00017fb0: 5f62 6f64 795f 636c 6173 7372 6566 7328  _body_classrefs(
-00017fc0: 636c 732c 2068 746d 6c5f 656c 656d 293a  cls, html_elem):
-00017fd0: 0a20 2020 2020 2020 2022 2222 7365 6172  .        """sear
-00017fe0: 6368 6573 2061 6c6c 2062 6f64 7920 656c  ches all body el
-00017ff0: 656d 656e 7473 2066 6f72 2040 636c 6173  ements for @clas
-00018000: 7320 6174 7472 6962 7574 6573 0a20 2020  s attributes.   
-00018010: 2020 2020 203a 7061 7261 6d20 6874 6d6c       :param html
-00018020: 5f65 6c65 6d3a 2068 746d 6c20 656c 656d  _elem: html elem
-00018030: 656e 740a 2020 2020 2020 2020 3a72 6574  ent.        :ret
-00018040: 7572 6e3a 2061 6c6c 2062 6f64 7920 656c  urn: all body el
-00018050: 656d 656e 7473 2077 6974 6820 4063 6c61  ements with @cla
-00018060: 7373 2061 7474 7269 6275 7465 730a 2020  ss attributes.  
-00018070: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00018080: 2020 626f 6479 203d 2048 746d 6c4c 6962    body = HtmlLib
-00018090: 2e67 6574 5f62 6f64 7928 6874 6d6c 5f65  .get_body(html_e
-000180a0: 6c65 6d29 0a20 2020 2020 2020 2072 6574  lem).        ret
-000180b0: 7572 6e20 5b5d 2069 6620 626f 6479 2069  urn [] if body i
-000180c0: 7320 4e6f 6e65 2065 6c73 6520 626f 6479  s None else body
-000180d0: 2e78 7061 7468 2822 2e2f 2f2a 5b40 636c  .xpath(".//*[@cl
-000180e0: 6173 735d 2229 0a0a 2020 2020 4063 6c61  ass]")..    @cla
-000180f0: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-00018100: 2063 7265 6174 655f 6162 6272 6576 6961   create_abbrevia
-00018110: 7465 645f 666f 6e74 5f73 7479 6c65 7328  ted_font_styles(
-00018120: 636c 732c 2068 746d 6c5f 656c 656d 293a  cls, html_elem):
-00018130: 0a20 2020 2020 2020 2022 2222 6372 6561  .        """crea
-00018140: 7465 7320 7265 6164 6162 6c65 2073 7479  tes readable sty
-00018150: 6c65 6e61 6d65 730a 2020 2020 2020 2020  lenames.        
-00018160: 2e73 3020 7b66 6f6e 742d 6661 6d69 6c79  .s0 {font-family
-00018170: 3a20 5469 6d65 734e 6577 526f 6d61 6e50  : TimesNewRomanP
-00018180: 534d 543b 2066 6f6e 742d 7369 7a65 3a20  SMT; font-size: 
-00018190: 3132 2e30 3b20 666f 6e74 2d77 6569 6768  12.0; font-weigh
-000181a0: 743a 2062 6f6c 643b 2066 6f6e 742d 6e61  t: bold; font-na
-000181b0: 6d65 3a20 5469 6d65 734e 6577 526f 6d61  me: TimesNewRoma
-000181c0: 6e50 534d 543b 0a20 2020 2020 2020 2069  nPSMT;.        i
-000181d0: 7320 7472 616e 7366 6f72 6d65 6420 746f  s transformed to
-000181e0: 0a20 2020 2020 2020 202e 7469 6d65 736e  .        .timesn
-000181f0: 6577 726f 6d61 6e70 736d 745f 3132 7e30  ewromanpsmt_12~0
-00018200: 5f62 6f6c 640a 2020 2020 2020 2020 2222  _bold.        ""
-00018210: 220a 2020 2020 2020 2020 7374 796c 655f  ".        style_
-00018220: 636f 6e76 6572 7465 7220 3d20 636c 732e  converter = cls.
-00018230: 6372 6561 7465 5f73 7479 6c65 5f63 6f6e  create_style_con
-00018240: 7665 7274 6572 2868 746d 6c5f 656c 656d  verter(html_elem
-00018250: 290a 2020 2020 2020 2020 7374 796c 6564  ).        styled
-00018260: 5f65 6c65 6d73 203d 2068 746d 6c5f 656c  _elems = html_el
-00018270: 656d 2e78 7061 7468 2822 2e2f 2f2a 5b40  em.xpath(".//*[@
-00018280: 636c 6173 735d 2229 0a20 2020 2020 2020  class]").       
-00018290: 2066 6f72 2065 6c65 6d20 696e 2073 7479   for elem in sty
-000182a0: 6c65 645f 656c 656d 733a 0a20 2020 2020  led_elems:.     
-000182b0: 2020 2020 2020 2063 6c61 7a7a 203d 2065         clazz = e
-000182c0: 6c65 6d2e 6174 7472 6962 5b22 636c 6173  lem.attrib["clas
-000182d0: 7322 5d0a 2020 2020 2020 2020 2020 2020  s"].            
-000182e0: 6e65 775f 636c 6173 7320 3d20 7374 796c  new_class = styl
-000182f0: 655f 636f 6e76 6572 7465 722e 6765 7428  e_converter.get(
-00018300: 636c 617a 7a29 0a20 2020 2020 2020 2020  clazz).         
-00018310: 2020 2069 6620 6e65 775f 636c 6173 7320     if new_class 
-00018320: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00018330: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
-00018340: 2263 616e 6e6f 7420 6669 6e64 2072 6570  "cannot find rep
-00018350: 6c61 6365 2066 6f72 207b 636c 617a 7a7d  lace for {clazz}
-00018360: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00018370: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
-00018380: 2020 2020 2020 2020 6874 6d6c 5f63 6c61          html_cla
-00018390: 7373 203d 2048 746d 6c43 6c61 7373 2863  ss = HtmlClass(c
-000183a0: 6c61 7a7a 290a 2020 2020 2020 2020 2020  lazz).          
-000183b0: 2020 6874 6d6c 5f63 6c61 7373 2e72 6570    html_class.rep
-000183c0: 6c61 6365 5f63 6c61 7373 2863 6c61 7a7a  lace_class(clazz
-000183d0: 2c20 6e65 775f 636c 6173 7329 0a20 2020  , new_class).   
-000183e0: 2020 2020 2020 2020 2065 6c65 6d2e 6174           elem.at
-000183f0: 7472 6962 5b22 636c 6173 7322 5d20 3d20  trib["class"] = 
-00018400: 6e65 775f 636c 6173 730a 2020 2020 2020  new_class.      
-00018410: 2020 2020 2020 2320 7072 696e 7428 6622        # print(f"
-00018420: 7265 706c 6163 6564 207b 636c 617a 7a7d  replaced {clazz}
-00018430: 2062 7920 7b6e 6577 5f63 6c61 7373 7d22   by {new_class}"
-00018440: 290a 0a20 2020 2040 636c 6173 736d 6574  )..    @classmet
-00018450: 686f 640a 2020 2020 6465 6620 6372 6561  hod.    def crea
-00018460: 7465 5f73 7479 6c65 5f63 6f6e 7665 7274  te_style_convert
-00018470: 6572 2863 6c73 2c20 6874 6d6c 5f65 6c65  er(cls, html_ele
-00018480: 6d29 3a0a 2020 2020 2020 2020 7374 796c  m):.        styl
-00018490: 6573 203d 2048 746d 6c53 7479 6c65 2e67  es = HtmlStyle.g
-000184a0: 6574 5f68 6561 645f 7374 796c 6573 2868  et_head_styles(h
-000184b0: 746d 6c5f 656c 656d 290a 2020 2020 2020  tml_elem).      
-000184c0: 2020 7374 796c 655f 636f 6e76 6572 7465    style_converte
-000184d0: 7220 3d20 6469 6374 2829 0a20 2020 2020  r = dict().     
-000184e0: 2020 2066 6f72 2073 7479 6c65 2069 6e20     for style in 
-000184f0: 7374 796c 6573 3a0a 2020 2020 2020 2020  styles:.        
-00018500: 2020 2020 646f 745f 7374 796c 652c 2063      dot_style, c
-00018510: 7373 203d 2048 746d 6c53 7479 6c65 2e65  ss = HtmlStyle.e
-00018520: 7874 7261 6374 5f63 6c61 7373 7265 665f  xtract_classref_
-00018530: 616e 645f 6373 7373 7472 696e 675f 6672  and_cssstring_fr
-00018540: 6f6d 5f68 746d 6c5f 7374 796c 6528 7374  om_html_style(st
-00018550: 796c 6529 0a20 2020 2020 2020 2020 2020  yle).           
-00018560: 2023 2070 7269 6e74 2866 227b 646f 745f   # print(f"{dot_
-00018570: 7374 796c 657d 207b 6373 737d 2229 0a20  style} {css}"). 
-00018580: 2020 2020 2020 2020 2020 2063 7373 5f73             css_s
-00018590: 7479 6c65 203d 2043 5353 5374 796c 652e  tyle = CSSStyle.
-000185a0: 6372 6561 7465 5f63 7373 5f73 7479 6c65  create_css_style
-000185b0: 5f66 726f 6d5f 6373 735f 7374 7269 6e67  _from_css_string
-000185c0: 2863 7373 290a 2020 2020 2020 2020 2020  (css).          
-000185d0: 2020 2320 7072 696e 7428 0a20 2020 2020    # print(.     
-000185e0: 2020 2020 2020 2023 2020 2020 2066 2266         #     f"f
-000185f0: 6f6e 743a 207b 6373 735f 7374 796c 652e  ont: {css_style.
-00018600: 666f 6e74 5f66 616d 696c 797d 2073 697a  font_family} siz
-00018610: 6520 7b63 7373 5f73 7479 6c65 2e66 6f6e  e {css_style.fon
-00018620: 745f 7369 7a65 7d20 626f 6c64 207b 6373  t_size} bold {cs
-00018630: 735f 7374 796c 652e 6973 5f62 6f6c 647d  s_style.is_bold}
-00018640: 2069 7461 6c69 6320 7b63 7373 5f73 7479   italic {css_sty
-00018650: 6c65 2e69 735f 6974 616c 6963 7d22 290a  le.is_italic}").
-00018660: 2020 2020 2020 2020 2020 2020 635f 7374              c_st
-00018670: 796c 6520 3d20 2222 0a20 2020 2020 2020  yle = "".       
-00018680: 2020 2020 2069 6620 6373 735f 7374 796c       if css_styl
-00018690: 652e 666f 6e74 5f66 616d 696c 793a 0a20  e.font_family:. 
-000186a0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000186b0: 5f73 7479 6c65 202b 3d20 6373 735f 7374  _style += css_st
-000186c0: 796c 652e 666f 6e74 5f66 616d 696c 792e  yle.font_family.
-000186d0: 6c6f 7765 7228 290a 2020 2020 2020 2020  lower().        
-000186e0: 2020 2020 6966 2063 7373 5f73 7479 6c65      if css_style
-000186f0: 2e66 6f6e 745f 7369 7a65 3a0a 2020 2020  .font_size:.    
-00018700: 2020 2020 2020 2020 2020 2020 635f 7374              c_st
-00018710: 796c 6520 2b3d 2022 5f22 202b 2073 7472  yle += "_" + str
-00018720: 2863 7373 5f73 7479 6c65 2e66 6f6e 745f  (css_style.font_
-00018730: 7369 7a65 292e 7265 706c 6163 6528 222e  size).replace(".
-00018740: 222c 2022 5f22 290a 2020 2020 2020 2020  ", "_").        
-00018750: 2020 2020 6966 2063 7373 5f73 7479 6c65      if css_style
-00018760: 2e69 735f 626f 6c64 3a0a 2020 2020 2020  .is_bold:.      
-00018770: 2020 2020 2020 2020 2020 635f 7374 796c            c_styl
-00018780: 6520 2b3d 2022 5f22 202b 2022 6222 0a20  e += "_" + "b". 
-00018790: 2020 2020 2020 2020 2020 2069 6620 6373             if cs
-000187a0: 735f 7374 796c 652e 6973 5f69 7461 6c69  s_style.is_itali
-000187b0: 633a 0a20 2020 2020 2020 2020 2020 2020  c:.             
-000187c0: 2020 2063 5f73 7479 6c65 202b 3d20 225f     c_style += "_
-000187d0: 2220 2b20 2269 220a 2020 2020 2020 2020  " + "i".        
-000187e0: 2020 2020 6966 2063 5f73 7479 6c65 2e73      if c_style.s
-000187f0: 7461 7274 7377 6974 6828 225f 2229 3a0a  tartswith("_"):.
-00018800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018810: 635f 7374 796c 6520 3d20 635f 7374 796c  c_style = c_styl
-00018820: 655b 313a 5d0a 2020 2020 2020 2020 2020  e[1:].          
-00018830: 2020 2320 7072 696e 7428 6622 635f 7374    # print(f"c_st
-00018840: 796c 6520 7b63 5f73 7479 6c65 7d22 290a  yle {c_style}").
-00018850: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-00018860: 5f73 7479 6c65 2021 3d20 2222 3a0a 2020  _style != "":.  
-00018870: 2020 2020 2020 2020 2020 2020 2020 7374                st
-00018880: 796c 655f 636f 6e76 6572 7465 725b 646f  yle_converter[do
-00018890: 745f 7374 796c 655b 313a 5d5d 203d 2063  t_style[1:]] = c
-000188a0: 5f73 7479 6c65 0a20 2020 2020 2020 2020  _style.         
-000188b0: 2020 2020 2020 2063 6c73 2e73 6574 5f63         cls.set_c
-000188c0: 6c61 7373 7265 665f 616e 645f 6373 7328  lassref_and_css(
-000188d0: 7374 796c 652c 2063 5f73 7479 6c65 2c20  style, c_style, 
-000188e0: 6373 7329 0a0a 2020 2020 2020 2020 7265  css)..        re
-000188f0: 7475 726e 2073 7479 6c65 5f63 6f6e 7665  turn style_conve
-00018900: 7274 6572 0a0a 2020 2020 4063 6c61 7373  rter..    @class
-00018910: 6d65 7468 6f64 0a20 2020 2064 6566 2073  method.    def s
-00018920: 6574 5f63 6c61 7373 7265 665f 616e 645f  et_classref_and_
-00018930: 6373 7328 636c 732c 2073 7479 6c65 5f65  css(cls, style_e
-00018940: 6c65 6d2c 2063 5f73 7479 6c65 2c20 6373  lem, c_style, cs
-00018950: 7329 3a0a 2020 2020 2020 2020 7374 796c  s):.        styl
-00018960: 655f 656c 656d 2e61 7474 7269 625b 2263  e_elem.attrib["c
-00018970: 6c61 7373 7265 6622 5d20 3d20 222e 2220  lassref"] = "." 
-00018980: 2b20 635f 7374 796c 650a 2020 2020 2020  + c_style.      
-00018990: 2020 7374 796c 655f 656c 656d 2e74 6578    style_elem.tex
-000189a0: 7420 3d20 222e 2220 2b20 635f 7374 796c  t = "." + c_styl
-000189b0: 6520 2b20 2220 7b22 202b 2063 7373 202b  e + " {" + css +
-000189c0: 2022 7d22 0a0a 0a63 6c61 7373 2048 746d   "}"...class Htm
-000189d0: 6c43 6c61 7373 3a0a 2020 2020 2222 220a  lClass:.    """.
-000189e0: 2020 2020 6d65 7468 6f64 7320 746f 2070      methods to p
-000189f0: 726f 6365 7373 2063 6c61 7373 202a 6174  rocess class *at
-00018a00: 7472 6962 7574 6573 2a20 6f6e 2048 544d  tributes* on HTM
-00018a10: 4c20 656c 656d 6e74 7320 616e 6420 7379  L elemnts and sy
-00018a20: 6e63 2077 6974 6820 7374 796c 650a 2020  nc with style.  
-00018a30: 2020 496e 6974 6961 6c6c 7920 6d61 696e    Initially main
-00018a40: 6c79 2040 636c 6173 736d 6574 686f 6420  ly @classmethod 
-00018a50: 6275 7420 6164 6469 6e67 2069 6e73 7461  but adding insta
-00018a60: 6d63 6573 2074 6f20 6d61 6e61 6765 2065  mces to manage e
-00018a70: 6469 7469 6e67 0a20 2020 2074 6865 2040  diting.    the @
-00018a80: 636c 6173 7320 6174 7472 6962 7574 650a  class attribute.
-00018a90: 2020 2020 2222 220a 0a20 2020 2064 6566      """..    def
-00018aa0: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
-00018ab0: 636c 6173 7373 7472 3d4e 6f6e 6529 3a0a  classstr=None):.
-00018ac0: 0a20 2020 2020 2020 2073 656c 662e 636c  .        self.cl
-00018ad0: 6173 7365 7320 3d20 7365 7428 290a 2020  asses = set().  
-00018ae0: 2020 2020 2020 6966 2063 6c61 7373 7374        if classst
-00018af0: 723a 0a20 2020 2020 2020 2020 2020 2069  r:.            i
-00018b00: 6620 7479 7065 2863 6c61 7373 7374 7229  f type(classstr)
-00018b10: 2069 7320 7374 723a 0a20 2020 2020 2020   is str:.       
-00018b20: 2020 2020 2020 2020 2073 656c 662e 636c           self.cl
-00018b30: 6173 7365 732e 7570 6461 7465 2863 6c61  asses.update(cla
-00018b40: 7373 7374 722e 7370 6c69 7428 2929 0a20  ssstr.split()). 
-00018b50: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00018b60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018b70: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00018b80: 7228 6622 6361 6e20 6f6e 6c79 2063 7265  r(f"can only cre
-00018b90: 6174 6520 4874 6d6c 436c 6173 7320 6672  ate HtmlClass fr
-00018ba0: 6f6d 2073 7472 696e 6773 2c20 666f 756e  om strings, foun
-00018bb0: 6420 7b74 7970 6528 636c 6173 7373 7472  d {type(classstr
-00018bc0: 297d 203a 207b 636c 6173 7373 7472 7d22  )} : {classstr}"
-00018bd0: 290a 0a20 2020 2023 2063 6c61 7373 2048  )..    # class H
-00018be0: 746d 6c43 6c61 7373 3a0a 0a20 2020 2040  tmlClass:..    @
-00018bf0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-00018c00: 6465 6620 6372 6561 7465 5f66 726f 6d5f  def create_from_
-00018c10: 636c 6173 7365 645f 656c 656d 656e 7428  classed_element(
-00018c20: 636c 732c 2065 6c65 6d29 3a0a 2020 2020  cls, elem):.    
-00018c30: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00018c40: 6765 7420 636c 6173 7320 7661 6c75 6520  get class value 
-00018c50: 6672 6f6d 2065 6c65 6d65 6e74 2061 6e64  from element and
-00018c60: 2063 6372 6561 7465 2048 746d 6c43 6c61   ccreate HtmlCla
-00018c70: 7373 0a20 2020 2020 2020 203a 7061 7261  ss.        :para
-00018c80: 6d20 656c 656d 3a20 656c 656d 656e 7473  m elem: elements
-00018c90: 2077 6974 6820 4063 6c61 7373 2061 7474   with @class att
-00018ca0: 7269 6275 7465 0a20 2020 2020 2020 203a  ribute.        :
-00018cb0: 7265 7475 726e 3a20 4874 6d6c 436c 6173  return: HtmlClas
-00018cc0: 7320 656c 656d 656e 7420 6f72 204e 6f6e  s element or Non
-00018cd0: 650a 2020 2020 2020 2020 2222 220a 2020  e.        """.  
-00018ce0: 2020 2020 2020 636c 617a 7a20 3d20 4874        clazz = Ht
-00018cf0: 6d6c 436c 6173 732e 6765 745f 636c 6173  mlClass.get_clas
-00018d00: 735f 7374 7269 6e67 5f6f 6e5f 656c 656d  s_string_on_elem
-00018d10: 656e 7428 656c 656d 290a 2020 2020 2020  ent(elem).      
-00018d20: 2020 7265 7475 726e 204e 6f6e 6520 6966    return None if
-00018d30: 206e 6f74 2063 6c61 7a7a 2065 6c73 6520   not clazz else 
-00018d40: 4874 6d6c 436c 6173 7328 636c 617a 7a29  HtmlClass(clazz)
-00018d50: 0a0a 2020 2020 2320 636c 6173 7320 4874  ..    # class Ht
-00018d60: 6d6c 436c 6173 733a 0a0a 2020 2020 4070  mlClass:..    @p
-00018d70: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-00018d80: 636c 6173 735f 7374 7269 6e67 2873 656c  class_string(sel
-00018d90: 6629 3a0a 2020 2020 2020 2020 2222 220a  f):.        """.
-00018da0: 2020 2020 2020 2020 7265 7475 726e 2074          return t
-00018db0: 6865 2063 6c61 7373 5f73 7472 696e 6720  he class_string 
-00018dc0: 2863 7265 6174 6573 2066 726f 6d20 6c61  (creates from la
-00018dd0: 7465 7374 2073 656c 662e 636c 6173 7365  test self.classe
-00018de0: 7329 0a20 2020 2020 2020 203a 7265 7475  s).        :retu
-00018df0: 726e 3a20 7374 7269 6e67 206f 6620 616c  rn: string of al
-00018e00: 7068 6162 6574 6963 6361 6c6c 7920 736f  phabeticcally so
-00018e10: 7274 6564 2073 7065 6365 2d73 6570 6172  rted spece-separ
-00018e20: 6174 6564 2063 6c61 7373 6573 0a20 2020  ated classes.   
-00018e30: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00018e40: 2072 6574 7572 6e20 2222 2069 6620 6e6f   return "" if no
-00018e50: 7420 7365 6c66 2e63 6c61 7373 6573 2065  t self.classes e
-00018e60: 6c73 6520 2220 222e 6a6f 696e 2873 6f72  lse " ".join(sor
-00018e70: 7465 6428 6c69 7374 2873 656c 662e 636c  ted(list(self.cl
-00018e80: 6173 7365 7329 2929 0a0a 2020 2020 6465  asses)))..    de
-00018e90: 6620 6164 645f 636c 6173 7328 7365 6c66  f add_class(self
-00018ea0: 2c20 636c 617a 7a29 3a0a 2020 2020 2020  , clazz):.      
-00018eb0: 2020 2222 220a 2020 2020 2020 2020 6164    """.        ad
-00018ec0: 6420 636c 6173 7320 746f 2063 6c61 7373  d class to class
-00018ed0: 5f73 7472 696e 670a 2020 2020 2020 2020  _string.        
-00018ee0: 3a70 6172 616d 2063 6c61 7a7a 3a20 636c  :param clazz: cl
-00018ef0: 6173 7320 746f 2061 6464 2028 6d75 7374  ass to add (must
-00018f00: 2062 6520 6e6f 6e2d 656d 7074 7920 7374   be non-empty st
-00018f10: 7269 6e67 0a20 2020 2020 2020 2069 6620  ring.        if 
-00018f20: 636c 617a 7a20 6973 0a20 2020 2020 2020  clazz is.       
-00018f30: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
-00018f40: 636c 617a 7a20 616e 6420 6c65 6e28 636c  clazz and len(cl
-00018f50: 617a 7a2e 7374 7269 7028 2929 203e 2030  azz.strip()) > 0
-00018f60: 2061 6e64 2063 6c61 7a7a 206e 6f74 2069   and clazz not i
-00018f70: 6e20 7365 6c66 2e63 6c61 7373 6573 3a0a  n self.classes:.
-00018f80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00018f90: 2e63 6c61 7373 6573 2e61 6464 2863 6c61  .classes.add(cla
-00018fa0: 7a7a 2e73 7472 6970 2829 290a 0a20 2020  zz.strip())..   
-00018fb0: 2023 2063 6c61 7373 2048 746d 6c43 6c61   # class HtmlCla
-00018fc0: 7373 3a0a 0a20 2020 2064 6566 2068 6173  ss:..    def has
-00018fd0: 5f63 6c61 7373 2873 656c 662c 2063 6c61  _class(self, cla
-00018fe0: 7a7a 293a 0a20 2020 2020 2020 2022 2222  zz):.        """
-00018ff0: 0a20 2020 2020 2020 2064 6f65 7320 636c  .        does cl
-00019000: 6173 7320 6578 6973 7420 696e 2063 6c61  ass exist in cla
-00019010: 7373 6573 0a20 2020 2020 2020 203a 7061  sses.        :pa
-00019020: 7261 6d20 636c 617a 7a3a 0a20 2020 2020  ram clazz:.     
-00019030: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
-00019040: 6574 7572 6e20 636c 617a 7a20 696e 2073  eturn clazz in s
-00019050: 656c 662e 636c 6173 7365 730a 0a20 2020  elf.classes..   
-00019060: 2023 2063 6c61 7373 2048 746d 6c43 6c61   # class HtmlCla
-00019070: 7373 3a0a 0a20 2020 2064 6566 2072 6570  ss:..    def rep
-00019080: 6c61 6365 5f63 6c61 7373 2873 656c 662c  lace_class(self,
-00019090: 2063 6c61 7a7a 5f6f 6c64 2c20 636c 617a   clazz_old, claz
-000190a0: 7a3d 4e6f 6e65 293a 0a20 2020 2020 2020  z=None):.       
-000190b0: 2022 2222 0a20 2020 2020 2020 2072 656d   """.        rem
-000190c0: 6f76 6520 636c 617a 7a5f 6f6c 6420 3b20  ove clazz_old ; 
-000190d0: 6966 2063 6c61 7a7a 2069 7320 6e6f 7420  if clazz is not 
-000190e0: 4e6f 6e65 2061 6464 2069 7420 6173 206e  None add it as n
-000190f0: 6577 2063 6c61 7373 0a20 2020 2020 2020  ew class.       
-00019100: 2028 6966 2063 6c61 7a7a 2069 7320 616c   (if clazz is al
-00019110: 7265 6164 7920 7072 6573 656e 742c 206e  ready present, n
-00019120: 6f2d 6f70 290a 2020 2020 2020 2020 2222  o-op).        ""
-00019130: 220a 2020 2020 2020 2020 6966 2063 6c61  ".        if cla
-00019140: 7a7a 5f6f 6c64 2069 6e20 7365 6c66 2e63  zz_old in self.c
-00019150: 6c61 7373 6573 3a0a 2020 2020 2020 2020  lasses:.        
-00019160: 2020 2020 7365 6c66 2e72 656d 6f76 6528      self.remove(
-00019170: 636c 617a 7a5f 6f6c 6429 0a20 2020 2020  clazz_old).     
-00019180: 2020 2020 2020 2069 6620 636c 617a 7a3a         if clazz:
-00019190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000191a0: 2073 656c 662e 6164 645f 636c 6173 7328   self.add_class(
-000191b0: 636c 617a 7a29 0a0a 2020 2020 2320 636c  clazz)..    # cl
-000191c0: 6173 7320 4874 6d6c 436c 6173 733a 0a0a  ass HtmlClass:..
-000191d0: 2020 2020 6465 6620 7265 6d6f 7665 2873      def remove(s
-000191e0: 656c 662c 2063 6c61 7a7a 293a 0a20 2020  elf, clazz):.   
-000191f0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00019200: 2072 656d 6f76 6520 636c 6173 7320 6672   remove class fr
-00019210: 6f6d 2073 7472 696e 670a 2020 2020 2020  om string.      
-00019220: 2020 3a70 6172 616d 2063 6c61 7a7a 3a20    :param clazz: 
-00019230: 636c 6173 7320 7374 7269 6e67 2074 6f20  class string to 
-00019240: 7265 6d6f 7665 0a20 2020 2020 2020 2069  remove.        i
-00019250: 6620 206e 6f74 2070 7265 7365 6e74 2c20  f  not present, 
-00019260: 6e6f 2d6f 700a 2020 2020 2020 2020 2222  no-op.        ""
-00019270: 220a 2020 2020 2020 2020 6966 2063 6c61  ".        if cla
-00019280: 7a7a 2069 6e20 7365 6c66 2e63 6c61 7373  zz in self.class
-00019290: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-000192a0: 7365 6c66 2e63 6c61 7373 6573 2e72 656d  self.classes.rem
-000192b0: 6f76 6528 636c 617a 7a29 0a0a 2020 2020  ove(clazz)..    
-000192c0: 2320 636c 6173 7320 4874 6d6c 436c 6173  # class HtmlClas
-000192d0: 733a 0a0a 2020 2020 4063 6c61 7373 6d65  s:..    @classme
-000192e0: 7468 6f64 0a20 2020 2064 6566 2067 6574  thod.    def get
-000192f0: 5f63 6c61 7373 5f73 7472 696e 675f 6f6e  _class_string_on
-00019300: 5f65 6c65 6d65 6e74 2863 6c73 2c20 656c  _element(cls, el
-00019310: 656d 293a 0a20 2020 2020 2020 2022 2222  em):.        """
-00019320: 0a20 2020 2020 2020 2063 6f6e 7665 6e69  .        conveni
-00019330: 656e 6365 206d 6574 686f 6420 746f 2067  ence method to g
-00019340: 6574 2065 6c65 6d65 6e74 2073 7479 6c65  et element style
-00019350: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00019360: 656c 656d 3a20 746f 2067 6574 2073 7479  elem: to get sty
-00019370: 6c65 2066 726f 6d0a 2020 2020 2020 2020  le from.        
-00019380: 3a72 6574 7572 6e3a 2073 7479 6c65 206f  :return: style o
-00019390: 7220 4e6f 6e65 0a20 2020 2020 2020 2022  r None.        "
-000193a0: 2222 0a0a 2020 2020 2020 2020 7265 7475  ""..        retu
-000193b0: 726e 2065 6c65 6d2e 6174 7472 6962 2e67  rn elem.attrib.g
-000193c0: 6574 2822 636c 6173 7322 2920 6966 2074  et("class") if t
-000193d0: 7970 6528 656c 656d 2920 6973 205f 456c  ype(elem) is _El
-000193e0: 656d 656e 7420 656c 7365 204e 6f6e 650a  ement else None.
-000193f0: 0a20 2020 2023 2063 6c61 7373 2048 746d  .    # class Htm
-00019400: 6c43 6c61 7373 3a0a 0a20 2020 2040 636c  lClass:..    @cl
-00019410: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-00019420: 6620 7365 745f 636c 6173 735f 6f6e 5f65  f set_class_on_e
-00019430: 6c65 6d65 6e74 2863 6c73 2c20 656c 656d  lement(cls, elem
-00019440: 2c20 7661 6c75 652c 2072 6570 6c61 6365  , value, replace
-00019450: 3d54 7275 6529 3a0a 2020 2020 2020 2020  =True):.        
-00019460: 2222 220a 2020 2020 2020 2020 636f 6e76  """.        conv
-00019470: 656e 6965 6e63 6520 6d65 7468 6f64 2074  enience method t
-00019480: 6f20 7365 7420 636c 6173 7320 6f6e 2065  o set class on e
-00019490: 6c65 6d65 6e74 0a20 2020 2020 2020 203a  lement.        :
-000194a0: 7061 7261 6d20 656c 656d 3a65 6c65 6d65  param elem:eleme
-000194b0: 6e74 2074 6f20 7365 7420 636c 6173 7320  nt to set class 
-000194c0: 6f6e 0a20 2020 2020 2020 203a 7061 7261  on.        :para
-000194d0: 6d20 7661 6c75 653a 2068 746d 6c20 636c  m value: html cl
-000194e0: 6173 730a 2020 2020 2020 2020 3a70 6172  ass.        :par
-000194f0: 616d 2072 6570 6c61 6365 3a69 6620 5472  am replace:if Tr
-00019500: 7565 2072 6570 6c61 6365 2c20 656c 7365  ue replace, else
-00019510: 2061 6464 2074 6f20 6578 6973 7469 6e67   add to existing
-00019520: 2061 7474 7269 6275 7465 0a20 2020 2020   attribute.     
-00019530: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-00019540: 6620 656c 656d 2069 7320 6e6f 7420 4e6f  f elem is not No
-00019550: 6e65 2061 6e64 2076 616c 7565 3a0a 2020  ne and value:.  
-00019560: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00019570: 2072 6570 6c61 6365 3a0a 2020 2020 2020   replace:.      
-00019580: 2020 2020 2020 2020 2020 6f6c 645f 636c            old_cl
-00019590: 6173 7320 3d20 4874 6d6c 436c 6173 732e  ass = HtmlClass.
-000195a0: 6765 745f 636c 6173 735f 7374 7269 6e67  get_class_string
-000195b0: 5f6f 6e5f 656c 656d 656e 7428 656c 656d  _on_element(elem
-000195c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000195d0: 2020 6966 206f 6c64 5f63 6c61 7373 3a0a    if old_class:.
-000195e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000195f0: 2020 2020 6966 2076 616c 7565 206e 6f74      if value not
-00019600: 2069 6e20 6f6c 645f 636c 6173 733a 0a20   in old_class:. 
-00019610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019620: 2020 2020 2020 206f 6c64 5f63 6c61 7373         old_class
-00019630: 202b 3d20 2220 2220 2b20 7661 6c75 650a   += " " + value.
-00019640: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00019650: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00019660: 2020 6f6c 645f 636c 6173 7320 3d20 7661    old_class = va
-00019670: 6c75 650a 2020 2020 2020 2020 2020 2020  lue.            
-00019680: 656c 656d 2e61 7474 7269 625b 2263 6c61  elem.attrib["cla
-00019690: 7373 225d 203d 2076 616c 7565 0a0a 2020  ss"] = value..  
-000196a0: 2020 2320 636c 6173 7320 4874 6d6c 436c    # class HtmlCl
-000196b0: 6173 733a 0a0a 2020 2020 6465 6620 6372  ass:..    def cr
-000196c0: 6561 7465 5f63 6c61 7373 7265 6628 7365  eate_classref(se
-000196d0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-000196e0: 0a20 2020 2020 2020 2063 7265 6174 6520  .        create 
-000196f0: 636c 6173 7372 6566 2073 7472 696e 6720  classref string 
-00019700: 2870 7265 7065 6e64 2022 2e22 290a 2020  (prepend ".").  
-00019710: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00019720: 2020 7265 7475 726e 2022 2e22 202b 2073    return "." + s
-00019730: 656c 662e 636c 6173 735f 7374 7269 6e67  elf.class_string
-00019740: 0a0a 2020 2020 2320 636c 6173 7320 4874  ..    # class Ht
-00019750: 6d6c 436c 6173 733a 0a0a 2020 2020 4063  mlClass:..    @c
-00019760: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-00019770: 6566 2072 656d 6f76 655f 646f 7428 7365  ef remove_dot(se
-00019780: 6c66 2c20 7374 7269 6e67 293a 0a20 2020  lf, string):.   
-00019790: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000197a0: 2072 656d 6f76 6520 646f 7420 2822 2e22   remove dot ("."
-000197b0: 2920 2d20 696e 2068 746d 6c2f 6865 6164  ) - in html/head
-000197c0: 2f73 7479 6c65 2065 6c65 6d65 6e74 0a20  /style element. 
-000197d0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000197e0: 2020 2072 6574 7572 6e20 7374 7269 6e67     return string
-000197f0: 5b31 3a5d 2069 6620 7374 7269 6e67 2061  [1:] if string a
-00019800: 6e64 2073 7472 696e 675b 3a31 5d20 3d3d  nd string[:1] ==
-00019810: 2022 2e22 2065 6c73 6520 7374 7269 6e67   "." else string
-00019820: 0a0a 0a63 6c61 7373 2048 746d 6c54 7265  ...class HtmlTre
-00019830: 653a 0a20 2020 2022 2222 6275 696c 6473  e:.    """builds
-00019840: 2061 2074 7265 6520 6672 6f6d 2061 2066   a tree from a f
-00019850: 6c61 7420 7365 7420 6f66 2048 746d 6c20  lat set of Html 
-00019860: 656c 656d 6e65 7473 2222 220a 0a20 2020  elemnets"""..   
-00019870: 2023 2066 6f72 2074 6865 2073 6563 7469   # for the secti
-00019880: 6f6e 5f72 6563 730a 2020 2020 4348 4150  on_recs.    CHAP
-00019890: 5f54 4f50 203d 2022 4348 4150 5f54 4f50  _TOP = "CHAP_TOP
-000198a0: 220a 2020 2020 4348 4150 5f53 4543 5449  ".    CHAP_SECTI
-000198b0: 4f4e 5320 3d20 2243 4841 505f 5345 4354  ONS = "CHAP_SECT
-000198c0: 494f 4e53 220a 2020 2020 4348 4150 5f53  IONS".    CHAP_S
-000198d0: 5542 5345 4354 5320 3d20 2243 4841 505f  UBSECTS = "CHAP_
-000198e0: 5355 4253 4543 5453 220a 0a20 2020 2023  SUBSECTS"..    #
-000198f0: 2043 6861 7074 6572 0a20 2020 2054 5245   Chapter.    TRE
-00019900: 455f 524f 4f54 203d 2022 7472 6565 5f72  E_ROOT = "tree_r
-00019910: 6f6f 7422 0a20 2020 2043 4c41 5353 203d  oot".    CLASS =
-00019920: 2022 636c 6173 7322 0a20 2020 2050 5245   "class".    PRE
-00019930: 5f43 4841 5053 4543 203d 2022 7072 655f  _CHAPSEC = "pre_
-00019940: 6368 6170 7365 6322 0a0a 2020 2020 2320  chapsec"..    # 
-00019950: 7365 6374 696f 6e73 0a20 2020 2043 4841  sections.    CHA
-00019960: 5053 4543 203d 2022 6368 6170 7365 6322  PSEC = "chapsec"
-00019970: 0a20 2020 2054 4f50 5f44 4956 203d 2022  .    TOP_DIV = "
-00019980: 746f 705f 6469 7622 0a0a 2020 2020 2320  top_div"..    # 
-00019990: 5850 6174 6873 0a20 2020 2041 4c4c 5f44  XPaths.    ALL_D
-000199a0: 4956 5f58 5041 5448 5320 3d20 222e 2f2f  IV_XPATHS = ".//
-000199b0: 6469 7622 0a0a 2020 2020 2320 636c 6173  div"..    # clas
-000199c0: 7320 4874 6d6c 5472 6565 0a0a 2020 2020  s HtmlTree..    
-000199d0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-000199e0: 2064 6566 206d 616b 655f 7365 6374 696f   def make_sectio
-000199f0: 6e73 5f61 6e64 5f6f 7574 7075 7428 636c  ns_and_output(cl
-00019a00: 732c 2065 6c65 6d2c 206f 7574 7075 745f  s, elem, output_
-00019a10: 6469 722c 2072 6563 735f 6279 5f73 6563  dir, recs_by_sec
-00019a20: 7469 6f6e 3d4e 6f6e 6529 3a0a 2020 2020  tion=None):.    
-00019a30: 2020 2020 2222 2266 696e 6420 6465 6369      """find deci
-00019a40: 6d61 6c20 6e75 6d62 6572 2066 6f72 2074  mal number for t
-00019a50: 7265 650a 2020 2020 2020 2020 5468 6953  ree.        ThiS
-00019a60: 2069 7320 4845 4156 494c 5920 6261 7365   is HEAVILY base
-00019a70: 6420 6f6e 2049 5043 430a 2020 2020 2020  d on IPCC.      
-00019a80: 2020 6375 7272 656e 746c 7920 6361 6c6c    currently call
-00019a90: 6564 2069 6e20 7469 6479 5f66 6c6f 7728  ed in tidy_flow(
-00019aa0: 290a 2020 2020 2020 2020 2222 220a 2020  ).        """.  
-00019ab0: 2020 2020 2020 6d61 726b 6572 7320 3d20        markers = 
-00019ac0: 5b22 4368 6170 7465 7222 2c0a 2020 2020  ["Chapter",.    
-00019ad0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00019ae0: 2022 5461 626c 6520 6f66 2043 6f6e 7465   "Table of Conte
-00019af0: 6e74 7322 2c0a 2020 2020 2020 2020 2020  nts",.          
-00019b00: 2020 2020 2020 2020 2022 5461 626c 6520           "Table 
-00019b10: 6f66 222c 2020 2320 6f6e 6520 6973 2063  of",  # one is c
-00019b20: 6f6e 6361 7465 6e61 7465 6420 2843 6861  oncatenated (Cha
-00019b30: 7074 6572 3031 2920 736f 2061 6262 7265  pter01) so abbre
-00019b40: 7669 6174 652c 2075 6e77 6569 6768 7465  viate, unweighte
-00019b50: 6420 4368 6170 3136 0a20 2020 2020 2020  d Chap16.       
-00019b60: 2020 2020 2020 2020 2020 2020 2320 2245              # "E
-00019b70: 7865 6375 7469 7665 2053 756d 6d61 7279  xecutive Summary
-00019b80: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00019b90: 2020 2020 2020 2245 7865 6375 7469 7665        "Executive
-00019ba0: 222c 2020 2320 6361 7365 2076 6172 6961  ",  # case varia
-00019bb0: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
-00019bc0: 2020 2020 2020 2020 2320 2246 7265 7175          # "Frequ
-00019bd0: 656e 746c 7920 4173 6b65 6420 5175 6573  ently Asked Ques
-00019be0: 7469 6f6e 7322 2c20 2320 6e6f 7420 696e  tions", # not in
-00019bf0: 2043 6861 7074 6572 3031 0a20 2020 2020   Chapter01.     
-00019c00: 2020 2020 2020 2020 2020 2020 2020 2246                "F
-00019c10: 7265 7175 656e 746c 7922 2c20 2023 2063  requently",  # c
-00019c20: 6173 6520 7661 7269 6174 696f 6e0a 2020  ase variation.  
-00019c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019c40: 2022 5265 6665 7265 6e63 6573 222c 0a20   "References",. 
-00019c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019c60: 2020 5d0a 2020 2020 2020 2020 6973 5f62    ].        is_b
-00019c70: 6f6c 6420 3d20 5472 7565 0a20 2020 2020  old = True.     
-00019c80: 2020 2066 6f6e 745f 7369 7a65 5f72 616e     font_size_ran
-00019c90: 6765 203d 2028 3132 2c20 3939 3929 0a20  ge = (12, 999). 
-00019ca0: 2020 2020 2020 2066 6f72 206d 6172 6b65         for marke
-00019cb0: 7220 696e 206d 6172 6b65 7273 3a0a 2020  r in markers:.  
-00019cc0: 2020 2020 2020 2020 2020 6d61 726b 6564            marked
-00019cd0: 5f64 6976 2c20 6469 7673 203d 2063 6c73  _div, divs = cls
-00019ce0: 2e67 6574 5f64 6976 5f73 7061 6e5f 7374  .get_div_span_st
-00019cf0: 6172 7469 6e67 5f77 6974 6828 656c 656d  arting_with(elem
-00019d00: 2c20 6d61 726b 6572 2c20 6973 5f62 6f6c  , marker, is_bol
-00019d10: 642c 2066 6f6e 745f 7369 7a65 5f72 616e  d, font_size_ran
-00019d20: 6765 3d66 6f6e 745f 7369 7a65 5f72 616e  ge=font_size_ran
-00019d30: 6765 290a 2020 2020 2020 2020 2020 2020  ge).            
-00019d40: 6966 206d 6172 6b65 645f 6469 7620 6973  if marked_div is
-00019d50: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00019d60: 2020 2020 2020 2020 2020 206c 6420 3d20             ld = 
-00019d70: 6c65 6e28 6469 7673 2920 6966 2064 6976  len(divs) if div
-00019d80: 7320 656c 7365 2030 0a20 2020 2020 2020  s else 0.       
-00019d90: 2020 2020 2020 2020 206c 6f67 6769 6e67           logging
-00019da0: 2e77 6172 6e69 6e67 2866 2243 616e 6e6f  .warning(f"Canno
-00019db0: 7420 6669 6e64 206d 6172 6b65 7220 5b7b  t find marker [{
-00019dc0: 6d61 726b 6572 7d5d 2066 6f75 6e64 207b  marker}] found {
-00019dd0: 6c64 7d20 6d61 726b 6572 7322 290a 0a20  ld} markers").. 
-00019de0: 2020 2020 2020 2063 6c61 7373 5f64 6963         class_dic
-00019df0: 7420 3d20 7b63 6c73 2e43 4841 5053 4543  t = {cls.CHAPSEC
-00019e00: 3a20 636c 732e 5052 455f 4348 4150 5345  : cls.PRE_CHAPSE
-00019e10: 432c 0a20 2020 2020 2020 2020 2020 2020  C,.             
-00019e20: 2020 2020 2020 2020 2063 6c73 2e54 4f50           cls.TOP
-00019e30: 5f44 4956 3a20 636c 732e 5452 4545 5f52  _DIV: cls.TREE_R
-00019e40: 4f4f 542c 207d 0a20 2020 2020 2020 2072  OOT, }.        r
-00019e50: 6563 203d 2072 6563 735f 6279 5f73 6563  ec = recs_by_sec
-00019e60: 7469 6f6e 2e67 6574 2863 6c73 2e43 4841  tion.get(cls.CHA
-00019e70: 505f 544f 5029 0a20 2020 2020 2020 2061  P_TOP).        a
-00019e80: 7373 6572 7420 7265 6320 6973 206e 6f74  ssert rec is not
-00019e90: 204e 6f6e 652c 2066 2277 616e 7465 6420   None, f"wanted 
-00019ea0: 6e6f 6e2d 4e6f 6e65 207b 636c 732e 4348  non-None {cls.CH
-00019eb0: 4150 5f54 4f50 7d20 7265 6322 0a20 2020  AP_TOP} rec".   
-00019ec0: 2020 2020 2064 6563 696d 616c 5f64 6976       decimal_div
-00019ed0: 7320 3d20 636c 732e 6765 745f 6469 765f  s = cls.get_div_
-00019ee0: 7370 616e 735f 7769 7468 5f64 6563 696d  spans_with_decim
-00019ef0: 616c 7328 656c 656d 2c0a 2020 2020 2020  als(elem,.      
-00019f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019f30: 2069 735f 626f 6c64 2c0a 2020 2020 2020   is_bold,.      
-00019f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017ad0: 2020 2020 3a70 6172 616d 2065 6c65 6d3a      :param elem:
+00017ae0: 2065 6c65 6d65 6e74 7320 7769 7468 2040   elements with @
+00017af0: 636c 6173 7320 6174 7472 6962 7574 650a  class attribute.
+00017b00: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
+00017b10: 2043 5353 5374 796c 6520 6f62 6a65 6374   CSSStyle object
+00017b20: 2077 6974 6820 4874 6d6c 5374 796c 650a   with HtmlStyle.
+00017b30: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00017b40: 2020 2020 636c 617a 7a20 3d20 656c 656d      clazz = elem
+00017b50: 2e67 6574 2822 636c 6173 7322 290a 2020  .get("class").  
+00017b60: 2020 2020 2020 6373 735f 7374 796c 6520        css_style 
+00017b70: 3d20 4874 6d6c 5374 796c 652e 6c6f 6f6b  = HtmlStyle.look
+00017b80: 7570 5f68 6561 645f 7374 796c 655f 6279  up_head_style_by
+00017b90: 5f63 6c61 7373 2865 6c65 6d2c 2063 6c61  _class(elem, cla
+00017ba0: 7a7a 290a 2020 2020 2020 2020 7265 7475  zz).        retu
+00017bb0: 726e 2063 7373 5f73 7479 6c65 0a0a 2020  rn css_style..  
+00017bc0: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+00017bd0: 2020 2064 6566 206c 6f6f 6b75 705f 6865     def lookup_he
+00017be0: 6164 5f73 7479 6c65 5f62 795f 636c 6173  ad_style_by_clas
+00017bf0: 7328 636c 732c 2068 746d 6c2c 2063 6c61  s(cls, html, cla
+00017c00: 7a7a 293a 0a20 2020 2020 2020 2022 2222  zz):.        """
+00017c10: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00017c20: 6874 6d6c 3a20 4854 4d4c 2065 6c65 6d65  html: HTML eleme
+00017c30: 6e74 2077 6974 6820 6865 6164 2f73 7479  nt with head/sty
+00017c40: 6c65 0a20 2020 2020 2020 203a 7061 7261  le.        :para
+00017c50: 6d20 636c 617a 7a3a 2063 6c61 7373 2074  m clazz: class t
+00017c60: 6f20 7265 7469 7276 6520 7374 796c 6520  o retirve style 
+00017c70: 656c 656d 656e 740a 2020 2020 2020 2020  element.        
+00017c80: 2222 220a 2020 2020 2020 2020 7374 796c  """.        styl
+00017c90: 6573 203d 2068 746d 6c2e 7870 6174 6828  es = html.xpath(
+00017ca0: 6622 2f68 746d 6c2f 6865 6164 2f73 7479  f"/html/head/sty
+00017cb0: 6c65 5b63 6f6e 7461 696e 7328 2e2c 272e  le[contains(.,'.
+00017cc0: 7b63 6c61 7a7a 7d20 2729 5d22 290a 2020  {clazz} ')]").  
+00017cd0: 2020 2020 2020 6966 206c 656e 2873 7479        if len(sty
+00017ce0: 6c65 7329 203d 3d20 303a 0a20 2020 2020  les) == 0:.     
+00017cf0: 2020 2020 2020 2070 7269 6e74 2866 226e         print(f"n
+00017d00: 6f20 7374 796c 6573 2066 6f72 207b 636c  o styles for {cl
+00017d10: 617a 7a7d 2229 0a20 2020 2020 2020 2020  azz}").         
+00017d20: 2020 2072 6574 7572 6e20 4e6f 6e65 0a20     return None. 
+00017d30: 2020 2020 2020 2068 6561 645f 7374 796c         head_styl
+00017d40: 6520 3d20 7374 796c 6573 5b30 5d0a 2020  e = styles[0].  
+00017d50: 2020 2020 2020 5f2c 2063 7373 5f73 7479        _, css_sty
+00017d60: 6c65 203d 2043 5353 5374 796c 652e 6372  le = CSSStyle.cr
+00017d70: 6561 7465 5f63 7373 5f73 7479 6c65 5f66  eate_css_style_f
+00017d80: 726f 6d5f 6874 6d6c 5f68 6561 645f 7374  rom_html_head_st
+00017d90: 796c 655f 656c 656d 2868 6561 645f 7374  yle_elem(head_st
+00017da0: 796c 6529 0a20 2020 2020 2020 2072 6574  yle).        ret
+00017db0: 7572 6e20 6373 735f 7374 796c 650a 0a20  urn css_style.. 
+00017dc0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+00017dd0: 2020 2020 6465 6620 6973 5f62 6f6c 6428      def is_bold(
+00017de0: 636c 732c 2065 6c65 6d29 3a0a 2020 2020  cls, elem):.    
+00017df0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00017e00: 6669 6e64 7320 4063 6c61 7373 2069 6e20  finds @class in 
+00017e10: 656c 656d 2061 6e64 206c 6f6f 6b73 2075  elem and looks u
+00017e20: 7020 7374 796c 6520 696e 2068 746d 6c2f  p style in html/
+00017e30: 6865 6164 0a20 2020 2020 2020 2022 2222  head.        """
+00017e40: 0a20 2020 2020 2020 2069 6620 656c 656d  .        if elem
+00017e50: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00017e60: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00017e70: 7365 0a20 2020 2020 2020 2063 7373 5f73  se.        css_s
+00017e80: 7479 6c65 203d 2048 746d 6c53 7479 6c65  tyle = HtmlStyle
+00017e90: 2e6c 6f6f 6b75 705f 6865 6164 5f73 7479  .lookup_head_sty
+00017ea0: 6c65 5f62 795f 636c 6173 7372 6566 2865  le_by_classref(e
+00017eb0: 6c65 6d29 0a20 2020 2020 2020 2069 6620  lem).        if 
+00017ec0: 6e6f 7420 6373 735f 7374 796c 653a 0a20  not css_style:. 
+00017ed0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00017ee0: 2866 226e 6f20 7374 796c 6520 7265 736f  (f"no style reso
+00017ef0: 6c76 6564 2066 6f72 207b 4554 2e74 6f73  lved for {ET.tos
+00017f00: 7472 696e 6728 656c 656d 297d 2229 0a20  tring(elem)}"). 
+00017f10: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00017f20: 6e20 4661 6c73 650a 2020 2020 2020 2020  n False.        
+00017f30: 7265 7475 726e 2063 7373 5f73 7479 6c65  return css_style
+00017f40: 2e69 735f 626f 6c64 0a0a 2020 2020 4063  .is_bold..    @c
+00017f50: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+00017f60: 6566 2069 735f 6974 616c 6963 2863 6c73  ef is_italic(cls
+00017f70: 2c20 656c 656d 293a 0a20 2020 2020 2020  , elem):.       
+00017f80: 2022 2222 0a20 2020 2020 2020 2066 696e   """.        fin
+00017f90: 6473 2040 636c 6173 7320 696e 2065 6c65  ds @class in ele
+00017fa0: 6d20 616e 6420 6c6f 6f6b 7320 7570 2073  m and looks up s
+00017fb0: 7479 6c65 2069 6e20 6874 6d6c 2f68 6561  tyle in html/hea
+00017fc0: 640a 2020 2020 2020 2020 2222 220a 2020  d.        """.  
+00017fd0: 2020 2020 2020 6966 2065 6c65 6d20 6973        if elem is
+00017fe0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00017ff0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+00018000: 2020 2020 2020 2020 6373 735f 7374 796c          css_styl
+00018010: 6520 3d20 4874 6d6c 5374 796c 652e 6c6f  e = HtmlStyle.lo
+00018020: 6f6b 7570 5f68 6561 645f 7374 796c 655f  okup_head_style_
+00018030: 6279 5f63 6c61 7373 7265 6628 656c 656d  by_classref(elem
+00018040: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
+00018050: 2063 7373 5f73 7479 6c65 3a0a 2020 2020   css_style:.    
+00018060: 2020 2020 2020 2020 7072 696e 7428 6622          print(f"
+00018070: 6e6f 2073 7479 6c65 2072 6573 6f6c 7665  no style resolve
+00018080: 6420 666f 7220 7b45 542e 746f 7374 7269  d for {ET.tostri
+00018090: 6e67 2865 6c65 6d29 7d22 290a 2020 2020  ng(elem)}").    
+000180a0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+000180b0: 616c 7365 0a20 2020 2020 2020 2072 6574  alse.        ret
+000180c0: 7572 6e20 6373 735f 7374 796c 652e 6973  urn css_style.is
+000180d0: 5f69 7461 6c69 630a 0a20 2020 2040 636c  _italic..    @cl
+000180e0: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+000180f0: 6620 6765 745f 626f 6479 5f63 6c61 7373  f get_body_class
+00018100: 7265 6673 2863 6c73 2c20 6874 6d6c 5f65  refs(cls, html_e
+00018110: 6c65 6d29 3a0a 2020 2020 2020 2020 2222  lem):.        ""
+00018120: 2273 6561 7263 6865 7320 616c 6c20 626f  "searches all bo
+00018130: 6479 2065 6c65 6d65 6e74 7320 666f 7220  dy elements for 
+00018140: 4063 6c61 7373 2061 7474 7269 6275 7465  @class attribute
+00018150: 730a 2020 2020 2020 2020 3a70 6172 616d  s.        :param
+00018160: 2068 746d 6c5f 656c 656d 3a20 6874 6d6c   html_elem: html
+00018170: 2065 6c65 6d65 6e74 0a20 2020 2020 2020   element.       
+00018180: 203a 7265 7475 726e 3a20 616c 6c20 626f   :return: all bo
+00018190: 6479 2065 6c65 6d65 6e74 7320 7769 7468  dy elements with
+000181a0: 2040 636c 6173 7320 6174 7472 6962 7574   @class attribut
+000181b0: 6573 0a20 2020 2020 2020 2022 2222 0a20  es.        """. 
+000181c0: 2020 2020 2020 2062 6f64 7920 3d20 4874         body = Ht
+000181d0: 6d6c 4c69 622e 6765 745f 626f 6479 2868  mlLib.get_body(h
+000181e0: 746d 6c5f 656c 656d 290a 2020 2020 2020  tml_elem).      
+000181f0: 2020 7265 7475 726e 205b 5d20 6966 2062    return [] if b
+00018200: 6f64 7920 6973 204e 6f6e 6520 656c 7365  ody is None else
+00018210: 2062 6f64 792e 7870 6174 6828 222e 2f2f   body.xpath(".//
+00018220: 2a5b 4063 6c61 7373 5d22 290a 0a20 2020  *[@class]")..   
+00018230: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+00018240: 2020 6465 6620 6372 6561 7465 5f61 6262    def create_abb
+00018250: 7265 7669 6174 6564 5f66 6f6e 745f 7374  reviated_font_st
+00018260: 796c 6573 2863 6c73 2c20 6874 6d6c 5f65  yles(cls, html_e
+00018270: 6c65 6d29 3a0a 2020 2020 2020 2020 2222  lem):.        ""
+00018280: 2263 7265 6174 6573 2072 6561 6461 626c  "creates readabl
+00018290: 6520 7374 796c 656e 616d 6573 0a20 2020  e stylenames.   
+000182a0: 2020 2020 202e 7330 207b 666f 6e74 2d66       .s0 {font-f
+000182b0: 616d 696c 793a 2054 696d 6573 4e65 7752  amily: TimesNewR
+000182c0: 6f6d 616e 5053 4d54 3b20 666f 6e74 2d73  omanPSMT; font-s
+000182d0: 697a 653a 2031 322e 303b 2066 6f6e 742d  ize: 12.0; font-
+000182e0: 7765 6967 6874 3a20 626f 6c64 3b20 666f  weight: bold; fo
+000182f0: 6e74 2d6e 616d 653a 2054 696d 6573 4e65  nt-name: TimesNe
+00018300: 7752 6f6d 616e 5053 4d54 3b0a 2020 2020  wRomanPSMT;.    
+00018310: 2020 2020 6973 2074 7261 6e73 666f 726d      is transform
+00018320: 6564 2074 6f0a 2020 2020 2020 2020 2e74  ed to.        .t
+00018330: 696d 6573 6e65 7772 6f6d 616e 7073 6d74  imesnewromanpsmt
+00018340: 5f31 327e 305f 626f 6c64 0a20 2020 2020  _12~0_bold.     
+00018350: 2020 2022 2222 0a20 2020 2020 2020 2073     """.        s
+00018360: 7479 6c65 5f63 6f6e 7665 7274 6572 203d  tyle_converter =
+00018370: 2063 6c73 2e63 7265 6174 655f 7374 796c   cls.create_styl
+00018380: 655f 636f 6e76 6572 7465 7228 6874 6d6c  e_converter(html
+00018390: 5f65 6c65 6d29 0a20 2020 2020 2020 2073  _elem).        s
+000183a0: 7479 6c65 645f 656c 656d 7320 3d20 6874  tyled_elems = ht
+000183b0: 6d6c 5f65 6c65 6d2e 7870 6174 6828 222e  ml_elem.xpath(".
+000183c0: 2f2f 2a5b 4063 6c61 7373 5d22 290a 2020  //*[@class]").  
+000183d0: 2020 2020 2020 666f 7220 656c 656d 2069        for elem i
+000183e0: 6e20 7374 796c 6564 5f65 6c65 6d73 3a0a  n styled_elems:.
+000183f0: 2020 2020 2020 2020 2020 2020 636c 617a              claz
+00018400: 7a20 3d20 656c 656d 2e61 7474 7269 625b  z = elem.attrib[
+00018410: 2263 6c61 7373 225d 0a20 2020 2020 2020  "class"].       
+00018420: 2020 2020 206e 6577 5f63 6c61 7373 203d       new_class =
+00018430: 2073 7479 6c65 5f63 6f6e 7665 7274 6572   style_converter
+00018440: 2e67 6574 2863 6c61 7a7a 290a 2020 2020  .get(clazz).    
+00018450: 2020 2020 2020 2020 6966 206e 6577 5f63          if new_c
+00018460: 6c61 7373 2069 7320 4e6f 6e65 3a0a 2020  lass is None:.  
+00018470: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00018480: 696e 7428 6622 6361 6e6e 6f74 2066 696e  int(f"cannot fin
+00018490: 6420 7265 706c 6163 6520 666f 7220 7b63  d replace for {c
+000184a0: 6c61 7a7a 7d22 290a 2020 2020 2020 2020  lazz}").        
+000184b0: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+000184c0: 0a20 2020 2020 2020 2020 2020 2068 746d  .            htm
+000184d0: 6c5f 636c 6173 7320 3d20 4874 6d6c 436c  l_class = HtmlCl
+000184e0: 6173 7328 636c 617a 7a29 0a20 2020 2020  ass(clazz).     
+000184f0: 2020 2020 2020 2068 746d 6c5f 636c 6173         html_clas
+00018500: 732e 7265 706c 6163 655f 636c 6173 7328  s.replace_class(
+00018510: 636c 617a 7a2c 206e 6577 5f63 6c61 7373  clazz, new_class
+00018520: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+00018530: 656d 2e61 7474 7269 625b 2263 6c61 7373  em.attrib["class
+00018540: 225d 203d 206e 6577 5f63 6c61 7373 0a20  "] = new_class. 
+00018550: 2020 2020 2020 2020 2020 2023 2070 7269             # pri
+00018560: 6e74 2866 2272 6570 6c61 6365 6420 7b63  nt(f"replaced {c
+00018570: 6c61 7a7a 7d20 6279 207b 6e65 775f 636c  lazz} by {new_cl
+00018580: 6173 737d 2229 0a0a 2020 2020 4063 6c61  ass}")..    @cla
+00018590: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+000185a0: 2063 7265 6174 655f 7374 796c 655f 636f   create_style_co
+000185b0: 6e76 6572 7465 7228 636c 732c 2068 746d  nverter(cls, htm
+000185c0: 6c5f 656c 656d 293a 0a20 2020 2020 2020  l_elem):.       
+000185d0: 2073 7479 6c65 7320 3d20 4874 6d6c 5374   styles = HtmlSt
+000185e0: 796c 652e 6765 745f 6865 6164 5f73 7479  yle.get_head_sty
+000185f0: 6c65 7328 6874 6d6c 5f65 6c65 6d29 0a20  les(html_elem). 
+00018600: 2020 2020 2020 2073 7479 6c65 5f63 6f6e         style_con
+00018610: 7665 7274 6572 203d 2064 6963 7428 290a  verter = dict().
+00018620: 2020 2020 2020 2020 666f 7220 7374 796c          for styl
+00018630: 6520 696e 2073 7479 6c65 733a 0a20 2020  e in styles:.   
+00018640: 2020 2020 2020 2020 2064 6f74 5f73 7479           dot_sty
+00018650: 6c65 2c20 6373 7320 3d20 4874 6d6c 5374  le, css = HtmlSt
+00018660: 796c 652e 6578 7472 6163 745f 636c 6173  yle.extract_clas
+00018670: 7372 6566 5f61 6e64 5f63 7373 7374 7269  sref_and_cssstri
+00018680: 6e67 5f66 726f 6d5f 6874 6d6c 5f73 7479  ng_from_html_sty
+00018690: 6c65 2873 7479 6c65 290a 2020 2020 2020  le(style).      
+000186a0: 2020 2020 2020 2320 7072 696e 7428 6622        # print(f"
+000186b0: 7b64 6f74 5f73 7479 6c65 7d20 7b63 7373  {dot_style} {css
+000186c0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+000186d0: 6373 735f 7374 796c 6520 3d20 4353 5353  css_style = CSSS
+000186e0: 7479 6c65 2e63 7265 6174 655f 6373 735f  tyle.create_css_
+000186f0: 7374 796c 655f 6672 6f6d 5f63 7373 5f73  style_from_css_s
+00018700: 7472 696e 6728 6373 7329 0a20 2020 2020  tring(css).     
+00018710: 2020 2020 2020 2023 2070 7269 6e74 280a         # print(.
+00018720: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+00018730: 2020 6622 666f 6e74 3a20 7b63 7373 5f73    f"font: {css_s
+00018740: 7479 6c65 2e66 6f6e 745f 6661 6d69 6c79  tyle.font_family
+00018750: 7d20 7369 7a65 207b 6373 735f 7374 796c  } size {css_styl
+00018760: 652e 666f 6e74 5f73 697a 657d 2062 6f6c  e.font_size} bol
+00018770: 6420 7b63 7373 5f73 7479 6c65 2e69 735f  d {css_style.is_
+00018780: 626f 6c64 7d20 6974 616c 6963 207b 6373  bold} italic {cs
+00018790: 735f 7374 796c 652e 6973 5f69 7461 6c69  s_style.is_itali
+000187a0: 637d 2229 0a20 2020 2020 2020 2020 2020  c}").           
+000187b0: 2063 5f73 7479 6c65 203d 2022 220a 2020   c_style = "".  
+000187c0: 2020 2020 2020 2020 2020 6966 2063 7373            if css
+000187d0: 5f73 7479 6c65 2e66 6f6e 745f 6661 6d69  _style.font_fami
+000187e0: 6c79 3a0a 2020 2020 2020 2020 2020 2020  ly:.            
+000187f0: 2020 2020 635f 7374 796c 6520 2b3d 2063      c_style += c
+00018800: 7373 5f73 7479 6c65 2e66 6f6e 745f 6661  ss_style.font_fa
+00018810: 6d69 6c79 2e6c 6f77 6572 2829 0a20 2020  mily.lower().   
+00018820: 2020 2020 2020 2020 2069 6620 6373 735f           if css_
+00018830: 7374 796c 652e 666f 6e74 5f73 697a 653a  style.font_size:
+00018840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018850: 2063 5f73 7479 6c65 202b 3d20 225f 2220   c_style += "_" 
+00018860: 2b20 7374 7228 6373 735f 7374 796c 652e  + str(css_style.
+00018870: 666f 6e74 5f73 697a 6529 2e72 6570 6c61  font_size).repla
+00018880: 6365 2822 2e22 2c20 225f 2229 0a20 2020  ce(".", "_").   
+00018890: 2020 2020 2020 2020 2069 6620 6373 735f           if css_
+000188a0: 7374 796c 652e 6973 5f62 6f6c 643a 0a20  style.is_bold:. 
+000188b0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000188c0: 5f73 7479 6c65 202b 3d20 225f 2220 2b20  _style += "_" + 
+000188d0: 2262 220a 2020 2020 2020 2020 2020 2020  "b".            
+000188e0: 6966 2063 7373 5f73 7479 6c65 2e69 735f  if css_style.is_
+000188f0: 6974 616c 6963 3a0a 2020 2020 2020 2020  italic:.        
+00018900: 2020 2020 2020 2020 635f 7374 796c 6520          c_style 
+00018910: 2b3d 2022 5f22 202b 2022 6922 0a20 2020  += "_" + "i".   
+00018920: 2020 2020 2020 2020 2069 6620 635f 7374           if c_st
+00018930: 796c 652e 7374 6172 7473 7769 7468 2822  yle.startswith("
+00018940: 5f22 293a 0a20 2020 2020 2020 2020 2020  _"):.           
+00018950: 2020 2020 2063 5f73 7479 6c65 203d 2063       c_style = c
+00018960: 5f73 7479 6c65 5b31 3a5d 0a20 2020 2020  _style[1:].     
+00018970: 2020 2020 2020 2023 2070 7269 6e74 2866         # print(f
+00018980: 2263 5f73 7479 6c65 207b 635f 7374 796c  "c_style {c_styl
+00018990: 657d 2229 0a20 2020 2020 2020 2020 2020  e}").           
+000189a0: 2069 6620 635f 7374 796c 6520 213d 2022   if c_style != "
+000189b0: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+000189c0: 2020 2073 7479 6c65 5f63 6f6e 7665 7274     style_convert
+000189d0: 6572 5b64 6f74 5f73 7479 6c65 5b31 3a5d  er[dot_style[1:]
+000189e0: 5d20 3d20 635f 7374 796c 650a 2020 2020  ] = c_style.    
+000189f0: 2020 2020 2020 2020 2020 2020 636c 732e              cls.
+00018a00: 7365 745f 636c 6173 7372 6566 5f61 6e64  set_classref_and
+00018a10: 5f63 7373 2873 7479 6c65 2c20 635f 7374  _css(style, c_st
+00018a20: 796c 652c 2063 7373 290a 0a20 2020 2020  yle, css)..     
+00018a30: 2020 2072 6574 7572 6e20 7374 796c 655f     return style_
+00018a40: 636f 6e76 6572 7465 720a 0a20 2020 2040  converter..    @
+00018a50: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+00018a60: 6465 6620 7365 745f 636c 6173 7372 6566  def set_classref
+00018a70: 5f61 6e64 5f63 7373 2863 6c73 2c20 7374  _and_css(cls, st
+00018a80: 796c 655f 656c 656d 2c20 635f 7374 796c  yle_elem, c_styl
+00018a90: 652c 2063 7373 293a 0a20 2020 2020 2020  e, css):.       
+00018aa0: 2073 7479 6c65 5f65 6c65 6d2e 6174 7472   style_elem.attr
+00018ab0: 6962 5b22 636c 6173 7372 6566 225d 203d  ib["classref"] =
+00018ac0: 2022 2e22 202b 2063 5f73 7479 6c65 0a20   "." + c_style. 
+00018ad0: 2020 2020 2020 2073 7479 6c65 5f65 6c65         style_ele
+00018ae0: 6d2e 7465 7874 203d 2022 2e22 202b 2063  m.text = "." + c
+00018af0: 5f73 7479 6c65 202b 2022 207b 2220 2b20  _style + " {" + 
+00018b00: 6373 7320 2b20 227d 220a 0a0a 636c 6173  css + "}"...clas
+00018b10: 7320 4874 6d6c 436c 6173 733a 0a20 2020  s HtmlClass:.   
+00018b20: 2022 2222 0a20 2020 206d 6574 686f 6473   """.    methods
+00018b30: 2074 6f20 7072 6f63 6573 7320 636c 6173   to process clas
+00018b40: 7320 2a61 7474 7269 6275 7465 732a 206f  s *attributes* o
+00018b50: 6e20 4854 4d4c 2065 6c65 6d6e 7473 2061  n HTML elemnts a
+00018b60: 6e64 2073 796e 6320 7769 7468 2073 7479  nd sync with sty
+00018b70: 6c65 0a20 2020 2049 6e69 7469 616c 6c79  le.    Initially
+00018b80: 206d 6169 6e6c 7920 4063 6c61 7373 6d65   mainly @classme
+00018b90: 7468 6f64 2062 7574 2061 6464 696e 6720  thod but adding 
+00018ba0: 696e 7374 616d 6365 7320 746f 206d 616e  instamces to man
+00018bb0: 6167 6520 6564 6974 696e 670a 2020 2020  age editing.    
+00018bc0: 7468 6520 4063 6c61 7373 2061 7474 7269  the @class attri
+00018bd0: 6275 7465 0a20 2020 2022 2222 0a0a 2020  bute.    """..  
+00018be0: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
+00018bf0: 656c 662c 2063 6c61 7373 7374 723d 4e6f  elf, classstr=No
+00018c00: 6e65 293a 0a0a 2020 2020 2020 2020 7365  ne):..        se
+00018c10: 6c66 2e63 6c61 7373 6573 203d 2073 6574  lf.classes = set
+00018c20: 2829 0a20 2020 2020 2020 2069 6620 636c  ().        if cl
+00018c30: 6173 7373 7472 3a0a 2020 2020 2020 2020  assstr:.        
+00018c40: 2020 2020 6966 2074 7970 6528 636c 6173      if type(clas
+00018c50: 7373 7472 2920 6973 2073 7472 3a0a 2020  sstr) is str:.  
+00018c60: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00018c70: 6c66 2e63 6c61 7373 6573 2e75 7064 6174  lf.classes.updat
+00018c80: 6528 636c 6173 7373 7472 2e73 706c 6974  e(classstr.split
+00018c90: 2829 290a 2020 2020 2020 2020 2020 2020  ()).            
+00018ca0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00018cb0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00018cc0: 6545 7272 6f72 2866 2263 616e 206f 6e6c  eError(f"can onl
+00018cd0: 7920 6372 6561 7465 2048 746d 6c43 6c61  y create HtmlCla
+00018ce0: 7373 2066 726f 6d20 7374 7269 6e67 732c  ss from strings,
+00018cf0: 2066 6f75 6e64 207b 7479 7065 2863 6c61   found {type(cla
+00018d00: 7373 7374 7229 7d20 3a20 7b63 6c61 7373  ssstr)} : {class
+00018d10: 7374 727d 2229 0a0a 2320 636c 6173 7320  str}")..# class 
+00018d20: 4874 6d6c 436c 6173 733a 0a0a 2020 2020  HtmlClass:..    
+00018d30: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+00018d40: 2064 6566 2063 7265 6174 655f 6672 6f6d   def create_from
+00018d50: 5f63 6c61 7373 6564 5f65 6c65 6d65 6e74  _classed_element
+00018d60: 2863 6c73 2c20 656c 656d 293a 0a20 2020  (cls, elem):.   
+00018d70: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00018d80: 2067 6574 2063 6c61 7373 2076 616c 7565   get class value
+00018d90: 2066 726f 6d20 656c 656d 656e 7420 616e   from element an
+00018da0: 6420 6363 7265 6174 6520 4874 6d6c 436c  d ccreate HtmlCl
+00018db0: 6173 730a 2020 2020 2020 2020 3a70 6172  ass.        :par
+00018dc0: 616d 2065 6c65 6d3a 2065 6c65 6d65 6e74  am elem: element
+00018dd0: 7320 7769 7468 2040 636c 6173 7320 6174  s with @class at
+00018de0: 7472 6962 7574 650a 2020 2020 2020 2020  tribute.        
+00018df0: 3a72 6574 7572 6e3a 2048 746d 6c43 6c61  :return: HtmlCla
+00018e00: 7373 2065 6c65 6d65 6e74 206f 7220 4e6f  ss element or No
+00018e10: 6e65 0a20 2020 2020 2020 2022 2222 0a20  ne.        """. 
+00018e20: 2020 2020 2020 2063 6c61 7a7a 203d 2048         clazz = H
+00018e30: 746d 6c43 6c61 7373 2e67 6574 5f63 6c61  tmlClass.get_cla
+00018e40: 7373 5f73 7472 696e 675f 6f6e 5f65 6c65  ss_string_on_ele
+00018e50: 6d65 6e74 2865 6c65 6d29 0a20 2020 2020  ment(elem).     
+00018e60: 2020 2072 6574 7572 6e20 4e6f 6e65 2069     return None i
+00018e70: 6620 6e6f 7420 636c 617a 7a20 656c 7365  f not clazz else
+00018e80: 2048 746d 6c43 6c61 7373 2863 6c61 7a7a   HtmlClass(clazz
+00018e90: 290a 0a20 2020 2023 2063 6c61 7373 2048  )..    # class H
+00018ea0: 746d 6c43 6c61 7373 3a0a 0a20 2020 2040  tmlClass:..    @
+00018eb0: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
+00018ec0: 2063 6c61 7373 5f73 7472 696e 6728 7365   class_string(se
+00018ed0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+00018ee0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00018ef0: 7468 6520 636c 6173 735f 7374 7269 6e67  the class_string
+00018f00: 2028 6372 6561 7465 7320 6672 6f6d 206c   (creates from l
+00018f10: 6174 6573 7420 7365 6c66 2e63 6c61 7373  atest self.class
+00018f20: 6573 290a 2020 2020 2020 2020 3a72 6574  es).        :ret
+00018f30: 7572 6e3a 2073 7472 696e 6720 6f66 2061  urn: string of a
+00018f40: 6c70 6861 6265 7469 6363 616c 6c79 2073  lphabeticcally s
+00018f50: 6f72 7465 6420 7370 6563 652d 7365 7061  orted spece-sepa
+00018f60: 7261 7465 6420 636c 6173 7365 730a 2020  rated classes.  
+00018f70: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00018f80: 2020 7265 7475 726e 2022 2220 6966 206e    return "" if n
+00018f90: 6f74 2073 656c 662e 636c 6173 7365 7320  ot self.classes 
+00018fa0: 656c 7365 2022 2022 2e6a 6f69 6e28 736f  else " ".join(so
+00018fb0: 7274 6564 286c 6973 7428 7365 6c66 2e63  rted(list(self.c
+00018fc0: 6c61 7373 6573 2929 290a 0a20 2020 2064  lasses)))..    d
+00018fd0: 6566 2061 6464 5f63 6c61 7373 2873 656c  ef add_class(sel
+00018fe0: 662c 2063 6c61 7a7a 293a 0a20 2020 2020  f, clazz):.     
+00018ff0: 2020 2022 2222 0a20 2020 2020 2020 2061     """.        a
+00019000: 6464 2063 6c61 7373 2074 6f20 636c 6173  dd class to clas
+00019010: 735f 7374 7269 6e67 0a20 2020 2020 2020  s_string.       
+00019020: 203a 7061 7261 6d20 636c 617a 7a3a 2063   :param clazz: c
+00019030: 6c61 7373 2074 6f20 6164 6420 286d 7573  lass to add (mus
+00019040: 7420 6265 206e 6f6e 2d65 6d70 7479 2073  t be non-empty s
+00019050: 7472 696e 670a 2020 2020 2020 2020 6966  tring.        if
+00019060: 2063 6c61 7a7a 2069 730a 2020 2020 2020   clazz is.      
+00019070: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+00019080: 2063 6c61 7a7a 2061 6e64 206c 656e 2863   clazz and len(c
+00019090: 6c61 7a7a 2e73 7472 6970 2829 2920 3e20  lazz.strip()) > 
+000190a0: 3020 616e 6420 636c 617a 7a20 6e6f 7420  0 and clazz not 
+000190b0: 696e 2073 656c 662e 636c 6173 7365 733a  in self.classes:
+000190c0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000190d0: 662e 636c 6173 7365 732e 6164 6428 636c  f.classes.add(cl
+000190e0: 617a 7a2e 7374 7269 7028 2929 0a0a 2020  azz.strip())..  
+000190f0: 2020 2320 636c 6173 7320 4874 6d6c 436c    # class HtmlCl
+00019100: 6173 733a 0a0a 2020 2020 6465 6620 6861  ass:..    def ha
+00019110: 735f 636c 6173 7328 7365 6c66 2c20 636c  s_class(self, cl
+00019120: 617a 7a29 3a0a 2020 2020 2020 2020 2222  azz):.        ""
+00019130: 220a 2020 2020 2020 2020 646f 6573 2063  ".        does c
+00019140: 6c61 7373 2065 7869 7374 2069 6e20 636c  lass exist in cl
+00019150: 6173 7365 730a 2020 2020 2020 2020 3a70  asses.        :p
+00019160: 6172 616d 2063 6c61 7a7a 3a0a 2020 2020  aram clazz:.    
+00019170: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00019180: 7265 7475 726e 2063 6c61 7a7a 2069 6e20  return clazz in 
+00019190: 7365 6c66 2e63 6c61 7373 6573 0a0a 2020  self.classes..  
+000191a0: 2020 2320 636c 6173 7320 4874 6d6c 436c    # class HtmlCl
+000191b0: 6173 733a 0a0a 2020 2020 6465 6620 7265  ass:..    def re
+000191c0: 706c 6163 655f 636c 6173 7328 7365 6c66  place_class(self
+000191d0: 2c20 636c 617a 7a5f 6f6c 642c 2063 6c61  , clazz_old, cla
+000191e0: 7a7a 3d4e 6f6e 6529 3a0a 2020 2020 2020  zz=None):.      
+000191f0: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
+00019200: 6d6f 7665 2063 6c61 7a7a 5f6f 6c64 203b  move clazz_old ;
+00019210: 2069 6620 636c 617a 7a20 6973 206e 6f74   if clazz is not
+00019220: 204e 6f6e 6520 6164 6420 6974 2061 7320   None add it as 
+00019230: 6e65 7720 636c 6173 730a 2020 2020 2020  new class.      
+00019240: 2020 2869 6620 636c 617a 7a20 6973 2061    (if clazz is a
+00019250: 6c72 6561 6479 2070 7265 7365 6e74 2c20  lready present, 
+00019260: 6e6f 2d6f 7029 0a20 2020 2020 2020 2022  no-op).        "
+00019270: 2222 0a20 2020 2020 2020 2069 6620 636c  "".        if cl
+00019280: 617a 7a5f 6f6c 6420 696e 2073 656c 662e  azz_old in self.
+00019290: 636c 6173 7365 733a 0a20 2020 2020 2020  classes:.       
+000192a0: 2020 2020 2073 656c 662e 7265 6d6f 7665       self.remove
+000192b0: 2863 6c61 7a7a 5f6f 6c64 290a 2020 2020  (clazz_old).    
+000192c0: 2020 2020 2020 2020 6966 2063 6c61 7a7a          if clazz
+000192d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000192e0: 2020 7365 6c66 2e61 6464 5f63 6c61 7373    self.add_class
+000192f0: 2863 6c61 7a7a 290a 0a20 2020 2023 2063  (clazz)..    # c
+00019300: 6c61 7373 2048 746d 6c43 6c61 7373 3a0a  lass HtmlClass:.
+00019310: 0a20 2020 2064 6566 2072 656d 6f76 6528  .    def remove(
+00019320: 7365 6c66 2c20 636c 617a 7a29 3a0a 2020  self, clazz):.  
+00019330: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00019340: 2020 7265 6d6f 7665 2063 6c61 7373 2066    remove class f
+00019350: 726f 6d20 7374 7269 6e67 0a20 2020 2020  rom string.     
+00019360: 2020 203a 7061 7261 6d20 636c 617a 7a3a     :param clazz:
+00019370: 2063 6c61 7373 2073 7472 696e 6720 746f   class string to
+00019380: 2072 656d 6f76 650a 2020 2020 2020 2020   remove.        
+00019390: 6966 2020 6e6f 7420 7072 6573 656e 742c  if  not present,
+000193a0: 206e 6f2d 6f70 0a20 2020 2020 2020 2022   no-op.        "
+000193b0: 2222 0a20 2020 2020 2020 2069 6620 636c  "".        if cl
+000193c0: 617a 7a20 696e 2073 656c 662e 636c 6173  azz in self.clas
+000193d0: 7365 733a 0a20 2020 2020 2020 2020 2020  ses:.           
+000193e0: 2073 656c 662e 636c 6173 7365 732e 7265   self.classes.re
+000193f0: 6d6f 7665 2863 6c61 7a7a 290a 0a20 2020  move(clazz)..   
+00019400: 2023 2063 6c61 7373 2048 746d 6c43 6c61   # class HtmlCla
+00019410: 7373 3a0a 0a20 2020 2040 636c 6173 736d  ss:..    @classm
+00019420: 6574 686f 640a 2020 2020 6465 6620 6765  ethod.    def ge
+00019430: 745f 636c 6173 735f 7374 7269 6e67 5f6f  t_class_string_o
+00019440: 6e5f 656c 656d 656e 7428 636c 732c 2065  n_element(cls, e
+00019450: 6c65 6d29 3a0a 2020 2020 2020 2020 2222  lem):.        ""
+00019460: 220a 2020 2020 2020 2020 636f 6e76 656e  ".        conven
+00019470: 6965 6e63 6520 6d65 7468 6f64 2074 6f20  ience method to 
+00019480: 6765 7420 656c 656d 656e 7420 7374 796c  get element styl
+00019490: 650a 2020 2020 2020 2020 3a70 6172 616d  e.        :param
+000194a0: 2065 6c65 6d3a 2074 6f20 6765 7420 7374   elem: to get st
+000194b0: 796c 6520 6672 6f6d 0a20 2020 2020 2020  yle from.       
+000194c0: 203a 7265 7475 726e 3a20 7374 796c 6520   :return: style 
+000194d0: 6f72 204e 6f6e 650a 2020 2020 2020 2020  or None.        
+000194e0: 2222 220a 0a20 2020 2020 2020 2072 6574  """..        ret
+000194f0: 7572 6e20 656c 656d 2e61 7474 7269 622e  urn elem.attrib.
+00019500: 6765 7428 2263 6c61 7373 2229 2069 6620  get("class") if 
+00019510: 7479 7065 2865 6c65 6d29 2069 7320 5f45  type(elem) is _E
+00019520: 6c65 6d65 6e74 2065 6c73 6520 4e6f 6e65  lement else None
+00019530: 0a0a 2020 2020 2320 636c 6173 7320 4874  ..    # class Ht
+00019540: 6d6c 436c 6173 733a 0a0a 2020 2020 4063  mlClass:..    @c
+00019550: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+00019560: 6566 2073 6574 5f63 6c61 7373 5f6f 6e5f  ef set_class_on_
+00019570: 656c 656d 656e 7428 636c 732c 2065 6c65  element(cls, ele
+00019580: 6d2c 2076 616c 7565 2c20 7265 706c 6163  m, value, replac
+00019590: 653d 5472 7565 293a 0a20 2020 2020 2020  e=True):.       
+000195a0: 2022 2222 0a20 2020 2020 2020 2063 6f6e   """.        con
+000195b0: 7665 6e69 656e 6365 206d 6574 686f 6420  venience method 
+000195c0: 746f 2073 6574 2063 6c61 7373 206f 6e20  to set class on 
+000195d0: 656c 656d 656e 740a 2020 2020 2020 2020  element.        
+000195e0: 3a70 6172 616d 2065 6c65 6d3a 656c 656d  :param elem:elem
+000195f0: 656e 7420 746f 2073 6574 2063 6c61 7373  ent to set class
+00019600: 206f 6e0a 2020 2020 2020 2020 3a70 6172   on.        :par
+00019610: 616d 2076 616c 7565 3a20 6874 6d6c 2063  am value: html c
+00019620: 6c61 7373 0a20 2020 2020 2020 203a 7061  lass.        :pa
+00019630: 7261 6d20 7265 706c 6163 653a 6966 2054  ram replace:if T
+00019640: 7275 6520 7265 706c 6163 652c 2065 6c73  rue replace, els
+00019650: 6520 6164 6420 746f 2065 7869 7374 696e  e add to existin
+00019660: 6720 6174 7472 6962 7574 650a 2020 2020  g attribute.    
+00019670: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00019680: 6966 2065 6c65 6d20 6973 206e 6f74 204e  if elem is not N
+00019690: 6f6e 6520 616e 6420 7661 6c75 653a 0a20  one and value:. 
+000196a0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+000196b0: 7420 7265 706c 6163 653a 0a20 2020 2020  t replace:.     
+000196c0: 2020 2020 2020 2020 2020 206f 6c64 5f63             old_c
+000196d0: 6c61 7373 203d 2048 746d 6c43 6c61 7373  lass = HtmlClass
+000196e0: 2e67 6574 5f63 6c61 7373 5f73 7472 696e  .get_class_strin
+000196f0: 675f 6f6e 5f65 6c65 6d65 6e74 2865 6c65  g_on_element(ele
+00019700: 6d29 0a20 2020 2020 2020 2020 2020 2020  m).             
+00019710: 2020 2069 6620 6f6c 645f 636c 6173 733a     if old_class:
+00019720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019730: 2020 2020 2069 6620 7661 6c75 6520 6e6f       if value no
+00019740: 7420 696e 206f 6c64 5f63 6c61 7373 3a0a  t in old_class:.
+00019750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019760: 2020 2020 2020 2020 6f6c 645f 636c 6173          old_clas
+00019770: 7320 2b3d 2022 2022 202b 2076 616c 7565  s += " " + value
+00019780: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00019790: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000197a0: 2020 206f 6c64 5f63 6c61 7373 203d 2076     old_class = v
+000197b0: 616c 7565 0a20 2020 2020 2020 2020 2020  alue.           
+000197c0: 2065 6c65 6d2e 6174 7472 6962 5b22 636c   elem.attrib["cl
+000197d0: 6173 7322 5d20 3d20 7661 6c75 650a 0a20  ass"] = value.. 
+000197e0: 2020 2023 2063 6c61 7373 2048 746d 6c43     # class HtmlC
+000197f0: 6c61 7373 3a0a 0a20 2020 2064 6566 2063  lass:..    def c
+00019800: 7265 6174 655f 636c 6173 7372 6566 2873  reate_classref(s
+00019810: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+00019820: 220a 2020 2020 2020 2020 6372 6561 7465  ".        create
+00019830: 2063 6c61 7373 7265 6620 7374 7269 6e67   classref string
+00019840: 2028 7072 6570 656e 6420 222e 2229 0a20   (prepend "."). 
+00019850: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00019860: 2020 2072 6574 7572 6e20 222e 2220 2b20     return "." + 
+00019870: 7365 6c66 2e63 6c61 7373 5f73 7472 696e  self.class_strin
+00019880: 670a 0a20 2020 2023 2063 6c61 7373 2048  g..    # class H
+00019890: 746d 6c43 6c61 7373 3a0a 0a20 2020 2040  tmlClass:..    @
+000198a0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+000198b0: 6465 6620 7265 6d6f 7665 5f64 6f74 2873  def remove_dot(s
+000198c0: 656c 662c 2073 7472 696e 6729 3a0a 2020  elf, string):.  
+000198d0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000198e0: 2020 7265 6d6f 7665 2064 6f74 2028 222e    remove dot (".
+000198f0: 2229 202d 2069 6e20 6874 6d6c 2f68 6561  ") - in html/hea
+00019900: 642f 7374 796c 6520 656c 656d 656e 740a  d/style element.
+00019910: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00019920: 2020 2020 7265 7475 726e 2073 7472 696e      return strin
+00019930: 675b 313a 5d20 6966 2073 7472 696e 6720  g[1:] if string 
+00019940: 616e 6420 7374 7269 6e67 5b3a 315d 203d  and string[:1] =
+00019950: 3d20 222e 2220 656c 7365 2073 7472 696e  = "." else strin
+00019960: 670a 0a0a 636c 6173 7320 4874 6d6c 5472  g...class HtmlTr
+00019970: 6565 3a0a 2020 2020 2222 2262 7569 6c64  ee:.    """build
+00019980: 7320 6120 7472 6565 2066 726f 6d20 6120  s a tree from a 
+00019990: 666c 6174 2073 6574 206f 6620 4874 6d6c  flat set of Html
+000199a0: 2065 6c65 6d6e 6574 7322 2222 0a0a 2020   elemnets"""..  
+000199b0: 2020 2320 666f 7220 7468 6520 7365 6374    # for the sect
+000199c0: 696f 6e5f 7265 6373 0a20 2020 2043 4841  ion_recs.    CHA
+000199d0: 505f 544f 5020 3d20 2243 4841 505f 544f  P_TOP = "CHAP_TO
+000199e0: 5022 0a20 2020 2043 4841 505f 5345 4354  P".    CHAP_SECT
+000199f0: 494f 4e53 203d 2022 4348 4150 5f53 4543  IONS = "CHAP_SEC
+00019a00: 5449 4f4e 5322 0a20 2020 2043 4841 505f  TIONS".    CHAP_
+00019a10: 5355 4253 4543 5453 203d 2022 4348 4150  SUBSECTS = "CHAP
+00019a20: 5f53 5542 5345 4354 5322 0a0a 2020 2020  _SUBSECTS"..    
+00019a30: 2320 4368 6170 7465 720a 2020 2020 5452  # Chapter.    TR
+00019a40: 4545 5f52 4f4f 5420 3d20 2274 7265 655f  EE_ROOT = "tree_
+00019a50: 726f 6f74 220a 2020 2020 434c 4153 5320  root".    CLASS 
+00019a60: 3d20 2263 6c61 7373 220a 2020 2020 5052  = "class".    PR
+00019a70: 455f 4348 4150 5345 4320 3d20 2270 7265  E_CHAPSEC = "pre
+00019a80: 5f63 6861 7073 6563 220a 0a20 2020 2023  _chapsec"..    #
+00019a90: 2073 6563 7469 6f6e 730a 2020 2020 4348   sections.    CH
+00019aa0: 4150 5345 4320 3d20 2263 6861 7073 6563  APSEC = "chapsec
+00019ab0: 220a 2020 2020 544f 505f 4449 5620 3d20  ".    TOP_DIV = 
+00019ac0: 2274 6f70 5f64 6976 220a 0a20 2020 2023  "top_div"..    #
+00019ad0: 2058 5061 7468 730a 2020 2020 414c 4c5f   XPaths.    ALL_
+00019ae0: 4449 565f 5850 4154 4853 203d 2022 2e2f  DIV_XPATHS = "./
+00019af0: 2f64 6976 220a 0a23 2063 6c61 7373 2048  /div"..# class H
+00019b00: 746d 6c54 7265 650a 0a20 2020 2040 636c  tmlTree..    @cl
+00019b10: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+00019b20: 6620 6d61 6b65 5f73 6563 7469 6f6e 735f  f make_sections_
+00019b30: 616e 645f 6f75 7470 7574 2863 6c73 2c20  and_output(cls, 
+00019b40: 656c 656d 2c20 6f75 7470 7574 5f64 6972  elem, output_dir
+00019b50: 2c20 7265 6373 5f62 795f 7365 6374 696f  , recs_by_sectio
+00019b60: 6e3d 4e6f 6e65 293a 0a20 2020 2020 2020  n=None):.       
+00019b70: 2022 2222 6669 6e64 2064 6563 696d 616c   """find decimal
+00019b80: 206e 756d 6265 7220 666f 7220 7472 6565   number for tree
+00019b90: 0a20 2020 2020 2020 2054 6869 5320 6973  .        ThiS is
+00019ba0: 2048 4541 5649 4c59 2062 6173 6564 206f   HEAVILY based o
+00019bb0: 6e20 4950 4343 0a20 2020 2020 2020 2063  n IPCC.        c
+00019bc0: 7572 7265 6e74 6c79 2063 616c 6c65 6420  urrently called 
+00019bd0: 696e 2074 6964 795f 666c 6f77 2829 0a20  in tidy_flow(). 
+00019be0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00019bf0: 2020 206d 6172 6b65 7273 203d 205b 2243     markers = ["C
+00019c00: 6861 7074 6572 222c 0a20 2020 2020 2020  hapter",.       
+00019c10: 2020 2020 2020 2020 2020 2020 2320 2254              # "T
+00019c20: 6162 6c65 206f 6620 436f 6e74 656e 7473  able of Contents
+00019c30: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00019c40: 2020 2020 2020 2254 6162 6c65 206f 6622        "Table of"
+00019c50: 2c20 2023 206f 6e65 2069 7320 636f 6e63  ,  # one is conc
+00019c60: 6174 656e 6174 6564 2028 4368 6170 7465  atenated (Chapte
+00019c70: 7230 3129 2073 6f20 6162 6272 6576 6961  r01) so abbrevia
+00019c80: 7465 2c20 756e 7765 6967 6874 6564 2043  te, unweighted C
+00019c90: 6861 7031 360a 2020 2020 2020 2020 2020  hap16.          
+00019ca0: 2020 2020 2020 2020 2023 2022 4578 6563           # "Exec
+00019cb0: 7574 6976 6520 5375 6d6d 6172 7922 2c0a  utive Summary",.
+00019cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019cd0: 2020 2022 4578 6563 7574 6976 6522 2c20     "Executive", 
+00019ce0: 2023 2063 6173 6520 7661 7269 6174 696f   # case variatio
+00019cf0: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+00019d00: 2020 2020 2023 2022 4672 6571 7565 6e74       # "Frequent
+00019d10: 6c79 2041 736b 6564 2051 7565 7374 696f  ly Asked Questio
+00019d20: 6e73 222c 2023 206e 6f74 2069 6e20 4368  ns", # not in Ch
+00019d30: 6170 7465 7230 310a 2020 2020 2020 2020  apter01.        
+00019d40: 2020 2020 2020 2020 2020 2022 4672 6571             "Freq
+00019d50: 7565 6e74 6c79 222c 2020 2320 6361 7365  uently",  # case
+00019d60: 2076 6172 6961 7469 6f6e 0a20 2020 2020   variation.     
+00019d70: 2020 2020 2020 2020 2020 2020 2020 2252                "R
+00019d80: 6566 6572 656e 6365 7322 2c0a 2020 2020  eferences",.    
+00019d90: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
+00019da0: 0a20 2020 2020 2020 2069 735f 626f 6c64  .        is_bold
+00019db0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+00019dc0: 666f 6e74 5f73 697a 655f 7261 6e67 6520  font_size_range 
+00019dd0: 3d20 2831 322c 2039 3939 290a 2020 2020  = (12, 999).    
+00019de0: 2020 2020 666f 7220 6d61 726b 6572 2069      for marker i
+00019df0: 6e20 6d61 726b 6572 733a 0a20 2020 2020  n markers:.     
+00019e00: 2020 2020 2020 206d 6172 6b65 645f 6469         marked_di
+00019e10: 762c 2064 6976 7320 3d20 636c 732e 6765  v, divs = cls.ge
+00019e20: 745f 6469 765f 7370 616e 5f73 7461 7274  t_div_span_start
+00019e30: 696e 675f 7769 7468 2865 6c65 6d2c 206d  ing_with(elem, m
+00019e40: 6172 6b65 722c 2069 735f 626f 6c64 2c20  arker, is_bold, 
+00019e50: 666f 6e74 5f73 697a 655f 7261 6e67 653d  font_size_range=
+00019e60: 666f 6e74 5f73 697a 655f 7261 6e67 6529  font_size_range)
+00019e70: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00019e80: 6d61 726b 6564 5f64 6976 2069 7320 6e6f  marked_div is no
+00019e90: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00019ea0: 2020 2020 2020 2020 6c64 203d 206c 656e          ld = len
+00019eb0: 2864 6976 7329 2069 6620 6469 7673 2065  (divs) if divs e
+00019ec0: 6c73 6520 300a 2020 2020 2020 2020 2020  lse 0.          
+00019ed0: 2020 2020 2020 6c6f 6767 696e 672e 7761        logging.wa
+00019ee0: 726e 696e 6728 6622 4361 6e6e 6f74 2066  rning(f"Cannot f
+00019ef0: 696e 6420 6d61 726b 6572 205b 7b6d 6172  ind marker [{mar
+00019f00: 6b65 727d 5d20 666f 756e 6420 7b6c 647d  ker}] found {ld}
+00019f10: 206d 6172 6b65 7273 2229 0a0a 2020 2020   markers")..    
+00019f20: 2020 2020 636c 6173 735f 6469 6374 203d      class_dict =
+00019f30: 207b 636c 732e 4348 4150 5345 433a 2063   {cls.CHAPSEC: c
+00019f40: 6c73 2e50 5245 5f43 4841 5053 4543 2c0a  ls.PRE_CHAPSEC,.
 00019f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019f70: 2066 6f6e 745f 7369 7a65 5f72 616e 6765   font_size_range
-00019f80: 3d66 6f6e 745f 7369 7a65 5f72 616e 6765  =font_size_range
-00019f90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00019fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019fc0: 2020 2020 2020 2020 2073 6563 7469 6f6e           section
-00019fd0: 5f72 6563 3d72 6563 2c20 636c 6173 735f  _rec=rec, class_
-00019fe0: 6469 6374 3d63 6c61 7373 5f64 6963 7429  dict=class_dict)
-00019ff0: 0a20 2020 2020 2020 2063 6c73 2e63 7265  .        cls.cre
-0001a000: 6174 655f 6669 6c65 6e61 6d65 5f61 6e64  ate_filename_and
-0001a010: 5f6f 7574 7075 7428 6465 6369 6d61 6c5f  _output(decimal_
-0001a020: 6469 7673 2c20 6f75 7470 7574 5f64 6972  divs, output_dir
-0001a030: 290a 0a20 2020 2023 2063 6c61 7373 2048  )..    # class H
-0001a040: 746d 6c54 7265 650a 0a20 2020 2040 636c  tmlTree..    @cl
-0001a050: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-0001a060: 6620 6372 6561 7465 5f66 696c 656e 616d  f create_filenam
-0001a070: 655f 616e 645f 6f75 7470 7574 2863 6c73  e_and_output(cls
-0001a080: 2c20 6465 6369 6d61 6c5f 6469 7673 2c20  , decimal_divs, 
-0001a090: 6f75 7470 7574 5f64 6972 2c0a 2020 2020  output_dir,.    
-0001a0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a0b0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0001a0c0: 7269 673d 2220 215c 2223 2425 2627 2829  rig=" !\"#$%&'()
-0001a0d0: 2a2b 2c2f 3a3b 3c3d 3e3f 405b 5c5c 5d5e  *+,/:;<=>?@[\\]^
-0001a0e0: 607b 7c7d 7e22 2c20 7265 703d 225f 2229  `{|}~", rep="_")
-0001a0f0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0001a100: 2020 2020 2020 6372 6561 7465 2066 696c        create fil
-0001a110: 656e 616d 6520 6672 6f6d 2073 6563 7469  ename from secti
-0001a120: 6f6e 206e 616d 652c 2072 6570 6c61 6365  on name, replace
-0001a130: 2070 756e 6374 2063 6861 7261 6374 6572   punct character
-0001a140: 730a 2020 2020 2020 2020 2222 220a 2020  s.        """.  
-0001a150: 2020 2020 2020 6966 206f 7574 7075 745f        if output_
-0001a160: 6469 723a 0a20 2020 2020 2020 2020 2020  dir:.           
-0001a170: 206f 7574 7075 745f 6469 7220 3d20 5061   output_dir = Pa
-0001a180: 7468 286f 7574 7075 745f 6469 7229 0a20  th(output_dir). 
-0001a190: 2020 2020 2020 2020 2020 206f 7574 7075             outpu
-0001a1a0: 745f 6469 722e 6d6b 6469 7228 6578 6973  t_dir.mkdir(exis
-0001a1b0: 745f 6f6b 3d54 7275 6529 0a0a 2020 2020  t_ok=True)..    
-0001a1c0: 2020 2020 2020 2020 7075 6e63 745f 6d61          punct_ma
-0001a1d0: 736b 203d 2055 7469 6c2e 6d61 6b65 5f74  sk = Util.make_t
-0001a1e0: 7261 6e73 6c61 7465 5f6d 6173 6b5f 746f  ranslate_mask_to
-0001a1f0: 5f63 6861 7228 6f72 6967 2c20 7265 7029  _char(orig, rep)
-0001a200: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0001a210: 2069 2c20 6368 696c 645f 6469 7620 696e   i, child_div in
-0001a220: 2065 6e75 6d65 7261 7465 2864 6563 696d   enumerate(decim
-0001a230: 616c 5f64 6976 7329 3a0a 2020 2020 2020  al_divs):.      
-0001a240: 2020 2020 2020 2020 2020 636c 732e 6372            cls.cr
-0001a250: 6561 7465 5f66 696c 656e 616d 655f 7265  eate_filename_re
-0001a260: 6d6f 7665 5f70 756e 6374 5f61 6e64 5f6f  move_punct_and_o
-0001a270: 7574 7075 7428 6368 696c 645f 6469 762c  utput(child_div,
-0001a280: 206f 7574 7075 745f 6469 722c 2070 756e   output_dir, pun
-0001a290: 6374 5f6d 6173 6b29 0a0a 2020 2020 2320  ct_mask)..    # 
-0001a2a0: 636c 6173 7320 4874 6d6c 5472 6565 0a0a  class HtmlTree..
-0001a2b0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-0001a2c0: 0a20 2020 2064 6566 2063 7265 6174 655f  .    def create_
-0001a2d0: 6669 6c65 6e61 6d65 5f72 656d 6f76 655f  filename_remove_
-0001a2e0: 7075 6e63 745f 616e 645f 6f75 7470 7574  punct_and_output
-0001a2f0: 2863 6c73 2c20 6368 696c 645f 6469 762c  (cls, child_div,
-0001a300: 206f 7574 7075 745f 6469 722c 2070 756e   output_dir, pun
-0001a310: 6374 5f6d 6173 6b29 3a0a 2020 2020 2020  ct_mask):.      
-0001a320: 2020 2222 226e 6f74 2073 7572 6520 7768    """not sure wh
-0001a330: 6174 2074 6869 7320 646f 6573 203f 4874  at this does ?Ht
-0001a340: 6d6c 5574 696c 2e4d 4152 4b45 5220 2222  mlUtil.MARKER ""
-0001a350: 220a 2020 2020 2020 2020 6966 2048 746d  ".        if Htm
-0001a360: 6c55 7469 6c2e 4d41 524b 4552 2069 6e20  lUtil.MARKER in 
-0001a370: 6368 696c 645f 6469 762e 6174 7472 6962  child_div.attrib
-0001a380: 3a0a 2020 2020 2020 2020 2020 2020 6d61  :.            ma
-0001a390: 726b 6572 203d 2063 6869 6c64 5f64 6976  rker = child_div
-0001a3a0: 2e61 7474 7269 625b 4874 6d6c 5574 696c  .attrib[HtmlUtil
-0001a3b0: 2e4d 4152 4b45 525d 0a20 2020 2020 2020  .MARKER].       
-0001a3c0: 2020 2020 206d 6172 6b65 7220 3d20 6d61       marker = ma
-0001a3d0: 726b 6572 2e73 7472 6970 2829 2e6c 6f77  rker.strip().low
-0001a3e0: 6572 2829 2020 2320 6e61 6d65 2066 726f  er()  # name fro
-0001a3f0: 6d20 7465 7874 2063 6f6e 7465 6e74 0a20  m text content. 
-0001a400: 2020 2020 2020 2020 2020 206d 6172 6b65             marke
-0001a410: 722e 7472 616e 736c 6174 6528 7075 6e63  r.translate(punc
-0001a420: 745f 6d61 736b 290a 2020 2020 2020 2020  t_mask).        
-0001a430: 2020 2020 7061 7468 203d 2050 6174 6828      path = Path(
-0001a440: 6f75 7470 7574 5f64 6972 2c20 6622 7b6d  output_dir, f"{m
-0001a450: 6172 6b65 727d 2e68 746d 6c22 290a 2020  arker}.html").  
-0001a460: 2020 2020 2020 2020 2020 7769 7468 206f            with o
-0001a470: 7065 6e28 7061 7468 2c20 2277 6222 2920  pen(path, "wb") 
-0001a480: 6173 2066 3a0a 2020 2020 2020 2020 2020  as f:.          
-0001a490: 2020 2020 2020 662e 7772 6974 6528 4554        f.write(ET
-0001a4a0: 2e74 6f73 7472 696e 6728 6368 696c 645f  .tostring(child_
-0001a4b0: 6469 762c 2070 7265 7474 795f 7072 696e  div, pretty_prin
-0001a4c0: 743d 5472 7565 2929 0a0a 2020 2020 2320  t=True))..    # 
-0001a4d0: 636c 6173 7320 4874 6d6c 5472 6565 0a0a  class HtmlTree..
-0001a4e0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-0001a4f0: 0a20 2020 2064 6566 2067 6574 5f64 6976  .    def get_div
-0001a500: 5f73 7061 6e5f 7374 6172 7469 6e67 5f77  _span_starting_w
-0001a510: 6974 6828 636c 732c 2065 6c65 6d2c 2073  ith(cls, elem, s
-0001a520: 7472 672c 2069 735f 626f 6c64 3d46 616c  trg, is_bold=Fal
-0001a530: 7365 2c20 666f 6e74 5f73 697a 655f 7261  se, font_size_ra
-0001a540: 6e67 653d 4e6f 6e65 293a 0a20 2020 2020  nge=None):.     
-0001a550: 2020 2072 6573 756c 7420 3d20 4e6f 6e65     result = None
-0001a560: 0a20 2020 2020 2020 2078 7061 7468 203d  .        xpath =
-0001a570: 2066 222e 2f2f 6469 765b 7370 616e 5b73   f".//div[span[s
-0001a580: 7461 7274 732d 7769 7468 282e 2c27 7b73  tarts-with(.,'{s
-0001a590: 7472 677d 2729 5d5d 220a 2020 2020 2020  trg}')]]".      
-0001a5a0: 2020 6469 7673 203d 2065 6c65 6d2e 7870    divs = elem.xp
-0001a5b0: 6174 6828 7870 6174 6829 0a20 2020 2020  ath(xpath).     
-0001a5c0: 2020 2069 6620 6c65 6e28 6469 7673 2920     if len(divs) 
-0001a5d0: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-0001a5e0: 2020 6c6f 6767 696e 672e 7761 726e 696e    logging.warnin
-0001a5f0: 6728 6622 4e6f 2064 6976 7320 7769 7468  g(f"No divs with
-0001a600: 207b 7374 7267 7d22 290a 2020 2020 2020   {strg}").      
-0001a610: 2020 2020 2020 7265 7475 726e 2072 6573        return res
-0001a620: 756c 742c 204e 6f6e 650a 2020 2020 2020  ult, None.      
-0001a630: 2020 6e65 775f 6469 7673 203d 205b 5d0a    new_divs = [].
-0001a640: 2020 2020 2020 2020 666f 7220 6469 7620          for div 
-0001a650: 696e 2064 6976 733a 0a20 2020 2020 2020  in divs:.       
-0001a660: 2020 2020 2073 7061 6e73 203d 2064 6976       spans = div
-0001a670: 2e78 7061 7468 2822 2e2f 7370 616e 2229  .xpath("./span")
-0001a680: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001a690: 7370 616e 733a 0a20 2020 2020 2020 2020  spans:.         
-0001a6a0: 2020 2020 2020 2063 7373 5f73 7479 6c65         css_style
-0001a6b0: 203d 2043 5353 5374 796c 652e 6372 6561   = CSSStyle.crea
-0001a6c0: 7465 5f63 7373 5f73 7479 6c65 5f66 726f  te_css_style_fro
-0001a6d0: 6d5f 6174 7472 6962 7574 655f 6f66 5f62  m_attribute_of_b
-0001a6e0: 6f64 795f 656c 656d 656e 7428 7370 616e  ody_element(span
-0001a6f0: 735b 305d 290a 2020 2020 2020 2020 2020  s[0]).          
-0001a700: 2020 2020 2020 6966 206e 6f74 2028 6973        if not (is
-0001a710: 5f62 6f6c 6420 616e 6420 6373 735f 7374  _bold and css_st
-0001a720: 796c 652e 6973 5f62 6f6c 645f 6e61 6d65  yle.is_bold_name
-0001a730: 2829 293a 0a20 2020 2020 2020 2020 2020  ()):.           
-0001a740: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-0001a750: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0001a760: 2020 6966 206e 6f74 2028 666f 6e74 5f73    if not (font_s
-0001a770: 697a 655f 7261 6e67 6520 616e 6420 636c  ize_range and cl
-0001a780: 732e 696e 5f72 616e 6765 2863 7373 5f73  s.in_range(css_s
-0001a790: 7479 6c65 2e66 6f6e 745f 7369 7a65 2c20  tyle.font_size, 
-0001a7a0: 666f 6e74 5f73 697a 655f 7261 6e67 6529  font_size_range)
-0001a7b0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0001a7c0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-0001a7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a7e0: 6e65 775f 6469 7673 2e61 7070 656e 6428  new_divs.append(
-0001a7f0: 6469 7629 0a20 2020 2020 2020 2020 2020  div).           
-0001a800: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
-0001a810: 2020 6469 7673 203d 206e 6577 5f64 6976    divs = new_div
-0001a820: 730a 2020 2020 2020 2020 2320 616c 736f  s.        # also
-0001a830: 2074 6573 7420 666f 6e74 2068 6572 6520   test font here 
-0001a840: 4e59 490a 2020 2020 2020 2020 6966 206c  NYI.        if l
-0001a850: 656e 2864 6976 7329 203d 3d20 303a 0a20  en(divs) == 0:. 
-0001a860: 2020 2020 2020 2020 2020 206c 6f67 6769             loggi
-0001a870: 6e67 2e77 6172 6e69 6e67 2866 2263 616e  ng.warning(f"can
-0001a880: 6e6f 7420 6669 6e64 2064 6976 3a20 6c65  not find div: le
-0001a890: 6e3d 7b6c 656e 2864 6976 7329 7d22 290a  n={len(divs)}").
-0001a8a0: 2020 2020 2020 2020 656c 6966 206c 656e          elif len
-0001a8b0: 2864 6976 7329 203e 2031 3a0a 2020 2020  (divs) > 1:.    
-0001a8c0: 2020 2020 2020 2020 6c6f 6767 696e 672e          logging.
-0001a8d0: 7761 726e 696e 6728 6622 746f 6f20 6d61  warning(f"too ma
-0001a8e0: 6e79 2064 6976 733a 206c 656e 3d7b 6c65  ny divs: len={le
-0001a8f0: 6e28 6469 7673 297d 2229 0a20 2020 2020  n(divs)}").     
-0001a900: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0001a910: 2020 2020 2072 6573 756c 7420 3d20 6469       result = di
-0001a920: 7673 5b30 5d0a 2020 2020 2020 2020 2020  vs[0].          
-0001a930: 2020 7265 7375 6c74 2e61 7474 7269 625b    result.attrib[
-0001a940: 226d 6172 6b65 7222 5d20 3d20 7374 7267  "marker"] = strg
-0001a950: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001a960: 7265 7375 6c74 2c20 6469 7673 0a0a 2020  result, divs..  
-0001a970: 2020 2320 636c 6173 7320 4874 6d6c 5472    # class HtmlTr
-0001a980: 6565 0a0a 2020 2020 4063 6c61 7373 6d65  ee..    @classme
-0001a990: 7468 6f64 0a20 2020 2064 6566 2067 6574  thod.    def get
-0001a9a0: 5f64 6976 5f73 7061 6e73 5f77 6974 685f  _div_spans_with_
-0001a9b0: 6465 6369 6d61 6c73 2863 6c73 2c20 656c  decimals(cls, el
-0001a9c0: 656d 2c20 6973 5f62 6f6c 643d 4e6f 6e65  em, is_bold=None
-0001a9d0: 2c20 666f 6e74 5f73 697a 655f 7261 6e67  , font_size_rang
-0001a9e0: 653d 4e6f 6e65 2c20 636c 6173 735f 6469  e=None, class_di
-0001a9f0: 6374 3d4e 6f6e 652c 2073 6563 7469 6f6e  ct=None, section
-0001aa00: 5f72 6563 3d4e 6f6e 6529 3a0a 2020 2020  _rec=None):.    
-0001aa10: 2020 2020 2222 224d 6174 6368 6573 2064      """Matches d
-0001aa20: 6976 2f73 7061 6e20 7374 6172 7469 6e67  iv/span starting
-0001aa30: 2077 6974 6820 6120 6465 6369 6d61 6c20   with a decimal 
-0001aa40: 696e 6465 780a 2020 2020 2020 2020 642e  index.        d.
-0001aa50: 6420 6f72 2064 2e64 2e64 0a20 2020 2020  d or d.d.d.     
-0001aa60: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
-0001aa70: 6573 756c 7420 3d20 4e6f 6e65 0a20 2020  esult = None.   
-0001aa80: 2020 2020 2023 2066 6972 7374 2061 6464       # first add
-0001aa90: 2061 6c6c 206d 6174 6368 696e 6720 6e75   all matching nu
-0001aaa0: 6d62 6572 6564 2064 6976 7320 746f 2070  mbered divs to p
-0001aab0: 7265 5f63 6861 7073 6563 0a20 2020 2020  re_chapsec.     
-0001aac0: 2020 2069 6620 6e6f 7420 636c 6173 735f     if not class_
-0001aad0: 6469 6374 3a0a 2020 2020 2020 2020 2020  dict:.          
-0001aae0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-0001aaf0: 6f72 2866 226d 6973 7369 6e67 2063 6c61  or(f"missing cla
-0001ab00: 7373 5f64 6963 7422 290a 2020 2020 2020  ss_dict").      
-0001ab10: 2020 746f 705f 6469 7620 3d20 4554 2e53    top_div = ET.S
-0001ab20: 7562 456c 656d 656e 7428 656c 656d 2c20  ubElement(elem, 
-0001ab30: 485f 4449 5629 0a20 2020 2020 2020 2074  H_DIV).        t
-0001ab40: 6f70 5f64 6976 2e61 7474 7269 625b 636c  op_div.attrib[cl
-0001ab50: 732e 434c 4153 535d 203d 2063 6c61 7373  s.CLASS] = class
-0001ab60: 5f64 6963 742e 6765 7428 4874 6d6c 5472  _dict.get(HtmlTr
-0001ab70: 6565 2e54 4f50 5f44 4956 290a 2020 2020  ee.TOP_DIV).    
-0001ab80: 2020 2020 7072 655f 6368 6170 7365 6320      pre_chapsec 
-0001ab90: 3d20 4554 2e53 7562 456c 656d 656e 7428  = ET.SubElement(
-0001aba0: 746f 705f 6469 762c 2048 5f44 4956 290a  top_div, H_DIV).
-0001abb0: 2020 2020 2020 2020 7072 655f 6368 6170          pre_chap
-0001abc0: 7365 632e 6174 7472 6962 5b63 6c73 2e43  sec.attrib[cls.C
-0001abd0: 4c41 5353 5d20 3d20 636c 6173 735f 6469  LASS] = class_di
-0001abe0: 6374 2e67 6574 2848 746d 6c54 7265 652e  ct.get(HtmlTree.
-0001abf0: 4348 4150 5345 4329 0a20 2020 2020 2020  CHAPSEC).       
-0001ac00: 2063 7572 7265 6e74 5f64 6976 203d 2070   current_div = p
-0001ac10: 7265 5f63 6861 7073 6563 0a0a 2020 2020  re_chapsec..    
-0001ac20: 2020 2020 2320 6974 6572 6174 6520 6f76      # iterate ov
-0001ac30: 6572 2061 6c6c 2064 6976 732c 206f 6e6c  er all divs, onl
-0001ac40: 7920 6170 7065 6e64 2074 686f 7365 2077  y append those w
-0001ac50: 6974 6820 6465 6369 6d61 6c0a 2020 2020  ith decimal.    
-0001ac60: 2020 2020 6469 7673 203d 2065 6c65 6d2e      divs = elem.
-0001ac70: 7870 6174 6828 636c 732e 414c 4c5f 4449  xpath(cls.ALL_DI
-0001ac80: 565f 5850 4154 4853 290a 2020 2020 2020  V_XPATHS).      
-0001ac90: 2020 6465 6369 6d61 6c5f 636f 756e 7420    decimal_count 
-0001aca0: 3d20 300a 2020 2020 2020 2020 7465 7874  = 0.        text
-0001acb0: 7320 3d20 5b5d 2020 2320 6a75 7374 2061  s = []  # just a
-0001acc0: 2063 6865 636b 2061 7420 7072 6573 656e   check at presen
-0001acd0: 740a 2020 2020 2020 2020 666f 7220 6469  t.        for di
-0001ace0: 7620 696e 2064 6976 733a 0a20 2020 2020  v in divs:.     
-0001acf0: 2020 2020 2020 2073 7061 6e73 203d 2064         spans = d
-0001ad00: 6976 2e78 7061 7468 2822 2e2f 7370 616e  iv.xpath("./span
-0001ad10: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
-0001ad20: 6620 6e6f 7420 7370 616e 733a 0a20 2020  f not spans:.   
-0001ad30: 2020 2020 2020 2020 2020 2020 2023 206e               # n
-0001ad40: 6f20 7370 616e 732c 2063 6f6e 6361 7465  o spans, concate
-0001ad50: 6e61 7465 2077 6974 6820 7369 626c 696e  nate with siblin
-0001ad60: 6773 0a20 2020 2020 2020 2020 2020 2020  gs.             
-0001ad70: 2020 2069 6620 6469 7620 3d3d 2063 7572     if div == cur
-0001ad80: 7265 6e74 5f64 6976 3a0a 2020 2020 2020  rent_div:.      
-0001ad90: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-0001ada0: 6767 696e 672e 7761 726e 696e 6728 2266  gging.warning("f
-0001adb0: 2063 616e 6e6f 7420 6170 7065 6e64 2064   cannot append d
-0001adc0: 6976 207b 6469 767d 2074 6f20 6974 7365  iv {div} to itse
-0001add0: 6c66 2229 0a20 2020 2020 2020 2020 2020  lf").           
-0001ade0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0001adf0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0001ae00: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-0001ae10: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-0001ae20: 656e 745f 6469 762e 6170 7065 6e64 2864  ent_div.append(d
-0001ae30: 6976 290a 2020 2020 2020 2020 2020 2020  iv).            
-0001ae40: 2020 2020 2020 2020 6578 6365 7074 2056          except V
-0001ae50: 616c 7565 4572 726f 7220 6173 2076 653a  alueError as ve:
-0001ae60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ae70: 2020 2020 2020 2020 206c 6f67 6769 6e67           logging
-0001ae80: 2e65 7272 6f72 2866 2245 7272 6f72 207b  .error(f"Error {
-0001ae90: 7665 7d22 290a 2020 2020 2020 2020 2020  ve}").          
-0001aea0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0001aeb0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0001aec0: 7572 7265 6e74 5f64 6976 2e61 7070 656e  urrent_div.appen
-0001aed0: 6428 6469 7629 0a20 2020 2020 2020 2020  d(div).         
-0001aee0: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
-0001aef0: 6365 7074 696f 6e20 6173 2065 3a0a 2020  ception as e:.  
-0001af00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001af10: 2020 6c6f 6767 696e 672e 6572 726f 7228    logging.error(
-0001af20: 6622 4255 4720 736b 6970 7065 6422 290a  f"BUG skipped").
-0001af30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001af40: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
-0001af50: 2020 2020 2063 7373 5f73 7479 6c65 203d       css_style =
-0001af60: 2043 5353 5374 796c 652e 6372 6561 7465   CSSStyle.create
-0001af70: 5f63 7373 5f73 7479 6c65 5f66 726f 6d5f  _css_style_from_
-0001af80: 6174 7472 6962 7574 655f 6f66 5f62 6f64  attribute_of_bod
-0001af90: 795f 656c 656d 656e 7428 7370 616e 735b  y_element(spans[
-0001afa0: 305d 2920 2023 206e 6f72 6d61 6c6c 7920  0])  # normally 
-0001afb0: 636f 6d65 7320 6669 7273 740a 2020 2020  comes first.    
-0001afc0: 2020 2020 2020 2020 2320 6368 6563 6b20          # check 
-0001afd0: 7765 6967 6874 2c20 6966 206e 6f6e 6520  weight, if none 
-0001afe0: 6170 7065 6e64 2074 6f20 7369 626c 696e  append to siblin
-0001aff0: 6773 0a20 2020 2020 2020 2020 2020 2069  gs.            i
-0001b000: 6620 6e6f 7420 2869 735f 626f 6c64 2061  f not (is_bold a
-0001b010: 6e64 2063 7373 5f73 7479 6c65 2e69 735f  nd css_style.is_
-0001b020: 626f 6c64 5f6e 616d 6528 2929 3a0a 2020  bold_name()):.  
-0001b030: 2020 2020 2020 2020 2020 2020 2020 6375                cu
-0001b040: 7272 656e 745f 6469 762e 6170 7065 6e64  rrent_div.append
-0001b050: 2864 6976 290a 2020 2020 2020 2020 2020  (div).          
-0001b060: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
-0001b070: 2020 2020 2020 2020 2020 2023 2063 6865             # che
-0001b080: 636b 2066 6f6e 742d 7369 7a65 2c20 6966  ck font-size, if
-0001b090: 206e 6f6e 6520 6170 7065 6e64 2074 6f20   none append to 
-0001b0a0: 7369 626c 696e 6773 0a20 2020 2020 2020  siblings.       
-0001b0b0: 2020 2020 2069 6620 6e6f 7420 2866 6f6e       if not (fon
-0001b0c0: 745f 7369 7a65 5f72 616e 6765 2061 6e64  t_size_range and
-0001b0d0: 2063 6c73 2e69 6e5f 7261 6e67 6528 6373   cls.in_range(cs
-0001b0e0: 735f 7374 796c 652e 666f 6e74 5f73 697a  s_style.font_siz
-0001b0f0: 652c 2066 6f6e 745f 7369 7a65 5f72 616e  e, font_size_ran
-0001b100: 6765 2929 3a0a 2020 2020 2020 2020 2020  ge)):.          
-0001b110: 2020 2020 2020 6375 7272 656e 745f 6469        current_di
-0001b120: 762e 6170 7065 6e64 2864 6976 290a 2020  v.append(div).  
-0001b130: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0001b140: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
-0001b150: 2020 2023 2073 7061 6e20 636f 6e74 656e     # span conten
-0001b160: 740a 2020 2020 2020 2020 2020 2020 7465  t.            te
-0001b170: 7874 203d 2048 746d 6c55 7469 6c2e 6765  xt = HtmlUtil.ge
-0001b180: 745f 7465 7874 5f63 6f6e 7465 6e74 2873  t_text_content(s
-0001b190: 7061 6e73 5b30 5d29 0a20 2020 2020 2020  pans[0]).       
-0001b1a0: 2020 2020 206d 6174 6368 6564 203d 2046       matched = F
-0001b1b0: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-0001b1c0: 2069 6620 7365 6374 696f 6e5f 7265 632e   if section_rec.
-0001b1d0: 6d61 7463 6828 7465 7874 293a 0a20 2020  match(text):.   
-0001b1e0: 2020 2020 2020 2020 2020 2020 2074 6f70               top
-0001b1f0: 5f64 6976 2e61 7070 656e 6428 6375 7272  _div.append(curr
-0001b200: 656e 745f 6469 7629 0a20 2020 2020 2020  ent_div).       
-0001b210: 2020 2020 2020 2020 2074 6578 7473 2e61           texts.a
-0001b220: 7070 656e 6428 7465 7874 290a 2020 2020  ppend(text).    
-0001b230: 2020 2020 2020 2020 2020 2020 6469 762e              div.
-0001b240: 6174 7472 6962 5b48 746d 6c55 7469 6c2e  attrib[HtmlUtil.
-0001b250: 4d41 524b 4552 5d20 3d20 7465 7874 0a20  MARKER] = text. 
-0001b260: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0001b270: 7572 7265 6e74 5f64 6976 203d 2064 6976  urrent_div = div
-0001b280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b290: 2064 6563 696d 616c 5f63 6f75 6e74 202b   decimal_count +
-0001b2a0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-0001b2b0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0001b2c0: 2020 2020 2020 6375 7272 656e 745f 6469        current_di
-0001b2d0: 762e 6170 7065 6e64 2864 6976 290a 2020  v.append(div).  
-0001b2e0: 2020 2020 2020 7265 7475 726e 2074 6f70        return top
-0001b2f0: 5f64 6976 0a0a 2020 2020 2320 636c 6173  _div..    # clas
-0001b300: 7320 4874 6d6c 5472 6565 0a0a 2020 2020  s HtmlTree..    
-0001b310: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-0001b320: 2064 6566 2069 6e5f 7261 6e67 6528 636c   def in_range(cl
-0001b330: 732c 206e 756d 2c20 6e75 6d5f 7261 6e67  s, num, num_rang
-0001b340: 6529 3a0a 2020 2020 2020 2020 2222 2269  e):.        """i
-0001b350: 7320 6120 6e75 6d62 6572 2069 6e20 6120  s a number in a 
-0001b360: 6e75 6d65 7269 6320 7261 6e67 6522 2222  numeric range"""
-0001b370: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-0001b380: 6e75 6d5f 7261 6e67 6520 6f72 206c 656e  num_range or len
-0001b390: 286e 756d 5f72 616e 6765 2920 3d3d 2032  (num_range) == 2
-0001b3a0: 2c20 6622 7261 6e67 6520 6d75 7374 2068  , f"range must h
-0001b3b0: 6176 6520 3220 656c 656d 656e 7473 220a  ave 2 elements".
-0001b3c0: 2020 2020 2020 2020 6173 7365 7274 206e          assert n
-0001b3d0: 756d 5f72 616e 6765 5b30 5d20 3c3d 206e  um_range[0] <= n
-0001b3e0: 756d 5f72 616e 6765 5b31 5d2c 2066 2266  um_range[1], f"f
-0001b3f0: 6f6e 745f 7369 7a65 5f72 616e 6765 206d  ont_size_range m
-0001b400: 7573 7420 6265 2028 6c6f 7765 722c 6869  ust be (lower,hi
-0001b410: 6768 6572 2922 0a20 2020 2020 2020 2061  gher)".        a
-0001b420: 7373 6572 7420 666c 6f61 7428 6e75 6d5f  ssert float(num_
-0001b430: 7261 6e67 655b 305d 290a 2020 2020 2020  range[0]).      
-0001b440: 2020 7265 7375 6c74 203d 206e 756d 5f72    result = num_r
-0001b450: 616e 6765 5b30 5d20 3c3d 206e 756d 203c  ange[0] <= num <
-0001b460: 3d20 6e75 6d5f 7261 6e67 655b 315d 0a20  = num_range[1]. 
-0001b470: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-0001b480: 7375 6c74 0a0a 2020 2020 2320 636c 6173  sult..    # clas
-0001b490: 7320 4874 6d6c 5472 6565 0a0a 2020 2020  s HtmlTree..    
-0001b4a0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-0001b4b0: 2064 6566 2067 6574 5f64 6563 696d 616c   def get_decimal
-0001b4c0: 5f73 6563 7469 6f6e 7328 636c 732c 2068  _sections(cls, h
-0001b4d0: 746d 6c5f 656c 656d 2c20 7870 6174 683d  tml_elem, xpath=
-0001b4e0: 4e6f 6e65 2c20 7265 6765 783d 4e6f 6e65  None, regex=None
-0001b4f0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-0001b500: 2020 2020 2020 2067 6574 7320 6465 6369         gets deci
-0001b510: 6d61 6c20 7365 6374 696f 6e73 2069 6e20  mal sections in 
-0001b520: 656c 656d 7320 6f66 2066 6f72 6d20 312e  elems of form 1.
-0001b530: 322c 2065 7463 0a20 2020 2020 2020 203a  2, etc.        :
-0001b540: 7061 7261 6d20 6874 6d6c 5f65 6c65 6d3a  param html_elem:
-0001b550: 2065 6c65 6d65 6e74 2074 6f20 7365 6172   element to sear
-0001b560: 6368 2066 6f72 2073 6563 7469 6f6e 730a  ch for sections.
-0001b570: 2020 2020 2020 2020 3a70 6172 616d 2078          :param x
-0001b580: 7061 7468 3a20 7365 6374 696e 7320 6d61  path: sectins ma
-0001b590: 7920 6861 7665 2062 6565 6e20 6c61 6265  y have been labe
-0001b5a0: 6c6c 6564 2077 6974 6820 4063 6c61 7373  lled with @class
-0001b5b0: 206f 7220 7369 6d69 6c61 720a 2020 2020   or similar.    
-0001b5c0: 2020 2020 3a70 6172 616d 2072 6567 6578      :param regex
-0001b5d0: 3a20 7365 6374 696f 6e73 206d 6179 2062  : sections may b
-0001b5e0: 6520 6469 7363 6f76 6572 6162 6c65 2062  e discoverable b
-0001b5f0: 7920 7265 6765 782b 636f 6e74 656e 740a  y regex+content.
-0001b600: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
-0001b610: 206c 6973 7420 6f66 2073 6563 7469 6f6e   list of section
-0001b620: 7320 286d 6179 2062 6520 656d 7074 7929  s (may be empty)
-0001b630: 206f 7220 4e6f 6e65 0a20 2020 2020 2020   or None.       
-0001b640: 2049 7420 6973 206c 696b 656c 7920 7468   It is likely th
-0001b650: 6174 2061 2063 6f6d 6269 6e61 7469 6f6e  at a combination
-0001b660: 206f 6620 7870 6174 6820 616e 6420 7265   of xpath and re
-0001b670: 6765 7820 7769 6c6c 2062 6520 7573 6564  gex will be used
-0001b680: 2061 7320 7870 6174 680a 2020 2020 2020   as xpath.      
-0001b690: 2020 6d61 7920 6e6f 7420 6861 7665 2072    may not have r
-0001b6a0: 6567 6578 0a20 2020 2020 2020 2022 2222  egex.        """
-0001b6b0: 0a20 2020 2020 2020 2069 6620 6874 6d6c  .        if html
-0001b6c0: 5f65 6c65 6d20 6973 204e 6f6e 653a 0a20  _elem is None:. 
-0001b6d0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001b6e0: 6e20 4e6f 6e65 0a20 2020 2020 2020 2073  n None.        s
-0001b6f0: 6563 7469 6f6e 7320 3d20 5b5d 0a20 2020  ections = [].   
-0001b700: 2020 2020 2069 6620 7870 6174 683a 0a20       if xpath:. 
-0001b710: 2020 2020 2020 2020 2020 2073 6563 7469             secti
-0001b720: 6f6e 7320 3d20 6874 6d6c 5f65 6c65 6d2e  ons = html_elem.
-0001b730: 7870 6174 6828 7870 6174 6829 0a20 2020  xpath(xpath).   
-0001b740: 2020 2020 2069 6620 7265 6765 783a 0a20       if regex:. 
-0001b750: 2020 2020 2020 2020 2020 206c 6f67 6769             loggi
-0001b760: 6e67 2e77 6172 6e69 6e67 2866 2272 6567  ng.warning(f"reg
-0001b770: 6578 206e 6f74 2079 6574 2064 6576 656c  ex not yet devel
-0001b780: 6f70 6564 2066 6f72 2073 6563 7469 6f6e  oped for section
-0001b790: 7322 290a 2020 2020 2020 2020 7265 7475  s").        retu
-0001b7a0: 726e 2073 6563 7469 6f6e 730a 0a0a 5245  rn sections...RE
-0001b7b0: 4353 5f42 595f 5345 4354 494f 4e20 3d20  CS_BY_SECTION = 
-0001b7c0: 7b0a 2020 2020 2320 4874 6d6c 5472 6565  {.    # HtmlTree
-0001b7d0: 2e43 4841 505f 544f 503a 2049 5043 435f  .CHAP_TOP: IPCC_
-0001b7e0: 4348 4150 5f54 4f50 5f52 4543 2c20 2320  CHAP_TOP_REC, # 
-0001b7f0: 7368 6f75 6c64 2062 6520 696e 6a65 6374  should be inject
-0001b800: 6564 2062 7920 7573 6572 0a20 2020 2048  ed by user.    H
-0001b810: 746d 6c54 7265 652e 4348 4150 5f54 4f50  tmlTree.CHAP_TOP
-0001b820: 3a20 4348 4150 5f54 4f50 5f52 4543 2c20  : CHAP_TOP_REC, 
-0001b830: 2023 2073 686f 756c 6420 6265 2069 6e6a   # should be inj
-0001b840: 6563 7465 6420 6279 2075 7365 720a 2020  ected by user.  
-0001b850: 2020 4874 6d6c 5472 6565 2e43 4841 505f    HtmlTree.CHAP_
-0001b860: 5345 4354 494f 4e53 3a20 5345 4354 494f  SECTIONS: SECTIO
-0001b870: 4e53 5f44 4543 494d 414c 5f52 4543 2c0a  NS_DECIMAL_REC,.
-0001b880: 2020 2020 4874 6d6c 5472 6565 2e43 4841      HtmlTree.CHA
-0001b890: 505f 5355 4253 4543 5453 3a20 5355 4253  P_SUBSECTS: SUBS
-0001b8a0: 4543 5453 5f44 4543 494d 414c 5f52 4543  ECTS_DECIMAL_REC
-0001b8b0: 2c0a 7d0a 0a0a 636c 6173 7320 4854 4d4c  ,.}...class HTML
-0001b8c0: 5365 6172 6368 6572 3a0a 2020 2020 2222  Searcher:.    ""
-0001b8d0: 220a 2020 2020 4920 7468 696e 6b20 7468  ".    I think th
-0001b8e0: 6973 2064 7570 6c69 6361 7465 7320 736f  is duplicates so
-0001b8f0: 6d65 206f 6620 4e6f 6465 4578 7472 6163  me of NodeExtrac
-0001b900: 746f 722e 0a20 2020 2022 2222 0a20 2020  tor..    """.   
-0001b910: 2022 2222 0a20 2020 206d 6574 686f 6473   """.    methods
-0001b920: 2066 6f72 2066 696e 6469 6e67 2063 6875   for finding chu
-0001b930: 6e6b 7320 616e 6420 7374 7269 6e67 7320  nks and strings 
-0001b940: 696e 2048 544d 4c20 656c 656d 656e 7473  in HTML elements
-0001b950: 0a0a 2020 2020 4578 616d 706c 6520 7465  ..    Example te
-0001b960: 7874 3a0a 2020 2020 3c73 7061 6e3e 6f62  xt:.    <span>ob
-0001b970: 7365 7276 6564 2069 6e63 7265 6173 6573  served increases
-0001b980: 2069 6e20 7468 6520 6d6f 7374 2072 6563   in the most rec
-0001b990: 656e 7420 7965 6172 7320 284d 696e 7820  ent years (Minx 
-0001b9a0: 6574 2061 6c2e 2c20 3230 3231 3b20 554e  et al., 2021; UN
-0001b9b0: 4550 2c20 3230 3230 6129 2e0a 2020 2020  EP, 2020a)..    
-0001b9c0: 3230 3139 2047 4847 2065 6d69 7373 696f  2019 GHG emissio
-0001b9d0: 6e73 206c 6576 656c 7320 7765 7265 2068  ns levels were h
-0001b9e0: 6967 6865 7220 636f 6d70 6172 6564 2074  igher compared t
-0001b9f0: 6f20 3130 2061 6e64 2033 3020 7965 6172  o 10 and 30 year
-0001ba00: 7320 6167 6f20 2868 6967 6820 636f 6e66  s ago (high conf
-0001ba10: 6964 656e 6365 293a 2061 626f 7574 2031  idence): about 1
-0001ba20: 3225 2028 362e 3520 4774 434f 3265 7129  2% (6.5 GtCO2eq)
-0001ba30: 0a20 2020 2068 6967 6865 7220 7468 616e  .    higher than
-0001ba40: 2069 6e20 3230 3130 2028 3533 c2b1 352e   in 2010 (53..5.
-0001ba50: 3720 4774 434f 3265 7129 2028 4152 3520  7 GtCO2eq) (AR5 
-0001ba60: 7265 6665 7265 6e63 6520 7965 6172 2920  reference year) 
-0001ba70: 616e 6420 6162 6f75 7420 3534 2520 2832  and about 54% (2
-0001ba80: 3120 4774 434f 3265 7129 2068 6967 6865  1 GtCO2eq) highe
-0001ba90: 7220 7468 616e 2069 6e20 3139 3930 0a20  r than in 1990. 
-0001baa0: 2020 2028 3338 c2b1 342e 3820 4774 434f     (38..4.8 GtCO
-0001bab0: 3265 7129 2028 4b79 6f74 6f20 5072 6f74  2eq) (Kyoto Prot
-0001bac0: 6f63 6f6c 2072 6566 6572 656e 6365 2079  ocol reference y
-0001bad0: 6561 7220 616e 6420 6672 6571 7565 6e74  ear and frequent
-0001bae0: 204e 4443 2072 6566 6572 656e 6365 293c   NDC reference)<
-0001baf0: 2f73 7061 6e3e 0a20 2020 2022 2222 0a20  /span>.    """. 
-0001bb00: 2020 2022 2222 0a20 2020 2022 2222 0a0a     """.    """..
-0001bb10: 2020 2020 2320 666f 7220 7465 7874 2073      # for text s
-0001bb20: 6561 7263 680a 2020 2020 4445 4641 554c  earch.    DEFAUL
-0001bb30: 545f 5850 4154 4820 3d20 222f 2f74 6578  T_XPATH = "//tex
-0001bb40: 7428 2922 0a20 2020 2043 4855 4e4b 5f52  t()".    CHUNK_R
-0001bb50: 4520 3d20 2263 6875 6e6b 5f72 6522 2020  E = "chunk_re"  
-0001bb60: 2320 6669 6e64 7320 7465 7874 2063 6875  # finds text chu
-0001bb70: 6e6b 7320 696e 2074 6578 740a 2020 2020  nks in text.    
-0001bb80: 5350 4c49 5454 4552 5f52 4520 3d20 2273  SPLITTER_RE = "s
-0001bb90: 706c 6974 7465 725f 7265 2220 2023 2073  plitter_re"  # s
-0001bba0: 706c 6974 7320 7468 6f73 6520 6368 756e  plits those chun
-0001bbb0: 6b73 2028 652c 672c 2063 6f6d 6d61 2d73  ks (e,g, comma-s
-0001bbc0: 6570 6172 6174 6564 206c 6973 7473 0a20  eparated lists. 
-0001bbd0: 2020 2053 5542 4e4f 4445 5f52 4520 3d20     SUBNODE_RE = 
-0001bbe0: 2273 7562 5f6e 6f64 655f 7265 5f6c 6973  "sub_node_re_lis
-0001bbf0: 7422 2020 2320 6d61 7463 6865 7320 7468  t"  # matches th
-0001bc00: 6520 636f 6d70 6f6e 656e 7473 206f 6620  e components of 
-0001bc10: 7468 6520 7370 6c69 7420 6c69 7374 730a  the split lists.
-0001bc20: 2020 2020 554e 4d41 5443 4845 4420 3d20      UNMATCHED = 
-0001bc30: 2275 6e6d 6174 6368 6564 2220 2023 2061  "unmatched"  # a
-0001bc40: 6464 7320 756e 6d61 7463 6865 6420 6e6f  dds unmatched no
-0001bc50: 6465 730a 2020 2020 5850 4154 4820 3d20  des.    XPATH = 
-0001bc60: 2278 7061 7468 220a 0a20 2020 2064 6566  "xpath"..    def
-0001bc70: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
-0001bc80: 7870 6174 685f 6469 6374 3d4e 6f6e 652c  xpath_dict=None,
-0001bc90: 2064 6963 7478 3d4e 6f6e 6529 3a0a 2020   dictx=None):.  
-0001bca0: 2020 2020 2020 7365 6c66 2e63 6875 6e6b        self.chunk
-0001bcb0: 5f6e 6f64 655f 6469 6374 203d 2064 6963  _node_dict = dic
-0001bcc0: 7428 290a 2020 2020 2020 2020 7365 6c66  t().        self
-0001bcd0: 2e78 7061 7468 5f64 6963 7420 3d20 6469  .xpath_dict = di
-0001bce0: 6374 2829 2069 6620 7870 6174 685f 6469  ct() if xpath_di
-0001bcf0: 6374 2069 7320 4e6f 6e65 2065 6c73 6520  ct is None else 
-0001bd00: 636f 7079 2e64 6565 7063 6f70 7928 7870  copy.deepcopy(xp
-0001bd10: 6174 685f 6469 6374 290a 2020 2020 2020  ath_dict).      
-0001bd20: 2020 7365 6c66 2e63 6875 6e6b 5f64 6963    self.chunk_dic
-0001bd30: 7420 3d20 6469 6374 2829 0a20 2020 2020  t = dict().     
-0001bd40: 2020 2073 656c 662e 7370 6c69 7474 6572     self.splitter
-0001bd50: 5f64 6963 7420 3d20 6469 6374 2829 0a20  _dict = dict(). 
-0001bd60: 2020 2020 2020 2073 656c 662e 7375 626e         self.subn
-0001bd70: 6f64 655f 6469 6374 203d 2064 6963 7428  ode_dict = dict(
-0001bd80: 290a 2020 2020 2020 2020 7365 6c66 2e64  ).        self.d
-0001bd90: 6963 7478 203d 2064 6963 7428 2920 6966  ictx = dict() if
-0001bda0: 2064 6963 7478 2069 7320 4e6f 6e65 2065   dictx is None e
-0001bdb0: 6c73 6520 636f 7079 2e64 6565 7063 6f70  lse copy.deepcop
-0001bdc0: 7928 6469 6374 7829 0a0a 2020 2020 6465  y(dictx)..    de
-0001bdd0: 6620 7365 6172 6368 5f70 6174 685f 6368  f search_path_ch
-0001bde0: 756e 6b5f 6e6f 6465 2873 656c 662c 2068  unk_node(self, h
-0001bdf0: 746d 6c5f 7061 7468 293a 0a20 2020 2020  tml_path):.     
-0001be00: 2020 2061 7373 6572 7420 6874 6d6c 5f70     assert html_p
-0001be10: 6174 682e 6578 6973 7473 2829 2c20 6622  ath.exists(), f"
-0001be20: 7b68 746d 6c5f 7061 7468 7d20 7368 6f75  {html_path} shou
-0001be30: 6c64 2065 7869 7374 220a 2020 2020 2020  ld exist".      
-0001be40: 2020 7472 6565 203d 2045 542e 7061 7273    tree = ET.pars
-0001be50: 6528 7374 7228 6874 6d6c 5f70 6174 6829  e(str(html_path)
-0001be60: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0001be70: 7870 6174 6873 203d 2073 656c 662e 7870  xpaths = self.xp
-0001be80: 6174 685f 6469 6374 2e67 6574 2873 656c  ath_dict.get(sel
-0001be90: 662e 5850 4154 4829 0a20 2020 2020 2020  f.XPATH).       
-0001bea0: 2069 6620 6e6f 7420 7365 6c66 2e78 7061   if not self.xpa
-0001beb0: 7468 733a 0a20 2020 2020 2020 2020 2020  ths:.           
-0001bec0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-0001bed0: 7228 6622 4552 524f 5220 6d75 7374 2067  r(f"ERROR must g
-0001bee0: 6976 6520 7870 6174 6822 290a 2020 2020  ive xpath").    
-0001bef0: 2020 2020 666f 7220 7870 6174 6820 696e      for xpath in
-0001bf00: 2073 656c 662e 7870 6174 6873 3a0a 2020   self.xpaths:.  
-0001bf10: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-0001bf20: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0001bf30: 6174 6368 5f65 6c65 6d65 6e74 7320 3d20  atch_elements = 
-0001bf40: 7472 6565 2e78 7061 7468 2878 7061 7468  tree.xpath(xpath
-0001bf50: 290a 2020 2020 2020 2020 2020 2020 6578  ).            ex
-0001bf60: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
-0001bf70: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-0001bf80: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-0001bf90: 4572 726f 7228 6622 4552 524f 5220 7870  Error(f"ERROR xp
-0001bfa0: 6174 6820 7b78 7061 7468 7d20 7b65 7d22  ath {xpath} {e}"
-0001bfb0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0001bfc0: 656c 656d 656e 745f 6c69 7374 203d 206c  element_list = l
-0001bfd0: 6973 7428 290a 2020 2020 2020 2020 666f  ist().        fo
-0001bfe0: 7220 7870 6174 6820 696e 2073 656c 662e  r xpath in self.
-0001bff0: 7870 6174 6873 3a0a 2020 2020 2020 2020  xpaths:.        
-0001c000: 2020 2020 6d61 7463 685f 656c 656d 656e      match_elemen
-0001c010: 7473 203d 2074 7265 652e 7870 6174 6828  ts = tree.xpath(
-0001c020: 7870 6174 6829 0a20 2020 2020 2020 2020  xpath).         
-0001c030: 2020 2066 6f72 206d 6174 6368 5f65 6c65     for match_ele
-0001c040: 6d65 6e74 2069 6e20 6d61 7463 685f 656c  ment in match_el
-0001c050: 656d 656e 7473 3a0a 2020 2020 2020 2020  ements:.        
-0001c060: 2020 2020 2020 2020 7420 3d20 7479 7065          t = type
-0001c070: 286d 6174 6368 5f65 6c65 6d65 6e74 290a  (match_element).
-0001c080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c090: 6966 2074 2069 7320 6e6f 7420 5f45 6c65  if t is not _Ele
-0001c0a0: 6d65 6e74 3a0a 2020 2020 2020 2020 2020  ment:.          
-0001c0b0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0001c0c0: 5661 6c75 6545 7272 6f72 2866 226e 6f74  ValueError(f"not
-0001c0d0: 2061 6e20 656c 656d 656e 7420 7b74 7d20   an element {t} 
-0001c0e0: 7b6d 6174 6368 5f65 6c65 6d65 6e74 7d22  {match_element}"
-0001c0f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001c100: 2020 7365 6c66 2e65 6c65 6d65 6e74 5f6c    self.element_l
-0001c110: 6973 742e 6170 7065 6e64 286d 6174 6368  ist.append(match
-0001c120: 5f65 6c65 6d65 6e74 290a 0a20 2020 2020  _element)..     
-0001c130: 2020 2066 6f72 2065 6c65 6d65 6e74 2069     for element i
-0001c140: 6e20 7365 6c66 2e65 6c65 6d65 6e74 5f6c  n self.element_l
-0001c150: 6973 743a 0a20 2020 2020 2020 2020 2020  ist:.           
-0001c160: 2066 6f72 2074 6578 7420 696e 2065 6c65   for text in ele
-0001c170: 6d65 6e74 2e78 7061 7468 2822 2e2f 7465  ment.xpath("./te
-0001c180: 7874 2829 2229 3a0a 2020 2020 2020 2020  xt()"):.        
-0001c190: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
-0001c1a0: 2020 2020 2020 2020 2020 2020 2023 206e               # n
-0001c1b0: 6f64 6573 7472 203d 2073 656c 662e 7365  odestr = self.se
-0001c1c0: 6c65 6374 5f63 6875 6e6b 735f 7375 6263  lect_chunks_subc
-0001c1d0: 6875 6e6b 735f 6e6f 6465 7328 7465 7874  hunks_nodes(text
-0001c1e0: 290a 0a20 2020 2064 6566 2073 656c 6563  )..    def selec
-0001c1f0: 745f 6368 756e 6b73 5f73 7562 6368 756e  t_chunks_subchun
-0001c200: 6b73 5f6e 6f64 6573 2873 656c 662c 2074  ks_nodes(self, t
-0001c210: 6578 742c 2073 706c 6974 7465 725f 7265  ext, splitter_re
-0001c220: 3d4e 6f6e 652c 206e 6f64 655f 7265 3d4e  =None, node_re=N
-0001c230: 6f6e 6529 3a0a 2020 2020 2020 2020 2320  one):.        # 
-0001c240: 6368 756e 6b5f 7265 2c20 7370 6c69 7474  chunk_re, splitt
-0001c250: 6572 5f72 652c 206e 6f64 655f 7265 5f6c  er_re, node_re_l
-0001c260: 6961 742c 2061 6464 5f75 6e6d 6174 6368  iat, add_unmatch
-0001c270: 6564 203d 2046 616c 7365 293a 0a20 2020  ed = False):.   
-0001c280: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001c290: 204d 6f76 6520 746f 2061 2063 6c61 7373   Move to a class
-0001c2a0: 2061 6e64 2072 6566 6163 746f 7220 746f   and refactor to
-0001c2b0: 2075 7365 2064 6963 7469 6f6e 6172 790a   use dictionary.
-0001c2c0: 2020 2020 2020 2020 4e4f 5420 5945 5420          NOT YET 
-0001c2d0: 5553 4544 0a20 2020 2020 2020 203a 7061  USED.        :pa
-0001c2e0: 7261 6d20 7370 6c69 7474 6572 5f72 653a  ram splitter_re:
-0001c2f0: 2072 6567 6578 2066 6f72 2073 706c 6974   regex for split
-0001c300: 7469 6e67 2073 6d61 6c6c 6572 2063 6875  ting smaller chu
-0001c310: 6e6b 730a 2020 2020 2020 2020 3a70 6172  nks.        :par
-0001c320: 616d 206e 6f64 655f 7265 3a20 7265 6765  am node_re: rege
-0001c330: 7820 746f 2066 696e 6420 6879 7065 726e  x to find hypern
-0001c340: 6f64 6573 0a20 2020 2020 2020 2022 2222  odes.        """
-0001c350: 0a0a 2020 2020 2020 2020 6368 756e 6b5f  ..        chunk_
-0001c360: 7265 7320 3d20 7365 6c66 2e63 6875 6e6b  res = self.chunk
-0001c370: 5f64 6963 742e 6765 7428 7365 6c66 2e43  _dict.get(self.C
-0001c380: 4855 4e4b 5f52 4529 0a20 2020 2020 2020  HUNK_RE).       
-0001c390: 2073 706c 6974 7465 725f 7265 7320 3d20   splitter_res = 
-0001c3a0: 7365 6c66 2e73 706c 6974 7465 725f 6469  self.splitter_di
-0001c3b0: 6374 2e67 6574 2873 656c 662e 5350 4c49  ct.get(self.SPLI
-0001c3c0: 5454 4552 5f52 4529 0a20 2020 2020 2020  TTER_RE).       
-0001c3d0: 206e 6f64 655f 7265 7320 3d20 7365 6c66   node_res = self
-0001c3e0: 2e63 6875 6e6b 5f6e 6f64 655f 6469 6374  .chunk_node_dict
-0001c3f0: 2e67 6574 2873 656c 662e 5355 424e 4f44  .get(self.SUBNOD
-0001c400: 455f 5245 290a 0a20 2020 2020 2020 2061  E_RE)..        a
-0001c410: 6464 5f75 6e6d 6174 6368 6564 203d 2073  dd_unmatched = s
-0001c420: 656c 662e 6368 756e 6b5f 6e6f 6465 5f64  elf.chunk_node_d
-0001c430: 6963 742e 6765 7428 7365 6c66 2e55 4e4d  ict.get(self.UNM
-0001c440: 4154 4348 4544 290a 2020 2020 2020 2020  ATCHED).        
-0001c450: 7074 7220 3d20 300a 2020 2020 2020 2020  ptr = 0.        
-0001c460: 7768 696c 6520 5472 7565 3a0a 2020 2020  while True:.    
-0001c470: 2020 2020 2020 2020 666f 7220 6368 756e          for chun
-0001c480: 6b5f 7265 2069 6e20 6368 756e 6b5f 7265  k_re in chunk_re
-0001c490: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0001c4a0: 2020 206d 6174 6368 203d 2072 652e 7365     match = re.se
-0001c4b0: 6172 6368 2863 6875 6e6b 5f72 652c 2074  arch(chunk_re, t
-0001c4c0: 6578 745b 7074 723a 5d29 0a20 2020 2020  ext[ptr:]).     
-0001c4d0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0001c4e0: 7420 6d61 7463 683a 0a20 2020 2020 2020  t match:.       
-0001c4f0: 2020 2020 2020 2020 2020 2020 2062 7265               bre
-0001c500: 616b 0a20 2020 2020 2020 2020 2020 2020  ak.             
-0001c510: 2020 2070 7472 202b 3d20 6d61 7463 682e     ptr += match.
-0001c520: 7370 616e 2829 5b31 5d0a 2020 2020 2020  span()[1].      
-0001c530: 2020 2020 2020 2020 2020 6e6f 6465 7374            nodest
-0001c540: 7220 3d20 6d61 7463 682e 6772 6f75 7028  r = match.group(
-0001c550: 3129 0a0a 2020 2020 2020 2020 2020 2020  1)..            
-0001c560: 2020 2020 6e6f 6465 7320 3d20 7265 2e73      nodes = re.s
-0001c570: 706c 6974 2873 706c 6974 7465 725f 7265  plit(splitter_re
-0001c580: 2c20 6e6f 6465 7374 7229 0a20 2020 2020  , nodestr).     
-0001c590: 2020 2020 2020 2020 2020 206e 6f64 655f             node_
-0001c5a0: 6469 6374 203d 2064 6566 6175 6c74 6469  dict = defaultdi
-0001c5b0: 6374 286c 6973 7429 0a20 2020 2020 2020  ct(list).       
-0001c5c0: 2020 2020 2020 2020 2066 6f72 206e 6f64           for nod
-0001c5d0: 6520 696e 206e 6f64 6573 3a0a 2020 2020  e in nodes:.    
-0001c5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c5f0: 6d20 3d20 7265 2e73 6561 7263 6828 6e6f  m = re.search(no
-0001c600: 6465 5f72 652c 206e 6f64 6529 0a20 2020  de_re, node).   
-0001c610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c620: 2069 6620 6d3a 0a20 2020 2020 2020 2020   if m:.         
-0001c630: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0001c640: 6f64 655f 6469 6374 5b6e 6f64 655f 7265  ode_dict[node_re
-0001c650: 5d2e 6170 7065 6e64 286e 6f64 6529 0a20  ].append(node). 
-0001c660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c670: 2020 2069 6620 6e6f 7420 6d20 616e 6420     if not m and 
-0001c680: 6164 645f 756e 6d61 7463 6865 643a 0a20  add_unmatched:. 
+00019f60: 2020 2020 2020 636c 732e 544f 505f 4449        cls.TOP_DI
+00019f70: 563a 2063 6c73 2e54 5245 455f 524f 4f54  V: cls.TREE_ROOT
+00019f80: 2c20 7d0a 2020 2020 2020 2020 7265 6320  , }.        rec 
+00019f90: 3d20 7265 6373 5f62 795f 7365 6374 696f  = recs_by_sectio
+00019fa0: 6e2e 6765 7428 636c 732e 4348 4150 5f54  n.get(cls.CHAP_T
+00019fb0: 4f50 290a 2020 2020 2020 2020 6173 7365  OP).        asse
+00019fc0: 7274 2072 6563 2069 7320 6e6f 7420 4e6f  rt rec is not No
+00019fd0: 6e65 2c20 6622 7761 6e74 6564 206e 6f6e  ne, f"wanted non
+00019fe0: 2d4e 6f6e 6520 7b63 6c73 2e43 4841 505f  -None {cls.CHAP_
+00019ff0: 544f 507d 2072 6563 220a 2020 2020 2020  TOP} rec".      
+0001a000: 2020 6465 6369 6d61 6c5f 6469 7673 203d    decimal_divs =
+0001a010: 2063 6c73 2e67 6574 5f64 6976 5f73 7061   cls.get_div_spa
+0001a020: 6e73 5f77 6974 685f 6465 6369 6d61 6c73  ns_with_decimals
+0001a030: 2865 6c65 6d2c 0a20 2020 2020 2020 2020  (elem,.         
+0001a040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a060: 2020 2020 2020 2020 2020 2020 2020 6973                is
+0001a070: 5f62 6f6c 642c 0a20 2020 2020 2020 2020  _bold,.         
+0001a080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a0a0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0001a0b0: 6e74 5f73 697a 655f 7261 6e67 653d 666f  nt_size_range=fo
+0001a0c0: 6e74 5f73 697a 655f 7261 6e67 652c 0a20  nt_size_range,. 
+0001a0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a100: 2020 2020 2020 7365 6374 696f 6e5f 7265        section_re
+0001a110: 633d 7265 632c 2063 6c61 7373 5f64 6963  c=rec, class_dic
+0001a120: 743d 636c 6173 735f 6469 6374 290a 2020  t=class_dict).  
+0001a130: 2020 2020 2020 636c 732e 6372 6561 7465        cls.create
+0001a140: 5f66 696c 656e 616d 655f 616e 645f 6f75  _filename_and_ou
+0001a150: 7470 7574 2864 6563 696d 616c 5f64 6976  tput(decimal_div
+0001a160: 732c 206f 7574 7075 745f 6469 7229 0a0a  s, output_dir)..
+0001a170: 2020 2020 2320 636c 6173 7320 4874 6d6c      # class Html
+0001a180: 5472 6565 0a0a 2020 2020 4063 6c61 7373  Tree..    @class
+0001a190: 6d65 7468 6f64 0a20 2020 2064 6566 2063  method.    def c
+0001a1a0: 7265 6174 655f 6669 6c65 6e61 6d65 5f61  reate_filename_a
+0001a1b0: 6e64 5f6f 7574 7075 7428 636c 732c 2064  nd_output(cls, d
+0001a1c0: 6563 696d 616c 5f64 6976 732c 206f 7574  ecimal_divs, out
+0001a1d0: 7075 745f 6469 722c 0a20 2020 2020 2020  put_dir,.       
+0001a1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a1f0: 2020 2020 2020 2020 2020 2020 6f72 6967              orig
+0001a200: 3d22 2021 5c22 2324 2526 2728 292a 2b2c  =" !\"#$%&'()*+,
+0001a210: 2f3a 3b3c 3d3e 3f40 5b5c 5c5d 5e60 7b7c  /:;<=>?@[\\]^`{|
+0001a220: 7d7e 222c 2072 6570 3d22 5f22 293a 0a20  }~", rep="_"):. 
+0001a230: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0001a240: 2020 2063 7265 6174 6520 6669 6c65 6e61     create filena
+0001a250: 6d65 2066 726f 6d20 7365 6374 696f 6e20  me from section 
+0001a260: 6e61 6d65 2c20 7265 706c 6163 6520 7075  name, replace pu
+0001a270: 6e63 7420 6368 6172 6163 7465 7273 0a20  nct characters. 
+0001a280: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0001a290: 2020 2069 6620 6f75 7470 7574 5f64 6972     if output_dir
+0001a2a0: 3a0a 2020 2020 2020 2020 2020 2020 6f75  :.            ou
+0001a2b0: 7470 7574 5f64 6972 203d 2050 6174 6828  tput_dir = Path(
+0001a2c0: 6f75 7470 7574 5f64 6972 290a 2020 2020  output_dir).    
+0001a2d0: 2020 2020 2020 2020 6f75 7470 7574 5f64          output_d
+0001a2e0: 6972 2e6d 6b64 6972 2865 7869 7374 5f6f  ir.mkdir(exist_o
+0001a2f0: 6b3d 5472 7565 290a 0a20 2020 2020 2020  k=True)..       
+0001a300: 2020 2020 2070 756e 6374 5f6d 6173 6b20       punct_mask 
+0001a310: 3d20 5574 696c 2e6d 616b 655f 7472 616e  = Util.make_tran
+0001a320: 736c 6174 655f 6d61 736b 5f74 6f5f 6368  slate_mask_to_ch
+0001a330: 6172 286f 7269 672c 2072 6570 290a 2020  ar(orig, rep).  
+0001a340: 2020 2020 2020 2020 2020 666f 7220 692c            for i,
+0001a350: 2063 6869 6c64 5f64 6976 2069 6e20 656e   child_div in en
+0001a360: 756d 6572 6174 6528 6465 6369 6d61 6c5f  umerate(decimal_
+0001a370: 6469 7673 293a 0a20 2020 2020 2020 2020  divs):.         
+0001a380: 2020 2020 2020 2063 6c73 2e63 7265 6174         cls.creat
+0001a390: 655f 6669 6c65 6e61 6d65 5f72 656d 6f76  e_filename_remov
+0001a3a0: 655f 7075 6e63 745f 616e 645f 6f75 7470  e_punct_and_outp
+0001a3b0: 7574 2863 6869 6c64 5f64 6976 2c20 6f75  ut(child_div, ou
+0001a3c0: 7470 7574 5f64 6972 2c20 7075 6e63 745f  tput_dir, punct_
+0001a3d0: 6d61 736b 290a 0a20 2020 2023 2063 6c61  mask)..    # cla
+0001a3e0: 7373 2048 746d 6c54 7265 650a 0a20 2020  ss HtmlTree..   
+0001a3f0: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+0001a400: 2020 6465 6620 6372 6561 7465 5f66 696c    def create_fil
+0001a410: 656e 616d 655f 7265 6d6f 7665 5f70 756e  ename_remove_pun
+0001a420: 6374 5f61 6e64 5f6f 7574 7075 7428 636c  ct_and_output(cl
+0001a430: 732c 2063 6869 6c64 5f64 6976 2c20 6f75  s, child_div, ou
+0001a440: 7470 7574 5f64 6972 2c20 7075 6e63 745f  tput_dir, punct_
+0001a450: 6d61 736b 293a 0a20 2020 2020 2020 2022  mask):.        "
+0001a460: 2222 6e6f 7420 7375 7265 2077 6861 7420  ""not sure what 
+0001a470: 7468 6973 2064 6f65 7320 3f48 746d 6c55  this does ?HtmlU
+0001a480: 7469 6c2e 4d41 524b 4552 2022 2222 0a20  til.MARKER """. 
+0001a490: 2020 2020 2020 2069 6620 4874 6d6c 5574         if HtmlUt
+0001a4a0: 696c 2e4d 4152 4b45 5220 696e 2063 6869  il.MARKER in chi
+0001a4b0: 6c64 5f64 6976 2e61 7474 7269 623a 0a20  ld_div.attrib:. 
+0001a4c0: 2020 2020 2020 2020 2020 206d 6172 6b65             marke
+0001a4d0: 7220 3d20 6368 696c 645f 6469 762e 6174  r = child_div.at
+0001a4e0: 7472 6962 5b48 746d 6c55 7469 6c2e 4d41  trib[HtmlUtil.MA
+0001a4f0: 524b 4552 5d0a 2020 2020 2020 2020 2020  RKER].          
+0001a500: 2020 6d61 726b 6572 203d 206d 6172 6b65    marker = marke
+0001a510: 722e 7374 7269 7028 292e 6c6f 7765 7228  r.strip().lower(
+0001a520: 2920 2023 206e 616d 6520 6672 6f6d 2074  )  # name from t
+0001a530: 6578 7420 636f 6e74 656e 740a 2020 2020  ext content.    
+0001a540: 2020 2020 2020 2020 6d61 726b 6572 2e74          marker.t
+0001a550: 7261 6e73 6c61 7465 2870 756e 6374 5f6d  ranslate(punct_m
+0001a560: 6173 6b29 0a20 2020 2020 2020 2020 2020  ask).           
+0001a570: 2070 6174 6820 3d20 5061 7468 286f 7574   path = Path(out
+0001a580: 7075 745f 6469 722c 2066 227b 6d61 726b  put_dir, f"{mark
+0001a590: 6572 7d2e 6874 6d6c 2229 0a20 2020 2020  er}.html").     
+0001a5a0: 2020 2020 2020 2077 6974 6820 6f70 656e         with open
+0001a5b0: 2870 6174 682c 2022 7762 2229 2061 7320  (path, "wb") as 
+0001a5c0: 663a 0a20 2020 2020 2020 2020 2020 2020  f:.             
+0001a5d0: 2020 2066 2e77 7269 7465 2845 542e 746f     f.write(ET.to
+0001a5e0: 7374 7269 6e67 2863 6869 6c64 5f64 6976  string(child_div
+0001a5f0: 2c20 7072 6574 7479 5f70 7269 6e74 3d54  , pretty_print=T
+0001a600: 7275 6529 290a 0a20 2020 2023 2063 6c61  rue))..    # cla
+0001a610: 7373 2048 746d 6c54 7265 650a 0a20 2020  ss HtmlTree..   
+0001a620: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+0001a630: 2020 6465 6620 6765 745f 6469 765f 7370    def get_div_sp
+0001a640: 616e 5f73 7461 7274 696e 675f 7769 7468  an_starting_with
+0001a650: 2863 6c73 2c20 656c 656d 2c20 7374 7267  (cls, elem, strg
+0001a660: 2c20 6973 5f62 6f6c 643d 4661 6c73 652c  , is_bold=False,
+0001a670: 2066 6f6e 745f 7369 7a65 5f72 616e 6765   font_size_range
+0001a680: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+0001a690: 7265 7375 6c74 203d 204e 6f6e 650a 2020  result = None.  
+0001a6a0: 2020 2020 2020 7870 6174 6820 3d20 6622        xpath = f"
+0001a6b0: 2e2f 2f64 6976 5b73 7061 6e5b 7374 6172  .//div[span[star
+0001a6c0: 7473 2d77 6974 6828 2e2c 277b 7374 7267  ts-with(.,'{strg
+0001a6d0: 7d27 295d 5d22 0a20 2020 2020 2020 2064  }')]]".        d
+0001a6e0: 6976 7320 3d20 656c 656d 2e78 7061 7468  ivs = elem.xpath
+0001a6f0: 2878 7061 7468 290a 2020 2020 2020 2020  (xpath).        
+0001a700: 6966 206c 656e 2864 6976 7329 203d 3d20  if len(divs) == 
+0001a710: 303a 0a20 2020 2020 2020 2020 2020 206c  0:.            l
+0001a720: 6f67 6769 6e67 2e77 6172 6e69 6e67 2866  ogging.warning(f
+0001a730: 224e 6f20 6469 7673 2077 6974 6820 7b73  "No divs with {s
+0001a740: 7472 677d 2229 0a20 2020 2020 2020 2020  trg}").         
+0001a750: 2020 2072 6574 7572 6e20 7265 7375 6c74     return result
+0001a760: 2c20 4e6f 6e65 0a20 2020 2020 2020 206e  , None.        n
+0001a770: 6577 5f64 6976 7320 3d20 5b5d 0a20 2020  ew_divs = [].   
+0001a780: 2020 2020 2066 6f72 2064 6976 2069 6e20       for div in 
+0001a790: 6469 7673 3a0a 2020 2020 2020 2020 2020  divs:.          
+0001a7a0: 2020 7370 616e 7320 3d20 6469 762e 7870    spans = div.xp
+0001a7b0: 6174 6828 222e 2f73 7061 6e22 290a 2020  ath("./span").  
+0001a7c0: 2020 2020 2020 2020 2020 6966 2073 7061            if spa
+0001a7d0: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
+0001a7e0: 2020 2020 6373 735f 7374 796c 6520 3d20      css_style = 
+0001a7f0: 4353 5353 7479 6c65 2e63 7265 6174 655f  CSSStyle.create_
+0001a800: 6373 735f 7374 796c 655f 6672 6f6d 5f61  css_style_from_a
+0001a810: 7474 7269 6275 7465 5f6f 665f 626f 6479  ttribute_of_body
+0001a820: 5f65 6c65 6d65 6e74 2873 7061 6e73 5b30  _element(spans[0
+0001a830: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+0001a840: 2020 2069 6620 6e6f 7420 2869 735f 626f     if not (is_bo
+0001a850: 6c64 2061 6e64 2063 7373 5f73 7479 6c65  ld and css_style
+0001a860: 2e69 735f 626f 6c64 5f6e 616d 6528 2929  .is_bold_name())
+0001a870: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001a880: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
+0001a890: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001a8a0: 6620 6e6f 7420 2866 6f6e 745f 7369 7a65  f not (font_size
+0001a8b0: 5f72 616e 6765 2061 6e64 2063 6c73 2e69  _range and cls.i
+0001a8c0: 6e5f 7261 6e67 6528 6373 735f 7374 796c  n_range(css_styl
+0001a8d0: 652e 666f 6e74 5f73 697a 652c 2066 6f6e  e.font_size, fon
+0001a8e0: 745f 7369 7a65 5f72 616e 6765 2929 3a0a  t_size_range)):.
+0001a8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a900: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
+0001a910: 2020 2020 2020 2020 2020 2020 206e 6577               new
+0001a920: 5f64 6976 732e 6170 7065 6e64 2864 6976  _divs.append(div
+0001a930: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001a940: 2020 7061 7373 0a20 2020 2020 2020 2064    pass.        d
+0001a950: 6976 7320 3d20 6e65 775f 6469 7673 0a20  ivs = new_divs. 
+0001a960: 2020 2020 2020 2023 2061 6c73 6f20 7465         # also te
+0001a970: 7374 2066 6f6e 7420 6865 7265 204e 5949  st font here NYI
+0001a980: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+0001a990: 6469 7673 2920 3d3d 2030 3a0a 2020 2020  divs) == 0:.    
+0001a9a0: 2020 2020 2020 2020 6c6f 6767 696e 672e          logging.
+0001a9b0: 7761 726e 696e 6728 6622 6361 6e6e 6f74  warning(f"cannot
+0001a9c0: 2066 696e 6420 6469 763a 206c 656e 3d7b   find div: len={
+0001a9d0: 6c65 6e28 6469 7673 297d 2229 0a20 2020  len(divs)}").   
+0001a9e0: 2020 2020 2065 6c69 6620 6c65 6e28 6469       elif len(di
+0001a9f0: 7673 2920 3e20 313a 0a20 2020 2020 2020  vs) > 1:.       
+0001aa00: 2020 2020 206c 6f67 6769 6e67 2e77 6172       logging.war
+0001aa10: 6e69 6e67 2866 2274 6f6f 206d 616e 7920  ning(f"too many 
+0001aa20: 6469 7673 3a20 6c65 6e3d 7b6c 656e 2864  divs: len={len(d
+0001aa30: 6976 7329 7d22 290a 2020 2020 2020 2020  ivs)}").        
+0001aa40: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0001aa50: 2020 7265 7375 6c74 203d 2064 6976 735b    result = divs[
+0001aa60: 305d 0a20 2020 2020 2020 2020 2020 2072  0].            r
+0001aa70: 6573 756c 742e 6174 7472 6962 5b22 6d61  esult.attrib["ma
+0001aa80: 726b 6572 225d 203d 2073 7472 670a 2020  rker"] = strg.  
+0001aa90: 2020 2020 2020 7265 7475 726e 2072 6573        return res
+0001aaa0: 756c 742c 2064 6976 730a 0a20 2020 2023  ult, divs..    #
+0001aab0: 2063 6c61 7373 2048 746d 6c54 7265 650a   class HtmlTree.
+0001aac0: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+0001aad0: 640a 2020 2020 6465 6620 6765 745f 6469  d.    def get_di
+0001aae0: 765f 7370 616e 735f 7769 7468 5f64 6563  v_spans_with_dec
+0001aaf0: 696d 616c 7328 636c 732c 2065 6c65 6d2c  imals(cls, elem,
+0001ab00: 2069 735f 626f 6c64 3d4e 6f6e 652c 2066   is_bold=None, f
+0001ab10: 6f6e 745f 7369 7a65 5f72 616e 6765 3d4e  ont_size_range=N
+0001ab20: 6f6e 652c 2063 6c61 7373 5f64 6963 743d  one, class_dict=
+0001ab30: 4e6f 6e65 2c20 7365 6374 696f 6e5f 7265  None, section_re
+0001ab40: 633d 4e6f 6e65 293a 0a20 2020 2020 2020  c=None):.       
+0001ab50: 2022 2222 4d61 7463 6865 7320 6469 762f   """Matches div/
+0001ab60: 7370 616e 2073 7461 7274 696e 6720 7769  span starting wi
+0001ab70: 7468 2061 2064 6563 696d 616c 2069 6e64  th a decimal ind
+0001ab80: 6578 0a20 2020 2020 2020 2064 2e64 206f  ex.        d.d o
+0001ab90: 7220 642e 642e 640a 2020 2020 2020 2020  r d.d.d.        
+0001aba0: 2222 220a 2020 2020 2020 2020 7265 7375  """.        resu
+0001abb0: 6c74 203d 204e 6f6e 650a 2020 2020 2020  lt = None.      
+0001abc0: 2020 2320 6669 7273 7420 6164 6420 616c    # first add al
+0001abd0: 6c20 6d61 7463 6869 6e67 206e 756d 6265  l matching numbe
+0001abe0: 7265 6420 6469 7673 2074 6f20 7072 655f  red divs to pre_
+0001abf0: 6368 6170 7365 630a 2020 2020 2020 2020  chapsec.        
+0001ac00: 6966 206e 6f74 2063 6c61 7373 5f64 6963  if not class_dic
+0001ac10: 743a 0a20 2020 2020 2020 2020 2020 2072  t:.            r
+0001ac20: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+0001ac30: 6622 6d69 7373 696e 6720 636c 6173 735f  f"missing class_
+0001ac40: 6469 6374 2229 0a20 2020 2020 2020 2074  dict").        t
+0001ac50: 6f70 5f64 6976 203d 2045 542e 5375 6245  op_div = ET.SubE
+0001ac60: 6c65 6d65 6e74 2865 6c65 6d2c 2048 5f44  lement(elem, H_D
+0001ac70: 4956 290a 2020 2020 2020 2020 746f 705f  IV).        top_
+0001ac80: 6469 762e 6174 7472 6962 5b63 6c73 2e43  div.attrib[cls.C
+0001ac90: 4c41 5353 5d20 3d20 636c 6173 735f 6469  LASS] = class_di
+0001aca0: 6374 2e67 6574 2848 746d 6c54 7265 652e  ct.get(HtmlTree.
+0001acb0: 544f 505f 4449 5629 0a20 2020 2020 2020  TOP_DIV).       
+0001acc0: 2070 7265 5f63 6861 7073 6563 203d 2045   pre_chapsec = E
+0001acd0: 542e 5375 6245 6c65 6d65 6e74 2874 6f70  T.SubElement(top
+0001ace0: 5f64 6976 2c20 485f 4449 5629 0a20 2020  _div, H_DIV).   
+0001acf0: 2020 2020 2070 7265 5f63 6861 7073 6563       pre_chapsec
+0001ad00: 2e61 7474 7269 625b 636c 732e 434c 4153  .attrib[cls.CLAS
+0001ad10: 535d 203d 2063 6c61 7373 5f64 6963 742e  S] = class_dict.
+0001ad20: 6765 7428 4874 6d6c 5472 6565 2e43 4841  get(HtmlTree.CHA
+0001ad30: 5053 4543 290a 2020 2020 2020 2020 6375  PSEC).        cu
+0001ad40: 7272 656e 745f 6469 7620 3d20 7072 655f  rrent_div = pre_
+0001ad50: 6368 6170 7365 630a 0a20 2020 2020 2020  chapsec..       
+0001ad60: 2023 2069 7465 7261 7465 206f 7665 7220   # iterate over 
+0001ad70: 616c 6c20 6469 7673 2c20 6f6e 6c79 2061  all divs, only a
+0001ad80: 7070 656e 6420 7468 6f73 6520 7769 7468  ppend those with
+0001ad90: 2064 6563 696d 616c 0a20 2020 2020 2020   decimal.       
+0001ada0: 2064 6976 7320 3d20 656c 656d 2e78 7061   divs = elem.xpa
+0001adb0: 7468 2863 6c73 2e41 4c4c 5f44 4956 5f58  th(cls.ALL_DIV_X
+0001adc0: 5041 5448 5329 0a20 2020 2020 2020 2064  PATHS).        d
+0001add0: 6563 696d 616c 5f63 6f75 6e74 203d 2030  ecimal_count = 0
+0001ade0: 0a20 2020 2020 2020 2074 6578 7473 203d  .        texts =
+0001adf0: 205b 5d20 2023 206a 7573 7420 6120 6368   []  # just a ch
+0001ae00: 6563 6b20 6174 2070 7265 7365 6e74 0a20  eck at present. 
+0001ae10: 2020 2020 2020 2066 6f72 2064 6976 2069         for div i
+0001ae20: 6e20 6469 7673 3a0a 2020 2020 2020 2020  n divs:.        
+0001ae30: 2020 2020 7370 616e 7320 3d20 6469 762e      spans = div.
+0001ae40: 7870 6174 6828 222e 2f73 7061 6e22 290a  xpath("./span").
+0001ae50: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0001ae60: 6f74 2073 7061 6e73 3a0a 2020 2020 2020  ot spans:.      
+0001ae70: 2020 2020 2020 2020 2020 2320 6e6f 2073            # no s
+0001ae80: 7061 6e73 2c20 636f 6e63 6174 656e 6174  pans, concatenat
+0001ae90: 6520 7769 7468 2073 6962 6c69 6e67 730a  e with siblings.
+0001aea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aeb0: 6966 2064 6976 203d 3d20 6375 7272 656e  if div == curren
+0001aec0: 745f 6469 763a 0a20 2020 2020 2020 2020  t_div:.         
+0001aed0: 2020 2020 2020 2020 2020 206c 6f67 6769             loggi
+0001aee0: 6e67 2e77 6172 6e69 6e67 2822 6620 6361  ng.warning("f ca
+0001aef0: 6e6e 6f74 2061 7070 656e 6420 6469 7620  nnot append div 
+0001af00: 7b64 6976 7d20 746f 2069 7473 656c 6622  {div} to itself"
+0001af10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001af20: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001af30: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+0001af40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001af50: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+0001af60: 5f64 6976 2e61 7070 656e 6428 6469 7629  _div.append(div)
+0001af70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001af80: 2020 2020 2065 7863 6570 7420 5661 6c75       except Valu
+0001af90: 6545 7272 6f72 2061 7320 7665 3a0a 2020  eError as ve:.  
+0001afa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001afb0: 2020 2020 2020 6c6f 6767 696e 672e 6572        logging.er
+0001afc0: 726f 7228 6622 4572 726f 7220 7b76 657d  ror(f"Error {ve}
+0001afd0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0001afe0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0001aff0: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+0001b000: 656e 745f 6469 762e 6170 7065 6e64 2864  ent_div.append(d
+0001b010: 6976 290a 2020 2020 2020 2020 2020 2020  iv).            
+0001b020: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+0001b030: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
+0001b040: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0001b050: 6f67 6769 6e67 2e65 7272 6f72 2866 2242  ogging.error(f"B
+0001b060: 5547 2073 6b69 7070 6564 2229 0a20 2020  UG skipped").   
+0001b070: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0001b080: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
+0001b090: 2020 6373 735f 7374 796c 6520 3d20 4353    css_style = CS
+0001b0a0: 5353 7479 6c65 2e63 7265 6174 655f 6373  SStyle.create_cs
+0001b0b0: 735f 7374 796c 655f 6672 6f6d 5f61 7474  s_style_from_att
+0001b0c0: 7269 6275 7465 5f6f 665f 626f 6479 5f65  ribute_of_body_e
+0001b0d0: 6c65 6d65 6e74 2873 7061 6e73 5b30 5d29  lement(spans[0])
+0001b0e0: 2020 2320 6e6f 726d 616c 6c79 2063 6f6d    # normally com
+0001b0f0: 6573 2066 6972 7374 0a20 2020 2020 2020  es first.       
+0001b100: 2020 2020 2023 2063 6865 636b 2077 6569       # check wei
+0001b110: 6768 742c 2069 6620 6e6f 6e65 2061 7070  ght, if none app
+0001b120: 656e 6420 746f 2073 6962 6c69 6e67 730a  end to siblings.
+0001b130: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0001b140: 6f74 2028 6973 5f62 6f6c 6420 616e 6420  ot (is_bold and 
+0001b150: 6373 735f 7374 796c 652e 6973 5f62 6f6c  css_style.is_bol
+0001b160: 645f 6e61 6d65 2829 293a 0a20 2020 2020  d_name()):.     
+0001b170: 2020 2020 2020 2020 2020 2063 7572 7265             curre
+0001b180: 6e74 5f64 6976 2e61 7070 656e 6428 6469  nt_div.append(di
+0001b190: 7629 0a20 2020 2020 2020 2020 2020 2020  v).             
+0001b1a0: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
+0001b1b0: 2020 2020 2020 2020 2320 6368 6563 6b20          # check 
+0001b1c0: 666f 6e74 2d73 697a 652c 2069 6620 6e6f  font-size, if no
+0001b1d0: 6e65 2061 7070 656e 6420 746f 2073 6962  ne append to sib
+0001b1e0: 6c69 6e67 730a 2020 2020 2020 2020 2020  lings.          
+0001b1f0: 2020 6966 206e 6f74 2028 666f 6e74 5f73    if not (font_s
+0001b200: 697a 655f 7261 6e67 6520 616e 6420 636c  ize_range and cl
+0001b210: 732e 696e 5f72 616e 6765 2863 7373 5f73  s.in_range(css_s
+0001b220: 7479 6c65 2e66 6f6e 745f 7369 7a65 2c20  tyle.font_size, 
+0001b230: 666f 6e74 5f73 697a 655f 7261 6e67 6529  font_size_range)
+0001b240: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001b250: 2020 2063 7572 7265 6e74 5f64 6976 2e61     current_div.a
+0001b260: 7070 656e 6428 6469 7629 0a20 2020 2020  ppend(div).     
+0001b270: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+0001b280: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
+0001b290: 2320 7370 616e 2063 6f6e 7465 6e74 0a20  # span content. 
+0001b2a0: 2020 2020 2020 2020 2020 2074 6578 7420             text 
+0001b2b0: 3d20 4874 6d6c 5574 696c 2e67 6574 5f74  = HtmlUtil.get_t
+0001b2c0: 6578 745f 636f 6e74 656e 7428 7370 616e  ext_content(span
+0001b2d0: 735b 305d 290a 2020 2020 2020 2020 2020  s[0]).          
+0001b2e0: 2020 6d61 7463 6865 6420 3d20 4661 6c73    matched = Fals
+0001b2f0: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
+0001b300: 2073 6563 7469 6f6e 5f72 6563 2e6d 6174   section_rec.mat
+0001b310: 6368 2874 6578 7429 3a0a 2020 2020 2020  ch(text):.      
+0001b320: 2020 2020 2020 2020 2020 746f 705f 6469            top_di
+0001b330: 762e 6170 7065 6e64 2863 7572 7265 6e74  v.append(current
+0001b340: 5f64 6976 290a 2020 2020 2020 2020 2020  _div).          
+0001b350: 2020 2020 2020 7465 7874 732e 6170 7065        texts.appe
+0001b360: 6e64 2874 6578 7429 0a20 2020 2020 2020  nd(text).       
+0001b370: 2020 2020 2020 2020 2064 6976 2e61 7474           div.att
+0001b380: 7269 625b 4874 6d6c 5574 696c 2e4d 4152  rib[HtmlUtil.MAR
+0001b390: 4b45 525d 203d 2074 6578 740a 2020 2020  KER] = text.    
+0001b3a0: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+0001b3b0: 656e 745f 6469 7620 3d20 6469 760a 2020  ent_div = div.  
+0001b3c0: 2020 2020 2020 2020 2020 2020 2020 6465                de
+0001b3d0: 6369 6d61 6c5f 636f 756e 7420 2b3d 2031  cimal_count += 1
+0001b3e0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+0001b3f0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001b400: 2020 2063 7572 7265 6e74 5f64 6976 2e61     current_div.a
+0001b410: 7070 656e 6428 6469 7629 0a20 2020 2020  ppend(div).     
+0001b420: 2020 2072 6574 7572 6e20 746f 705f 6469     return top_di
+0001b430: 760a 0a20 2020 2023 2063 6c61 7373 2048  v..    # class H
+0001b440: 746d 6c54 7265 650a 0a20 2020 2040 636c  tmlTree..    @cl
+0001b450: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+0001b460: 6620 696e 5f72 616e 6765 2863 6c73 2c20  f in_range(cls, 
+0001b470: 6e75 6d2c 206e 756d 5f72 616e 6765 293a  num, num_range):
+0001b480: 0a20 2020 2020 2020 2022 2222 6973 2061  .        """is a
+0001b490: 206e 756d 6265 7220 696e 2061 206e 756d   number in a num
+0001b4a0: 6572 6963 2072 616e 6765 2222 220a 2020  eric range""".  
+0001b4b0: 2020 2020 2020 6173 7365 7274 206e 756d        assert num
+0001b4c0: 5f72 616e 6765 206f 7220 6c65 6e28 6e75  _range or len(nu
+0001b4d0: 6d5f 7261 6e67 6529 203d 3d20 322c 2066  m_range) == 2, f
+0001b4e0: 2272 616e 6765 206d 7573 7420 6861 7665  "range must have
+0001b4f0: 2032 2065 6c65 6d65 6e74 7322 0a20 2020   2 elements".   
+0001b500: 2020 2020 2061 7373 6572 7420 6e75 6d5f       assert num_
+0001b510: 7261 6e67 655b 305d 203c 3d20 6e75 6d5f  range[0] <= num_
+0001b520: 7261 6e67 655b 315d 2c20 6622 666f 6e74  range[1], f"font
+0001b530: 5f73 697a 655f 7261 6e67 6520 6d75 7374  _size_range must
+0001b540: 2062 6520 286c 6f77 6572 2c68 6967 6865   be (lower,highe
+0001b550: 7229 220a 2020 2020 2020 2020 6173 7365  r)".        asse
+0001b560: 7274 2066 6c6f 6174 286e 756d 5f72 616e  rt float(num_ran
+0001b570: 6765 5b30 5d29 0a20 2020 2020 2020 2072  ge[0]).        r
+0001b580: 6573 756c 7420 3d20 6e75 6d5f 7261 6e67  esult = num_rang
+0001b590: 655b 305d 203c 3d20 6e75 6d20 3c3d 206e  e[0] <= num <= n
+0001b5a0: 756d 5f72 616e 6765 5b31 5d0a 2020 2020  um_range[1].    
+0001b5b0: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
+0001b5c0: 740a 0a20 2020 2023 2063 6c61 7373 2048  t..    # class H
+0001b5d0: 746d 6c54 7265 650a 0a20 2020 2040 636c  tmlTree..    @cl
+0001b5e0: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+0001b5f0: 6620 6765 745f 6465 6369 6d61 6c5f 7365  f get_decimal_se
+0001b600: 6374 696f 6e73 2863 6c73 2c20 6874 6d6c  ctions(cls, html
+0001b610: 5f65 6c65 6d2c 2078 7061 7468 3d4e 6f6e  _elem, xpath=Non
+0001b620: 652c 2072 6567 6578 3d4e 6f6e 6529 3a0a  e, regex=None):.
+0001b630: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001b640: 2020 2020 6765 7473 2064 6563 696d 616c      gets decimal
+0001b650: 2073 6563 7469 6f6e 7320 696e 2065 6c65   sections in ele
+0001b660: 6d73 206f 6620 666f 726d 2031 2e32 2c20  ms of form 1.2, 
+0001b670: 6574 630a 2020 2020 2020 2020 3a70 6172  etc.        :par
+0001b680: 616d 2068 746d 6c5f 656c 656d 3a20 656c  am html_elem: el
+0001b690: 656d 656e 7420 746f 2073 6561 7263 6820  ement to search 
+0001b6a0: 666f 7220 7365 6374 696f 6e73 0a20 2020  for sections.   
+0001b6b0: 2020 2020 203a 7061 7261 6d20 7870 6174       :param xpat
+0001b6c0: 683a 2073 6563 7469 6e73 206d 6179 2068  h: sectins may h
+0001b6d0: 6176 6520 6265 656e 206c 6162 656c 6c65  ave been labelle
+0001b6e0: 6420 7769 7468 2040 636c 6173 7320 6f72  d with @class or
+0001b6f0: 2073 696d 696c 6172 0a20 2020 2020 2020   similar.       
+0001b700: 203a 7061 7261 6d20 7265 6765 783a 2073   :param regex: s
+0001b710: 6563 7469 6f6e 7320 6d61 7920 6265 2064  ections may be d
+0001b720: 6973 636f 7665 7261 626c 6520 6279 2072  iscoverable by r
+0001b730: 6567 6578 2b63 6f6e 7465 6e74 0a20 2020  egex+content.   
+0001b740: 2020 2020 203a 7265 7475 726e 3a20 6c69       :return: li
+0001b750: 7374 206f 6620 7365 6374 696f 6e73 2028  st of sections (
+0001b760: 6d61 7920 6265 2065 6d70 7479 2920 6f72  may be empty) or
+0001b770: 204e 6f6e 650a 2020 2020 2020 2020 4974   None.        It
+0001b780: 2069 7320 6c69 6b65 6c79 2074 6861 7420   is likely that 
+0001b790: 6120 636f 6d62 696e 6174 696f 6e20 6f66  a combination of
+0001b7a0: 2078 7061 7468 2061 6e64 2072 6567 6578   xpath and regex
+0001b7b0: 2077 696c 6c20 6265 2075 7365 6420 6173   will be used as
+0001b7c0: 2078 7061 7468 0a20 2020 2020 2020 206d   xpath.        m
+0001b7d0: 6179 206e 6f74 2068 6176 6520 7265 6765  ay not have rege
+0001b7e0: 780a 2020 2020 2020 2020 2222 220a 2020  x.        """.  
+0001b7f0: 2020 2020 2020 6966 2068 746d 6c5f 656c        if html_el
+0001b800: 656d 2069 7320 4e6f 6e65 3a0a 2020 2020  em is None:.    
+0001b810: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+0001b820: 6f6e 650a 2020 2020 2020 2020 7365 6374  one.        sect
+0001b830: 696f 6e73 203d 205b 5d0a 2020 2020 2020  ions = [].      
+0001b840: 2020 6966 2078 7061 7468 3a0a 2020 2020    if xpath:.    
+0001b850: 2020 2020 2020 2020 7365 6374 696f 6e73          sections
+0001b860: 203d 2068 746d 6c5f 656c 656d 2e78 7061   = html_elem.xpa
+0001b870: 7468 2878 7061 7468 290a 2020 2020 2020  th(xpath).      
+0001b880: 2020 6966 2072 6567 6578 3a0a 2020 2020    if regex:.    
+0001b890: 2020 2020 2020 2020 6c6f 6767 696e 672e          logging.
+0001b8a0: 7761 726e 696e 6728 6622 7265 6765 7820  warning(f"regex 
+0001b8b0: 6e6f 7420 7965 7420 6465 7665 6c6f 7065  not yet develope
+0001b8c0: 6420 666f 7220 7365 6374 696f 6e73 2229  d for sections")
+0001b8d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001b8e0: 7365 6374 696f 6e73 0a0a 0a52 4543 535f  sections...RECS_
+0001b8f0: 4259 5f53 4543 5449 4f4e 203d 207b 0a20  BY_SECTION = {. 
+0001b900: 2020 2023 2048 746d 6c54 7265 652e 4348     # HtmlTree.CH
+0001b910: 4150 5f54 4f50 3a20 4950 4343 5f43 4841  AP_TOP: IPCC_CHA
+0001b920: 505f 544f 505f 5245 432c 2023 2073 686f  P_TOP_REC, # sho
+0001b930: 756c 6420 6265 2069 6e6a 6563 7465 6420  uld be injected 
+0001b940: 6279 2075 7365 720a 2020 2020 4874 6d6c  by user.    Html
+0001b950: 5472 6565 2e43 4841 505f 544f 503a 2043  Tree.CHAP_TOP: C
+0001b960: 4841 505f 544f 505f 5245 432c 2023 2073  HAP_TOP_REC, # s
+0001b970: 686f 756c 6420 6265 2069 6e6a 6563 7465  hould be injecte
+0001b980: 6420 6279 2075 7365 720a 2020 2020 4874  d by user.    Ht
+0001b990: 6d6c 5472 6565 2e43 4841 505f 5345 4354  mlTree.CHAP_SECT
+0001b9a0: 494f 4e53 3a20 5345 4354 494f 4e53 5f44  IONS: SECTIONS_D
+0001b9b0: 4543 494d 414c 5f52 4543 2c0a 2020 2020  ECIMAL_REC,.    
+0001b9c0: 4874 6d6c 5472 6565 2e43 4841 505f 5355  HtmlTree.CHAP_SU
+0001b9d0: 4253 4543 5453 3a20 5355 4253 4543 5453  BSECTS: SUBSECTS
+0001b9e0: 5f44 4543 494d 414c 5f52 4543 2c0a 7d0a  _DECIMAL_REC,.}.
+0001b9f0: 0a0a 636c 6173 7320 4854 4d4c 5365 6172  ..class HTMLSear
+0001ba00: 6368 6572 3a0a 2020 2020 2222 220a 2020  cher:.    """.  
+0001ba10: 2020 4920 7468 696e 6b20 7468 6973 2064    I think this d
+0001ba20: 7570 6c69 6361 7465 7320 736f 6d65 206f  uplicates some o
+0001ba30: 6620 4e6f 6465 4578 7472 6163 746f 722e  f NodeExtractor.
+0001ba40: 0a20 2020 2022 2222 0a20 2020 2022 2222  .    """.    """
+0001ba50: 0a20 2020 206d 6574 686f 6473 2066 6f72  .    methods for
+0001ba60: 2066 696e 6469 6e67 2063 6875 6e6b 7320   finding chunks 
+0001ba70: 616e 6420 7374 7269 6e67 7320 696e 2048  and strings in H
+0001ba80: 544d 4c20 656c 656d 656e 7473 0a0a 2020  TML elements..  
+0001ba90: 2020 4578 616d 706c 6520 7465 7874 3a0a    Example text:.
+0001baa0: 2020 2020 3c73 7061 6e3e 6f62 7365 7276      <span>observ
+0001bab0: 6564 2069 6e63 7265 6173 6573 2069 6e20  ed increases in 
+0001bac0: 7468 6520 6d6f 7374 2072 6563 656e 7420  the most recent 
+0001bad0: 7965 6172 7320 284d 696e 7820 6574 2061  years (Minx et a
+0001bae0: 6c2e 2c20 3230 3231 3b20 554e 4550 2c20  l., 2021; UNEP, 
+0001baf0: 3230 3230 6129 2e0a 2020 2020 3230 3139  2020a)..    2019
+0001bb00: 2047 4847 2065 6d69 7373 696f 6e73 206c   GHG emissions l
+0001bb10: 6576 656c 7320 7765 7265 2068 6967 6865  evels were highe
+0001bb20: 7220 636f 6d70 6172 6564 2074 6f20 3130  r compared to 10
+0001bb30: 2061 6e64 2033 3020 7965 6172 7320 6167   and 30 years ag
+0001bb40: 6f20 2868 6967 6820 636f 6e66 6964 656e  o (high confiden
+0001bb50: 6365 293a 2061 626f 7574 2031 3225 2028  ce): about 12% (
+0001bb60: 362e 3520 4774 434f 3265 7129 0a20 2020  6.5 GtCO2eq).   
+0001bb70: 2068 6967 6865 7220 7468 616e 2069 6e20   higher than in 
+0001bb80: 3230 3130 2028 3533 c2b1 352e 3720 4774  2010 (53..5.7 Gt
+0001bb90: 434f 3265 7129 2028 4152 3520 7265 6665  CO2eq) (AR5 refe
+0001bba0: 7265 6e63 6520 7965 6172 2920 616e 6420  rence year) and 
+0001bbb0: 6162 6f75 7420 3534 2520 2832 3120 4774  about 54% (21 Gt
+0001bbc0: 434f 3265 7129 2068 6967 6865 7220 7468  CO2eq) higher th
+0001bbd0: 616e 2069 6e20 3139 3930 0a20 2020 2028  an in 1990.    (
+0001bbe0: 3338 c2b1 342e 3820 4774 434f 3265 7129  38..4.8 GtCO2eq)
+0001bbf0: 2028 4b79 6f74 6f20 5072 6f74 6f63 6f6c   (Kyoto Protocol
+0001bc00: 2072 6566 6572 656e 6365 2079 6561 7220   reference year 
+0001bc10: 616e 6420 6672 6571 7565 6e74 204e 4443  and frequent NDC
+0001bc20: 2072 6566 6572 656e 6365 293c 2f73 7061   reference)</spa
+0001bc30: 6e3e 0a20 2020 2022 2222 0a20 2020 2022  n>.    """.    "
+0001bc40: 2222 0a20 2020 2022 2222 0a0a 2020 2020  "".    """..    
+0001bc50: 2320 666f 7220 7465 7874 2073 6561 7263  # for text searc
+0001bc60: 680a 2020 2020 4445 4641 554c 545f 5850  h.    DEFAULT_XP
+0001bc70: 4154 4820 3d20 222f 2f74 6578 7428 2922  ATH = "//text()"
+0001bc80: 0a20 2020 2043 4855 4e4b 5f52 4520 3d20  .    CHUNK_RE = 
+0001bc90: 2263 6875 6e6b 5f72 6522 2020 2320 6669  "chunk_re"  # fi
+0001bca0: 6e64 7320 7465 7874 2063 6875 6e6b 7320  nds text chunks 
+0001bcb0: 696e 2074 6578 740a 2020 2020 5350 4c49  in text.    SPLI
+0001bcc0: 5454 4552 5f52 4520 3d20 2273 706c 6974  TTER_RE = "split
+0001bcd0: 7465 725f 7265 2220 2023 2073 706c 6974  ter_re"  # split
+0001bce0: 7320 7468 6f73 6520 6368 756e 6b73 2028  s those chunks (
+0001bcf0: 652c 672c 2063 6f6d 6d61 2d73 6570 6172  e,g, comma-separ
+0001bd00: 6174 6564 206c 6973 7473 0a20 2020 2053  ated lists.    S
+0001bd10: 5542 4e4f 4445 5f52 4520 3d20 2273 7562  UBNODE_RE = "sub
+0001bd20: 5f6e 6f64 655f 7265 5f6c 6973 7422 2020  _node_re_list"  
+0001bd30: 2320 6d61 7463 6865 7320 7468 6520 636f  # matches the co
+0001bd40: 6d70 6f6e 656e 7473 206f 6620 7468 6520  mponents of the 
+0001bd50: 7370 6c69 7420 6c69 7374 730a 2020 2020  split lists.    
+0001bd60: 554e 4d41 5443 4845 4420 3d20 2275 6e6d  UNMATCHED = "unm
+0001bd70: 6174 6368 6564 2220 2023 2061 6464 7320  atched"  # adds 
+0001bd80: 756e 6d61 7463 6865 6420 6e6f 6465 730a  unmatched nodes.
+0001bd90: 2020 2020 5850 4154 4820 3d20 2278 7061      XPATH = "xpa
+0001bda0: 7468 220a 0a20 2020 2064 6566 205f 5f69  th"..    def __i
+0001bdb0: 6e69 745f 5f28 7365 6c66 2c20 7870 6174  nit__(self, xpat
+0001bdc0: 685f 6469 6374 3d4e 6f6e 652c 2064 6963  h_dict=None, dic
+0001bdd0: 7478 3d4e 6f6e 6529 3a0a 2020 2020 2020  tx=None):.      
+0001bde0: 2020 7365 6c66 2e63 6875 6e6b 5f6e 6f64    self.chunk_nod
+0001bdf0: 655f 6469 6374 203d 2064 6963 7428 290a  e_dict = dict().
+0001be00: 2020 2020 2020 2020 7365 6c66 2e78 7061          self.xpa
+0001be10: 7468 5f64 6963 7420 3d20 6469 6374 2829  th_dict = dict()
+0001be20: 2069 6620 7870 6174 685f 6469 6374 2069   if xpath_dict i
+0001be30: 7320 4e6f 6e65 2065 6c73 6520 636f 7079  s None else copy
+0001be40: 2e64 6565 7063 6f70 7928 7870 6174 685f  .deepcopy(xpath_
+0001be50: 6469 6374 290a 2020 2020 2020 2020 7365  dict).        se
+0001be60: 6c66 2e63 6875 6e6b 5f64 6963 7420 3d20  lf.chunk_dict = 
+0001be70: 6469 6374 2829 0a20 2020 2020 2020 2073  dict().        s
+0001be80: 656c 662e 7370 6c69 7474 6572 5f64 6963  elf.splitter_dic
+0001be90: 7420 3d20 6469 6374 2829 0a20 2020 2020  t = dict().     
+0001bea0: 2020 2073 656c 662e 7375 626e 6f64 655f     self.subnode_
+0001beb0: 6469 6374 203d 2064 6963 7428 290a 2020  dict = dict().  
+0001bec0: 2020 2020 2020 7365 6c66 2e64 6963 7478        self.dictx
+0001bed0: 203d 2064 6963 7428 2920 6966 2064 6963   = dict() if dic
+0001bee0: 7478 2069 7320 4e6f 6e65 2065 6c73 6520  tx is None else 
+0001bef0: 636f 7079 2e64 6565 7063 6f70 7928 6469  copy.deepcopy(di
+0001bf00: 6374 7829 0a0a 2020 2020 6465 6620 7365  ctx)..    def se
+0001bf10: 6172 6368 5f70 6174 685f 6368 756e 6b5f  arch_path_chunk_
+0001bf20: 6e6f 6465 2873 656c 662c 2068 746d 6c5f  node(self, html_
+0001bf30: 7061 7468 293a 0a20 2020 2020 2020 2061  path):.        a
+0001bf40: 7373 6572 7420 6874 6d6c 5f70 6174 682e  ssert html_path.
+0001bf50: 6578 6973 7473 2829 2c20 6622 7b68 746d  exists(), f"{htm
+0001bf60: 6c5f 7061 7468 7d20 7368 6f75 6c64 2065  l_path} should e
+0001bf70: 7869 7374 220a 2020 2020 2020 2020 7472  xist".        tr
+0001bf80: 6565 203d 2045 542e 7061 7273 6528 7374  ee = ET.parse(st
+0001bf90: 7228 6874 6d6c 5f70 6174 6829 290a 0a20  r(html_path)).. 
+0001bfa0: 2020 2020 2020 2073 656c 662e 7870 6174         self.xpat
+0001bfb0: 6873 203d 2073 656c 662e 7870 6174 685f  hs = self.xpath_
+0001bfc0: 6469 6374 2e67 6574 2873 656c 662e 5850  dict.get(self.XP
+0001bfd0: 4154 4829 0a20 2020 2020 2020 2069 6620  ATH).        if 
+0001bfe0: 6e6f 7420 7365 6c66 2e78 7061 7468 733a  not self.xpaths:
+0001bff0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0001c000: 7365 2056 616c 7565 4572 726f 7228 6622  se ValueError(f"
+0001c010: 4552 524f 5220 6d75 7374 2067 6976 6520  ERROR must give 
+0001c020: 7870 6174 6822 290a 2020 2020 2020 2020  xpath").        
+0001c030: 666f 7220 7870 6174 6820 696e 2073 656c  for xpath in sel
+0001c040: 662e 7870 6174 6873 3a0a 2020 2020 2020  f.xpaths:.      
+0001c050: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0001c060: 2020 2020 2020 2020 2020 206d 6174 6368             match
+0001c070: 5f65 6c65 6d65 6e74 7320 3d20 7472 6565  _elements = tree
+0001c080: 2e78 7061 7468 2878 7061 7468 290a 2020  .xpath(xpath).  
+0001c090: 2020 2020 2020 2020 2020 6578 6365 7074            except
+0001c0a0: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
+0001c0b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c0c0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+0001c0d0: 7228 6622 4552 524f 5220 7870 6174 6820  r(f"ERROR xpath 
+0001c0e0: 7b78 7061 7468 7d20 7b65 7d22 290a 0a20  {xpath} {e}").. 
+0001c0f0: 2020 2020 2020 2073 656c 662e 656c 656d         self.elem
+0001c100: 656e 745f 6c69 7374 203d 206c 6973 7428  ent_list = list(
+0001c110: 290a 2020 2020 2020 2020 666f 7220 7870  ).        for xp
+0001c120: 6174 6820 696e 2073 656c 662e 7870 6174  ath in self.xpat
+0001c130: 6873 3a0a 2020 2020 2020 2020 2020 2020  hs:.            
+0001c140: 6d61 7463 685f 656c 656d 656e 7473 203d  match_elements =
+0001c150: 2074 7265 652e 7870 6174 6828 7870 6174   tree.xpath(xpat
+0001c160: 6829 0a20 2020 2020 2020 2020 2020 2066  h).            f
+0001c170: 6f72 206d 6174 6368 5f65 6c65 6d65 6e74  or match_element
+0001c180: 2069 6e20 6d61 7463 685f 656c 656d 656e   in match_elemen
+0001c190: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+0001c1a0: 2020 2020 7420 3d20 7479 7065 286d 6174      t = type(mat
+0001c1b0: 6368 5f65 6c65 6d65 6e74 290a 2020 2020  ch_element).    
+0001c1c0: 2020 2020 2020 2020 2020 2020 6966 2074              if t
+0001c1d0: 2069 7320 6e6f 7420 5f45 6c65 6d65 6e74   is not _Element
+0001c1e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001c1f0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+0001c200: 6545 7272 6f72 2866 226e 6f74 2061 6e20  eError(f"not an 
+0001c210: 656c 656d 656e 7420 7b74 7d20 7b6d 6174  element {t} {mat
+0001c220: 6368 5f65 6c65 6d65 6e74 7d22 290a 2020  ch_element}").  
+0001c230: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0001c240: 6c66 2e65 6c65 6d65 6e74 5f6c 6973 742e  lf.element_list.
+0001c250: 6170 7065 6e64 286d 6174 6368 5f65 6c65  append(match_ele
+0001c260: 6d65 6e74 290a 0a20 2020 2020 2020 2066  ment)..        f
+0001c270: 6f72 2065 6c65 6d65 6e74 2069 6e20 7365  or element in se
+0001c280: 6c66 2e65 6c65 6d65 6e74 5f6c 6973 743a  lf.element_list:
+0001c290: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0001c2a0: 2074 6578 7420 696e 2065 6c65 6d65 6e74   text in element
+0001c2b0: 2e78 7061 7468 2822 2e2f 7465 7874 2829  .xpath("./text()
+0001c2c0: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
+0001c2d0: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
+0001c2e0: 2020 2020 2020 2020 2023 206e 6f64 6573           # nodes
+0001c2f0: 7472 203d 2073 656c 662e 7365 6c65 6374  tr = self.select
+0001c300: 5f63 6875 6e6b 735f 7375 6263 6875 6e6b  _chunks_subchunk
+0001c310: 735f 6e6f 6465 7328 7465 7874 290a 0a20  s_nodes(text).. 
+0001c320: 2020 2064 6566 2073 656c 6563 745f 6368     def select_ch
+0001c330: 756e 6b73 5f73 7562 6368 756e 6b73 5f6e  unks_subchunks_n
+0001c340: 6f64 6573 2873 656c 662c 2074 6578 742c  odes(self, text,
+0001c350: 2073 706c 6974 7465 725f 7265 3d4e 6f6e   splitter_re=Non
+0001c360: 652c 206e 6f64 655f 7265 3d4e 6f6e 6529  e, node_re=None)
+0001c370: 3a0a 2020 2020 2020 2020 2320 6368 756e  :.        # chun
+0001c380: 6b5f 7265 2c20 7370 6c69 7474 6572 5f72  k_re, splitter_r
+0001c390: 652c 206e 6f64 655f 7265 5f6c 6961 742c  e, node_re_liat,
+0001c3a0: 2061 6464 5f75 6e6d 6174 6368 6564 203d   add_unmatched =
+0001c3b0: 2046 616c 7365 293a 0a20 2020 2020 2020   False):.       
+0001c3c0: 2022 2222 0a20 2020 2020 2020 204d 6f76   """.        Mov
+0001c3d0: 6520 746f 2061 2063 6c61 7373 2061 6e64  e to a class and
+0001c3e0: 2072 6566 6163 746f 7220 746f 2075 7365   refactor to use
+0001c3f0: 2064 6963 7469 6f6e 6172 790a 2020 2020   dictionary.    
+0001c400: 2020 2020 4e4f 5420 5945 5420 5553 4544      NOT YET USED
+0001c410: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0001c420: 7370 6c69 7474 6572 5f72 653a 2072 6567  splitter_re: reg
+0001c430: 6578 2066 6f72 2073 706c 6974 7469 6e67  ex for splitting
+0001c440: 2073 6d61 6c6c 6572 2063 6875 6e6b 730a   smaller chunks.
+0001c450: 2020 2020 2020 2020 3a70 6172 616d 206e          :param n
+0001c460: 6f64 655f 7265 3a20 7265 6765 7820 746f  ode_re: regex to
+0001c470: 2066 696e 6420 6879 7065 726e 6f64 6573   find hypernodes
+0001c480: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+0001c490: 2020 2020 2020 6368 756e 6b5f 7265 7320        chunk_res 
+0001c4a0: 3d20 7365 6c66 2e63 6875 6e6b 5f64 6963  = self.chunk_dic
+0001c4b0: 742e 6765 7428 7365 6c66 2e43 4855 4e4b  t.get(self.CHUNK
+0001c4c0: 5f52 4529 0a20 2020 2020 2020 2073 706c  _RE).        spl
+0001c4d0: 6974 7465 725f 7265 7320 3d20 7365 6c66  itter_res = self
+0001c4e0: 2e73 706c 6974 7465 725f 6469 6374 2e67  .splitter_dict.g
+0001c4f0: 6574 2873 656c 662e 5350 4c49 5454 4552  et(self.SPLITTER
+0001c500: 5f52 4529 0a20 2020 2020 2020 206e 6f64  _RE).        nod
+0001c510: 655f 7265 7320 3d20 7365 6c66 2e63 6875  e_res = self.chu
+0001c520: 6e6b 5f6e 6f64 655f 6469 6374 2e67 6574  nk_node_dict.get
+0001c530: 2873 656c 662e 5355 424e 4f44 455f 5245  (self.SUBNODE_RE
+0001c540: 290a 0a20 2020 2020 2020 2061 6464 5f75  )..        add_u
+0001c550: 6e6d 6174 6368 6564 203d 2073 656c 662e  nmatched = self.
+0001c560: 6368 756e 6b5f 6e6f 6465 5f64 6963 742e  chunk_node_dict.
+0001c570: 6765 7428 7365 6c66 2e55 4e4d 4154 4348  get(self.UNMATCH
+0001c580: 4544 290a 2020 2020 2020 2020 7074 7220  ED).        ptr 
+0001c590: 3d20 300a 2020 2020 2020 2020 7768 696c  = 0.        whil
+0001c5a0: 6520 5472 7565 3a0a 2020 2020 2020 2020  e True:.        
+0001c5b0: 2020 2020 666f 7220 6368 756e 6b5f 7265      for chunk_re
+0001c5c0: 2069 6e20 6368 756e 6b5f 7265 733a 0a20   in chunk_res:. 
+0001c5d0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0001c5e0: 6174 6368 203d 2072 652e 7365 6172 6368  atch = re.search
+0001c5f0: 2863 6875 6e6b 5f72 652c 2074 6578 745b  (chunk_re, text[
+0001c600: 7074 723a 5d29 0a20 2020 2020 2020 2020  ptr:]).         
+0001c610: 2020 2020 2020 2069 6620 6e6f 7420 6d61         if not ma
+0001c620: 7463 683a 0a20 2020 2020 2020 2020 2020  tch:.           
+0001c630: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
+0001c640: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001c650: 7472 202b 3d20 6d61 7463 682e 7370 616e  tr += match.span
+0001c660: 2829 5b31 5d0a 2020 2020 2020 2020 2020  ()[1].          
+0001c670: 2020 2020 2020 6e6f 6465 7374 7220 3d20        nodestr = 
+0001c680: 6d61 7463 682e 6772 6f75 7028 3129 0a0a  match.group(1)..
 0001c690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c6a0: 2020 2020 2020 206e 6f64 655f 6469 6374         node_dict
-0001c6b0: 5b73 656c 662e 554e 4d41 5443 4845 445d  [self.UNMATCHED]
-0001c6c0: 2e61 7070 656e 6428 6e6f 6465 290a 2020  .append(node).  
-0001c6d0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0001c6e0: 7220 6974 656d 2069 6e20 6e6f 6465 5f64  r item in node_d
-0001c6f0: 6963 742e 6974 656d 7328 293a 0a20 2020  ict.items():.   
-0001c700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c710: 2023 2070 7269 6e74 2866 2269 7465 6d20   # print(f"item 
-0001c720: 7b69 7465 6d7d 2229 0a20 2020 2020 2020  {item}").       
-0001c730: 2020 2020 2020 2020 2020 2020 2070 6173               pas
-0001c740: 730a 0a20 2020 2064 6566 2061 6464 5f78  s..    def add_x
-0001c750: 7061 7468 2873 656c 662c 2074 6974 6c65  path(self, title
-0001c760: 2c20 7870 6174 6829 3a0a 2020 2020 2020  , xpath):.      
-0001c770: 2020 2222 220a 2020 2020 2020 2020 7365    """.        se
-0001c780: 7420 7870 6174 6820 666f 7220 6578 7472  t xpath for extr
-0001c790: 6163 7469 6e67 2048 544d 4c20 6e6f 6465  acting HTML node
-0001c7a0: 732e 0a20 2020 2020 2020 203a 7061 7261  s..        :para
-0001c7b0: 6d20 7469 746c 653a 2074 6974 6c65 206f  m title: title o
-0001c7c0: 6620 7870 6174 680a 2020 2020 2020 2020  f xpath.        
-0001c7d0: 3a70 6172 616d 2078 7061 7468 3a20 6163  :param xpath: ac
-0001c7e0: 7473 206f 6e20 6375 7272 656e 7420 6e6f  ts on current no
-0001c7f0: 6465 7365 740a 2020 2020 2020 2020 2222  deset.        ""
-0001c800: 220a 2020 2020 2020 2020 586d 6c4c 6962  ".        XmlLib
-0001c810: 2e76 616c 6964 6174 655f 7870 6174 6828  .validate_xpath(
-0001c820: 7870 6174 6829 0a20 2020 2020 2020 2073  xpath).        s
-0001c830: 656c 662e 6164 645f 6974 656d 5f74 6f5f  elf.add_item_to_
-0001c840: 6172 7261 795f 6469 6374 2873 656c 662e  array_dict(self.
-0001c850: 7870 6174 685f 6469 6374 2c20 7469 746c  xpath_dict, titl
-0001c860: 652c 2078 7061 7468 290a 0a20 2020 2064  e, xpath)..    d
-0001c870: 6566 2076 616c 6964 6174 655f 7870 6174  ef validate_xpat
-0001c880: 6828 7365 6c66 2c20 7870 6174 6829 3a0a  h(self, xpath):.
-0001c890: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001c8a0: 2020 2020 6372 7564 6520 7379 6e74 6178      crude syntax
-0001c8b0: 2076 616c 6964 6174 696f 6e20 6f66 2078   validation of x
-0001c8c0: 7061 7468 2073 7472 696e 672e 0a20 2020  path string..   
-0001c8d0: 2020 2020 2074 6573 7473 2078 7061 7468       tests xpath
-0001c8e0: 206f 6e20 6120 7472 6976 6961 6c20 656c   on a trivial el
-0001c8f0: 656d 656e 740a 2020 2020 2020 2020 3a70  ement.        :p
-0001c900: 6172 616d 2078 7061 7468 3a0a 2020 2020  aram xpath:.    
-0001c910: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0001c920: 7472 6565 203d 2045 542e 6672 6f6d 7374  tree = ET.fromst
-0001c930: 7269 6e67 2822 3c66 6f6f 2f3e 2229 0a20  ring("<foo/>"). 
-0001c940: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-0001c950: 2020 2020 2020 2020 7472 6565 2e78 7061          tree.xpa
-0001c960: 7468 2878 7061 7468 290a 2020 2020 2020  th(xpath).      
-0001c970: 2020 6578 6365 7074 2045 542e 5850 6174    except ET.XPat
-0001c980: 6845 7661 6c45 7272 6f72 2061 7320 653a  hEvalError as e:
-0001c990: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
-0001c9a0: 6769 6e67 2e65 7272 6f72 2866 2262 6164  ging.error(f"bad
-0001c9b0: 2058 5061 7468 207b 7870 6174 687d 2c20   XPath {xpath}, 
-0001c9c0: 7b65 7d22 290a 2020 2020 2020 2020 2020  {e}").          
-0001c9d0: 2020 7261 6973 6520 650a 0a20 2020 2064    raise e..    d
-0001c9e0: 6566 2061 6464 5f63 6875 6e6b 5f72 6528  ef add_chunk_re(
-0001c9f0: 7365 6c66 2c20 6368 756e 6b5f 7265 293a  self, chunk_re):
-0001ca00: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0001ca10: 2020 2020 2061 6464 2063 6875 6e6b 2072       add chunk r
-0001ca20: 6567 6578 2066 6f72 2065 7874 7261 6374  egex for extract
-0001ca30: 696e 6720 6368 756e 6b73 2e0a 2020 2020  ing chunks..    
-0001ca40: 2020 2020 3a70 6172 616d 2063 6875 6e6b      :param chunk
-0001ca50: 5f72 653a 2061 6374 7320 6f6e 2063 7572  _re: acts on cur
-0001ca60: 7265 6e74 206e 6f64 6573 6574 0a20 2020  rent nodeset.   
-0001ca70: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001ca80: 2073 656c 662e 6164 645f 6974 656d 5f74   self.add_item_t
-0001ca90: 6f5f 6172 7261 795f 6469 6374 2873 656c  o_array_dict(sel
-0001caa0: 662e 6368 756e 6b5f 6469 6374 2c20 7365  f.chunk_dict, se
-0001cab0: 6c66 2e43 4855 4e4b 5f52 452c 2063 6875  lf.CHUNK_RE, chu
-0001cac0: 6e6b 5f72 6529 0a20 2020 2020 2020 2073  nk_re).        s
-0001cad0: 656c 662e 7661 6c69 6461 7465 5f72 6528  elf.validate_re(
-0001cae0: 6368 756e 6b5f 7265 290a 0a20 2020 2064  chunk_re)..    d
-0001caf0: 6566 2061 6464 5f73 706c 6974 7465 725f  ef add_splitter_
-0001cb00: 7265 2873 656c 662c 2073 706c 6974 7465  re(self, splitte
-0001cb10: 725f 7265 293a 0a20 2020 2020 2020 2022  r_re):.        "
-0001cb20: 2222 0a20 2020 2020 2020 2061 6464 2073  "".        add s
-0001cb30: 706c 6974 7465 7220 7265 6765 7820 666f  plitter regex fo
-0001cb40: 7220 6578 7472 6163 7469 6e67 206c 6973  r extracting lis
-0001cb50: 7473 2069 6e20 6368 756e 6b73 2e0a 2020  ts in chunks..  
-0001cb60: 2020 2020 2020 3a70 6172 616d 2073 706c        :param spl
-0001cb70: 6974 7465 725f 7265 3a20 6163 7473 206f  itter_re: acts o
-0001cb80: 6e20 6375 7272 656e 7420 6e6f 6465 7365  n current nodese
-0001cb90: 740a 2020 2020 2020 2020 2222 220a 2020  t.        """.  
-0001cba0: 2020 2020 2020 7365 6c66 2e61 6464 5f69        self.add_i
-0001cbb0: 7465 6d5f 746f 5f61 7272 6179 5f64 6963  tem_to_array_dic
-0001cbc0: 7428 7365 6c66 2e73 706c 6974 7465 725f  t(self.splitter_
-0001cbd0: 6469 6374 2c20 7365 6c66 2e53 504c 4954  dict, self.SPLIT
-0001cbe0: 5445 525f 5245 2c20 7370 6c69 7474 6572  TER_RE, splitter
-0001cbf0: 5f72 6529 0a20 2020 2020 2020 2073 656c  _re).        sel
-0001cc00: 662e 7661 6c69 6461 7465 5f72 6528 7370  f.validate_re(sp
-0001cc10: 6c69 7474 6572 5f72 6529 0a0a 2020 2020  litter_re)..    
-0001cc20: 6465 6620 6164 645f 7375 626e 6f64 655f  def add_subnode_
-0001cc30: 6b65 795f 7265 2873 656c 662c 206e 616d  key_re(self, nam
-0001cc40: 652c 2073 7562 6e6f 6465 5f72 6529 3a0a  e, subnode_re):.
-0001cc50: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001cc60: 2020 2020 6164 6420 6e61 6d65 6420 7375      add named su
-0001cc70: 626e 6f64 6520 7265 6765 7820 666f 7220  bnode regex for 
-0001cc80: 7061 7273 696e 6720 6c69 7374 2069 7465  parsing list ite
-0001cc90: 6d73 2066 726f 6d20 7370 6c69 7474 696e  ms from splittin
-0001cca0: 670a 2020 2020 2020 2020 3a70 6172 616d  g.        :param
-0001ccb0: 206e 616d 653a 206e 616d 6520 6f66 2072   name: name of r
-0001ccc0: 6520 696e 2064 6963 740a 2020 2020 2020  e in dict.      
-0001ccd0: 2020 3a70 6172 616d 2073 7562 6e6f 6465    :param subnode
-0001cce0: 5f72 653a 2072 6567 6578 2074 6f20 7374  _re: regex to st
-0001ccf0: 6f72 650a 2020 2020 2020 2020 2222 220a  ore.        """.
-0001cd00: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
-0001cd10: 5f6e 616d 6564 5f76 616c 7565 286e 616d  _named_value(nam
-0001cd20: 652c 2073 7562 6e6f 6465 5f72 6529 0a0a  e, subnode_re)..
-0001cd30: 2020 2020 6465 6620 6164 645f 6e61 6d65      def add_name
-0001cd40: 645f 7661 6c75 6528 7365 6c66 2c20 6e61  d_value(self, na
-0001cd50: 6d65 2c20 7375 626e 6f64 655f 7265 293a  me, subnode_re):
-0001cd60: 0a20 2020 2020 2020 2073 656c 662e 6164  .        self.ad
-0001cd70: 645f 6974 656d 5f74 6f5f 6172 7261 795f  d_item_to_array_
-0001cd80: 6469 6374 2873 656c 662e 6368 756e 6b5f  dict(self.chunk_
-0001cd90: 6469 6374 2c20 6e61 6d65 2c20 7375 626e  dict, name, subn
-0001cda0: 6f64 655f 7265 290a 2020 2020 2020 2020  ode_re).        
-0001cdb0: 7365 6c66 2e76 616c 6964 6174 655f 7265  self.validate_re
-0001cdc0: 2873 7562 6e6f 6465 5f72 6529 0a0a 2020  (subnode_re)..  
-0001cdd0: 2020 6465 6620 7365 745f 756e 6d61 7463    def set_unmatc
-0001cde0: 6865 645f 666c 6167 2873 656c 662c 2075  hed_flag(self, u
-0001cdf0: 6e6d 6174 6368 6564 293a 0a20 2020 2020  nmatched):.     
-0001ce00: 2020 2022 2222 0a20 2020 2020 2020 2073     """.        s
-0001ce10: 6574 2055 4e4d 4154 4348 4544 2062 6f6f  et UNMATCHED boo
-0001ce20: 6c65 616e 2e20 4966 2074 7275 6520 6164  lean. If true ad
-0001ce30: 6473 2061 6c6c 2075 6e6d 6174 6368 6564  ds all unmatched
-0001ce40: 2076 616c 7565 7320 746f 2064 6963 7420   values to dict 
-0001ce50: 756e 6465 7220 554e 4d41 5443 4845 440a  under UNMATCHED.
-0001ce60: 2020 2020 2020 2020 3a70 6172 616d 2075          :param u
-0001ce70: 6e6d 6174 6368 6564 3a20 6163 7473 206f  nmatched: acts o
-0001ce80: 6e20 6375 7272 656e 7420 6e6f 6465 7365  n current nodese
-0001ce90: 740a 2020 2020 2020 2020 3a70 6172 616d  t.        :param
-0001cea0: 206d 6174 6368 5f74 7970 653a 2061 6464   match_type: add
-0001ceb0: 6974 696f 6e61 6c20 6465 6275 6720 746f  itional debug to
-0001cec0: 206e 616d 650a 2020 2020 2020 2020 2222   name.        ""
-0001ced0: 220a 2020 2020 2020 2020 7365 6c66 2e63  ".        self.c
-0001cee0: 6875 6e6b 5f64 6963 745b 7365 6c66 2e55  hunk_dict[self.U
-0001cef0: 4e4d 4154 4348 4544 5d20 3d20 756e 6d61  NMATCHED] = unma
-0001cf00: 7463 6865 640a 0a20 2020 2064 6566 2076  tched..    def v
-0001cf10: 616c 6964 6174 655f 7265 2873 656c 662c  alidate_re(self,
-0001cf20: 2072 6567 6578 293a 0a20 2020 2020 2020   regex):.       
-0001cf30: 2022 2222 0a20 2020 2020 2020 203a 7061   """.        :pa
-0001cf40: 7261 6d20 7265 6765 783a 2072 6567 6578  ram regex: regex
-0001cf50: 2074 6f20 6265 2076 616c 6964 6174 6564   to be validated
-0001cf60: 0a20 2020 2020 2020 203a 6578 6365 7074  .        :except
-0001cf70: 3a20 7468 726f 7773 2045 7863 6570 7469  : throws Excepti
-0001cf80: 6f6e 2066 6f72 2062 6164 2072 6567 6578  on for bad regex
-0001cf90: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0001cfa0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-0001cfb0: 2020 2020 2020 7265 2e63 6f6d 7069 6c65        re.compile
-0001cfc0: 2872 6567 6578 290a 2020 2020 2020 2020  (regex).        
-0001cfd0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-0001cfe0: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-0001cff0: 2020 206c 6f67 6769 6e67 2e65 7272 6f72     logging.error
-0001d000: 2866 2262 6164 2072 6567 6578 207b 7265  (f"bad regex {re
-0001d010: 6765 787d 2229 0a20 2020 2020 2020 2020  gex}").         
-0001d020: 2020 2072 6169 7365 2065 0a0a 2020 2020     raise e..    
-0001d030: 6465 6620 6164 645f 6974 656d 5f74 6f5f  def add_item_to_
-0001d040: 6172 7261 795f 6469 6374 2873 656c 662c  array_dict(self,
-0001d050: 2074 6865 5f64 6963 742c 206b 6579 2c20   the_dict, key, 
-0001d060: 7661 6c75 6529 3a0a 2020 2020 2020 2020  value):.        
-0001d070: 6966 206e 6f74 2074 6865 5f64 6963 742e  if not the_dict.
-0001d080: 6765 7428 6b65 7929 3a0a 2020 2020 2020  get(key):.      
-0001d090: 2020 2020 2020 7468 655f 6469 6374 5b6b        the_dict[k
-0001d0a0: 6579 5d20 3d20 5b5d 0a20 2020 2020 2020  ey] = [].       
-0001d0b0: 2074 6865 5f64 6963 745b 6b65 795d 2e61   the_dict[key].a
-0001d0c0: 7070 656e 6428 7661 6c75 6529 0a0a 0a63  ppend(value)...c
-0001d0d0: 6c61 7373 2055 524c 4361 6368 653a 0a20  lass URLCache:. 
-0001d0e0: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-0001d0f0: 7365 6c66 293a 0a20 2020 2020 2020 2073  self):.        s
-0001d100: 656c 662e 7572 6c5f 6469 6374 203d 2064  elf.url_dict = d
-0001d110: 6963 7428 290a 0a20 2020 2064 6566 2072  ict()..    def r
-0001d120: 6561 645f 786d 6c5f 656c 656d 656e 745f  ead_xml_element_
-0001d130: 6672 6f6d 5f67 6974 6875 6228 7365 6c66  from_github(self
-0001d140: 2c20 6769 7468 7562 5f75 726c 2c20 6465  , github_url, de
-0001d150: 6c61 793d 3129 3a0a 2020 2020 2020 2020  lay=1):.        
-0001d160: 2222 2272 6574 7269 6576 6573 2061 6e64  """retrieves and
-0001d170: 2070 6172 7365 7320 636f 6e74 656e 7420   parses content 
-0001d180: 6f66 2055 524c 2e20 4361 6368 6573 2069  of URL. Caches i
-0001d190: 7420 6966 2066 6f75 6e64 0a20 2020 2020  t if found.     
-0001d1a0: 2020 2072 6574 7572 6e73 2061 2064 6565     returns a dee
-0001d1b0: 7063 6f70 7920 6173 2065 6c65 6d6e 7420  pcopy as elemnt 
-0001d1c0: 6973 206c 696b 656c 7920 746f 2062 6520  is likely to be 
-0001d1d0: 6564 6974 6564 2222 220a 2020 2020 2020  edited""".      
-0001d1e0: 2020 6874 6d6c 5f65 6c65 6d20 3d20 7365    html_elem = se
-0001d1f0: 6c66 2e75 726c 5f64 6963 742e 6765 7428  lf.url_dict.get(
-0001d200: 6769 7468 7562 5f75 726c 290a 2020 2020  github_url).    
-0001d210: 2020 2020 6966 2068 746d 6c5f 656c 656d      if html_elem
-0001d220: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0001d230: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0001d240: 2020 2020 2020 2020 2020 2068 746d 6c5f             html_
-0001d250: 656c 656d 203d 2058 6d6c 4c69 622e 7265  elem = XmlLib.re
-0001d260: 6164 5f78 6d6c 5f65 6c65 6d65 6e74 5f66  ad_xml_element_f
-0001d270: 726f 6d5f 6769 7468 7562 2867 6974 6875  rom_github(githu
-0001d280: 625f 7572 6c3d 6769 7468 7562 5f75 726c  b_url=github_url
-0001d290: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001d2a0: 2020 7469 6d65 2e73 6c65 6570 2864 656c    time.sleep(del
-0001d2b0: 6179 290a 2020 2020 2020 2020 2020 2020  ay).            
-0001d2c0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-0001d2d0: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-0001d2e0: 2020 2020 2020 2070 7269 6e74 2866 2263         print(f"c
-0001d2f0: 616e 6e6f 7420 7265 6164 207b 6769 7468  annot read {gith
-0001d300: 7562 5f75 726c 7d20 6265 6361 7573 6520  ub_url} because 
-0001d310: 7b65 7d22 290a 2020 2020 2020 2020 2020  {e}").          
-0001d320: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-0001d330: 650a 2020 2020 2020 2020 2020 2020 7365  e.            se
-0001d340: 6c66 2e75 726c 5f64 6963 745b 6769 7468  lf.url_dict[gith
-0001d350: 7562 5f75 726c 5d20 3d20 6874 6d6c 5f65  ub_url] = html_e
-0001d360: 6c65 6d0a 2020 2020 2020 2020 656c 7365  lem.        else
-0001d370: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-0001d380: 7072 696e 7428 6622 2066 6f75 6e64 2069  print(f" found i
-0001d390: 6e20 6361 6368 6521 2229 0a20 2020 2020  n cache!").     
-0001d3a0: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
-0001d3b0: 2020 2020 7265 7475 726e 2063 6f70 792e      return copy.
-0001d3c0: 6465 6570 636f 7079 2868 746d 6c5f 656c  deepcopy(html_el
-0001d3d0: 656d 290a 0a0a 4944 203d 2022 6964 220a  em)...ID = "id".
-0001d3e0: 4f42 4a45 4354 203d 2022 6f62 6a65 6374  OBJECT = "object
-0001d3f0: 220a 5354 4152 5445 4e44 203d 2022 7374  ".STARTEND = "st
-0001d400: 6172 745f 656e 6422 0a0a 0a63 6c61 7373  art_end"...class
-0001d410: 2046 6c6f 6174 426f 756e 6461 7279 4469   FloatBoundaryDi
-0001d420: 6374 3a0a 0a20 2020 2064 6566 205f 5f69  ct:..    def __i
-0001d430: 6e69 745f 5f28 7365 6c66 2c20 6874 6d6c  nit__(self, html
-0001d440: 5f65 6c65 6d2c 206f 7574 6469 723d 4e6f  _elem, outdir=No
-0001d450: 6e65 293a 0a20 2020 2020 2020 2073 656c  ne):.        sel
-0001d460: 662e 666c 6f61 745f 626f 756e 6461 7279  f.float_boundary
-0001d470: 5f64 6963 7420 3d20 6465 6661 756c 7464  _dict = defaultd
-0001d480: 6963 7428 6c69 7374 290a 2020 2020 2020  ict(list).      
-0001d490: 2020 7365 6c66 2e68 746d 6c5f 656c 656d    self.html_elem
-0001d4a0: 203d 2068 746d 6c5f 656c 656d 0a20 2020   = html_elem.   
-0001d4b0: 2020 2020 2073 656c 662e 6f75 7464 6972       self.outdir
-0001d4c0: 203d 206f 7574 6469 720a 0a20 2020 2064   = outdir..    d
-0001d4d0: 6566 2061 6464 5f6f 626a 6563 7428 7365  ef add_object(se
-0001d4e0: 6c66 2c20 666c 6f61 745f 626f 756e 6461  lf, float_bounda
-0001d4f0: 7279 293a 0a20 2020 2020 2020 206b 6579  ry):.        key
-0001d500: 203d 2066 6c6f 6174 5f62 6f75 6e64 6172   = float_boundar
-0001d510: 792e 6b65 790a 2020 2020 2020 2020 7365  y.key.        se
-0001d520: 6c66 2e66 6c6f 6174 5f62 6f75 6e64 6172  lf.float_boundar
-0001d530: 795f 6469 6374 5b6b 6579 5d2e 6170 7065  y_dict[key].appe
-0001d540: 6e64 2866 6c6f 6174 5f62 6f75 6e64 6172  nd(float_boundar
-0001d550: 7929 0a0a 2020 2020 6465 6620 6164 645f  y)..    def add_
-0001d560: 666c 6f61 745f 626f 756e 6461 7269 6573  float_boundaries
-0001d570: 2873 656c 662c 2066 6c6f 6174 5f62 6f75  (self, float_bou
-0001d580: 6e64 6172 6965 7329 3a0a 2020 2020 2020  ndaries):.      
-0001d590: 2020 666f 7220 666c 6f61 745f 626f 756e    for float_boun
-0001d5a0: 6461 7279 2069 6e20 666c 6f61 745f 626f  dary in float_bo
-0001d5b0: 756e 6461 7269 6573 3a0a 2020 2020 2020  undaries:.      
-0001d5c0: 2020 2020 2020 7365 6c66 2e61 6464 5f6f        self.add_o
-0001d5d0: 626a 6563 7428 666c 6f61 745f 626f 756e  bject(float_boun
-0001d5e0: 6461 7279 290a 0a20 2020 2064 6566 2065  dary)..    def e
-0001d5f0: 7874 7261 6374 5f63 6f6e 7465 6e74 735f  xtract_contents_
-0001d600: 6f66 5f62 7261 636b 6574 6564 5f62 6f75  of_bracketed_bou
-0001d610: 6e64 6172 6965 735f 616e 645f 7772 6974  ndaries_and_writ
-0001d620: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
-0001d630: 2066 6f72 2066 625f 6c69 7374 2069 6e20   for fb_list in 
-0001d640: 7365 6c66 2e66 6c6f 6174 5f62 6f75 6e64  self.float_bound
-0001d650: 6172 795f 6469 6374 2e76 616c 7565 7328  ary_dict.values(
-0001d660: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-0001d670: 6620 6c65 6e28 6662 5f6c 6973 7429 203d  f len(fb_list) =
-0001d680: 3d20 323a 0a20 2020 2020 2020 2020 2020  = 2:.           
-0001d690: 2020 2020 2023 2070 7269 6e74 2866 2246       # print(f"F
-0001d6a0: 4220 7b66 625f 6c69 7374 7d20 7b66 625f  B {fb_list} {fb_
-0001d6b0: 6c69 7374 5b30 5d2e 6469 765f 6964 7d20  list[0].div_id} 
-0001d6c0: 7b66 625f 6c69 7374 5b31 5d2e 6469 765f  {fb_list[1].div_
-0001d6d0: 6964 7d22 290a 2020 2020 2020 2020 2020  id}").          
-0001d6e0: 2020 2020 2020 6e65 775f 6469 7620 3d20        new_div = 
-0001d6f0: 7365 6c66 2e64 656c 6574 655f 6265 7477  self.delete_betw
-0001d700: 6565 6e28 6662 5f6c 6973 745b 305d 2e64  een(fb_list[0].d
-0001d710: 6976 5f69 642c 2066 625f 6c69 7374 5b31  iv_id, fb_list[1
-0001d720: 5d2e 6469 765f 6964 290a 2020 2020 2020  ].div_id).      
-0001d730: 2020 2020 2020 2020 2020 666c 6f61 745f            float_
-0001d740: 6e61 6d65 203d 2066 625f 6c69 7374 5b30  name = fb_list[0
-0001d750: 5d2e 6b65 790a 2020 2020 2020 2020 2020  ].key.          
-0001d760: 2020 2020 2020 6e65 775f 6469 762e 6174        new_div.at
-0001d770: 7472 6962 5b22 6e61 6d65 225d 203d 2066  trib["name"] = f
-0001d780: 6c6f 6174 5f6e 616d 650a 2020 2020 2020  loat_name.      
-0001d790: 2020 2020 2020 2020 2020 6e65 775f 6874            new_ht
-0001d7a0: 6d6c 5f65 6c65 6d20 3d20 4874 6d6c 4c69  ml_elem = HtmlLi
-0001d7b0: 622e 6372 6561 7465 5f6e 6577 5f68 746d  b.create_new_htm
-0001d7c0: 6c5f 7769 7468 5f6f 6c64 5f73 7479 6c65  l_with_old_style
-0001d7d0: 7328 7365 6c66 2e68 746d 6c5f 656c 656d  s(self.html_elem
-0001d7e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001d7f0: 2020 4874 6d6c 4c69 622e 6765 745f 626f    HtmlLib.get_bo
-0001d800: 6479 286e 6577 5f68 746d 6c5f 656c 656d  dy(new_html_elem
-0001d810: 292e 6170 7065 6e64 286e 6577 5f64 6976  ).append(new_div
-0001d820: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001d830: 2020 6966 2073 656c 662e 6f75 7464 6972    if self.outdir
-0001d840: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001d850: 2020 2020 2020 5061 7468 2873 656c 662e        Path(self.
-0001d860: 6f75 7464 6972 292e 6d6b 6469 7228 6578  outdir).mkdir(ex
-0001d870: 6973 745f 6f6b 3d54 7275 652c 2070 6172  ist_ok=True, par
-0001d880: 656e 7473 3d46 616c 7365 290a 2020 2020  ents=False).    
-0001d890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d8a0: 6669 6c65 5f73 7465 6d20 3d20 666c 6f61  file_stem = floa
-0001d8b0: 745f 6e61 6d65 2e6c 6f77 6572 2829 2e72  t_name.lower().r
-0001d8c0: 6570 6c61 6365 2822 5c5c 732a 222c 2022  eplace("\\s*", "
-0001d8d0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0001d8e0: 2020 2020 2020 2058 6d6c 4c69 622e 7772         XmlLib.wr
-0001d8f0: 6974 655f 786d 6c28 6e65 775f 6874 6d6c  ite_xml(new_html
-0001d900: 5f65 6c65 6d2c 2050 6174 6828 7365 6c66  _elem, Path(self
-0001d910: 2e6f 7574 6469 722c 2066 696c 655f 7374  .outdir, file_st
-0001d920: 656d 202b 2022 2e68 746d 6c22 2929 0a0a  em + ".html"))..
-0001d930: 2020 2020 6465 6620 6465 6c65 7465 5f62      def delete_b
-0001d940: 6574 7765 656e 2873 656c 662c 2064 6976  etween(self, div
-0001d950: 5f69 6430 2c20 6469 765f 6964 3129 3a0a  _id0, div_id1):.
-0001d960: 2020 2020 2020 2020 656c 656d 3020 3d20          elem0 = 
-0001d970: 7365 6c66 2e68 746d 6c5f 656c 656d 2e78  self.html_elem.x
-0001d980: 7061 7468 2866 222e 2f2f 6469 765b 4069  path(f".//div[@i
-0001d990: 643d 277b 6469 765f 6964 307d 275d 2229  d='{div_id0}']")
-0001d9a0: 5b30 5d0a 2020 2020 2020 2020 656c 656d  [0].        elem
-0001d9b0: 3120 3d20 7365 6c66 2e68 746d 6c5f 656c  1 = self.html_el
-0001d9c0: 656d 2e78 7061 7468 2866 222e 2f2f 6469  em.xpath(f".//di
-0001d9d0: 765b 4069 643d 277b 6469 765f 6964 317d  v[@id='{div_id1}
-0001d9e0: 275d 2229 5b30 5d0a 2020 2020 2020 2020  ']")[0].        
-0001d9f0: 666f 6c6c 6f77 696e 6720 3d20 656c 656d  following = elem
-0001da00: 302e 7870 6174 6828 2266 6f6c 6c6f 7769  0.xpath("followi
-0001da10: 6e67 3a3a 2a22 290a 2020 2020 2020 2020  ng::*").        
-0001da20: 6e65 775f 6469 7620 3d20 4554 2e45 6c65  new_div = ET.Ele
-0001da30: 6d65 6e74 2822 6469 7622 290a 2020 2020  ment("div").    
-0001da40: 2020 2020 6e65 775f 6469 762e 6174 7472      new_div.attr
-0001da50: 6962 5b22 6964 225d 203d 2064 6976 5f69  ib["id"] = div_i
-0001da60: 6430 0a20 2020 2020 2020 2066 6f72 2066  d0.        for f
-0001da70: 6f6c 6c6f 7720 696e 2066 6f6c 6c6f 7769  ollow in followi
-0001da80: 6e67 3a0a 2020 2020 2020 2020 2020 2020  ng:.            
-0001da90: 6964 5f20 3d20 666f 6c6c 6f77 2e61 7474  id_ = follow.att
-0001daa0: 7269 625b 2769 6427 5d0a 2020 2020 2020  rib['id'].      
-0001dab0: 2020 2020 2020 6e65 775f 6469 762e 6170        new_div.ap
-0001dac0: 7065 6e64 2866 6f6c 6c6f 7729 0a20 2020  pend(follow).   
-0001dad0: 2020 2020 2020 2020 2023 2066 6f6c 6c6f           # follo
-0001dae0: 772e 6765 7470 6172 656e 7428 292e 7265  w.getparent().re
-0001daf0: 6d6f 7665 2866 6f6c 6c6f 7729 0a20 2020  move(follow).   
-0001db00: 2020 2020 2020 2020 2069 6620 6964 5f20           if id_ 
-0001db10: 3d3d 2064 6976 5f69 6431 3a0a 2020 2020  == div_id1:.    
-0001db20: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0001db30: 7428 2245 5849 5422 290a 2020 2020 2020  t("EXIT").      
-0001db40: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
-0001db50: 2020 2020 2020 2020 7265 7475 726e 206e          return n
-0001db60: 6577 5f64 6976 0a0a 0a63 6c61 7373 2046  ew_div...class F
-0001db70: 6c6f 6174 426f 756e 6461 7279 3a0a 2020  loatBoundary:.  
-0001db80: 2020 2222 220a 2020 2020 486f 6c64 730a    """.    Holds.
-0001db90: 2020 2020 2222 220a 2020 2020 4950 4343      """.    IPCC
-0001dba0: 5f42 4f55 4e44 4152 5920 3d20 225c 5c5b  _BOUNDARY = "\\[
-0001dbb0: 3f22 205c 0a20 2020 2020 2020 2020 2020  ?" \.           
-0001dbc0: 2020 2020 2020 2020 2066 2228 3f50 3c7b           f"(?P<{
-0001dbd0: 5354 4152 5445 4e44 7d3e 5354 4152 547c  STARTEND}>START|
-0001dbe0: 454e 4429 5c5c 732a 2220 5c0a 2020 2020  END)\\s*" \.    
-0001dbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dc00: 6622 283f 503c 7b4f 424a 4543 547d 3e2e  f"(?P<{OBJECT}>.
-0001dc10: 2a42 4f58 7c46 4947 5552 457c 5441 424c  *BOX|FIGURE|TABL
-0001dc20: 4529 5c5c 732a 2220 5c0a 2020 2020 2020  E)\\s*" \.      
-0001dc30: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-0001dc40: 283f 503c 7b49 447d 3e28 3f3a 283f 3a5b  (?P<{ID}>(?:(?:[
-0001dc50: 412d 5a30 2d39 5d2b 7c5c 5c64 2b29 3f28  A-Z0-9]+|\\d+)?(
-0001dc60: 3f3a 5c5c 2e5c 5c64 2b29 2a29 295c 5c73  ?:\\.\\d+)*))\\s
-0001dc70: 2a28 3f3a 4845 5245 295c 5c5d 3f22 0a0a  *(?:HERE)\\]?"..
-0001dc80: 2020 2020 2320 5b53 5441 5254 2043 524f      # [START CRO
-0001dc90: 5353 2d53 4543 5449 4f4e 2042 4f58 2e31  SS-SECTION BOX.1
-0001dca0: 2048 4552 455d 0a0a 2020 2020 6465 6620   HERE]..    def 
-0001dcb0: 5f5f 696e 6974 5f5f 2873 656c 6629 3a0a  __init__(self):.
-0001dcc0: 2020 2020 2020 2020 7365 6c66 2e67 726f          self.gro
-0001dcd0: 7570 5f64 6963 7420 3d20 6469 6374 2829  up_dict = dict()
-0001dce0: 0a20 2020 2020 2020 2073 656c 662e 7374  .        self.st
-0001dcf0: 6172 7420 3d20 4e6f 6e65 0a20 2020 2020  art = None.     
-0001dd00: 2020 2073 656c 662e 656e 6420 3d20 4e6f     self.end = No
-0001dd10: 6e65 0a20 2020 2020 2020 2073 656c 662e  ne.        self.
-0001dd20: 6469 765f 6964 203d 204e 6f6e 650a 0a20  div_id = None.. 
-0001dd30: 2020 2064 6566 205f 5f73 7472 5f5f 2873     def __str__(s
-0001dd40: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
-0001dd50: 7475 726e 2073 656c 662e 6772 6f75 705f  turn self.group_
-0001dd60: 6469 6374 2e67 6574 2853 5441 5254 454e  dict.get(STARTEN
-0001dd70: 4429 202b 2022 3b22 202b 2073 656c 662e  D) + ";" + self.
-0001dd80: 6772 6f75 705f 6469 6374 2e67 6574 284f  group_dict.get(O
-0001dd90: 424a 4543 5429 202b 2022 3b22 202b 2073  BJECT) + ";" + s
-0001dda0: 656c 662e 6772 6f75 705f 6469 6374 2e67  elf.group_dict.g
-0001ddb0: 6574 2849 4429 0a0a 2020 2020 6465 6620  et(ID)..    def 
-0001ddc0: 5f5f 7265 7072 5f5f 2873 656c 6629 3a0a  __repr__(self):.
-0001ddd0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0001dde0: 656c 662e 5f5f 7374 725f 5f28 290a 0a20  elf.__str__().. 
-0001ddf0: 2020 2064 6566 2061 6464 2873 656c 662c     def add(self,
-0001de00: 206e 616d 652c 2076 616c 7565 293a 0a20   name, value):. 
-0001de10: 2020 2020 2020 2073 656c 662e 6772 6f75         self.grou
-0001de20: 705f 6469 6374 5b6e 616d 655d 203d 2076  p_dict[name] = v
-0001de30: 616c 7565 0a0a 2020 2020 4070 726f 7065  alue..    @prope
-0001de40: 7274 790a 2020 2020 6465 6620 6b65 7928  rty.    def key(
-0001de50: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
-0001de60: 6574 7572 6e20 7374 7228 7365 6c66 2e67  eturn str(self.g
-0001de70: 726f 7570 5f64 6963 745b 4f42 4a45 4354  roup_dict[OBJECT
-0001de80: 5d29 202b 2073 7472 2873 656c 662e 6772  ]) + str(self.gr
-0001de90: 6f75 705f 6469 6374 5b49 445d 290a 0a20  oup_dict[ID]).. 
-0001dea0: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-0001deb0: 2064 6566 2073 7461 7274 5f65 6e64 2873   def start_end(s
-0001dec0: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
-0001ded0: 7475 726e 2073 656c 662e 6772 6f75 705f  turn self.group_
-0001dee0: 6469 6374 5b53 5441 5254 454e 445d 0a0a  dict[STARTEND]..
-0001def0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-0001df00: 0a20 2020 2064 6566 2065 7874 7261 6374  .    def extract
-0001df10: 5f66 6c6f 6174 735f 616e 645f 626f 756e  _floats_and_boun
-0001df20: 6461 7269 6573 2863 6c73 2c20 6874 6d6c  daries(cls, html
-0001df30: 5f65 6c65 6d2c 2070 6163 6b61 6765 2c20  _elem, package, 
-0001df40: 6f75 7464 6972 3d4e 6f6e 6529 3a0a 2020  outdir=None):.  
-0001df50: 2020 2020 2020 7265 6765 7820 3d20 466c        regex = Fl
-0001df60: 6f61 7442 6f75 6e64 6172 792e 4950 4343  oatBoundary.IPCC
-0001df70: 5f42 4f55 4e44 4152 590a 2020 2020 2020  _BOUNDARY.      
-0001df80: 2020 666c 6f61 745f 626f 756e 6461 7269    float_boundari
-0001df90: 6573 203d 2046 6c6f 6174 4578 7472 6163  es = FloatExtrac
-0001dfa0: 746f 7228 292e 6578 7472 6163 745f 666c  tor().extract_fl
-0001dfb0: 6f61 745f 626f 756e 6461 7269 6573 2868  oat_boundaries(h
-0001dfc0: 746d 6c5f 656c 656d 2c20 7265 6765 7829  tml_elem, regex)
-0001dfd0: 0a20 2020 2020 2020 2066 6c6f 6174 5f62  .        float_b
-0001dfe0: 6f75 6e64 6172 795f 6469 6374 203d 2046  oundary_dict = F
-0001dff0: 6c6f 6174 426f 756e 6461 7279 4469 6374  loatBoundaryDict
-0001e000: 2868 746d 6c5f 656c 656d 2c20 6f75 7464  (html_elem, outd
-0001e010: 6972 3d6f 7574 6469 7229 0a20 2020 2020  ir=outdir).     
-0001e020: 2020 2066 6c6f 6174 5f62 6f75 6e64 6172     float_boundar
-0001e030: 795f 6469 6374 2e61 6464 5f66 6c6f 6174  y_dict.add_float
-0001e040: 5f62 6f75 6e64 6172 6965 7328 666c 6f61  _boundaries(floa
-0001e050: 745f 626f 756e 6461 7269 6573 290a 2020  t_boundaries).  
-0001e060: 2020 2020 2020 666c 6f61 745f 626f 756e        float_boun
-0001e070: 6461 7279 5f64 6963 742e 6578 7472 6163  dary_dict.extrac
-0001e080: 745f 636f 6e74 656e 7473 5f6f 665f 6272  t_contents_of_br
-0001e090: 6163 6b65 7465 645f 626f 756e 6461 7269  acketed_boundari
-0001e0a0: 6573 5f61 6e64 5f77 7269 7465 2829 0a20  es_and_write(). 
-0001e0b0: 2020 2020 2020 2072 6574 7572 6e20 6874         return ht
-0001e0c0: 6d6c 5f65 6c65 6d0a 0a0a 636c 6173 7320  ml_elem...class 
-0001e0d0: 466c 6f61 7445 7874 7261 6374 6f72 3a0a  FloatExtractor:.
-0001e0e0: 2020 2020 2222 2265 7874 7261 6374 7320      """extracts 
-0001e0f0: 666c 6f61 7473 2028 626f 7865 732c 2066  floats (boxes, f
-0001e100: 6967 7572 6573 2c20 6574 632e 2920 7573  igures, etc.) us
-0001e110: 696e 6720 7374 6172 742f 656e 6420 7265  ing start/end re
-0001e120: 6765 7865 730a 2020 2020 2222 220a 0a20  gexes.    """.. 
-0001e130: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-0001e140: 7365 6c66 2c20 7265 6765 783d 4e6f 6e65  self, regex=None
-0001e150: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
-0001e160: 7265 6765 7820 3d20 7265 6765 780a 0a20  regex = regex.. 
-0001e170: 2020 2064 6566 2065 7874 7261 6374 5f66     def extract_f
-0001e180: 6c6f 6174 5f62 6f75 6e64 6172 6965 7328  loat_boundaries(
-0001e190: 7365 6c66 2c20 6874 6d6c 5f65 6c65 6d2c  self, html_elem,
-0001e1a0: 2072 6567 6578 5f73 7472 293a 0a20 2020   regex_str):.   
-0001e1b0: 2020 2020 2066 6c6f 6174 5f62 6f75 6e64       float_bound
-0001e1c0: 6172 6965 7320 3d20 5b5d 0a20 2020 2020  aries = [].     
-0001e1d0: 2020 2072 6567 6578 203d 2072 652e 636f     regex = re.co
-0001e1e0: 6d70 696c 6528 7265 6765 785f 7374 7229  mpile(regex_str)
-0001e1f0: 0a20 2020 2020 2020 2023 2070 7269 6e74  .        # print
-0001e200: 2866 2220 7265 6765 7820 7b72 6567 6578  (f" regex {regex
-0001e210: 7d22 290a 2020 2020 2020 2020 6469 7673  }").        divs
-0001e220: 203d 2068 746d 6c5f 656c 656d 2e78 7061   = html_elem.xpa
-0001e230: 7468 2822 2e2f 2f64 6976 2229 0a20 2020  th(".//div").   
-0001e240: 2020 2020 2066 6f72 2064 6976 2069 6e20       for div in 
-0001e250: 6469 7673 3a0a 2020 2020 2020 2020 2020  divs:.          
-0001e260: 2020 7370 616e 7320 3d20 6469 762e 7870    spans = div.xp
-0001e270: 6174 6828 222e 2f73 7061 6e22 290a 2020  ath("./span").  
-0001e280: 2020 2020 2020 2020 2020 666f 7220 7370            for sp
-0001e290: 616e 2069 6e20 7370 616e 733a 0a20 2020  an in spans:.   
-0001e2a0: 2020 2020 2020 2020 2020 2020 206d 6174               mat
-0001e2b0: 6368 203d 2072 652e 7365 6172 6368 2872  ch = re.search(r
-0001e2c0: 6567 6578 2c20 7370 616e 2e74 6578 7429  egex, span.text)
-0001e2d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e2e0: 2069 6620 6d61 7463 683a 0a20 2020 2020   if match:.     
-0001e2f0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001e300: 6c6f 6174 5f62 6f75 6e64 6172 7920 3d20  loat_boundary = 
-0001e310: 466c 6f61 7442 6f75 6e64 6172 7928 290a  FloatBoundary().
-0001e320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e330: 2020 2020 666c 6f61 745f 626f 756e 6461      float_bounda
-0001e340: 7279 2e64 6976 5f69 6420 3d20 6469 762e  ry.div_id = div.
-0001e350: 6174 7472 6962 5b22 6964 225d 0a20 2020  attrib["id"].   
-0001e360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e370: 2066 6f72 2066 6965 6c64 2069 6e20 5b53   for field in [S
-0001e380: 5441 5254 454e 442c 204f 424a 4543 542c  TARTEND, OBJECT,
-0001e390: 2049 445d 3a0a 2020 2020 2020 2020 2020   ID]:.          
-0001e3a0: 2020 2020 2020 2020 2020 2020 2020 666c                fl
-0001e3b0: 6f61 745f 626f 756e 6461 7279 2e61 6464  oat_boundary.add
-0001e3c0: 2866 6965 6c64 2c20 6d61 7463 682e 6772  (field, match.gr
-0001e3d0: 6f75 7028 6669 656c 6429 290a 2020 2020  oup(field)).    
-0001e3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e3f0: 666c 6f61 745f 626f 756e 6461 7269 6573  float_boundaries
-0001e400: 2e61 7070 656e 6428 666c 6f61 745f 626f  .append(float_bo
-0001e410: 756e 6461 7279 290a 2020 2020 2020 2020  undary).        
-0001e420: 7265 7475 726e 2066 6c6f 6174 5f62 6f75  return float_bou
-0001e430: 6e64 6172 6965 730a 0a0a 636c 6173 7320  ndaries...class 
-0001e440: 4353 5353 7479 6c65 3a0a 2020 2020 2222  CSSStyle:.    ""
-0001e450: 220a 2020 2020 636f 6d6d 6f6e 2073 7562  ".    common sub
-0001e460: 7365 7420 6f66 2043 5353 2073 7479 6c65  set of CSS style
-0001e470: 732f 636f 6d6d 616e 6473 0a20 2020 2022  s/commands.    "
-0001e480: 2222 0a20 2020 2023 2061 6c6c 2061 7265  "".    # all are
-0001e490: 206c 6f77 6572 6361 7365 0a20 2020 2042   lowercase.    B
-0001e4a0: 4f4c 4420 3d20 2262 6f6c 6422 0a20 2020  OLD = "bold".   
-0001e4b0: 2042 4f52 4445 5220 3d20 2262 6f72 6465   BORDER = "borde
-0001e4c0: 7222 0a20 2020 2042 4f54 544f 4d20 3d20  r".    BOTTOM = 
-0001e4d0: 2262 6f74 746f 6d22 0a20 2020 2043 4f4c  "bottom".    COL
-0001e4e0: 4f52 203d 2022 636f 6c6f 7222 0a20 2020  OR = "color".   
-0001e4f0: 2044 4f54 5f42 203d 2022 2e42 220a 2020   DOT_B = ".B".  
-0001e500: 2020 4649 4c4c 203d 2022 6669 6c6c 220a    FILL = "fill".
-0001e510: 2020 2020 5354 524f 4b45 203d 2022 7374      STROKE = "st
-0001e520: 726f 6b65 220a 2020 2020 464f 4e54 5f46  roke".    FONT_F
-0001e530: 414d 494c 5920 3d20 2266 6f6e 742d 6661  AMILY = "font-fa
-0001e540: 6d69 6c79 220a 2020 2020 464f 4e54 5f53  mily".    FONT_S
-0001e550: 495a 4520 3d20 2266 6f6e 742d 7369 7a65  IZE = "font-size
-0001e560: 220a 2020 2020 464f 4e54 5f53 5459 4c45  ".    FONT_STYLE
-0001e570: 203d 2022 666f 6e74 2d73 7479 6c65 220a   = "font-style".
-0001e580: 2020 2020 464f 4e54 5f53 5452 4554 4348      FONT_STRETCH
-0001e590: 4544 203d 2022 666f 6e74 2d73 7472 6574  ED = "font-stret
-0001e5a0: 6368 6564 220a 2020 2020 464f 4e54 5f57  ched".    FONT_W
-0001e5b0: 4549 4748 5420 3d20 2266 6f6e 742d 7765  EIGHT = "font-we
-0001e5c0: 6967 6874 220a 2020 2020 4845 4947 4854  ight".    HEIGHT
-0001e5d0: 203d 2022 6865 6967 6874 220a 2020 2020   = "height".    
-0001e5e0: 4954 414c 4943 203d 2022 6974 616c 6963  ITALIC = "italic
-0001e5f0: 220a 2020 2020 4c45 4654 203d 2022 6c65  ".    LEFT = "le
-0001e600: 6674 220a 2020 2020 4c49 4748 5420 3d20  ft".    LIGHT = 
-0001e610: 226c 6967 6874 220a 2020 2020 4e4f 524d  "light".    NORM
-0001e620: 414c 203d 2022 6e6f 726d 616c 220a 2020  AL = "normal".  
-0001e630: 2020 4f50 4143 4954 5920 3d20 226f 7061    OPACITY = "opa
-0001e640: 6369 7479 220a 2020 2020 504f 5349 5449  city".    POSITI
-0001e650: 4f4e 203d 2022 706f 7369 7469 6f6e 220a  ON = "position".
-0001e660: 2020 2020 5058 203d 2022 7078 220a 2020      PX = "px".  
-0001e670: 2020 5354 594c 4520 3d20 2273 7479 6c65    STYLE = "style
-0001e680: 220a 2020 2020 544f 5020 3d20 2274 6f70  ".    TOP = "top
-0001e690: 220a 2020 2020 5749 4454 4820 3d20 2277  ".    WIDTH = "w
-0001e6a0: 6964 7468 220a 0a20 2020 2057 4549 4748  idth"..    WEIGH
-0001e6b0: 545f 5245 203d 2022 285b 2d2e 5d3f 426f  T_RE = "([-.]?Bo
-0001e6c0: 6c64 7c5b 2e5d 5b42 625d 2429 220a 2020  ld|[.][Bb]$)".  
-0001e6d0: 2020 5354 594c 455f 5245 203d 2022 285b    STYLE_RE = "([
-0001e6e0: 2d2e 5d3f 4974 616c 283a 3f69 6329 7c5b  -.]?Ital(:?ic)|[
-0001e6f0: 2d2e 5d3f 4f62 6c69 7175 657c 5b2e 5d5b  -.]?Oblique|[.][
-0001e700: 4969 5d24 2922 0a0a 2020 2020 5445 5854  Ii]$)"..    TEXT
-0001e710: 5f53 5459 4c45 5f43 4f4d 504f 4e45 4e54  _STYLE_COMPONENT
-0001e720: 5320 3d20 5b46 4f4e 545f 5354 594c 452c  S = [FONT_STYLE,
-0001e730: 2046 4f4e 545f 5745 4947 4854 2c20 464f   FONT_WEIGHT, FO
-0001e740: 4e54 5f46 414d 494c 592c 2046 4f4e 545f  NT_FAMILY, FONT_
-0001e750: 5349 5a45 2c20 434f 4c4f 522c 204f 5041  SIZE, COLOR, OPA
-0001e760: 4349 5459 5d0a 0a20 2020 2064 6566 205f  CITY]..    def _
-0001e770: 5f69 6e69 745f 5f28 7365 6c66 293a 0a20  _init__(self):. 
-0001e780: 2020 2020 2020 2073 656c 662e 6e61 6d65         self.name
-0001e790: 5f76 616c 7565 5f64 6963 7420 3d20 6469  _value_dict = di
-0001e7a0: 6374 2829 0a0a 2020 2020 6465 6620 5f5f  ct()..    def __
-0001e7b0: 7374 725f 5f28 7365 6c66 293a 0a20 2020  str__(self):.   
-0001e7c0: 2020 2020 2073 203d 2022 220a 2020 2020       s = "".    
-0001e7d0: 2020 2020 666f 7220 6b2c 2076 2069 6e20      for k, v in 
-0001e7e0: 7365 6c66 2e6e 616d 655f 7661 6c75 655f  self.name_value_
-0001e7f0: 6469 6374 2e69 7465 6d73 2829 3a0a 2020  dict.items():.  
-0001e800: 2020 2020 2020 2020 2020 7320 2b3d 2066            s += f
-0001e810: 227b 6b7d 3a7b 767d 3b20 220a 2020 2020  "{k}:{v}; ".    
-0001e820: 2020 2020 7320 3d20 732e 7374 7269 7028      s = s.strip(
-0001e830: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0001e840: 2073 0a0a 2020 2020 6465 6620 5f5f 7265   s..    def __re
-0001e850: 7072 5f5f 2873 656c 6629 3a0a 2020 2020  pr__(self):.    
-0001e860: 2020 2020 7265 7475 726e 2066 227b 7365      return f"{se
-0001e870: 6c66 2e6e 616d 655f 7661 6c75 655f 6469  lf.name_value_di
-0001e880: 6374 7d22 0a0a 2020 2020 2320 2020 2063  ct}"..    #    c
-0001e890: 6c61 7373 2043 5353 5374 796c 653a 0a0a  lass CSSStyle:..
-0001e8a0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-0001e8b0: 0a20 2020 2064 6566 2063 7265 6174 655f  .    def create_
-0001e8c0: 6373 735f 7374 796c 655f 6672 6f6d 5f61  css_style_from_a
-0001e8d0: 7474 7269 6275 7465 5f6f 665f 626f 6479  ttribute_of_body
-0001e8e0: 5f65 6c65 6d65 6e74 2863 6c73 2c20 656c  _element(cls, el
-0001e8f0: 656d 293a 0a20 2020 2020 2020 2022 2222  em):.        """
-0001e900: 6372 6561 7465 2043 5353 5374 796c 6520  create CSSStyle 
-0001e910: 6f62 6a65 6374 2066 726f 6d20 656c 656d  object from elem
-0001e920: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0001e930: 656c 656d 3a0a 2020 2020 2020 2020 2222  elem:.        ""
-0001e940: 220a 2020 2020 2020 2020 6966 2065 6c65  ".        if ele
-0001e950: 6d20 6973 204e 6f6e 653a 0a20 2020 2020  m is None:.     
-0001e960: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-0001e970: 6e65 0a20 2020 2020 2020 2061 7373 6572  ne.        asser
-0001e980: 7420 7479 7065 2865 6c65 6d29 2069 7320  t type(elem) is 
-0001e990: 5f45 6c65 6d65 6e74 2c20 6622 666f 756e  _Element, f"foun
-0001e9a0: 6420 7b74 7970 6528 656c 656d 297d 220a  d {type(elem)}".
-0001e9b0: 2020 2020 2020 2020 6373 735f 7374 796c          css_styl
-0001e9c0: 6520 3d20 4353 5353 7479 6c65 2829 0a20  e = CSSStyle(). 
-0001e9d0: 2020 2020 2020 2073 7479 6c65 5f61 7474         style_att
-0001e9e0: 7661 6c20 3d20 656c 656d 2e67 6574 2843  val = elem.get(C
-0001e9f0: 5353 5374 796c 652e 5354 594c 4529 0a20  SSStyle.STYLE). 
-0001ea00: 2020 2020 2020 2063 7373 5f73 7479 6c65         css_style
-0001ea10: 2e6e 616d 655f 7661 6c75 655f 6469 6374  .name_value_dict
-0001ea20: 203d 2063 6c73 2e63 7265 6174 655f 6469   = cls.create_di
-0001ea30: 6374 5f66 726f 6d5f 6e61 6d65 5f76 616c  ct_from_name_val
-0001ea40: 7565 5f61 7272 6179 5f73 7472 696e 6728  ue_array_string(
-0001ea50: 7374 796c 655f 6174 7476 616c 290a 2020  style_attval).  
-0001ea60: 2020 2020 2020 7265 7475 726e 2063 7373        return css
-0001ea70: 5f73 7479 6c65 0a0a 2020 2020 2320 2020  _style..    #   
-0001ea80: 2063 6c61 7373 2043 5353 5374 796c 653a   class CSSStyle:
-0001ea90: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-0001eaa0: 6f64 0a20 2020 2064 6566 2063 7265 6174  od.    def creat
-0001eab0: 655f 6469 6374 5f66 726f 6d5f 6e61 6d65  e_dict_from_name
-0001eac0: 5f76 616c 7565 5f61 7272 6179 5f73 7472  _value_array_str
-0001ead0: 696e 6728 636c 732c 2073 7479 6c65 5f73  ing(cls, style_s
-0001eae0: 7472 2c20 7265 6d6f 7665 5f63 7572 6c79  tr, remove_curly
-0001eaf0: 3d54 7275 6529 3a0a 2020 2020 2020 2020  =True):.        
-0001eb00: 2222 220a 2020 2020 2020 2020 6173 7375  """.        assu
-0001eb10: 6d65 7320 7374 7269 6e67 206f 6620 7479  mes string of ty
-0001eb20: 7065 2022 613a 2062 3b20 633a 2064 3b22  pe "a: b; c: d;"
-0001eb30: 206f 7074 696f 6e61 6c6c 7920 656e 636c   optionally encl
-0001eb40: 6f73 6564 2069 6e20 7b2e 2e2e 7d0a 2020  osed in {...}.  
-0001eb50: 2020 2020 2020 3a70 6172 616d 2073 7479        :param sty
-0001eb60: 6c65 5f73 7472 3a20 0a20 2020 2020 2020  le_str: .       
-0001eb70: 2022 2222 0a20 2020 2020 2020 2072 655f   """.        re_
-0001eb80: 7374 7220 3d20 2228 3f50 3c70 7265 3e2e  str = "(?P<pre>.
-0001eb90: 2a29 7b28 3f50 3c63 7572 6c79 3e2e 2a29  *){(?P<curly>.*)
-0001eba0: 7d28 3f50 3c70 6f73 743e 2e2a 2922 0a20  }(?P<post>.*)". 
-0001ebb0: 2020 2020 2020 2063 7572 6c79 5f72 6520         curly_re 
-0001ebc0: 3d20 7265 2e63 6f6d 7069 6c65 2872 655f  = re.compile(re_
-0001ebd0: 7374 7229 0a20 2020 2020 2020 206e 616d  str).        nam
-0001ebe0: 655f 7661 6c75 655f 6469 6374 203d 2064  e_value_dict = d
-0001ebf0: 6963 7428 290a 2020 2020 2020 2020 6966  ict().        if
-0001ec00: 2074 7970 6528 7374 796c 655f 7374 7229   type(style_str)
-0001ec10: 2069 7320 4353 5353 7479 6c65 3a0a 2020   is CSSStyle:.  
-0001ec20: 2020 2020 2020 2020 2020 7374 796c 655f            style_
-0001ec30: 7374 7220 3d20 7374 796c 655f 7374 722e  str = style_str.
-0001ec40: 6765 745f 6373 735f 7661 6c75 6528 7374  get_css_value(st
-0001ec50: 796c 655f 7374 7229 0a20 2020 2020 2020  yle_str).       
-0001ec60: 2069 6620 7374 796c 655f 7374 723a 0a20   if style_str:. 
-0001ec70: 2020 2020 2020 2020 2020 2069 6620 7265             if re
-0001ec80: 6d6f 7665 5f63 7572 6c79 3a0a 2020 2020  move_curly:.    
-0001ec90: 2020 2020 2020 2020 2020 2020 6d61 7463              matc
-0001eca0: 6820 3d20 6375 726c 795f 7265 2e6d 6174  h = curly_re.mat
-0001ecb0: 6368 2873 7479 6c65 5f73 7472 290a 2020  ch(style_str).  
-0001ecc0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001ecd0: 206d 6174 6368 3a0a 2020 2020 2020 2020   match:.        
-0001ece0: 2020 2020 2020 2020 2020 2020 7374 796c              styl
-0001ecf0: 655f 7374 7220 3d20 6d61 7463 682e 6772  e_str = match.gr
-0001ed00: 6f75 7028 2263 7572 6c79 2229 0a20 2020  oup("curly").   
-0001ed10: 2020 2020 2020 2020 206e 616d 655f 7661           name_va
-0001ed20: 6c75 655f 6469 6374 203d 2063 6c73 2e63  lue_dict = cls.c
-0001ed30: 7265 6174 655f 6e61 6d65 5f76 616c 7565  reate_name_value
-0001ed40: 5f64 6963 7428 7374 796c 655f 7374 7229  _dict(style_str)
-0001ed50: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001ed60: 6e61 6d65 5f76 616c 7565 5f64 6963 740a  name_value_dict.
-0001ed70: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
-0001ed80: 640a 2020 2020 6465 6620 6372 6561 7465  d.    def create
-0001ed90: 5f6e 616d 655f 7661 6c75 655f 6469 6374  _name_value_dict
-0001eda0: 2863 6c73 2c20 7374 796c 655f 7374 7229  (cls, style_str)
-0001edb0: 3a0a 2020 2020 2020 2020 6e61 6d65 5f76  :.        name_v
-0001edc0: 616c 7565 5f64 6963 7420 3d20 6469 6374  alue_dict = dict
-0001edd0: 2829 0a20 2020 2020 2020 2073 7479 6c65  ().        style
-0001ede0: 5f73 7472 203d 2073 7479 6c65 5f73 7472  _str = style_str
-0001edf0: 2e73 7472 6970 2829 0a20 2020 2020 2020  .strip().       
-0001ee00: 2073 7479 6c65 7320 3d20 7374 796c 655f   styles = style_
-0001ee10: 7374 722e 7370 6c69 7428 223b 2229 0a20  str.split(";"). 
-0001ee20: 2020 2020 2020 2066 6f72 2073 7479 6c65         for style
-0001ee30: 2069 6e20 7374 796c 6573 3a0a 2020 2020   in styles:.    
-0001ee40: 2020 2020 2020 2020 7374 796c 6520 3d20          style = 
-0001ee50: 7374 796c 652e 7374 7269 7028 290a 2020  style.strip().  
-0001ee60: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-0001ee70: 2873 7479 6c65 2920 3e20 303a 0a20 2020  (style) > 0:.   
-0001ee80: 2020 2020 2020 2020 2020 2020 2073 7320               ss 
-0001ee90: 3d20 7374 796c 652e 7370 6c69 7428 223a  = style.split(":
-0001eea0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0001eeb0: 2020 2069 6620 6c65 6e28 7373 2920 213d     if len(ss) !=
-0001eec0: 2032 3a0a 2020 2020 2020 2020 2020 2020   2:.            
-0001eed0: 2020 2020 2020 2020 7261 6973 6520 4b65          raise Ke
-0001eee0: 7945 7272 6f72 2866 2262 6164 2073 7479  yError(f"bad sty
-0001eef0: 6c65 207b 7374 796c 657d 2069 6e20 4353  le {style} in CS
-0001ef00: 533a 207b 7374 796c 655f 7374 727d 2229  S: {style_str}")
-0001ef10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ef20: 206e 616d 6520 3d20 7373 5b30 5d2e 7374   name = ss[0].st
-0001ef30: 7269 7028 290a 2020 2020 2020 2020 2020  rip().          
-0001ef40: 2020 2020 2020 6966 206e 616d 6520 696e        if name in
-0001ef50: 206e 616d 655f 7661 6c75 655f 6469 6374   name_value_dict
-0001ef60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001ef70: 2020 2020 2020 7261 6973 6520 4b65 7945        raise KeyE
-0001ef80: 7272 6f72 2866 227b 6e61 6d65 7d20 6475  rror(f"{name} du
-0001ef90: 706c 6963 6174 6564 2069 6e20 4353 533a  plicated in CSS:
-0001efa0: 207b 7374 796c 655f 7374 727d 2229 0a20   {style_str}"). 
-0001efb0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0001efc0: 616d 655f 7661 6c75 655f 6469 6374 5b6e  ame_value_dict[n
-0001efd0: 616d 655d 203d 2073 735b 315d 2e73 7472  ame] = ss[1].str
-0001efe0: 6970 2829 0a20 2020 2020 2020 2072 6574  ip().        ret
-0001eff0: 7572 6e20 6e61 6d65 5f76 616c 7565 5f64  urn name_value_d
-0001f000: 6963 740a 0a20 2020 2023 2020 2020 636c  ict..    #    cl
-0001f010: 6173 7320 4353 5353 7479 6c65 3a0a 0a20  ass CSSStyle:.. 
-0001f020: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-0001f030: 2020 2020 6465 6620 6372 6561 7465 5f63      def create_c
-0001f040: 7373 5f73 7479 6c65 5f66 726f 6d5f 6373  ss_style_from_cs
-0001f050: 735f 7374 7269 6e67 2863 6c73 2c20 6373  s_string(cls, cs
-0001f060: 735f 7374 7269 6e67 2c20 7265 6d6f 7665  s_string, remove
-0001f070: 5f70 7265 6669 783d 5472 7565 293a 0a20  _prefix=True):. 
-0001f080: 2020 2020 2020 2022 2222 6372 6561 7465         """create
-0001f090: 7320 4353 5353 7479 6c65 206f 626a 6563  s CSSStyle objec
-0001f0a0: 7420 6672 6f6d 2043 5353 2073 7472 696e  t from CSS strin
-0001f0b0: 6722 2222 0a20 2020 2020 2020 2063 7373  g""".        css
-0001f0c0: 5f73 7479 6c65 203d 204e 6f6e 650a 2020  _style = None.  
-0001f0d0: 2020 2020 2020 6966 2063 7373 5f73 7472        if css_str
-0001f0e0: 696e 673a 0a20 2020 2020 2020 2020 2020  ing:.           
-0001f0f0: 2063 7373 5f73 7479 6c65 203d 2043 5353   css_style = CSS
-0001f100: 5374 796c 6528 290a 2020 2020 2020 2020  Style().        
-0001f110: 2020 2020 6373 735f 7374 796c 652e 6e61      css_style.na
-0001f120: 6d65 5f76 616c 7565 5f64 6963 7420 3d20  me_value_dict = 
-0001f130: 636c 732e 6372 6561 7465 5f64 6963 745f  cls.create_dict_
-0001f140: 6672 6f6d 5f6e 616d 655f 7661 6c75 655f  from_name_value_
-0001f150: 6172 7261 795f 7374 7269 6e67 2863 7373  array_string(css
-0001f160: 5f73 7472 696e 6729 0a20 2020 2020 2020  _string).       
-0001f170: 2020 2020 2069 6620 7265 6d6f 7665 5f70       if remove_p
-0001f180: 7265 6669 783a 0a20 2020 2020 2020 2020  refix:.         
-0001f190: 2020 2020 2020 2066 6f6e 745f 6661 6d69         font_fami
-0001f1a0: 6c79 203d 2063 7373 5f73 7479 6c65 2e6e  ly = css_style.n
-0001f1b0: 616d 655f 7661 6c75 655f 6469 6374 2e67  ame_value_dict.g
-0001f1c0: 6574 2843 5353 5374 796c 652e 464f 4e54  et(CSSStyle.FONT
-0001f1d0: 5f46 414d 494c 5929 0a20 2020 2020 2020  _FAMILY).       
-0001f1e0: 2020 2020 2020 2020 2066 6f6e 745f 6661           font_fa
-0001f1f0: 6d69 6c79 3120 3d20 416d 6946 6f6e 742e  mily1 = AmiFont.
-0001f200: 7472 696d 5f70 6466 5f70 7265 6669 7828  trim_pdf_prefix(
-0001f210: 666f 6e74 5f66 616d 696c 7929 0a20 2020  font_family).   
-0001f220: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001f230: 666f 6e74 5f66 616d 696c 7931 2061 6e64  font_family1 and
-0001f240: 2066 6f6e 745f 6661 6d69 6c79 3120 213d   font_family1 !=
-0001f250: 2066 6f6e 745f 6661 6d69 6c79 3a0a 2020   font_family:.  
-0001f260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f270: 2020 6373 735f 7374 796c 652e 6e61 6d65    css_style.name
-0001f280: 5f76 616c 7565 5f64 6963 745b 4353 5353  _value_dict[CSSS
-0001f290: 7479 6c65 2e46 4f4e 545f 4641 4d49 4c59  tyle.FONT_FAMILY
-0001f2a0: 5d20 3d20 666f 6e74 5f66 616d 696c 7931  ] = font_family1
-0001f2b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001f2c0: 6373 735f 7374 796c 650a 0a20 2020 2064  css_style..    d
-0001f2d0: 6566 205f 5f65 715f 5f28 7365 6c66 2c20  ef __eq__(self, 
-0001f2e0: 6f74 6865 7229 3a0a 2020 2020 2020 2020  other):.        
-0001f2f0: 2222 220a 2020 2020 2020 2020 7465 7374  """.        test
-0001f300: 7320 7768 6574 6865 7220 7365 6c66 2061  s whether self a
-0001f310: 6e64 206f 7468 6572 2068 6176 6520 6571  nd other have eq
-0001f320: 7561 6c20 6469 6374 696f 6e61 7269 6573  ual dictionaries
-0001f330: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0001f340: 2020 2020 2069 6620 7479 7065 286f 7468       if type(oth
-0001f350: 6572 2920 6973 2043 5353 5374 796c 653a  er) is CSSStyle:
-0001f360: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0001f370: 7572 6e20 7365 6c66 2e6e 616d 655f 7661  urn self.name_va
-0001f380: 6c75 655f 6469 6374 203d 3d20 6f74 6865  lue_dict == othe
-0001f390: 722e 6e61 6d65 5f76 616c 7565 5f64 6963  r.name_value_dic
-0001f3a0: 740a 2020 2020 2020 2020 7265 7475 726e  t.        return
-0001f3b0: 2046 616c 7365 0a0a 2020 2020 6465 6620   False..    def 
-0001f3c0: 7365 745f 6174 7472 6962 7574 6528 7365  set_attribute(se
-0001f3d0: 6c66 2c20 7072 6f70 6572 7479 2c20 7661  lf, property, va
-0001f3e0: 6c75 6529 3a0a 2020 2020 2020 2020 2222  lue):.        ""
-0001f3f0: 220a 2020 2020 2020 2020 7365 7473 206e  ".        sets n
-0001f400: 616d 652d 7661 6c75 6520 7061 6972 2069  ame-value pair i
-0001f410: 6e20 4353 5353 7479 6c65 0a20 2020 2020  n CSSStyle.     
-0001f420: 2020 2069 676e 6f72 6573 2065 6d70 7479     ignores empty
-0001f430: 2076 616c 7565 7320 6f72 204e 6f6e 650a   values or None.
-0001f440: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001f450: 2020 2020 6966 2076 616c 7565 2061 6e64      if value and
-0001f460: 206c 656e 2873 7472 2876 616c 7565 2929   len(str(value))
-0001f470: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
-0001f480: 2020 7365 6c66 2e6e 616d 655f 7661 6c75    self.name_valu
-0001f490: 655f 6469 6374 5b70 726f 7065 7274 795d  e_dict[property]
-0001f4a0: 203d 2076 616c 7565 0a0a 2020 2020 6465   = value..    de
-0001f4b0: 6620 7365 745f 6661 6d69 6c79 2873 656c  f set_family(sel
-0001f4c0: 662c 2066 616d 696c 7929 3a0a 2020 2020  f, family):.    
-0001f4d0: 2020 2020 6966 2066 616d 696c 793a 0a20      if family:. 
-0001f4e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0001f4f0: 7365 745f 6174 7472 6962 7574 6528 4353  set_attribute(CS
-0001f500: 5353 7479 6c65 2e46 4f4e 545f 4641 4d49  SStyle.FONT_FAMI
-0001f510: 4c59 2c20 6661 6d69 6c79 290a 0a20 2020  LY, family)..   
-0001f520: 2064 6566 2073 6574 5f66 6f6e 745f 7765   def set_font_we
-0001f530: 6967 6874 2873 656c 662c 2077 6569 6768  ight(self, weigh
-0001f540: 7429 3a0a 2020 2020 2020 2020 7765 6967  t):.        weig
-0001f550: 6874 203d 2077 6569 6768 742e 6c6f 7765  ht = weight.lowe
-0001f560: 7228 290a 2020 2020 2020 2020 6966 2077  r().        if w
-0001f570: 6569 6768 743a 0a20 2020 2020 2020 2020  eight:.         
-0001f580: 2020 2069 6620 7765 6967 6874 203d 3d20     if weight == 
-0001f590: 4353 5353 7479 6c65 2e4e 4f52 4d41 4c3a  CSSStyle.NORMAL:
-0001f5a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f5b0: 2073 656c 662e 7365 745f 6174 7472 6962   self.set_attrib
-0001f5c0: 7574 6528 4353 5353 7479 6c65 2e46 4f4e  ute(CSSStyle.FON
-0001f5d0: 545f 5745 4947 4854 2c20 4353 5353 7479  T_WEIGHT, CSSSty
-0001f5e0: 6c65 2e4e 4f52 4d41 4c29 0a20 2020 2020  le.NORMAL).     
-0001f5f0: 2020 2020 2020 2069 6620 7765 6967 6874         if weight
-0001f600: 203d 3d20 4353 5353 7479 6c65 2e42 4f4c   == CSSStyle.BOL
-0001f610: 443a 0a20 2020 2020 2020 2020 2020 2020  D:.             
-0001f620: 2020 2073 656c 662e 7365 745f 6174 7472     self.set_attr
-0001f630: 6962 7574 6528 4353 5353 7479 6c65 2e46  ibute(CSSStyle.F
-0001f640: 4f4e 545f 5745 4947 4854 2c20 4353 5353  ONT_WEIGHT, CSSS
-0001f650: 7479 6c65 2e42 4f4c 4429 0a20 2020 2020  tyle.BOLD).     
-0001f660: 2020 2020 2020 2069 6620 7765 6967 6874         if weight
-0001f670: 203d 3d20 4353 5353 7479 6c65 2e4c 4947   == CSSStyle.LIG
-0001f680: 4854 3a0a 2020 2020 2020 2020 2020 2020  HT:.            
-0001f690: 2020 2020 7365 6c66 2e73 6574 5f61 7474      self.set_att
-0001f6a0: 7269 6275 7465 2843 5353 5374 796c 652e  ribute(CSSStyle.
-0001f6b0: 464f 4e54 5f57 4549 4748 542c 2043 5353  FONT_WEIGHT, CSS
-0001f6c0: 5374 796c 652e 4c49 4748 5429 0a0a 2020  Style.LIGHT)..  
-0001f6d0: 2020 6465 6620 7365 745f 666f 6e74 5f73    def set_font_s
-0001f6e0: 7479 6c65 2873 656c 662c 2073 7479 6c65  tyle(self, style
-0001f6f0: 293a 0a20 2020 2020 2020 2069 6620 7374  ):.        if st
-0001f700: 796c 653a 0a20 2020 2020 2020 2020 2020  yle:.           
-0001f710: 2069 6620 7374 796c 652e 6c6f 7765 7228   if style.lower(
-0001f720: 2920 3d3d 2043 5353 5374 796c 652e 4e4f  ) == CSSStyle.NO
-0001f730: 524d 414c 2e6c 6f77 6572 2829 3a0a 2020  RMAL.lower():.  
-0001f740: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0001f750: 6c66 2e73 6574 5f61 7474 7269 6275 7465  lf.set_attribute
-0001f760: 2843 5353 5374 796c 652e 464f 4e54 5f53  (CSSStyle.FONT_S
-0001f770: 5459 4c45 2c20 4353 5353 7479 6c65 2e4e  TYLE, CSSStyle.N
-0001f780: 4f52 4d41 4c29 0a20 2020 2020 2020 2020  ORMAL).         
-0001f790: 2020 2069 6620 7374 796c 652e 6c6f 7765     if style.lowe
-0001f7a0: 7228 2920 3d3d 2043 5353 5374 796c 652e  r() == CSSStyle.
-0001f7b0: 4954 414c 4943 2e6c 6f77 6572 2829 3a0a  ITALIC.lower():.
-0001f7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f7d0: 7365 6c66 2e73 6574 5f61 7474 7269 6275  self.set_attribu
-0001f7e0: 7465 2843 5353 5374 796c 652e 464f 4e54  te(CSSStyle.FONT
-0001f7f0: 5f53 5459 4c45 2c20 4353 5353 7479 6c65  _STYLE, CSSStyle
-0001f800: 2e49 5441 4c49 4329 0a0a 2020 2020 6465  .ITALIC)..    de
-0001f810: 6620 6765 745f 6174 7472 6962 7574 6528  f get_attribute(
-0001f820: 7365 6c66 2c20 7072 6f70 6572 7479 293a  self, property):
-0001f830: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0001f840: 2020 2020 2067 6574 7320 7661 6c75 6520       gets value 
-0001f850: 666f 7220 6e61 6d65 2069 6e20 4353 5353  for name in CSSS
-0001f860: 7479 6c65 0a20 2020 2020 2020 2069 676e  tyle.        ign
-0001f870: 6f72 6573 2065 6d70 7479 2076 616c 7565  ores empty value
-0001f880: 7320 6f72 204e 6f6e 650a 2020 2020 2020  s or None.      
-0001f890: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
-0001f8a0: 7475 726e 2073 656c 662e 6e61 6d65 5f76  turn self.name_v
-0001f8b0: 616c 7565 5f64 6963 7420 616e 6420 7365  alue_dict and se
-0001f8c0: 6c66 2e6e 616d 655f 7661 6c75 655f 6469  lf.name_value_di
-0001f8d0: 6374 2e67 6574 2870 726f 7065 7274 7929  ct.get(property)
-0001f8e0: 0a0a 2020 2020 2320 2020 2063 6c61 7373  ..    #    class
-0001f8f0: 2043 5353 5374 796c 653a 0a0a 2020 2020   CSSStyle:..    
-0001f900: 6465 6620 6765 745f 666f 6e74 5f73 7479  def get_font_sty
-0001f910: 6c65 5f61 7474 7269 6275 7465 7328 7365  le_attributes(se
-0001f920: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-0001f930: 0a20 2020 2020 2020 2067 6574 7320 7475  .        gets tu
-0001f940: 706c 6520 6f66 2034 2066 6f6e 7420 6174  ple of 4 font at
-0001f950: 7472 6962 7574 6573 2028 7369 7a65 2c20  tributes (size, 
-0001f960: 6e6f 6e73 7472 6f6b 652c 2073 7472 6f6b  nonstroke, strok
-0001f970: 652c 2066 6f6e 746e 616d 6529 0a20 2020  e, fontname).   
-0001f980: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-0001f990: 2020 6966 2073 656c 662e 6e61 6d65 5f76    if self.name_v
-0001f9a0: 616c 7565 5f64 6963 7420 6973 204e 6f6e  alue_dict is Non
-0001f9b0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-0001f9c0: 6574 7572 6e20 284e 6f6e 652c 204e 6f6e  eturn (None, Non
-0001f9d0: 652c 204e 6f6e 652c 204e 6f6e 652c 204e  e, None, None, N
-0001f9e0: 6f6e 6529 0a20 2020 2020 2020 2072 6574  one).        ret
-0001f9f0: 7572 6e20 280a 2020 2020 2020 2020 2020  urn (.          
-0001fa00: 2020 2320 7365 6c66 2e6e 616d 655f 7661    # self.name_va
-0001fa10: 6c75 655f 6469 6374 2e67 6574 2843 5353  lue_dict.get(CSS
-0001fa20: 5374 796c 652e 5749 4454 4829 2c0a 2020  Style.WIDTH),.  
-0001fa30: 2020 2020 2020 2020 2020 7365 6c66 2e67            self.g
-0001fa40: 6574 5f61 7474 7269 6275 7465 2843 5353  et_attribute(CSS
-0001fa50: 5374 796c 652e 464f 4e54 5f53 495a 4529  Style.FONT_SIZE)
-0001fa60: 2c0a 2020 2020 2020 2020 2020 2020 7365  ,.            se
-0001fa70: 6c66 2e67 6574 5f61 7474 7269 6275 7465  lf.get_attribute
-0001fa80: 2843 5353 5374 796c 652e 4649 4c4c 292c  (CSSStyle.FILL),
-0001fa90: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0001faa0: 662e 6765 745f 6174 7472 6962 7574 6528  f.get_attribute(
-0001fab0: 4353 5353 7479 6c65 2e53 5452 4f4b 4529  CSSStyle.STROKE)
-0001fac0: 2c0a 2020 2020 2020 2020 2020 2020 7365  ,.            se
-0001fad0: 6c66 2e67 6574 5f61 7474 7269 6275 7465  lf.get_attribute
-0001fae0: 2843 5353 5374 796c 652e 464f 4e54 5f46  (CSSStyle.FONT_F
-0001faf0: 414d 494c 5929 0a20 2020 2020 2020 2029  AMILY).        )
-0001fb00: 0a0a 2020 2020 2320 2020 2063 6c61 7373  ..    #    class
-0001fb10: 2043 5353 5374 796c 653a 0a0a 2020 2020   CSSStyle:..    
-0001fb20: 6465 6620 7265 6d6f 7665 2873 656c 662c  def remove(self,
-0001fb30: 206e 616d 6529 3a0a 2020 2020 2020 2020   name):.        
-0001fb40: 2222 220a 2020 2020 2020 2020 7265 6d6f  """.        remo
-0001fb50: 7665 7320 6e61 6d65 6420 6974 656d 2066  ves named item f
-0001fb60: 726f 6d20 4353 5353 7479 6c65 0a20 2020  rom CSSStyle.   
-0001fb70: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001fb80: 2069 6620 7479 7065 286e 616d 6529 2069   if type(name) i
-0001fb90: 7320 6c69 7374 3a0a 2020 2020 2020 2020  s list:.        
-0001fba0: 2020 2020 666f 7220 6e20 696e 206e 616d      for n in nam
-0001fbb0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001fbc0: 2020 2073 656c 662e 7265 6d6f 7665 286e     self.remove(n
-0001fbd0: 290a 2020 2020 2020 2020 656c 6966 206e  ).        elif n
-0001fbe0: 616d 6520 696e 2073 656c 662e 6e61 6d65  ame in self.name
-0001fbf0: 5f76 616c 7565 5f64 6963 743a 0a20 2020  _value_dict:.   
-0001fc00: 2020 2020 2020 2020 2073 656c 662e 6e61           self.na
-0001fc10: 6d65 5f76 616c 7565 5f64 6963 742e 706f  me_value_dict.po
-0001fc20: 7028 6e61 6d65 2c20 4e6f 6e65 290a 0a20  p(name, None).. 
-0001fc30: 2020 2064 6566 2061 7070 6c79 5f74 6f28     def apply_to(
-0001fc40: 7365 6c66 2c20 656c 656d 293a 0a20 2020  self, elem):.   
-0001fc50: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-0001fc60: 2020 2222 220a 2020 2020 2020 2020 6373    """.        cs
-0001fc70: 735f 7374 7220 3d20 7365 6c66 2e67 6574  s_str = self.get
-0001fc80: 5f63 7373 5f76 616c 7565 2829 0a20 2020  _css_value().   
-0001fc90: 2020 2020 2065 6c65 6d2e 6174 7472 6962       elem.attrib
-0001fca0: 5b43 5353 5374 796c 652e 5354 594c 455d  [CSSStyle.STYLE]
-0001fcb0: 203d 2063 7373 5f73 7472 0a0a 2020 2020   = css_str..    
-0001fcc0: 2320 2020 2063 6c61 7373 2043 5353 5374  #    class CSSSt
-0001fcd0: 796c 653a 0a0a 2020 2020 6465 6620 6765  yle:..    def ge
-0001fce0: 745f 6373 735f 7661 6c75 6528 7365 6c66  t_css_value(self
-0001fcf0: 2c20 7772 6170 5f77 6974 685f 6375 726c  , wrap_with_curl
-0001fd00: 793d 4661 6c73 6529 3a0a 2020 2020 2020  y=False):.      
-0001fd10: 2020 2222 220a 2020 2020 2020 2020 6765    """.        ge
-0001fd20: 6e65 7261 7465 7320 6373 7320 7374 7269  nerates css stri
-0001fd30: 6e67 2077 6974 686f 7574 2071 756f 7465  ng without quote
-0001fd40: 6420 6e61 6d65 7320 616e 6420 7661 6c75  d names and valu
-0001fd50: 6573 0a20 2020 2020 2020 203a 7061 7261  es.        :para
-0001fd60: 6d20 7772 6170 5f77 6974 685f 6375 726c  m wrap_with_curl
-0001fd70: 793a 2069 6620 7472 7565 2065 6e63 6c6f  y: if true enclo
-0001fd80: 7365 2073 7472 696e 6720 696e 2022 7b22  se string in "{"
-0001fd90: 202e 2e2e 2022 7d22 0a20 2020 2020 2020   ... "}".       
-0001fda0: 2022 2222 0a20 2020 2020 2020 2073 203d   """.        s =
-0001fdb0: 2022 220a 2020 2020 2020 2020 666f 7220   "".        for 
-0001fdc0: 6b65 7920 696e 2073 656c 662e 6e61 6d65  key in self.name
-0001fdd0: 5f76 616c 7565 5f64 6963 743a 0a20 2020  _value_dict:.   
-0001fde0: 2020 2020 2020 2020 2076 616c 203d 2073           val = s
-0001fdf0: 656c 662e 6e61 6d65 5f76 616c 7565 5f64  elf.name_value_d
-0001fe00: 6963 745b 6b65 795d 0a20 2020 2020 2020  ict[key].       
-0001fe10: 2020 2020 2073 202b 3d20 6b65 7920 2b20       s += key + 
-0001fe20: 223a 2022 202b 2073 7472 2876 616c 2920  ": " + str(val) 
-0001fe30: 2b20 223b 2022 0a20 2020 2020 2020 2073  + "; ".        s
-0001fe40: 203d 2073 2e73 7472 6970 2829 0a20 2020   = s.strip().   
-0001fe50: 2020 2020 2072 6574 7572 6e20 227b 2220       return "{" 
-0001fe60: 2b20 7320 2b20 227d 2220 6966 2077 7261  + s + "}" if wra
-0001fe70: 705f 7769 7468 5f63 7572 6c79 2065 6c73  p_with_curly els
-0001fe80: 6520 730a 0a20 2020 2064 6566 2061 7474  e s..    def att
-0001fe90: 7661 6c28 7365 6c66 2c20 6e61 6d65 293a  val(self, name):
-0001fea0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001feb0: 7365 6c66 2e6e 616d 655f 7661 6c75 655f  self.name_value_
-0001fec0: 6469 6374 2e67 6574 286e 616d 6529 2069  dict.get(name) i
-0001fed0: 6620 7365 6c66 2e6e 616d 655f 7661 6c75  f self.name_valu
-0001fee0: 655f 6469 6374 2065 6c73 6520 4e6f 6e65  e_dict else None
-0001fef0: 0a0a 2020 2020 2320 2020 2063 6c61 7373  ..    #    class
-0001ff00: 2043 5353 5374 796c 653a 0a0a 2020 2020   CSSStyle:..    
-0001ff10: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
-0001ff20: 6620 666f 6e74 5f66 616d 696c 7928 7365  f font_family(se
-0001ff30: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
-0001ff40: 7572 6e20 7365 6c66 2e61 7474 7661 6c28  urn self.attval(
-0001ff50: 4353 5353 7479 6c65 2e46 4f4e 545f 4641  CSSStyle.FONT_FA
-0001ff60: 4d49 4c59 290a 0a20 2020 2040 7072 6f70  MILY)..    @prop
-0001ff70: 6572 7479 0a20 2020 2064 6566 2074 6f70  erty.    def top
-0001ff80: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0001ff90: 7265 7475 726e 2073 656c 662e 6765 745f  return self.get_
-0001ffa0: 6e75 6d65 7269 635f 6174 7476 616c 2843  numeric_attval(C
-0001ffb0: 5353 5374 796c 652e 544f 5029 0a0a 2020  SSStyle.TOP)..  
-0001ffc0: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
-0001ffd0: 6465 6620 666f 6e74 5f73 697a 6528 7365  def font_size(se
-0001ffe0: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
-0001fff0: 7572 6e20 7365 6c66 2e67 6574 5f6e 756d  urn self.get_num
-00020000: 6572 6963 5f61 7474 7661 6c28 4353 5353  eric_attval(CSSS
-00020010: 7479 6c65 2e46 4f4e 545f 5349 5a45 290a  tyle.FONT_SIZE).
-00020020: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
-00020030: 2020 2064 6566 2069 735f 626f 6c64 2873     def is_bold(s
-00020040: 656c 6629 3a0a 2020 2020 2020 2020 7765  elf):.        we
-00020050: 6967 6874 203d 2073 656c 662e 6174 7476  ight = self.attv
-00020060: 616c 2843 5353 5374 796c 652e 464f 4e54  al(CSSStyle.FONT
-00020070: 5f57 4549 4748 5429 0a20 2020 2020 2020  _WEIGHT).       
-00020080: 2072 6574 7572 6e20 7765 6967 6874 2069   return weight i
-00020090: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2077  s not None and w
-000200a0: 6569 6768 742e 6c6f 7765 7228 2920 3d3d  eight.lower() ==
-000200b0: 2043 5353 5374 796c 652e 424f 4c44 2e6c   CSSStyle.BOLD.l
-000200c0: 6f77 6572 2829 0a0a 2020 2020 4070 726f  ower()..    @pro
-000200d0: 7065 7274 790a 2020 2020 6465 6620 6973  perty.    def is
-000200e0: 5f69 7461 6c69 6328 7365 6c66 293a 0a20  _italic(self):. 
-000200f0: 2020 2020 2020 2073 7479 6c65 203d 2073         style = s
-00020100: 656c 662e 6174 7476 616c 2843 5353 5374  elf.attval(CSSSt
-00020110: 796c 652e 464f 4e54 5f53 5459 4c45 290a  yle.FONT_STYLE).
-00020120: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00020130: 7479 6c65 2069 7320 6e6f 7420 4e6f 6e65  tyle is not None
-00020140: 2061 6e64 2073 7479 6c65 2e6c 6f77 6572   and style.lower
-00020150: 2829 203d 3d20 4353 5353 7479 6c65 2e49  () == CSSStyle.I
-00020160: 5441 4c49 432e 6c6f 7765 7228 290a 0a20  TALIC.lower().. 
-00020170: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-00020180: 2064 6566 2062 6f74 746f 6d28 7365 6c66   def bottom(self
-00020190: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-000201a0: 6e20 7365 6c66 2e67 6574 5f6e 756d 6572  n self.get_numer
-000201b0: 6963 5f61 7474 7661 6c28 4353 5353 7479  ic_attval(CSSSty
-000201c0: 6c65 2e42 4f54 544f 4d29 0a0a 2020 2020  le.BOTTOM)..    
-000201d0: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
-000201e0: 6620 6c65 6674 2873 656c 6629 3a0a 2020  f left(self):.  
-000201f0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00020200: 662e 6765 745f 6e75 6d65 7269 635f 6174  f.get_numeric_at
-00020210: 7476 616c 2843 5353 5374 796c 652e 4c45  tval(CSSStyle.LE
-00020220: 4654 290a 0a20 2020 2023 2020 2020 636c  FT)..    #    cl
-00020230: 6173 7320 4353 5353 7479 6c65 3a0a 0a20  ass CSSStyle:.. 
-00020240: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-00020250: 2064 6566 2077 6964 7468 2873 656c 6629   def width(self)
-00020260: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00020270: 2073 656c 662e 6765 745f 6e75 6d65 7269   self.get_numeri
-00020280: 635f 6174 7476 616c 2843 5353 5374 796c  c_attval(CSSStyl
-00020290: 652e 5749 4454 4829 0a0a 2020 2020 4070  e.WIDTH)..    @p
-000202a0: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-000202b0: 6865 6967 6874 2873 656c 6629 3a0a 2020  height(self):.  
-000202c0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-000202d0: 662e 6765 745f 6e75 6d65 7269 635f 6174  f.get_numeric_at
-000202e0: 7476 616c 2843 5353 5374 796c 652e 4845  tval(CSSStyle.HE
-000202f0: 4947 4854 290a 0a20 2020 2023 2020 2020  IGHT)..    #    
-00020300: 636c 6173 7320 4353 5353 7479 6c65 3a0a  class CSSStyle:.
-00020310: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
-00020320: 640a 2020 2020 6465 6620 6164 645f 6e61  d.    def add_na
-00020330: 6d65 5f76 616c 7565 2863 6c73 2c20 656c  me_value(cls, el
-00020340: 656d 2c20 6373 735f 6e61 6d65 2c20 6373  em, css_name, cs
-00020350: 735f 7661 6c75 6529 3a0a 2020 2020 2020  s_value):.      
-00020360: 2020 2222 2275 7064 6174 6573 2073 7479    """updates sty
-00020370: 6c65 206f 6e20 656c 656d 656e 740a 2020  le on element.  
-00020380: 2020 2020 2020 3a70 6172 616d 2063 7373        :param css
-00020390: 5f6e 616d 653a 206e 616d 6520 6f66 2070  _name: name of p
-000203a0: 726f 7065 7274 790a 2020 2020 2020 2020  roperty.        
-000203b0: 3a70 6172 616d 2063 7373 5f76 616c 7565  :param css_value
-000203c0: 3a20 7661 6c75 6520 6f66 2070 726f 7065  : value of prope
-000203d0: 7274 790a 2020 2020 2020 2020 2222 220a  rty.        """.
-000203e0: 2020 2020 2020 2020 6373 735f 7374 796c          css_styl
-000203f0: 6520 3d20 636c 732e 6372 6561 7465 5f63  e = cls.create_c
-00020400: 7373 5f73 7479 6c65 5f66 726f 6d5f 6174  ss_style_from_at
-00020410: 7472 6962 7574 655f 6f66 5f62 6f64 795f  tribute_of_body_
-00020420: 656c 656d 656e 7428 656c 656d 290a 2020  element(elem).  
-00020430: 2020 2020 2020 6373 735f 7374 796c 652e        css_style.
-00020440: 6e61 6d65 5f76 616c 7565 5f64 6963 745b  name_value_dict[
-00020450: 6373 735f 6e61 6d65 5d20 3d20 6373 735f  css_name] = css_
-00020460: 7661 6c75 650a 2020 2020 2020 2020 6373  value.        cs
-00020470: 735f 7374 796c 652e 6170 706c 795f 746f  s_style.apply_to
-00020480: 2865 6c65 6d29 0a0a 2020 2020 6465 6620  (elem)..    def 
-00020490: 6765 745f 6e75 6d65 7269 635f 6174 7476  get_numeric_attv
-000204a0: 616c 2873 656c 662c 206e 616d 652c 2064  al(self, name, d
-000204b0: 6563 696d 616c 3d31 293a 0a20 2020 2020  ecimal=1):.     
-000204c0: 2020 2022 2222 0a20 2020 2020 2020 2067     """.        g
-000204d0: 6574 7320 666c 6f61 7420 7661 6c75 652c  ets float value,
-000204e0: 2072 6f75 6e64 6564 2074 6f20 6465 6d69   rounded to demi
-000204f0: 6361 6c20 706c 6162 6573 0a20 2020 2020  cal plabes.     
-00020500: 2020 203a 7061 7261 6d20 6e61 6d65 3a20     :param name: 
-00020510: 6f66 2070 6172 616d 6574 6572 0a20 2020  of parameter.   
-00020520: 2020 2020 203a 7061 7261 6d20 726f 756e       :param roun
-00020530: 643a 206e 756d 6265 7220 6f66 2064 6563  d: number of dec
-00020540: 696d 616c 2070 6c61 6365 7320 2864 6566  imal places (def
-00020550: 6175 6c74 2032 290a 2020 2020 2020 2020  ault 2).        
-00020560: 2222 220a 2020 2020 2020 2020 7661 6c75  """.        valu
-00020570: 6520 3d20 7365 6c66 2e61 7474 7661 6c28  e = self.attval(
-00020580: 6e61 6d65 290a 2020 2020 2020 2020 6966  name).        if
-00020590: 206e 6f74 2076 616c 7565 3a0a 2020 2020   not value:.    
-000205a0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-000205b0: 6f6e 650a 2020 2020 2020 2020 6966 2074  one.        if t
-000205c0: 7970 6528 7661 6c75 6529 2069 7320 7374  ype(value) is st
-000205d0: 723a 0a20 2020 2020 2020 2020 2020 2076  r:.            v
-000205e0: 616c 7565 203d 2076 616c 7565 5b3a 2d32  alue = value[:-2
-000205f0: 5d20 6966 2076 616c 7565 2e65 6e64 7377  ] if value.endsw
-00020600: 6974 6828 4353 5353 7479 6c65 2e50 5829  ith(CSSStyle.PX)
-00020610: 2065 6c73 6520 7661 6c75 650a 2020 2020   else value.    
-00020620: 2020 2020 2020 2020 7661 6c75 6520 3d20          value = 
-00020630: 666c 6f61 7428 7661 6c75 6529 0a0a 2020  float(value)..  
-00020640: 2020 2020 2020 6673 203d 2072 6f75 6e64        fs = round
-00020650: 2866 6c6f 6174 2876 616c 7565 292c 2064  (float(value), d
-00020660: 6563 696d 616c 290a 2020 2020 2020 2020  ecimal).        
-00020670: 7265 7475 726e 2066 730a 0a20 2020 2023  return fs..    #
-00020680: 2020 2020 636c 6173 7320 4353 5353 7479      class CSSSty
-00020690: 6c65 3a0a 0a20 2020 2064 6566 2069 735f  le:..    def is_
-000206a0: 626f 6c64 5f6e 616d 6528 7365 6c66 293a  bold_name(self):
-000206b0: 0a20 2020 2020 2020 2022 2222 4865 7572  .        """Heur
-000206c0: 6973 7469 6320 7573 696e 6720 666f 6e74  istic using font
-000206d0: 2d6e 616d 650a 2020 2020 2020 2020 3a72  -name.        :r
-000206e0: 6574 7572 6e3a 2054 7275 6520 6966 206e  eturn: True if n
-000206f0: 616d 6520 636f 6e74 6169 6e73 2022 426f  ame contains "Bo
-00020700: 6c64 2220 6f72 2022 2e42 2220 6f72 202e  ld" or ".B" or .
-00020710: 2e22 2222 0a20 2020 2020 2020 2066 6f6e  .""".        fon
-00020720: 746e 616d 6520 3d20 7365 6c66 2e66 6f6e  tname = self.fon
-00020730: 745f 6661 6d69 6c79 0a20 2020 2020 2020  t_family.       
-00020740: 2072 6573 756c 7420 3d20 2873 656c 662e   result = (self.
-00020750: 424f 4c44 2069 6e20 666f 6e74 6e61 6d65  BOLD in fontname
-00020760: 2920 6f72 2028 666f 6e74 6e61 6d65 2e65  ) or (fontname.e
-00020770: 6e64 7377 6974 6828 7365 6c66 2e44 4f54  ndswith(self.DOT
-00020780: 5f42 2929 2069 6620 666f 6e74 6e61 6d65  _B)) if fontname
-00020790: 2065 6c73 6520 4661 6c73 650a 2020 2020   else False.    
-000207a0: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
-000207b0: 740a 0a20 2020 2023 2020 2020 636c 6173  t..    #    clas
-000207c0: 7320 4353 5353 7479 6c65 3a0a 0a20 2020  s CSSStyle:..   
-000207d0: 2064 6566 206f 6265 7973 2873 656c 662c   def obeys(self,
-000207e0: 2063 6f6e 6469 7469 6f6e 293a 0a20 2020   condition):.   
-000207f0: 2020 2020 2022 2222 7465 7374 2069 6620       """test if 
-00020800: 7374 796c 6520 6f62 6579 7320 6120 2873  style obeys a (s
-00020810: 696d 706c 6529 2063 6f6e 6469 7469 6f6e  imple) condition
-00020820: 0a20 2020 2020 2020 2028 4927 6c6c 2077  .        (I'll w
-00020830: 7269 7465 2061 2044 534c 206c 6174 6572  rite a DSL later
-00020840: 290a 2020 2020 2020 2020 3a70 6172 616d  ).        :param
-00020850: 2063 6f6e 6469 7469 6f6e 3a20 286e 616d   condition: (nam
-00020860: 652c 206f 7065 7261 746f 722c 2076 616c  e, operator, val
-00020870: 7565 292c 2065 2e67 2e20 2266 6f6e 742d  ue), e.g. "font-
-00020880: 7369 7a65 3e31 300a 2020 2020 2020 2020  size>10.        
-00020890: 3a72 6574 7572 6e3a 2074 6573 7420 6f66  :return: test of
-000208a0: 2063 6f6e 6469 7469 6f6e 0a0a 2020 2020   condition..    
-000208b0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000208c0: 7265 7375 6c74 203d 2046 616c 7365 0a20  result = False. 
-000208d0: 2020 2020 2020 2069 6620 636f 6e64 6974         if condit
-000208e0: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
-000208f0: 2073 7320 3d20 7265 2e73 706c 6974 2827   ss = re.split('
-00020900: 283e 7c3c 7c3d 3d7c 213d 2927 2c20 636f  (>|<|==|!=)', co
-00020910: 6e64 6974 696f 6e29 0a20 2020 2020 2020  ndition).       
-00020920: 2020 2020 2069 6620 6c65 6e28 7373 2920       if len(ss) 
-00020930: 213d 2033 3a0a 2020 2020 2020 2020 2020  != 3:.          
-00020940: 2020 2020 2020 6c6f 6767 696e 672e 7761        logging.wa
-00020950: 726e 696e 6728 6622 4361 6e6e 6f74 2070  rning(f"Cannot p
-00020960: 6172 7365 2061 7320 636f 6e64 6974 696f  arse as conditio
-00020970: 6e20 7b63 6f6e 6469 7469 6f6e 7d22 290a  n {condition}").
-00020980: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00020990: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000209a0: 2020 6c68 7320 3d20 7373 5b30 5d2e 7374    lhs = ss[0].st
-000209b0: 7269 7028 290a 2020 2020 2020 2020 2020  rip().          
-000209c0: 2020 2020 2020 7268 7320 3d20 7373 5b32        rhs = ss[2
-000209d0: 5d2e 7374 7269 7028 290a 0a20 2020 2020  ].strip()..     
-000209e0: 2020 2020 2020 2020 2020 2069 6620 6c68             if lh
-000209f0: 7320 6e6f 7420 696e 2073 656c 662e 6e61  s not in self.na
-00020a00: 6d65 5f76 616c 7565 5f64 6963 743a 0a20  me_value_dict:. 
-00020a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020a20: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-00020a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020a40: 7661 6c75 6531 203d 2073 656c 662e 6e61  value1 = self.na
-00020a50: 6d65 5f76 616c 7565 5f64 6963 742e 6765  me_value_dict.ge
-00020a60: 7428 6c68 7329 0a20 2020 2020 2020 2020  t(lhs).         
-00020a70: 2020 2020 2020 2069 6620 6e6f 7420 7661         if not va
-00020a80: 6c75 6531 3a0a 2020 2020 2020 2020 2020  lue1:.          
-00020a90: 2020 2020 2020 2020 2020 6c6f 6767 696e            loggin
-00020aa0: 672e 7761 726e 696e 6728 6622 7b6c 6873  g.warning(f"{lhs
-00020ab0: 7d20 6e6f 7420 696e 2073 7479 6c65 2061  } not in style a
-00020ac0: 7474 7269 6275 7465 207b 7365 6c66 2e6e  ttribute {self.n
-00020ad0: 616d 655f 7661 6c75 655f 6469 6374 7d22  ame_value_dict}"
-00020ae0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00020af0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-00020b00: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
-00020b10: 2020 2069 6620 7661 6c75 6531 2e65 6e64     if value1.end
-00020b20: 7377 6974 6828 4353 5353 7479 6c65 2e50  swith(CSSStyle.P
-00020b30: 5829 3a0a 2020 2020 2020 2020 2020 2020  X):.            
-00020b40: 2020 2020 2020 2020 7661 6c75 6531 203d          value1 =
-00020b50: 2076 616c 7565 315b 3a2d 325d 0a20 2020   value1[:-2].   
-00020b60: 2020 2020 2020 2020 2020 2020 2074 7279               try
-00020b70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00020b80: 2020 2020 2020 7661 6c75 6531 203d 2066        value1 = f
-00020b90: 6c6f 6174 2876 616c 7565 3129 0a20 2020  loat(value1).   
-00020ba0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-00020bb0: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
-00020bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020bd0: 2020 206c 6f67 6769 6e67 2e77 6172 6e69     logging.warni
-00020be0: 6e67 2866 226e 6f74 2061 206e 756d 6265  ng(f"not a numbe
-00020bf0: 7220 7b76 616c 7565 317d 2229 0a20 2020  r {value1}").   
-00020c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020c10: 2072 6574 7572 6e20 4661 6c73 650a 0a20   return False.. 
-00020c20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00020c30: 6620 7268 732e 656e 6473 7769 7468 2843  f rhs.endswith(C
-00020c40: 5353 5374 796c 652e 5058 293a 0a20 2020  SSStyle.PX):.   
-00020c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020c60: 2072 6873 203d 2072 6873 5b3a 2d32 5d0a   rhs = rhs[:-2].
-00020c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020c80: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-00020c90: 2020 2020 2020 2020 2076 616c 7565 3220           value2 
-00020ca0: 3d20 666c 6f61 7428 7268 7329 0a20 2020  = float(rhs).   
-00020cb0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-00020cc0: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
-00020cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020ce0: 2020 206c 6f67 6769 6e67 2e77 6172 6e69     logging.warni
-00020cf0: 6e67 2866 226e 6f74 2061 206e 756d 6265  ng(f"not a numbe
-00020d00: 7220 7b72 6873 7d22 290a 2020 2020 2020  r {rhs}").      
-00020d10: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00020d20: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
-00020d30: 2020 2020 2020 2020 2020 206f 7065 7220             oper 
-00020d40: 3d20 7373 5b31 5d0a 2020 2020 2020 2020  = ss[1].        
-00020d50: 2020 2020 2020 2020 6966 206f 7065 7220          if oper 
-00020d60: 3d3d 2022 3e22 3a0a 2020 2020 2020 2020  == ">":.        
-00020d70: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-00020d80: 6c74 203d 2076 616c 7565 3120 3e20 7661  lt = value1 > va
-00020d90: 6c75 6532 0a20 2020 2020 2020 2020 2020  lue2.           
-00020da0: 2020 2020 2065 6c69 6620 6f70 6572 203d       elif oper =
-00020db0: 3d20 223c 223a 0a20 2020 2020 2020 2020  = "<":.         
-00020dc0: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-00020dd0: 7420 3d20 7661 6c75 6531 203c 2076 616c  t = value1 < val
-00020de0: 7565 320a 2020 2020 2020 2020 2020 2020  ue2.            
-00020df0: 2020 2020 656c 6966 206f 7065 7220 3d3d      elif oper ==
-00020e00: 2022 213d 223a 0a20 2020 2020 2020 2020   "!=":.         
-00020e10: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-00020e20: 7420 3d20 7661 6c75 6531 2021 3d20 7661  t = value1 != va
-00020e30: 6c75 6532 0a20 2020 2020 2020 2020 2020  lue2.           
-00020e40: 2020 2020 2065 6c69 6620 6f70 6572 203d       elif oper =
-00020e50: 3d20 223d 3d22 3a0a 2020 2020 2020 2020  = "==":.        
-00020e60: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-00020e70: 6c74 203d 2028 7661 6c75 6531 203d 3d20  lt = (value1 == 
-00020e80: 7661 6c75 6532 290a 2020 2020 2020 2020  value2).        
-00020e90: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00020ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020eb0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00020ec0: 6f72 2866 2262 6164 206f 7065 7261 746f  or(f"bad operato
-00020ed0: 723a 207b 6f70 6572 7d22 290a 2020 2020  r: {oper}").    
-00020ee0: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-00020ef0: 6573 756c 743a 0a20 2020 2020 2020 2020  esult:.         
-00020f00: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
-00020f10: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-00020f20: 6573 756c 740a 0a20 2020 2023 2020 2020  esult..    #    
-00020f30: 636c 6173 7320 4353 5353 7479 6c65 3a0a  class CSSStyle:.
-00020f40: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
-00020f50: 640a 2020 2020 6465 6620 636d 796b 5f74  d.    def cmyk_t
-00020f60: 6f5f 7267 6228 636c 732c 2063 2c20 6d2c  o_rgb(cls, c, m,
-00020f70: 2079 2c20 6b29 3a0a 0a20 2020 2020 2020   y, k):..       
-00020f80: 2072 6762 5f73 6361 6c65 203d 2032 3535   rgb_scale = 255
-00020f90: 0a20 2020 2020 2020 2023 2063 6d79 6b5f  .        # cmyk_
-00020fa0: 7363 616c 6520 3d20 3130 300a 2020 2020  scale = 100.    
-00020fb0: 2020 2020 636d 796b 5f73 6361 6c65 203d      cmyk_scale =
-00020fc0: 2031 2e30 0a20 2020 2020 2020 2072 203d   1.0.        r =
-00020fd0: 2072 6762 5f73 6361 6c65 202a 2028 312e   rgb_scale * (1.
-00020fe0: 3020 2d20 2863 202b 206b 2920 2f20 666c  0 - (c + k) / fl
-00020ff0: 6f61 7428 636d 796b 5f73 6361 6c65 2929  oat(cmyk_scale))
-00021000: 0a20 2020 2020 2020 2067 203d 2072 6762  .        g = rgb
-00021010: 5f73 6361 6c65 202a 2028 312e 3020 2d20  _scale * (1.0 - 
-00021020: 286d 202b 206b 2920 2f20 666c 6f61 7428  (m + k) / float(
-00021030: 636d 796b 5f73 6361 6c65 2929 0a20 2020  cmyk_scale)).   
-00021040: 2020 2020 2062 203d 2072 6762 5f73 6361       b = rgb_sca
-00021050: 6c65 202a 2028 312e 3020 2d20 2879 202b  le * (1.0 - (y +
-00021060: 206b 2920 2f20 666c 6f61 7428 636d 796b   k) / float(cmyk
-00021070: 5f73 6361 6c65 2929 0a0a 2020 2020 2020  _scale))..      
-00021080: 2020 7265 7475 726e 2072 2c20 672c 2062    return r, g, b
-00021090: 0a0a 2020 2020 2320 2020 2063 6c61 7373  ..    #    class
-000210a0: 2043 5353 5374 796c 653a 0a0a 2020 2020   CSSStyle:..    
-000210b0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-000210c0: 2064 6566 2063 6d6b 795f 746f 5f72 6762   def cmky_to_rgb
-000210d0: 2863 6c73 2c20 632c 206d 2c20 6b2c 2079  (cls, c, m, k, y
-000210e0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-000210f0: 6e20 636c 732e 636d 796b 5f74 6f5f 7267  n cls.cmyk_to_rg
-00021100: 6228 632c 206d 2c20 792c 206b 290a 0a20  b(c, m, y, k).. 
-00021110: 2020 2064 6566 2065 7874 7261 6374 5f62     def extract_b
-00021120: 6f6c 645f 6974 616c 6963 5f66 726f 6d5f  old_italic_from_
-00021130: 666f 6e74 5f66 616d 696c 7928 0a20 2020  font_family(.   
-00021140: 2020 2020 2020 2020 2073 656c 662c 0a20           self,. 
-00021150: 2020 2020 2020 2020 2020 206f 7665 7277             overw
-00021160: 7269 7465 5f62 6f6c 643d 4661 6c73 652c  rite_bold=False,
-00021170: 0a20 2020 2020 2020 2020 2020 206f 7665  .            ove
-00021180: 7277 7269 7465 5f73 7479 6c65 3d46 616c  rwrite_style=Fal
-00021190: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
-000211a0: 6f76 6572 7772 6974 655f 6661 6d69 6c79  overwrite_family
-000211b0: 3d54 7275 652c 0a20 2020 2020 2020 2020  =True,.         
-000211c0: 2020 2073 7479 6c65 5f72 6567 6578 3d53     style_regex=S
-000211d0: 5459 4c45 5f52 452c 0a20 2020 2020 2020  TYLE_RE,.       
-000211e0: 2020 2020 2077 6569 6768 745f 7265 6765       weight_rege
-000211f0: 783d 5745 4947 4854 5f52 4529 3a0a 2020  x=WEIGHT_RE):.  
-00021200: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00021210: 2020 6865 7572 6973 7469 6373 2074 6f20    heuristics to 
-00021220: 6669 6e64 2062 6f6c 6420 616e 6420 6974  find bold and it
-00021230: 616c 6963 2069 6e20 666f 6e74 206e 616d  alic in font nam
-00021240: 6573 2061 6e64 2074 7279 2074 6f20 6e6f  es and try to no
-00021250: 726d 616c 6973 650a 2020 2020 2020 2020  rmalise.        
-00021260: 652e 672e 0a20 2020 2020 2020 2066 6f6e  e.g..        fon
-00021270: 742d 6661 6d69 6c79 3a20 5469 6d65 734e  t-family: TimesN
-00021280: 6577 526f 6d61 6e50 532d 426f 6c64 4d54  ewRomanPS-BoldMT
-00021290: 3b20 3d3e 2066 6f6e 742d 6661 6d69 6c79  ; => font-family
-000212a0: 3a20 5469 6d65 734e 6577 526f 6d61 6e50  : TimesNewRomanP
-000212b0: 534d 543b 2066 6f6e 745f 7765 6967 6874  SMT; font_weight
-000212c0: 3a20 626f 6c64 0a20 2020 2020 2020 2066  : bold.        f
-000212d0: 6f6e 742d 6661 6d69 6c79 3a20 5469 6d65  ont-family: Time
-000212e0: 734e 6577 526f 6d61 6e50 532d 4974 616c  sNewRomanPS-Ital
-000212f0: 6963 4d54 3b20 3d3e 2066 6f6e 742d 6661  icMT; => font-fa
-00021300: 6d69 6c79 3a20 5469 6d65 734e 6577 526f  mily: TimesNewRo
-00021310: 6d61 6e50 534d 543b 2066 6f6e 745f 7374  manPSMT; font_st
-00021320: 796c 653a 2069 7461 6c69 630a 2020 2020  yle: italic.    
-00021330: 2020 2020 7468 6520 6f76 6572 7772 6974      the overwrit
-00021340: 655f 2a20 6465 7465 726d 696e 6520 7768  e_* determine wh
-00021350: 6574 6568 7220 6578 6973 7469 6e67 2063  etehr existing c
-00021360: 6f6d 706f 6e65 6e74 7320 7769 6c6c 2062  omponents will b
-00021370: 6520 6f76 6572 7772 6974 7465 6e0a 2020  e overwritten.  
-00021380: 2020 2020 2020 3a70 6172 616d 206f 7665        :param ove
-00021390: 7277 7269 7465 5f62 6f6c 643a 2063 7265  rwrite_bold: cre
-000213a0: 6174 6520 666f 6e74 5f77 6569 6768 743a  ate font_weight:
-000213b0: 626f 6c64 2072 6567 6172 646c 6573 7320  bold regardless 
-000213c0: 6f66 2070 7265 7669 6f75 7320 7765 6967  of previous weig
-000213d0: 6874 0a20 2020 2020 2020 203a 7061 7261  ht.        :para
-000213e0: 6d20 6f76 6572 7772 6974 655f 7374 796c  m overwrite_styl
-000213f0: 653a 2063 7265 6174 6520 666f 6e74 5f73  e: create font_s
-00021400: 7479 6c65 3a62 6f6c 6420 7265 6761 7264  tyle:bold regard
-00021410: 6c65 7373 206f 6620 7072 6576 696f 7573  less of previous
-00021420: 2073 7479 6c65 0a20 2020 2020 2020 203a   style.        :
-00021430: 7061 7261 6d20 6f76 6572 7772 6974 655f  param overwrite_
-00021440: 6661 6d69 6c79 3a20 6564 6974 2066 6f6e  family: edit fon
-00021450: 742d 6661 6d69 6c79 2074 6f20 7265 6d6f  t-family to remo
-00021460: 7665 2073 7479 6c65 2f77 6569 6768 7420  ve style/weight 
-00021470: 696e 666f 2028 6861 636b 7929 0a20 2020  info (hacky).   
-00021480: 2020 2020 203a 7061 7261 6d20 7374 796c       :param styl
-00021490: 655f 7265 6765 783d 0a0a 2020 2020 2020  e_regex=..      
-000214a0: 2020 2222 220a 2020 2020 2020 2020 6661    """.        fa
-000214b0: 6d69 6c79 203d 2073 656c 662e 666f 6e74  mily = self.font
-000214c0: 5f66 616d 696c 790a 2020 2020 2020 2020  _family.        
-000214d0: 6966 206e 6f74 2066 616d 696c 793a 0a20  if not family:. 
-000214e0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000214f0: 6e0a 2020 2020 2020 2020 6661 6d69 6c79  n.        family
-00021500: 5f73 7479 6c65 2c20 7374 796c 6520 3d20  _style, style = 
-00021510: 7365 6c66 2e6d 6174 6368 5f77 6569 6768  self.match_weigh
-00021520: 745f 7374 796c 6528 6661 6d69 6c79 2c20  t_style(family, 
-00021530: 7374 796c 655f 7265 6765 782c 2076 616c  style_regex, val
-00021540: 7565 3d22 4922 2c20 6d61 726b 3d22 5353  ue="I", mark="SS
-00021550: 2229 0a20 2020 2020 2020 2066 616d 696c  ").        famil
-00021560: 795f 7765 6967 6874 2c20 7765 6967 6874  y_weight, weight
-00021570: 203d 2073 656c 662e 6d61 7463 685f 7765   = self.match_we
-00021580: 6967 6874 5f73 7479 6c65 2866 616d 696c  ight_style(famil
-00021590: 792c 2077 6569 6768 745f 7265 6765 782c  y, weight_regex,
-000215a0: 2076 616c 7565 3d22 4222 2c20 6d61 726b   value="B", mark
-000215b0: 3d22 5757 2229 0a20 2020 2020 2020 2023  ="WW").        #
-000215c0: 2070 7269 6e74 2866 2266 616d 696c 793a   print(f"family:
-000215d0: 207b 6661 6d69 6c79 7d3b 2073 7479 6c65   {family}; style
-000215e0: 3a20 7b73 7479 6c65 7d3b 2077 6569 6768  : {style}; weigh
-000215f0: 743a 207b 7765 6967 6874 7d3b 2229 0a20  t: {weight};"). 
-00021600: 2020 2020 2020 2069 6620 6661 6d69 6c79         if family
-00021610: 5f77 6569 6768 7420 616e 6420 6f76 6572  _weight and over
-00021620: 7772 6974 655f 6661 6d69 6c79 3a0a 2020  write_family:.  
-00021630: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
-00021640: 6574 5f66 616d 696c 7928 6661 6d69 6c79  et_family(family
-00021650: 5f77 6569 6768 7429 0a20 2020 2020 2020  _weight).       
-00021660: 2069 6620 7765 6967 6874 2061 6e64 206f   if weight and o
-00021670: 7665 7277 7269 7465 5f62 6f6c 643a 0a20  verwrite_bold:. 
-00021680: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00021690: 7365 745f 666f 6e74 5f77 6569 6768 7428  set_font_weight(
-000216a0: 7765 6967 6874 290a 2020 2020 2020 2020  weight).        
-000216b0: 6966 2073 7479 6c65 2061 6e64 206f 7665  if style and ove
-000216c0: 7277 7269 7465 5f73 7479 6c65 3a0a 2020  rwrite_style:.  
-000216d0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
-000216e0: 6574 5f66 6f6e 745f 7374 796c 6528 7374  et_font_style(st
-000216f0: 796c 6529 0a20 2020 2020 2020 2023 2069  yle).        # i
-00021700: 6620 7374 796c 6520 616e 6420 6f76 6572  f style and over
-00021710: 7772 6974 655f 7374 7265 7463 6865 643a  write_stretched:
-00021720: 0a20 2020 2020 2020 2023 2020 2020 2073  .        #     s
-00021730: 656c 662e 7365 745f 666f 6e74 5f73 7472  elf.set_font_str
-00021740: 6574 6368 6564 2873 7479 6c65 290a 2020  etched(style).  
-00021750: 2020 2020 2020 2320 7072 696e 7428 6622        # print(f"
-00021760: 6e65 7720 7374 796c 6520 7b73 656c 667d  new style {self}
-00021770: 2229 0a0a 2020 2020 2320 2020 2063 6c61  ")..    #    cla
-00021780: 7373 2043 5353 5374 796c 653a 0a0a 2020  ss CSSStyle:..  
-00021790: 2020 6465 6620 6d61 7463 685f 7765 6967    def match_weig
-000217a0: 6874 5f73 7479 6c65 2873 656c 662c 2066  ht_style(self, f
-000217b0: 616d 696c 792c 2077 6569 6768 745f 7265  amily, weight_re
-000217c0: 6765 782c 2076 616c 7565 3d4e 6f6e 652c  gex, value=None,
-000217d0: 206d 6172 6b3d 4e6f 6e65 293a 0a20 2020   mark=None):.   
-000217e0: 2020 2020 2077 6569 6768 745f 7265 6320       weight_rec 
-000217f0: 3d20 7265 2e63 6f6d 7069 6c65 2877 6569  = re.compile(wei
-00021800: 6768 745f 7265 6765 7829 2069 6620 7765  ght_regex) if we
-00021810: 6967 6874 5f72 6567 6578 2065 6c73 6520  ight_regex else 
-00021820: 4e6f 6e65 0a20 2020 2020 2020 206d 6174  None.        mat
-00021830: 6368 203d 2077 6569 6768 745f 7265 632e  ch = weight_rec.
-00021840: 7365 6172 6368 2866 616d 696c 7929 0a20  search(family). 
-00021850: 2020 2020 2020 2069 6620 6d61 7463 683a         if match:
-00021860: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
-00021870: 7565 203d 2066 616d 696c 795b 6d61 7463  ue = family[matc
-00021880: 682e 7374 6172 7428 293a 6d61 7463 682e  h.start():match.
-00021890: 656e 6428 295d 0a20 2020 2020 2020 2020  end()].         
-000218a0: 2020 2076 616c 7565 203d 2076 616c 7565     value = value
-000218b0: 2e72 6570 6c61 6365 2822 2d22 2c20 2222  .replace("-", ""
-000218c0: 292e 7265 706c 6163 6528 222e 222c 2022  ).replace(".", "
-000218d0: 2229 0a20 2020 2020 2020 2020 2020 2066  ").            f
-000218e0: 616d 696c 7920 3d20 6661 6d69 6c79 5b3a  amily = family[:
-000218f0: 6d61 7463 682e 7374 6172 7428 295d 202b  match.start()] +
-00021900: 2066 616d 696c 795b 6d61 7463 682e 656e   family[match.en
-00021910: 6428 293a 5d0a 2020 2020 2020 2020 656c  d():].        el
-00021920: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00021930: 7661 6c75 6520 3d20 4e6f 6e65 0a20 2020  value = None.   
-00021940: 2020 2020 2072 6574 7572 6e20 6661 6d69       return fami
-00021950: 6c79 2c20 7661 6c75 650a 0a20 2020 2023  ly, value..    #
-00021960: 2020 2020 636c 6173 7320 4353 5353 7479      class CSSSty
-00021970: 6c65 3a0a 0a20 2020 2064 6566 2063 7265  le:..    def cre
-00021980: 6174 655f 6262 6f78 2873 656c 6629 3a0a  ate_bbox(self):.
-00021990: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000219a0: 2020 2020 6372 6561 7465 2062 6f75 6e64      create bound
-000219b0: 696e 6720 626f 7820 6672 6f6d 206c 6566  ing box from lef
-000219c0: 742c 2077 6964 7468 2c20 746f 702c 2068  t, width, top, h
-000219d0: 6569 6768 740a 2020 2020 2020 2020 3a72  eight.        :r
-000219e0: 6574 7572 6e3a 204e 6f6e 6520 6966 2061  eturn: None if a
-000219f0: 6e79 2061 7474 7269 6275 7465 7320 6d69  ny attributes mi
-00021a00: 7373 696e 670a 2020 2020 2020 2020 2222  ssing.        ""
-00021a10: 220a 2020 2020 2020 2020 6262 6f78 203d  ".        bbox =
-00021a20: 204e 6f6e 650a 2020 2020 2020 2020 6966   None.        if
-00021a30: 2073 656c 662e 746f 7020 6973 206e 6f74   self.top is not
-00021a40: 204e 6f6e 6520 616e 6420 7365 6c66 2e68   None and self.h
-00021a50: 6569 6768 7420 6973 206e 6f74 204e 6f6e  eight is not Non
-00021a60: 6520 616e 6420 7365 6c66 2e6c 6566 7420  e and self.left 
-00021a70: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-00021a80: 7365 6c66 2e77 6964 7468 2069 7320 6e6f  self.width is no
-00021a90: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00021aa0: 2020 2020 6262 6f78 203d 2042 426f 7828      bbox = BBox(
-00021ab0: 7879 5f72 616e 6765 733d 5b5b 7365 6c66  xy_ranges=[[self
-00021ac0: 2e6c 6566 742c 2073 656c 662e 6c65 6674  .left, self.left
-00021ad0: 202b 2073 656c 662e 7769 6474 685d 2c20   + self.width], 
-00021ae0: 5b73 656c 662e 746f 702c 2073 656c 662e  [self.top, self.
-00021af0: 746f 7020 2b20 7365 6c66 2e68 6569 6768  top + self.heigh
-00021b00: 745d 5d29 0a20 2020 2020 2020 2072 6574  t]]).        ret
-00021b10: 7572 6e20 6262 6f78 0a0a 2020 2020 2320  urn bbox..    # 
-00021b20: 2020 2063 6c61 7373 2043 5353 5374 796c     class CSSStyl
-00021b30: 653a 0a0a 2020 2020 6465 6620 6578 7472  e:..    def extr
-00021b40: 6163 745f 7375 6273 7479 6c65 7328 7365  act_substyles(se
-00021b50: 6c66 2c20 6373 735f 6e61 6d65 7329 3a0a  lf, css_names):.
-00021b60: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00021b70: 2020 2020 4372 6561 7465 2032 206e 6577      Create 2 new
-00021b80: 2043 5353 5373 7479 6c65 7320 2c20 7468   CSSSstyles , th
-00021b90: 6520 6669 7273 7420 7769 7468 206e 616d  e first with nam
-00021ba0: 6573 2069 6e20 2273 7479 6c65 7322 2061  es in "styles" a
-00021bb0: 6e64 2074 6865 2073 6563 6f6e 6420 7468  nd the second th
-00021bc0: 6520 7265 7374 2e0a 2020 2020 2020 2020  e rest..        
-00021bd0: 2020 2020 6966 204e 6f6e 652c 2072 6574      if None, ret
-00021be0: 7275 6e73 204e 6f6e 652c 4e6f 6e65 0a20  runs None,None. 
-00021bf0: 2020 2020 2020 203a 7061 7261 6d20 6373         :param cs
-00021c00: 735f 6e61 6d65 733a 206c 6973 7420 6f66  s_names: list of
-00021c10: 2043 5353 206e 616d 6573 2028 652e 672e   CSS names (e.g.
-00021c20: 2022 666f 6e74 2d66 616d 696c 7922 292e   "font-family").
-00021c30: 2049 6620 6e61 206e 616d 6520 6e6f 7420   If na name not 
-00021c40: 666f 756e 642c 206e 6f20 6163 7469 6f6e  found, no action
-00021c50: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
-00021c60: 2032 2d74 7570 6c65 206f 6620 3129 2043   2-tuple of 1) C
-00021c70: 5353 5374 796c 6520 6f62 6a65 6374 2077  SSStyle object w
-00021c80: 6974 6820 6578 7472 6163 7465 6420 6e61  ith extracted na
-00021c90: 6d65 7320 3229 2043 5353 5374 796c 6520  mes 2) CSSStyle 
-00021ca0: 6f66 2074 6865 2072 656d 6169 6e64 6572  of the remainder
-00021cb0: 3b0a 2020 2020 2020 2020 2020 2020 6569  ;.            ei
-00021cc0: 7468 6572 2f62 6f74 6820 6d61 7920 6265  ther/both may be
-00021cd0: 2065 6d70 7479 2043 5353 5374 796c 652e   empty CSSStyle.
-00021ce0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00021cf0: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-00021d00: 2e6e 616d 655f 7661 6c75 655f 6469 6374  .name_value_dict
-00021d10: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-00021d20: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
-00021d30: 226e 616d 655f 7661 6c75 655f 6469 6374  "name_value_dict
-00021d40: 2069 7320 4e6f 6e65 2229 0a20 2020 2020   is None").     
-00021d50: 2020 2069 6620 6373 735f 6e61 6d65 7320     if css_names 
-00021d60: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00021d70: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-00021d80: 2c20 4e6f 6e65 0a20 2020 2020 2020 2063  , None.        c
-00021d90: 7373 5f72 6574 6169 6e65 6420 3d20 636f  ss_retained = co
-00021da0: 7079 2e64 6565 7063 6f70 7928 7365 6c66  py.deepcopy(self
-00021db0: 290a 2020 2020 2020 2020 6373 735f 666f  ).        css_fo
-00021dc0: 756e 6420 3d20 4353 5353 7479 6c65 2829  und = CSSStyle()
-00021dd0: 0a0a 2020 2020 2020 2020 6b65 7973 203d  ..        keys =
-00021de0: 2063 7373 5f72 6574 6169 6e65 642e 6e61   css_retained.na
-00021df0: 6d65 5f76 616c 7565 5f64 6963 742e 6b65  me_value_dict.ke
-00021e00: 7973 2829 0a20 2020 2020 2020 2066 6f72  ys().        for
-00021e10: 206e 616d 6520 696e 2063 7373 5f6e 616d   name in css_nam
-00021e20: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-00021e30: 6966 206e 616d 6520 696e 2063 7373 5f72  if name in css_r
-00021e40: 6574 6169 6e65 642e 6e61 6d65 5f76 616c  etained.name_val
-00021e50: 7565 5f64 6963 743a 0a20 2020 2020 2020  ue_dict:.       
-00021e60: 2020 2020 2020 2020 2076 616c 7565 203d           value =
-00021e70: 2063 7373 5f72 6574 6169 6e65 642e 6e61   css_retained.na
-00021e80: 6d65 5f76 616c 7565 5f64 6963 742e 706f  me_value_dict.po
-00021e90: 7028 6e61 6d65 290a 2020 2020 2020 2020  p(name).        
-00021ea0: 2020 2020 2020 2020 6966 2076 616c 7565          if value
-00021eb0: 3a20 2023 2074 7261 6e73 6665 7220 6974  :  # transfer it
-00021ec0: 656d 206f 7665 720a 2020 2020 2020 2020  em over.        
-00021ed0: 2020 2020 2020 2020 2020 2020 6373 735f              css_
-00021ee0: 666f 756e 642e 6e61 6d65 5f76 616c 7565  found.name_value
-00021ef0: 5f64 6963 745b 6e61 6d65 5d20 3d20 7661  _dict[name] = va
-00021f00: 6c75 650a 2020 2020 2020 2020 7265 7475  lue.        retu
-00021f10: 726e 2028 6373 735f 666f 756e 642c 2063  rn (css_found, c
-00021f20: 7373 5f72 6574 6169 6e65 6429 0a0a 2020  ss_retained)..  
-00021f30: 2020 2320 2020 2063 6c61 7373 2043 5353    #    class CSS
-00021f40: 5374 796c 653a 0a0a 2020 2020 6465 6620  Style:..    def 
-00021f50: 6372 6561 7465 5f68 746d 6c5f 7374 796c  create_html_styl
-00021f60: 655f 656c 656d 656e 7428 7365 6c66 2c20  e_element(self, 
-00021f70: 6874 6d6c 5f63 6c61 7373 293a 0a20 2020  html_class):.   
-00021f80: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00021f90: 2043 7265 6174 6573 2073 7472 696e 6720   Creates string 
-00021fa0: 666f 7220 4854 4d4c 2073 7479 6c65 0a20  for HTML style. 
-00021fb0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00021fc0: 2020 2044 4f54 203d 2022 2e22 0a20 2020     DOT = ".".   
-00021fd0: 2020 2020 2073 203d 2044 4f54 202b 2068       s = DOT + h
-00021fe0: 746d 6c5f 636c 6173 7320 2b20 2220 2220  tml_class + " " 
-00021ff0: 2b20 7365 6c66 2e67 6574 5f63 7373 5f76  + self.get_css_v
-00022000: 616c 7565 2877 7261 705f 7769 7468 5f63  alue(wrap_with_c
-00022010: 7572 6c79 3d54 7275 6529 0a20 2020 2020  urly=True).     
-00022020: 2020 2065 6c65 6d20 3d20 4554 2e45 6c65     elem = ET.Ele
-00022030: 6d65 6e74 2843 5353 5374 796c 652e 5354  ment(CSSStyle.ST
-00022040: 594c 4529 0a20 2020 2020 2020 2065 6c65  YLE).        ele
-00022050: 6d2e 7465 7874 203d 2073 0a20 2020 2020  m.text = s.     
-00022060: 2020 2072 6574 7572 6e20 656c 656d 0a0a     return elem..
-00022070: 2020 2020 2320 2020 2063 6c61 7373 2043      #    class C
-00022080: 5353 5374 796c 653a 0a0a 2020 2020 6465  SSStyle:..    de
-00022090: 6620 6578 7472 6163 745f 7465 7874 5f73  f extract_text_s
-000220a0: 7479 6c65 7328 7365 6c66 293a 0a20 2020  tyles(self):.   
-000220b0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000220c0: 2065 7874 7261 6374 2074 6578 7420 636f   extract text co
-000220d0: 6d70 6f6e 656e 7473 2066 726f 6d20 7374  mponents from st
-000220e0: 796c 6520 2866 6f6e 742d 2a2c 2063 6f6c  yle (font-*, col
-000220f0: 6f72 2c20 6574 6329 2069 6e74 6f20 6e65  or, etc) into ne
-00022100: 7720 7374 796c 652c 2072 6574 7572 6e69  w style, returni
-00022110: 6e67 2074 7570 6c65 206f 660a 2020 2020  ng tuple of.    
-00022120: 2020 2020 6e65 7720 7374 796c 6520 616e      new style an
-00022130: 6420 7374 796c 6520 6672 6f6d 2072 656d  d style from rem
-00022140: 6169 6e69 6e67 2063 6f6d 706f 6e65 6e74  aining component
-00022150: 730a 2020 2020 2020 2020 2222 220a 2020  s.        """.  
-00022160: 2020 2020 2020 2865 7874 7261 6374 6564        (extracted
-00022170: 5f73 7479 6c65 2c20 7265 7461 696e 6564  _style, retained
-00022180: 2920 3d20 666f 6e74 5f73 7479 6c65 2c20  ) = font_style, 
-00022190: 7265 7374 5f73 7479 6c65 203d 2073 656c  rest_style = sel
-000221a0: 662e 6578 7472 6163 745f 7375 6273 7479  f.extract_substy
-000221b0: 6c65 7328 0a20 2020 2020 2020 2020 2020  les(.           
-000221c0: 2043 5353 5374 796c 652e 5445 5854 5f53   CSSStyle.TEXT_S
-000221d0: 5459 4c45 5f43 4f4d 504f 4e45 4e54 530a  TYLE_COMPONENTS.
-000221e0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-000221f0: 2020 7265 7475 726e 2028 6578 7472 6163    return (extrac
-00022200: 7465 645f 7374 796c 652c 2072 6574 6169  ted_style, retai
-00022210: 6e65 6429 0a0a 2020 2020 2320 2020 2063  ned)..    #    c
-00022220: 6c61 7373 2043 5353 5374 796c 653a 0a0a  lass CSSStyle:..
-00022230: 2020 2020 6465 6620 6578 7472 6163 745f      def extract_
-00022240: 7465 7874 5f73 7479 6c65 735f 696e 746f  text_styles_into
-00022250: 5f63 6c61 7373 2873 656c 662c 2063 6c61  _class(self, cla
-00022260: 7373 5f6e 616d 652c 206f 6c64 5f63 6c61  ss_name, old_cla
-00022270: 7373 7374 723d 2222 293a 0a20 2020 2020  ssstr=""):.     
-00022280: 2020 2022 2222 0a20 2020 2020 2020 2065     """.        e
-00022290: 7874 7261 6374 7320 7465 7874 2063 6c61  xtracts text cla
-000222a0: 7373 206e 616d 652d 7661 6c75 6520 696e  ss name-value in
-000222b0: 746f 206e 6577 2043 5353 5374 796c 652c  to new CSSStyle,
-000222c0: 2061 6e64 2063 7265 6174 6573 2075 7064   and creates upd
-000222d0: 6174 6564 2063 6c61 7373 5f73 7472 696e  ated class_strin
-000222e0: 670a 2020 2020 2020 2020 4578 616d 706c  g.        Exampl
-000222f0: 653a 0a20 2020 2020 2020 2020 2020 2065  e:.            e
-00022300: 6c65 6d65 6e74 2068 6173 2073 7479 6c65  lement has style
-00022310: 2061 7474 7269 6275 7465 2077 6974 6820   attribute with 
-00022320: 7365 7665 7261 6c20 7465 7874 2063 6f6d  several text com
-00022330: 706f 6e65 6e74 7320 2865 2e67 2e20 666f  ponents (e.g. fo
-00022340: 6e74 2d77 6569 6768 742c 2066 6f6e 742d  nt-weight, font-
-00022350: 7369 7a65 290a 2020 2020 2020 2020 2020  size).          
-00022360: 2020 5468 6973 2063 7265 6174 6573 2061    This creates a
-00022370: 206e 6577 203c 7374 796c 653e 2045 6c65   new <style> Ele
-00022380: 6d65 6e74 2028 6578 7472 6163 7465 6429  ment (extracted)
-00022390: 2077 6974 6820 6a75 7374 2074 6865 7365   with just these
-000223a0: 2063 6f6d 706f 6e65 6e74 730a 2020 2020   components.    
-000223b0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-000223c0: 7075 7473 2074 6865 2075 6e65 7874 7261  puts the unextra
-000223d0: 6374 6564 2073 7479 6c65 2063 6f6d 706f  cted style compo
-000223e0: 6e65 656e 7473 2069 6e74 6f20 6e65 7720  neents into new 
-000223f0: 7374 796c 6520 7370 6163 652d 7365 7061  style space-sepa
-00022400: 7261 7465 6420 7374 7269 6e67 2028 7265  rated string (re
-00022410: 6d61 696e 6e65 6429 0a20 2020 2020 2020  mainned).       
-00022420: 2020 2020 2049 7420 7573 6573 2074 6865       It uses the
-00022430: 2063 6c61 7373 5f6e 616d 6520 746f 2075   class_name to u
-00022440: 7064 6174 6520 7468 6520 6f6c 645f 636c  pdate the old_cl
-00022450: 6173 7373 7472 2073 7472 696e 670a 2020  assstr string.  
-00022460: 2020 2020 2020 2020 2020 2020 2020 652e                e.
-00022470: 672e 2063 6c61 7373 5f6e 616d 653d 2273  g. class_name="s
-00022480: 3122 2061 6e64 206f 6c64 5f63 6c61 7373  1" and old_class
-00022490: 7374 723d 2266 6f6f 2062 6172 2220 3d3e  str="foo bar" =>
-000224a0: 2022 666f 6f20 6261 7220 7331 220a 2020   "foo bar s1".  
-000224b0: 2020 2020 2020 3a70 6172 616d 2063 6c61        :param cla
-000224c0: 7373 5f6e 616d 653a 206e 616d 6520 6f69  ss_name: name oi
-000224d0: 6620 6e65 7720 636c 6173 7320 2861 7574  f new class (aut
-000224e0: 686f 7220 6d75 7374 2065 6e73 7572 6520  hor must ensure 
-000224f0: 756e 6971 7565 6e65 7373 290a 2020 2020  uniqueness).    
-00022500: 2020 2020 3a70 6172 616d 206f 6c64 5f63      :param old_c
-00022510: 6c61 7373 7374 723a 206f 6c64 2063 6c61  lassstr: old cla
-00022520: 7373 6e61 6d65 2028 6465 6661 756c 7473  ssname (defaults
-00022530: 2074 6f20 2222 290a 2020 2020 2020 2020   to "").        
-00022540: 3a72 6574 7572 6e3a 2033 2d74 7570 6c65  :return: 3-tuple
-00022550: 206f 6620 2865 7874 7261 6374 6564 5f73   of (extracted_s
-00022560: 7479 6c65 5f65 6c65 6d65 6e74 2c20 7265  tyle_element, re
-00022570: 7461 696e 6564 5f73 7479 6c65 5f73 7472  tained_style_str
-00022580: 696e 672c 206e 6577 2063 6c61 7373 735f  ing, new classs_
-00022590: 7374 7269 6e67 290a 2020 2020 2020 2020  string).        
-000225a0: 2222 220a 2020 2020 2020 2020 6578 7472  """.        extr
-000225b0: 6163 7465 645f 7374 796c 652c 2072 6574  acted_style, ret
-000225c0: 6169 6e65 645f 7374 796c 6520 3d20 7365  ained_style = se
-000225d0: 6c66 2e65 7874 7261 6374 5f74 6578 745f  lf.extract_text_
-000225e0: 7374 796c 6573 2829 0a0a 2020 2020 2020  styles()..      
-000225f0: 2020 6966 206e 6f74 2065 7874 7261 6374    if not extract
-00022600: 6564 5f73 7479 6c65 3a0a 2020 2020 2020  ed_style:.      
-00022610: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00022620: 6545 7272 6f72 2822 6578 7472 6163 7465  eError("extracte
-00022630: 6420 7374 796c 6520 6973 204e 6f6e 6522  d style is None"
-00022640: 290a 2020 2020 2020 2020 6578 7472 6163  ).        extrac
-00022650: 7465 645f 7374 796c 6531 203d 2043 5353  ted_style1 = CSS
-00022660: 5374 796c 652e 6578 7472 6163 745f 626f  Style.extract_bo
-00022670: 6c64 5f69 7461 6c69 635f 6672 6f6d 5f66  ld_italic_from_f
-00022680: 6f6e 745f 6661 6d69 6c79 5f66 6f72 5f73  ont_family_for_s
-00022690: 7479 6c65 280a 2020 2020 2020 2020 2020  tyle(.          
-000226a0: 2020 6578 7472 6163 7465 645f 7374 796c    extracted_styl
-000226b0: 6529 2069 6620 6578 7472 6163 7465 645f  e) if extracted_
-000226c0: 7374 796c 6520 656c 7365 204e 6f6e 650a  style else None.
-000226d0: 2020 2020 2020 2020 6578 7472 6163 7465          extracte
-000226e0: 645f 6874 6d6c 5f73 7479 6c65 5f65 6c65  d_html_style_ele
-000226f0: 6d65 6e74 203d 2065 7874 7261 6374 6564  ment = extracted
-00022700: 5f73 7479 6c65 312e 6372 6561 7465 5f68  _style1.create_h
-00022710: 746d 6c5f 7374 796c 655f 656c 656d 656e  tml_style_elemen
-00022720: 7428 0a20 2020 2020 2020 2020 2020 2063  t(.            c
-00022730: 6c61 7373 5f6e 616d 6529 2069 6620 6578  lass_name) if ex
-00022740: 7472 6163 7465 645f 7374 796c 6531 2069  tracted_style1 i
-00022750: 7320 6e6f 7420 4e6f 6e65 2065 6c73 6520  s not None else 
-00022760: 4e6f 6e65 0a0a 2020 2020 2020 2020 7265  None..        re
-00022770: 7461 696e 6564 5f73 7479 6c65 5f61 7474  tained_style_att
-00022780: 7661 6c20 3d20 7265 7461 696e 6564 5f73  val = retained_s
-00022790: 7479 6c65 2e67 6574 5f63 7373 5f76 616c  tyle.get_css_val
-000227a0: 7565 2829 2069 6620 7265 7461 696e 6564  ue() if retained
-000227b0: 5f73 7479 6c65 2065 6c73 6520 4e6f 6e65  _style else None
-000227c0: 0a20 2020 2020 2020 2068 746d 6c5f 636c  .        html_cl
-000227d0: 6173 735f 7661 6c20 3d20 4353 5353 7479  ass_val = CSSSty
-000227e0: 6c65 2e63 7265 6174 655f 6874 6d6c 5f63  le.create_html_c
-000227f0: 6c61 7373 5f76 616c 2863 6c61 7373 5f6e  lass_val(class_n
-00022800: 616d 652c 206f 6c64 5f63 6c61 7373 5f76  ame, old_class_v
-00022810: 616c 3d6f 6c64 5f63 6c61 7373 7374 7229  al=old_classstr)
-00022820: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00022830: 6578 7472 6163 7465 645f 6874 6d6c 5f73  extracted_html_s
-00022840: 7479 6c65 5f65 6c65 6d65 6e74 2c20 7265  tyle_element, re
-00022850: 7461 696e 6564 5f73 7479 6c65 5f61 7474  tained_style_att
-00022860: 7661 6c2c 2068 746d 6c5f 636c 6173 735f  val, html_class_
-00022870: 7661 6c0a 0a20 2020 2023 2020 2020 636c  val..    #    cl
-00022880: 6173 7320 4353 5353 7479 6c65 3a0a 0a20  ass CSSStyle:.. 
-00022890: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-000228a0: 2020 2020 6465 6620 6372 6561 7465 5f68      def create_h
-000228b0: 746d 6c5f 636c 6173 735f 7661 6c28 636c  tml_class_val(cl
-000228c0: 732c 206e 6577 5f63 6c61 7373 2c20 6f6c  s, new_class, ol
-000228d0: 645f 636c 6173 735f 7661 6c3d 4e6f 6e65  d_class_val=None
-000228e0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-000228f0: 2020 2020 2020 2063 7265 6174 6573 206f         creates o
-00022900: 7220 6564 6974 7320 6120 636c 6173 7320  r edits a class 
-00022910: 7374 7269 6e67 2074 6f20 6163 6365 7074  string to accept
-00022920: 2061 206e 6577 2076 616c 7565 0a20 2020   a new value.   
-00022930: 2020 2020 206e 6f2d 6f70 2069 6620 6e65       no-op if ne
-00022940: 775f 636c 6173 7320 6973 2061 6c72 6561  w_class is alrea
-00022950: 6479 2069 6e20 6f6c 645f 636c 6173 735f  dy in old_class_
-00022960: 7661 6c0a 2020 2020 2020 2020 652e 672e  val.        e.g.
-00022970: 204e 6f6e 6520 2b20 2266 6f6f 2220 3d3e   None + "foo" =>
-00022980: 2022 666f 6f22 0a20 2020 2020 2020 2022   "foo".        "
-00022990: 666f 6f22 202b 2022 6261 7220 706c 7567  foo" + "bar plug
-000229a0: 6822 203d 3e20 2262 6172 2070 6c75 6768  h" => "bar plugh
-000229b0: 2066 6f6f 220a 2020 2020 2020 2020 2266   foo".        "f
-000229c0: 6f6f 2220 2b20 2262 6172 2066 6f6f 2070  oo" + "bar foo p
-000229d0: 6c75 6768 2220 3d3e 2022 6261 7220 666f  lugh" => "bar fo
-000229e0: 6f20 706c 7567 6822 0a20 2020 2020 2020  o plugh".       
-000229f0: 203a 7061 7261 6d20 6e65 775f 636c 6173   :param new_clas
-00022a00: 733a 2063 6c61 7373 2074 6f20 6164 640a  s: class to add.
-00022a10: 2020 2020 2020 2020 3a70 6172 616d 206f          :param o
-00022a20: 6c64 5f63 6c61 7373 5f76 616c 3a20 7370  ld_class_val: sp
-00022a30: 6163 652d 7365 7061 7261 7465 6420 6c69  ace-separated li
-00022a40: 7374 206f 6620 6578 6973 7469 6e67 2063  st of existing c
-00022a50: 6c61 7373 6573 0a20 2020 2020 2020 203a  lasses.        :
-00022a60: 7265 7475 726e 3a20 6e65 7720 636c 6173  return: new clas
-00022a70: 7320 7374 7269 6e67 0a20 2020 2020 2020  s string.       
-00022a80: 2022 2222 0a20 2020 2020 2020 206f 6c64   """.        old
-00022a90: 5f63 6c61 7373 6573 203d 205b 5d20 6966  _classes = [] if
-00022aa0: 206e 6f74 206f 6c64 5f63 6c61 7373 5f76   not old_class_v
-00022ab0: 616c 2065 6c73 6520 6f6c 645f 636c 6173  al else old_clas
-00022ac0: 735f 7661 6c2e 7370 6c69 7428 290a 2020  s_val.split().  
-00022ad0: 2020 2020 2020 6966 206e 6577 5f63 6c61        if new_cla
-00022ae0: 7373 206e 6f74 2069 6e20 6f6c 645f 636c  ss not in old_cl
-00022af0: 6173 7365 733a 0a20 2020 2020 2020 2020  asses:.         
-00022b00: 2020 206f 6c64 5f63 6c61 7373 6573 2e61     old_classes.a
-00022b10: 7070 656e 6428 6e65 775f 636c 6173 7329  ppend(new_class)
-00022b20: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00022b30: 5574 696c 2e63 7265 6174 655f 7374 7269  Util.create_stri
-00022b40: 6e67 5f73 6570 6172 6174 6564 5f6c 6973  ng_separated_lis
-00022b50: 7428 6f6c 645f 636c 6173 7365 7329 0a0a  t(old_classes)..
-00022b60: 2020 2020 2320 2020 2063 6c61 7373 2043      #    class C
-00022b70: 5353 5374 796c 653a 0a0a 2020 2020 4063  SSStyle:..    @c
-00022b80: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-00022b90: 6566 2063 7265 6174 655f 7374 796c 655f  ef create_style_
-00022ba0: 6469 6374 5f66 726f 6d5f 7374 796c 6573  dict_from_styles
-00022bb0: 2863 6c73 2c20 7374 796c 655f 656c 656d  (cls, style_elem
-00022bc0: 733d 4e6f 6e65 2c20 7661 6c69 6461 7465  s=None, validate
-00022bd0: 3d54 7275 6529 3a0a 2020 2020 2020 2020  =True):.        
-00022be0: 2222 220a 2020 2020 2020 2020 636f 6e76  """.        conv
-00022bf0: 6572 7420 6c69 7374 206f 6620 4353 5353  ert list of CSSS
-00022c00: 7479 6c65 7320 2861 7320 4854 4d4c 2073  tyles (as HTML s
-00022c10: 7472 696e 6773 2920 746f 2064 6963 740a  trings) to dict.
-00022c20: 2020 2020 2020 2020 6966 2064 7570 6c69          if dupli
-00022c30: 6361 7465 2073 7479 6c65 7265 6673 2072  cate stylerefs r
-00022c40: 6169 7365 2045 7863 6570 7469 6f6e 2069  aise Exception i
-00022c50: 6620 7661 6c69 6461 7465 2065 6c73 6520  f validate else 
-00022c60: 7461 6b65 2066 6972 7374 0a20 2020 2020  take first.     
-00022c70: 2020 2054 7970 6963 616c 2073 7479 6c65     Typical style
-00022c80: 3a0a 2020 2020 2020 2020 3c73 7479 6c65  :.        <style
-00022c90: 202e 2e2e 3e2e 7330 207b 666f 6e74 2d73   ...>.s0 {font-s
-00022ca0: 697a 653a 2031 342e 7078 3b7d 3c2f 7374  ize: 14.px;}</st
-00022cb0: 796c 653e 0a20 2020 2020 2020 203a 7061  yle>.        :pa
-00022cc0: 7261 6d20 7374 796c 655f 656c 656d 733a  ram style_elems:
-00022cd0: 206c 6973 7420 6f66 206c 786d 6c20 5f45   list of lxml _E
-00022ce0: 6c65 6d65 6e74 730a 2020 2020 2020 2020  lements.        
-00022cf0: 3a70 6172 616d 2076 616c 6964 6174 653a  :param validate:
-00022d00: 2063 6865 636b 2077 6865 7468 6572 2043   check whether C
-00022d10: 5353 2076 616c 7565 2069 7320 636f 6e66  SS value is conf
-00022d20: 6f72 6d61 6e74 206f 7220 6475 706c 6963  ormant or duplic
-00022d30: 6174 6520 7374 796c 655f 7265 6673 0a20  ate style_refs. 
-00022d40: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
-00022d50: 6469 6374 206f 6620 666f 726d 2072 6566  dict of form ref
-00022d60: 3a20 7374 796c 650a 2020 2020 2020 2020  : style.        
-00022d70: 3a65 7863 6570 743a 2049 6620 656c 656d  :except: If elem
-00022d80: 656e 7420 6861 7320 7772 6f6e 6720 7379  ent has wrong sy
-00022d90: 6e74 6178 3b20 6966 2063 7373 2066 6965  ntax; if css fie
-00022da0: 726c 6420 6973 206d 616c 666f 746d 6564  rld is malfotmed
-00022db0: 3b20 6966 2072 6566 2069 7320 6475 706c  ; if ref is dupl
-00022dc0: 6963 6174 6564 0a20 2020 2020 2020 2022  icated.        "
-00022dd0: 2222 0a20 2020 2020 2020 2063 7373 5f72  "".        css_r
-00022de0: 6520 3d20 7265 2e63 6f6d 7069 6c65 2822  e = re.compile("
-00022df0: 5c5c 732a 285c 5c2e 2e2a 295c 5c73 2b7b  \\s*(\\..*)\\s+{
-00022e00: 282e 2a29 7d5c 5c73 2a22 290a 2020 2020  (.*)}\\s*").    
-00022e10: 2020 2020 6966 2073 7479 6c65 5f65 6c65      if style_ele
-00022e20: 6d73 2069 7320 4e6f 6e65 3a0a 2020 2020  ms is None:.    
-00022e30: 2020 2020 2020 2020 7374 796c 6573 203d          styles =
-00022e40: 205b 5d0a 2020 2020 2020 2020 7374 796c   [].        styl
-00022e50: 655f 6469 6374 203d 2064 6963 7428 290a  e_dict = dict().
-00022e60: 2020 2020 2020 2020 666f 7220 7374 796c          for styl
-00022e70: 655f 656c 656d 2069 6e20 7374 796c 655f  e_elem in style_
-00022e80: 656c 656d 733a 0a20 2020 2020 2020 2020  elems:.         
-00022e90: 2020 2073 7479 6c65 5f74 6578 7420 3d20     style_text = 
-00022ea0: 7374 796c 655f 656c 656d 2e74 6578 742e  style_elem.text.
-00022eb0: 7374 7269 7028 290a 2020 2020 2020 2020  strip().        
-00022ec0: 2020 2020 6d61 7463 6820 3d20 6373 735f      match = css_
-00022ed0: 7265 2e6d 6174 6368 2873 7479 6c65 5f74  re.match(style_t
-00022ee0: 6578 7429 0a20 2020 2020 2020 2020 2020  ext).           
-00022ef0: 2069 6620 6e6f 7420 6d61 7463 683a 0a20   if not match:. 
-00022f00: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00022f10: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00022f20: 6622 4241 4420 6865 6164 5f73 7479 6c65  f"BAD head_style
-00022f30: 207b 7374 796c 655f 7465 7874 7d22 290a   {style_text}").
-00022f40: 2020 2020 2020 2020 2020 2020 7265 6620              ref 
-00022f50: 3d20 6d61 7463 682e 6772 6f75 7028 3129  = match.group(1)
-00022f60: 0a20 2020 2020 2020 2020 2020 2063 7373  .            css
-00022f70: 5f73 7472 696e 6720 3d20 6d61 7463 682e  _string = match.
-00022f80: 6772 6f75 7028 3229 0a20 2020 2020 2020  group(2).       
-00022f90: 2020 2020 2069 6620 6373 735f 7374 7269       if css_stri
-00022fa0: 6e67 203d 3d20 2222 3a0a 2020 2020 2020  ng == "":.      
-00022fb0: 2020 2020 2020 2020 2020 2320 7468 6973            # this
-00022fc0: 206f 6363 7572 7320 7768 656e 2074 6865   occurs when the
-00022fd0: 2073 7479 6c65 2061 7474 7269 6275 7465   style attribute
-00022fe0: 7320 6172 6520 706f 7369 7469 6f6e 616c  s are positional
-00022ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023000: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
-00023010: 2020 2020 2020 6966 2076 616c 6964 6174        if validat
-00023020: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00023030: 2020 2063 7373 5f73 7479 6c65 203d 2043     css_style = C
-00023040: 5353 5374 796c 652e 6372 6561 7465 5f63  SSStyle.create_c
-00023050: 7373 5f73 7479 6c65 5f66 726f 6d5f 6373  ss_style_from_cs
-00023060: 735f 7374 7269 6e67 2863 7373 5f73 7472  s_string(css_str
-00023070: 696e 6729 0a20 2020 2020 2020 2020 2020  ing).           
-00023080: 2020 2020 2069 6620 6373 735f 7374 796c       if css_styl
-00023090: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
-000230a0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000230b0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-000230c0: 6622 6261 6420 4353 5353 7479 6c65 207b  f"bad CSSStyle {
-000230d0: 6373 735f 7374 796c 657d 2229 0a20 2020  css_style}").   
-000230e0: 2020 2020 2020 2020 2069 6620 7265 6620           if ref 
-000230f0: 696e 2073 7479 6c65 5f64 6963 743a 0a20  in style_dict:. 
-00023100: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00023110: 6620 7661 6c69 6461 7465 3a0a 2020 2020  f validate:.    
-00023120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023130: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00023140: 2866 2264 7570 6c69 6361 7465 2073 7479  (f"duplicate sty
-00023150: 6c65 2072 6566 207b 7374 796c 655f 7465  le ref {style_te
-00023160: 7874 7d22 290a 2020 2020 2020 2020 2020  xt}").          
-00023170: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00023180: 2020 2020 2020 2020 7374 796c 655f 6469          style_di
-00023190: 6374 5b72 6566 5d20 3d20 6373 735f 7374  ct[ref] = css_st
-000231a0: 7269 6e67 0a20 2020 2020 2020 2072 6574  ring.        ret
-000231b0: 7572 6e20 7374 796c 655f 6469 6374 0a0a  urn style_dict..
-000231c0: 2020 2020 2320 2020 2063 6c61 7373 2043      #    class C
-000231d0: 5353 5374 796c 653a 0a0a 2020 2020 4063  SSStyle:..    @c
-000231e0: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-000231f0: 6566 2065 7874 7261 6374 5f73 7479 6c65  ef extract_style
-00023200: 735f 6672 6f6d 5f68 746d 6c5f 7374 7269  s_from_html_stri
-00023210: 6e67 2863 6c73 2c20 6874 6d6c 5f73 7472  ng(cls, html_str
-00023220: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-00023230: 2020 2020 2020 2065 7874 7261 6374 2073         extract s
-00023240: 7479 6c65 7320 6672 6f6d 2068 6561 6420  tyles from head 
-00023250: 6f66 2068 746d 6c20 6669 6c65 0a20 2020  of html file.   
-00023260: 2020 2020 203a 7061 7261 6d20 6874 6d6c       :param html
-00023270: 5f73 7472 3a20 7374 7269 6e67 206f 6620  _str: string of 
-00023280: 666f 726d 203c 6874 6d6c 3e3c 6865 6164  form <html><head
-00023290: 3e3c 7374 796c 6520 2e2e 2e3e 3c2f 7374  ><style ...></st
-000232a0: 796c 653e 3c73 7479 6c65 202e 2e2e 3e3c  yle><style ...><
-000232b0: 2f73 7479 6c65 3e3c 2f68 6561 643e 202e  /style></head> .
-000232c0: 2e2e 203c 2f68 746d 6c3e 0a20 2020 2020  .. </html>.     
-000232d0: 2020 203a 7265 7475 726e 3a20 6c69 7374     :return: list
-000232e0: 206f 6620 5f45 6c65 6d65 6e74 7320 283c   of _Elements (<
-000232f0: 7374 796c 652e 2e2e 3e20 2e2e 2e3c 2f73  style...> ...</s
-00023300: 7479 6c65 3e29 206f 7220 5b5d 0a20 2020  tyle>) or [].   
-00023310: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00023320: 2072 6574 7572 6e20 636c 732e 6578 7472   return cls.extr
-00023330: 6163 745f 7374 796c 6573 5f66 726f 6d5f  act_styles_from_
-00023340: 6874 6d6c 5f68 6561 645f 656c 656d 656e  html_head_elemen
-00023350: 7428 4554 2e66 726f 6d73 7472 696e 6728  t(ET.fromstring(
-00023360: 6874 6d6c 5f73 7472 2929 0a0a 2020 2020  html_str))..    
-00023370: 2320 2020 2063 6c61 7373 2043 5353 5374  #    class CSSSt
-00023380: 796c 653a 0a0a 2020 2020 4063 6c61 7373  yle:..    @class
-00023390: 6d65 7468 6f64 0a20 2020 2064 6566 2065  method.    def e
-000233a0: 7874 7261 6374 5f73 7479 6c65 735f 6672  xtract_styles_fr
-000233b0: 6f6d 5f68 746d 6c5f 6865 6164 5f65 6c65  om_html_head_ele
-000233c0: 6d65 6e74 2863 6c73 2c20 6874 6d6c 5f65  ment(cls, html_e
-000233d0: 6c65 6d29 3a0a 2020 2020 2020 2020 2222  lem):.        ""
-000233e0: 220a 2020 2020 2020 2020 6578 7472 6163  ".        extrac
-000233f0: 7420 7374 796c 6573 2066 726f 6d20 6865  t styles from he
-00023400: 6164 206f 6620 6874 6d6c 2066 696c 650a  ad of html file.
-00023410: 2020 2020 2020 2020 3a70 6172 616d 2068          :param h
-00023420: 746d 6c5f 656c 656d 3a20 656c 656d 656e  tml_elem: elemen
-00023430: 7420 6f66 2066 6f72 6d20 3c68 746d 6c3e  t of form <html>
-00023440: 3c68 6561 643e 3c73 7479 6c65 202e 2e2e  <head><style ...
-00023450: 3e3c 2f73 7479 6c65 3e3c 7374 796c 6520  ></style><style 
-00023460: 2e2e 2e3e 3c2f 7374 796c 653e 3c2f 6865  ...></style></he
-00023470: 6164 3e20 2e2e 2e20 3c2f 6874 6d6c 3e0a  ad> ... </html>.
-00023480: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
-00023490: 206c 6973 7420 6f66 205f 456c 656d 656e   list of _Elemen
-000234a0: 7473 2028 3c73 7479 6c65 2e2e 2e3e 202e  ts (<style...> .
-000234b0: 2e2e 3c2f 7374 796c 653e 2920 6f72 205b  ..</style>) or [
-000234c0: 5d0a 2020 2020 2020 2020 2222 220a 2020  ].        """.  
-000234d0: 2020 2020 2020 7265 7475 726e 205b 5d20        return [] 
-000234e0: 6966 2068 746d 6c5f 656c 656d 2069 7320  if html_elem is 
-000234f0: 4e6f 6e65 2065 6c73 6520 6874 6d6c 5f65  None else html_e
-00023500: 6c65 6d2e 7870 6174 6828 5354 594c 455f  lem.xpath(STYLE_
-00023510: 5850 4154 4829 0a0a 2020 2020 4063 6c61  XPATH)..    @cla
-00023520: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-00023530: 2063 7265 6174 655f 6373 735f 7374 796c   create_css_styl
-00023540: 655f 6672 6f6d 5f68 746d 6c5f 6865 6164  e_from_html_head
-00023550: 5f73 7479 6c65 5f65 6c65 6d28 636c 732c  _style_elem(cls,
-00023560: 2073 7479 6c65 5f65 6c65 6d29 3a0a 2020   style_elem):.  
-00023570: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00023580: 2020 6578 7472 6163 7473 2043 5353 5374    extracts CSSSt
-00023590: 796c 6520 656c 656d 6e74 2066 726f 6d20  yle elemnt from 
-000235a0: 4854 4d4c 203c 7374 796c 653e 2e66 6f6f  HTML <style>.foo
-000235b0: 207b 613a 623b 2063 3a64 3b7d 2065 6c65   {a:b; c:d;} ele
-000235c0: 6d65 6e74 0a20 2020 2020 2020 203a 7061  ment.        :pa
-000235d0: 7261 6d20 7374 796c 655f 656c 656d 3a0a  ram style_elem:.
-000235e0: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
-000235f0: 2074 7570 6c65 2873 796d 626f 6c20 7265   tuple(symbol re
-00023600: 662c 206e 6577 2043 5353 5374 796c 6529  f, new CSSStyle)
-00023610: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00023620: 2020 2020 2073 7479 6c65 5f72 6520 3d20       style_re = 
-00023630: 7265 2e63 6f6d 7069 6c65 2822 5c5c 732a  re.compile("\\s*
-00023640: 285b 5e5c 5c73 5d2a 295c 5c73 2b7b 282e  ([^\\s]*)\\s+{(.
-00023650: 2a29 7d5c 5c73 2a22 290a 2020 2020 2020  *)}\\s*").      
-00023660: 2020 7379 6d62 6f6c 5f72 6566 203d 204e    symbol_ref = N
-00023670: 6f6e 650a 2020 2020 2020 2020 6373 735f  one.        css_
-00023680: 7374 796c 655f 6f62 6a20 3d20 4e6f 6e65  style_obj = None
-00023690: 0a20 2020 2020 2020 2069 6620 7479 7065  .        if type
-000236a0: 2873 7479 6c65 5f65 6c65 6d29 2069 7320  (style_elem) is 
-000236b0: 5f45 6c65 6d65 6e74 3a0a 2020 2020 2020  _Element:.      
-000236c0: 2020 2020 2020 7465 7874 203d 2058 6d6c        text = Xml
-000236d0: 4c69 622e 6765 745f 7465 7874 2873 7479  Lib.get_text(sty
-000236e0: 6c65 5f65 6c65 6d29 0a20 2020 2020 2020  le_elem).       
-000236f0: 2020 2020 206d 6174 6368 203d 2073 7479       match = sty
-00023700: 6c65 5f72 652e 6d61 7463 6828 7465 7874  le_re.match(text
-00023710: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00023720: 206d 6174 6368 3a0a 2020 2020 2020 2020   match:.        
-00023730: 2020 2020 2020 2020 7379 6d62 6f6c 5f72          symbol_r
-00023740: 6566 203d 206d 6174 6368 2e67 726f 7570  ef = match.group
-00023750: 2831 290a 2020 2020 2020 2020 2020 2020  (1).            
-00023760: 2020 2020 6373 735f 7374 796c 655f 6f62      css_style_ob
-00023770: 6a20 3d20 4353 5353 7479 6c65 2e63 7265  j = CSSStyle.cre
-00023780: 6174 655f 6373 735f 7374 796c 655f 6672  ate_css_style_fr
-00023790: 6f6d 5f63 7373 5f73 7472 696e 6728 6d61  om_css_string(ma
-000237a0: 7463 682e 6772 6f75 7028 3229 290a 2020  tch.group(2)).  
-000237b0: 2020 2020 2020 7265 7475 726e 2073 796d        return sym
-000237c0: 626f 6c5f 7265 662c 2063 7373 5f73 7479  bol_ref, css_sty
-000237d0: 6c65 5f6f 626a 0a0a 2020 2020 4063 6c61  le_obj..    @cla
-000237e0: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-000237f0: 2072 6570 6c61 6365 5f63 7373 5f73 7479   replace_css_sty
-00023800: 6c65 5f6e 616d 655f 7661 6c75 6573 5f77  le_name_values_w
-00023810: 6974 685f 6e6f 726d 616c 697a 6564 5f66  ith_normalized_f
-00023820: 6f6e 7428 636c 732c 2073 7479 6c65 5f65  ont(cls, style_e
-00023830: 6c65 6d29 3a0a 2020 2020 2020 2020 2222  lem):.        ""
-00023840: 220a 2020 2020 2020 2020 6966 2073 7479  ".        if sty
-00023850: 6c65 5f65 6c65 6d20 636f 6e74 6169 6e73  le_elem contains
-00023860: 2061 2066 6f6e 7420 696e 2074 6865 2043   a font in the C
-00023870: 5353 2076 616c 7565 732c 206e 6f72 6d61  SS values, norma
-00023880: 6c69 7a65 7320 6974 2069 6620 706f 7373  lizes it if poss
-00023890: 6962 6c65 0a20 2020 2020 2020 2028 652e  ible.        (e.
-000238a0: 672e 2066 6f6e 742d 6661 6d69 6c79 3a20  g. font-family: 
-000238b0: 4172 6961 6c42 6f6c 643b 203d 3e20 666f  ArialBold; => fo
-000238c0: 6e74 2d66 616d 696c 793a 4172 6961 6c3b  nt-family:Arial;
-000238d0: 2066 6f6e 742d 7765 6967 6874 3a20 626f   font-weight: bo
-000238e0: 6c64 3b0a 2020 2020 2020 2020 6564 6974  ld;.        edit
-000238f0: 7320 7468 6520 7374 796c 655f 656c 656d  s the style_elem
-00023900: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00023910: 7374 796c 655f 656c 656d 3a20 656c 656d  style_elem: elem
-00023920: 656e 7420 746f 2062 6520 6564 6974 6564  ent to be edited
-00023930: 2028 4e4f 5420 636f 7069 6564 290a 2020   (NOT copied).  
-00023940: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00023950: 2020 7379 6d62 6f6c 5f72 6566 2c20 6e65    symbol_ref, ne
-00023960: 775f 6373 7373 7479 6c65 203d 2041 6d69  w_cssstyle = Ami
-00023970: 466f 6e74 2e63 7265 6174 655f 666f 6e74  Font.create_font
-00023980: 5f65 6469 7465 645f 7374 796c 655f 6672  _edited_style_fr
-00023990: 6f6d 5f63 7373 5f73 7479 6c65 5f6f 626a  om_css_style_obj
-000239a0: 6563 7428 7374 796c 655f 656c 656d 290a  ect(style_elem).
-000239b0: 2020 2020 2020 2020 6966 206e 6577 5f63          if new_c
-000239c0: 7373 7374 796c 6520 6973 206e 6f74 204e  ssstyle is not N
-000239d0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-000239e0: 2073 7479 6c65 5f65 6c65 6d2e 7465 7874   style_elem.text
-000239f0: 203d 2066 227b 7379 6d62 6f6c 5f72 6566   = f"{symbol_ref
-00023a00: 7d20 7b7b 7b6e 6577 5f63 7373 7374 796c  } {{{new_cssstyl
-00023a10: 657d 7d7d 220a 0a20 2020 2040 636c 6173  e}}}"..    @clas
-00023a20: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
-00023a30: 6e6f 726d 616c 697a 655f 7374 796c 6573  normalize_styles
-00023a40: 5f69 6e5f 666f 6e74 735f 696e 5f68 746d  _in_fonts_in_htm
-00023a50: 6c5f 6865 6164 2863 6c73 2c20 6874 6d6c  l_head(cls, html
-00023a60: 5f65 6c65 6d29 3a0a 2020 2020 2020 2020  _elem):.        
-00023a70: 2222 220a 2020 2020 2020 2020 6e6f 726d  """.        norm
-00023a80: 616c 697a 6573 2061 6c6c 2066 6f6e 7473  alizes all fonts
-00023a90: 2074 6f20 6578 706f 7365 2066 6f6e 7420   to expose font 
-00023aa0: 7765 6967 6874 7320 616e 6420 7374 796c  weights and styl
-00023ab0: 6573 0a20 2020 2020 2020 203a 7061 7261  es.        :para
-00023ac0: 6d20 6874 6d6c 5f65 6c65 6d3a 2048 544d  m html_elem: HTM
-00023ad0: 4c20 2872 6f6f 7429 2065 6c65 6d65 6e74  L (root) element
-00023ae0: 2028 6874 6d6c 2f68 6561 642f 7374 796c   (html/head/styl
-00023af0: 652a 290a 2020 2020 2020 2020 2222 220a  e*).        """.
-00023b00: 2020 2020 2020 2020 7374 796c 655f 656c          style_el
-00023b10: 656d 7320 3d20 4353 5353 7479 6c65 2e65  ems = CSSStyle.e
-00023b20: 7874 7261 6374 5f73 7479 6c65 735f 6672  xtract_styles_fr
-00023b30: 6f6d 5f68 746d 6c5f 6865 6164 5f65 6c65  om_html_head_ele
-00023b40: 6d65 6e74 2868 746d 6c5f 656c 656d 290a  ment(html_elem).
-00023b50: 2020 2020 2020 2020 666f 7220 7374 796c          for styl
-00023b60: 655f 656c 656d 2069 6e20 7374 796c 655f  e_elem in style_
-00023b70: 656c 656d 733a 0a20 2020 2020 2020 2020  elems:.         
-00023b80: 2020 2043 5353 5374 796c 652e 7265 706c     CSSStyle.repl
-00023b90: 6163 655f 6373 735f 7374 796c 655f 6e61  ace_css_style_na
-00023ba0: 6d65 5f76 616c 7565 735f 7769 7468 5f6e  me_values_with_n
-00023bb0: 6f72 6d61 6c69 7a65 645f 666f 6e74 2873  ormalized_font(s
-00023bc0: 7479 6c65 5f65 6c65 6d29 0a0a 2020 2020  tyle_elem)..    
-00023bd0: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
-00023be0: 6620 7368 6f72 745f 7374 796c 6528 7365  f short_style(se
-00023bf0: 6c66 293a 0a20 2020 2020 2020 2073 686f  lf):.        sho
-00023c00: 7274 5f73 7479 6c65 203d 2073 656c 662e  rt_style = self.
-00023c10: 666f 6e74 5f66 616d 696c 792e 6c6f 7765  font_family.lowe
-00023c20: 7228 295b 3a33 5d0a 2020 2020 2020 2020  r()[:3].        
-00023c30: 7368 6f72 745f 7374 796c 6520 2b3d 2073  short_style += s
-00023c40: 7472 2873 656c 662e 666f 6e74 5f73 697a  tr(self.font_siz
-00023c50: 6529 2e72 6570 6c61 6365 2822 2e22 2c20  e).replace(".", 
-00023c60: 225f 2229 0a20 2020 2020 2020 2069 6620  "_").        if 
-00023c70: 7365 6c66 2e69 735f 626f 6c64 3a0a 2020  self.is_bold:.  
-00023c80: 2020 2020 2020 2020 2020 7368 6f72 745f            short_
-00023c90: 7374 796c 6520 2b3d 2022 6222 0a20 2020  style += "b".   
-00023ca0: 2020 2020 2069 6620 7365 6c66 2e69 735f       if self.is_
-00023cb0: 6974 616c 6963 3a0a 2020 2020 2020 2020  italic:.        
-00023cc0: 2020 2020 7368 6f72 745f 7374 796c 6520      short_style 
-00023cd0: 2b3d 2022 6922 0a20 2020 2020 2020 2072  += "i".        r
-00023ce0: 6574 7572 6e20 7368 6f72 745f 7374 796c  eturn short_styl
-00023cf0: 650a 0a20 2020 2064 6566 2067 6574 5f66  e..    def get_f
-00023d00: 6f6e 745f 6174 7472 6962 7574 6573 2873  ont_attributes(s
-00023d10: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-00023d20: 220a 2020 2020 2020 2020 7365 7473 2034  ".        sets 4
-00023d30: 2066 6f6e 7420 6174 7472 6962 7574 6573   font attributes
-00023d40: 2028 7769 6474 682c 2073 697a 652c 206e   (width, size, n
-00023d50: 6f6e 7374 726f 6b65 2c20 7374 726f 6b65  onstroke, stroke
-00023d60: 2c20 666f 6e74 6e61 6d65 0a20 2020 2020  , fontname.     
-00023d70: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-00023d80: 6966 2073 656c 662e 6e61 6d65 5f76 616c  if self.name_val
-00023d90: 7565 5f64 6963 7420 6973 204e 6f6e 653a  ue_dict is None:
-00023da0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00023db0: 7572 6e20 284e 6f6e 652c 204e 6f6e 652c  urn (None, None,
-00023dc0: 204e 6f6e 652c 204e 6f6e 652c 204e 6f6e   None, None, Non
-00023dd0: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
-00023de0: 6e20 280a 2020 2020 2020 2020 2020 2020  n (.            
-00023df0: 2320 7365 6c66 2e6e 616d 655f 7661 6c75  # self.name_valu
-00023e00: 655f 6469 6374 2e67 6574 2843 5353 5374  e_dict.get(CSSSt
-00023e10: 796c 652e 5749 4454 4829 2c0a 2020 2020  yle.WIDTH),.    
-00023e20: 2020 2020 2020 2020 7365 6c66 2e67 6574          self.get
-00023e30: 5f61 7474 7269 6275 7465 2843 5353 5374  _attribute(CSSSt
-00023e40: 796c 652e 464f 4e54 5f53 495a 4529 2c0a  yle.FONT_SIZE),.
-00023e50: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00023e60: 2e67 6574 5f61 7474 7269 6275 7465 2843  .get_attribute(C
-00023e70: 5353 5374 796c 652e 4649 4c4c 292c 0a20  SSStyle.FILL),. 
-00023e80: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00023e90: 6765 745f 6174 7472 6962 7574 6528 4353  get_attribute(CS
-00023ea0: 5353 7479 6c65 2e53 5452 4f4b 4529 2c0a  SStyle.STROKE),.
-00023eb0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00023ec0: 2e67 6574 5f61 7474 7269 6275 7465 2843  .get_attribute(C
-00023ed0: 5353 5374 796c 652e 464f 4e54 5f46 414d  SSStyle.FONT_FAM
-00023ee0: 494c 5929 0a20 2020 2020 2020 2029 0a0a  ILY).        )..
-00023ef0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-00023f00: 0a20 2020 2064 6566 2067 6574 5f63 6f6f  .    def get_coo
-00023f10: 7264 7328 636c 732c 2065 6c65 6d29 3a0a  rds(cls, elem):.
-00023f20: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00023f30: 2020 2020 3a72 6574 7572 6e3a 2078 302c      :return: x0,
-00023f40: 2078 312c 2079 302c 2079 310a 2020 2020   x1, y0, y1.    
-00023f50: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00023f60: 6373 7373 203d 2063 6c73 2e63 7265 6174  csss = cls.creat
-00023f70: 655f 6373 735f 7374 796c 655f 6672 6f6d  e_css_style_from
-00023f80: 5f61 7474 7269 6275 7465 5f6f 665f 626f  _attribute_of_bo
-00023f90: 6479 5f65 6c65 6d65 6e74 2865 6c65 6d29  dy_element(elem)
-00023fa0: 0a20 2020 2020 2020 2078 3020 3d20 6373  .        x0 = cs
-00023fb0: 7373 2e67 6574 5f6e 756d 6572 6963 5f61  ss.get_numeric_a
-00023fc0: 7474 7661 6c28 2278 3022 290a 2020 2020  ttval("x0").    
-00023fd0: 2020 2020 7831 203d 2063 7373 732e 6765      x1 = csss.ge
-00023fe0: 745f 6e75 6d65 7269 635f 6174 7476 616c  t_numeric_attval
-00023ff0: 2822 7831 2229 0a20 2020 2020 2020 2079  ("x1").        y
-00024000: 3020 3d20 6373 7373 2e67 6574 5f6e 756d  0 = csss.get_num
-00024010: 6572 6963 5f61 7474 7661 6c28 2279 3022  eric_attval("y0"
-00024020: 290a 2020 2020 2020 2020 7931 203d 2063  ).        y1 = c
-00024030: 7373 732e 6765 745f 6e75 6d65 7269 635f  sss.get_numeric_
-00024040: 6174 7476 616c 2822 7931 2229 0a20 2020  attval("y1").   
-00024050: 2020 2020 2072 6574 7572 6e20 2878 302c       return (x0,
-00024060: 2079 302c 2078 312c 2079 3129 0a0a 2020   y0, x1, y1)..  
-00024070: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-00024080: 2020 2064 6566 2067 6574 5f78 3028 636c     def get_x0(cl
-00024090: 732c 2065 6c65 6d29 3a0a 2020 2020 2020  s, elem):.      
-000240a0: 2020 7265 7475 726e 2063 6c73 2e67 6574    return cls.get
-000240b0: 5f63 6f6f 7264 7328 656c 656d 295b 305d  _coords(elem)[0]
-000240c0: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-000240d0: 6f64 0a20 2020 2064 6566 2067 6574 5f79  od.    def get_y
-000240e0: 3028 636c 732c 2065 6c65 6d29 3a0a 2020  0(cls, elem):.  
-000240f0: 2020 2020 2020 7265 7475 726e 2063 6c73        return cls
-00024100: 2e67 6574 5f63 6f6f 7264 7328 656c 656d  .get_coords(elem
-00024110: 295b 315d 0a0a 2020 2020 4063 6c61 7373  )[1]..    @class
-00024120: 6d65 7468 6f64 0a20 2020 2064 6566 2067  method.    def g
-00024130: 6574 5f78 3128 636c 732c 2065 6c65 6d29  et_x1(cls, elem)
-00024140: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00024150: 2063 6c73 2e67 6574 5f63 6f6f 7264 7328   cls.get_coords(
-00024160: 656c 656d 295b 325d 0a0a 2020 2020 4063  elem)[2]..    @c
-00024170: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-00024180: 6566 2067 6574 5f79 3128 636c 732c 2065  ef get_y1(cls, e
-00024190: 6c65 6d29 3a0a 2020 2020 2020 2020 7265  lem):.        re
-000241a0: 7475 726e 2063 6c73 2e67 6574 5f63 6f6f  turn cls.get_coo
-000241b0: 7264 7328 656c 656d 295b 335d 0a0a 2020  rds(elem)[3]..  
-000241c0: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-000241d0: 2020 2064 6566 2065 7874 7261 6374 5f63     def extract_c
-000241e0: 6f6f 7264 735f 616e 645f 666f 6e74 5f70  oords_and_font_p
-000241f0: 726f 7065 7274 6965 7328 636c 732c 2073  roperties(cls, s
-00024200: 7061 6e29 3a0a 2020 2020 2020 2020 6373  pan):.        cs
-00024210: 7373 203d 2043 5353 5374 796c 652e 6372  ss = CSSStyle.cr
-00024220: 6561 7465 5f63 7373 5f73 7479 6c65 5f66  eate_css_style_f
-00024230: 726f 6d5f 6174 7472 6962 7574 655f 6f66  rom_attribute_of
-00024240: 5f62 6f64 795f 656c 656d 656e 7428 7370  _body_element(sp
-00024250: 616e 290a 2020 2020 2020 2020 666f 6e74  an).        font
-00024260: 5f73 697a 6520 3d20 6373 7373 2e67 6574  _size = csss.get
-00024270: 5f6e 756d 6572 6963 5f61 7474 7661 6c28  _numeric_attval(
-00024280: 4353 5353 7479 6c65 2e46 4f4e 545f 5349  CSSStyle.FONT_SI
-00024290: 5a45 290a 2020 2020 2020 2020 7930 203d  ZE).        y0 =
-000242a0: 2063 7373 732e 6765 745f 6e75 6d65 7269   csss.get_numeri
-000242b0: 635f 6174 7476 616c 2822 7930 2229 0a20  c_attval("y0"). 
-000242c0: 2020 2020 2020 2079 3120 3d20 6373 7373         y1 = csss
-000242d0: 2e67 6574 5f6e 756d 6572 6963 5f61 7474  .get_numeric_att
-000242e0: 7661 6c28 2279 3122 290a 2020 2020 2020  val("y1").      
-000242f0: 2020 7831 203d 2063 7373 732e 6765 745f    x1 = csss.get_
-00024300: 6e75 6d65 7269 635f 6174 7476 616c 2822  numeric_attval("
-00024310: 7831 2229 0a20 2020 2020 2020 2072 6574  x1").        ret
-00024320: 7572 6e20 666f 6e74 5f73 697a 652c 2079  urn font_size, y
-00024330: 302c 2079 310a 0a20 2020 2040 636c 6173  0, y1..    @clas
-00024340: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
-00024350: 6578 7472 6163 745f 626f 6c64 5f69 7461  extract_bold_ita
-00024360: 6c69 635f 6672 6f6d 5f66 6f6e 745f 6661  lic_from_font_fa
-00024370: 6d69 6c79 5f66 6f72 5f73 7479 6c65 7328  mily_for_styles(
-00024380: 636c 732c 2073 7479 6c65 7329 3a0a 2020  cls, styles):.  
-00024390: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000243a0: 2020 3a73 7479 6c65 733a 206c 6973 7420    :styles: list 
-000243b0: 6f66 2043 5353 5374 796c 6520 6f62 6a65  of CSSStyle obje
-000243c0: 6374 7320 746f 206e 6f72 6d61 6c69 7a65  cts to normalize
-000243d0: 0a0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-000243e0: 2020 2020 2020 6578 7472 6163 7465 6420        extracted 
-000243f0: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
-00024400: 2073 7479 6c65 2069 6e20 7374 796c 6573   style in styles
-00024410: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00024420: 2073 7479 6c65 3a0a 2020 2020 2020 2020   style:.        
-00024430: 2020 2020 2020 2020 6578 7472 6163 7465          extracte
-00024440: 642e 6170 7065 6e64 2863 6c73 2e65 7874  d.append(cls.ext
-00024450: 7261 6374 5f62 6f6c 645f 6974 616c 6963  ract_bold_italic
-00024460: 5f66 726f 6d5f 666f 6e74 5f66 616d 696c  _from_font_famil
-00024470: 795f 666f 725f 7374 796c 6528 7374 796c  y_for_style(styl
-00024480: 6529 290a 2020 2020 2020 2020 7265 7475  e)).        retu
-00024490: 726e 2065 7874 7261 6374 6564 0a0a 2020  rn extracted..  
-000244a0: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-000244b0: 2020 2064 6566 2065 7874 7261 6374 5f62     def extract_b
-000244c0: 6f6c 645f 6974 616c 6963 5f66 726f 6d5f  old_italic_from_
-000244d0: 666f 6e74 5f66 616d 696c 795f 666f 725f  font_family_for_
-000244e0: 7374 796c 6528 636c 732c 2073 7479 6c65  style(cls, style
-000244f0: 5f73 293a 0a20 2020 2020 2020 2069 6620  _s):.        if 
-00024500: 6e6f 7420 7374 796c 655f 733a 0a20 2020  not style_s:.   
-00024510: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00024520: 616c 7565 4572 726f 7228 2273 7479 6c65  alueError("style
-00024530: 5f73 2069 7320 4e6f 6e65 2229 0a20 2020  _s is None").   
-00024540: 2020 2020 2063 7373 5f73 7479 6c65 203d       css_style =
-00024550: 2043 5353 5374 796c 652e 6372 6561 7465   CSSStyle.create
-00024560: 5f63 7373 5f73 7479 6c65 5f66 726f 6d5f  _css_style_from_
-00024570: 6373 735f 7374 7269 6e67 2873 7472 2873  css_string(str(s
-00024580: 7479 6c65 5f73 2929 0a20 2020 2020 2020  tyle_s)).       
-00024590: 2069 6620 6373 735f 7374 796c 653a 0a20   if css_style:. 
-000245a0: 2020 2020 2020 2020 2020 2063 7373 5f73             css_s
-000245b0: 7479 6c65 2e65 7874 7261 6374 5f62 6f6c  tyle.extract_bol
-000245c0: 645f 6974 616c 6963 5f66 726f 6d5f 666f  d_italic_from_fo
-000245d0: 6e74 5f66 616d 696c 7928 0a20 2020 2020  nt_family(.     
-000245e0: 2020 2020 2020 2020 2020 206f 7665 7277             overw
-000245f0: 7269 7465 5f66 616d 696c 793d 5472 7565  rite_family=True
-00024600: 2c20 6f76 6572 7772 6974 655f 626f 6c64  , overwrite_bold
-00024610: 3d54 7275 652c 206f 7665 7277 7269 7465  =True, overwrite
-00024620: 5f73 7479 6c65 3d54 7275 6529 0a20 2020  _style=True).   
-00024630: 2020 2020 2072 6574 7572 6e20 6373 735f       return css_
-00024640: 7374 796c 650a 0a0a 636c 6173 7320 4353  style...class CS
-00024650: 5343 6f6e 7665 7274 6572 3a0a 2020 2020  SConverter:.    
-00024660: 2222 220a 2020 2020 7475 726e 7320 4343  """.    turns CC
-00024670: 5320 7374 796c 6573 2069 6e74 6f20 6874  S styles into ht
-00024680: 6d6c 2063 6c61 7373 6573 0a20 2020 2022  ml classes.    "
-00024690: 2222 0a0a 2020 2020 6465 6620 5f5f 696e  ""..    def __in
-000246a0: 6974 5f5f 2873 656c 6629 3a0a 2020 2020  it__(self):.    
-000246b0: 2020 2020 7061 7373 0a0a 2020 2020 6465      pass..    de
-000246c0: 6620 7265 6164 5f68 746d 6c5f 656c 656d  f read_html_elem
-000246d0: 656e 7428 7365 6c66 2c20 6874 6d6c 5f65  ent(self, html_e
-000246e0: 6c65 6d29 3a0a 2020 2020 2020 2020 2222  lem):.        ""
-000246f0: 220a 2020 2020 2020 2020 7265 6164 7320  ".        reads 
-00024700: 616e 6420 636f 6e76 6572 7473 2068 746d  and converts htm
-00024710: 6c20 656c 656d 656e 742e 0a20 2020 2020  l element..     
-00024720: 2020 2061 6464 7320 3c68 746d 6c3e 2061     adds <html> a
-00024730: 7320 726f 6f74 2069 6620 6e6f 7420 7072  s root if not pr
-00024740: 6573 656e 740a 2020 2020 2020 2020 2222  esent.        ""
-00024750: 220a 2020 2020 2020 2020 7365 6c66 2e68  ".        self.h
-00024760: 746d 6c5f 656c 656d 203d 2068 746d 6c5f  tml_elem = html_
-00024770: 656c 656d 0a20 2020 2020 2020 2073 656c  elem.        sel
-00024780: 662e 6874 6d6c 5f65 6c65 6d20 3d20 4874  f.html_elem = Ht
-00024790: 6d6c 5469 6479 2e65 6e73 7572 655f 6874  mlTidy.ensure_ht
-000247a0: 6d6c 5f68 6561 645f 626f 6479 2873 656c  ml_head_body(sel
-000247b0: 662e 6874 6d6c 5f65 6c65 6d29 0a20 2020  f.html_elem).   
-000247c0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-000247d0: 2e68 746d 6c5f 656c 656d 0a0a 0a63 6c61  .html_elem...cla
-000247e0: 7373 2046 6f6e 7450 726f 7065 7274 7928  ss FontProperty(
-000247f0: 456e 756d 293a 0a20 2020 2022 2222 0a20  Enum):.    """. 
-00024800: 2020 2041 7269 616c 4e61 7272 6f77 0a20     ArialNarrow. 
-00024810: 2020 2041 7269 616c 4e61 7272 6f77 2d42     ArialNarrow-B
-00024820: 6f6c 640a 2020 2020 4361 6c69 6272 690a  old.    Calibri.
-00024830: 2020 2020 4672 7574 6967 6572 4c54 5072      FrutigerLTPr
-00024840: 6f2d 426c 6163 6b43 6e0a 2020 2020 4672  o-BlackCn.    Fr
-00024850: 7574 6967 6572 4c54 5072 6f2d 426f 6c64  utigerLTPro-Bold
-00024860: 436e 0a20 2020 2046 7275 7469 6765 724c  Cn.    FrutigerL
-00024870: 5450 726f 2d42 6f6c 6443 6e49 7461 0a20  TPro-BoldCnIta. 
-00024880: 2020 2046 7275 7469 6765 724c 5450 726f     FrutigerLTPro
-00024890: 2d43 6f6e 6465 6e73 6564 0a20 2020 2046  -Condensed.    F
-000248a0: 7275 7469 6765 724c 5450 726f 2d43 6f6e  rutigerLTPro-Con
-000248b0: 6465 6e73 6564 4974 610a 2020 2020 4672  densedIta.    Fr
-000248c0: 7574 6967 6572 4c54 5072 6f2d 4c69 6768  utigerLTPro-Ligh
-000248d0: 740a 2020 2020 4672 7574 6967 6572 4c54  t.    FrutigerLT
-000248e0: 5072 6f2d 4c69 6768 7443 6e0a 2020 2020  Pro-LightCn.    
-000248f0: 4672 7574 6967 6572 4c54 5072 6f2d 4c69  FrutigerLTPro-Li
-00024900: 6768 7443 6e49 7461 0a20 2020 2046 7275  ghtCnIta.    Fru
-00024910: 7469 6765 724c 5450 726f 2d52 6f6d 616e  tigerLTPro-Roman
-00024920: 0a20 2020 2022 2222 0a20 2020 2023 0a20  .    """.    #. 
-00024930: 2020 204e 4f52 4d41 4c20 3d20 2222 0a0a     NORMAL = ""..
-00024940: 2020 2020 4e41 5252 4f57 203d 2022 6e61      NARROW = "na
-00024950: 7272 6f77 220a 2020 2020 5749 4445 203d  rrow".    WIDE =
-00024960: 2022 7769 6465 220a 0a20 2020 204c 4947   "wide"..    LIG
-00024970: 4854 203d 2022 6c69 6768 7422 0a20 2020  HT = "light".   
-00024980: 2042 4f4c 4420 3d20 2262 6f6c 6422 0a0a   BOLD = "bold"..
-00024990: 2020 2020 4954 414c 4943 203d 2022 6974      ITALIC = "it
-000249a0: 616c 6963 220a 0a20 2020 2053 414e 5320  alic"..    SANS 
-000249b0: 3d20 2273 616e 7322 0a20 2020 2053 4552  = "sans".    SER
-000249c0: 4946 203d 2022 7365 7269 6622 0a20 2020  IF = "serif".   
-000249d0: 2053 594d 424f 4c20 3d20 2273 796d 626f   SYMBOL = "symbo
-000249e0: 6c22 0a20 2020 204d 4f4e 4f53 5041 4345  l".    MONOSPACE
-000249f0: 203d 2022 736f 6e6f 7370 6163 6522 0a0a   = "sonospace"..
-00024a00: 2020 2020 6465 6620 5f5f 7374 725f 5f28      def __str__(
-00024a10: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
-00024a20: 6574 7572 6e20 7374 7228 7365 6c66 2e76  eturn str(self.v
-00024a30: 616c 7565 290a 0a20 2020 2064 6566 205f  alue)..    def _
-00024a40: 5f72 6570 725f 5f28 7365 6c66 293a 0a20  _repr__(self):. 
-00024a50: 2020 2020 2020 2072 6574 7572 6e20 7374         return st
-00024a60: 7228 7365 6c66 2e76 616c 7565 290a 0a0a  r(self.value)...
-00024a70: 2320 7374 7269 7073 2070 7265 6669 7820  # strips prefix 
-00024a80: 6f66 6620 666f 6e74 2d6e 616d 6573 0a52  off font-names.R
-00024a90: 455f 5052 4546 203d 2072 652e 636f 6d70  E_PREF = re.comp
-00024aa0: 696c 6528 225b 412d 5a5d 7b36 7d5c 5c2b  ile("[A-Z]{6}\\+
-00024ab0: 283f 503c 6e61 6d65 3e5b 5e5c 5c73 5d2b  (?P<name>[^\\s]+
-00024ac0: 295c 5c73 2a22 290a 0a0a 636c 6173 7320  )\\s*")...class 
-00024ad0: 416d 6946 6f6e 743a 0a20 2020 2022 2222  AmiFont:.    """
-00024ae0: 0a20 2020 2065 6d70 6972 6963 616c 206e  .    empirical n
-00024af0: 6f72 6d61 6c69 7a61 7469 6f6e 206f 6620  ormalization of 
-00024b00: 666f 6e74 732e 2054 7269 6573 2074 6f20  fonts. Tries to 
-00024b10: 636f 6e76 6572 7420 616c 6c20 746f 2074  convert all to t
-00024b20: 6865 0a20 2020 2062 6173 650a 2020 2020  he.    base.    
-00024b30: 666f 6e74 2d66 616d 696c 793a 2073 6572  font-family: ser
-00024b40: 6966 2f73 616e 732d 7365 7269 662f 6d6f  if/sans-serif/mo
-00024b50: 6e6f 7370 6163 650a 2020 2020 666f 6e74  nospace.    font
-00024b60: 2d73 7472 6574 6368 3a20 2863 6f6e 6465  -stretch: (conde
-00024b70: 6e73 6564 2f6e 6f72 6d61 6c2f 6578 7061  nsed/normal/expa
-00024b80: 6e64 6564 290a 2020 2020 666f 726e 2d77  nded).    forn-w
-00024b90: 6569 6768 743a 206e 6f72 6d61 6c2f 626f  eight: normal/bo
-00024ba0: 6c64 0a20 2020 2066 6f6e 742d 7374 796c  ld.    font-styl
-00024bb0: 653a 206e 6f72 6d61 6c2f 6974 616c 6963  e: normal/italic
-00024bc0: 0a20 2020 2022 2222 0a0a 2020 2020 2320  .    """..    # 
-00024bd0: 656d 7069 7269 6361 6c20 636f 6e76 6572  empirical conver
-00024be0: 7369 6f6e 733b 2077 696c 6c20 6e65 6564  sions; will need
-00024bf0: 2074 6f20 6265 2075 7064 6174 6564 2066   to be updated f
-00024c00: 7265 7175 656e 746c 790a 2020 2020 636f  requently.    co
-00024c10: 6e76 6572 7369 6f6e 5f64 6963 7420 3d20  nversion_dict = 
-00024c20: 7b0a 2020 2020 2020 2020 2241 7269 616c  {.        "Arial
-00024c30: 223a 2046 6f6e 7450 726f 7065 7274 792e  ": FontProperty.
-00024c40: 5341 4e53 2c0a 2020 2020 2020 2020 2243  SANS,.        "C
-00024c50: 616c 6962 7269 223a 2046 6f6e 7450 726f  alibri": FontPro
-00024c60: 7065 7274 792e 5341 4e53 2c0a 2020 2020  perty.SANS,.    
-00024c70: 2020 2020 2246 7275 7469 6765 7222 3a20      "Frutiger": 
-00024c80: 466f 6e74 5072 6f70 6572 7479 2e53 414e  FontProperty.SAN
-00024c90: 532c 0a20 2020 2020 2020 2022 4865 6c76  S,.        "Helv
-00024ca0: 6574 6963 6122 3a20 466f 6e74 5072 6f70  etica": FontProp
-00024cb0: 6572 7479 2e53 414e 532c 0a0a 2020 2020  erty.SANS,..    
-00024cc0: 2020 2020 2254 696d 6573 223a 2046 6f6e      "Times": Fon
-00024cd0: 7450 726f 7065 7274 792e 5345 5249 462c  tProperty.SERIF,
-00024ce0: 0a0a 2020 2020 2020 2020 2243 6f75 7269  ..        "Couri
-00024cf0: 6572 223a 2046 6f6e 7450 726f 7065 7274  er": FontPropert
-00024d00: 792e 4d4f 4e4f 5350 4143 452c 0a0a 2020  y.MONOSPACE,..  
-00024d10: 2020 2020 2020 2253 796d 626f 6c22 3a20        "Symbol": 
-00024d20: 466f 6e74 5072 6f70 6572 7479 2e53 594d  FontProperty.SYM
-00024d30: 424f 4c2c 0a20 2020 207d 0a0a 2020 2020  BOL,.    }..    
-00024d40: 636f 6e64 5f72 6567 6578 203d 2072 652e  cond_regex = re.
-00024d50: 636f 6d70 696c 6528 2228 2e2a 2928 436f  compile("(.*)(Co
-00024d60: 6e64 656e 7365 647c 436e 7c4e 6172 726f  ndensed|Cn|Narro
-00024d70: 7729 282e 2a29 2229 0a20 2020 2077 6964  w)(.*)").    wid
-00024d80: 655f 7265 6765 7820 3d20 7265 2e63 6f6d  e_regex = re.com
-00024d90: 7069 6c65 2822 282e 2a29 2857 6964 6529  pile("(.*)(Wide)
-00024da0: 282e 2a29 2229 0a0a 2020 2020 6c69 6768  (.*)")..    ligh
-00024db0: 745f 7265 6765 7820 3d20 7265 2e63 6f6d  t_regex = re.com
-00024dc0: 7069 6c65 2822 282e 2a29 284c 6967 6874  pile("(.*)(Light
-00024dd0: 7c54 6869 6e29 282e 2a29 2229 0a20 2020  |Thin)(.*)").   
-00024de0: 2062 6f6c 645f 7265 6765 7820 3d20 7265   bold_regex = re
-00024df0: 2e63 6f6d 7069 6c65 2822 282e 2a29 2842  .compile("(.*)(B
-00024e00: 6f6c 647c 4865 6176 7977 6569 6768 747c  old|Heavyweight|
-00024e10: 426c 6163 6b29 282e 2a29 2229 0a0a 2020  Black)(.*)")..  
-00024e20: 2020 7374 796c 655f 7265 6765 7820 3d20    style_regex = 
-00024e30: 7265 2e63 6f6d 7069 6c65 2822 282e 2a29  re.compile("(.*)
-00024e40: 2849 7461 6c69 637c 4974 617c 4f62 6c69  (Italic|Ita|Obli
-00024e50: 7175 6529 282e 2a29 2229 0a0a 2020 2020  que)(.*)")..    
-00024e60: 2320 2020 2063 6c61 7373 2041 6d69 466f  #    class AmiFo
-00024e70: 6e74 3a0a 0a20 2020 2064 6566 205f 5f69  nt:..    def __i
-00024e80: 6e69 745f 5f28 7365 6c66 293a 0a20 2020  nit__(self):.   
-00024e90: 2020 2020 2073 656c 662e 6e61 6d65 203d       self.name =
-00024ea0: 204e 6f6e 650a 2020 2020 2020 2020 7365   None.        se
-00024eb0: 6c66 2e66 616d 696c 7920 3d20 4e6f 6e65  lf.family = None
-00024ec0: 0a20 2020 2020 2020 2073 656c 662e 7765  .        self.we
-00024ed0: 6967 6874 203d 2073 7472 2846 6f6e 7450  ight = str(FontP
-00024ee0: 726f 7065 7274 792e 4e4f 524d 414c 290a  roperty.NORMAL).
-00024ef0: 2020 2020 2020 2020 7365 6c66 2e73 7479          self.sty
-00024f00: 6c65 203d 2073 7472 2846 6f6e 7450 726f  le = str(FontPro
-00024f10: 7065 7274 792e 4e4f 524d 414c 290a 2020  perty.NORMAL).  
-00024f20: 2020 2020 2020 7365 6c66 2e73 7472 6574        self.stret
-00024f30: 6368 6564 203d 2073 7472 2846 6f6e 7450  ched = str(FontP
-00024f40: 726f 7065 7274 792e 4e4f 524d 414c 290a  roperty.NORMAL).
-00024f50: 2020 2020 2020 2020 7365 6c66 2e66 6f6e          self.fon
-00024f60: 7420 3d20 7374 7228 466f 6e74 5072 6f70  t = str(FontProp
-00024f70: 6572 7479 2e53 414e 5329 0a0a 2020 2020  erty.SANS)..    
-00024f80: 2320 2020 2063 6c61 7373 2041 6d69 466f  #    class AmiFo
-00024f90: 6e74 3a0a 0a20 2020 2064 6566 205f 5f73  nt:..    def __s
-00024fa0: 7472 5f5f 2873 656c 6629 3a0a 2020 2020  tr__(self):.    
-00024fb0: 2020 2020 7320 3d20 6622 6e61 6d65 3a7b      s = f"name:{
-00024fc0: 7365 6c66 2e6e 616d 657d 3b66 616d 696c  self.name};famil
-00024fd0: 793a 7b73 656c 662e 6661 6d69 6c79 7d3b  y:{self.family};
-00024fe0: 7765 6967 6874 3a7b 7365 6c66 2e77 6569  weight:{self.wei
-00024ff0: 6768 747d 3b73 7479 6c65 3a7b 7365 6c66  ght};style:{self
-00025000: 2e73 7479 6c65 7d3b 7374 7265 7463 6865  .style};stretche
-00025010: 643a 7b73 656c 662e 7374 7265 7463 6865  d:{self.stretche
-00025020: 647d 3b66 6f6e 743a 7b73 656c 662e 666f  d};font:{self.fo
-00025030: 6e74 7d22 0a20 2020 2020 2020 2072 6574  nt}".        ret
-00025040: 7572 6e20 730a 0a20 2020 2040 636c 6173  urn s..    @clas
-00025050: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
-00025060: 6578 7472 6163 745f 6e61 6d65 5f77 6569  extract_name_wei
-00025070: 6768 745f 7374 796c 655f 7374 7265 7463  ght_style_stretc
-00025080: 6865 645f 6173 5f66 6f6e 7428 636c 732c  hed_as_font(cls,
-00025090: 206e 616d 6530 293a 0a0a 2020 2020 2020   name0):..      
-000250a0: 2020 666f 6e74 203d 2041 6d69 466f 6e74    font = AmiFont
-000250b0: 2829 0a20 2020 2020 2020 206e 616d 6520  ().        name 
-000250c0: 3d20 416d 6946 6f6e 742e 7472 696d 5f70  = AmiFont.trim_p
-000250d0: 6466 5f70 7265 6669 7828 6e61 6d65 3029  df_prefix(name0)
-000250e0: 0a0a 2020 2020 2020 2020 7768 696c 6520  ..        while 
-000250f0: 5472 7565 3a0a 2020 2020 2020 2020 2020  True:.          
-00025100: 2020 6e61 6d65 2c20 6d61 7463 6820 3d20    name, match = 
-00025110: 636c 732e 6578 7472 6163 745f 656e 756d  cls.extract_enum
-00025120: 6572 6174 6564 5f73 7479 6c65 7328 666f  erated_styles(fo
-00025130: 6e74 2c20 6e61 6d65 290a 2020 2020 2020  nt, name).      
-00025140: 2020 2020 2020 6966 206e 6f74 206d 6174        if not mat
-00025150: 6368 3a0a 2020 2020 2020 2020 2020 2020  ch:.            
-00025160: 2020 2020 6272 6561 6b0a 0a20 2020 2020      break..     
-00025170: 2020 206e 616d 6520 3d20 6e61 6d65 2e72     name = name.r
-00025180: 6570 6c61 6365 2822 2d22 2c20 2222 290a  eplace("-", "").
-00025190: 0a20 2020 2020 2020 2066 6f6e 742e 6661  .        font.fa
-000251a0: 6d69 6c79 203d 206e 616d 650a 2020 2020  mily = name.    
-000251b0: 2020 2020 666f 6e74 2e6e 616d 6520 3d20      font.name = 
-000251c0: 6e61 6d65 300a 2020 2020 2020 2020 7265  name0.        re
-000251d0: 7475 726e 2066 6f6e 740a 0a20 2020 2040  turn font..    @
-000251e0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-000251f0: 6465 6620 6578 7472 6163 745f 656e 756d  def extract_enum
-00025200: 6572 6174 6564 5f73 7479 6c65 7328 636c  erated_styles(cl
-00025210: 732c 2066 6f6e 742c 206e 616d 6529 3a0a  s, font, name):.
-00025220: 0a20 2020 2020 2020 206e 616d 652c 206d  .        name, m
-00025230: 6174 6368 203d 2063 6c73 2e6d 6174 6368  atch = cls.match
-00025240: 5f66 6f6e 745f 7072 6f70 6572 7479 286e  _font_property(n
-00025250: 616d 652c 2041 6d69 466f 6e74 2e63 6f6e  ame, AmiFont.con
-00025260: 645f 7265 6765 7829 0a20 2020 2020 2020  d_regex).       
-00025270: 2069 6620 6d61 7463 683a 0a20 2020 2020   if match:.     
-00025280: 2020 2020 2020 2066 6f6e 742e 7374 7265         font.stre
-00025290: 7463 6865 6420 3d20 466f 6e74 5072 6f70  tched = FontProp
-000252a0: 6572 7479 2e4e 4152 524f 570a 2020 2020  erty.NARROW.    
-000252b0: 2020 2020 2020 2020 7265 7475 726e 206e          return n
-000252c0: 616d 652c 206d 6174 6368 0a20 2020 2020  ame, match.     
-000252d0: 2020 206e 616d 652c 206d 6174 6368 203d     name, match =
-000252e0: 2063 6c73 2e6d 6174 6368 5f66 6f6e 745f   cls.match_font_
-000252f0: 7072 6f70 6572 7479 286e 616d 652c 2041  property(name, A
-00025300: 6d69 466f 6e74 2e77 6964 655f 7265 6765  miFont.wide_rege
-00025310: 7829 0a20 2020 2020 2020 2069 6620 6d61  x).        if ma
-00025320: 7463 683a 0a20 2020 2020 2020 2020 2020  tch:.           
-00025330: 2066 6f6e 742e 7374 7265 7463 6865 6420   font.stretched 
-00025340: 3d20 466f 6e74 5072 6f70 6572 7479 2e57  = FontProperty.W
-00025350: 4944 450a 2020 2020 2020 2020 2020 2020  IDE.            
-00025360: 7265 7475 726e 206e 616d 652c 206d 6174  return name, mat
-00025370: 6368 0a20 2020 2020 2020 206e 616d 652c  ch.        name,
-00025380: 206d 6174 6368 203d 2063 6c73 2e6d 6174   match = cls.mat
-00025390: 6368 5f66 6f6e 745f 7072 6f70 6572 7479  ch_font_property
-000253a0: 286e 616d 652c 2041 6d69 466f 6e74 2e6c  (name, AmiFont.l
-000253b0: 6967 6874 5f72 6567 6578 290a 2020 2020  ight_regex).    
-000253c0: 2020 2020 6966 206d 6174 6368 3a0a 2020      if match:.  
-000253d0: 2020 2020 2020 2020 2020 666f 6e74 2e77            font.w
-000253e0: 6569 6768 7420 3d20 466f 6e74 5072 6f70  eight = FontProp
-000253f0: 6572 7479 2e4c 4947 4854 0a20 2020 2020  erty.LIGHT.     
-00025400: 2020 2020 2020 2072 6574 7572 6e20 6e61         return na
-00025410: 6d65 2c20 6d61 7463 680a 2020 2020 2020  me, match.      
-00025420: 2020 6e61 6d65 2c20 6d61 7463 6820 3d20    name, match = 
-00025430: 636c 732e 6d61 7463 685f 666f 6e74 5f70  cls.match_font_p
-00025440: 726f 7065 7274 7928 6e61 6d65 2c20 416d  roperty(name, Am
-00025450: 6946 6f6e 742e 626f 6c64 5f72 6567 6578  iFont.bold_regex
-00025460: 290a 2020 2020 2020 2020 6966 206d 6174  ).        if mat
-00025470: 6368 3a0a 2020 2020 2020 2020 2020 2020  ch:.            
-00025480: 666f 6e74 2e77 6569 6768 7420 3d20 466f  font.weight = Fo
-00025490: 6e74 5072 6f70 6572 7479 2e42 4f4c 440a  ntProperty.BOLD.
-000254a0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000254b0: 726e 206e 616d 652c 206d 6174 6368 0a0a  rn name, match..
-000254c0: 2020 2020 2020 2020 6e61 6d65 2c20 6d61          name, ma
-000254d0: 7463 6820 3d20 636c 732e 6d61 7463 685f  tch = cls.match_
-000254e0: 666f 6e74 5f70 726f 7065 7274 7928 6e61  font_property(na
-000254f0: 6d65 2c20 416d 6946 6f6e 742e 7374 796c  me, AmiFont.styl
-00025500: 655f 7265 6765 7829 0a20 2020 2020 2020  e_regex).       
-00025510: 2069 6620 6d61 7463 683a 0a20 2020 2020   if match:.     
-00025520: 2020 2020 2020 2066 6f6e 742e 7374 796c         font.styl
-00025530: 6520 3d20 466f 6e74 5072 6f70 6572 7479  e = FontProperty
-00025540: 2e49 5441 4c49 430a 2020 2020 2020 2020  .ITALIC.        
-00025550: 2020 2020 7265 7475 726e 206e 616d 652c      return name,
-00025560: 206d 6174 6368 0a0a 2020 2020 2020 2020   match..        
-00025570: 7265 7475 726e 206e 616d 652c 204e 6f6e  return name, Non
-00025580: 650a 0a20 2020 2023 2020 2020 636c 6173  e..    #    clas
-00025590: 7320 416d 6946 6f6e 743a 0a0a 2020 2020  s AmiFont:..    
-000255a0: 2222 220a 2020 2020 426f 6c64 2046 6f6e  """.    Bold Fon
-000255b0: 7473 3a20 312e 2041 7269 616c 0a20 2020  ts: 1. Arial.   
-000255c0: 2043 616c 6962 7269 0a20 2020 2043 656e   Calibri.    Cen
-000255d0: 7475 7279 2047 6f74 6869 630a 2020 2020  tury Gothic.    
-000255e0: 2042 6f6c 6420 342e 200a 2020 2020 2046   Bold 4. .     F
-000255f0: 7261 6e6b 6c69 6e20 476f 7468 6963 200a  ranklin Gothic .
-00025600: 2020 2020 2042 6f6c 6420 352e 200a 2020       Bold 5. .  
-00025610: 2020 2046 7574 7572 6120 426f 6c64 2036     Futura Bold 6
-00025620: 2e20 0a20 2020 2020 4769 6c6c 2053 616e  . .     Gill San
-00025630: 7320 426f 6c64 2037 2e20 0a20 2020 2048  s Bold 7. .    H
-00025640: 656c 7665 7469 6361 2042 6f6c 6420 382e  elvetica Bold 8.
-00025650: 200a 2020 2020 496d 7061 6374 2042 6f6c   .    Impact Bol
-00025660: 6420 392e 0a20 2020 204c 7563 6964 6120  d 9..    Lucida 
-00025670: 5361 6e73 2042 6f6c 6420 3130 2e20 0a20  Sans Bold 10. . 
-00025680: 2020 204d 7972 6961 6420 5072 6f20 426f     Myriad Pro Bo
-00025690: 6c64 2031 312e 204f 7065 6e20 5361 6e73  ld 11. Open Sans
-000256a0: 2042 6f6c 6420 3132 2e20 5061 6c61 7469   Bold 12. Palati
-000256b0: 6e6f 2042 6f6c 6420 3133 2e20 526f 636b  no Bold 13. Rock
-000256c0: 7765 6c6c 2042 6f6c 6420 3134 2e20 0a20  well Bold 14. . 
-000256d0: 2020 2053 6567 6f65 2055 4920 426f 6c64     Segoe UI Bold
-000256e0: 2031 352e 2054 696d 6573 204e 6577 2052   15. Times New R
-000256f0: 6f6d 616e 2042 6f6c 6420 3136 2e20 556e  oman Bold 16. Un
-00025700: 6976 6572 7320 426f 6c64 2031 372e 2056  ivers Bold 17. V
-00025710: 6572 6461 6e61 2042 6f6c 6420 3138 2e20  erdana Bold 18. 
-00025720: 4176 656e 6972 2042 6f6c 6420 3139 2e20  Avenir Bold 19. 
-00025730: 4261 736b 6572 7669 6c6c 6520 426f 6c64  Baskerville Bold
-00025740: 2032 302e 2043 6c61 7265 6e64 6f6e 2042   20. Clarendon B
-00025750: 6f6c 6420 3231 2e20 430a 2020 2020 6f70  old 21. C.    op
-00025760: 7065 7270 6c61 7465 2042 6f6c 6420 3232  perplate Bold 22
-00025770: 2e20 4469 646f 7420 426f 6c64 2032 332e  . Didot Bold 23.
-00025780: 2045 7572 6f73 7469 6c65 2042 6f6c 6420   Eurostile Bold 
-00025790: 3234 2e20 4672 7574 6967 6572 2042 6f6c  24. Frutiger Bol
-000257a0: 6420 3235 2e20 4761 7261 6d6f 6e64 2042  d 25. Garamond B
-000257b0: 6f6c 6420 3236 2e20 4765 6f72 6769 6120  old 26. Georgia 
-000257c0: 426f 6c64 2032 372e 2047 6f74 6861 6d20  Bold 27. Gotham 
-000257d0: 426f 6c64 2032 382e 200a 2020 2020 486f  Bold 28. .    Ho
-000257e0: 6566 6c65 7220 5465 7874 2042 6f6c 6420  efler Text Bold 
-000257f0: 3239 2e20 4954 4320 4176 616e 7420 4761  29. ITC Avant Ga
-00025800: 7264 6520 476f 7468 6963 2042 6f6c 6420  rde Gothic Bold 
-00025810: 3330 2e20 4954 4320 4672 616e 6b6c 696e  30. ITC Franklin
-00025820: 2047 6f74 6869 6320 426f 6c64 2033 312e   Gothic Bold 31.
-00025830: 2049 5443 204c 7562 616c 696e 2047 7261   ITC Lubalin Gra
-00025840: 7068 2042 6f6c 6420 3332 2e20 0a20 2020  ph Bold 32. .   
-00025850: 2049 5443 204f 6666 6963 696e 6120 5361   ITC Officina Sa
-00025860: 6e73 2042 6f6c 6420 3333 2e20 4954 4320  ns Bold 33. ITC 
-00025870: 5374 6f6e 6520 5361 6e73 2042 6f6c 6420  Stone Sans Bold 
-00025880: 3334 2e20 4d69 6e69 6f6e 2050 726f 2042  34. Minion Pro B
-00025890: 6f6c 6420 3335 2e20 4d75 7365 6f20 5361  old 35. Museo Sa
-000258a0: 6e73 2042 6f6c 6420 3336 2e20 4e65 7574  ns Bold 36. Neut
-000258b0: 7261 6661 6365 2042 6f6c 6420 3337 2e20  raface Bold 37. 
-000258c0: 0a20 2020 204f 7074 696d 6120 426f 6c64  .    Optima Bold
-000258d0: 2033 382e 2050 726f 7869 6d61 204e 6f76   38. Proxima Nov
-000258e0: 6120 426f 6c64 2033 392e 2052 6f62 6f74  a Bold 39. Robot
-000258f0: 6f20 426f 6c64 2034 302e 2053 6162 6f6e  o Bold 40. Sabon
-00025900: 2042 6f6c 6420 3431 2e20 5472 6164 6520   Bold 41. Trade 
-00025910: 476f 7468 6963 2042 6f6c 6420 3432 2e20  Gothic Bold 42. 
-00025920: 0a20 2020 2054 7265 6275 6368 6574 204d  .    Trebuchet M
-00025930: 5320 426f 6c64 2034 332e 200a 2020 2020  S Bold 43. .    
-00025940: 5562 756e 7475 2042 6f6c 6420 3434 2e20  Ubuntu Bold 44. 
-00025950: 0a20 2020 2056 4147 2052 6f75 6e64 6564  .    VAG Rounded
-00025960: 2042 6f6c 6420 3435 2e20 0a20 2020 2057   Bold 45. .    W
-00025970: 6869 746e 6579 2042 6f6c 6420 3436 2e20  hitney Bold 46. 
-00025980: 0a20 2020 2058 6974 7320 426f 6c64 2034  .    Xits Bold 4
-00025990: 372e 200a 2020 2020 5961 6e6f 6e65 204b  7. .    Yanone K
-000259a0: 6166 6665 6573 6174 7a20 426f 6c64 2034  affeesatz Bold 4
-000259b0: 382e 200a 2020 2020 5a69 6c6c 6120 536c  8. .    Zilla Sl
-000259c0: 6162 0a20 2020 205a 6f6e 610a 2020 2020  ab.    Zona.    
-000259d0: 5a75 7269 6368 200a 2020 2020 2222 220a  Zurich .    """.
-000259e0: 0a20 2020 2023 2020 2020 636c 6173 7320  .    #    class 
-000259f0: 416d 6946 6f6e 743a 0a0a 2020 2020 4063  AmiFont:..    @c
-00025a00: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-00025a10: 6566 206d 6174 6368 5f66 6f6e 745f 7072  ef match_font_pr
-00025a20: 6f70 6572 7479 2863 6c73 2c20 6e61 6d65  operty(cls, name
-00025a30: 2c20 7265 6765 7829 3a0a 2020 2020 2020  , regex):.      
-00025a40: 2020 6d61 7463 6820 3d20 7265 6765 782e    match = regex.
-00025a50: 6d61 7463 6828 6e61 6d65 290a 2020 2020  match(name).    
-00025a60: 2020 2020 6966 206d 6174 6368 3a0a 2020      if match:.  
-00025a70: 2020 2020 2020 2020 2020 6e61 6d65 203d            name =
-00025a80: 206d 6174 6368 2e67 726f 7570 2831 2920   match.group(1) 
-00025a90: 2b20 6d61 7463 682e 6772 6f75 7028 3329  + match.group(3)
-00025aa0: 2020 2320 6368 6f70 206f 7574 206d 6174    # chop out mat
-00025ab0: 6368 0a20 2020 2020 2020 2072 6574 7572  ch.        retur
-00025ac0: 6e20 6e61 6d65 2c20 6d61 7463 680a 0a20  n name, match.. 
-00025ad0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-00025ae0: 2020 2020 6465 6620 636f 6e76 6572 745f      def convert_
-00025af0: 636f 6d6d 6f6e 5f66 6f6e 7473 2863 6c73  common_fonts(cls
-00025b00: 293a 0a20 2020 2020 2020 2070 6173 730a  ):.        pass.
-00025b10: 0a20 2020 2023 2020 2020 636c 6173 7320  .    #    class 
-00025b20: 416d 6946 6f6e 743a 0a0a 2020 2020 4063  AmiFont:..    @c
-00025b30: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-00025b40: 6566 2063 7265 6174 655f 666f 6e74 5f65  ef create_font_e
-00025b50: 6469 7465 645f 7374 796c 655f 6672 6f6d  dited_style_from
-00025b60: 5f68 6561 645f 7374 796c 6528 636c 732c  _head_style(cls,
-00025b70: 2073 7479 6c65 5f65 6c65 6d29 3a0a 2020   style_elem):.  
-00025b80: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00025b90: 2020 656d 7069 7269 6361 6c6c 7920 6372    empirically cr
-00025ba0: 6561 7465 2073 7461 6e64 6172 6420 666f  eate standard fo
-00025bb0: 6e74 7320 616e 6420 6174 7472 6962 7574  nts and attribut
-00025bc0: 6573 2066 726f 6d20 666f 6e74 206e 616d  es from font nam
-00025bd0: 6573 0a20 2020 2020 2020 203a 7061 7261  es.        :para
-00025be0: 6d20 6373 735f 7374 796c 653a 2043 5353  m css_style: CSS
-00025bf0: 5374 796c 6520 4f62 6a65 6374 206f 7220  Style Object or 
-00025c00: 4854 4d4c 2068 6561 642f 7374 796c 6520  HTML head/style 
-00025c10: 7769 7468 2075 6e6b 6e6f 776e 2066 6f6e  with unknown fon
-00025c20: 742d 6661 6d69 6c79 0a20 2020 2020 2020  t-family.       
-00025c30: 203a 7265 7475 726e 3a20 7475 706c 6520   :return: tuple 
-00025c40: 2873 796d 626f 6c5f 7265 662c 206e 6577  (symbol_ref, new
-00025c50: 2063 7373 5f73 7479 6c65 206f 626a 6563   css_style objec
-00025c60: 7420 7769 7468 2073 7461 6e64 6172 6420  t with standard 
-00025c70: 666f 6e74 2061 6e64 206d 6179 6265 206e  font and maybe n
-00025c80: 6577 2077 6569 6768 7420 6f72 2073 7479  ew weight or sty
-00025c90: 6c65 290a 2020 2020 2020 2020 2222 220a  le).        """.
-00025ca0: 2020 2020 2020 2020 6966 206e 6f74 2074          if not t
-00025cb0: 7970 6528 7374 796c 655f 656c 656d 2920  ype(style_elem) 
-00025cc0: 6973 205f 456c 656d 656e 743a 0a20 2020  is _Element:.   
-00025cd0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00025ce0: 4e6f 6e65 2c20 4e6f 6e65 0a20 2020 2020  None, None.     
-00025cf0: 2020 2073 796d 626f 6c5f 7265 662c 2063     symbol_ref, c
-00025d00: 7373 5f73 7479 6c65 203d 2043 5353 5374  ss_style = CSSSt
-00025d10: 796c 652e 6372 6561 7465 5f63 7373 5f73  yle.create_css_s
-00025d20: 7479 6c65 5f66 726f 6d5f 6874 6d6c 5f68  tyle_from_html_h
-00025d30: 6561 645f 7374 796c 655f 656c 656d 2873  ead_style_elem(s
-00025d40: 7479 6c65 5f65 6c65 6d29 0a20 2020 2020  tyle_elem).     
-00025d50: 2020 2069 6620 6373 735f 7374 796c 6520     if css_style 
-00025d60: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00025d70: 2020 2020 2020 2020 2066 6f6e 745f 6661           font_fa
-00025d80: 6d69 6c79 203d 2063 7373 5f73 7479 6c65  mily = css_style
-00025d90: 2e66 6f6e 745f 6661 6d69 6c79 0a20 2020  .font_family.   
-00025da0: 2020 2020 2020 2020 2061 6d69 5f66 6f6e           ami_fon
-00025db0: 7420 3d20 416d 6946 6f6e 742e 6578 7472  t = AmiFont.extr
-00025dc0: 6163 745f 6e61 6d65 5f77 6569 6768 745f  act_name_weight_
-00025dd0: 7374 796c 655f 7374 7265 7463 6865 645f  style_stretched_
-00025de0: 6173 5f66 6f6e 7428 666f 6e74 5f66 616d  as_font(font_fam
-00025df0: 696c 7929 0a20 2020 2020 2020 2020 2020  ily).           
-00025e00: 206e 6577 5f63 7373 5f73 7479 6c65 203d   new_css_style =
-00025e10: 2043 5353 5374 796c 6528 290a 2020 2020   CSSStyle().    
-00025e20: 2020 2020 2020 2020 666f 7220 6974 656d          for item
-00025e30: 2069 6e20 6373 735f 7374 796c 652e 6e61   in css_style.na
-00025e40: 6d65 5f76 616c 7565 5f64 6963 743a 0a20  me_value_dict:. 
-00025e50: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00025e60: 6577 5f63 7373 5f73 7479 6c65 2e6e 616d  ew_css_style.nam
-00025e70: 655f 7661 6c75 655f 6469 6374 5b69 7465  e_value_dict[ite
-00025e80: 6d5b 305d 5d20 3d20 6974 656d 5b31 5d0a  m[0]] = item[1].
-00025e90: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00025ea0: 6373 735f 7374 796c 652e 7365 745f 6174  css_style.set_at
-00025eb0: 7472 6962 7574 6528 464f 4e54 5f46 414d  tribute(FONT_FAM
-00025ec0: 494c 592c 2061 6d69 5f66 6f6e 742e 6661  ILY, ami_font.fa
-00025ed0: 6d69 6c79 290a 2020 2020 2020 2020 2020  mily).          
-00025ee0: 2020 6e65 775f 6373 735f 7374 796c 652e    new_css_style.
-00025ef0: 7365 745f 6174 7472 6962 7574 6528 464f  set_attribute(FO
-00025f00: 4e54 5f57 4549 4748 542c 2061 6d69 5f66  NT_WEIGHT, ami_f
-00025f10: 6f6e 742e 7765 6967 6874 290a 2020 2020  ont.weight).    
-00025f20: 2020 2020 2020 2020 6e65 775f 6373 735f          new_css_
-00025f30: 7374 796c 652e 7365 745f 6174 7472 6962  style.set_attrib
-00025f40: 7574 6528 464f 4e54 5f53 5459 4c45 2c20  ute(FONT_STYLE, 
-00025f50: 616d 695f 666f 6e74 2e73 7479 6c65 290a  ami_font.style).
-00025f60: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00025f70: 6373 735f 7374 796c 652e 7365 745f 6174  css_style.set_at
-00025f80: 7472 6962 7574 6528 464f 4e54 5f53 5452  tribute(FONT_STR
-00025f90: 4554 4348 4544 2c20 616d 695f 666f 6e74  ETCHED, ami_font
-00025fa0: 2e73 7472 6574 6368 6564 290a 2020 2020  .stretched).    
-00025fb0: 2020 2020 7265 7475 726e 2073 796d 626f      return symbo
-00025fc0: 6c5f 7265 662c 206e 6577 5f63 7373 5f73  l_ref, new_css_s
-00025fd0: 7479 6c65 0a0a 2020 2020 4063 6c61 7373  tyle..    @class
-00025fe0: 6d65 7468 6f64 0a20 2020 2064 6566 2063  method.    def c
-00025ff0: 7265 6174 655f 666f 6e74 5f65 6469 7465  reate_font_edite
-00026000: 645f 7374 796c 655f 6672 6f6d 5f63 7373  d_style_from_css
-00026010: 5f73 7479 6c65 5f6f 626a 6563 7428 636c  _style_object(cl
-00026020: 732c 2063 7373 5f73 7479 6c65 293a 0a20  s, css_style):. 
-00026030: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00026040: 2020 2065 6d70 6972 6963 616c 6c79 2063     empirically c
-00026050: 7265 6174 6520 7374 616e 6461 7264 2066  reate standard f
-00026060: 6f6e 7473 2061 6e64 2061 7474 7269 6275  onts and attribu
-00026070: 7465 7320 6672 6f6d 2066 6f6e 7420 6e61  tes from font na
-00026080: 6d65 730a 2020 2020 2020 2020 3a70 6172  mes.        :par
-00026090: 616d 2063 7373 5f73 7479 6c65 3a20 4353  am css_style: CS
-000260a0: 5353 7479 6c65 204f 626a 6563 7420 6f72  SStyle Object or
-000260b0: 2048 544d 4c20 6865 6164 2f73 7479 6c65   HTML head/style
-000260c0: 2077 6974 6820 756e 6b6e 6f77 6e20 666f   with unknown fo
-000260d0: 6e74 2d66 616d 696c 790a 2020 2020 2020  nt-family.      
-000260e0: 2020 3a72 6574 7572 6e3a 2074 7570 6c65    :return: tuple
-000260f0: 2028 7379 6d62 6f6c 5f72 6566 2c20 6e65   (symbol_ref, ne
-00026100: 7720 6373 735f 7374 796c 6520 6f62 6a65  w css_style obje
-00026110: 6374 2077 6974 6820 7374 616e 6461 7264  ct with standard
-00026120: 2066 6f6e 7420 616e 6420 6d61 7962 6520   font and maybe 
-00026130: 6e65 7720 7765 6967 6874 206f 7220 7374  new weight or st
-00026140: 796c 6529 0a20 2020 2020 2020 2022 2222  yle).        """
-00026150: 0a0a 2020 2020 2020 2020 6966 2063 7373  ..        if css
-00026160: 5f73 7479 6c65 2069 7320 4e6f 6e65 3a0a  _style is None:.
-00026170: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00026180: 726e 204e 6f6e 650a 2020 2020 2020 2020  rn None.        
-00026190: 6966 2074 7970 6528 6373 735f 7374 796c  if type(css_styl
-000261a0: 6529 2069 7320 4554 2e5f 456c 656d 656e  e) is ET._Elemen
-000261b0: 743a 0a20 2020 2020 2020 2020 2020 2070  t:.            p
-000261c0: 7269 6e74 2866 2265 6c65 6d65 6e74 207b  rint(f"element {
-000261d0: 4554 2e74 6f73 7472 696e 6728 6373 735f  ET.tostring(css_
-000261e0: 7374 796c 6529 7d22 290a 2020 2020 2020  style)}").      
-000261f0: 2020 6966 2074 7970 6528 6373 735f 7374    if type(css_st
-00026200: 796c 6529 2069 7320 7374 723a 0a20 2020  yle) is str:.   
-00026210: 2020 2020 2020 2020 2063 7373 5f73 7479           css_sty
-00026220: 6c65 203d 2043 5353 5374 796c 652e 6372  le = CSSStyle.cr
-00026230: 6561 7465 5f63 7373 5f73 7479 6c65 5f66  eate_css_style_f
-00026240: 726f 6d5f 6373 735f 7374 7269 6e67 2863  rom_css_string(c
-00026250: 7373 5f73 7479 6c65 290a 2020 2020 2020  ss_style).      
-00026260: 2020 6966 2063 7373 5f73 7479 6c65 2069    if css_style i
-00026270: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00026280: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
-00026290: 2020 2020 2020 2020 6173 7365 7274 2074          assert t
-000262a0: 7970 6528 6373 735f 7374 796c 6529 2069  ype(css_style) i
-000262b0: 7320 4353 5353 7479 6c65 2c20 6622 666f  s CSSStyle, f"fo
-000262c0: 756e 6420 7b74 7970 6528 6373 735f 7374  und {type(css_st
-000262d0: 796c 6529 7d22 0a20 2020 2020 2020 2069  yle)}".        i
-000262e0: 6620 6e6f 7420 6373 735f 7374 796c 652e  f not css_style.
-000262f0: 666f 6e74 5f66 616d 696c 793a 0a20 2020  font_family:.   
-00026300: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00026310: 6373 735f 7374 796c 650a 2020 2020 2020  css_style.      
-00026320: 2020 616d 695f 666f 6e74 203d 2041 6d69    ami_font = Ami
-00026330: 466f 6e74 2e65 7874 7261 6374 5f6e 616d  Font.extract_nam
-00026340: 655f 7765 6967 6874 5f73 7479 6c65 5f73  e_weight_style_s
-00026350: 7472 6574 6368 6564 5f61 735f 666f 6e74  tretched_as_font
-00026360: 2863 7373 5f73 7479 6c65 2e66 6f6e 745f  (css_style.font_
-00026370: 6661 6d69 6c79 290a 2020 2020 2020 2020  family).        
-00026380: 6e65 775f 6373 735f 7374 796c 6520 3d20  new_css_style = 
-00026390: 4353 5353 7479 6c65 2829 0a20 2020 2020  CSSStyle().     
-000263a0: 2020 2066 6f72 2069 7465 6d20 696e 2063     for item in c
-000263b0: 7373 5f73 7479 6c65 2e6e 616d 655f 7661  ss_style.name_va
-000263c0: 6c75 655f 6469 6374 2e69 7465 6d73 2829  lue_dict.items()
-000263d0: 3a0a 2020 2020 2020 2020 2020 2020 6e65  :.            ne
-000263e0: 775f 6373 735f 7374 796c 652e 6e61 6d65  w_css_style.name
-000263f0: 5f76 616c 7565 5f64 6963 745b 6974 656d  _value_dict[item
-00026400: 5b30 5d5d 203d 2069 7465 6d5b 315d 0a20  [0]] = item[1]. 
-00026410: 2020 2020 2020 206e 6577 5f63 7373 5f73         new_css_s
-00026420: 7479 6c65 2e73 6574 5f61 7474 7269 6275  tyle.set_attribu
-00026430: 7465 2846 4f4e 545f 4e41 4d45 2c20 7374  te(FONT_NAME, st
-00026440: 7228 616d 695f 666f 6e74 2e6e 616d 6529  r(ami_font.name)
-00026450: 290a 2020 2020 2020 2020 6e65 775f 6373  ).        new_cs
-00026460: 735f 7374 796c 652e 7365 745f 6174 7472  s_style.set_attr
-00026470: 6962 7574 6528 464f 4e54 5f46 4f4e 542c  ibute(FONT_FONT,
-00026480: 2073 7472 2861 6d69 5f66 6f6e 742e 666f   str(ami_font.fo
-00026490: 6e74 2929 0a20 2020 2020 2020 206e 6577  nt)).        new
-000264a0: 5f63 7373 5f73 7479 6c65 2e73 6574 5f61  _css_style.set_a
-000264b0: 7474 7269 6275 7465 2846 4f4e 545f 4641  ttribute(FONT_FA
-000264c0: 4d49 4c59 2c20 7374 7228 616d 695f 666f  MILY, str(ami_fo
-000264d0: 6e74 2e66 616d 696c 7929 290a 2020 2020  nt.family)).    
-000264e0: 2020 2020 6e65 775f 6373 735f 7374 796c      new_css_styl
-000264f0: 652e 7365 745f 6174 7472 6962 7574 6528  e.set_attribute(
-00026500: 464f 4e54 5f57 4549 4748 542c 2073 7472  FONT_WEIGHT, str
-00026510: 2861 6d69 5f66 6f6e 742e 7765 6967 6874  (ami_font.weight
-00026520: 292e 6c6f 7765 7228 2929 0a20 2020 2020  ).lower()).     
-00026530: 2020 206e 6577 5f63 7373 5f73 7479 6c65     new_css_style
-00026540: 2e73 6574 5f61 7474 7269 6275 7465 2846  .set_attribute(F
-00026550: 4f4e 545f 5354 594c 452c 2073 7472 2861  ONT_STYLE, str(a
-00026560: 6d69 5f66 6f6e 742e 7374 796c 6529 2e6c  mi_font.style).l
-00026570: 6f77 6572 2829 290a 2020 2020 2020 2020  ower()).        
-00026580: 6e65 775f 6373 735f 7374 796c 652e 7365  new_css_style.se
-00026590: 745f 6174 7472 6962 7574 6528 464f 4e54  t_attribute(FONT
-000265a0: 5f53 5452 4554 4348 4544 2c20 7374 7228  _STRETCHED, str(
-000265b0: 616d 695f 666f 6e74 2e73 7472 6574 6368  ami_font.stretch
-000265c0: 6564 292e 6c6f 7765 7228 2929 0a20 2020  ed).lower()).   
-000265d0: 2020 2020 2072 6574 7572 6e20 6e65 775f       return new_
-000265e0: 6373 735f 7374 796c 650a 0a20 2020 2023  css_style..    #
-000265f0: 2020 2020 636c 6173 7320 416d 6946 6f6e      class AmiFon
-00026600: 743a 0a0a 2020 2020 4070 726f 7065 7274  t:..    @propert
-00026610: 790a 2020 2020 6465 6620 6973 5f62 6f6c  y.    def is_bol
-00026620: 6428 7365 6c66 293a 0a20 2020 2020 2020  d(self):.       
-00026630: 2072 6574 7572 6e20 7374 7228 466f 6e74   return str(Font
-00026640: 5072 6f70 6572 7479 2e42 4f4c 4429 203d  Property.BOLD) =
-00026650: 3d20 7365 6c66 2e77 6569 6768 740a 0a20  = self.weight.. 
-00026660: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-00026670: 2064 6566 2069 735f 6974 616c 6963 2873   def is_italic(s
-00026680: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
-00026690: 7475 726e 2073 7472 2846 6f6e 7450 726f  turn str(FontPro
-000266a0: 7065 7274 792e 4954 414c 4943 2920 3d3d  perty.ITALIC) ==
-000266b0: 2073 656c 662e 7374 796c 650a 0a20 2020   self.style..   
-000266c0: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-000266d0: 2020 6465 6620 7472 696d 5f70 6466 5f70    def trim_pdf_p
-000266e0: 7265 6669 7828 636c 732c 206e 616d 6529  refix(cls, name)
-000266f0: 3a0a 2020 2020 2020 2020 2222 2272 656d  :.        """rem
-00026700: 6f76 6573 2074 6865 2041 4243 4445 462b  oves the ABCDEF+
-00026710: 2070 7265 6669 7820 6672 6f6d 2066 6f6e   prefix from fon
-00026720: 742d 6e61 6d65 0a20 2020 2020 2020 2054  t-name.        T
-00026730: 6869 7320 7072 6566 6978 2073 6572 7665  his prefix serve
-00026740: 7320 6e6f 2075 7365 6675 6c20 7075 7270  s no useful purp
-00026750: 6f73 6520 666f 7220 7465 7874 2061 6e61  ose for text ana
-00026760: 6c79 7369 7320 616e 6420 6973 2064 6973  lysis and is dis
-00026770: 6361 7264 6564 2222 220a 2020 2020 2020  carded""".      
-00026780: 2020 6966 206e 616d 653a 0a20 2020 2020    if name:.     
-00026790: 2020 2020 2020 206d 6174 6368 203d 2052         match = R
-000267a0: 455f 5052 4546 2e6d 6174 6368 286e 616d  E_PREF.match(nam
-000267b0: 6529 0a20 2020 2020 2020 2020 2020 2069  e).            i
-000267c0: 6620 6d61 7463 683a 0a20 2020 2020 2020  f match:.       
-000267d0: 2020 2020 2020 2020 206e 616d 6520 3d20           name = 
-000267e0: 6d61 7463 682e 6772 6f75 7028 226e 616d  match.group("nam
-000267f0: 6522 290a 2020 2020 2020 2020 7265 7475  e").        retu
-00026800: 726e 206e 616d 650a 0a0a 636c 6173 7320  rn name...class 
-00026810: 5365 6374 696f 6e48 6965 7261 7263 6879  SectionHierarchy
-00026820: 3a0a 2020 2020 2222 220a 2020 2020 6275  :.    """.    bu
-00026830: 696c 6473 2061 6e64 2071 7565 7269 6573  ilds and queries
-00026840: 2068 6965 7261 7263 6869 6361 6c20 7365   hierarchical se
-00026850: 6374 696f 6e73 0a20 2020 2022 2222 0a0a  ctions.    """..
-00026860: 2020 2020 4944 203d 2022 6964 220a 2020      ID = "id".  
-00026870: 2020 434c 4153 5320 3d20 2763 6c61 7373    CLASS = 'class
-00026880: 270a 2020 2020 444f 5420 3d20 222e 220a  '.    DOT = ".".
-00026890: 2020 2020 4d49 5353 494e 4720 3d20 226d      MISSING = "m
-000268a0: 6973 7369 6e67 220a 2020 2020 5345 4354  issing".    SECT
-000268b0: 203d 2022 7365 6374 220a 0a20 2020 2064   = "sect"..    d
-000268c0: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
-000268d0: 293a 0a20 2020 2020 2020 2070 6173 730a  ):.        pass.
-000268e0: 0a20 2020 2064 6566 2061 6464 5f73 6563  .    def add_sec
-000268f0: 7469 6f6e 7328 7365 6c66 2c20 6465 6369  tions(self, deci
-00026900: 6d61 6c5f 7365 6374 696f 6e73 2c20 746f  mal_sections, to
-00026910: 703d 4e6f 6e65 2c20 706f 706c 6973 743d  p=None, poplist=
-00026920: 4e6f 6e65 293a 0a20 2020 2020 2020 2069  None):.        i
-00026930: 6620 6e6f 7420 706f 706c 6973 743a 0a20  f not poplist:. 
-00026940: 2020 2020 2020 2020 2020 2070 6f70 6c69             popli
-00026950: 7374 203d 205b 5d0a 2020 2020 2020 2020  st = [].        
-00026960: 7365 6374 696f 6e73 5f62 795f 6c65 7665  sections_by_leve
-00026970: 6c20 3d20 7365 6c66 2e63 7265 6174 655f  l = self.create_
-00026980: 7365 6374 696f 6e73 5f62 795f 6c65 7665  sections_by_leve
-00026990: 6c28 6465 6369 6d61 6c5f 7365 6374 696f  l(decimal_sectio
-000269a0: 6e73 290a 2020 2020 2020 2020 7061 7265  ns).        pare
-000269b0: 6e74 5f64 6963 7420 3d20 7365 6c66 2e63  nt_dict = self.c
-000269c0: 7265 6174 655f 7061 7265 6e74 5f64 6963  reate_parent_dic
-000269d0: 7428 7365 6374 696f 6e73 5f62 795f 6c65  t(sections_by_le
-000269e0: 7665 6c29 0a20 2020 2020 2020 2066 6f72  vel).        for
-000269f0: 2070 6f70 2069 6e20 706f 706c 6973 743a   pop in poplist:
-00026a00: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
-00026a10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00026a20: 2020 7061 7265 6e74 5f64 6963 742e 706f    parent_dict.po
-00026a30: 7028 706f 7029 2020 2320 7265 6d6f 7665  p(pop)  # remove
-00026a40: 206e 6f6e 2d6e 756d 6572 6963 2069 7465   non-numeric ite
-00026a50: 6d0a 2020 2020 2020 2020 2020 2020 6578  m.            ex
-00026a60: 6365 7074 3a0a 2020 2020 2020 2020 2020  cept:.          
-00026a70: 2020 2020 2020 7072 696e 7428 2243 616e        print("Can
-00026a80: 6e6f 7420 706f 7020 7b70 6f70 7d22 290a  not pop {pop}").
-00026a90: 0a20 2020 2020 2020 2072 6f6f 7420 3d20  .        root = 
-00026aa0: 456c 656d 656e 7428 7365 6c66 2e53 4543  Element(self.SEC
-00026ab0: 5429 0a20 2020 2020 2020 2072 6f6f 742e  T).        root.
-00026ac0: 6174 7472 6962 5b73 656c 662e 4944 5d20  attrib[self.ID] 
-00026ad0: 3d20 2234 220a 2020 2020 2020 2020 666f  = "4".        fo
-00026ae0: 7220 7365 6374 5f69 6420 696e 2070 6172  r sect_id in par
-00026af0: 656e 745f 6469 6374 2e6b 6579 7328 293a  ent_dict.keys():
-00026b00: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00026b10: 662e 656e 7375 7265 5f65 6c65 6d65 6e74  f.ensure_element
-00026b20: 2872 6f6f 742c 2073 6563 745f 6964 2c20  (root, sect_id, 
-00026b30: 7061 7265 6e74 5f64 6963 7429 0a0a 2020  parent_dict)..  
-00026b40: 2020 6465 6620 6372 6561 7465 5f70 6172    def create_par
-00026b50: 656e 745f 6469 6374 2873 656c 662c 2073  ent_dict(self, s
-00026b60: 6563 7469 6f6e 735f 6279 5f6c 6576 656c  ections_by_level
-00026b70: 293a 0a20 2020 2020 2020 2070 6172 656e  ):.        paren
-00026b80: 745f 6469 6374 203d 2064 6963 7428 290a  t_dict = dict().
-00026b90: 2020 2020 2020 2020 666f 7220 6c65 7665          for leve
-00026ba0: 6c20 696e 2073 6563 7469 6f6e 735f 6279  l in sections_by
-00026bb0: 5f6c 6576 656c 2e6b 6579 7328 293a 0a20  _level.keys():. 
-00026bc0: 2020 2020 2020 2020 2020 2073 6563 745f             sect_
-00026bd0: 6964 7320 3d20 7365 6c66 2e61 6464 5f70  ids = self.add_p
-00026be0: 6172 656e 7473 286c 6576 656c 2c20 7365  arents(level, se
-00026bf0: 6374 696f 6e73 5f62 795f 6c65 7665 6c2c  ctions_by_level,
-00026c00: 2070 6172 656e 745f 6469 6374 290a 2020   parent_dict).  
-00026c10: 2020 2020 2020 7265 7475 726e 2070 6172        return par
-00026c20: 656e 745f 6469 6374 0a0a 2020 2020 6465  ent_dict..    de
-00026c30: 6620 6372 6561 7465 5f73 6563 7469 6f6e  f create_section
-00026c40: 735f 6279 5f6c 6576 656c 2873 656c 662c  s_by_level(self,
-00026c50: 2064 6563 696d 616c 5f73 6563 7469 6f6e   decimal_section
-00026c60: 7329 3a0a 2020 2020 2020 2020 7365 6374  s):.        sect
-00026c70: 696f 6e73 5f62 795f 6c65 7665 6c20 3d20  ions_by_level = 
-00026c80: 6465 6661 756c 7464 6963 7428 6c69 7374  defaultdict(list
-00026c90: 290a 2020 2020 2020 2020 666f 7220 7365  ).        for se
-00026ca0: 6374 696f 6e20 696e 2064 6563 696d 616c  ction in decimal
-00026cb0: 5f73 6563 7469 6f6e 733a 0a20 2020 2020  _sections:.     
-00026cc0: 2020 2020 2020 206c 6576 656c 203d 2073         level = s
-00026cd0: 6563 7469 6f6e 2e61 7474 7269 622e 6765  ection.attrib.ge
-00026ce0: 7428 7365 6c66 2e43 4c41 5353 292e 7370  t(self.CLASS).sp
-00026cf0: 6c69 7428 295b 315d 0a20 2020 2020 2020  lit()[1].       
-00026d00: 2020 2020 2073 6563 7469 6f6e 735f 6279       sections_by
-00026d10: 5f6c 6576 656c 5b6c 6576 656c 5d2e 6170  _level[level].ap
-00026d20: 7065 6e64 2873 6563 7469 6f6e 2e74 6578  pend(section.tex
-00026d30: 7429 0a20 2020 2020 2020 2072 6574 7572  t).        retur
-00026d40: 6e20 7365 6374 696f 6e73 5f62 795f 6c65  n sections_by_le
-00026d50: 7665 6c0a 0a20 2020 2064 6566 2061 6464  vel..    def add
-00026d60: 5f70 6172 656e 7473 2873 656c 662c 206c  _parents(self, l
-00026d70: 6576 656c 2c20 6d75 6c74 6964 6963 742c  evel, multidict,
-00026d80: 2070 6172 656e 745f 6469 6374 293a 0a20   parent_dict):. 
-00026d90: 2020 2020 2020 206c 6576 656c 5f73 6563         level_sec
-00026da0: 7473 203d 206d 756c 7469 6469 6374 5b6c  ts = multidict[l
-00026db0: 6576 656c 5d0a 2020 2020 2020 2020 666f  evel].        fo
-00026dc0: 7220 6c65 7665 6c5f 7365 6374 2069 6e20  r level_sect in 
-00026dd0: 6c65 7665 6c5f 7365 6374 733a 0a20 2020  level_sects:.   
-00026de0: 2020 2020 2020 2020 2070 6172 656e 7420           parent 
-00026df0: 3d20 7365 6c66 2e67 6574 5f70 6172 656e  = self.get_paren
-00026e00: 7428 6c65 7665 6c5f 7365 6374 290a 2020  t(level_sect).  
-00026e10: 2020 2020 2020 2020 2020 7061 7265 6e74            parent
-00026e20: 5f64 6963 745b 6c65 7665 6c5f 7365 6374  _dict[level_sect
-00026e30: 5d20 3d20 7061 7265 6e74 0a0a 2020 2020  ] = parent..    
-00026e40: 6465 6620 6765 745f 7061 7265 6e74 2873  def get_parent(s
-00026e50: 656c 662c 206c 6576 656c 5f73 6563 7429  elf, level_sect)
-00026e60: 3a0a 2020 2020 2020 2020 6269 7473 203d  :.        bits =
-00026e70: 206c 6576 656c 5f73 6563 742e 7370 6c69   level_sect.spli
-00026e80: 7428 222e 2229 0a20 2020 2020 2020 2070  t(".").        p
-00026e90: 6172 656e 7420 3d20 4e6f 6e65 2069 6620  arent = None if 
-00026ea0: 6c65 6e28 6269 7473 2920 3d3d 2031 2065  len(bits) == 1 e
-00026eb0: 6c73 6520 7365 6c66 2e44 4f54 2e6a 6f69  lse self.DOT.joi
-00026ec0: 6e28 6269 7473 5b3a 2d31 5d29 0a20 2020  n(bits[:-1]).   
-00026ed0: 2020 2020 2072 6574 7572 6e20 7061 7265       return pare
-00026ee0: 6e74 0a0a 2020 2020 6465 6620 656e 7375  nt..    def ensu
-00026ef0: 7265 5f65 6c65 6d65 6e74 2873 656c 662c  re_element(self,
-00026f00: 2072 6f6f 742c 2073 6563 745f 6964 2c20   root, sect_id, 
-00026f10: 7061 7265 6e74 5f64 6963 7429 3a0a 2020  parent_dict):.  
-00026f20: 2020 2020 2020 6966 2073 6563 745f 6964        if sect_id
-00026f30: 203d 3d20 2222 3a0a 2020 2020 2020 2020   == "":.        
-00026f40: 2020 2020 7072 696e 7428 6622 5241 4e20      print(f"RAN 
-00026f50: 4f46 4620 544f 5022 290a 2020 2020 2020  OFF TOP").      
-00026f60: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-00026f70: 650a 2020 2020 2020 2020 7870 6174 6820  e.        xpath 
-00026f80: 3d20 6622 2f2f 7b73 656c 662e 5345 4354  = f"//{self.SECT
-00026f90: 7d5b 4069 643d 277b 7365 6374 5f69 647d  }[@id='{sect_id}
-00026fa0: 275d 220a 2020 2020 2020 2020 656c 656d  ']".        elem
-00026fb0: 7320 3d20 726f 6f74 2e78 7061 7468 2878  s = root.xpath(x
-00026fc0: 7061 7468 290a 2020 2020 2020 2020 6966  path).        if
-00026fd0: 206c 656e 2865 6c65 6d73 2920 3d3d 2030   len(elems) == 0
-00026fe0: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
-00026ff0: 7265 6e74 5f69 6420 3d20 7061 7265 6e74  rent_id = parent
-00027000: 5f64 6963 742e 6765 7428 7365 6374 5f69  _dict.get(sect_i
-00027010: 6429 0a20 2020 2020 2020 2020 2020 206d  d).            m
-00027020: 6973 7369 6e67 203d 2046 616c 7365 0a20  issing = False. 
-00027030: 2020 2020 2020 2020 2020 2069 6620 7061             if pa
-00027040: 7265 6e74 5f69 6420 6973 204e 6f6e 653a  rent_id is None:
-00027050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027060: 2070 7269 6e74 2866 2220 6d69 7373 696e   print(f" missin
-00027070: 6720 7061 7265 6e74 2073 6563 7469 6f6e  g parent section
-00027080: 207b 7365 6374 5f69 647d 2229 0a20 2020   {sect_id}").   
-00027090: 2020 2020 2020 2020 2020 2020 206d 6973               mis
-000270a0: 7369 6e67 203d 2054 7275 650a 2020 2020  sing = True.    
-000270b0: 2020 2020 2020 2020 2020 2020 7370 6c20              spl 
-000270c0: 3d20 7365 6374 5f69 642e 7370 6c69 7428  = sect_id.split(
-000270d0: 7365 6c66 2e44 4f54 290a 2020 2020 2020  self.DOT).      
-000270e0: 2020 2020 2020 2020 2020 7370 6c69 745f            split_
-000270f0: 203d 2073 706c 5b3a 2d31 5d0a 2020 2020   = spl[:-1].    
-00027100: 2020 2020 2020 2020 2020 2020 7061 7265              pare
-00027110: 6e74 5f69 6420 3d20 7365 6c66 2e44 4f54  nt_id = self.DOT
-00027120: 2e6a 6f69 6e28 7370 6c69 745f 290a 2020  .join(split_).  
-00027130: 2020 2020 2020 2020 2020 6966 2070 6172            if par
-00027140: 656e 745f 6964 203d 3d20 2222 3a0a 2020  ent_id == "":.  
-00027150: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00027160: 696e 7428 6622 2073 6b69 7020 726f 6f74  int(f" skip root
-00027170: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
-00027180: 2020 656c 656d 203d 2073 656c 662e 656e    elem = self.en
-00027190: 7375 7265 5f65 6c65 6d65 6e74 2872 6f6f  sure_element(roo
-000271a0: 742c 2070 6172 656e 745f 6964 2c20 7061  t, parent_id, pa
-000271b0: 7265 6e74 5f64 6963 7429 0a20 2020 2020  rent_dict).     
-000271c0: 2020 2020 2020 2069 6620 656c 656d 2069         if elem i
-000271d0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-000271e0: 2020 2020 2020 2020 2020 2020 7365 6374              sect
-000271f0: 5f78 6d6c 203d 2045 542e 5375 6245 6c65  _xml = ET.SubEle
-00027200: 6d65 6e74 2865 6c65 6d2c 2073 656c 662e  ment(elem, self.
-00027210: 5345 4354 290a 2020 2020 2020 2020 2020  SECT).          
-00027220: 2020 2020 2020 7365 6374 5f78 6d6c 2e61        sect_xml.a
-00027230: 7474 7269 625b 7365 6c66 2e49 445d 203d  ttrib[self.ID] =
-00027240: 2073 6563 745f 6964 0a20 2020 2020 2020   sect_id.       
-00027250: 2020 2020 2020 2020 2069 6620 6d69 7373           if miss
-00027260: 696e 673a 0a20 2020 2020 2020 2020 2020  ing:.           
-00027270: 2020 2020 2020 2020 2073 6563 745f 786d           sect_xm
-00027280: 6c2e 6174 7472 6962 5b73 656c 662e 4d49  l.attrib[self.MI
-00027290: 5353 494e 475d 203d 2022 5922 0a20 2020  SSING] = "Y".   
-000272a0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-000272b0: 7572 6e20 7365 6374 5f78 6d6c 0a20 2020  urn sect_xml.   
-000272c0: 2020 2020 2065 6c69 6620 6c65 6e28 656c       elif len(el
-000272d0: 656d 7329 203e 2031 3a0a 2020 2020 2020  ems) > 1:.      
-000272e0: 2020 2020 2020 7072 696e 7428 6622 2064        print(f" d
-000272f0: 7570 6c69 6361 7465 2069 6473 3a20 7b73  uplicate ids: {s
-00027300: 6563 745f 6964 7d22 290a 2020 2020 2020  ect_id}").      
-00027310: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-00027320: 650a 2020 2020 2020 2020 656c 7365 3a0a  e.        else:.
-00027330: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00027340: 726e 2065 6c65 6d73 5b30 5d0a 0a20 2020  rn elems[0]..   
-00027350: 2064 6566 2073 6f72 745f 7365 6374 696f   def sort_sectio
-00027360: 6e73 2873 656c 6629 3a0a 2020 2020 2020  ns(self):.      
-00027370: 2020 7072 696e 7428 2273 6f72 7420 7365    print("sort se
-00027380: 6374 696f 6e73 204e 5949 2229 0a20 2020  ctions NYI").   
-00027390: 2020 2020 2070 6173 730a 0a20 2020 2040       pass..    @
-000273a0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-000273b0: 6465 6620 736f 7274 5f69 6473 2863 6c73  def sort_ids(cls
-000273c0: 293a 0a20 2020 2020 2020 2070 6173 730a  ):.        pass.
-000273d0: 0a0a 636c 6173 7320 466f 6f74 6e6f 7465  ..class Footnote
-000273e0: 3a0a 2020 2020 2222 2265 7874 7261 6374  :.    """extract
-000273f0: 7320 666f 6f74 6e6f 7465 7320 6279 2073  s footnotes by s
-00027400: 697a 6520 616e 6420 7374 796c 6520 616e  ize and style an
-00027410: 6420 7065 7268 6170 7320 706f 7369 7469  d perhaps positi
-00027420: 6f6d 0a20 2020 2022 2222 0a0a 2020 2020  om.    """..    
-00027430: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-00027440: 2064 6566 2065 7874 7261 6374 5f66 6f6f   def extract_foo
-00027450: 746e 6f74 6573 2863 6c73 2c20 666e 5f78  tnotes(cls, fn_x
-00027460: 7061 7468 2c20 666f 6f74 6e6f 7465 5f74  path, footnote_t
-00027470: 6578 745f 636c 6173 7365 732c 2068 746d  ext_classes, htm
-00027480: 6c5f 656c 656d 293a 0a20 2020 2020 2020  l_elem):.       
-00027490: 206e 6577 5f68 746d 6c5f 656c 656d 203d   new_html_elem =
-000274a0: 2048 746d 6c4c 6962 2e63 7265 6174 655f   HtmlLib.create_
-000274b0: 6e65 775f 6874 6d6c 5f77 6974 685f 6f6c  new_html_with_ol
-000274c0: 645f 7374 796c 6573 2868 746d 6c5f 656c  d_styles(html_el
-000274d0: 656d 290a 2020 2020 2020 2020 666f 6f74  em).        foot
-000274e0: 6e6f 7465 5f6e 756d 6265 725f 666f 6e74  note_number_font
-000274f0: 5f65 6c65 6d73 203d 2068 746d 6c5f 656c  _elems = html_el
-00027500: 656d 2e78 7061 7468 2866 6e5f 7870 6174  em.xpath(fn_xpat
-00027510: 6829 0a20 2020 2020 2020 206c 6173 745f  h).        last_
-00027520: 666f 6f74 6e75 6d20 3d20 300a 2020 2020  footnum = 0.    
-00027530: 2020 2020 756c 203d 2045 542e 456c 656d      ul = ET.Elem
-00027540: 656e 7428 2275 6c22 290a 2020 2020 2020  ent("ul").      
-00027550: 2020 4874 6d6c 4c69 622e 6765 745f 626f    HtmlLib.get_bo
-00027560: 6479 286e 6577 5f68 746d 6c5f 656c 656d  dy(new_html_elem
-00027570: 292e 6170 7065 6e64 2875 6c29 0a20 2020  ).append(ul).   
-00027580: 2020 2020 2023 206d 6573 7379 2c20 6e65       # messy, ne
-00027590: 6564 2061 2046 6f6f 746e 6f74 6520 6f62  ed a Footnote ob
-000275a0: 6a65 6374 2068 6572 650a 2020 2020 2020  ject here.      
-000275b0: 2020 666f 7220 666f 6f74 6e6f 7465 5f6e    for footnote_n
-000275c0: 756d 6265 725f 656c 656d 2069 6e20 666f  umber_elem in fo
-000275d0: 6f74 6e6f 7465 5f6e 756d 6265 725f 666f  otnote_number_fo
-000275e0: 6e74 5f65 6c65 6d73 3a0a 2020 2020 2020  nt_elems:.      
-000275f0: 2020 2020 2020 6c61 7374 5f66 6f6f 746e        last_footn
-00027600: 756d 2c20 6c69 203d 2046 6f6f 746e 6f74  um, li = Footnot
-00027610: 652e 6578 7472 6163 745f 666f 6f74 6e6f  e.extract_footno
-00027620: 7465 5f61 6e64 5f73 6176 6528 0a20 2020  te_and_save(.   
-00027630: 2020 2020 2020 2020 2020 2020 2066 6f6f               foo
-00027640: 746e 6f74 655f 6e75 6d62 6572 5f65 6c65  tnote_number_ele
-00027650: 6d2c 2066 6f6f 746e 6f74 655f 7465 7874  m, footnote_text
-00027660: 5f63 6c61 7373 6573 2c20 6c61 7374 5f66  _classes, last_f
-00027670: 6f6f 746e 756d 290a 2020 2020 2020 2020  ootnum).        
-00027680: 2020 2020 6966 206c 6920 6973 206e 6f74      if li is not
-00027690: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-000276a0: 2020 2020 2020 2075 6c2e 6170 7065 6e64         ul.append
-000276b0: 286c 6929 0a20 2020 2020 2020 2072 6574  (li).        ret
-000276c0: 7572 6e20 6e65 775f 6874 6d6c 5f65 6c65  urn new_html_ele
-000276d0: 6d0a 0a20 2020 2040 636c 6173 736d 6574  m..    @classmet
-000276e0: 686f 640a 2020 2020 6465 6620 6973 5f66  hod.    def is_f
-000276f0: 6f6f 746e 6f74 655f 666f 6e74 2863 6c73  ootnote_font(cls
-00027700: 2c20 666f 6f74 6e6f 7465 5f6e 756d 6265  , footnote_numbe
-00027710: 725f 656c 656d 293a 0a20 2020 2020 2020  r_elem):.       
-00027720: 2022 2222 0a20 2020 2020 2020 2066 6f6e   """.        fon
-00027730: 7420 7369 7a65 2061 6c6f 6e65 2064 6f65  t size alone doe
-00027740: 7320 6e6f 7420 6469 7374 696e 6775 6973  s not distinguis
-00027750: 682c 2073 6f20 7573 6520 6e65 6967 6862  h, so use neighb
-00027760: 6f75 7269 6e67 2074 6578 740a 2020 2020  ouring text.    
-00027770: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00027780: 6e65 7874 203d 2058 6d6c 4c69 622e 6765  next = XmlLib.ge
-00027790: 745f 6e65 7874 5f65 6c65 6d65 6e74 2866  t_next_element(f
-000277a0: 6f6f 746e 6f74 655f 6e75 6d62 6572 5f65  ootnote_number_e
-000277b0: 6c65 6d29 0a20 2020 2020 2020 2074 6578  lem).        tex
-000277c0: 7420 3d20 666f 6f74 6e6f 7465 5f6e 756d  t = footnote_num
-000277d0: 6265 725f 656c 656d 2e74 6578 740a 2020  ber_elem.text.  
-000277e0: 2020 2020 2020 6966 206e 6578 7420 6973        if next is
-000277f0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00027800: 2020 2070 7269 6e74 2866 224e 4f20 666f     print(f"NO fo
-00027810: 6c6c 6f77 696e 6720 656c 656d 2229 0a20  llowing elem"). 
-00027820: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00027830: 6e20 4661 6c73 650a 2020 2020 2020 2020  n False.        
-00027840: 2320 666f 6c6c 6f65 6420 6279 2073 6d61  # folloed by sma
-00027850: 6c6c 2066 6f6e 743f 0a20 2020 2020 2020  ll font?.       
-00027860: 206e 6578 745f 636c 6173 7320 3d20 6e65   next_class = ne
-00027870: 7874 2e61 7474 7269 625b 2263 6c61 7373  xt.attrib["class
-00027880: 225d 0a20 2020 2020 2020 2069 6620 6e65  "].        if ne
-00027890: 7874 5f63 6c61 7373 203d 3d20 2273 3130  xt_class == "s10
-000278a0: 3435 223a 0a20 2020 2020 2020 2020 2020  45":.           
-000278b0: 2072 6574 7572 6e20 5472 7565 0a20 2020   return True.   
-000278c0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-000278d0: 650a 0a20 2020 2023 2046 6f6f 746e 6f74  e..    # Footnot
-000278e0: 650a 0a20 2020 2040 636c 6173 736d 6574  e..    @classmet
-000278f0: 686f 640a 2020 2020 6465 6620 6578 7472  hod.    def extr
-00027900: 6163 745f 666f 6f74 6e6f 7465 5f61 6e64  act_footnote_and
-00027910: 5f73 6176 6528 636c 732c 2066 6f6f 746e  _save(cls, footn
-00027920: 6f74 655f 6e75 6d62 6572 5f65 6c65 6d2c  ote_number_elem,
-00027930: 2066 6f6f 746e 6f74 655f 7465 7874 5f63   footnote_text_c
-00027940: 6c61 7373 6573 2c20 6c61 7374 5f66 6f6f  lasses, last_foo
-00027950: 746e 756d 293a 0a20 2020 2020 2020 2074  tnum):.        t
-00027960: 6578 7420 3d20 666f 6f74 6e6f 7465 5f6e  ext = footnote_n
-00027970: 756d 6265 725f 656c 656d 2e74 6578 740a  umber_elem.text.
-00027980: 2020 2020 2020 2020 666f 6f74 6e6f 7465          footnote
-00027990: 5f6e 756d 6265 7220 3d20 2d31 0a20 2020  _number = -1.   
-000279a0: 2020 2020 2069 676e 6f72 6520 3d20 4661       ignore = Fa
-000279b0: 6c73 650a 2020 2020 2020 2020 6966 206e  lse.        if n
-000279c0: 6f74 2063 6c73 2e69 735f 666f 6f74 6e6f  ot cls.is_footno
-000279d0: 7465 5f66 6f6e 7428 666f 6f74 6e6f 7465  te_font(footnote
-000279e0: 5f6e 756d 6265 725f 656c 656d 293a 0a20  _number_elem):. 
-000279f0: 2020 2020 2020 2020 2020 2069 676e 6f72             ignor
-00027a00: 6520 3d20 5472 7565 0a20 2020 2020 2020  e = True.       
-00027a10: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00027a20: 2020 666f 6f74 6e6f 7465 5f6e 756d 6265    footnote_numbe
-00027a30: 7220 3d20 696e 7428 7465 7874 290a 2020  r = int(text).  
-00027a40: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-00027a50: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
-00027a60: 2020 2020 6967 6e6f 7265 203d 2054 7275      ignore = Tru
-00027a70: 650a 2020 2020 2020 2020 6c69 203d 204e  e.        li = N
-00027a80: 6f6e 650a 2020 2020 2020 2020 6966 206e  one.        if n
-00027a90: 6f74 2069 676e 6f72 6520 616e 6420 3520  ot ignore and 5 
-00027aa0: 3e20 2866 6f6f 746e 6f74 655f 6e75 6d62  > (footnote_numb
-00027ab0: 6572 202d 206c 6173 745f 666f 6f74 6e75  er - last_footnu
-00027ac0: 6d29 203e 3d20 303a 0a20 2020 2020 2020  m) >= 0:.       
-00027ad0: 2020 2020 206c 6173 745f 666f 6f74 6e75       last_footnu
-00027ae0: 6d2c 206c 6920 3d20 636c 732e 6465 6c65  m, li = cls.dele
-00027af0: 7465 5f66 6f6f 746e 6f74 655f 6e75 6d62  te_footnote_numb
-00027b00: 6572 5f61 6e64 5f66 6f6c 6c6f 7769 6e67  er_and_following
-00027b10: 5f74 6578 745f 5f61 6e64 5f61 6464 5f74  _text__and_add_t
-00027b20: 6f5f 6c69 7374 280a 2020 2020 2020 2020  o_list(.        
-00027b30: 2020 2020 2020 2020 666f 6f74 6e6f 7465          footnote
-00027b40: 5f74 6578 745f 636c 6173 7365 732c 2066  _text_classes, f
-00027b50: 6f6f 746e 6f74 655f 6e75 6d62 6572 2c0a  ootnote_number,.
-00027b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027b70: 666f 6f74 6e6f 7465 5f6e 756d 6265 725f  footnote_number_
-00027b80: 656c 656d 290a 2020 2020 2020 2020 7265  elem).        re
-00027b90: 7475 726e 206c 6173 745f 666f 6f74 6e75  turn last_footnu
-00027ba0: 6d2c 206c 690a 0a20 2020 2023 2046 6f6f  m, li..    # Foo
-00027bb0: 746e 6f74 650a 0a20 2020 2040 636c 6173  tnote..    @clas
-00027bc0: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
-00027bd0: 6372 6561 7465 5f66 6f6f 746e 6f74 655f  create_footnote_
-00027be0: 6e75 6d62 6572 5f78 7061 7468 2863 6c73  number_xpath(cls
-00027bf0: 2c20 666f 6f74 6e6f 7465 5f6e 756d 6265  , footnote_numbe
-00027c00: 725f 636c 6173 7365 7329 3a0a 2020 2020  r_classes):.    
-00027c10: 2020 2020 7870 6174 6830 203d 2022 220a      xpath0 = "".
-00027c20: 2020 2020 2020 2020 666f 7220 692c 2066          for i, f
-00027c30: 6e63 2069 6e20 656e 756d 6572 6174 6528  nc in enumerate(
-00027c40: 666f 6f74 6e6f 7465 5f6e 756d 6265 725f  footnote_number_
-00027c50: 636c 6173 7365 7329 3a0a 2020 2020 2020  classes):.      
-00027c60: 2020 2020 2020 7870 6174 6830 202b 3d20        xpath0 += 
-00027c70: 2222 2069 6620 6920 3d3d 2030 2065 6c73  "" if i == 0 els
-00027c80: 6520 2220 6f72 2022 0a20 2020 2020 2020  e " or ".       
-00027c90: 2020 2020 2078 7061 7468 3020 2b3d 2066       xpath0 += f
-00027ca0: 2227 7b66 6e63 7d27 220a 2020 2020 2020  "'{fnc}'".      
-00027cb0: 2020 666e 5f78 7061 7468 203d 2066 222e    fn_xpath = f".
-00027cc0: 2f2f 7370 616e 5b7b 7870 6174 6830 7d5d  //span[{xpath0}]
-00027cd0: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-00027ce0: 2066 6e5f 7870 6174 680a 0a20 2020 2023   fn_xpath..    #
-00027cf0: 2046 6f6f 746e 6f74 650a 0a20 2020 2040   Footnote..    @
-00027d00: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-00027d10: 6465 6620 6465 6c65 7465 5f66 6f6f 746e  def delete_footn
-00027d20: 6f74 655f 6e75 6d62 6572 5f61 6e64 5f66  ote_number_and_f
-00027d30: 6f6c 6c6f 7769 6e67 5f74 6578 745f 5f61  ollowing_text__a
-00027d40: 6e64 5f61 6464 5f74 6f5f 6c69 7374 280a  nd_add_to_list(.
-00027d50: 2020 2020 2020 2020 2020 2020 636c 732c              cls,
-00027d60: 2063 6c61 7373 6573 2c20 666f 6f74 6e6f   classes, footno
-00027d70: 7465 5f6e 756d 6265 722c 2066 6f6f 746e  te_number, footn
-00027d80: 6f74 655f 6e75 6d62 6572 5f65 6c65 6d29  ote_number_elem)
-00027d90: 3a0a 2020 2020 2020 2020 6c69 203d 2045  :.        li = E
-00027da0: 542e 456c 656d 656e 7428 226c 6922 290a  T.Element("li").
-00027db0: 2020 2020 2020 2020 6c69 2e61 7070 656e          li.appen
-00027dc0: 6428 636f 7079 2e64 6565 7063 6f70 7928  d(copy.deepcopy(
-00027dd0: 666f 6f74 6e6f 7465 5f6e 756d 6265 725f  footnote_number_
-00027de0: 656c 656d 2929 0a20 2020 2020 2020 2066  elem)).        f
-00027df0: 6f6f 746e 6f74 655f 666f 6c6c 6f77 6572  ootnote_follower
-00027e00: 7320 3d20 586d 6c4c 6962 2e67 6574 5f66  s = XmlLib.get_f
-00027e10: 6f6c 6c6f 7769 6e67 5f65 6c65 6d65 6e74  ollowing_element
-00027e20: 7328 666f 6f74 6e6f 7465 5f6e 756d 6265  s(footnote_numbe
-00027e30: 725f 656c 656d 290a 2020 2020 2020 2020  r_elem).        
-00027e40: 2320 6164 6420 6f6e 6520 7370 616e 2865  # add one span(e
-00027e50: 6e64 7320 6166 7465 7220 666f 6e74 2063  nds after font c
-00027e60: 6861 6d67 6529 0a20 2020 2020 2020 2063  hamge).        c
-00027e70: 6c73 2e69 7465 7261 7465 5f75 6e74 696c  ls.iterate_until
-00027e80: 5f75 6e61 6363 6570 7461 626c 655f 666f  _unacceptable_fo
-00027e90: 6e74 5f63 6c61 7373 2866 6f6f 746e 6f74  nt_class(footnot
-00027ea0: 655f 666f 6c6c 6f77 6572 732c 206c 693d  e_followers, li=
-00027eb0: 6c69 2c20 666e 5f63 6c61 7373 6573 3d63  li, fn_classes=c
-00027ec0: 6c61 7373 6573 290a 2020 2020 2020 2020  lasses).        
-00027ed0: 6c61 7374 5f66 6f6f 746e 756d 203d 2066  last_footnum = f
-00027ee0: 6f6f 746e 6f74 655f 6e75 6d62 6572 0a20  ootnote_number. 
-00027ef0: 2020 2020 2020 2058 6d6c 4c69 622e 7265         XmlLib.re
-00027f00: 6d6f 7665 5f65 6c65 6d65 6e74 2866 6f6f  move_element(foo
-00027f10: 746e 6f74 655f 6e75 6d62 6572 5f65 6c65  tnote_number_ele
-00027f20: 6d29 0a20 2020 2020 2020 2072 6574 7572  m).        retur
-00027f30: 6e20 6c61 7374 5f66 6f6f 746e 756d 2c20  n last_footnum, 
-00027f40: 6c69 0a0a 2020 2020 2320 466f 6f74 6e6f  li..    # Footno
-00027f50: 7465 0a0a 2020 2020 4063 6c61 7373 6d65  te..    @classme
-00027f60: 7468 6f64 0a20 2020 2064 6566 2069 7465  thod.    def ite
-00027f70: 7261 7465 5f75 6e74 696c 5f75 6e61 6363  rate_until_unacc
-00027f80: 6570 7461 626c 655f 666f 6e74 5f63 6c61  eptable_font_cla
-00027f90: 7373 2863 6c73 2c20 666f 6c6c 6f77 6572  ss(cls, follower
-00027fa0: 732c 206c 693d 4e6f 6e65 2c20 666e 5f63  s, li=None, fn_c
-00027fb0: 6c61 7373 6573 3d4e 6f6e 652c 2064 6562  lasses=None, deb
-00027fc0: 7567 3d46 616c 7365 293a 0a20 2020 2020  ug=False):.     
-00027fd0: 2020 2022 2222 6974 6572 6174 6573 206f     """iterates o
-00027fe0: 7665 7220 656c 656d 7473 2066 6f6c 6c6f  ver elemts follo
-00027ff0: 7769 6e67 2061 2066 6f6f 746e 6f74 6520  wing a footnote 
-00028000: 6e75 6d62 6572 2075 6e74 696c 2061 6e20  number until an 
-00028010: 696e 636f 6d70 6174 6962 6c65 0a20 2020  incompatible.   
-00028020: 2020 2020 2063 6c61 7373 2073 7479 6c65       class style
-00028030: 2069 7320 666f 756e 642c 2077 6865 6e20   is found, when 
-00028040: 6272 6561 6b22 2222 0a20 2020 2020 2020  break""".       
-00028050: 2066 6f72 2066 6f6c 6c6f 7765 7220 696e   for follower in
-00028060: 2066 6f6c 6c6f 7765 7273 3a0a 2020 2020   followers:.    
-00028070: 2020 2020 2020 2020 636c 617a 7a20 3d20          clazz = 
-00028080: 666f 6c6c 6f77 6572 2e61 7474 7269 625b  follower.attrib[
-00028090: 2263 6c61 7373 225d 0a20 2020 2020 2020  "class"].       
-000280a0: 2020 2020 2069 6620 636c 617a 7a20 696e       if clazz in
-000280b0: 2066 6e5f 636c 6173 7365 733a 0a20 2020   fn_classes:.   
-000280c0: 2020 2020 2020 2020 2020 2020 206c 692e               li.
-000280d0: 6170 7065 6e64 2863 6f70 792e 6465 6570  append(copy.deep
-000280e0: 636f 7079 2866 6f6c 6c6f 7765 7229 290a  copy(follower)).
-000280f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028100: 586d 6c4c 6962 2e72 656d 6f76 655f 656c  XmlLib.remove_el
-00028110: 656d 656e 7428 666f 6c6c 6f77 6572 290a  ement(follower).
-00028120: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00028130: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00028140: 2020 6966 2064 6562 7567 3a0a 2020 2020    if debug:.    
-00028150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028160: 7072 696e 7428 6622 6272 6f6b 6520 6f75  print(f"broke ou
-00028170: 7420 6f66 2066 6f6f 746e 6f74 6520 6174  t of footnote at
-00028180: 207b 636c 617a 7a7d 2229 0a20 2020 2020   {clazz}").     
-00028190: 2020 2020 2020 2020 2020 2062 7265 616b             break
-000281a0: 0a                                       .
+0001c6a0: 6e6f 6465 7320 3d20 7265 2e73 706c 6974  nodes = re.split
+0001c6b0: 2873 706c 6974 7465 725f 7265 2c20 6e6f  (splitter_re, no
+0001c6c0: 6465 7374 7229 0a20 2020 2020 2020 2020  destr).         
+0001c6d0: 2020 2020 2020 206e 6f64 655f 6469 6374         node_dict
+0001c6e0: 203d 2064 6566 6175 6c74 6469 6374 286c   = defaultdict(l
+0001c6f0: 6973 7429 0a20 2020 2020 2020 2020 2020  ist).           
+0001c700: 2020 2020 2066 6f72 206e 6f64 6520 696e       for node in
+0001c710: 206e 6f64 6573 3a0a 2020 2020 2020 2020   nodes:.        
+0001c720: 2020 2020 2020 2020 2020 2020 6d20 3d20              m = 
+0001c730: 7265 2e73 6561 7263 6828 6e6f 6465 5f72  re.search(node_r
+0001c740: 652c 206e 6f64 6529 0a20 2020 2020 2020  e, node).       
+0001c750: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001c760: 6d3a 0a20 2020 2020 2020 2020 2020 2020  m:.             
+0001c770: 2020 2020 2020 2020 2020 206e 6f64 655f             node_
+0001c780: 6469 6374 5b6e 6f64 655f 7265 5d2e 6170  dict[node_re].ap
+0001c790: 7065 6e64 286e 6f64 6529 0a20 2020 2020  pend(node).     
+0001c7a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001c7b0: 6620 6e6f 7420 6d20 616e 6420 6164 645f  f not m and add_
+0001c7c0: 756e 6d61 7463 6865 643a 0a20 2020 2020  unmatched:.     
+0001c7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c7e0: 2020 206e 6f64 655f 6469 6374 5b73 656c     node_dict[sel
+0001c7f0: 662e 554e 4d41 5443 4845 445d 2e61 7070  f.UNMATCHED].app
+0001c800: 656e 6428 6e6f 6465 290a 2020 2020 2020  end(node).      
+0001c810: 2020 2020 2020 2020 2020 666f 7220 6974            for it
+0001c820: 656d 2069 6e20 6e6f 6465 5f64 6963 742e  em in node_dict.
+0001c830: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
+0001c840: 2020 2020 2020 2020 2020 2020 2023 2070               # p
+0001c850: 7269 6e74 2866 2269 7465 6d20 7b69 7465  rint(f"item {ite
+0001c860: 6d7d 2229 0a20 2020 2020 2020 2020 2020  m}").           
+0001c870: 2020 2020 2020 2020 2070 6173 730a 0a20           pass.. 
+0001c880: 2020 2064 6566 2061 6464 5f78 7061 7468     def add_xpath
+0001c890: 2873 656c 662c 2074 6974 6c65 2c20 7870  (self, title, xp
+0001c8a0: 6174 6829 3a0a 2020 2020 2020 2020 2222  ath):.        ""
+0001c8b0: 220a 2020 2020 2020 2020 7365 7420 7870  ".        set xp
+0001c8c0: 6174 6820 666f 7220 6578 7472 6163 7469  ath for extracti
+0001c8d0: 6e67 2048 544d 4c20 6e6f 6465 732e 0a20  ng HTML nodes.. 
+0001c8e0: 2020 2020 2020 203a 7061 7261 6d20 7469         :param ti
+0001c8f0: 746c 653a 2074 6974 6c65 206f 6620 7870  tle: title of xp
+0001c900: 6174 680a 2020 2020 2020 2020 3a70 6172  ath.        :par
+0001c910: 616d 2078 7061 7468 3a20 6163 7473 206f  am xpath: acts o
+0001c920: 6e20 6375 7272 656e 7420 6e6f 6465 7365  n current nodese
+0001c930: 740a 2020 2020 2020 2020 2222 220a 2020  t.        """.  
+0001c940: 2020 2020 2020 586d 6c4c 6962 2e76 616c        XmlLib.val
+0001c950: 6964 6174 655f 7870 6174 6828 7870 6174  idate_xpath(xpat
+0001c960: 6829 0a20 2020 2020 2020 2073 656c 662e  h).        self.
+0001c970: 6164 645f 6974 656d 5f74 6f5f 6172 7261  add_item_to_arra
+0001c980: 795f 6469 6374 2873 656c 662e 7870 6174  y_dict(self.xpat
+0001c990: 685f 6469 6374 2c20 7469 746c 652c 2078  h_dict, title, x
+0001c9a0: 7061 7468 290a 0a20 2020 2064 6566 2076  path)..    def v
+0001c9b0: 616c 6964 6174 655f 7870 6174 6828 7365  alidate_xpath(se
+0001c9c0: 6c66 2c20 7870 6174 6829 3a0a 2020 2020  lf, xpath):.    
+0001c9d0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0001c9e0: 6372 7564 6520 7379 6e74 6178 2076 616c  crude syntax val
+0001c9f0: 6964 6174 696f 6e20 6f66 2078 7061 7468  idation of xpath
+0001ca00: 2073 7472 696e 672e 0a20 2020 2020 2020   string..       
+0001ca10: 2074 6573 7473 2078 7061 7468 206f 6e20   tests xpath on 
+0001ca20: 6120 7472 6976 6961 6c20 656c 656d 656e  a trivial elemen
+0001ca30: 740a 2020 2020 2020 2020 3a70 6172 616d  t.        :param
+0001ca40: 2078 7061 7468 3a0a 2020 2020 2020 2020   xpath:.        
+0001ca50: 2222 220a 2020 2020 2020 2020 7472 6565  """.        tree
+0001ca60: 203d 2045 542e 6672 6f6d 7374 7269 6e67   = ET.fromstring
+0001ca70: 2822 3c66 6f6f 2f3e 2229 0a20 2020 2020  ("<foo/>").     
+0001ca80: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0001ca90: 2020 2020 7472 6565 2e78 7061 7468 2878      tree.xpath(x
+0001caa0: 7061 7468 290a 2020 2020 2020 2020 6578  path).        ex
+0001cab0: 6365 7074 2045 542e 5850 6174 6845 7661  cept ET.XPathEva
+0001cac0: 6c45 7272 6f72 2061 7320 653a 0a20 2020  lError as e:.   
+0001cad0: 2020 2020 2020 2020 206c 6f67 6769 6e67           logging
+0001cae0: 2e65 7272 6f72 2866 2262 6164 2058 5061  .error(f"bad XPa
+0001caf0: 7468 207b 7870 6174 687d 2c20 7b65 7d22  th {xpath}, {e}"
+0001cb00: 290a 2020 2020 2020 2020 2020 2020 7261  ).            ra
+0001cb10: 6973 6520 650a 0a20 2020 2064 6566 2061  ise e..    def a
+0001cb20: 6464 5f63 6875 6e6b 5f72 6528 7365 6c66  dd_chunk_re(self
+0001cb30: 2c20 6368 756e 6b5f 7265 293a 0a20 2020  , chunk_re):.   
+0001cb40: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001cb50: 2061 6464 2063 6875 6e6b 2072 6567 6578   add chunk regex
+0001cb60: 2066 6f72 2065 7874 7261 6374 696e 6720   for extracting 
+0001cb70: 6368 756e 6b73 2e0a 2020 2020 2020 2020  chunks..        
+0001cb80: 3a70 6172 616d 2063 6875 6e6b 5f72 653a  :param chunk_re:
+0001cb90: 2061 6374 7320 6f6e 2063 7572 7265 6e74   acts on current
+0001cba0: 206e 6f64 6573 6574 0a20 2020 2020 2020   nodeset.       
+0001cbb0: 2022 2222 0a20 2020 2020 2020 2073 656c   """.        sel
+0001cbc0: 662e 6164 645f 6974 656d 5f74 6f5f 6172  f.add_item_to_ar
+0001cbd0: 7261 795f 6469 6374 2873 656c 662e 6368  ray_dict(self.ch
+0001cbe0: 756e 6b5f 6469 6374 2c20 7365 6c66 2e43  unk_dict, self.C
+0001cbf0: 4855 4e4b 5f52 452c 2063 6875 6e6b 5f72  HUNK_RE, chunk_r
+0001cc00: 6529 0a20 2020 2020 2020 2073 656c 662e  e).        self.
+0001cc10: 7661 6c69 6461 7465 5f72 6528 6368 756e  validate_re(chun
+0001cc20: 6b5f 7265 290a 0a20 2020 2064 6566 2061  k_re)..    def a
+0001cc30: 6464 5f73 706c 6974 7465 725f 7265 2873  dd_splitter_re(s
+0001cc40: 656c 662c 2073 706c 6974 7465 725f 7265  elf, splitter_re
+0001cc50: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+0001cc60: 2020 2020 2020 2061 6464 2073 706c 6974         add split
+0001cc70: 7465 7220 7265 6765 7820 666f 7220 6578  ter regex for ex
+0001cc80: 7472 6163 7469 6e67 206c 6973 7473 2069  tracting lists i
+0001cc90: 6e20 6368 756e 6b73 2e0a 2020 2020 2020  n chunks..      
+0001cca0: 2020 3a70 6172 616d 2073 706c 6974 7465    :param splitte
+0001ccb0: 725f 7265 3a20 6163 7473 206f 6e20 6375  r_re: acts on cu
+0001ccc0: 7272 656e 7420 6e6f 6465 7365 740a 2020  rrent nodeset.  
+0001ccd0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001cce0: 2020 7365 6c66 2e61 6464 5f69 7465 6d5f    self.add_item_
+0001ccf0: 746f 5f61 7272 6179 5f64 6963 7428 7365  to_array_dict(se
+0001cd00: 6c66 2e73 706c 6974 7465 725f 6469 6374  lf.splitter_dict
+0001cd10: 2c20 7365 6c66 2e53 504c 4954 5445 525f  , self.SPLITTER_
+0001cd20: 5245 2c20 7370 6c69 7474 6572 5f72 6529  RE, splitter_re)
+0001cd30: 0a20 2020 2020 2020 2073 656c 662e 7661  .        self.va
+0001cd40: 6c69 6461 7465 5f72 6528 7370 6c69 7474  lidate_re(splitt
+0001cd50: 6572 5f72 6529 0a0a 2020 2020 6465 6620  er_re)..    def 
+0001cd60: 6164 645f 7375 626e 6f64 655f 6b65 795f  add_subnode_key_
+0001cd70: 7265 2873 656c 662c 206e 616d 652c 2073  re(self, name, s
+0001cd80: 7562 6e6f 6465 5f72 6529 3a0a 2020 2020  ubnode_re):.    
+0001cd90: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0001cda0: 6164 6420 6e61 6d65 6420 7375 626e 6f64  add named subnod
+0001cdb0: 6520 7265 6765 7820 666f 7220 7061 7273  e regex for pars
+0001cdc0: 696e 6720 6c69 7374 2069 7465 6d73 2066  ing list items f
+0001cdd0: 726f 6d20 7370 6c69 7474 696e 670a 2020  rom splitting.  
+0001cde0: 2020 2020 2020 3a70 6172 616d 206e 616d        :param nam
+0001cdf0: 653a 206e 616d 6520 6f66 2072 6520 696e  e: name of re in
+0001ce00: 2064 6963 740a 2020 2020 2020 2020 3a70   dict.        :p
+0001ce10: 6172 616d 2073 7562 6e6f 6465 5f72 653a  aram subnode_re:
+0001ce20: 2072 6567 6578 2074 6f20 7374 6f72 650a   regex to store.
+0001ce30: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001ce40: 2020 2020 7365 6c66 2e61 6464 5f6e 616d      self.add_nam
+0001ce50: 6564 5f76 616c 7565 286e 616d 652c 2073  ed_value(name, s
+0001ce60: 7562 6e6f 6465 5f72 6529 0a0a 2020 2020  ubnode_re)..    
+0001ce70: 6465 6620 6164 645f 6e61 6d65 645f 7661  def add_named_va
+0001ce80: 6c75 6528 7365 6c66 2c20 6e61 6d65 2c20  lue(self, name, 
+0001ce90: 7375 626e 6f64 655f 7265 293a 0a20 2020  subnode_re):.   
+0001cea0: 2020 2020 2073 656c 662e 6164 645f 6974       self.add_it
+0001ceb0: 656d 5f74 6f5f 6172 7261 795f 6469 6374  em_to_array_dict
+0001cec0: 2873 656c 662e 6368 756e 6b5f 6469 6374  (self.chunk_dict
+0001ced0: 2c20 6e61 6d65 2c20 7375 626e 6f64 655f  , name, subnode_
+0001cee0: 7265 290a 2020 2020 2020 2020 7365 6c66  re).        self
+0001cef0: 2e76 616c 6964 6174 655f 7265 2873 7562  .validate_re(sub
+0001cf00: 6e6f 6465 5f72 6529 0a0a 2020 2020 6465  node_re)..    de
+0001cf10: 6620 7365 745f 756e 6d61 7463 6865 645f  f set_unmatched_
+0001cf20: 666c 6167 2873 656c 662c 2075 6e6d 6174  flag(self, unmat
+0001cf30: 6368 6564 293a 0a20 2020 2020 2020 2022  ched):.        "
+0001cf40: 2222 0a20 2020 2020 2020 2073 6574 2055  "".        set U
+0001cf50: 4e4d 4154 4348 4544 2062 6f6f 6c65 616e  NMATCHED boolean
+0001cf60: 2e20 4966 2074 7275 6520 6164 6473 2061  . If true adds a
+0001cf70: 6c6c 2075 6e6d 6174 6368 6564 2076 616c  ll unmatched val
+0001cf80: 7565 7320 746f 2064 6963 7420 756e 6465  ues to dict unde
+0001cf90: 7220 554e 4d41 5443 4845 440a 2020 2020  r UNMATCHED.    
+0001cfa0: 2020 2020 3a70 6172 616d 2075 6e6d 6174      :param unmat
+0001cfb0: 6368 6564 3a20 6163 7473 206f 6e20 6375  ched: acts on cu
+0001cfc0: 7272 656e 7420 6e6f 6465 7365 740a 2020  rrent nodeset.  
+0001cfd0: 2020 2020 2020 3a70 6172 616d 206d 6174        :param mat
+0001cfe0: 6368 5f74 7970 653a 2061 6464 6974 696f  ch_type: additio
+0001cff0: 6e61 6c20 6465 6275 6720 746f 206e 616d  nal debug to nam
+0001d000: 650a 2020 2020 2020 2020 2222 220a 2020  e.        """.  
+0001d010: 2020 2020 2020 7365 6c66 2e63 6875 6e6b        self.chunk
+0001d020: 5f64 6963 745b 7365 6c66 2e55 4e4d 4154  _dict[self.UNMAT
+0001d030: 4348 4544 5d20 3d20 756e 6d61 7463 6865  CHED] = unmatche
+0001d040: 640a 0a20 2020 2064 6566 2076 616c 6964  d..    def valid
+0001d050: 6174 655f 7265 2873 656c 662c 2072 6567  ate_re(self, reg
+0001d060: 6578 293a 0a20 2020 2020 2020 2022 2222  ex):.        """
+0001d070: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0001d080: 7265 6765 783a 2072 6567 6578 2074 6f20  regex: regex to 
+0001d090: 6265 2076 616c 6964 6174 6564 0a20 2020  be validated.   
+0001d0a0: 2020 2020 203a 6578 6365 7074 3a20 7468       :except: th
+0001d0b0: 726f 7773 2045 7863 6570 7469 6f6e 2066  rows Exception f
+0001d0c0: 6f72 2062 6164 2072 6567 6578 0a20 2020  or bad regex.   
+0001d0d0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001d0e0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+0001d0f0: 2020 7265 2e63 6f6d 7069 6c65 2872 6567    re.compile(reg
+0001d100: 6578 290a 2020 2020 2020 2020 6578 6365  ex).        exce
+0001d110: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
+0001d120: 653a 0a20 2020 2020 2020 2020 2020 206c  e:.            l
+0001d130: 6f67 6769 6e67 2e65 7272 6f72 2866 2262  ogging.error(f"b
+0001d140: 6164 2072 6567 6578 207b 7265 6765 787d  ad regex {regex}
+0001d150: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
+0001d160: 6169 7365 2065 0a0a 2020 2020 6465 6620  aise e..    def 
+0001d170: 6164 645f 6974 656d 5f74 6f5f 6172 7261  add_item_to_arra
+0001d180: 795f 6469 6374 2873 656c 662c 2074 6865  y_dict(self, the
+0001d190: 5f64 6963 742c 206b 6579 2c20 7661 6c75  _dict, key, valu
+0001d1a0: 6529 3a0a 2020 2020 2020 2020 6966 206e  e):.        if n
+0001d1b0: 6f74 2074 6865 5f64 6963 742e 6765 7428  ot the_dict.get(
+0001d1c0: 6b65 7929 3a0a 2020 2020 2020 2020 2020  key):.          
+0001d1d0: 2020 7468 655f 6469 6374 5b6b 6579 5d20    the_dict[key] 
+0001d1e0: 3d20 5b5d 0a20 2020 2020 2020 2074 6865  = [].        the
+0001d1f0: 5f64 6963 745b 6b65 795d 2e61 7070 656e  _dict[key].appen
+0001d200: 6428 7661 6c75 6529 0a0a 0a63 6c61 7373  d(value)...class
+0001d210: 2048 544d 4c41 7267 7328 4162 7374 7261   HTMLArgs(Abstra
+0001d220: 6374 4172 6773 293a 0a20 2020 2022 2222  ctArgs):.    """
+0001d230: 5061 7273 6520 6172 6773 2074 6f20 616e  Parse args to an
+0001d240: 616c 797a 652c 2065 6469 7420 616e 6420  alyze, edit and 
+0001d250: 616e 6e6f 7461 7465 2048 544d 4c22 2222  annotate HTML"""
+0001d260: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+0001d270: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
+0001d280: 2020 2222 2261 7267 5f64 6963 7420 6973    """arg_dict is
+0001d290: 2073 6574 2074 6f20 6465 6661 756c 7422   set to default"
+0001d2a0: 2222 0a20 2020 2020 2020 2073 7570 6572  "".        super
+0001d2b0: 2829 2e5f 5f69 6e69 745f 5f28 290a 2020  ().__init__().  
+0001d2c0: 2020 2020 2020 7365 6c66 2e64 6963 7466        self.dictf
+0001d2d0: 696c 6520 3d20 4e6f 6e65 0a20 2020 2020  ile = None.     
+0001d2e0: 2020 2073 656c 662e 696e 7061 7468 203d     self.inpath =
+0001d2f0: 204e 6f6e 650a 2020 2020 2020 2020 7365   None.        se
+0001d300: 6c66 2e6f 7574 7061 7468 203d 204e 6f6e  lf.outpath = Non
+0001d310: 650a 2020 2020 2020 2020 7365 6c66 2e6f  e.        self.o
+0001d320: 7574 7374 656d 203d 204e 6f6e 650a 2020  utstem = None.  
+0001d330: 2020 2020 2020 7365 6c66 2e6f 7574 6469        self.outdi
+0001d340: 7220 3d20 4e6f 6e65 0a20 2020 2020 2020  r = None.       
+0001d350: 2073 656c 662e 6172 675f 6469 6374 203d   self.arg_dict =
+0001d360: 204e 6f6e 650a 2020 2020 2020 2020 7365   None.        se
+0001d370: 6c66 2e73 7562 7061 7273 6572 5f61 7267  lf.subparser_arg
+0001d380: 203d 2022 4854 4d4c 220a 0a20 2020 2064   = "HTML"..    d
+0001d390: 6566 2061 6464 5f61 7267 756d 656e 7473  ef add_arguments
+0001d3a0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0001d3b0: 6966 2073 656c 662e 7061 7273 6572 2069  if self.parser i
+0001d3c0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0001d3d0: 2020 2020 7365 6c66 2e70 6172 7365 7220      self.parser 
+0001d3e0: 3d20 6172 6770 6172 7365 2e41 7267 756d  = argparse.Argum
+0001d3f0: 656e 7450 6172 7365 7228 290a 2020 2020  entParser().    
+0001d400: 2020 2020 2222 2261 6464 7320 6172 6775      """adds argu
+0001d410: 6d65 6e74 7320 746f 2061 2070 6172 7365  ments to a parse
+0001d420: 7220 6f72 2073 7562 7061 7273 6572 2222  r or subparser""
+0001d430: 220a 2020 2020 2020 2020 7365 6c66 2e70  ".        self.p
+0001d440: 6172 7365 722e 6465 7363 7269 7074 696f  arser.descriptio
+0001d450: 6e20 3d20 2748 544d 4c20 6564 6974 696e  n = 'HTML editin
+0001d460: 6720 616e 616c 7973 696e 6720 616e 6e6f  g analysing anno
+0001d470: 7461 7469 6f6e 270a 2020 2020 2020 2020  tation'.        
+0001d480: 7365 6c66 2e70 6172 7365 722e 6164 645f  self.parser.add_
+0001d490: 6172 6775 6d65 6e74 2866 222d 2d7b 414e  argument(f"--{AN
+0001d4a0: 4e4f 5441 5445 7d22 2c20 6163 7469 6f6e  NOTATE}", action
+0001d4b0: 3d22 7374 6f72 655f 7472 7565 222c 0a20  ="store_true",. 
+0001d4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d4e0: 6865 6c70 3d22 616e 6e6f 7461 7465 2048  help="annotate H
+0001d4f0: 544d 4c20 6669 6c65 2077 6974 6820 6469  TML file with di
+0001d500: 6374 696f 6e61 7279 2229 0a20 2020 2020  ctionary").     
+0001d510: 2020 2073 656c 662e 7061 7273 6572 2e61     self.parser.a
+0001d520: 6464 5f61 7267 756d 656e 7428 6622 2d2d  dd_argument(f"--
+0001d530: 7b43 4f4c 4f52 7d22 2c20 7479 7065 3d73  {COLOR}", type=s
+0001d540: 7472 2c20 6e61 7267 733d 312c 0a20 2020  tr, nargs=1,.   
+0001d550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d560: 2020 2020 2020 2020 2020 2020 2020 6865                he
+0001d570: 6c70 3d22 636f 6c6f 7572 2066 6f72 2061  lp="colour for a
+0001d580: 6e6e 6f74 6174 696f 6e22 290a 2020 2020  nnotation").    
+0001d590: 2020 2020 7365 6c66 2e70 6172 7365 722e      self.parser.
+0001d5a0: 6164 645f 6172 6775 6d65 6e74 2866 222d  add_argument(f"-
+0001d5b0: 2d7b 4449 4354 7d22 2c20 7479 7065 3d73  -{DICT}", type=s
+0001d5c0: 7472 2c20 6e61 7267 733d 312c 0a20 2020  tr, nargs=1,.   
+0001d5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d5e0: 2020 2020 2020 2020 2020 2020 2020 6865                he
+0001d5f0: 6c70 3d22 6469 6374 696f 6e61 7279 2066  lp="dictionary f
+0001d600: 6f72 2061 6e6e 6f74 6174 696f 6e22 290a  or annotation").
+0001d610: 2020 2020 2020 2020 7365 6c66 2e70 6172          self.par
+0001d620: 7365 722e 6164 645f 6172 6775 6d65 6e74  ser.add_argument
+0001d630: 2866 222d 2d7b 494e 5041 5448 7d22 2c20  (f"--{INPATH}", 
+0001d640: 7479 7065 3d73 7472 2c20 6e61 7267 733d  type=str, nargs=
+0001d650: 312c 0a20 2020 2020 2020 2020 2020 2020  1,.             
+0001d660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d670: 2020 2020 6865 6c70 3d22 696e 7075 7420      help="input 
+0001d680: 6874 6d6c 2066 696c 6522 290a 2020 2020  html file").    
+0001d690: 2020 2020 7365 6c66 2e70 6172 7365 722e      self.parser.
+0001d6a0: 6164 645f 6172 6775 6d65 6e74 2866 222d  add_argument(f"-
+0001d6b0: 2d7b 4f55 5450 4154 487d 222c 2074 7970  -{OUTPATH}", typ
+0001d6c0: 653d 7374 722c 206e 6172 6773 3d31 2c0a  e=str, nargs=1,.
+0001d6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d6f0: 2068 656c 703d 226f 7574 7075 7420 6874   help="output ht
+0001d700: 6d6c 2066 696c 6522 290a 2020 2020 2020  ml file").      
+0001d710: 2020 7365 6c66 2e70 6172 7365 722e 6164    self.parser.ad
+0001d720: 645f 6172 6775 6d65 6e74 2866 222d 2d7b  d_argument(f"--{
+0001d730: 4f55 5444 4952 7d22 2c20 7479 7065 3d73  OUTDIR}", type=s
+0001d740: 7472 2c20 6e61 7267 733d 312c 0a20 2020  tr, nargs=1,.   
+0001d750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d760: 2020 2020 2020 2020 2020 2020 2020 6865                he
+0001d770: 6c70 3d22 6f75 7470 7574 2064 6972 6563  lp="output direc
+0001d780: 746f 7279 2229 0a20 2020 2020 2020 2073  tory").        s
+0001d790: 656c 662e 7061 7273 6572 2e65 7069 6c6f  elf.parser.epilo
+0001d7a0: 6720 3d20 223d 3d3d 3d3d 3d3d 3d3d 3d3d  g = "===========
+0001d7b0: 3d3d 3d3d 220a 0a20 2020 2022 2222 7079  ===="..    """py
+0001d7c0: 7468 6f6e 202d 6d20 7079 616d 6968 746d  thon -m pyamihtm
+0001d7d0: 6c78 2e70 7961 6d69 7820 4854 4d4c 202d  lx.pyamix HTML -
+0001d7e0: 2d61 6e6e 6f74 6174 6520 0a20 2020 2020  -annotate .     
+0001d7f0: 2d2d 6469 6374 202f 5573 6572 732f 706d  --dict /Users/pm
+0001d800: 3238 362f 7072 6f6a 6563 7473 2f73 656d  286/projects/sem
+0001d810: 616e 7469 6343 6c69 6d61 7465 2f61 7236  anticClimate/ar6
+0001d820: 2f61 7236 2f77 6733 2f43 6861 7074 6572  /ar6/wg3/Chapter
+0001d830: 3032 2f64 6963 742f 656d 6973 7369 6f6e  02/dict/emission
+0001d840: 735f 6162 6272 6576 6961 7469 6f6e 732e  s_abbreviations.
+0001d850: 786d 6c0a 2020 2020 202d 2d69 6e70 6174  xml.     --inpat
+0001d860: 6820 2f55 7365 7273 2f70 6d32 3836 2f70  h /Users/pm286/p
+0001d870: 726f 6a65 6374 732f 7365 6d61 6e74 6963  rojects/semantic
+0001d880: 436c 696d 6174 652f 6172 362f 6172 362f  Climate/ar6/ar6/
+0001d890: 7767 332f 4368 6170 7465 7230 322f 6675  wg3/Chapter02/fu
+0001d8a0: 6c6c 7465 7874 2e68 746d 6c0a 2020 2020  lltext.html.    
+0001d8b0: 202d 2d6f 7574 7073 7468 202f 5573 6572   --outpsth /User
+0001d8c0: 732f 706d 3238 362f 7072 6f6a 6563 7473  s/pm286/projects
+0001d8d0: 2f73 656d 616e 7469 6343 6c69 6d61 7465  /semanticClimate
+0001d8e0: 2f61 7236 2f61 7236 2f77 6733 2f43 6861  /ar6/ar6/wg3/Cha
+0001d8f0: 7074 6572 3032 2f61 6e6e 6f74 6174 6564  pter02/annotated
+0001d900: 2f66 756c 6c74 6578 745f 656d 6973 7369  /fulltext_emissi
+0001d910: 6f6e 732e 6874 6d6c 0a20 2020 2020 2d2d  ons.html.     --
+0001d920: 636f 6c6f 7220 7069 6e6b 0a20 2020 2020  color pink.     
+0001d930: 2222 220a 0a20 2020 2023 2063 6c61 7373  """..    # class
+0001d940: 2041 6d69 4469 6374 4172 6773 3a0a 2020   AmiDictArgs:.  
+0001d950: 2020 6465 6620 7072 6f63 6573 735f 6172    def process_ar
+0001d960: 6773 2873 656c 6629 3a0a 2020 2020 2020  gs(self):.      
+0001d970: 2020 2222 2272 756e 7320 7061 7273 6564    """runs parsed
+0001d980: 2061 7267 730a 2020 2020 2020 2020 3a72   args.        :r
+0001d990: 6574 7572 6e3a 0a20 2020 2020 2020 2022  eturn:.        "
+0001d9a0: 2222 0a0a 2020 2020 2020 2020 6966 206e  ""..        if n
+0001d9b0: 6f74 2073 656c 662e 6172 675f 6469 6374  ot self.arg_dict
+0001d9c0: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
+0001d9d0: 6767 696e 672e 7761 726e 696e 6728 6622  gging.warning(f"
+0001d9e0: 6e6f 2061 7267 5f64 6963 7420 6769 7665  no arg_dict give
+0001d9f0: 6e2c 206e 6f20 6163 7469 6f6e 2229 0a20  n, no action"). 
+0001da00: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001da10: 6e0a 0a20 2020 2020 2020 2073 656c 662e  n..        self.
+0001da20: 616e 6e6f 7461 7465 203d 2073 656c 662e  annotate = self.
+0001da30: 6172 675f 6469 6374 2e67 6574 2841 4e4e  arg_dict.get(ANN
+0001da40: 4f54 4154 4529 0a20 2020 2020 2020 2073  OTATE).        s
+0001da50: 656c 662e 636f 6c6f 7220 3d20 7365 6c66  elf.color = self
+0001da60: 2e61 7267 5f64 6963 742e 6765 7428 434f  .arg_dict.get(CO
+0001da70: 4c4f 5229 0a20 2020 2020 2020 2073 656c  LOR).        sel
+0001da80: 662e 6469 6374 6669 6c65 203d 2073 656c  f.dictfile = sel
+0001da90: 662e 6172 675f 6469 6374 2e67 6574 2844  f.arg_dict.get(D
+0001daa0: 4943 5429 0a20 2020 2020 2020 2073 656c  ICT).        sel
+0001dab0: 662e 696e 7061 7468 203d 2073 656c 662e  f.inpath = self.
+0001dac0: 6172 675f 6469 6374 2e67 6574 2849 4e50  arg_dict.get(INP
+0001dad0: 4154 4829 0a20 2020 2020 2020 2073 656c  ATH).        sel
+0001dae0: 662e 6f75 7464 6972 203d 2073 656c 662e  f.outdir = self.
+0001daf0: 6172 675f 6469 6374 2e67 6574 284f 5554  arg_dict.get(OUT
+0001db00: 4449 5229 0a20 2020 2020 2020 2073 656c  DIR).        sel
+0001db10: 662e 6f75 7470 6174 6820 3d20 7365 6c66  f.outpath = self
+0001db20: 2e61 7267 5f64 6963 742e 6765 7428 4f55  .arg_dict.get(OU
+0001db30: 5450 4154 4829 0a0a 2020 2020 2020 2020  TPATH)..        
+0001db40: 6966 2073 656c 662e 616e 6e6f 7461 7465  if self.annotate
+0001db50: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+0001db60: 6c66 2e61 6e6e 6f74 6174 655f 7769 7468  lf.annotate_with
+0001db70: 5f64 6963 7428 290a 0a20 2020 2023 2063  _dict()..    # c
+0001db80: 6c61 7373 2041 6d69 4469 6374 4172 6773  lass AmiDictArgs
+0001db90: 3a0a 0a20 2020 2040 636c 6173 736d 6574  :..    @classmet
+0001dba0: 686f 640a 2020 2020 6465 6620 6372 6561  hod.    def crea
+0001dbb0: 7465 5f64 6566 6175 6c74 5f61 7267 5f64  te_default_arg_d
+0001dbc0: 6963 7428 636c 7329 3a0a 2020 2020 2020  ict(cls):.      
+0001dbd0: 2020 2222 2272 6574 7572 6e73 2061 206e    """returns a n
+0001dbe0: 6577 2043 4f50 5920 6f66 2074 6865 2064  ew COPY of the d
+0001dbf0: 6566 6175 6c74 2064 6963 7469 6f6e 6172  efault dictionar
+0001dc00: 7922 2222 0a20 2020 2020 2020 2061 7267  y""".        arg
+0001dc10: 5f64 6963 7420 3d20 6469 6374 2829 0a20  _dict = dict(). 
+0001dc20: 2020 2020 2020 2061 7267 5f64 6963 745b         arg_dict[
+0001dc30: 4449 4354 5d20 3d20 4e6f 6e65 0a20 2020  DICT] = None.   
+0001dc40: 2020 2020 2072 6574 7572 6e20 6172 675f       return arg_
+0001dc50: 6469 6374 0a0a 2020 2020 4070 726f 7065  dict..    @prope
+0001dc60: 7274 790a 2020 2020 6465 6620 6d6f 6475  rty.    def modu
+0001dc70: 6c65 5f73 7465 6d28 7365 6c66 293a 0a20  le_stem(self):. 
+0001dc80: 2020 2020 2020 2022 2222 6e61 6d65 206f         """name o
+0001dc90: 6620 6d6f 6475 6c65 2222 220a 2020 2020  f module""".    
+0001dca0: 2020 2020 7265 7475 726e 2050 6174 6828      return Path(
+0001dcb0: 5f5f 6669 6c65 5f5f 292e 7374 656d 0a0a  __file__).stem..
+0001dcc0: 2020 2020 6465 6620 616e 6e6f 7461 7465      def annotate
+0001dcd0: 5f77 6974 685f 6469 6374 2873 656c 6629  _with_dict(self)
+0001dce0: 3a0a 2020 2020 2020 2020 2222 2275 7365  :.        """use
+0001dcf0: 7320 6469 6374 696f 6e61 7279 2074 6f20  s dictionary to 
+0001dd00: 616e 6e6f 7461 7465 2077 6f72 6473 2061  annotate words a
+0001dd10: 6e64 2070 6872 6173 6573 2069 6e20 4854  nd phrases in HT
+0001dd20: 4d4c 2066 696c 6522 2222 0a20 2020 2020  ML file""".     
+0001dd30: 2020 206c 6f67 6765 722e 7761 726e 696e     logger.warnin
+0001dd40: 6728 2244 6963 7469 6f6e 6172 6965 7320  g("Dictionaries 
+0001dd50: 6e6f 7420 7375 7070 6f72 7465 6422 290a  not supported").
+0001dd60: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
+0001dd70: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+0001dd80: 656c 662e 6469 6374 6669 6c65 3a0a 2020  elf.dictfile:.  
+0001dd90: 2020 2020 2020 2020 2020 6c6f 6767 696e            loggin
+0001dda0: 672e 6572 726f 7228 6622 6e6f 2064 6963  g.error(f"no dic
+0001ddb0: 7469 6f6e 6172 7920 6769 7665 6e22 290a  tionary given").
+0001ddc0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001ddd0: 726e 0a20 2020 2020 2020 2069 6620 6e6f  rn.        if no
+0001dde0: 7420 7365 6c66 2e69 6e70 6174 683a 0a20  t self.inpath:. 
+0001ddf0: 2020 2020 2020 2020 2020 206c 6f67 6769             loggi
+0001de00: 6e67 2e65 7272 6f72 2866 226e 6f20 696e  ng.error(f"no in
+0001de10: 7075 7420 6669 6c65 2074 6f20 616e 6e6f  put file to anno
+0001de20: 7461 7465 2067 6976 656e 2229 0a20 2020  tate given").   
+0001de30: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+0001de40: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+0001de50: 656c 662e 6f75 7470 6174 683a 0a20 2020  elf.outpath:.   
+0001de60: 2020 2020 2020 2020 206c 6f67 6769 6e67           logging
+0001de70: 2e65 7272 6f72 2866 226e 6f20 6f75 7470  .error(f"no outp
+0001de80: 7574 2066 696c 6520 6769 7665 6e22 290a  ut file given").
+0001de90: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001dea0: 726e 0a20 2020 2020 2020 2069 6620 6e6f  rn.        if no
+0001deb0: 7420 7365 6c66 2e6f 7574 6469 723a 0a20  t self.outdir:. 
+0001dec0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001ded0: 6f75 7464 6972 203d 2050 6174 6828 7365  outdir = Path(se
+0001dee0: 6c66 2e6f 7574 7061 7468 292e 7061 7265  lf.outpath).pare
+0001def0: 6e74 0a20 2020 2020 2020 2073 656c 662e  nt.        self.
+0001df00: 6f75 7464 6972 203d 2050 6174 6828 7365  outdir = Path(se
+0001df10: 6c66 2e6f 7574 6469 7229 0a20 2020 2020  lf.outdir).     
+0001df20: 2020 2073 656c 662e 6f75 7464 6972 2e6d     self.outdir.m
+0001df30: 6b64 6972 2865 7869 7374 5f6f 6b3d 5472  kdir(exist_ok=Tr
+0001df40: 7565 290a 0a20 2020 2020 2020 2073 656c  ue)..        sel
+0001df50: 662e 616d 695f 6469 6374 203d 2041 6d69  f.ami_dict = Ami
+0001df60: 4469 6374 696f 6e61 7279 2e63 7265 6174  Dictionary.creat
+0001df70: 655f 6672 6f6d 5f78 6d6c 5f66 696c 6528  e_from_xml_file(
+0001df80: 7365 6c66 2e64 6963 7466 696c 6529 0a20  self.dictfile). 
+0001df90: 2020 2020 2020 2073 656c 662e 616d 695f         self.ami_
+0001dfa0: 6469 6374 2e6d 6172 6b75 705f 6874 6d6c  dict.markup_html
+0001dfb0: 5f66 726f 6d5f 6469 6374 696f 6e61 7279  _from_dictionary
+0001dfc0: 2873 656c 662e 696e 7061 7468 2c20 7365  (self.inpath, se
+0001dfd0: 6c66 2e6f 7574 7061 7468 2c20 7365 6c66  lf.outpath, self
+0001dfe0: 2e63 6f6c 6f72 290a 0a0a 636c 6173 7320  .color)...class 
+0001dff0: 5552 4c43 6163 6865 3a0a 2020 2020 6465  URLCache:.    de
+0001e000: 6620 5f5f 696e 6974 5f5f 2873 656c 6629  f __init__(self)
+0001e010: 3a0a 2020 2020 2020 2020 7365 6c66 2e75  :.        self.u
+0001e020: 726c 5f64 6963 7420 3d20 6469 6374 2829  rl_dict = dict()
+0001e030: 0a0a 2020 2020 6465 6620 7265 6164 5f78  ..    def read_x
+0001e040: 6d6c 5f65 6c65 6d65 6e74 5f66 726f 6d5f  ml_element_from_
+0001e050: 6769 7468 7562 2873 656c 662c 2067 6974  github(self, git
+0001e060: 6875 625f 7572 6c2c 2064 656c 6179 3d31  hub_url, delay=1
+0001e070: 293a 0a20 2020 2020 2020 2022 2222 7265  ):.        """re
+0001e080: 7472 6965 7665 7320 616e 6420 7061 7273  trieves and pars
+0001e090: 6573 2063 6f6e 7465 6e74 206f 6620 5552  es content of UR
+0001e0a0: 4c2e 2043 6163 6865 7320 6974 2069 6620  L. Caches it if 
+0001e0b0: 666f 756e 640a 2020 2020 2020 2020 7265  found.        re
+0001e0c0: 7475 726e 7320 6120 6465 6570 636f 7079  turns a deepcopy
+0001e0d0: 2061 7320 656c 656d 6e74 2069 7320 6c69   as elemnt is li
+0001e0e0: 6b65 6c79 2074 6f20 6265 2065 6469 7465  kely to be edite
+0001e0f0: 6422 2222 0a20 2020 2020 2020 2068 746d  d""".        htm
+0001e100: 6c5f 656c 656d 203d 2073 656c 662e 7572  l_elem = self.ur
+0001e110: 6c5f 6469 6374 2e67 6574 2867 6974 6875  l_dict.get(githu
+0001e120: 625f 7572 6c29 0a20 2020 2020 2020 2069  b_url).        i
+0001e130: 6620 6874 6d6c 5f65 6c65 6d20 6973 204e  f html_elem is N
+0001e140: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0001e150: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+0001e160: 2020 2020 2020 6874 6d6c 5f65 6c65 6d20        html_elem 
+0001e170: 3d20 586d 6c4c 6962 2e72 6561 645f 786d  = XmlLib.read_xm
+0001e180: 6c5f 656c 656d 656e 745f 6672 6f6d 5f67  l_element_from_g
+0001e190: 6974 6875 6228 6769 7468 7562 5f75 726c  ithub(github_url
+0001e1a0: 3d67 6974 6875 625f 7572 6c29 0a20 2020  =github_url).   
+0001e1b0: 2020 2020 2020 2020 2020 2020 2074 696d               tim
+0001e1c0: 652e 736c 6565 7028 6465 6c61 7929 0a20  e.sleep(delay). 
+0001e1d0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+0001e1e0: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
+0001e1f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001e200: 2020 7072 696e 7428 6622 6361 6e6e 6f74    print(f"cannot
+0001e210: 2072 6561 6420 7b67 6974 6875 625f 7572   read {github_ur
+0001e220: 6c7d 2062 6563 6175 7365 207b 657d 2229  l} because {e}")
+0001e230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e240: 2072 6574 7572 6e20 4e6f 6e65 0a20 2020   return None.   
+0001e250: 2020 2020 2020 2020 2073 656c 662e 7572           self.ur
+0001e260: 6c5f 6469 6374 5b67 6974 6875 625f 7572  l_dict[github_ur
+0001e270: 6c5d 203d 2068 746d 6c5f 656c 656d 0a20  l] = html_elem. 
+0001e280: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0001e290: 2020 2020 2020 2020 2023 2070 7269 6e74           # print
+0001e2a0: 2866 2220 666f 756e 6420 696e 2063 6163  (f" found in cac
+0001e2b0: 6865 2122 290a 2020 2020 2020 2020 2020  he!").          
+0001e2c0: 2020 7061 7373 0a20 2020 2020 2020 2072    pass.        r
+0001e2d0: 6574 7572 6e20 636f 7079 2e64 6565 7063  eturn copy.deepc
+0001e2e0: 6f70 7928 6874 6d6c 5f65 6c65 6d29 0a0a  opy(html_elem)..
+0001e2f0: 0a49 4420 3d20 2269 6422 0a4f 424a 4543  .ID = "id".OBJEC
+0001e300: 5420 3d22 6f62 6a65 6374 220a 5354 4152  T ="object".STAR
+0001e310: 5445 4e44 203d 2022 7374 6172 745f 656e  TEND = "start_en
+0001e320: 6422 0a0a 636c 6173 7320 466c 6f61 7442  d"..class FloatB
+0001e330: 6f75 6e64 6172 7944 6963 743a 0a0a 2020  oundaryDict:..  
+0001e340: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
+0001e350: 656c 662c 2068 746d 6c5f 656c 656d 2c20  elf, html_elem, 
+0001e360: 6f75 7464 6972 3d4e 6f6e 6529 3a0a 2020  outdir=None):.  
+0001e370: 2020 2020 2020 7365 6c66 2e66 6c6f 6174        self.float
+0001e380: 5f62 6f75 6e64 6172 795f 6469 6374 203d  _boundary_dict =
+0001e390: 2064 6566 6175 6c74 6469 6374 286c 6973   defaultdict(lis
+0001e3a0: 7429 0a20 2020 2020 2020 2073 656c 662e  t).        self.
+0001e3b0: 6874 6d6c 5f65 6c65 6d20 3d20 6874 6d6c  html_elem = html
+0001e3c0: 5f65 6c65 6d0a 2020 2020 2020 2020 7365  _elem.        se
+0001e3d0: 6c66 2e6f 7574 6469 7220 3d20 6f75 7464  lf.outdir = outd
+0001e3e0: 6972 0a0a 2020 2020 6465 6620 6164 645f  ir..    def add_
+0001e3f0: 6f62 6a65 6374 2873 656c 662c 2066 6c6f  object(self, flo
+0001e400: 6174 5f62 6f75 6e64 6172 7929 3a0a 2020  at_boundary):.  
+0001e410: 2020 2020 2020 6b65 7920 3d20 666c 6f61        key = floa
+0001e420: 745f 626f 756e 6461 7279 2e6b 6579 0a20  t_boundary.key. 
+0001e430: 2020 2020 2020 2073 656c 662e 666c 6f61         self.floa
+0001e440: 745f 626f 756e 6461 7279 5f64 6963 745b  t_boundary_dict[
+0001e450: 6b65 795d 2e61 7070 656e 6428 666c 6f61  key].append(floa
+0001e460: 745f 626f 756e 6461 7279 290a 0a20 2020  t_boundary)..   
+0001e470: 2064 6566 2061 6464 5f66 6c6f 6174 5f62   def add_float_b
+0001e480: 6f75 6e64 6172 6965 7328 7365 6c66 2c20  oundaries(self, 
+0001e490: 666c 6f61 745f 626f 756e 6461 7269 6573  float_boundaries
+0001e4a0: 293a 0a20 2020 2020 2020 2066 6f72 2066  ):.        for f
+0001e4b0: 6c6f 6174 5f62 6f75 6e64 6172 7920 696e  loat_boundary in
+0001e4c0: 2066 6c6f 6174 5f62 6f75 6e64 6172 6965   float_boundarie
+0001e4d0: 733a 0a20 2020 2020 2020 2020 2020 2073  s:.            s
+0001e4e0: 656c 662e 6164 645f 6f62 6a65 6374 2866  elf.add_object(f
+0001e4f0: 6c6f 6174 5f62 6f75 6e64 6172 7929 0a0a  loat_boundary)..
+0001e500: 2020 2020 6465 6620 6578 7472 6163 745f      def extract_
+0001e510: 636f 6e74 656e 7473 5f6f 665f 6272 6163  contents_of_brac
+0001e520: 6b65 7465 645f 626f 756e 6461 7269 6573  keted_boundaries
+0001e530: 5f61 6e64 5f77 7269 7465 2873 656c 6629  _and_write(self)
+0001e540: 3a0a 2020 2020 2020 2020 666f 7220 6662  :.        for fb
+0001e550: 5f6c 6973 7420 696e 2073 656c 662e 666c  _list in self.fl
+0001e560: 6f61 745f 626f 756e 6461 7279 5f64 6963  oat_boundary_dic
+0001e570: 742e 7661 6c75 6573 2829 3a0a 2020 2020  t.values():.    
+0001e580: 2020 2020 2020 2020 6966 206c 656e 2866          if len(f
+0001e590: 625f 6c69 7374 2920 3d3d 2032 3a0a 2020  b_list) == 2:.  
+0001e5a0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0001e5b0: 7072 696e 7428 6622 4642 207b 6662 5f6c  print(f"FB {fb_l
+0001e5c0: 6973 747d 207b 6662 5f6c 6973 745b 305d  ist} {fb_list[0]
+0001e5d0: 2e64 6976 5f69 647d 207b 6662 5f6c 6973  .div_id} {fb_lis
+0001e5e0: 745b 315d 2e64 6976 5f69 647d 2229 0a20  t[1].div_id}"). 
+0001e5f0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0001e600: 6577 5f64 6976 203d 2073 656c 662e 6465  ew_div = self.de
+0001e610: 6c65 7465 5f62 6574 7765 656e 2866 625f  lete_between(fb_
+0001e620: 6c69 7374 5b30 5d2e 6469 765f 6964 2c20  list[0].div_id, 
+0001e630: 6662 5f6c 6973 745b 315d 2e64 6976 5f69  fb_list[1].div_i
+0001e640: 6429 0a20 2020 2020 2020 2020 2020 2020  d).             
+0001e650: 2020 2066 6c6f 6174 5f6e 616d 6520 3d20     float_name = 
+0001e660: 6662 5f6c 6973 745b 305d 2e6b 6579 0a20  fb_list[0].key. 
+0001e670: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0001e680: 6577 5f64 6976 2e61 7474 7269 625b 226e  ew_div.attrib["n
+0001e690: 616d 6522 5d20 3d20 666c 6f61 745f 6e61  ame"] = float_na
+0001e6a0: 6d65 0a20 2020 2020 2020 2020 2020 2020  me.             
+0001e6b0: 2020 206e 6577 5f68 746d 6c5f 656c 656d     new_html_elem
+0001e6c0: 203d 2048 746d 6c4c 6962 2e63 7265 6174   = HtmlLib.creat
+0001e6d0: 655f 6e65 775f 6874 6d6c 5f77 6974 685f  e_new_html_with_
+0001e6e0: 6f6c 645f 7374 796c 6573 2873 656c 662e  old_styles(self.
+0001e6f0: 6874 6d6c 5f65 6c65 6d29 0a20 2020 2020  html_elem).     
+0001e700: 2020 2020 2020 2020 2020 2048 746d 6c4c             HtmlL
+0001e710: 6962 2e67 6574 5f62 6f64 7928 6e65 775f  ib.get_body(new_
+0001e720: 6874 6d6c 5f65 6c65 6d29 2e61 7070 656e  html_elem).appen
+0001e730: 6428 6e65 775f 6469 7629 0a20 2020 2020  d(new_div).     
+0001e740: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+0001e750: 6c66 2e6f 7574 6469 723a 0a20 2020 2020  lf.outdir:.     
+0001e760: 2020 2020 2020 2020 2020 2020 2020 2050                 P
+0001e770: 6174 6828 7365 6c66 2e6f 7574 6469 7229  ath(self.outdir)
+0001e780: 2e6d 6b64 6972 2865 7869 7374 5f6f 6b3d  .mkdir(exist_ok=
+0001e790: 5472 7565 2c20 7061 7265 6e74 733d 4661  True, parents=Fa
+0001e7a0: 6c73 6529 0a20 2020 2020 2020 2020 2020  lse).           
+0001e7b0: 2020 2020 2020 2020 2066 696c 655f 7374           file_st
+0001e7c0: 656d 203d 2066 6c6f 6174 5f6e 616d 652e  em = float_name.
+0001e7d0: 6c6f 7765 7228 292e 7265 706c 6163 6528  lower().replace(
+0001e7e0: 225c 5c73 2a22 2c20 2222 290a 2020 2020  "\\s*", "").    
+0001e7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e800: 586d 6c4c 6962 2e77 7269 7465 5f78 6d6c  XmlLib.write_xml
+0001e810: 286e 6577 5f68 746d 6c5f 656c 656d 2c20  (new_html_elem, 
+0001e820: 5061 7468 2873 656c 662e 6f75 7464 6972  Path(self.outdir
+0001e830: 2c20 6669 6c65 5f73 7465 6d20 2b20 222e  , file_stem + ".
+0001e840: 6874 6d6c 2229 290a 0a20 2020 2064 6566  html"))..    def
+0001e850: 2064 656c 6574 655f 6265 7477 6565 6e28   delete_between(
+0001e860: 7365 6c66 2c20 6469 765f 6964 302c 2064  self, div_id0, d
+0001e870: 6976 5f69 6431 293a 0a20 2020 2020 2020  iv_id1):.       
+0001e880: 2065 6c65 6d30 203d 2073 656c 662e 6874   elem0 = self.ht
+0001e890: 6d6c 5f65 6c65 6d2e 7870 6174 6828 6622  ml_elem.xpath(f"
+0001e8a0: 2e2f 2f64 6976 5b40 6964 3d27 7b64 6976  .//div[@id='{div
+0001e8b0: 5f69 6430 7d27 5d22 295b 305d 0a20 2020  _id0}']")[0].   
+0001e8c0: 2020 2020 2065 6c65 6d31 203d 2073 656c       elem1 = sel
+0001e8d0: 662e 6874 6d6c 5f65 6c65 6d2e 7870 6174  f.html_elem.xpat
+0001e8e0: 6828 6622 2e2f 2f64 6976 5b40 6964 3d27  h(f".//div[@id='
+0001e8f0: 7b64 6976 5f69 6431 7d27 5d22 295b 305d  {div_id1}']")[0]
+0001e900: 0a20 2020 2020 2020 2066 6f6c 6c6f 7769  .        followi
+0001e910: 6e67 203d 2065 6c65 6d30 2e78 7061 7468  ng = elem0.xpath
+0001e920: 2822 666f 6c6c 6f77 696e 673a 3a2a 2229  ("following::*")
+0001e930: 0a20 2020 2020 2020 206e 6577 5f64 6976  .        new_div
+0001e940: 203d 2045 542e 456c 656d 656e 7428 2264   = ET.Element("d
+0001e950: 6976 2229 0a20 2020 2020 2020 206e 6577  iv").        new
+0001e960: 5f64 6976 2e61 7474 7269 625b 2269 6422  _div.attrib["id"
+0001e970: 5d20 3d20 6469 765f 6964 300a 2020 2020  ] = div_id0.    
+0001e980: 2020 2020 666f 7220 666f 6c6c 6f77 2069      for follow i
+0001e990: 6e20 666f 6c6c 6f77 696e 673a 0a20 2020  n following:.   
+0001e9a0: 2020 2020 2020 2020 2069 645f 203d 2066           id_ = f
+0001e9b0: 6f6c 6c6f 772e 6174 7472 6962 5b27 6964  ollow.attrib['id
+0001e9c0: 275d 0a20 2020 2020 2020 2020 2020 206e  '].            n
+0001e9d0: 6577 5f64 6976 2e61 7070 656e 6428 666f  ew_div.append(fo
+0001e9e0: 6c6c 6f77 290a 2020 2020 2020 2020 2020  llow).          
+0001e9f0: 2020 2320 666f 6c6c 6f77 2e67 6574 7061    # follow.getpa
+0001ea00: 7265 6e74 2829 2e72 656d 6f76 6528 666f  rent().remove(fo
+0001ea10: 6c6c 6f77 290a 2020 2020 2020 2020 2020  llow).          
+0001ea20: 2020 6966 2069 645f 203d 3d20 6469 765f    if id_ == div_
+0001ea30: 6964 313a 0a20 2020 2020 2020 2020 2020  id1:.           
+0001ea40: 2020 2020 2070 7269 6e74 2822 4558 4954       print("EXIT
+0001ea50: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0001ea60: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
+0001ea70: 2072 6574 7572 6e20 6e65 775f 6469 760a   return new_div.
+0001ea80: 0a0a 0a63 6c61 7373 2046 6c6f 6174 426f  ...class FloatBo
+0001ea90: 756e 6461 7279 3a0a 2020 2020 2222 220a  undary:.    """.
+0001eaa0: 2020 2020 486f 6c64 730a 2020 2020 2222      Holds.    ""
+0001eab0: 220a 2020 2020 4950 4343 5f42 4f55 4e44  ".    IPCC_BOUND
+0001eac0: 4152 5920 3d20 225c 5c5b 3f22 205c 0a20  ARY = "\\[?" \. 
+0001ead0: 2020 2020 2020 2020 2020 2066 2228 3f50             f"(?P
+0001eae0: 3c7b 5354 4152 5445 4e44 7d3e 5354 4152  <{STARTEND}>STAR
+0001eaf0: 547c 454e 4429 5c5c 732a 2220 5c0a 2020  T|END)\\s*" \.  
+0001eb00: 2020 2020 2020 2020 2020 6622 283f 503c            f"(?P<
+0001eb10: 7b4f 424a 4543 547d 3e2e 2a42 4f58 7c46  {OBJECT}>.*BOX|F
+0001eb20: 4947 5552 457c 5441 424c 4529 5c5c 732a  IGURE|TABLE)\\s*
+0001eb30: 2220 5c0a 2020 2020 2020 2020 2020 2020  " \.            
+0001eb40: 6622 283f 503c 7b49 447d 3e28 3f3a 283f  f"(?P<{ID}>(?:(?
+0001eb50: 3a5b 412d 5a30 2d39 5d2b 7c5c 5c64 2b29  :[A-Z0-9]+|\\d+)
+0001eb60: 3f28 3f3a 5c5c 2e5c 5c64 2b29 2a29 295c  ?(?:\\.\\d+)*))\
+0001eb70: 5c73 2a28 3f3a 4845 5245 295c 5c5d 3f22  \s*(?:HERE)\\]?"
+0001eb80: 0a0a 2020 2020 2320 5b53 5441 5254 2043  ..    # [START C
+0001eb90: 524f 5353 2d53 4543 5449 4f4e 2042 4f58  ROSS-SECTION BOX
+0001eba0: 2e31 2048 4552 455d 0a0a 2020 2020 6465  .1 HERE]..    de
+0001ebb0: 6620 5f5f 696e 6974 5f5f 2873 656c 6629  f __init__(self)
+0001ebc0: 3a0a 2020 2020 2020 2020 7365 6c66 2e67  :.        self.g
+0001ebd0: 726f 7570 5f64 6963 7420 3d20 6469 6374  roup_dict = dict
+0001ebe0: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
+0001ebf0: 7374 6172 7420 3d20 4e6f 6e65 0a20 2020  start = None.   
+0001ec00: 2020 2020 2073 656c 662e 656e 6420 3d20       self.end = 
+0001ec10: 4e6f 6e65 0a20 2020 2020 2020 2073 656c  None.        sel
+0001ec20: 662e 6469 765f 6964 203d 204e 6f6e 650a  f.div_id = None.
+0001ec30: 0a20 2020 2064 6566 205f 5f73 7472 5f5f  .    def __str__
+0001ec40: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0001ec50: 7265 7475 726e 2073 656c 662e 6772 6f75  return self.grou
+0001ec60: 705f 6469 6374 2e67 6574 2853 5441 5254  p_dict.get(START
+0001ec70: 454e 4429 202b 2022 3b22 202b 2020 7365  END) + ";" +  se
+0001ec80: 6c66 2e67 726f 7570 5f64 6963 742e 6765  lf.group_dict.ge
+0001ec90: 7428 4f42 4a45 4354 2920 2b20 223b 2220  t(OBJECT) + ";" 
+0001eca0: 2b20 2073 656c 662e 6772 6f75 705f 6469  +  self.group_di
+0001ecb0: 6374 2e67 6574 2849 4429 0a0a 2020 2020  ct.get(ID)..    
+0001ecc0: 6465 6620 5f5f 7265 7072 5f5f 2873 656c  def __repr__(sel
+0001ecd0: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
+0001ece0: 726e 2073 656c 662e 5f5f 7374 725f 5f28  rn self.__str__(
+0001ecf0: 290a 0a20 2020 2064 6566 2061 6464 2873  )..    def add(s
+0001ed00: 656c 662c 206e 616d 652c 2076 616c 7565  elf, name, value
+0001ed10: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
+0001ed20: 6772 6f75 705f 6469 6374 5b6e 616d 655d  group_dict[name]
+0001ed30: 203d 2076 616c 7565 0a0a 2020 2020 4070   = value..    @p
+0001ed40: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
+0001ed50: 6b65 7928 7365 6c66 293a 0a20 2020 2020  key(self):.     
+0001ed60: 2020 2072 6574 7572 6e20 7374 7228 7365     return str(se
+0001ed70: 6c66 2e67 726f 7570 5f64 6963 745b 4f42  lf.group_dict[OB
+0001ed80: 4a45 4354 5d29 202b 2073 7472 2873 656c  JECT]) + str(sel
+0001ed90: 662e 6772 6f75 705f 6469 6374 5b49 445d  f.group_dict[ID]
+0001eda0: 290a 0a20 2020 2040 7072 6f70 6572 7479  )..    @property
+0001edb0: 0a20 2020 2064 6566 2073 7461 7274 5f65  .    def start_e
+0001edc0: 6e64 2873 656c 6629 3a0a 2020 2020 2020  nd(self):.      
+0001edd0: 2020 7265 7475 726e 2073 656c 662e 6772    return self.gr
+0001ede0: 6f75 705f 6469 6374 5b53 5441 5254 454e  oup_dict[STARTEN
+0001edf0: 445d 0a0a 2020 2020 4063 6c61 7373 6d65  D]..    @classme
+0001ee00: 7468 6f64 0a20 2020 2064 6566 2065 7874  thod.    def ext
+0001ee10: 7261 6374 5f66 6c6f 6174 735f 616e 645f  ract_floats_and_
+0001ee20: 626f 756e 6461 7269 6573 2863 6c73 2c20  boundaries(cls, 
+0001ee30: 6874 6d6c 5f65 6c65 6d2c 2070 6163 6b61  html_elem, packa
+0001ee40: 6765 2c20 6f75 7464 6972 3d4e 6f6e 6529  ge, outdir=None)
+0001ee50: 3a0a 2020 2020 2020 2020 7265 6765 7820  :.        regex 
+0001ee60: 3d20 466c 6f61 7442 6f75 6e64 6172 792e  = FloatBoundary.
+0001ee70: 4950 4343 5f42 4f55 4e44 4152 590a 2020  IPCC_BOUNDARY.  
+0001ee80: 2020 2020 2020 666c 6f61 745f 626f 756e        float_boun
+0001ee90: 6461 7269 6573 203d 2046 6c6f 6174 4578  daries = FloatEx
+0001eea0: 7472 6163 746f 7228 292e 6578 7472 6163  tractor().extrac
+0001eeb0: 745f 666c 6f61 745f 626f 756e 6461 7269  t_float_boundari
+0001eec0: 6573 2868 746d 6c5f 656c 656d 2c20 7265  es(html_elem, re
+0001eed0: 6765 7829 0a20 2020 2020 2020 2066 6c6f  gex).        flo
+0001eee0: 6174 5f62 6f75 6e64 6172 795f 6469 6374  at_boundary_dict
+0001eef0: 203d 2046 6c6f 6174 426f 756e 6461 7279   = FloatBoundary
+0001ef00: 4469 6374 2868 746d 6c5f 656c 656d 2c20  Dict(html_elem, 
+0001ef10: 6f75 7464 6972 3d6f 7574 6469 7229 0a20  outdir=outdir). 
+0001ef20: 2020 2020 2020 2066 6c6f 6174 5f62 6f75         float_bou
+0001ef30: 6e64 6172 795f 6469 6374 2e61 6464 5f66  ndary_dict.add_f
+0001ef40: 6c6f 6174 5f62 6f75 6e64 6172 6965 7328  loat_boundaries(
+0001ef50: 666c 6f61 745f 626f 756e 6461 7269 6573  float_boundaries
+0001ef60: 290a 2020 2020 2020 2020 666c 6f61 745f  ).        float_
+0001ef70: 626f 756e 6461 7279 5f64 6963 742e 6578  boundary_dict.ex
+0001ef80: 7472 6163 745f 636f 6e74 656e 7473 5f6f  tract_contents_o
+0001ef90: 665f 6272 6163 6b65 7465 645f 626f 756e  f_bracketed_boun
+0001efa0: 6461 7269 6573 5f61 6e64 5f77 7269 7465  daries_and_write
+0001efb0: 2829 0a20 2020 2020 2020 2072 6574 7572  ().        retur
+0001efc0: 6e20 6874 6d6c 5f65 6c65 6d0a 0a0a 636c  n html_elem...cl
+0001efd0: 6173 7320 466c 6f61 7445 7874 7261 6374  ass FloatExtract
+0001efe0: 6f72 3a0a 2020 2020 2222 2265 7874 7261  or:.    """extra
+0001eff0: 6374 7320 666c 6f61 7473 2028 626f 7865  cts floats (boxe
+0001f000: 732c 2066 6967 7572 6573 2c20 6574 632e  s, figures, etc.
+0001f010: 2920 7573 696e 6720 7374 6172 742f 656e  ) using start/en
+0001f020: 6420 7265 6765 7865 730a 2020 2020 2222  d regexes.    ""
+0001f030: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
+0001f040: 745f 5f28 7365 6c66 2c20 7265 6765 783d  t__(self, regex=
+0001f050: 4e6f 6e65 293a 0a20 2020 2020 2020 2073  None):.        s
+0001f060: 656c 662e 7265 6765 7820 3d20 7265 6765  elf.regex = rege
+0001f070: 780a 0a20 2020 2064 6566 2065 7874 7261  x..    def extra
+0001f080: 6374 5f66 6c6f 6174 5f62 6f75 6e64 6172  ct_float_boundar
+0001f090: 6965 7328 7365 6c66 2c20 6874 6d6c 5f65  ies(self, html_e
+0001f0a0: 6c65 6d2c 2072 6567 6578 5f73 7472 293a  lem, regex_str):
+0001f0b0: 0a20 2020 2020 2020 2066 6c6f 6174 5f62  .        float_b
+0001f0c0: 6f75 6e64 6172 6965 7320 3d20 5b5d 0a20  oundaries = []. 
+0001f0d0: 2020 2020 2020 2072 6567 6578 203d 2072         regex = r
+0001f0e0: 652e 636f 6d70 696c 6528 7265 6765 785f  e.compile(regex_
+0001f0f0: 7374 7229 0a20 2020 2020 2020 2023 2070  str).        # p
+0001f100: 7269 6e74 2866 2220 7265 6765 7820 7b72  rint(f" regex {r
+0001f110: 6567 6578 7d22 290a 2020 2020 2020 2020  egex}").        
+0001f120: 6469 7673 203d 2068 746d 6c5f 656c 656d  divs = html_elem
+0001f130: 2e78 7061 7468 2822 2e2f 2f64 6976 2229  .xpath(".//div")
+0001f140: 0a20 2020 2020 2020 2066 6f72 2064 6976  .        for div
+0001f150: 2069 6e20 6469 7673 3a0a 2020 2020 2020   in divs:.      
+0001f160: 2020 2020 2020 7370 616e 7320 3d20 6469        spans = di
+0001f170: 762e 7870 6174 6828 222e 2f73 7061 6e22  v.xpath("./span"
+0001f180: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
+0001f190: 7220 7370 616e 2069 6e20 7370 616e 733a  r span in spans:
+0001f1a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f1b0: 206d 6174 6368 203d 2072 652e 7365 6172   match = re.sear
+0001f1c0: 6368 2872 6567 6578 2c20 7370 616e 2e74  ch(regex, span.t
+0001f1d0: 6578 7429 0a20 2020 2020 2020 2020 2020  ext).           
+0001f1e0: 2020 2020 2069 6620 6d61 7463 683a 0a20       if match:. 
+0001f1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f200: 2020 2066 6c6f 6174 5f62 6f75 6e64 6172     float_boundar
+0001f210: 7920 3d20 466c 6f61 7442 6f75 6e64 6172  y = FloatBoundar
+0001f220: 7928 290a 2020 2020 2020 2020 2020 2020  y().            
+0001f230: 2020 2020 2020 2020 666c 6f61 745f 626f          float_bo
+0001f240: 756e 6461 7279 2e64 6976 5f69 6420 3d20  undary.div_id = 
+0001f250: 6469 762e 6174 7472 6962 5b22 6964 225d  div.attrib["id"]
+0001f260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f270: 2020 2020 2066 6f72 2066 6965 6c64 2069       for field i
+0001f280: 6e20 5b53 5441 5254 454e 442c 204f 424a  n [STARTEND, OBJ
+0001f290: 4543 542c 2049 445d 3a0a 2020 2020 2020  ECT, ID]:.      
+0001f2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f2b0: 2020 666c 6f61 745f 626f 756e 6461 7279    float_boundary
+0001f2c0: 2e61 6464 2866 6965 6c64 2c20 6d61 7463  .add(field, matc
+0001f2d0: 682e 6772 6f75 7028 6669 656c 6429 290a  h.group(field)).
+0001f2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f2f0: 2020 2020 666c 6f61 745f 626f 756e 6461      float_bounda
+0001f300: 7269 6573 2e61 7070 656e 6428 666c 6f61  ries.append(floa
+0001f310: 745f 626f 756e 6461 7279 290a 2020 2020  t_boundary).    
+0001f320: 2020 2020 7265 7475 726e 2066 6c6f 6174      return float
+0001f330: 5f62 6f75 6e64 6172 6965 730a 0a0a 0a63  _boundaries....c
+0001f340: 6c61 7373 2043 5353 5374 796c 653a 0a20  lass CSSStyle:. 
+0001f350: 2020 2022 2222 0a20 2020 2063 6f6d 6d6f     """.    commo
+0001f360: 6e20 7375 6273 6574 206f 6620 4353 5320  n subset of CSS 
+0001f370: 7374 796c 6573 2f63 6f6d 6d61 6e64 730a  styles/commands.
+0001f380: 2020 2020 2222 220a 2020 2020 2320 616c      """.    # al
+0001f390: 6c20 6172 6520 6c6f 7765 7263 6173 650a  l are lowercase.
+0001f3a0: 2020 2020 424f 4c44 203d 2022 626f 6c64      BOLD = "bold
+0001f3b0: 220a 2020 2020 424f 5244 4552 203d 2022  ".    BORDER = "
+0001f3c0: 626f 7264 6572 220a 2020 2020 424f 5454  border".    BOTT
+0001f3d0: 4f4d 203d 2022 626f 7474 6f6d 220a 2020  OM = "bottom".  
+0001f3e0: 2020 434f 4c4f 5220 3d20 2263 6f6c 6f72    COLOR = "color
+0001f3f0: 220a 2020 2020 444f 545f 4220 3d20 222e  ".    DOT_B = ".
+0001f400: 4222 0a20 2020 2046 494c 4c20 3d20 2266  B".    FILL = "f
+0001f410: 696c 6c22 0a20 2020 2053 5452 4f4b 4520  ill".    STROKE 
+0001f420: 3d20 2273 7472 6f6b 6522 0a20 2020 2046  = "stroke".    F
+0001f430: 4f4e 545f 4641 4d49 4c59 203d 2022 666f  ONT_FAMILY = "fo
+0001f440: 6e74 2d66 616d 696c 7922 0a20 2020 2046  nt-family".    F
+0001f450: 4f4e 545f 5349 5a45 203d 2022 666f 6e74  ONT_SIZE = "font
+0001f460: 2d73 697a 6522 0a20 2020 2046 4f4e 545f  -size".    FONT_
+0001f470: 5354 594c 4520 3d20 2266 6f6e 742d 7374  STYLE = "font-st
+0001f480: 796c 6522 0a20 2020 2046 4f4e 545f 5354  yle".    FONT_ST
+0001f490: 5245 5443 4845 4420 3d20 2266 6f6e 742d  RETCHED = "font-
+0001f4a0: 7374 7265 7463 6865 6422 0a20 2020 2046  stretched".    F
+0001f4b0: 4f4e 545f 5745 4947 4854 203d 2022 666f  ONT_WEIGHT = "fo
+0001f4c0: 6e74 2d77 6569 6768 7422 0a20 2020 2048  nt-weight".    H
+0001f4d0: 4549 4748 5420 3d20 2268 6569 6768 7422  EIGHT = "height"
+0001f4e0: 0a20 2020 2049 5441 4c49 4320 3d20 2269  .    ITALIC = "i
+0001f4f0: 7461 6c69 6322 0a20 2020 204c 4546 5420  talic".    LEFT 
+0001f500: 3d20 226c 6566 7422 0a20 2020 204c 4947  = "left".    LIG
+0001f510: 4854 203d 2022 6c69 6768 7422 0a20 2020  HT = "light".   
+0001f520: 204e 4f52 4d41 4c20 3d20 226e 6f72 6d61   NORMAL = "norma
+0001f530: 6c22 0a20 2020 204f 5041 4349 5459 203d  l".    OPACITY =
+0001f540: 2022 6f70 6163 6974 7922 0a20 2020 2050   "opacity".    P
+0001f550: 4f53 4954 494f 4e20 3d20 2270 6f73 6974  OSITION = "posit
+0001f560: 696f 6e22 0a20 2020 2050 5820 3d20 2270  ion".    PX = "p
+0001f570: 7822 0a20 2020 2053 5459 4c45 203d 2022  x".    STYLE = "
+0001f580: 7374 796c 6522 0a20 2020 2054 4f50 203d  style".    TOP =
+0001f590: 2022 746f 7022 0a20 2020 2057 4944 5448   "top".    WIDTH
+0001f5a0: 203d 2022 7769 6474 6822 0a0a 2020 2020   = "width"..    
+0001f5b0: 5745 4947 4854 5f52 4520 3d20 2228 5b2d  WEIGHT_RE = "([-
+0001f5c0: 2e5d 3f42 6f6c 647c 5b2e 5d5b 4262 5d24  .]?Bold|[.][Bb]$
+0001f5d0: 2922 0a20 2020 2053 5459 4c45 5f52 4520  )".    STYLE_RE 
+0001f5e0: 3d20 2228 5b2d 2e5d 3f49 7461 6c28 3a3f  = "([-.]?Ital(:?
+0001f5f0: 6963 297c 5b2d 2e5d 3f4f 626c 6971 7565  ic)|[-.]?Oblique
+0001f600: 7c5b 2e5d 5b49 695d 2429 220a 0a20 2020  |[.][Ii]$)"..   
+0001f610: 2054 4558 545f 5354 594c 455f 434f 4d50   TEXT_STYLE_COMP
+0001f620: 4f4e 454e 5453 203d 205b 464f 4e54 5f53  ONENTS = [FONT_S
+0001f630: 5459 4c45 2c20 464f 4e54 5f57 4549 4748  TYLE, FONT_WEIGH
+0001f640: 542c 2046 4f4e 545f 4641 4d49 4c59 2c20  T, FONT_FAMILY, 
+0001f650: 464f 4e54 5f53 495a 452c 2043 4f4c 4f52  FONT_SIZE, COLOR
+0001f660: 2c20 4f50 4143 4954 595d 0a0a 2020 2020  , OPACITY]..    
+0001f670: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+0001f680: 6629 3a0a 2020 2020 2020 2020 7365 6c66  f):.        self
+0001f690: 2e6e 616d 655f 7661 6c75 655f 6469 6374  .name_value_dict
+0001f6a0: 203d 2064 6963 7428 290a 0a20 2020 2064   = dict()..    d
+0001f6b0: 6566 205f 5f73 7472 5f5f 2873 656c 6629  ef __str__(self)
+0001f6c0: 3a0a 2020 2020 2020 2020 7320 3d20 2222  :.        s = ""
+0001f6d0: 0a20 2020 2020 2020 2066 6f72 206b 2c20  .        for k, 
+0001f6e0: 7620 696e 2073 656c 662e 6e61 6d65 5f76  v in self.name_v
+0001f6f0: 616c 7565 5f64 6963 742e 6974 656d 7328  alue_dict.items(
+0001f700: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
+0001f710: 202b 3d20 6622 7b6b 7d3a 7b76 7d3b 2022   += f"{k}:{v}; "
+0001f720: 0a20 2020 2020 2020 2073 203d 2073 2e73  .        s = s.s
+0001f730: 7472 6970 2829 0a20 2020 2020 2020 2072  trip().        r
+0001f740: 6574 7572 6e20 730a 0a20 2020 2064 6566  eturn s..    def
+0001f750: 205f 5f72 6570 725f 5f28 7365 6c66 293a   __repr__(self):
+0001f760: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001f770: 6622 7b73 656c 662e 6e61 6d65 5f76 616c  f"{self.name_val
+0001f780: 7565 5f64 6963 747d 220a 0a23 2020 2020  ue_dict}"..#    
+0001f790: 636c 6173 7320 4353 5353 7479 6c65 3a0a  class CSSStyle:.
+0001f7a0: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+0001f7b0: 640a 2020 2020 6465 6620 6372 6561 7465  d.    def create
+0001f7c0: 5f63 7373 5f73 7479 6c65 5f66 726f 6d5f  _css_style_from_
+0001f7d0: 6174 7472 6962 7574 655f 6f66 5f62 6f64  attribute_of_bod
+0001f7e0: 795f 656c 656d 656e 7428 636c 732c 2065  y_element(cls, e
+0001f7f0: 6c65 6d29 3a0a 2020 2020 2020 2020 2222  lem):.        ""
+0001f800: 2263 7265 6174 6520 4353 5353 7479 6c65  "create CSSStyle
+0001f810: 206f 626a 6563 7420 6672 6f6d 2065 6c65   object from ele
+0001f820: 6d0a 2020 2020 2020 2020 3a70 6172 616d  m.        :param
+0001f830: 2065 6c65 6d3a 0a20 2020 2020 2020 2022   elem:.        "
+0001f840: 2222 0a20 2020 2020 2020 2069 6620 656c  "".        if el
+0001f850: 656d 2069 7320 4e6f 6e65 3a0a 2020 2020  em is None:.    
+0001f860: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+0001f870: 6f6e 650a 2020 2020 2020 2020 6173 7365  one.        asse
+0001f880: 7274 2074 7970 6528 656c 656d 2920 6973  rt type(elem) is
+0001f890: 205f 456c 656d 656e 742c 2066 2266 6f75   _Element, f"fou
+0001f8a0: 6e64 207b 7479 7065 2865 6c65 6d29 7d22  nd {type(elem)}"
+0001f8b0: 0a20 2020 2020 2020 2063 7373 5f73 7479  .        css_sty
+0001f8c0: 6c65 203d 2043 5353 5374 796c 6528 290a  le = CSSStyle().
+0001f8d0: 2020 2020 2020 2020 7374 796c 655f 6174          style_at
+0001f8e0: 7476 616c 203d 2065 6c65 6d2e 6765 7428  tval = elem.get(
+0001f8f0: 4353 5353 7479 6c65 2e53 5459 4c45 290a  CSSStyle.STYLE).
+0001f900: 2020 2020 2020 2020 6373 735f 7374 796c          css_styl
+0001f910: 652e 6e61 6d65 5f76 616c 7565 5f64 6963  e.name_value_dic
+0001f920: 7420 3d20 636c 732e 6372 6561 7465 5f64  t = cls.create_d
+0001f930: 6963 745f 6672 6f6d 5f6e 616d 655f 7661  ict_from_name_va
+0001f940: 6c75 655f 6172 7261 795f 7374 7269 6e67  lue_array_string
+0001f950: 2873 7479 6c65 5f61 7474 7661 6c29 0a20  (style_attval). 
+0001f960: 2020 2020 2020 2072 6574 7572 6e20 6373         return cs
+0001f970: 735f 7374 796c 650a 0a20 2020 2023 2020  s_style..    #  
+0001f980: 2020 636c 6173 7320 4353 5353 7479 6c65    class CSSStyle
+0001f990: 3a0a 0a20 2020 2040 636c 6173 736d 6574  :..    @classmet
+0001f9a0: 686f 640a 2020 2020 6465 6620 6372 6561  hod.    def crea
+0001f9b0: 7465 5f64 6963 745f 6672 6f6d 5f6e 616d  te_dict_from_nam
+0001f9c0: 655f 7661 6c75 655f 6172 7261 795f 7374  e_value_array_st
+0001f9d0: 7269 6e67 2863 6c73 2c20 7374 796c 655f  ring(cls, style_
+0001f9e0: 7374 722c 2072 656d 6f76 655f 6375 726c  str, remove_curl
+0001f9f0: 793d 5472 7565 293a 0a20 2020 2020 2020  y=True):.       
+0001fa00: 2022 2222 0a20 2020 2020 2020 2061 7373   """.        ass
+0001fa10: 756d 6573 2073 7472 696e 6720 6f66 2074  umes string of t
+0001fa20: 7970 6520 2261 3a20 623b 2063 3a20 643b  ype "a: b; c: d;
+0001fa30: 2220 6f70 7469 6f6e 616c 6c79 2065 6e63  " optionally enc
+0001fa40: 6c6f 7365 6420 696e 207b 2e2e 2e7d 0a20  losed in {...}. 
+0001fa50: 2020 2020 2020 203a 7061 7261 6d20 7374         :param st
+0001fa60: 796c 655f 7374 723a 200a 2020 2020 2020  yle_str: .      
+0001fa70: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
+0001fa80: 5f73 7472 203d 2022 283f 503c 7072 653e  _str = "(?P<pre>
+0001fa90: 2e2a 297b 283f 503c 6375 726c 793e 2e2a  .*){(?P<curly>.*
+0001faa0: 297d 283f 503c 706f 7374 3e2e 2a29 220a  )}(?P<post>.*)".
+0001fab0: 2020 2020 2020 2020 6375 726c 795f 7265          curly_re
+0001fac0: 203d 2072 652e 636f 6d70 696c 6528 7265   = re.compile(re
+0001fad0: 5f73 7472 290a 2020 2020 2020 2020 6e61  _str).        na
+0001fae0: 6d65 5f76 616c 7565 5f64 6963 7420 3d20  me_value_dict = 
+0001faf0: 6469 6374 2829 0a20 2020 2020 2020 2069  dict().        i
+0001fb00: 6620 7479 7065 2873 7479 6c65 5f73 7472  f type(style_str
+0001fb10: 2920 6973 2043 5353 5374 796c 653a 0a20  ) is CSSStyle:. 
+0001fb20: 2020 2020 2020 2020 2020 2073 7479 6c65             style
+0001fb30: 5f73 7472 203d 2073 7479 6c65 5f73 7472  _str = style_str
+0001fb40: 2e67 6574 5f63 7373 5f76 616c 7565 2873  .get_css_value(s
+0001fb50: 7479 6c65 5f73 7472 290a 2020 2020 2020  tyle_str).      
+0001fb60: 2020 6966 2073 7479 6c65 5f73 7472 3a0a    if style_str:.
+0001fb70: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+0001fb80: 656d 6f76 655f 6375 726c 793a 0a20 2020  emove_curly:.   
+0001fb90: 2020 2020 2020 2020 2020 2020 206d 6174               mat
+0001fba0: 6368 203d 2063 7572 6c79 5f72 652e 6d61  ch = curly_re.ma
+0001fbb0: 7463 6828 7374 796c 655f 7374 7229 0a20  tch(style_str). 
+0001fbc0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001fbd0: 6620 6d61 7463 683a 0a20 2020 2020 2020  f match:.       
+0001fbe0: 2020 2020 2020 2020 2020 2020 2073 7479               sty
+0001fbf0: 6c65 5f73 7472 203d 206d 6174 6368 2e67  le_str = match.g
+0001fc00: 726f 7570 2822 6375 726c 7922 290a 2020  roup("curly").  
+0001fc10: 2020 2020 2020 2020 2020 6e61 6d65 5f76            name_v
+0001fc20: 616c 7565 5f64 6963 7420 3d20 636c 732e  alue_dict = cls.
+0001fc30: 6372 6561 7465 5f6e 616d 655f 7661 6c75  create_name_valu
+0001fc40: 655f 6469 6374 2873 7479 6c65 5f73 7472  e_dict(style_str
+0001fc50: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0001fc60: 206e 616d 655f 7661 6c75 655f 6469 6374   name_value_dict
+0001fc70: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
+0001fc80: 6f64 0a20 2020 2064 6566 2063 7265 6174  od.    def creat
+0001fc90: 655f 6e61 6d65 5f76 616c 7565 5f64 6963  e_name_value_dic
+0001fca0: 7428 636c 732c 2073 7479 6c65 5f73 7472  t(cls, style_str
+0001fcb0: 293a 0a20 2020 2020 2020 206e 616d 655f  ):.        name_
+0001fcc0: 7661 6c75 655f 6469 6374 203d 2064 6963  value_dict = dic
+0001fcd0: 7428 290a 2020 2020 2020 2020 7374 796c  t().        styl
+0001fce0: 655f 7374 7220 3d20 7374 796c 655f 7374  e_str = style_st
+0001fcf0: 722e 7374 7269 7028 290a 2020 2020 2020  r.strip().      
+0001fd00: 2020 7374 796c 6573 203d 2073 7479 6c65    styles = style
+0001fd10: 5f73 7472 2e73 706c 6974 2822 3b22 290a  _str.split(";").
+0001fd20: 2020 2020 2020 2020 666f 7220 7374 796c          for styl
+0001fd30: 6520 696e 2073 7479 6c65 733a 0a20 2020  e in styles:.   
+0001fd40: 2020 2020 2020 2020 2073 7479 6c65 203d           style =
+0001fd50: 2073 7479 6c65 2e73 7472 6970 2829 0a20   style.strip(). 
+0001fd60: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+0001fd70: 6e28 7374 796c 6529 203e 2030 3a0a 2020  n(style) > 0:.  
+0001fd80: 2020 2020 2020 2020 2020 2020 2020 7373                ss
+0001fd90: 203d 2073 7479 6c65 2e73 706c 6974 2822   = style.split("
+0001fda0: 3a22 290a 2020 2020 2020 2020 2020 2020  :").            
+0001fdb0: 2020 2020 6966 206c 656e 2873 7329 2021      if len(ss) !
+0001fdc0: 3d20 323a 0a20 2020 2020 2020 2020 2020  = 2:.           
+0001fdd0: 2020 2020 2020 2020 2072 6169 7365 204b           raise K
+0001fde0: 6579 4572 726f 7228 6622 6261 6420 7374  eyError(f"bad st
+0001fdf0: 796c 6520 7b73 7479 6c65 7d20 696e 2043  yle {style} in C
+0001fe00: 5353 3a20 7b73 7479 6c65 5f73 7472 7d22  SS: {style_str}"
+0001fe10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001fe20: 2020 6e61 6d65 203d 2073 735b 305d 2e73    name = ss[0].s
+0001fe30: 7472 6970 2829 0a20 2020 2020 2020 2020  trip().         
+0001fe40: 2020 2020 2020 2069 6620 6e61 6d65 2069         if name i
+0001fe50: 6e20 6e61 6d65 5f76 616c 7565 5f64 6963  n name_value_dic
+0001fe60: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+0001fe70: 2020 2020 2020 2072 6169 7365 204b 6579         raise Key
+0001fe80: 4572 726f 7228 6622 7b6e 616d 657d 2064  Error(f"{name} d
+0001fe90: 7570 6c69 6361 7465 6420 696e 2043 5353  uplicated in CSS
+0001fea0: 3a20 7b73 7479 6c65 5f73 7472 7d22 290a  : {style_str}").
+0001feb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fec0: 6e61 6d65 5f76 616c 7565 5f64 6963 745b  name_value_dict[
+0001fed0: 6e61 6d65 5d20 3d20 7373 5b31 5d2e 7374  name] = ss[1].st
+0001fee0: 7269 7028 290a 2020 2020 2020 2020 7265  rip().        re
+0001fef0: 7475 726e 206e 616d 655f 7661 6c75 655f  turn name_value_
+0001ff00: 6469 6374 0a0a 2020 2020 2320 2020 2063  dict..    #    c
+0001ff10: 6c61 7373 2043 5353 5374 796c 653a 0a0a  lass CSSStyle:..
+0001ff20: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+0001ff30: 0a20 2020 2064 6566 2063 7265 6174 655f  .    def create_
+0001ff40: 6373 735f 7374 796c 655f 6672 6f6d 5f63  css_style_from_c
+0001ff50: 7373 5f73 7472 696e 6728 636c 732c 2063  ss_string(cls, c
+0001ff60: 7373 5f73 7472 696e 672c 2072 656d 6f76  ss_string, remov
+0001ff70: 655f 7072 6566 6978 3d54 7275 6529 3a0a  e_prefix=True):.
+0001ff80: 2020 2020 2020 2020 2222 2263 7265 6174          """creat
+0001ff90: 6573 2043 5353 5374 796c 6520 6f62 6a65  es CSSStyle obje
+0001ffa0: 6374 2066 726f 6d20 4353 5320 7374 7269  ct from CSS stri
+0001ffb0: 6e67 2222 220a 2020 2020 2020 2020 6373  ng""".        cs
+0001ffc0: 735f 7374 796c 6520 3d20 4e6f 6e65 0a20  s_style = None. 
+0001ffd0: 2020 2020 2020 2069 6620 6373 735f 7374         if css_st
+0001ffe0: 7269 6e67 3a0a 2020 2020 2020 2020 2020  ring:.          
+0001fff0: 2020 6373 735f 7374 796c 6520 3d20 4353    css_style = CS
+00020000: 5353 7479 6c65 2829 0a20 2020 2020 2020  SStyle().       
+00020010: 2020 2020 2063 7373 5f73 7479 6c65 2e6e       css_style.n
+00020020: 616d 655f 7661 6c75 655f 6469 6374 203d  ame_value_dict =
+00020030: 2063 6c73 2e63 7265 6174 655f 6469 6374   cls.create_dict
+00020040: 5f66 726f 6d5f 6e61 6d65 5f76 616c 7565  _from_name_value
+00020050: 5f61 7272 6179 5f73 7472 696e 6728 6373  _array_string(cs
+00020060: 735f 7374 7269 6e67 290a 2020 2020 2020  s_string).      
+00020070: 2020 2020 2020 6966 2072 656d 6f76 655f        if remove_
+00020080: 7072 6566 6978 3a0a 2020 2020 2020 2020  prefix:.        
+00020090: 2020 2020 2020 2020 666f 6e74 5f66 616d          font_fam
+000200a0: 696c 7920 3d20 6373 735f 7374 796c 652e  ily = css_style.
+000200b0: 6e61 6d65 5f76 616c 7565 5f64 6963 742e  name_value_dict.
+000200c0: 6765 7428 4353 5353 7479 6c65 2e46 4f4e  get(CSSStyle.FON
+000200d0: 545f 4641 4d49 4c59 290a 2020 2020 2020  T_FAMILY).      
+000200e0: 2020 2020 2020 2020 2020 666f 6e74 5f66            font_f
+000200f0: 616d 696c 7931 203d 2041 6d69 466f 6e74  amily1 = AmiFont
+00020100: 2e74 7269 6d5f 7064 665f 7072 6566 6978  .trim_pdf_prefix
+00020110: 2866 6f6e 745f 6661 6d69 6c79 290a 2020  (font_family).  
+00020120: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00020130: 2066 6f6e 745f 6661 6d69 6c79 3120 616e   font_family1 an
+00020140: 6420 666f 6e74 5f66 616d 696c 7931 2021  d font_family1 !
+00020150: 3d20 666f 6e74 5f66 616d 696c 793a 0a20  = font_family:. 
+00020160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020170: 2020 2063 7373 5f73 7479 6c65 2e6e 616d     css_style.nam
+00020180: 655f 7661 6c75 655f 6469 6374 5b43 5353  e_value_dict[CSS
+00020190: 5374 796c 652e 464f 4e54 5f46 414d 494c  Style.FONT_FAMIL
+000201a0: 595d 203d 2066 6f6e 745f 6661 6d69 6c79  Y] = font_family
+000201b0: 310a 2020 2020 2020 2020 7265 7475 726e  1.        return
+000201c0: 2063 7373 5f73 7479 6c65 0a0a 2020 2020   css_style..    
+000201d0: 6465 6620 5f5f 6571 5f5f 2873 656c 662c  def __eq__(self,
+000201e0: 206f 7468 6572 293a 0a20 2020 2020 2020   other):.       
+000201f0: 2022 2222 0a20 2020 2020 2020 2074 6573   """.        tes
+00020200: 7473 2077 6865 7468 6572 2073 656c 6620  ts whether self 
+00020210: 616e 6420 6f74 6865 7220 6861 7665 2065  and other have e
+00020220: 7175 616c 2064 6963 7469 6f6e 6172 6965  qual dictionarie
+00020230: 730a 2020 2020 2020 2020 2222 220a 2020  s.        """.  
+00020240: 2020 2020 2020 6966 2074 7970 6528 6f74        if type(ot
+00020250: 6865 7229 2069 7320 4353 5353 7479 6c65  her) is CSSStyle
+00020260: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00020270: 7475 726e 2073 656c 662e 6e61 6d65 5f76  turn self.name_v
+00020280: 616c 7565 5f64 6963 7420 3d3d 206f 7468  alue_dict == oth
+00020290: 6572 2e6e 616d 655f 7661 6c75 655f 6469  er.name_value_di
+000202a0: 6374 0a20 2020 2020 2020 2072 6574 7572  ct.        retur
+000202b0: 6e20 4661 6c73 650a 0a0a 2020 2020 6465  n False...    de
+000202c0: 6620 7365 745f 6174 7472 6962 7574 6528  f set_attribute(
+000202d0: 7365 6c66 2c20 7072 6f70 6572 7479 2c20  self, property, 
+000202e0: 7661 6c75 6529 3a0a 2020 2020 2020 2020  value):.        
+000202f0: 2222 220a 2020 2020 2020 2020 7365 7473  """.        sets
+00020300: 206e 616d 652d 7661 6c75 6520 7061 6972   name-value pair
+00020310: 2069 6e20 4353 5353 7479 6c65 0a20 2020   in CSSStyle.   
+00020320: 2020 2020 2069 676e 6f72 6573 2065 6d70       ignores emp
+00020330: 7479 2076 616c 7565 7320 6f72 204e 6f6e  ty values or Non
+00020340: 650a 2020 2020 2020 2020 2222 220a 2020  e.        """.  
+00020350: 2020 2020 2020 6966 2076 616c 7565 2061        if value a
+00020360: 6e64 206c 656e 2873 7472 2876 616c 7565  nd len(str(value
+00020370: 2929 203e 2030 3a0a 2020 2020 2020 2020  )) > 0:.        
+00020380: 2020 2020 7365 6c66 2e6e 616d 655f 7661      self.name_va
+00020390: 6c75 655f 6469 6374 5b70 726f 7065 7274  lue_dict[propert
+000203a0: 795d 203d 2076 616c 7565 0a0a 2020 2020  y] = value..    
+000203b0: 6465 6620 7365 745f 6661 6d69 6c79 2873  def set_family(s
+000203c0: 656c 662c 2066 616d 696c 7929 3a0a 2020  elf, family):.  
+000203d0: 2020 2020 2020 6966 2066 616d 696c 793a        if family:
+000203e0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000203f0: 662e 7365 745f 6174 7472 6962 7574 6528  f.set_attribute(
+00020400: 4353 5353 7479 6c65 2e46 4f4e 545f 4641  CSSStyle.FONT_FA
+00020410: 4d49 4c59 2c20 6661 6d69 6c79 290a 0a20  MILY, family).. 
+00020420: 2020 2064 6566 2073 6574 5f66 6f6e 745f     def set_font_
+00020430: 7765 6967 6874 2873 656c 662c 2077 6569  weight(self, wei
+00020440: 6768 7429 3a0a 2020 2020 2020 2020 7765  ght):.        we
+00020450: 6967 6874 203d 2077 6569 6768 742e 6c6f  ight = weight.lo
+00020460: 7765 7228 290a 2020 2020 2020 2020 6966  wer().        if
+00020470: 2077 6569 6768 743a 0a20 2020 2020 2020   weight:.       
+00020480: 2020 2020 2069 6620 7765 6967 6874 203d       if weight =
+00020490: 3d20 4353 5353 7479 6c65 2e4e 4f52 4d41  = CSSStyle.NORMA
+000204a0: 4c3a 0a20 2020 2020 2020 2020 2020 2020  L:.             
+000204b0: 2020 2073 656c 662e 7365 745f 6174 7472     self.set_attr
+000204c0: 6962 7574 6528 4353 5353 7479 6c65 2e46  ibute(CSSStyle.F
+000204d0: 4f4e 545f 5745 4947 4854 2c20 4353 5353  ONT_WEIGHT, CSSS
+000204e0: 7479 6c65 2e4e 4f52 4d41 4c29 0a20 2020  tyle.NORMAL).   
+000204f0: 2020 2020 2020 2020 2069 6620 7765 6967           if weig
+00020500: 6874 203d 3d20 4353 5353 7479 6c65 2e42  ht == CSSStyle.B
+00020510: 4f4c 443a 0a20 2020 2020 2020 2020 2020  OLD:.           
+00020520: 2020 2020 2073 656c 662e 7365 745f 6174       self.set_at
+00020530: 7472 6962 7574 6528 4353 5353 7479 6c65  tribute(CSSStyle
+00020540: 2e46 4f4e 545f 5745 4947 4854 2c20 4353  .FONT_WEIGHT, CS
+00020550: 5353 7479 6c65 2e42 4f4c 4429 0a20 2020  SStyle.BOLD).   
+00020560: 2020 2020 2020 2020 2069 6620 7765 6967           if weig
+00020570: 6874 203d 3d20 4353 5353 7479 6c65 2e4c  ht == CSSStyle.L
+00020580: 4947 4854 3a0a 2020 2020 2020 2020 2020  IGHT:.          
+00020590: 2020 2020 2020 7365 6c66 2e73 6574 5f61        self.set_a
+000205a0: 7474 7269 6275 7465 2843 5353 5374 796c  ttribute(CSSStyl
+000205b0: 652e 464f 4e54 5f57 4549 4748 542c 2043  e.FONT_WEIGHT, C
+000205c0: 5353 5374 796c 652e 4c49 4748 5429 0a0a  SSStyle.LIGHT)..
+000205d0: 2020 2020 6465 6620 7365 745f 666f 6e74      def set_font
+000205e0: 5f73 7479 6c65 2873 656c 662c 2073 7479  _style(self, sty
+000205f0: 6c65 293a 0a20 2020 2020 2020 2069 6620  le):.        if 
+00020600: 7374 796c 653a 0a20 2020 2020 2020 2020  style:.         
+00020610: 2020 2069 6620 7374 796c 652e 6c6f 7765     if style.lowe
+00020620: 7228 2920 3d3d 2043 5353 5374 796c 652e  r() == CSSStyle.
+00020630: 4e4f 524d 414c 2e6c 6f77 6572 2829 3a0a  NORMAL.lower():.
+00020640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020650: 7365 6c66 2e73 6574 5f61 7474 7269 6275  self.set_attribu
+00020660: 7465 2843 5353 5374 796c 652e 464f 4e54  te(CSSStyle.FONT
+00020670: 5f53 5459 4c45 2c20 4353 5353 7479 6c65  _STYLE, CSSStyle
+00020680: 2e4e 4f52 4d41 4c29 0a20 2020 2020 2020  .NORMAL).       
+00020690: 2020 2020 2069 6620 7374 796c 652e 6c6f       if style.lo
+000206a0: 7765 7228 2920 3d3d 2043 5353 5374 796c  wer() == CSSStyl
+000206b0: 652e 4954 414c 4943 2e6c 6f77 6572 2829  e.ITALIC.lower()
+000206c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000206d0: 2020 7365 6c66 2e73 6574 5f61 7474 7269    self.set_attri
+000206e0: 6275 7465 2843 5353 5374 796c 652e 464f  bute(CSSStyle.FO
+000206f0: 4e54 5f53 5459 4c45 2c20 4353 5353 7479  NT_STYLE, CSSSty
+00020700: 6c65 2e49 5441 4c49 4329 0a0a 2020 2020  le.ITALIC)..    
+00020710: 6465 6620 6765 745f 6174 7472 6962 7574  def get_attribut
+00020720: 6528 7365 6c66 2c20 7072 6f70 6572 7479  e(self, property
+00020730: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+00020740: 2020 2020 2020 2067 6574 7320 7661 6c75         gets valu
+00020750: 6520 666f 7220 6e61 6d65 2069 6e20 4353  e for name in CS
+00020760: 5353 7479 6c65 0a20 2020 2020 2020 2069  SStyle.        i
+00020770: 676e 6f72 6573 2065 6d70 7479 2076 616c  gnores empty val
+00020780: 7565 7320 6f72 204e 6f6e 650a 2020 2020  ues or None.    
+00020790: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000207a0: 7265 7475 726e 2073 656c 662e 6e61 6d65  return self.name
+000207b0: 5f76 616c 7565 5f64 6963 7420 616e 6420  _value_dict and 
+000207c0: 7365 6c66 2e6e 616d 655f 7661 6c75 655f  self.name_value_
+000207d0: 6469 6374 2e67 6574 2870 726f 7065 7274  dict.get(propert
+000207e0: 7929 0a0a 2020 2020 2320 2020 2063 6c61  y)..    #    cla
+000207f0: 7373 2043 5353 5374 796c 653a 0a0a 2020  ss CSSStyle:..  
+00020800: 2020 6465 6620 6765 745f 666f 6e74 5f73    def get_font_s
+00020810: 7479 6c65 5f61 7474 7269 6275 7465 7328  tyle_attributes(
+00020820: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+00020830: 2222 0a20 2020 2020 2020 2067 6574 7320  "".        gets 
+00020840: 7475 706c 6520 6f66 2034 2066 6f6e 7420  tuple of 4 font 
+00020850: 6174 7472 6962 7574 6573 2028 7369 7a65  attributes (size
+00020860: 2c20 6e6f 6e73 7472 6f6b 652c 2073 7472  , nonstroke, str
+00020870: 6f6b 652c 2066 6f6e 746e 616d 6529 0a20  oke, fontname). 
+00020880: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+00020890: 2020 2020 6966 2073 656c 662e 6e61 6d65      if self.name
+000208a0: 5f76 616c 7565 5f64 6963 7420 6973 204e  _value_dict is N
+000208b0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+000208c0: 2072 6574 7572 6e20 284e 6f6e 652c 204e   return (None, N
+000208d0: 6f6e 652c 204e 6f6e 652c 204e 6f6e 652c  one, None, None,
+000208e0: 204e 6f6e 6529 0a20 2020 2020 2020 2072   None).        r
+000208f0: 6574 7572 6e20 280a 2020 2020 2020 2020  eturn (.        
+00020900: 2020 2020 2320 7365 6c66 2e6e 616d 655f      # self.name_
+00020910: 7661 6c75 655f 6469 6374 2e67 6574 2843  value_dict.get(C
+00020920: 5353 5374 796c 652e 5749 4454 4829 2c0a  SSStyle.WIDTH),.
+00020930: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00020940: 2e67 6574 5f61 7474 7269 6275 7465 2843  .get_attribute(C
+00020950: 5353 5374 796c 652e 464f 4e54 5f53 495a  SSStyle.FONT_SIZ
+00020960: 4529 2c0a 2020 2020 2020 2020 2020 2020  E),.            
+00020970: 7365 6c66 2e67 6574 5f61 7474 7269 6275  self.get_attribu
+00020980: 7465 2843 5353 5374 796c 652e 4649 4c4c  te(CSSStyle.FILL
+00020990: 292c 0a20 2020 2020 2020 2020 2020 2073  ),.            s
+000209a0: 656c 662e 6765 745f 6174 7472 6962 7574  elf.get_attribut
+000209b0: 6528 4353 5353 7479 6c65 2e53 5452 4f4b  e(CSSStyle.STROK
+000209c0: 4529 2c0a 2020 2020 2020 2020 2020 2020  E),.            
+000209d0: 7365 6c66 2e67 6574 5f61 7474 7269 6275  self.get_attribu
+000209e0: 7465 2843 5353 5374 796c 652e 464f 4e54  te(CSSStyle.FONT
+000209f0: 5f46 414d 494c 5929 0a20 2020 2020 2020  _FAMILY).       
+00020a00: 2029 0a0a 2020 2020 2320 2020 2063 6c61   )..    #    cla
+00020a10: 7373 2043 5353 5374 796c 653a 0a0a 2020  ss CSSStyle:..  
+00020a20: 2020 6465 6620 7265 6d6f 7665 2873 656c    def remove(sel
+00020a30: 662c 206e 616d 6529 3a0a 2020 2020 2020  f, name):.      
+00020a40: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
+00020a50: 6d6f 7665 7320 6e61 6d65 6420 6974 656d  moves named item
+00020a60: 2066 726f 6d20 4353 5353 7479 6c65 0a20   from CSSStyle. 
+00020a70: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00020a80: 2020 2069 6620 7479 7065 286e 616d 6529     if type(name)
+00020a90: 2069 7320 6c69 7374 3a0a 2020 2020 2020   is list:.      
+00020aa0: 2020 2020 2020 666f 7220 6e20 696e 206e        for n in n
+00020ab0: 616d 653a 0a20 2020 2020 2020 2020 2020  ame:.           
+00020ac0: 2020 2020 2073 656c 662e 7265 6d6f 7665       self.remove
+00020ad0: 286e 290a 2020 2020 2020 2020 656c 6966  (n).        elif
+00020ae0: 206e 616d 6520 696e 2073 656c 662e 6e61   name in self.na
+00020af0: 6d65 5f76 616c 7565 5f64 6963 743a 0a20  me_value_dict:. 
+00020b00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00020b10: 6e61 6d65 5f76 616c 7565 5f64 6963 742e  name_value_dict.
+00020b20: 706f 7028 6e61 6d65 2c20 4e6f 6e65 290a  pop(name, None).
+00020b30: 0a20 2020 2064 6566 2061 7070 6c79 5f74  .    def apply_t
+00020b40: 6f28 7365 6c66 2c20 656c 656d 293a 0a20  o(self, elem):. 
+00020b50: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+00020b60: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00020b70: 6373 735f 7374 7220 3d20 7365 6c66 2e67  css_str = self.g
+00020b80: 6574 5f63 7373 5f76 616c 7565 2829 0a20  et_css_value(). 
+00020b90: 2020 2020 2020 2065 6c65 6d2e 6174 7472         elem.attr
+00020ba0: 6962 5b43 5353 5374 796c 652e 5354 594c  ib[CSSStyle.STYL
+00020bb0: 455d 203d 2063 7373 5f73 7472 0a0a 2020  E] = css_str..  
+00020bc0: 2020 2320 2020 2063 6c61 7373 2043 5353    #    class CSS
+00020bd0: 5374 796c 653a 0a0a 2020 2020 6465 6620  Style:..    def 
+00020be0: 6765 745f 6373 735f 7661 6c75 6528 7365  get_css_value(se
+00020bf0: 6c66 2c20 7772 6170 5f77 6974 685f 6375  lf, wrap_with_cu
+00020c00: 726c 793d 4661 6c73 6529 3a0a 2020 2020  rly=False):.    
+00020c10: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00020c20: 6765 6e65 7261 7465 7320 6373 7320 7374  generates css st
+00020c30: 7269 6e67 2077 6974 686f 7574 2071 756f  ring without quo
+00020c40: 7465 6420 6e61 6d65 7320 616e 6420 7661  ted names and va
+00020c50: 6c75 6573 0a20 2020 2020 2020 203a 7061  lues.        :pa
+00020c60: 7261 6d20 7772 6170 5f77 6974 685f 6375  ram wrap_with_cu
+00020c70: 726c 793a 2069 6620 7472 7565 2065 6e63  rly: if true enc
+00020c80: 6c6f 7365 2073 7472 696e 6720 696e 2022  lose string in "
+00020c90: 7b22 202e 2e2e 2022 7d22 0a20 2020 2020  {" ... "}".     
+00020ca0: 2020 2022 2222 0a20 2020 2020 2020 2073     """.        s
+00020cb0: 203d 2022 220a 2020 2020 2020 2020 666f   = "".        fo
+00020cc0: 7220 6b65 7920 696e 2073 656c 662e 6e61  r key in self.na
+00020cd0: 6d65 5f76 616c 7565 5f64 6963 743a 0a20  me_value_dict:. 
+00020ce0: 2020 2020 2020 2020 2020 2076 616c 203d             val =
+00020cf0: 2073 656c 662e 6e61 6d65 5f76 616c 7565   self.name_value
+00020d00: 5f64 6963 745b 6b65 795d 0a20 2020 2020  _dict[key].     
+00020d10: 2020 2020 2020 2073 202b 3d20 6b65 7920         s += key 
+00020d20: 2b20 223a 2022 202b 2073 7472 2876 616c  + ": " + str(val
+00020d30: 2920 2b20 223b 2022 0a20 2020 2020 2020  ) + "; ".       
+00020d40: 2073 203d 2073 2e73 7472 6970 2829 0a20   s = s.strip(). 
+00020d50: 2020 2020 2020 2072 6574 7572 6e20 227b         return "{
+00020d60: 2220 2b20 7320 2b20 227d 2220 6966 2077  " + s + "}" if w
+00020d70: 7261 705f 7769 7468 5f63 7572 6c79 2065  rap_with_curly e
+00020d80: 6c73 6520 730a 0a20 2020 2064 6566 2061  lse s..    def a
+00020d90: 7474 7661 6c28 7365 6c66 2c20 6e61 6d65  ttval(self, name
+00020da0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+00020db0: 6e20 7365 6c66 2e6e 616d 655f 7661 6c75  n self.name_valu
+00020dc0: 655f 6469 6374 2e67 6574 286e 616d 6529  e_dict.get(name)
+00020dd0: 2069 6620 7365 6c66 2e6e 616d 655f 7661   if self.name_va
+00020de0: 6c75 655f 6469 6374 2065 6c73 6520 4e6f  lue_dict else No
+00020df0: 6e65 0a0a 2020 2020 2320 2020 2063 6c61  ne..    #    cla
+00020e00: 7373 2043 5353 5374 796c 653a 0a0a 2020  ss CSSStyle:..  
+00020e10: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
+00020e20: 6465 6620 666f 6e74 5f66 616d 696c 7928  def font_family(
+00020e30: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
+00020e40: 6574 7572 6e20 7365 6c66 2e61 7474 7661  eturn self.attva
+00020e50: 6c28 4353 5353 7479 6c65 2e46 4f4e 545f  l(CSSStyle.FONT_
+00020e60: 4641 4d49 4c59 290a 0a20 2020 2040 7072  FAMILY)..    @pr
+00020e70: 6f70 6572 7479 0a20 2020 2064 6566 2074  operty.    def t
+00020e80: 6f70 2873 656c 6629 3a0a 2020 2020 2020  op(self):.      
+00020e90: 2020 7265 7475 726e 2073 656c 662e 6765    return self.ge
+00020ea0: 745f 6e75 6d65 7269 635f 6174 7476 616c  t_numeric_attval
+00020eb0: 2843 5353 5374 796c 652e 544f 5029 0a0a  (CSSStyle.TOP)..
+00020ec0: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
+00020ed0: 2020 6465 6620 666f 6e74 5f73 697a 6528    def font_size(
+00020ee0: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
+00020ef0: 6574 7572 6e20 7365 6c66 2e67 6574 5f6e  eturn self.get_n
+00020f00: 756d 6572 6963 5f61 7474 7661 6c28 4353  umeric_attval(CS
+00020f10: 5353 7479 6c65 2e46 4f4e 545f 5349 5a45  SStyle.FONT_SIZE
+00020f20: 290a 0a20 2020 2040 7072 6f70 6572 7479  )..    @property
+00020f30: 0a20 2020 2064 6566 2069 735f 626f 6c64  .    def is_bold
+00020f40: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00020f50: 7765 6967 6874 203d 2073 656c 662e 6174  weight = self.at
+00020f60: 7476 616c 2843 5353 5374 796c 652e 464f  tval(CSSStyle.FO
+00020f70: 4e54 5f57 4549 4748 5429 0a20 2020 2020  NT_WEIGHT).     
+00020f80: 2020 2072 6574 7572 6e20 7765 6967 6874     return weight
+00020f90: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
+00020fa0: 2077 6569 6768 742e 6c6f 7765 7228 2920   weight.lower() 
+00020fb0: 3d3d 2043 5353 5374 796c 652e 424f 4c44  == CSSStyle.BOLD
+00020fc0: 2e6c 6f77 6572 2829 0a0a 2020 2020 4070  .lower()..    @p
+00020fd0: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
+00020fe0: 6973 5f69 7461 6c69 6328 7365 6c66 293a  is_italic(self):
+00020ff0: 0a20 2020 2020 2020 2073 7479 6c65 203d  .        style =
+00021000: 2073 656c 662e 6174 7476 616c 2843 5353   self.attval(CSS
+00021010: 5374 796c 652e 464f 4e54 5f53 5459 4c45  Style.FONT_STYLE
+00021020: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00021030: 2073 7479 6c65 2069 7320 6e6f 7420 4e6f   style is not No
+00021040: 6e65 2061 6e64 2073 7479 6c65 2e6c 6f77  ne and style.low
+00021050: 6572 2829 203d 3d20 4353 5353 7479 6c65  er() == CSSStyle
+00021060: 2e49 5441 4c49 432e 6c6f 7765 7228 290a  .ITALIC.lower().
+00021070: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
+00021080: 2020 2064 6566 2062 6f74 746f 6d28 7365     def bottom(se
+00021090: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
+000210a0: 7572 6e20 7365 6c66 2e67 6574 5f6e 756d  urn self.get_num
+000210b0: 6572 6963 5f61 7474 7661 6c28 4353 5353  eric_attval(CSSS
+000210c0: 7479 6c65 2e42 4f54 544f 4d29 0a0a 2020  tyle.BOTTOM)..  
+000210d0: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
+000210e0: 6465 6620 6c65 6674 2873 656c 6629 3a0a  def left(self):.
+000210f0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00021100: 656c 662e 6765 745f 6e75 6d65 7269 635f  elf.get_numeric_
+00021110: 6174 7476 616c 2843 5353 5374 796c 652e  attval(CSSStyle.
+00021120: 4c45 4654 290a 0a20 2020 2023 2020 2020  LEFT)..    #    
+00021130: 636c 6173 7320 4353 5353 7479 6c65 3a0a  class CSSStyle:.
+00021140: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
+00021150: 2020 2064 6566 2077 6964 7468 2873 656c     def width(sel
+00021160: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
+00021170: 726e 2073 656c 662e 6765 745f 6e75 6d65  rn self.get_nume
+00021180: 7269 635f 6174 7476 616c 2843 5353 5374  ric_attval(CSSSt
+00021190: 796c 652e 5749 4454 4829 0a0a 2020 2020  yle.WIDTH)..    
+000211a0: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
+000211b0: 6620 6865 6967 6874 2873 656c 6629 3a0a  f height(self):.
+000211c0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+000211d0: 656c 662e 6765 745f 6e75 6d65 7269 635f  elf.get_numeric_
+000211e0: 6174 7476 616c 2843 5353 5374 796c 652e  attval(CSSStyle.
+000211f0: 4845 4947 4854 290a 0a20 2020 2023 2020  HEIGHT)..    #  
+00021200: 2020 636c 6173 7320 4353 5353 7479 6c65    class CSSStyle
+00021210: 3a0a 0a20 2020 2040 636c 6173 736d 6574  :..    @classmet
+00021220: 686f 640a 2020 2020 6465 6620 6164 645f  hod.    def add_
+00021230: 6e61 6d65 5f76 616c 7565 2863 6c73 2c20  name_value(cls, 
+00021240: 656c 656d 2c20 6373 735f 6e61 6d65 2c20  elem, css_name, 
+00021250: 6373 735f 7661 6c75 6529 3a0a 2020 2020  css_value):.    
+00021260: 2020 2020 2222 2275 7064 6174 6573 2073      """updates s
+00021270: 7479 6c65 206f 6e20 656c 656d 656e 740a  tyle on element.
+00021280: 2020 2020 2020 2020 3a70 6172 616d 2063          :param c
+00021290: 7373 5f6e 616d 653a 206e 616d 6520 6f66  ss_name: name of
+000212a0: 2070 726f 7065 7274 790a 2020 2020 2020   property.      
+000212b0: 2020 3a70 6172 616d 2063 7373 5f76 616c    :param css_val
+000212c0: 7565 3a20 7661 6c75 6520 6f66 2070 726f  ue: value of pro
+000212d0: 7065 7274 790a 2020 2020 2020 2020 2222  perty.        ""
+000212e0: 220a 2020 2020 2020 2020 6373 735f 7374  ".        css_st
+000212f0: 796c 6520 3d20 636c 732e 6372 6561 7465  yle = cls.create
+00021300: 5f63 7373 5f73 7479 6c65 5f66 726f 6d5f  _css_style_from_
+00021310: 6174 7472 6962 7574 655f 6f66 5f62 6f64  attribute_of_bod
+00021320: 795f 656c 656d 656e 7428 656c 656d 290a  y_element(elem).
+00021330: 2020 2020 2020 2020 6373 735f 7374 796c          css_styl
+00021340: 652e 6e61 6d65 5f76 616c 7565 5f64 6963  e.name_value_dic
+00021350: 745b 6373 735f 6e61 6d65 5d20 3d20 6373  t[css_name] = cs
+00021360: 735f 7661 6c75 650a 2020 2020 2020 2020  s_value.        
+00021370: 6373 735f 7374 796c 652e 6170 706c 795f  css_style.apply_
+00021380: 746f 2865 6c65 6d29 0a0a 2020 2020 6465  to(elem)..    de
+00021390: 6620 6765 745f 6e75 6d65 7269 635f 6174  f get_numeric_at
+000213a0: 7476 616c 2873 656c 662c 206e 616d 652c  tval(self, name,
+000213b0: 2064 6563 696d 616c 3d31 293a 0a20 2020   decimal=1):.   
+000213c0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000213d0: 2067 6574 7320 666c 6f61 7420 7661 6c75   gets float valu
+000213e0: 652c 2072 6f75 6e64 6564 2074 6f20 6465  e, rounded to de
+000213f0: 6d69 6361 6c20 706c 6162 6573 0a20 2020  mical plabes.   
+00021400: 2020 2020 203a 7061 7261 6d20 6e61 6d65       :param name
+00021410: 3a20 6f66 2070 6172 616d 6574 6572 0a20  : of parameter. 
+00021420: 2020 2020 2020 203a 7061 7261 6d20 726f         :param ro
+00021430: 756e 643a 206e 756d 6265 7220 6f66 2064  und: number of d
+00021440: 6563 696d 616c 2070 6c61 6365 7320 2864  ecimal places (d
+00021450: 6566 6175 6c74 2032 290a 2020 2020 2020  efault 2).      
+00021460: 2020 2222 220a 2020 2020 2020 2020 7661    """.        va
+00021470: 6c75 6520 3d20 7365 6c66 2e61 7474 7661  lue = self.attva
+00021480: 6c28 6e61 6d65 290a 2020 2020 2020 2020  l(name).        
+00021490: 6966 206e 6f74 2076 616c 7565 3a0a 2020  if not value:.  
+000214a0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000214b0: 204e 6f6e 650a 2020 2020 2020 2020 6966   None.        if
+000214c0: 2074 7970 6528 7661 6c75 6529 2069 7320   type(value) is 
+000214d0: 7374 723a 0a20 2020 2020 2020 2020 2020  str:.           
+000214e0: 2076 616c 7565 203d 2076 616c 7565 5b3a   value = value[:
+000214f0: 2d32 5d20 6966 2076 616c 7565 2e65 6e64  -2] if value.end
+00021500: 7377 6974 6828 4353 5353 7479 6c65 2e50  swith(CSSStyle.P
+00021510: 5829 2065 6c73 6520 7661 6c75 650a 2020  X) else value.  
+00021520: 2020 2020 2020 2020 2020 7661 6c75 6520            value 
+00021530: 3d20 666c 6f61 7428 7661 6c75 6529 0a0a  = float(value)..
+00021540: 2020 2020 2020 2020 6673 203d 2072 6f75          fs = rou
+00021550: 6e64 2866 6c6f 6174 2876 616c 7565 292c  nd(float(value),
+00021560: 2064 6563 696d 616c 290a 2020 2020 2020   decimal).      
+00021570: 2020 7265 7475 726e 2066 730a 0a20 2020    return fs..   
+00021580: 2023 2020 2020 636c 6173 7320 4353 5353   #    class CSSS
+00021590: 7479 6c65 3a0a 0a20 2020 2064 6566 2069  tyle:..    def i
+000215a0: 735f 626f 6c64 5f6e 616d 6528 7365 6c66  s_bold_name(self
+000215b0: 293a 0a20 2020 2020 2020 2022 2222 4865  ):.        """He
+000215c0: 7572 6973 7469 6320 7573 696e 6720 666f  uristic using fo
+000215d0: 6e74 2d6e 616d 650a 2020 2020 2020 2020  nt-name.        
+000215e0: 3a72 6574 7572 6e3a 2054 7275 6520 6966  :return: True if
+000215f0: 206e 616d 6520 636f 6e74 6169 6e73 2022   name contains "
+00021600: 426f 6c64 2220 6f72 2022 2e42 2220 6f72  Bold" or ".B" or
+00021610: 202e 2e22 2222 0a20 2020 2020 2020 2066   ..""".        f
+00021620: 6f6e 746e 616d 6520 3d20 7365 6c66 2e66  ontname = self.f
+00021630: 6f6e 745f 6661 6d69 6c79 0a20 2020 2020  ont_family.     
+00021640: 2020 2072 6573 756c 7420 3d20 2873 656c     result = (sel
+00021650: 662e 424f 4c44 2069 6e20 666f 6e74 6e61  f.BOLD in fontna
+00021660: 6d65 2920 6f72 2028 666f 6e74 6e61 6d65  me) or (fontname
+00021670: 2e65 6e64 7377 6974 6828 7365 6c66 2e44  .endswith(self.D
+00021680: 4f54 5f42 2929 2069 6620 666f 6e74 6e61  OT_B)) if fontna
+00021690: 6d65 2065 6c73 6520 4661 6c73 650a 2020  me else False.  
+000216a0: 2020 2020 2020 7265 7475 726e 2072 6573        return res
+000216b0: 756c 740a 0a20 2020 2023 2020 2020 636c  ult..    #    cl
+000216c0: 6173 7320 4353 5353 7479 6c65 3a0a 0a20  ass CSSStyle:.. 
+000216d0: 2020 2064 6566 206f 6265 7973 2873 656c     def obeys(sel
+000216e0: 662c 2063 6f6e 6469 7469 6f6e 293a 0a20  f, condition):. 
+000216f0: 2020 2020 2020 2022 2222 7465 7374 2069         """test i
+00021700: 6620 7374 796c 6520 6f62 6579 7320 6120  f style obeys a 
+00021710: 2873 696d 706c 6529 2063 6f6e 6469 7469  (simple) conditi
+00021720: 6f6e 0a20 2020 2020 2020 2028 4927 6c6c  on.        (I'll
+00021730: 2077 7269 7465 2061 2044 534c 206c 6174   write a DSL lat
+00021740: 6572 290a 2020 2020 2020 2020 3a70 6172  er).        :par
+00021750: 616d 2063 6f6e 6469 7469 6f6e 3a20 286e  am condition: (n
+00021760: 616d 652c 206f 7065 7261 746f 722c 2076  ame, operator, v
+00021770: 616c 7565 292c 2065 2e67 2e20 2266 6f6e  alue), e.g. "fon
+00021780: 742d 7369 7a65 3e31 300a 2020 2020 2020  t-size>10.      
+00021790: 2020 3a72 6574 7572 6e3a 2074 6573 7420    :return: test 
+000217a0: 6f66 2063 6f6e 6469 7469 6f6e 0a0a 2020  of condition..  
+000217b0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000217c0: 2020 7265 7375 6c74 203d 2046 616c 7365    result = False
+000217d0: 0a20 2020 2020 2020 2069 6620 636f 6e64  .        if cond
+000217e0: 6974 696f 6e3a 0a20 2020 2020 2020 2020  ition:.         
+000217f0: 2020 2073 7320 3d20 7265 2e73 706c 6974     ss = re.split
+00021800: 2827 283e 7c3c 7c3d 3d7c 213d 2927 2c20  ('(>|<|==|!=)', 
+00021810: 636f 6e64 6974 696f 6e29 0a20 2020 2020  condition).     
+00021820: 2020 2020 2020 2069 6620 6c65 6e28 7373         if len(ss
+00021830: 2920 213d 2033 3a0a 2020 2020 2020 2020  ) != 3:.        
+00021840: 2020 2020 2020 2020 6c6f 6767 696e 672e          logging.
+00021850: 7761 726e 696e 6728 6622 4361 6e6e 6f74  warning(f"Cannot
+00021860: 2070 6172 7365 2061 7320 636f 6e64 6974   parse as condit
+00021870: 696f 6e20 7b63 6f6e 6469 7469 6f6e 7d22  ion {condition}"
+00021880: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+00021890: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000218a0: 2020 2020 6c68 7320 3d20 7373 5b30 5d2e      lhs = ss[0].
+000218b0: 7374 7269 7028 290a 2020 2020 2020 2020  strip().        
+000218c0: 2020 2020 2020 2020 7268 7320 3d20 7373          rhs = ss
+000218d0: 5b32 5d2e 7374 7269 7028 290a 0a20 2020  [2].strip()..   
+000218e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000218f0: 6c68 7320 6e6f 7420 696e 2073 656c 662e  lhs not in self.
+00021900: 6e61 6d65 5f76 616c 7565 5f64 6963 743a  name_value_dict:
+00021910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021920: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00021930: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00021940: 2020 7661 6c75 6531 203d 2073 656c 662e    value1 = self.
+00021950: 6e61 6d65 5f76 616c 7565 5f64 6963 742e  name_value_dict.
+00021960: 6765 7428 6c68 7329 0a20 2020 2020 2020  get(lhs).       
+00021970: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00021980: 7661 6c75 6531 3a0a 2020 2020 2020 2020  value1:.        
+00021990: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+000219a0: 696e 672e 7761 726e 696e 6728 6622 7b6c  ing.warning(f"{l
+000219b0: 6873 7d20 6e6f 7420 696e 2073 7479 6c65  hs} not in style
+000219c0: 2061 7474 7269 6275 7465 207b 7365 6c66   attribute {self
+000219d0: 2e6e 616d 655f 7661 6c75 655f 6469 6374  .name_value_dict
+000219e0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+000219f0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+00021a00: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+00021a10: 2020 2020 2069 6620 7661 6c75 6531 2e65       if value1.e
+00021a20: 6e64 7377 6974 6828 4353 5353 7479 6c65  ndswith(CSSStyle
+00021a30: 2e50 5829 3a0a 2020 2020 2020 2020 2020  .PX):.          
+00021a40: 2020 2020 2020 2020 2020 7661 6c75 6531            value1
+00021a50: 203d 2076 616c 7565 315b 3a2d 325d 0a20   = value1[:-2]. 
+00021a60: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00021a70: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00021a80: 2020 2020 2020 2020 7661 6c75 6531 203d          value1 =
+00021a90: 2066 6c6f 6174 2876 616c 7565 3129 0a20   float(value1). 
+00021aa0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00021ab0: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
+00021ac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021ad0: 2020 2020 206c 6f67 6769 6e67 2e77 6172       logging.war
+00021ae0: 6e69 6e67 2866 226e 6f74 2061 206e 756d  ning(f"not a num
+00021af0: 6265 7220 7b76 616c 7565 317d 2229 0a20  ber {value1}"). 
+00021b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021b10: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+00021b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021b30: 2069 6620 7268 732e 656e 6473 7769 7468   if rhs.endswith
+00021b40: 2843 5353 5374 796c 652e 5058 293a 0a20  (CSSStyle.PX):. 
+00021b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021b60: 2020 2072 6873 203d 2072 6873 5b3a 2d32     rhs = rhs[:-2
+00021b70: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00021b80: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00021b90: 2020 2020 2020 2020 2020 2076 616c 7565             value
+00021ba0: 3220 3d20 666c 6f61 7428 7268 7329 0a20  2 = float(rhs). 
+00021bb0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00021bc0: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
+00021bd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021be0: 2020 2020 206c 6f67 6769 6e67 2e77 6172       logging.war
+00021bf0: 6e69 6e67 2866 226e 6f74 2061 206e 756d  ning(f"not a num
+00021c00: 6265 7220 7b72 6873 7d22 290a 2020 2020  ber {rhs}").    
+00021c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021c20: 7265 7475 726e 2046 616c 7365 0a20 2020  return False.   
+00021c30: 2020 2020 2020 2020 2020 2020 206f 7065               ope
+00021c40: 7220 3d20 7373 5b31 5d0a 2020 2020 2020  r = ss[1].      
+00021c50: 2020 2020 2020 2020 2020 6966 206f 7065            if ope
+00021c60: 7220 3d3d 2022 3e22 3a0a 2020 2020 2020  r == ">":.      
+00021c70: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00021c80: 7375 6c74 203d 2076 616c 7565 3120 3e20  sult = value1 > 
+00021c90: 7661 6c75 6532 0a20 2020 2020 2020 2020  value2.         
+00021ca0: 2020 2020 2020 2065 6c69 6620 6f70 6572         elif oper
+00021cb0: 203d 3d20 223c 223a 0a20 2020 2020 2020   == "<":.       
+00021cc0: 2020 2020 2020 2020 2020 2020 2072 6573               res
+00021cd0: 756c 7420 3d20 7661 6c75 6531 203c 2076  ult = value1 < v
+00021ce0: 616c 7565 320a 2020 2020 2020 2020 2020  alue2.          
+00021cf0: 2020 2020 2020 656c 6966 206f 7065 7220        elif oper 
+00021d00: 3d3d 2022 213d 223a 0a20 2020 2020 2020  == "!=":.       
+00021d10: 2020 2020 2020 2020 2020 2020 2072 6573               res
+00021d20: 756c 7420 3d20 7661 6c75 6531 2021 3d20  ult = value1 != 
+00021d30: 7661 6c75 6532 0a20 2020 2020 2020 2020  value2.         
+00021d40: 2020 2020 2020 2065 6c69 6620 6f70 6572         elif oper
+00021d50: 203d 3d20 223d 3d22 3a0a 2020 2020 2020   == "==":.      
+00021d60: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00021d70: 7375 6c74 203d 2028 7661 6c75 6531 203d  sult = (value1 =
+00021d80: 3d20 7661 6c75 6532 290a 2020 2020 2020  = value2).      
+00021d90: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00021da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021db0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00021dc0: 7272 6f72 2866 2262 6164 206f 7065 7261  rror(f"bad opera
+00021dd0: 746f 723a 207b 6f70 6572 7d22 290a 2020  tor: {oper}").  
+00021de0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00021df0: 2072 6573 756c 743a 0a20 2020 2020 2020   result:.       
+00021e00: 2020 2020 2020 2020 2020 2020 2070 6173               pas
+00021e10: 730a 2020 2020 2020 2020 7265 7475 726e  s.        return
+00021e20: 2072 6573 756c 740a 0a20 2020 2023 2020   result..    #  
+00021e30: 2020 636c 6173 7320 4353 5353 7479 6c65    class CSSStyle
+00021e40: 3a0a 0a20 2020 2040 636c 6173 736d 6574  :..    @classmet
+00021e50: 686f 640a 2020 2020 6465 6620 636d 796b  hod.    def cmyk
+00021e60: 5f74 6f5f 7267 6228 636c 732c 2063 2c20  _to_rgb(cls, c, 
+00021e70: 6d2c 2079 2c20 6b29 3a0a 0a20 2020 2020  m, y, k):..     
+00021e80: 2020 2072 6762 5f73 6361 6c65 203d 2032     rgb_scale = 2
+00021e90: 3535 0a20 2020 2020 2020 2023 2063 6d79  55.        # cmy
+00021ea0: 6b5f 7363 616c 6520 3d20 3130 300a 2020  k_scale = 100.  
+00021eb0: 2020 2020 2020 636d 796b 5f73 6361 6c65        cmyk_scale
+00021ec0: 203d 2031 2e30 0a20 2020 2020 2020 2072   = 1.0.        r
+00021ed0: 203d 2072 6762 5f73 6361 6c65 202a 2028   = rgb_scale * (
+00021ee0: 312e 3020 2d20 2863 202b 206b 2920 2f20  1.0 - (c + k) / 
+00021ef0: 666c 6f61 7428 636d 796b 5f73 6361 6c65  float(cmyk_scale
+00021f00: 2929 0a20 2020 2020 2020 2067 203d 2072  )).        g = r
+00021f10: 6762 5f73 6361 6c65 202a 2028 312e 3020  gb_scale * (1.0 
+00021f20: 2d20 286d 202b 206b 2920 2f20 666c 6f61  - (m + k) / floa
+00021f30: 7428 636d 796b 5f73 6361 6c65 2929 0a20  t(cmyk_scale)). 
+00021f40: 2020 2020 2020 2062 203d 2072 6762 5f73         b = rgb_s
+00021f50: 6361 6c65 202a 2028 312e 3020 2d20 2879  cale * (1.0 - (y
+00021f60: 202b 206b 2920 2f20 666c 6f61 7428 636d   + k) / float(cm
+00021f70: 796b 5f73 6361 6c65 2929 0a0a 2020 2020  yk_scale))..    
+00021f80: 2020 2020 7265 7475 726e 2072 2c20 672c      return r, g,
+00021f90: 2062 0a0a 2020 2020 2320 2020 2063 6c61   b..    #    cla
+00021fa0: 7373 2043 5353 5374 796c 653a 0a0a 2020  ss CSSStyle:..  
+00021fb0: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+00021fc0: 2020 2064 6566 2063 6d6b 795f 746f 5f72     def cmky_to_r
+00021fd0: 6762 2863 6c73 2c20 632c 206d 2c20 6b2c  gb(cls, c, m, k,
+00021fe0: 2079 293a 0a20 2020 2020 2020 2072 6574   y):.        ret
+00021ff0: 7572 6e20 636c 732e 636d 796b 5f74 6f5f  urn cls.cmyk_to_
+00022000: 7267 6228 632c 206d 2c20 792c 206b 290a  rgb(c, m, y, k).
+00022010: 0a20 2020 2064 6566 2065 7874 7261 6374  .    def extract
+00022020: 5f62 6f6c 645f 6974 616c 6963 5f66 726f  _bold_italic_fro
+00022030: 6d5f 666f 6e74 5f66 616d 696c 7928 0a20  m_font_family(. 
+00022040: 2020 2020 2020 2020 2020 2073 656c 662c             self,
+00022050: 0a20 2020 2020 2020 2020 2020 206f 7665  .            ove
+00022060: 7277 7269 7465 5f62 6f6c 643d 4661 6c73  rwrite_bold=Fals
+00022070: 652c 0a20 2020 2020 2020 2020 2020 206f  e,.            o
+00022080: 7665 7277 7269 7465 5f73 7479 6c65 3d46  verwrite_style=F
+00022090: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
+000220a0: 2020 6f76 6572 7772 6974 655f 6661 6d69    overwrite_fami
+000220b0: 6c79 3d54 7275 652c 0a20 2020 2020 2020  ly=True,.       
+000220c0: 2020 2020 2073 7479 6c65 5f72 6567 6578       style_regex
+000220d0: 3d53 5459 4c45 5f52 452c 0a20 2020 2020  =STYLE_RE,.     
+000220e0: 2020 2020 2020 2077 6569 6768 745f 7265         weight_re
+000220f0: 6765 783d 5745 4947 4854 5f52 4529 3a0a  gex=WEIGHT_RE):.
+00022100: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00022110: 2020 2020 6865 7572 6973 7469 6373 2074      heuristics t
+00022120: 6f20 6669 6e64 2062 6f6c 6420 616e 6420  o find bold and 
+00022130: 6974 616c 6963 2069 6e20 666f 6e74 206e  italic in font n
+00022140: 616d 6573 2061 6e64 2074 7279 2074 6f20  ames and try to 
+00022150: 6e6f 726d 616c 6973 650a 2020 2020 2020  normalise.      
+00022160: 2020 652e 672e 0a20 2020 2020 2020 2066    e.g..        f
+00022170: 6f6e 742d 6661 6d69 6c79 3a20 5469 6d65  ont-family: Time
+00022180: 734e 6577 526f 6d61 6e50 532d 426f 6c64  sNewRomanPS-Bold
+00022190: 4d54 3b20 3d3e 2066 6f6e 742d 6661 6d69  MT; => font-fami
+000221a0: 6c79 3a20 5469 6d65 734e 6577 526f 6d61  ly: TimesNewRoma
+000221b0: 6e50 534d 543b 2066 6f6e 745f 7765 6967  nPSMT; font_weig
+000221c0: 6874 3a20 626f 6c64 0a20 2020 2020 2020  ht: bold.       
+000221d0: 2066 6f6e 742d 6661 6d69 6c79 3a20 5469   font-family: Ti
+000221e0: 6d65 734e 6577 526f 6d61 6e50 532d 4974  mesNewRomanPS-It
+000221f0: 616c 6963 4d54 3b20 3d3e 2066 6f6e 742d  alicMT; => font-
+00022200: 6661 6d69 6c79 3a20 5469 6d65 734e 6577  family: TimesNew
+00022210: 526f 6d61 6e50 534d 543b 2066 6f6e 745f  RomanPSMT; font_
+00022220: 7374 796c 653a 2069 7461 6c69 630a 2020  style: italic.  
+00022230: 2020 2020 2020 7468 6520 6f76 6572 7772        the overwr
+00022240: 6974 655f 2a20 6465 7465 726d 696e 6520  ite_* determine 
+00022250: 7768 6574 6568 7220 6578 6973 7469 6e67  whetehr existing
+00022260: 2063 6f6d 706f 6e65 6e74 7320 7769 6c6c   components will
+00022270: 2062 6520 6f76 6572 7772 6974 7465 6e0a   be overwritten.
+00022280: 2020 2020 2020 2020 3a70 6172 616d 206f          :param o
+00022290: 7665 7277 7269 7465 5f62 6f6c 643a 2063  verwrite_bold: c
+000222a0: 7265 6174 6520 666f 6e74 5f77 6569 6768  reate font_weigh
+000222b0: 743a 626f 6c64 2072 6567 6172 646c 6573  t:bold regardles
+000222c0: 7320 6f66 2070 7265 7669 6f75 7320 7765  s of previous we
+000222d0: 6967 6874 0a20 2020 2020 2020 203a 7061  ight.        :pa
+000222e0: 7261 6d20 6f76 6572 7772 6974 655f 7374  ram overwrite_st
+000222f0: 796c 653a 2063 7265 6174 6520 666f 6e74  yle: create font
+00022300: 5f73 7479 6c65 3a62 6f6c 6420 7265 6761  _style:bold rega
+00022310: 7264 6c65 7373 206f 6620 7072 6576 696f  rdless of previo
+00022320: 7573 2073 7479 6c65 0a20 2020 2020 2020  us style.       
+00022330: 203a 7061 7261 6d20 6f76 6572 7772 6974   :param overwrit
+00022340: 655f 6661 6d69 6c79 3a20 6564 6974 2066  e_family: edit f
+00022350: 6f6e 742d 6661 6d69 6c79 2074 6f20 7265  ont-family to re
+00022360: 6d6f 7665 2073 7479 6c65 2f77 6569 6768  move style/weigh
+00022370: 7420 696e 666f 2028 6861 636b 7929 0a20  t info (hacky). 
+00022380: 2020 2020 2020 203a 7061 7261 6d20 7374         :param st
+00022390: 796c 655f 7265 6765 783d 0a0a 2020 2020  yle_regex=..    
+000223a0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000223b0: 6661 6d69 6c79 203d 2073 656c 662e 666f  family = self.fo
+000223c0: 6e74 5f66 616d 696c 790a 2020 2020 2020  nt_family.      
+000223d0: 2020 6966 206e 6f74 2066 616d 696c 793a    if not family:
+000223e0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000223f0: 7572 6e0a 2020 2020 2020 2020 6661 6d69  urn.        fami
+00022400: 6c79 5f73 7479 6c65 2c20 7374 796c 6520  ly_style, style 
+00022410: 3d20 7365 6c66 2e6d 6174 6368 5f77 6569  = self.match_wei
+00022420: 6768 745f 7374 796c 6528 6661 6d69 6c79  ght_style(family
+00022430: 2c20 7374 796c 655f 7265 6765 782c 2076  , style_regex, v
+00022440: 616c 7565 3d22 4922 2c20 6d61 726b 3d22  alue="I", mark="
+00022450: 5353 2229 0a20 2020 2020 2020 2066 616d  SS").        fam
+00022460: 696c 795f 7765 6967 6874 2c20 7765 6967  ily_weight, weig
+00022470: 6874 203d 2073 656c 662e 6d61 7463 685f  ht = self.match_
+00022480: 7765 6967 6874 5f73 7479 6c65 2866 616d  weight_style(fam
+00022490: 696c 792c 2077 6569 6768 745f 7265 6765  ily, weight_rege
+000224a0: 782c 2076 616c 7565 3d22 4222 2c20 6d61  x, value="B", ma
+000224b0: 726b 3d22 5757 2229 0a20 2020 2020 2020  rk="WW").       
+000224c0: 2023 2070 7269 6e74 2866 2266 616d 696c   # print(f"famil
+000224d0: 793a 207b 6661 6d69 6c79 7d3b 2073 7479  y: {family}; sty
+000224e0: 6c65 3a20 7b73 7479 6c65 7d3b 2077 6569  le: {style}; wei
+000224f0: 6768 743a 207b 7765 6967 6874 7d3b 2229  ght: {weight};")
+00022500: 0a20 2020 2020 2020 2069 6620 6661 6d69  .        if fami
+00022510: 6c79 5f77 6569 6768 7420 616e 6420 6f76  ly_weight and ov
+00022520: 6572 7772 6974 655f 6661 6d69 6c79 3a0a  erwrite_family:.
+00022530: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00022540: 2e73 6574 5f66 616d 696c 7928 6661 6d69  .set_family(fami
+00022550: 6c79 5f77 6569 6768 7429 0a20 2020 2020  ly_weight).     
+00022560: 2020 2069 6620 7765 6967 6874 2061 6e64     if weight and
+00022570: 206f 7665 7277 7269 7465 5f62 6f6c 643a   overwrite_bold:
+00022580: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00022590: 662e 7365 745f 666f 6e74 5f77 6569 6768  f.set_font_weigh
+000225a0: 7428 7765 6967 6874 290a 2020 2020 2020  t(weight).      
+000225b0: 2020 6966 2073 7479 6c65 2061 6e64 206f    if style and o
+000225c0: 7665 7277 7269 7465 5f73 7479 6c65 3a0a  verwrite_style:.
+000225d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000225e0: 2e73 6574 5f66 6f6e 745f 7374 796c 6528  .set_font_style(
+000225f0: 7374 796c 6529 0a20 2020 2020 2020 2023  style).        #
+00022600: 2069 6620 7374 796c 6520 616e 6420 6f76   if style and ov
+00022610: 6572 7772 6974 655f 7374 7265 7463 6865  erwrite_stretche
+00022620: 643a 0a20 2020 2020 2020 2023 2020 2020  d:.        #    
+00022630: 2073 656c 662e 7365 745f 666f 6e74 5f73   self.set_font_s
+00022640: 7472 6574 6368 6564 2873 7479 6c65 290a  tretched(style).
+00022650: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
+00022660: 6622 6e65 7720 7374 796c 6520 7b73 656c  f"new style {sel
+00022670: 667d 2229 0a0a 0a20 2020 2023 2020 2020  f}")...    #    
+00022680: 636c 6173 7320 4353 5353 7479 6c65 3a0a  class CSSStyle:.
+00022690: 0a20 2020 2064 6566 206d 6174 6368 5f77  .    def match_w
+000226a0: 6569 6768 745f 7374 796c 6528 7365 6c66  eight_style(self
+000226b0: 2c20 6661 6d69 6c79 2c20 7765 6967 6874  , family, weight
+000226c0: 5f72 6567 6578 2c20 7661 6c75 653d 4e6f  _regex, value=No
+000226d0: 6e65 2c20 6d61 726b 3d4e 6f6e 6529 3a0a  ne, mark=None):.
+000226e0: 2020 2020 2020 2020 7765 6967 6874 5f72          weight_r
+000226f0: 6563 203d 2072 652e 636f 6d70 696c 6528  ec = re.compile(
+00022700: 7765 6967 6874 5f72 6567 6578 2920 6966  weight_regex) if
+00022710: 2077 6569 6768 745f 7265 6765 7820 656c   weight_regex el
+00022720: 7365 204e 6f6e 650a 2020 2020 2020 2020  se None.        
+00022730: 6d61 7463 6820 3d20 7765 6967 6874 5f72  match = weight_r
+00022740: 6563 2e73 6561 7263 6828 6661 6d69 6c79  ec.search(family
+00022750: 290a 2020 2020 2020 2020 6966 206d 6174  ).        if mat
+00022760: 6368 3a0a 2020 2020 2020 2020 2020 2020  ch:.            
+00022770: 7661 6c75 6520 3d20 6661 6d69 6c79 5b6d  value = family[m
+00022780: 6174 6368 2e73 7461 7274 2829 3a6d 6174  atch.start():mat
+00022790: 6368 2e65 6e64 2829 5d0a 2020 2020 2020  ch.end()].      
+000227a0: 2020 2020 2020 7661 6c75 6520 3d20 7661        value = va
+000227b0: 6c75 652e 7265 706c 6163 6528 222d 222c  lue.replace("-",
+000227c0: 2022 2229 2e72 6570 6c61 6365 2822 2e22   "").replace("."
+000227d0: 2c20 2222 290a 2020 2020 2020 2020 2020  , "").          
+000227e0: 2020 6661 6d69 6c79 203d 2066 616d 696c    family = famil
+000227f0: 795b 3a6d 6174 6368 2e73 7461 7274 2829  y[:match.start()
+00022800: 5d20 2b20 6661 6d69 6c79 5b6d 6174 6368  ] + family[match
+00022810: 2e65 6e64 2829 3a5d 0a20 2020 2020 2020  .end():].       
+00022820: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00022830: 2020 2076 616c 7565 203d 204e 6f6e 650a     value = None.
+00022840: 2020 2020 2020 2020 7265 7475 726e 2066          return f
+00022850: 616d 696c 792c 2076 616c 7565 0a0a 2020  amily, value..  
+00022860: 2020 2320 2020 2063 6c61 7373 2043 5353    #    class CSS
+00022870: 5374 796c 653a 0a0a 2020 2020 6465 6620  Style:..    def 
+00022880: 6372 6561 7465 5f62 626f 7828 7365 6c66  create_bbox(self
+00022890: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+000228a0: 2020 2020 2020 2063 7265 6174 6520 626f         create bo
+000228b0: 756e 6469 6e67 2062 6f78 2066 726f 6d20  unding box from 
+000228c0: 6c65 6674 2c20 7769 6474 682c 2074 6f70  left, width, top
+000228d0: 2c20 6865 6967 6874 0a20 2020 2020 2020  , height.       
+000228e0: 203a 7265 7475 726e 3a20 4e6f 6e65 2069   :return: None i
+000228f0: 6620 616e 7920 6174 7472 6962 7574 6573  f any attributes
+00022900: 206d 6973 7369 6e67 0a20 2020 2020 2020   missing.       
+00022910: 2022 2222 0a20 2020 2020 2020 2062 626f   """.        bbo
+00022920: 7820 3d20 4e6f 6e65 0a20 2020 2020 2020  x = None.       
+00022930: 2069 6620 7365 6c66 2e74 6f70 2069 7320   if self.top is 
+00022940: 6e6f 7420 4e6f 6e65 2061 6e64 2073 656c  not None and sel
+00022950: 662e 6865 6967 6874 2069 7320 6e6f 7420  f.height is not 
+00022960: 4e6f 6e65 2061 6e64 2073 656c 662e 6c65  None and self.le
+00022970: 6674 2069 7320 6e6f 7420 4e6f 6e65 2061  ft is not None a
+00022980: 6e64 2073 656c 662e 7769 6474 6820 6973  nd self.width is
+00022990: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+000229a0: 2020 2020 2020 2062 626f 7820 3d20 4242         bbox = BB
+000229b0: 6f78 2878 795f 7261 6e67 6573 3d5b 5b73  ox(xy_ranges=[[s
+000229c0: 656c 662e 6c65 6674 2c20 7365 6c66 2e6c  elf.left, self.l
+000229d0: 6566 7420 2b20 7365 6c66 2e77 6964 7468  eft + self.width
+000229e0: 5d2c 205b 7365 6c66 2e74 6f70 2c20 7365  ], [self.top, se
+000229f0: 6c66 2e74 6f70 202b 2073 656c 662e 6865  lf.top + self.he
+00022a00: 6967 6874 5d5d 290a 2020 2020 2020 2020  ight]]).        
+00022a10: 7265 7475 726e 2062 626f 780a 0a20 2020  return bbox..   
+00022a20: 2023 2020 2020 636c 6173 7320 4353 5353   #    class CSSS
+00022a30: 7479 6c65 3a0a 0a20 2020 2064 6566 2065  tyle:..    def e
+00022a40: 7874 7261 6374 5f73 7562 7374 796c 6573  xtract_substyles
+00022a50: 2873 656c 662c 2063 7373 5f6e 616d 6573  (self, css_names
+00022a60: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+00022a70: 2020 2020 2020 2043 7265 6174 6520 3220         Create 2 
+00022a80: 6e65 7720 4353 5353 7374 796c 6573 202c  new CSSSstyles ,
+00022a90: 2074 6865 2066 6972 7374 2077 6974 6820   the first with 
+00022aa0: 6e61 6d65 7320 696e 2022 7374 796c 6573  names in "styles
+00022ab0: 2220 616e 6420 7468 6520 7365 636f 6e64  " and the second
+00022ac0: 2074 6865 2072 6573 742e 0a20 2020 2020   the rest..     
+00022ad0: 2020 2020 2020 2069 6620 4e6f 6e65 2c20         if None, 
+00022ae0: 7265 7472 756e 7320 4e6f 6e65 2c4e 6f6e  retruns None,Non
+00022af0: 650a 2020 2020 2020 2020 3a70 6172 616d  e.        :param
+00022b00: 2063 7373 5f6e 616d 6573 3a20 6c69 7374   css_names: list
+00022b10: 206f 6620 4353 5320 6e61 6d65 7320 2865   of CSS names (e
+00022b20: 2e67 2e20 2266 6f6e 742d 6661 6d69 6c79  .g. "font-family
+00022b30: 2229 2e20 4966 206e 6120 6e61 6d65 206e  "). If na name n
+00022b40: 6f74 2066 6f75 6e64 2c20 6e6f 2061 6374  ot found, no act
+00022b50: 696f 6e0a 2020 2020 2020 2020 3a72 6574  ion.        :ret
+00022b60: 7572 6e20 322d 7475 706c 6520 6f66 2031  urn 2-tuple of 1
+00022b70: 2920 4353 5353 7479 6c65 206f 626a 6563  ) CSSStyle objec
+00022b80: 7420 7769 7468 2065 7874 7261 6374 6564  t with extracted
+00022b90: 206e 616d 6573 2032 2920 4353 5353 7479   names 2) CSSSty
+00022ba0: 6c65 206f 6620 7468 6520 7265 6d61 696e  le of the remain
+00022bb0: 6465 723b 0a20 2020 2020 2020 2020 2020  der;.           
+00022bc0: 2065 6974 6865 722f 626f 7468 206d 6179   either/both may
+00022bd0: 2062 6520 656d 7074 7920 4353 5353 7479   be empty CSSSty
+00022be0: 6c65 2e0a 2020 2020 2020 2020 2222 220a  le..        """.
+00022bf0: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+00022c00: 656c 662e 6e61 6d65 5f76 616c 7565 5f64  elf.name_value_d
+00022c10: 6963 743a 0a20 2020 2020 2020 2020 2020  ict:.           
+00022c20: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00022c30: 7228 6622 6e61 6d65 5f76 616c 7565 5f64  r(f"name_value_d
+00022c40: 6963 7420 6973 204e 6f6e 6522 290a 2020  ict is None").  
+00022c50: 2020 2020 2020 6966 2063 7373 5f6e 616d        if css_nam
+00022c60: 6573 2069 7320 4e6f 6e65 3a0a 2020 2020  es is None:.    
+00022c70: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+00022c80: 6f6e 652c 204e 6f6e 650a 2020 2020 2020  one, None.      
+00022c90: 2020 6373 735f 7265 7461 696e 6564 203d    css_retained =
+00022ca0: 2063 6f70 792e 6465 6570 636f 7079 2873   copy.deepcopy(s
+00022cb0: 656c 6629 0a20 2020 2020 2020 2063 7373  elf).        css
+00022cc0: 5f66 6f75 6e64 203d 2043 5353 5374 796c  _found = CSSStyl
+00022cd0: 6528 290a 0a20 2020 2020 2020 206b 6579  e()..        key
+00022ce0: 7320 3d20 6373 735f 7265 7461 696e 6564  s = css_retained
+00022cf0: 2e6e 616d 655f 7661 6c75 655f 6469 6374  .name_value_dict
+00022d00: 2e6b 6579 7328 290a 2020 2020 2020 2020  .keys().        
+00022d10: 666f 7220 6e61 6d65 2069 6e20 6373 735f  for name in css_
+00022d20: 6e61 6d65 733a 0a20 2020 2020 2020 2020  names:.         
+00022d30: 2020 2069 6620 6e61 6d65 2069 6e20 6373     if name in cs
+00022d40: 735f 7265 7461 696e 6564 2e6e 616d 655f  s_retained.name_
+00022d50: 7661 6c75 655f 6469 6374 3a0a 2020 2020  value_dict:.    
+00022d60: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
+00022d70: 6520 3d20 6373 735f 7265 7461 696e 6564  e = css_retained
+00022d80: 2e6e 616d 655f 7661 6c75 655f 6469 6374  .name_value_dict
+00022d90: 2e70 6f70 286e 616d 6529 0a20 2020 2020  .pop(name).     
+00022da0: 2020 2020 2020 2020 2020 2069 6620 7661             if va
+00022db0: 6c75 653a 2020 2320 7472 616e 7366 6572  lue:  # transfer
+00022dc0: 2069 7465 6d20 6f76 6572 0a20 2020 2020   item over.     
+00022dd0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00022de0: 7373 5f66 6f75 6e64 2e6e 616d 655f 7661  ss_found.name_va
+00022df0: 6c75 655f 6469 6374 5b6e 616d 655d 203d  lue_dict[name] =
+00022e00: 2076 616c 7565 0a20 2020 2020 2020 2072   value.        r
+00022e10: 6574 7572 6e20 2863 7373 5f66 6f75 6e64  eturn (css_found
+00022e20: 2c20 6373 735f 7265 7461 696e 6564 290a  , css_retained).
+00022e30: 0a20 2020 2023 2020 2020 636c 6173 7320  .    #    class 
+00022e40: 4353 5353 7479 6c65 3a0a 0a20 2020 2064  CSSStyle:..    d
+00022e50: 6566 2063 7265 6174 655f 6874 6d6c 5f73  ef create_html_s
+00022e60: 7479 6c65 5f65 6c65 6d65 6e74 2873 656c  tyle_element(sel
+00022e70: 662c 2068 746d 6c5f 636c 6173 7329 3a0a  f, html_class):.
+00022e80: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00022e90: 2020 2020 4372 6561 7465 7320 7374 7269      Creates stri
+00022ea0: 6e67 2066 6f72 2048 544d 4c20 7374 796c  ng for HTML styl
+00022eb0: 650a 2020 2020 2020 2020 2222 220a 2020  e.        """.  
+00022ec0: 2020 2020 2020 444f 5420 3d20 222e 220a        DOT = ".".
+00022ed0: 2020 2020 2020 2020 7320 3d20 444f 5420          s = DOT 
+00022ee0: 2b20 6874 6d6c 5f63 6c61 7373 202b 2022  + html_class + "
+00022ef0: 2022 202b 2073 656c 662e 6765 745f 6373   " + self.get_cs
+00022f00: 735f 7661 6c75 6528 7772 6170 5f77 6974  s_value(wrap_wit
+00022f10: 685f 6375 726c 793d 5472 7565 290a 2020  h_curly=True).  
+00022f20: 2020 2020 2020 656c 656d 203d 2045 542e        elem = ET.
+00022f30: 456c 656d 656e 7428 4353 5353 7479 6c65  Element(CSSStyle
+00022f40: 2e53 5459 4c45 290a 2020 2020 2020 2020  .STYLE).        
+00022f50: 656c 656d 2e74 6578 7420 3d20 730a 2020  elem.text = s.  
+00022f60: 2020 2020 2020 7265 7475 726e 2065 6c65        return ele
+00022f70: 6d0a 0a20 2020 2023 2020 2020 636c 6173  m..    #    clas
+00022f80: 7320 4353 5353 7479 6c65 3a0a 0a20 2020  s CSSStyle:..   
+00022f90: 2064 6566 2065 7874 7261 6374 5f74 6578   def extract_tex
+00022fa0: 745f 7374 796c 6573 2873 656c 6629 3a0a  t_styles(self):.
+00022fb0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00022fc0: 2020 2020 6578 7472 6163 7420 7465 7874      extract text
+00022fd0: 2063 6f6d 706f 6e65 6e74 7320 6672 6f6d   components from
+00022fe0: 2073 7479 6c65 2028 666f 6e74 2d2a 2c20   style (font-*, 
+00022ff0: 636f 6c6f 722c 2065 7463 2920 696e 746f  color, etc) into
+00023000: 206e 6577 2073 7479 6c65 2c20 7265 7475   new style, retu
+00023010: 726e 696e 6720 7475 706c 6520 6f66 0a20  rning tuple of. 
+00023020: 2020 2020 2020 206e 6577 2073 7479 6c65         new style
+00023030: 2061 6e64 2073 7479 6c65 2066 726f 6d20   and style from 
+00023040: 7265 6d61 696e 696e 6720 636f 6d70 6f6e  remaining compon
+00023050: 656e 7473 0a20 2020 2020 2020 2022 2222  ents.        """
+00023060: 0a20 2020 2020 2020 2028 6578 7472 6163  .        (extrac
+00023070: 7465 645f 7374 796c 652c 2072 6574 6169  ted_style, retai
+00023080: 6e65 6429 203d 2066 6f6e 745f 7374 796c  ned) = font_styl
+00023090: 652c 2072 6573 745f 7374 796c 6520 3d20  e, rest_style = 
+000230a0: 7365 6c66 2e65 7874 7261 6374 5f73 7562  self.extract_sub
+000230b0: 7374 796c 6573 280a 2020 2020 2020 2020  styles(.        
+000230c0: 2020 2020 4353 5353 7479 6c65 2e54 4558      CSSStyle.TEX
+000230d0: 545f 5354 594c 455f 434f 4d50 4f4e 454e  T_STYLE_COMPONEN
+000230e0: 5453 0a20 2020 2020 2020 2029 0a20 2020  TS.        ).   
+000230f0: 2020 2020 2072 6574 7572 6e20 2865 7874       return (ext
+00023100: 7261 6374 6564 5f73 7479 6c65 2c20 7265  racted_style, re
+00023110: 7461 696e 6564 290a 0a20 2020 2023 2020  tained)..    #  
+00023120: 2020 636c 6173 7320 4353 5353 7479 6c65    class CSSStyle
+00023130: 3a0a 0a20 2020 2064 6566 2065 7874 7261  :..    def extra
+00023140: 6374 5f74 6578 745f 7374 796c 6573 5f69  ct_text_styles_i
+00023150: 6e74 6f5f 636c 6173 7328 7365 6c66 2c20  nto_class(self, 
+00023160: 636c 6173 735f 6e61 6d65 2c20 6f6c 645f  class_name, old_
+00023170: 636c 6173 7373 7472 3d22 2229 3a0a 2020  classstr=""):.  
+00023180: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00023190: 2020 6578 7472 6163 7473 2074 6578 7420    extracts text 
+000231a0: 636c 6173 7320 6e61 6d65 2d76 616c 7565  class name-value
+000231b0: 2069 6e74 6f20 6e65 7720 4353 5353 7479   into new CSSSty
+000231c0: 6c65 2c20 616e 6420 6372 6561 7465 7320  le, and creates 
+000231d0: 7570 6461 7465 6420 636c 6173 735f 7374  updated class_st
+000231e0: 7269 6e67 0a20 2020 2020 2020 2045 7861  ring.        Exa
+000231f0: 6d70 6c65 3a0a 2020 2020 2020 2020 2020  mple:.          
+00023200: 2020 656c 656d 656e 7420 6861 7320 7374    element has st
+00023210: 796c 6520 6174 7472 6962 7574 6520 7769  yle attribute wi
+00023220: 7468 2073 6576 6572 616c 2074 6578 7420  th several text 
+00023230: 636f 6d70 6f6e 656e 7473 2028 652e 672e  components (e.g.
+00023240: 2066 6f6e 742d 7765 6967 6874 2c20 666f   font-weight, fo
+00023250: 6e74 2d73 697a 6529 0a20 2020 2020 2020  nt-size).       
+00023260: 2020 2020 2054 6869 7320 6372 6561 7465       This create
+00023270: 7320 6120 6e65 7720 3c73 7479 6c65 3e20  s a new <style> 
+00023280: 456c 656d 656e 7420 2865 7874 7261 6374  Element (extract
+00023290: 6564 2920 7769 7468 206a 7573 7420 7468  ed) with just th
+000232a0: 6573 6520 636f 6d70 6f6e 656e 7473 0a20  ese components. 
+000232b0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+000232c0: 6e64 2070 7574 7320 7468 6520 756e 6578  nd puts the unex
+000232d0: 7472 6163 7465 6420 7374 796c 6520 636f  tracted style co
+000232e0: 6d70 6f6e 6565 6e74 7320 696e 746f 206e  mponeents into n
+000232f0: 6577 2073 7479 6c65 2073 7061 6365 2d73  ew style space-s
+00023300: 6570 6172 6174 6564 2073 7472 696e 6720  eparated string 
+00023310: 2872 656d 6169 6e6e 6564 290a 2020 2020  (remainned).    
+00023320: 2020 2020 2020 2020 4974 2075 7365 7320          It uses 
+00023330: 7468 6520 636c 6173 735f 6e61 6d65 2074  the class_name t
+00023340: 6f20 7570 6461 7465 2074 6865 206f 6c64  o update the old
+00023350: 5f63 6c61 7373 7374 7220 7374 7269 6e67  _classstr string
+00023360: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023370: 2065 2e67 2e20 636c 6173 735f 6e61 6d65   e.g. class_name
+00023380: 3d22 7331 2220 616e 6420 6f6c 645f 636c  ="s1" and old_cl
+00023390: 6173 7373 7472 3d22 666f 6f20 6261 7222  assstr="foo bar"
+000233a0: 203d 3e20 2266 6f6f 2062 6172 2073 3122   => "foo bar s1"
+000233b0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+000233c0: 636c 6173 735f 6e61 6d65 3a20 6e61 6d65  class_name: name
+000233d0: 206f 6966 206e 6577 2063 6c61 7373 2028   oif new class (
+000233e0: 6175 7468 6f72 206d 7573 7420 656e 7375  author must ensu
+000233f0: 7265 2075 6e69 7175 656e 6573 7329 0a20  re uniqueness). 
+00023400: 2020 2020 2020 203a 7061 7261 6d20 6f6c         :param ol
+00023410: 645f 636c 6173 7373 7472 3a20 6f6c 6420  d_classstr: old 
+00023420: 636c 6173 736e 616d 6520 2864 6566 6175  classname (defau
+00023430: 6c74 7320 746f 2022 2229 0a20 2020 2020  lts to "").     
+00023440: 2020 203a 7265 7475 726e 3a20 332d 7475     :return: 3-tu
+00023450: 706c 6520 6f66 2028 6578 7472 6163 7465  ple of (extracte
+00023460: 645f 7374 796c 655f 656c 656d 656e 742c  d_style_element,
+00023470: 2072 6574 6169 6e65 645f 7374 796c 655f   retained_style_
+00023480: 7374 7269 6e67 2c20 6e65 7720 636c 6173  string, new clas
+00023490: 7373 5f73 7472 696e 6729 0a20 2020 2020  ss_string).     
+000234a0: 2020 2022 2222 0a20 2020 2020 2020 2065     """.        e
+000234b0: 7874 7261 6374 6564 5f73 7479 6c65 2c20  xtracted_style, 
+000234c0: 7265 7461 696e 6564 5f73 7479 6c65 203d  retained_style =
+000234d0: 2073 656c 662e 6578 7472 6163 745f 7465   self.extract_te
+000234e0: 7874 5f73 7479 6c65 7328 290a 0a20 2020  xt_styles()..   
+000234f0: 2020 2020 2069 6620 6e6f 7420 6578 7472       if not extr
+00023500: 6163 7465 645f 7374 796c 653a 0a20 2020  acted_style:.   
+00023510: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00023520: 616c 7565 4572 726f 7228 2265 7874 7261  alueError("extra
+00023530: 6374 6564 2073 7479 6c65 2069 7320 4e6f  cted style is No
+00023540: 6e65 2229 0a20 2020 2020 2020 2065 7874  ne").        ext
+00023550: 7261 6374 6564 5f73 7479 6c65 3120 3d20  racted_style1 = 
+00023560: 4353 5353 7479 6c65 2e65 7874 7261 6374  CSSStyle.extract
+00023570: 5f62 6f6c 645f 6974 616c 6963 5f66 726f  _bold_italic_fro
+00023580: 6d5f 666f 6e74 5f66 616d 696c 795f 666f  m_font_family_fo
+00023590: 725f 7374 796c 6528 6578 7472 6163 7465  r_style(extracte
+000235a0: 645f 7374 796c 6529 2069 6620 6578 7472  d_style) if extr
+000235b0: 6163 7465 645f 7374 796c 6520 656c 7365  acted_style else
+000235c0: 204e 6f6e 650a 2020 2020 2020 2020 6578   None.        ex
+000235d0: 7472 6163 7465 645f 6874 6d6c 5f73 7479  tracted_html_sty
+000235e0: 6c65 5f65 6c65 6d65 6e74 203d 2065 7874  le_element = ext
+000235f0: 7261 6374 6564 5f73 7479 6c65 312e 6372  racted_style1.cr
+00023600: 6561 7465 5f68 746d 6c5f 7374 796c 655f  eate_html_style_
+00023610: 656c 656d 656e 7428 636c 6173 735f 6e61  element(class_na
+00023620: 6d65 2920 6966 2065 7874 7261 6374 6564  me) if extracted
+00023630: 5f73 7479 6c65 3120 6973 206e 6f74 204e  _style1 is not N
+00023640: 6f6e 6520 656c 7365 204e 6f6e 650a 0a20  one else None.. 
+00023650: 2020 2020 2020 2072 6574 6169 6e65 645f         retained_
+00023660: 7374 796c 655f 6174 7476 616c 203d 2072  style_attval = r
+00023670: 6574 6169 6e65 645f 7374 796c 652e 6765  etained_style.ge
+00023680: 745f 6373 735f 7661 6c75 6528 2920 6966  t_css_value() if
+00023690: 2072 6574 6169 6e65 645f 7374 796c 6520   retained_style 
+000236a0: 656c 7365 204e 6f6e 650a 2020 2020 2020  else None.      
+000236b0: 2020 6874 6d6c 5f63 6c61 7373 5f76 616c    html_class_val
+000236c0: 203d 2043 5353 5374 796c 652e 6372 6561   = CSSStyle.crea
+000236d0: 7465 5f68 746d 6c5f 636c 6173 735f 7661  te_html_class_va
+000236e0: 6c28 636c 6173 735f 6e61 6d65 2c20 6f6c  l(class_name, ol
+000236f0: 645f 636c 6173 735f 7661 6c3d 6f6c 645f  d_class_val=old_
+00023700: 636c 6173 7373 7472 290a 2020 2020 2020  classstr).      
+00023710: 2020 7265 7475 726e 2065 7874 7261 6374    return extract
+00023720: 6564 5f68 746d 6c5f 7374 796c 655f 656c  ed_html_style_el
+00023730: 656d 656e 742c 2072 6574 6169 6e65 645f  ement, retained_
+00023740: 7374 796c 655f 6174 7476 616c 2c20 6874  style_attval, ht
+00023750: 6d6c 5f63 6c61 7373 5f76 616c 0a0a 2020  ml_class_val..  
+00023760: 2020 2320 2020 2063 6c61 7373 2043 5353    #    class CSS
+00023770: 5374 796c 653a 0a0a 2020 2020 4063 6c61  Style:..    @cla
+00023780: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+00023790: 2063 7265 6174 655f 6874 6d6c 5f63 6c61   create_html_cla
+000237a0: 7373 5f76 616c 2863 6c73 2c20 6e65 775f  ss_val(cls, new_
+000237b0: 636c 6173 732c 206f 6c64 5f63 6c61 7373  class, old_class
+000237c0: 5f76 616c 3d4e 6f6e 6529 3a0a 2020 2020  _val=None):.    
+000237d0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000237e0: 6372 6561 7465 7320 6f72 2065 6469 7473  creates or edits
+000237f0: 2061 2063 6c61 7373 2073 7472 696e 6720   a class string 
+00023800: 746f 2061 6363 6570 7420 6120 6e65 7720  to accept a new 
+00023810: 7661 6c75 650a 2020 2020 2020 2020 6e6f  value.        no
+00023820: 2d6f 7020 6966 206e 6577 5f63 6c61 7373  -op if new_class
+00023830: 2069 7320 616c 7265 6164 7920 696e 206f   is already in o
+00023840: 6c64 5f63 6c61 7373 5f76 616c 0a20 2020  ld_class_val.   
+00023850: 2020 2020 2065 2e67 2e20 4e6f 6e65 202b       e.g. None +
+00023860: 2022 666f 6f22 203d 3e20 2266 6f6f 220a   "foo" => "foo".
+00023870: 2020 2020 2020 2020 2266 6f6f 2220 2b20          "foo" + 
+00023880: 2262 6172 2070 6c75 6768 2220 3d3e 2022  "bar plugh" => "
+00023890: 6261 7220 706c 7567 6820 666f 6f22 0a20  bar plugh foo". 
+000238a0: 2020 2020 2020 2022 666f 6f22 202b 2022         "foo" + "
+000238b0: 6261 7220 666f 6f20 706c 7567 6822 203d  bar foo plugh" =
+000238c0: 3e20 2262 6172 2066 6f6f 2070 6c75 6768  > "bar foo plugh
+000238d0: 220a 2020 2020 2020 2020 3a70 6172 616d  ".        :param
+000238e0: 206e 6577 5f63 6c61 7373 3a20 636c 6173   new_class: clas
+000238f0: 7320 746f 2061 6464 0a20 2020 2020 2020  s to add.       
+00023900: 203a 7061 7261 6d20 6f6c 645f 636c 6173   :param old_clas
+00023910: 735f 7661 6c3a 2073 7061 6365 2d73 6570  s_val: space-sep
+00023920: 6172 6174 6564 206c 6973 7420 6f66 2065  arated list of e
+00023930: 7869 7374 696e 6720 636c 6173 7365 730a  xisting classes.
+00023940: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
+00023950: 206e 6577 2063 6c61 7373 2073 7472 696e   new class strin
+00023960: 670a 2020 2020 2020 2020 2222 220a 2020  g.        """.  
+00023970: 2020 2020 2020 6f6c 645f 636c 6173 7365        old_classe
+00023980: 7320 3d20 5b5d 2069 6620 6e6f 7420 6f6c  s = [] if not ol
+00023990: 645f 636c 6173 735f 7661 6c20 656c 7365  d_class_val else
+000239a0: 206f 6c64 5f63 6c61 7373 5f76 616c 2e73   old_class_val.s
+000239b0: 706c 6974 2829 0a20 2020 2020 2020 2069  plit().        i
+000239c0: 6620 6e65 775f 636c 6173 7320 6e6f 7420  f new_class not 
+000239d0: 696e 206f 6c64 5f63 6c61 7373 6573 3a0a  in old_classes:.
+000239e0: 2020 2020 2020 2020 2020 2020 6f6c 645f              old_
+000239f0: 636c 6173 7365 732e 6170 7065 6e64 286e  classes.append(n
+00023a00: 6577 5f63 6c61 7373 290a 2020 2020 2020  ew_class).      
+00023a10: 2020 7265 7475 726e 2055 7469 6c2e 6372    return Util.cr
+00023a20: 6561 7465 5f73 7472 696e 675f 7365 7061  eate_string_sepa
+00023a30: 7261 7465 645f 6c69 7374 286f 6c64 5f63  rated_list(old_c
+00023a40: 6c61 7373 6573 290a 0a20 2020 2023 2020  lasses)..    #  
+00023a50: 2020 636c 6173 7320 4353 5353 7479 6c65    class CSSStyle
+00023a60: 3a0a 0a20 2020 2040 636c 6173 736d 6574  :..    @classmet
+00023a70: 686f 640a 2020 2020 6465 6620 6372 6561  hod.    def crea
+00023a80: 7465 5f73 7479 6c65 5f64 6963 745f 6672  te_style_dict_fr
+00023a90: 6f6d 5f73 7479 6c65 7328 636c 732c 2073  om_styles(cls, s
+00023aa0: 7479 6c65 5f65 6c65 6d73 3d4e 6f6e 652c  tyle_elems=None,
+00023ab0: 2076 616c 6964 6174 653d 5472 7565 293a   validate=True):
+00023ac0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00023ad0: 2020 2020 2063 6f6e 7665 7274 206c 6973       convert lis
+00023ae0: 7420 6f66 2043 5353 5374 796c 6573 2028  t of CSSStyles (
+00023af0: 6173 2048 544d 4c20 7374 7269 6e67 7329  as HTML strings)
+00023b00: 2074 6f20 6469 6374 0a20 2020 2020 2020   to dict.       
+00023b10: 2069 6620 6475 706c 6963 6174 6520 7374   if duplicate st
+00023b20: 796c 6572 6566 7320 7261 6973 6520 4578  ylerefs raise Ex
+00023b30: 6365 7074 696f 6e20 6966 2076 616c 6964  ception if valid
+00023b40: 6174 6520 656c 7365 2074 616b 6520 6669  ate else take fi
+00023b50: 7273 740a 2020 2020 2020 2020 5479 7069  rst.        Typi
+00023b60: 6361 6c20 7374 796c 653a 0a20 2020 2020  cal style:.     
+00023b70: 2020 203c 7374 796c 6520 2e2e 2e3e 2e73     <style ...>.s
+00023b80: 3020 7b66 6f6e 742d 7369 7a65 3a20 3134  0 {font-size: 14
+00023b90: 2e70 783b 7d3c 2f73 7479 6c65 3e0a 2020  .px;}</style>.  
+00023ba0: 2020 2020 2020 3a70 6172 616d 2073 7479        :param sty
+00023bb0: 6c65 5f65 6c65 6d73 3a20 6c69 7374 206f  le_elems: list o
+00023bc0: 6620 6c78 6d6c 205f 456c 656d 656e 7473  f lxml _Elements
+00023bd0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00023be0: 7661 6c69 6461 7465 3a20 6368 6563 6b20  validate: check 
+00023bf0: 7768 6574 6865 7220 4353 5320 7661 6c75  whether CSS valu
+00023c00: 6520 6973 2063 6f6e 666f 726d 616e 7420  e is conformant 
+00023c10: 6f72 2064 7570 6c69 6361 7465 2073 7479  or duplicate sty
+00023c20: 6c65 5f72 6566 730a 2020 2020 2020 2020  le_refs.        
+00023c30: 3a72 6574 7572 6e3a 2064 6963 7420 6f66  :return: dict of
+00023c40: 2066 6f72 6d20 7265 663a 2073 7479 6c65   form ref: style
+00023c50: 0a20 2020 2020 2020 203a 6578 6365 7074  .        :except
+00023c60: 3a20 4966 2065 6c65 6d65 6e74 2068 6173  : If element has
+00023c70: 2077 726f 6e67 2073 796e 7461 783b 2069   wrong syntax; i
+00023c80: 6620 6373 7320 6669 6572 6c64 2069 7320  f css fierld is 
+00023c90: 6d61 6c66 6f74 6d65 643b 2069 6620 7265  malfotmed; if re
+00023ca0: 6620 6973 2064 7570 6c69 6361 7465 640a  f is duplicated.
+00023cb0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00023cc0: 2020 2020 6373 735f 7265 203d 2072 652e      css_re = re.
+00023cd0: 636f 6d70 696c 6528 225c 5c73 2a28 5c5c  compile("\\s*(\\
+00023ce0: 2e2e 2a29 5c5c 732b 7b28 2e2a 297d 5c5c  ..*)\\s+{(.*)}\\
+00023cf0: 732a 2229 0a20 2020 2020 2020 2069 6620  s*").        if 
+00023d00: 7374 796c 655f 656c 656d 7320 6973 204e  style_elems is N
+00023d10: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00023d20: 2073 7479 6c65 7320 3d20 5b5d 0a20 2020   styles = [].   
+00023d30: 2020 2020 2073 7479 6c65 5f64 6963 7420       style_dict 
+00023d40: 3d20 6469 6374 2829 0a20 2020 2020 2020  = dict().       
+00023d50: 2066 6f72 2073 7479 6c65 5f65 6c65 6d20   for style_elem 
+00023d60: 696e 2073 7479 6c65 5f65 6c65 6d73 3a0a  in style_elems:.
+00023d70: 2020 2020 2020 2020 2020 2020 7374 796c              styl
+00023d80: 655f 7465 7874 203d 2073 7479 6c65 5f65  e_text = style_e
+00023d90: 6c65 6d2e 7465 7874 2e73 7472 6970 2829  lem.text.strip()
+00023da0: 0a20 2020 2020 2020 2020 2020 206d 6174  .            mat
+00023db0: 6368 203d 2063 7373 5f72 652e 6d61 7463  ch = css_re.matc
+00023dc0: 6828 7374 796c 655f 7465 7874 290a 2020  h(style_text).  
+00023dd0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00023de0: 206d 6174 6368 3a0a 2020 2020 2020 2020   match:.        
+00023df0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00023e00: 6c75 6545 7272 6f72 2866 2242 4144 2068  lueError(f"BAD h
+00023e10: 6561 645f 7374 796c 6520 7b73 7479 6c65  ead_style {style
+00023e20: 5f74 6578 747d 2229 0a20 2020 2020 2020  _text}").       
+00023e30: 2020 2020 2072 6566 203d 206d 6174 6368       ref = match
+00023e40: 2e67 726f 7570 2831 290a 2020 2020 2020  .group(1).      
+00023e50: 2020 2020 2020 6373 735f 7374 7269 6e67        css_string
+00023e60: 203d 206d 6174 6368 2e67 726f 7570 2832   = match.group(2
+00023e70: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00023e80: 2063 7373 5f73 7472 696e 6720 3d3d 2022   css_string == "
+00023e90: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+00023ea0: 2020 2023 2074 6869 7320 6f63 6375 7273     # this occurs
+00023eb0: 2077 6865 6e20 7468 6520 7374 796c 6520   when the style 
+00023ec0: 6174 7472 6962 7574 6573 2061 7265 2070  attributes are p
+00023ed0: 6f73 6974 696f 6e61 6c0a 2020 2020 2020  ositional.      
+00023ee0: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+00023ef0: 7565 0a20 2020 2020 2020 2020 2020 2069  ue.            i
+00023f00: 6620 7661 6c69 6461 7465 3a0a 2020 2020  f validate:.    
+00023f10: 2020 2020 2020 2020 2020 2020 6373 735f              css_
+00023f20: 7374 796c 6520 3d20 4353 5353 7479 6c65  style = CSSStyle
+00023f30: 2e63 7265 6174 655f 6373 735f 7374 796c  .create_css_styl
+00023f40: 655f 6672 6f6d 5f63 7373 5f73 7472 696e  e_from_css_strin
+00023f50: 6728 6373 735f 7374 7269 6e67 290a 2020  g(css_string).  
+00023f60: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00023f70: 2063 7373 5f73 7479 6c65 2069 7320 4e6f   css_style is No
+00023f80: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00023f90: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00023fa0: 6c75 6545 7272 6f72 2866 2262 6164 2043  lueError(f"bad C
+00023fb0: 5353 5374 796c 6520 7b63 7373 5f73 7479  SSStyle {css_sty
+00023fc0: 6c65 7d22 290a 2020 2020 2020 2020 2020  le}").          
+00023fd0: 2020 6966 2072 6566 2069 6e20 7374 796c    if ref in styl
+00023fe0: 655f 6469 6374 3a0a 2020 2020 2020 2020  e_dict:.        
+00023ff0: 2020 2020 2020 2020 6966 2076 616c 6964          if valid
+00024000: 6174 653a 0a20 2020 2020 2020 2020 2020  ate:.           
+00024010: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00024020: 616c 7565 4572 726f 7228 6622 6475 706c  alueError(f"dupl
+00024030: 6963 6174 6520 7374 796c 6520 7265 6620  icate style ref 
+00024040: 7b73 7479 6c65 5f74 6578 747d 2229 0a20  {style_text}"). 
+00024050: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00024060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024070: 2073 7479 6c65 5f64 6963 745b 7265 665d   style_dict[ref]
+00024080: 203d 2063 7373 5f73 7472 696e 670a 2020   = css_string.  
+00024090: 2020 2020 2020 7265 7475 726e 2073 7479        return sty
+000240a0: 6c65 5f64 6963 740a 0a20 2020 2023 2020  le_dict..    #  
+000240b0: 2020 636c 6173 7320 4353 5353 7479 6c65    class CSSStyle
+000240c0: 3a0a 0a20 2020 2040 636c 6173 736d 6574  :..    @classmet
+000240d0: 686f 640a 2020 2020 6465 6620 6578 7472  hod.    def extr
+000240e0: 6163 745f 7374 796c 6573 5f66 726f 6d5f  act_styles_from_
+000240f0: 6874 6d6c 5f73 7472 696e 6728 636c 732c  html_string(cls,
+00024100: 2068 746d 6c5f 7374 7229 3a0a 2020 2020   html_str):.    
+00024110: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00024120: 6578 7472 6163 7420 7374 796c 6573 2066  extract styles f
+00024130: 726f 6d20 6865 6164 206f 6620 6874 6d6c  rom head of html
+00024140: 2066 696c 650a 2020 2020 2020 2020 3a70   file.        :p
+00024150: 6172 616d 2068 746d 6c5f 7374 723a 2073  aram html_str: s
+00024160: 7472 696e 6720 6f66 2066 6f72 6d20 3c68  tring of form <h
+00024170: 746d 6c3e 3c68 6561 643e 3c73 7479 6c65  tml><head><style
+00024180: 202e 2e2e 3e3c 2f73 7479 6c65 3e3c 7374   ...></style><st
+00024190: 796c 6520 2e2e 2e3e 3c2f 7374 796c 653e  yle ...></style>
+000241a0: 3c2f 6865 6164 3e20 2e2e 2e20 3c2f 6874  </head> ... </ht
+000241b0: 6d6c 3e0a 2020 2020 2020 2020 3a72 6574  ml>.        :ret
+000241c0: 7572 6e3a 206c 6973 7420 6f66 205f 456c  urn: list of _El
+000241d0: 656d 656e 7473 2028 3c73 7479 6c65 2e2e  ements (<style..
+000241e0: 2e3e 202e 2e2e 3c2f 7374 796c 653e 2920  .> ...</style>) 
+000241f0: 6f72 205b 5d0a 2020 2020 2020 2020 2222  or [].        ""
+00024200: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
+00024210: 2063 6c73 2e65 7874 7261 6374 5f73 7479   cls.extract_sty
+00024220: 6c65 735f 6672 6f6d 5f68 746d 6c5f 6865  les_from_html_he
+00024230: 6164 5f65 6c65 6d65 6e74 2845 542e 6672  ad_element(ET.fr
+00024240: 6f6d 7374 7269 6e67 2868 746d 6c5f 7374  omstring(html_st
+00024250: 7229 290a 0a20 2020 2023 2020 2020 636c  r))..    #    cl
+00024260: 6173 7320 4353 5353 7479 6c65 3a0a 0a20  ass CSSStyle:.. 
+00024270: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+00024280: 2020 2020 6465 6620 6578 7472 6163 745f      def extract_
+00024290: 7374 796c 6573 5f66 726f 6d5f 6874 6d6c  styles_from_html
+000242a0: 5f68 6561 645f 656c 656d 656e 7428 636c  _head_element(cl
+000242b0: 732c 2068 746d 6c5f 656c 656d 293a 0a20  s, html_elem):. 
+000242c0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000242d0: 2020 2065 7874 7261 6374 2073 7479 6c65     extract style
+000242e0: 7320 6672 6f6d 2068 6561 6420 6f66 2068  s from head of h
+000242f0: 746d 6c20 6669 6c65 0a20 2020 2020 2020  tml file.       
+00024300: 203a 7061 7261 6d20 6874 6d6c 5f65 6c65   :param html_ele
+00024310: 6d3a 2065 6c65 6d65 6e74 206f 6620 666f  m: element of fo
+00024320: 726d 203c 6874 6d6c 3e3c 6865 6164 3e3c  rm <html><head><
+00024330: 7374 796c 6520 2e2e 2e3e 3c2f 7374 796c  style ...></styl
+00024340: 653e 3c73 7479 6c65 202e 2e2e 3e3c 2f73  e><style ...></s
+00024350: 7479 6c65 3e3c 2f68 6561 643e 202e 2e2e  tyle></head> ...
+00024360: 203c 2f68 746d 6c3e 0a20 2020 2020 2020   </html>.       
+00024370: 203a 7265 7475 726e 3a20 6c69 7374 206f   :return: list o
+00024380: 6620 5f45 6c65 6d65 6e74 7320 283c 7374  f _Elements (<st
+00024390: 796c 652e 2e2e 3e20 2e2e 2e3c 2f73 7479  yle...> ...</sty
+000243a0: 6c65 3e29 206f 7220 5b5d 0a20 2020 2020  le>) or [].     
+000243b0: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
+000243c0: 6574 7572 6e20 5b5d 2069 6620 6874 6d6c  eturn [] if html
+000243d0: 5f65 6c65 6d20 6973 204e 6f6e 6520 656c  _elem is None el
+000243e0: 7365 2068 746d 6c5f 656c 656d 2e78 7061  se html_elem.xpa
+000243f0: 7468 2853 5459 4c45 5f58 5041 5448 290a  th(STYLE_XPATH).
+00024400: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+00024410: 640a 2020 2020 6465 6620 6372 6561 7465  d.    def create
+00024420: 5f63 7373 5f73 7479 6c65 5f66 726f 6d5f  _css_style_from_
+00024430: 6874 6d6c 5f68 6561 645f 7374 796c 655f  html_head_style_
+00024440: 656c 656d 2863 6c73 2c20 7374 796c 655f  elem(cls, style_
+00024450: 656c 656d 293a 0a20 2020 2020 2020 2022  elem):.        "
+00024460: 2222 0a20 2020 2020 2020 2065 7874 7261  "".        extra
+00024470: 6374 7320 4353 5353 7479 6c65 2065 6c65  cts CSSStyle ele
+00024480: 6d6e 7420 6672 6f6d 2048 544d 4c20 3c73  mnt from HTML <s
+00024490: 7479 6c65 3e2e 666f 6f20 7b61 3a62 3b20  tyle>.foo {a:b; 
+000244a0: 633a 643b 7d20 656c 656d 656e 740a 2020  c:d;} element.  
+000244b0: 2020 2020 2020 3a70 6172 616d 2073 7479        :param sty
+000244c0: 6c65 5f65 6c65 6d3a 0a20 2020 2020 2020  le_elem:.       
+000244d0: 203a 7265 7475 726e 3a20 7475 706c 6528   :return: tuple(
+000244e0: 7379 6d62 6f6c 2072 6566 2c20 6e65 7720  symbol ref, new 
+000244f0: 4353 5353 7479 6c65 290a 2020 2020 2020  CSSStyle).      
+00024500: 2020 2222 220a 2020 2020 2020 2020 7374    """.        st
+00024510: 796c 655f 7265 203d 2072 652e 636f 6d70  yle_re = re.comp
+00024520: 696c 6528 225c 5c73 2a28 5b5e 5c5c 735d  ile("\\s*([^\\s]
+00024530: 2a29 5c5c 732b 7b28 2e2a 297d 5c5c 732a  *)\\s+{(.*)}\\s*
+00024540: 2229 0a20 2020 2020 2020 2073 796d 626f  ").        symbo
+00024550: 6c5f 7265 6620 3d20 4e6f 6e65 0a20 2020  l_ref = None.   
+00024560: 2020 2020 2063 7373 5f73 7479 6c65 5f6f       css_style_o
+00024570: 626a 203d 204e 6f6e 650a 2020 2020 2020  bj = None.      
+00024580: 2020 6966 2074 7970 6528 7374 796c 655f    if type(style_
+00024590: 656c 656d 2920 6973 205f 456c 656d 656e  elem) is _Elemen
+000245a0: 743a 0a20 2020 2020 2020 2020 2020 2074  t:.            t
+000245b0: 6578 7420 3d20 586d 6c4c 6962 2e67 6574  ext = XmlLib.get
+000245c0: 5f74 6578 7428 7374 796c 655f 656c 656d  _text(style_elem
+000245d0: 290a 2020 2020 2020 2020 2020 2020 6d61  ).            ma
+000245e0: 7463 6820 3d20 7374 796c 655f 7265 2e6d  tch = style_re.m
+000245f0: 6174 6368 2874 6578 7429 0a20 2020 2020  atch(text).     
+00024600: 2020 2020 2020 2069 6620 6d61 7463 683a         if match:
+00024610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024620: 2073 796d 626f 6c5f 7265 6620 3d20 6d61   symbol_ref = ma
+00024630: 7463 682e 6772 6f75 7028 3129 0a20 2020  tch.group(1).   
+00024640: 2020 2020 2020 2020 2020 2020 2063 7373               css
+00024650: 5f73 7479 6c65 5f6f 626a 203d 2043 5353  _style_obj = CSS
+00024660: 5374 796c 652e 6372 6561 7465 5f63 7373  Style.create_css
+00024670: 5f73 7479 6c65 5f66 726f 6d5f 6373 735f  _style_from_css_
+00024680: 7374 7269 6e67 286d 6174 6368 2e67 726f  string(match.gro
+00024690: 7570 2832 2929 0a20 2020 2020 2020 2072  up(2)).        r
+000246a0: 6574 7572 6e20 7379 6d62 6f6c 5f72 6566  eturn symbol_ref
+000246b0: 2c20 6373 735f 7374 796c 655f 6f62 6a0a  , css_style_obj.
+000246c0: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+000246d0: 640a 2020 2020 6465 6620 7265 706c 6163  d.    def replac
+000246e0: 655f 6373 735f 7374 796c 655f 6e61 6d65  e_css_style_name
+000246f0: 5f76 616c 7565 735f 7769 7468 5f6e 6f72  _values_with_nor
+00024700: 6d61 6c69 7a65 645f 666f 6e74 2863 6c73  malized_font(cls
+00024710: 2c20 7374 796c 655f 656c 656d 293a 0a20  , style_elem):. 
+00024720: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00024730: 2020 2069 6620 7374 796c 655f 656c 656d     if style_elem
+00024740: 2063 6f6e 7461 696e 7320 6120 666f 6e74   contains a font
+00024750: 2069 6e20 7468 6520 4353 5320 7661 6c75   in the CSS valu
+00024760: 6573 2c20 6e6f 726d 616c 697a 6573 2069  es, normalizes i
+00024770: 7420 6966 2070 6f73 7369 626c 650a 2020  t if possible.  
+00024780: 2020 2020 2020 2865 2e67 2e20 666f 6e74        (e.g. font
+00024790: 2d66 616d 696c 793a 2041 7269 616c 426f  -family: ArialBo
+000247a0: 6c64 3b20 3d3e 2066 6f6e 742d 6661 6d69  ld; => font-fami
+000247b0: 6c79 3a41 7269 616c 3b20 666f 6e74 2d77  ly:Arial; font-w
+000247c0: 6569 6768 743a 2062 6f6c 643b 0a20 2020  eight: bold;.   
+000247d0: 2020 2020 2065 6469 7473 2074 6865 2073       edits the s
+000247e0: 7479 6c65 5f65 6c65 6d0a 2020 2020 2020  tyle_elem.      
+000247f0: 2020 3a70 6172 616d 2073 7479 6c65 5f65    :param style_e
+00024800: 6c65 6d3a 2065 6c65 6d65 6e74 2074 6f20  lem: element to 
+00024810: 6265 2065 6469 7465 6420 284e 4f54 2063  be edited (NOT c
+00024820: 6f70 6965 6429 0a20 2020 2020 2020 2022  opied).        "
+00024830: 2222 0a20 2020 2020 2020 2073 796d 626f  "".        symbo
+00024840: 6c5f 7265 662c 206e 6577 5f63 7373 7374  l_ref, new_cssst
+00024850: 796c 6520 3d20 416d 6946 6f6e 742e 6372  yle = AmiFont.cr
+00024860: 6561 7465 5f66 6f6e 745f 6564 6974 6564  eate_font_edited
+00024870: 5f73 7479 6c65 5f66 726f 6d5f 6373 735f  _style_from_css_
+00024880: 7374 796c 655f 6f62 6a65 6374 2873 7479  style_object(sty
+00024890: 6c65 5f65 6c65 6d29 0a20 2020 2020 2020  le_elem).       
+000248a0: 2069 6620 6e65 775f 6373 7373 7479 6c65   if new_cssstyle
+000248b0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+000248c0: 2020 2020 2020 2020 2020 7374 796c 655f            style_
+000248d0: 656c 656d 2e74 6578 7420 3d20 6622 7b73  elem.text = f"{s
+000248e0: 796d 626f 6c5f 7265 667d 207b 7b7b 6e65  ymbol_ref} {{{ne
+000248f0: 775f 6373 7373 7479 6c65 7d7d 7d22 0a0a  w_cssstyle}}}"..
+00024900: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+00024910: 0a20 2020 2064 6566 206e 6f72 6d61 6c69  .    def normali
+00024920: 7a65 5f73 7479 6c65 735f 696e 5f66 6f6e  ze_styles_in_fon
+00024930: 7473 5f69 6e5f 6874 6d6c 5f68 6561 6428  ts_in_html_head(
+00024940: 636c 732c 2068 746d 6c5f 656c 656d 293a  cls, html_elem):
+00024950: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00024960: 2020 2020 206e 6f72 6d61 6c69 7a65 7320       normalizes 
+00024970: 616c 6c20 666f 6e74 7320 746f 2065 7870  all fonts to exp
+00024980: 6f73 6520 666f 6e74 2077 6569 6768 7473  ose font weights
+00024990: 2061 6e64 2073 7479 6c65 730a 2020 2020   and styles.    
+000249a0: 2020 2020 3a70 6172 616d 2068 746d 6c5f      :param html_
+000249b0: 656c 656d 3a20 4854 4d4c 2028 726f 6f74  elem: HTML (root
+000249c0: 2920 656c 656d 656e 7420 2868 746d 6c2f  ) element (html/
+000249d0: 6865 6164 2f73 7479 6c65 2a29 0a20 2020  head/style*).   
+000249e0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000249f0: 2073 7479 6c65 5f65 6c65 6d73 203d 2043   style_elems = C
+00024a00: 5353 5374 796c 652e 6578 7472 6163 745f  SSStyle.extract_
+00024a10: 7374 796c 6573 5f66 726f 6d5f 6874 6d6c  styles_from_html
+00024a20: 5f68 6561 645f 656c 656d 656e 7428 6874  _head_element(ht
+00024a30: 6d6c 5f65 6c65 6d29 0a20 2020 2020 2020  ml_elem).       
+00024a40: 2066 6f72 2073 7479 6c65 5f65 6c65 6d20   for style_elem 
+00024a50: 696e 2073 7479 6c65 5f65 6c65 6d73 3a0a  in style_elems:.
+00024a60: 2020 2020 2020 2020 2020 2020 4353 5353              CSSS
+00024a70: 7479 6c65 2e72 6570 6c61 6365 5f63 7373  tyle.replace_css
+00024a80: 5f73 7479 6c65 5f6e 616d 655f 7661 6c75  _style_name_valu
+00024a90: 6573 5f77 6974 685f 6e6f 726d 616c 697a  es_with_normaliz
+00024aa0: 6564 5f66 6f6e 7428 7374 796c 655f 656c  ed_font(style_el
+00024ab0: 656d 290a 0a20 2020 2040 7072 6f70 6572  em)..    @proper
+00024ac0: 7479 0a20 2020 2064 6566 2073 686f 7274  ty.    def short
+00024ad0: 5f73 7479 6c65 2873 656c 6629 3a0a 2020  _style(self):.  
+00024ae0: 2020 2020 2020 7368 6f72 745f 7374 796c        short_styl
+00024af0: 6520 3d20 7365 6c66 2e66 6f6e 745f 6661  e = self.font_fa
+00024b00: 6d69 6c79 2e6c 6f77 6572 2829 5b3a 335d  mily.lower()[:3]
+00024b10: 0a20 2020 2020 2020 2073 686f 7274 5f73  .        short_s
+00024b20: 7479 6c65 202b 3d20 7374 7228 7365 6c66  tyle += str(self
+00024b30: 2e66 6f6e 745f 7369 7a65 292e 7265 706c  .font_size).repl
+00024b40: 6163 6528 222e 222c 2022 5f22 290a 2020  ace(".", "_").  
+00024b50: 2020 2020 2020 6966 2073 656c 662e 6973        if self.is
+00024b60: 5f62 6f6c 643a 0a20 2020 2020 2020 2020  _bold:.         
+00024b70: 2020 2073 686f 7274 5f73 7479 6c65 202b     short_style +
+00024b80: 3d20 2262 220a 2020 2020 2020 2020 6966  = "b".        if
+00024b90: 2073 656c 662e 6973 5f69 7461 6c69 633a   self.is_italic:
+00024ba0: 0a20 2020 2020 2020 2020 2020 2073 686f  .            sho
+00024bb0: 7274 5f73 7479 6c65 202b 3d20 2269 220a  rt_style += "i".
+00024bc0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00024bd0: 686f 7274 5f73 7479 6c65 0a0a 2020 2020  hort_style..    
+00024be0: 6465 6620 6765 745f 666f 6e74 5f61 7474  def get_font_att
+00024bf0: 7269 6275 7465 7328 7365 6c66 293a 0a20  ributes(self):. 
+00024c00: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00024c10: 2020 2073 6574 7320 3420 666f 6e74 2061     sets 4 font a
+00024c20: 7474 7269 6275 7465 7320 2877 6964 7468  ttributes (width
+00024c30: 2c20 7369 7a65 2c20 6e6f 6e73 7472 6f6b  , size, nonstrok
+00024c40: 652c 2073 7472 6f6b 652c 2066 6f6e 746e  e, stroke, fontn
+00024c50: 616d 650a 2020 2020 2020 2020 2222 220a  ame.        """.
+00024c60: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00024c70: 2e6e 616d 655f 7661 6c75 655f 6469 6374  .name_value_dict
+00024c80: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00024c90: 2020 2020 2020 7265 7475 726e 2028 4e6f        return (No
+00024ca0: 6e65 2c20 4e6f 6e65 2c20 4e6f 6e65 2c20  ne, None, None, 
+00024cb0: 4e6f 6e65 2c20 4e6f 6e65 290a 2020 2020  None, None).    
+00024cc0: 2020 2020 7265 7475 726e 2028 0a20 2020      return (.   
+00024cd0: 2020 2020 2020 2020 2023 2073 656c 662e           # self.
+00024ce0: 6e61 6d65 5f76 616c 7565 5f64 6963 742e  name_value_dict.
+00024cf0: 6765 7428 4353 5353 7479 6c65 2e57 4944  get(CSSStyle.WID
+00024d00: 5448 292c 0a20 2020 2020 2020 2020 2020  TH),.           
+00024d10: 2073 656c 662e 6765 745f 6174 7472 6962   self.get_attrib
+00024d20: 7574 6528 4353 5353 7479 6c65 2e46 4f4e  ute(CSSStyle.FON
+00024d30: 545f 5349 5a45 292c 0a20 2020 2020 2020  T_SIZE),.       
+00024d40: 2020 2020 2073 656c 662e 6765 745f 6174       self.get_at
+00024d50: 7472 6962 7574 6528 4353 5353 7479 6c65  tribute(CSSStyle
+00024d60: 2e46 494c 4c29 2c0a 2020 2020 2020 2020  .FILL),.        
+00024d70: 2020 2020 7365 6c66 2e67 6574 5f61 7474      self.get_att
+00024d80: 7269 6275 7465 2843 5353 5374 796c 652e  ribute(CSSStyle.
+00024d90: 5354 524f 4b45 292c 0a20 2020 2020 2020  STROKE),.       
+00024da0: 2020 2020 2073 656c 662e 6765 745f 6174       self.get_at
+00024db0: 7472 6962 7574 6528 4353 5353 7479 6c65  tribute(CSSStyle
+00024dc0: 2e46 4f4e 545f 4641 4d49 4c59 290a 2020  .FONT_FAMILY).  
+00024dd0: 2020 2020 2020 290a 0a20 2020 2040 636c        )..    @cl
+00024de0: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+00024df0: 6620 6765 745f 636f 6f72 6473 2863 6c73  f get_coords(cls
+00024e00: 2c20 656c 656d 293a 0a20 2020 2020 2020  , elem):.       
+00024e10: 2022 2222 0a20 2020 2020 2020 203a 7265   """.        :re
+00024e20: 7475 726e 3a20 7830 2c20 7831 2c20 7930  turn: x0, x1, y0
+00024e30: 2c20 7931 0a20 2020 2020 2020 2022 2222  , y1.        """
+00024e40: 0a20 2020 2020 2020 2063 7373 7320 3d20  .        csss = 
+00024e50: 636c 732e 6372 6561 7465 5f63 7373 5f73  cls.create_css_s
+00024e60: 7479 6c65 5f66 726f 6d5f 6174 7472 6962  tyle_from_attrib
+00024e70: 7574 655f 6f66 5f62 6f64 795f 656c 656d  ute_of_body_elem
+00024e80: 656e 7428 656c 656d 290a 2020 2020 2020  ent(elem).      
+00024e90: 2020 7830 203d 2063 7373 732e 6765 745f    x0 = csss.get_
+00024ea0: 6e75 6d65 7269 635f 6174 7476 616c 2822  numeric_attval("
+00024eb0: 7830 2229 0a20 2020 2020 2020 2078 3120  x0").        x1 
+00024ec0: 3d20 6373 7373 2e67 6574 5f6e 756d 6572  = csss.get_numer
+00024ed0: 6963 5f61 7474 7661 6c28 2278 3122 290a  ic_attval("x1").
+00024ee0: 2020 2020 2020 2020 7930 203d 2063 7373          y0 = css
+00024ef0: 732e 6765 745f 6e75 6d65 7269 635f 6174  s.get_numeric_at
+00024f00: 7476 616c 2822 7930 2229 0a20 2020 2020  tval("y0").     
+00024f10: 2020 2079 3120 3d20 6373 7373 2e67 6574     y1 = csss.get
+00024f20: 5f6e 756d 6572 6963 5f61 7474 7661 6c28  _numeric_attval(
+00024f30: 2279 3122 290a 2020 2020 2020 2020 7265  "y1").        re
+00024f40: 7475 726e 2028 7830 2c20 7930 2c20 7831  turn (x0, y0, x1
+00024f50: 2c20 7931 290a 0a20 2020 2040 636c 6173  , y1)..    @clas
+00024f60: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+00024f70: 6765 745f 7830 2863 6c73 2c20 656c 656d  get_x0(cls, elem
+00024f80: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+00024f90: 6e20 636c 732e 6765 745f 636f 6f72 6473  n cls.get_coords
+00024fa0: 2865 6c65 6d29 5b30 5d0a 0a20 2020 2040  (elem)[0]..    @
+00024fb0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+00024fc0: 6465 6620 6765 745f 7930 2863 6c73 2c20  def get_y0(cls, 
+00024fd0: 656c 656d 293a 0a20 2020 2020 2020 2072  elem):.        r
+00024fe0: 6574 7572 6e20 636c 732e 6765 745f 636f  eturn cls.get_co
+00024ff0: 6f72 6473 2865 6c65 6d29 5b31 5d0a 0a20  ords(elem)[1].. 
+00025000: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+00025010: 2020 2020 6465 6620 6765 745f 7831 2863      def get_x1(c
+00025020: 6c73 2c20 656c 656d 293a 0a20 2020 2020  ls, elem):.     
+00025030: 2020 2072 6574 7572 6e20 636c 732e 6765     return cls.ge
+00025040: 745f 636f 6f72 6473 2865 6c65 6d29 5b32  t_coords(elem)[2
+00025050: 5d0a 0a20 2020 2040 636c 6173 736d 6574  ]..    @classmet
+00025060: 686f 640a 2020 2020 6465 6620 6765 745f  hod.    def get_
+00025070: 7931 2863 6c73 2c20 656c 656d 293a 0a20  y1(cls, elem):. 
+00025080: 2020 2020 2020 2072 6574 7572 6e20 636c         return cl
+00025090: 732e 6765 745f 636f 6f72 6473 2865 6c65  s.get_coords(ele
+000250a0: 6d29 5b33 5d0a 0a20 2020 2040 636c 6173  m)[3]..    @clas
+000250b0: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+000250c0: 6578 7472 6163 745f 636f 6f72 6473 5f61  extract_coords_a
+000250d0: 6e64 5f66 6f6e 745f 7072 6f70 6572 7469  nd_font_properti
+000250e0: 6573 2863 6c73 2c20 7370 616e 293a 0a20  es(cls, span):. 
+000250f0: 2020 2020 2020 2063 7373 7320 3d20 4353         csss = CS
+00025100: 5353 7479 6c65 2e63 7265 6174 655f 6373  SStyle.create_cs
+00025110: 735f 7374 796c 655f 6672 6f6d 5f61 7474  s_style_from_att
+00025120: 7269 6275 7465 5f6f 665f 626f 6479 5f65  ribute_of_body_e
+00025130: 6c65 6d65 6e74 2873 7061 6e29 0a20 2020  lement(span).   
+00025140: 2020 2020 2066 6f6e 745f 7369 7a65 203d       font_size =
+00025150: 2063 7373 732e 6765 745f 6e75 6d65 7269   csss.get_numeri
+00025160: 635f 6174 7476 616c 2843 5353 5374 796c  c_attval(CSSStyl
+00025170: 652e 464f 4e54 5f53 495a 4529 0a20 2020  e.FONT_SIZE).   
+00025180: 2020 2020 2079 3020 3d20 6373 7373 2e67       y0 = csss.g
+00025190: 6574 5f6e 756d 6572 6963 5f61 7474 7661  et_numeric_attva
+000251a0: 6c28 2279 3022 290a 2020 2020 2020 2020  l("y0").        
+000251b0: 7931 203d 2063 7373 732e 6765 745f 6e75  y1 = csss.get_nu
+000251c0: 6d65 7269 635f 6174 7476 616c 2822 7931  meric_attval("y1
+000251d0: 2229 0a20 2020 2020 2020 2078 3120 3d20  ").        x1 = 
+000251e0: 6373 7373 2e67 6574 5f6e 756d 6572 6963  csss.get_numeric
+000251f0: 5f61 7474 7661 6c28 2278 3122 290a 2020  _attval("x1").  
+00025200: 2020 2020 2020 7265 7475 726e 2066 6f6e        return fon
+00025210: 745f 7369 7a65 2c20 7930 2c20 7931 0a0a  t_size, y0, y1..
+00025220: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+00025230: 0a20 2020 2064 6566 2065 7874 7261 6374  .    def extract
+00025240: 5f62 6f6c 645f 6974 616c 6963 5f66 726f  _bold_italic_fro
+00025250: 6d5f 666f 6e74 5f66 616d 696c 795f 666f  m_font_family_fo
+00025260: 725f 7374 796c 6573 2863 6c73 2c20 7374  r_styles(cls, st
+00025270: 796c 6573 293a 0a20 2020 2020 2020 2022  yles):.        "
+00025280: 2222 0a20 2020 2020 2020 203a 7374 796c  "".        :styl
+00025290: 6573 3a20 6c69 7374 206f 6620 4353 5353  es: list of CSSS
+000252a0: 7479 6c65 206f 626a 6563 7473 2074 6f20  tyle objects to 
+000252b0: 6e6f 726d 616c 697a 650a 0a20 2020 2020  normalize..     
+000252c0: 2020 2022 2222 0a20 2020 2020 2020 2065     """.        e
+000252d0: 7874 7261 6374 6564 203d 205b 5d0a 2020  xtracted = [].  
+000252e0: 2020 2020 2020 666f 7220 7374 796c 6520        for style 
+000252f0: 696e 2073 7479 6c65 733a 0a20 2020 2020  in styles:.     
+00025300: 2020 2020 2020 2069 6620 7374 796c 653a         if style:
+00025310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025320: 2065 7874 7261 6374 6564 2e61 7070 656e   extracted.appen
+00025330: 6428 636c 732e 6578 7472 6163 745f 626f  d(cls.extract_bo
+00025340: 6c64 5f69 7461 6c69 635f 6672 6f6d 5f66  ld_italic_from_f
+00025350: 6f6e 745f 6661 6d69 6c79 5f66 6f72 5f73  ont_family_for_s
+00025360: 7479 6c65 2873 7479 6c65 2929 0a20 2020  tyle(style)).   
+00025370: 2020 2020 2072 6574 7572 6e20 6578 7472       return extr
+00025380: 6163 7465 640a 0a20 2020 2040 636c 6173  acted..    @clas
+00025390: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+000253a0: 6578 7472 6163 745f 626f 6c64 5f69 7461  extract_bold_ita
+000253b0: 6c69 635f 6672 6f6d 5f66 6f6e 745f 6661  lic_from_font_fa
+000253c0: 6d69 6c79 5f66 6f72 5f73 7479 6c65 2863  mily_for_style(c
+000253d0: 6c73 2c20 7374 796c 655f 7329 3a0a 2020  ls, style_s):.  
+000253e0: 2020 2020 2020 6966 206e 6f74 2073 7479        if not sty
+000253f0: 6c65 5f73 3a0a 2020 2020 2020 2020 2020  le_s:.          
+00025400: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00025410: 6f72 2822 7374 796c 655f 7320 6973 204e  or("style_s is N
+00025420: 6f6e 6522 290a 2020 2020 2020 2020 6373  one").        cs
+00025430: 735f 7374 796c 6520 3d20 4353 5353 7479  s_style = CSSSty
+00025440: 6c65 2e63 7265 6174 655f 6373 735f 7374  le.create_css_st
+00025450: 796c 655f 6672 6f6d 5f63 7373 5f73 7472  yle_from_css_str
+00025460: 696e 6728 7374 7228 7374 796c 655f 7329  ing(str(style_s)
+00025470: 290a 2020 2020 2020 2020 6966 2063 7373  ).        if css
+00025480: 5f73 7479 6c65 3a0a 2020 2020 2020 2020  _style:.        
+00025490: 2020 2020 6373 735f 7374 796c 652e 6578      css_style.ex
+000254a0: 7472 6163 745f 626f 6c64 5f69 7461 6c69  tract_bold_itali
+000254b0: 635f 6672 6f6d 5f66 6f6e 745f 6661 6d69  c_from_font_fami
+000254c0: 6c79 280a 2020 2020 2020 2020 2020 2020  ly(.            
+000254d0: 2020 2020 6f76 6572 7772 6974 655f 6661      overwrite_fa
+000254e0: 6d69 6c79 3d54 7275 652c 206f 7665 7277  mily=True, overw
+000254f0: 7269 7465 5f62 6f6c 643d 5472 7565 2c20  rite_bold=True, 
+00025500: 6f76 6572 7772 6974 655f 7374 796c 653d  overwrite_style=
+00025510: 5472 7565 290a 2020 2020 2020 2020 7265  True).        re
+00025520: 7475 726e 2063 7373 5f73 7479 6c65 0a0a  turn css_style..
+00025530: 0a63 6c61 7373 2043 5353 436f 6e76 6572  .class CSSConver
+00025540: 7465 723a 0a20 2020 2022 2222 0a20 2020  ter:.    """.   
+00025550: 2074 7572 6e73 2043 4353 2073 7479 6c65   turns CCS style
+00025560: 7320 696e 746f 2068 746d 6c20 636c 6173  s into html clas
+00025570: 7365 730a 2020 2020 2222 220a 0a20 2020  ses.    """..   
+00025580: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+00025590: 6c66 293a 0a20 2020 2020 2020 2070 6173  lf):.        pas
+000255a0: 730a 0a20 2020 2064 6566 2072 6561 645f  s..    def read_
+000255b0: 6874 6d6c 5f65 6c65 6d65 6e74 2873 656c  html_element(sel
+000255c0: 662c 2068 746d 6c5f 656c 656d 293a 0a20  f, html_elem):. 
+000255d0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000255e0: 2020 2072 6561 6473 2061 6e64 2063 6f6e     reads and con
+000255f0: 7665 7274 7320 6874 6d6c 2065 6c65 6d65  verts html eleme
+00025600: 6e74 2e0a 2020 2020 2020 2020 6164 6473  nt..        adds
+00025610: 203c 6874 6d6c 3e20 6173 2072 6f6f 7420   <html> as root 
+00025620: 6966 206e 6f74 2070 7265 7365 6e74 0a20  if not present. 
+00025630: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00025640: 2020 2073 656c 662e 6874 6d6c 5f65 6c65     self.html_ele
+00025650: 6d20 3d20 6874 6d6c 5f65 6c65 6d0a 2020  m = html_elem.  
+00025660: 2020 2020 2020 7365 6c66 2e68 746d 6c5f        self.html_
+00025670: 656c 656d 203d 2048 746d 6c54 6964 792e  elem = HtmlTidy.
+00025680: 656e 7375 7265 5f68 746d 6c5f 6865 6164  ensure_html_head
+00025690: 5f62 6f64 7928 7365 6c66 2e68 746d 6c5f  _body(self.html_
+000256a0: 656c 656d 290a 2020 2020 2020 2020 7265  elem).        re
+000256b0: 7475 726e 2073 656c 662e 6874 6d6c 5f65  turn self.html_e
+000256c0: 6c65 6d0a 0a63 6c61 7373 2046 6f6e 7450  lem..class FontP
+000256d0: 726f 7065 7274 7928 456e 756d 293a 0a20  roperty(Enum):. 
+000256e0: 2020 2022 2222 0a20 2020 2041 7269 616c     """.    Arial
+000256f0: 4e61 7272 6f77 0a20 2020 2041 7269 616c  Narrow.    Arial
+00025700: 4e61 7272 6f77 2d42 6f6c 640a 2020 2020  Narrow-Bold.    
+00025710: 4361 6c69 6272 690a 2020 2020 4672 7574  Calibri.    Frut
+00025720: 6967 6572 4c54 5072 6f2d 426c 6163 6b43  igerLTPro-BlackC
+00025730: 6e0a 2020 2020 4672 7574 6967 6572 4c54  n.    FrutigerLT
+00025740: 5072 6f2d 426f 6c64 436e 0a20 2020 2046  Pro-BoldCn.    F
+00025750: 7275 7469 6765 724c 5450 726f 2d42 6f6c  rutigerLTPro-Bol
+00025760: 6443 6e49 7461 0a20 2020 2046 7275 7469  dCnIta.    Fruti
+00025770: 6765 724c 5450 726f 2d43 6f6e 6465 6e73  gerLTPro-Condens
+00025780: 6564 0a20 2020 2046 7275 7469 6765 724c  ed.    FrutigerL
+00025790: 5450 726f 2d43 6f6e 6465 6e73 6564 4974  TPro-CondensedIt
+000257a0: 610a 2020 2020 4672 7574 6967 6572 4c54  a.    FrutigerLT
+000257b0: 5072 6f2d 4c69 6768 740a 2020 2020 4672  Pro-Light.    Fr
+000257c0: 7574 6967 6572 4c54 5072 6f2d 4c69 6768  utigerLTPro-Ligh
+000257d0: 7443 6e0a 2020 2020 4672 7574 6967 6572  tCn.    Frutiger
+000257e0: 4c54 5072 6f2d 4c69 6768 7443 6e49 7461  LTPro-LightCnIta
+000257f0: 0a20 2020 2046 7275 7469 6765 724c 5450  .    FrutigerLTP
+00025800: 726f 2d52 6f6d 616e 0a20 2020 2022 2222  ro-Roman.    """
+00025810: 0a20 2020 2023 0a20 2020 204e 4f52 4d41  .    #.    NORMA
+00025820: 4c20 3d20 2222 0a0a 2020 2020 4e41 5252  L = ""..    NARR
+00025830: 4f57 203d 2022 6e61 7272 6f77 220a 2020  OW = "narrow".  
+00025840: 2020 5749 4445 203d 2022 7769 6465 220a    WIDE = "wide".
+00025850: 0a20 2020 204c 4947 4854 203d 2022 6c69  .    LIGHT = "li
+00025860: 6768 7422 0a20 2020 2042 4f4c 4420 3d20  ght".    BOLD = 
+00025870: 2262 6f6c 6422 0a0a 2020 2020 4954 414c  "bold"..    ITAL
+00025880: 4943 203d 2022 6974 616c 6963 220a 0a20  IC = "italic".. 
+00025890: 2020 2053 414e 5320 3d20 2273 616e 7322     SANS = "sans"
+000258a0: 0a20 2020 2053 4552 4946 203d 2022 7365  .    SERIF = "se
+000258b0: 7269 6622 0a20 2020 2053 594d 424f 4c20  rif".    SYMBOL 
+000258c0: 3d20 2273 796d 626f 6c22 0a20 2020 204d  = "symbol".    M
+000258d0: 4f4e 4f53 5041 4345 203d 2022 736f 6e6f  ONOSPACE = "sono
+000258e0: 7370 6163 6522 0a0a 2020 2020 6465 6620  space"..    def 
+000258f0: 5f5f 7374 725f 5f28 7365 6c66 293a 0a20  __str__(self):. 
+00025900: 2020 2020 2020 2072 6574 7572 6e20 7374         return st
+00025910: 7228 7365 6c66 2e76 616c 7565 290a 0a20  r(self.value).. 
+00025920: 2020 2064 6566 205f 5f72 6570 725f 5f28     def __repr__(
+00025930: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
+00025940: 6574 7572 6e20 7374 7228 7365 6c66 2e76  eturn str(self.v
+00025950: 616c 7565 290a 0a23 2073 7472 6970 7320  alue)..# strips 
+00025960: 7072 6566 6978 206f 6666 2066 6f6e 742d  prefix off font-
+00025970: 6e61 6d65 730a 5245 5f50 5245 4620 3d20  names.RE_PREF = 
+00025980: 7265 2e63 6f6d 7069 6c65 2822 5b41 2d5a  re.compile("[A-Z
+00025990: 5d7b 367d 5c5c 2b28 3f50 3c6e 616d 653e  ]{6}\\+(?P<name>
+000259a0: 5b5e 5c5c 735d 2b29 5c5c 732a 2229 0a63  [^\\s]+)\\s*").c
+000259b0: 6c61 7373 2041 6d69 466f 6e74 3a0a 2020  lass AmiFont:.  
+000259c0: 2020 2222 220a 2020 2020 656d 7069 7269    """.    empiri
+000259d0: 6361 6c20 6e6f 726d 616c 697a 6174 696f  cal normalizatio
+000259e0: 6e20 6f66 2066 6f6e 7473 2e20 5472 6965  n of fonts. Trie
+000259f0: 7320 746f 2063 6f6e 7665 7274 2061 6c6c  s to convert all
+00025a00: 2074 6f20 7468 650a 2020 2020 6261 7365   to the.    base
+00025a10: 0a20 2020 2066 6f6e 742d 6661 6d69 6c79  .    font-family
+00025a20: 3a20 7365 7269 662f 7361 6e73 2d73 6572  : serif/sans-ser
+00025a30: 6966 2f6d 6f6e 6f73 7061 6365 0a20 2020  if/monospace.   
+00025a40: 2066 6f6e 742d 7374 7265 7463 683a 2028   font-stretch: (
+00025a50: 636f 6e64 656e 7365 642f 6e6f 726d 616c  condensed/normal
+00025a60: 2f65 7870 616e 6465 6429 0a20 2020 2066  /expanded).    f
+00025a70: 6f72 6e2d 7765 6967 6874 3a20 6e6f 726d  orn-weight: norm
+00025a80: 616c 2f62 6f6c 640a 2020 2020 666f 6e74  al/bold.    font
+00025a90: 2d73 7479 6c65 3a20 6e6f 726d 616c 2f69  -style: normal/i
+00025aa0: 7461 6c69 630a 2020 2020 2222 220a 0a0a  talic.    """...
+00025ab0: 2020 2020 2320 656d 7069 7269 6361 6c20      # empirical 
+00025ac0: 636f 6e76 6572 7369 6f6e 733b 2077 696c  conversions; wil
+00025ad0: 6c20 6e65 6564 2074 6f20 6265 2075 7064  l need to be upd
+00025ae0: 6174 6564 2066 7265 7175 656e 746c 790a  ated frequently.
+00025af0: 2020 2020 636f 6e76 6572 7369 6f6e 5f64      conversion_d
+00025b00: 6963 7420 3d20 7b0a 2020 2020 2020 2020  ict = {.        
+00025b10: 2241 7269 616c 223a 2046 6f6e 7450 726f  "Arial": FontPro
+00025b20: 7065 7274 792e 5341 4e53 2c0a 2020 2020  perty.SANS,.    
+00025b30: 2020 2020 2243 616c 6962 7269 223a 2046      "Calibri": F
+00025b40: 6f6e 7450 726f 7065 7274 792e 5341 4e53  ontProperty.SANS
+00025b50: 2c0a 2020 2020 2020 2020 2246 7275 7469  ,.        "Fruti
+00025b60: 6765 7222 3a20 466f 6e74 5072 6f70 6572  ger": FontProper
+00025b70: 7479 2e53 414e 532c 0a20 2020 2020 2020  ty.SANS,.       
+00025b80: 2022 4865 6c76 6574 6963 6122 3a20 466f   "Helvetica": Fo
+00025b90: 6e74 5072 6f70 6572 7479 2e53 414e 532c  ntProperty.SANS,
+00025ba0: 0a0a 2020 2020 2020 2020 2254 696d 6573  ..        "Times
+00025bb0: 223a 2046 6f6e 7450 726f 7065 7274 792e  ": FontProperty.
+00025bc0: 5345 5249 462c 0a0a 2020 2020 2020 2020  SERIF,..        
+00025bd0: 2243 6f75 7269 6572 223a 2046 6f6e 7450  "Courier": FontP
+00025be0: 726f 7065 7274 792e 4d4f 4e4f 5350 4143  roperty.MONOSPAC
+00025bf0: 452c 0a0a 2020 2020 2020 2020 2253 796d  E,..        "Sym
+00025c00: 626f 6c22 3a20 466f 6e74 5072 6f70 6572  bol": FontProper
+00025c10: 7479 2e53 594d 424f 4c2c 0a20 2020 207d  ty.SYMBOL,.    }
+00025c20: 0a0a 2020 2020 636f 6e64 5f72 6567 6578  ..    cond_regex
+00025c30: 203d 2072 652e 636f 6d70 696c 6528 2228   = re.compile("(
+00025c40: 2e2a 2928 436f 6e64 656e 7365 647c 436e  .*)(Condensed|Cn
+00025c50: 7c4e 6172 726f 7729 282e 2a29 2229 0a20  |Narrow)(.*)"). 
+00025c60: 2020 2077 6964 655f 7265 6765 7820 3d20     wide_regex = 
+00025c70: 7265 2e63 6f6d 7069 6c65 2822 282e 2a29  re.compile("(.*)
+00025c80: 2857 6964 6529 282e 2a29 2229 0a0a 2020  (Wide)(.*)")..  
+00025c90: 2020 6c69 6768 745f 7265 6765 7820 3d20    light_regex = 
+00025ca0: 7265 2e63 6f6d 7069 6c65 2822 282e 2a29  re.compile("(.*)
+00025cb0: 284c 6967 6874 7c54 6869 6e29 282e 2a29  (Light|Thin)(.*)
+00025cc0: 2229 0a20 2020 2062 6f6c 645f 7265 6765  ").    bold_rege
+00025cd0: 7820 3d20 7265 2e63 6f6d 7069 6c65 2822  x = re.compile("
+00025ce0: 282e 2a29 2842 6f6c 647c 4865 6176 7977  (.*)(Bold|Heavyw
+00025cf0: 6569 6768 747c 426c 6163 6b29 282e 2a29  eight|Black)(.*)
+00025d00: 2229 0a0a 2020 2020 7374 796c 655f 7265  ")..    style_re
+00025d10: 6765 7820 3d20 7265 2e63 6f6d 7069 6c65  gex = re.compile
+00025d20: 2822 282e 2a29 2849 7461 6c69 637c 4974  ("(.*)(Italic|It
+00025d30: 617c 4f62 6c69 7175 6529 282e 2a29 2229  a|Oblique)(.*)")
+00025d40: 0a0a 2320 2020 2063 6c61 7373 2041 6d69  ..#    class Ami
+00025d50: 466f 6e74 3a0a 0a20 2020 2064 6566 205f  Font:..    def _
+00025d60: 5f69 6e69 745f 5f28 7365 6c66 293a 0a20  _init__(self):. 
+00025d70: 2020 2020 2020 2073 656c 662e 6e61 6d65         self.name
+00025d80: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+00025d90: 7365 6c66 2e66 616d 696c 7920 3d20 4e6f  self.family = No
+00025da0: 6e65 0a20 2020 2020 2020 2073 656c 662e  ne.        self.
+00025db0: 7765 6967 6874 203d 2073 7472 2846 6f6e  weight = str(Fon
+00025dc0: 7450 726f 7065 7274 792e 4e4f 524d 414c  tProperty.NORMAL
+00025dd0: 290a 2020 2020 2020 2020 7365 6c66 2e73  ).        self.s
+00025de0: 7479 6c65 203d 2073 7472 2846 6f6e 7450  tyle = str(FontP
+00025df0: 726f 7065 7274 792e 4e4f 524d 414c 290a  roperty.NORMAL).
+00025e00: 2020 2020 2020 2020 7365 6c66 2e73 7472          self.str
+00025e10: 6574 6368 6564 203d 2073 7472 2846 6f6e  etched = str(Fon
+00025e20: 7450 726f 7065 7274 792e 4e4f 524d 414c  tProperty.NORMAL
+00025e30: 290a 2020 2020 2020 2020 7365 6c66 2e66  ).        self.f
+00025e40: 6f6e 7420 3d20 7374 7228 466f 6e74 5072  ont = str(FontPr
+00025e50: 6f70 6572 7479 2e53 414e 5329 0a0a 2020  operty.SANS)..  
+00025e60: 2020 2320 2020 2063 6c61 7373 2041 6d69    #    class Ami
+00025e70: 466f 6e74 3a0a 0a20 2020 2064 6566 205f  Font:..    def _
+00025e80: 5f73 7472 5f5f 2873 656c 6629 3a0a 2020  _str__(self):.  
+00025e90: 2020 2020 2020 7320 3d20 6622 6e61 6d65        s = f"name
+00025ea0: 3a7b 7365 6c66 2e6e 616d 657d 3b66 616d  :{self.name};fam
+00025eb0: 696c 793a 7b73 656c 662e 6661 6d69 6c79  ily:{self.family
+00025ec0: 7d3b 7765 6967 6874 3a7b 7365 6c66 2e77  };weight:{self.w
+00025ed0: 6569 6768 747d 3b73 7479 6c65 3a7b 7365  eight};style:{se
+00025ee0: 6c66 2e73 7479 6c65 7d3b 7374 7265 7463  lf.style};stretc
+00025ef0: 6865 643a 7b73 656c 662e 7374 7265 7463  hed:{self.stretc
+00025f00: 6865 647d 3b66 6f6e 743a 7b73 656c 662e  hed};font:{self.
+00025f10: 666f 6e74 7d22 0a20 2020 2020 2020 2072  font}".        r
+00025f20: 6574 7572 6e20 730a 0a20 2020 2040 636c  eturn s..    @cl
+00025f30: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+00025f40: 6620 6578 7472 6163 745f 6e61 6d65 5f77  f extract_name_w
+00025f50: 6569 6768 745f 7374 796c 655f 7374 7265  eight_style_stre
+00025f60: 7463 6865 645f 6173 5f66 6f6e 7428 636c  tched_as_font(cl
+00025f70: 732c 206e 616d 6530 293a 0a0a 2020 2020  s, name0):..    
+00025f80: 2020 2020 666f 6e74 203d 2041 6d69 466f      font = AmiFo
+00025f90: 6e74 2829 0a20 2020 2020 2020 206e 616d  nt().        nam
+00025fa0: 6520 3d20 416d 6946 6f6e 742e 7472 696d  e = AmiFont.trim
+00025fb0: 5f70 6466 5f70 7265 6669 7828 6e61 6d65  _pdf_prefix(name
+00025fc0: 3029 0a0a 2020 2020 2020 2020 7768 696c  0)..        whil
+00025fd0: 6520 5472 7565 3a0a 2020 2020 2020 2020  e True:.        
+00025fe0: 2020 2020 6e61 6d65 2c20 6d61 7463 6820      name, match 
+00025ff0: 3d20 636c 732e 6578 7472 6163 745f 656e  = cls.extract_en
+00026000: 756d 6572 6174 6564 5f73 7479 6c65 7328  umerated_styles(
+00026010: 666f 6e74 2c20 6e61 6d65 290a 2020 2020  font, name).    
+00026020: 2020 2020 2020 2020 6966 206e 6f74 206d          if not m
+00026030: 6174 6368 3a0a 2020 2020 2020 2020 2020  atch:.          
+00026040: 2020 2020 2020 6272 6561 6b0a 0a20 2020        break..   
+00026050: 2020 2020 206e 616d 6520 3d20 6e61 6d65       name = name
+00026060: 2e72 6570 6c61 6365 2822 2d22 2c22 2229  .replace("-","")
+00026070: 0a0a 2020 2020 2020 2020 666f 6e74 2e66  ..        font.f
+00026080: 616d 696c 7920 3d20 6e61 6d65 0a20 2020  amily = name.   
+00026090: 2020 2020 2066 6f6e 742e 6e61 6d65 203d       font.name =
+000260a0: 206e 616d 6530 0a20 2020 2020 2020 2072   name0.        r
+000260b0: 6574 7572 6e20 666f 6e74 0a0a 2020 2020  eturn font..    
+000260c0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+000260d0: 2064 6566 2065 7874 7261 6374 5f65 6e75   def extract_enu
+000260e0: 6d65 7261 7465 645f 7374 796c 6573 2863  merated_styles(c
+000260f0: 6c73 2c20 666f 6e74 2c20 6e61 6d65 293a  ls, font, name):
+00026100: 0a0a 2020 2020 2020 2020 6e61 6d65 2c20  ..        name, 
+00026110: 6d61 7463 6820 3d20 636c 732e 6d61 7463  match = cls.matc
+00026120: 685f 666f 6e74 5f70 726f 7065 7274 7928  h_font_property(
+00026130: 6e61 6d65 2c20 416d 6946 6f6e 742e 636f  name, AmiFont.co
+00026140: 6e64 5f72 6567 6578 290a 2020 2020 2020  nd_regex).      
+00026150: 2020 6966 206d 6174 6368 3a0a 2020 2020    if match:.    
+00026160: 2020 2020 2020 2020 666f 6e74 2e73 7472          font.str
+00026170: 6574 6368 6564 203d 2046 6f6e 7450 726f  etched = FontPro
+00026180: 7065 7274 792e 4e41 5252 4f57 0a20 2020  perty.NARROW.   
+00026190: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000261a0: 6e61 6d65 2c20 6d61 7463 680a 2020 2020  name, match.    
+000261b0: 2020 2020 6e61 6d65 2c20 6d61 7463 6820      name, match 
+000261c0: 3d20 636c 732e 6d61 7463 685f 666f 6e74  = cls.match_font
+000261d0: 5f70 726f 7065 7274 7928 6e61 6d65 2c20  _property(name, 
+000261e0: 416d 6946 6f6e 742e 7769 6465 5f72 6567  AmiFont.wide_reg
+000261f0: 6578 290a 2020 2020 2020 2020 6966 206d  ex).        if m
+00026200: 6174 6368 3a0a 2020 2020 2020 2020 2020  atch:.          
+00026210: 2020 666f 6e74 2e73 7472 6574 6368 6564    font.stretched
+00026220: 203d 2046 6f6e 7450 726f 7065 7274 792e   = FontProperty.
+00026230: 5749 4445 0a20 2020 2020 2020 2020 2020  WIDE.           
+00026240: 2072 6574 7572 6e20 6e61 6d65 2c20 6d61   return name, ma
+00026250: 7463 680a 2020 2020 2020 2020 6e61 6d65  tch.        name
+00026260: 2c20 6d61 7463 6820 3d20 636c 732e 6d61  , match = cls.ma
+00026270: 7463 685f 666f 6e74 5f70 726f 7065 7274  tch_font_propert
+00026280: 7928 6e61 6d65 2c20 416d 6946 6f6e 742e  y(name, AmiFont.
+00026290: 6c69 6768 745f 7265 6765 7829 0a20 2020  light_regex).   
+000262a0: 2020 2020 2069 6620 6d61 7463 683a 0a20       if match:. 
+000262b0: 2020 2020 2020 2020 2020 2066 6f6e 742e             font.
+000262c0: 7765 6967 6874 203d 2046 6f6e 7450 726f  weight = FontPro
+000262d0: 7065 7274 792e 4c49 4748 540a 2020 2020  perty.LIGHT.    
+000262e0: 2020 2020 2020 2020 7265 7475 726e 206e          return n
+000262f0: 616d 652c 206d 6174 6368 0a20 2020 2020  ame, match.     
+00026300: 2020 206e 616d 652c 206d 6174 6368 203d     name, match =
+00026310: 2063 6c73 2e6d 6174 6368 5f66 6f6e 745f   cls.match_font_
+00026320: 7072 6f70 6572 7479 286e 616d 652c 2041  property(name, A
+00026330: 6d69 466f 6e74 2e62 6f6c 645f 7265 6765  miFont.bold_rege
+00026340: 7829 0a20 2020 2020 2020 2069 6620 6d61  x).        if ma
+00026350: 7463 683a 0a20 2020 2020 2020 2020 2020  tch:.           
+00026360: 2066 6f6e 742e 7765 6967 6874 203d 2046   font.weight = F
+00026370: 6f6e 7450 726f 7065 7274 792e 424f 4c44  ontProperty.BOLD
+00026380: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00026390: 7572 6e20 6e61 6d65 2c20 6d61 7463 680a  urn name, match.
+000263a0: 0a20 2020 2020 2020 206e 616d 652c 206d  .        name, m
+000263b0: 6174 6368 203d 2063 6c73 2e6d 6174 6368  atch = cls.match
+000263c0: 5f66 6f6e 745f 7072 6f70 6572 7479 286e  _font_property(n
+000263d0: 616d 652c 2041 6d69 466f 6e74 2e73 7479  ame, AmiFont.sty
+000263e0: 6c65 5f72 6567 6578 290a 2020 2020 2020  le_regex).      
+000263f0: 2020 6966 206d 6174 6368 3a0a 2020 2020    if match:.    
+00026400: 2020 2020 2020 2020 666f 6e74 2e73 7479          font.sty
+00026410: 6c65 203d 2046 6f6e 7450 726f 7065 7274  le = FontPropert
+00026420: 792e 4954 414c 4943 0a20 2020 2020 2020  y.ITALIC.       
+00026430: 2020 2020 2072 6574 7572 6e20 6e61 6d65       return name
+00026440: 2c20 6d61 7463 680a 0a20 2020 2020 2020  , match..       
+00026450: 2072 6574 7572 6e20 6e61 6d65 2c20 4e6f   return name, No
+00026460: 6e65 0a0a 2020 2020 2320 2020 2063 6c61  ne..    #    cla
+00026470: 7373 2041 6d69 466f 6e74 3a0a 0a20 2020  ss AmiFont:..   
+00026480: 2022 2222 0a20 2020 2042 6f6c 6420 466f   """.    Bold Fo
+00026490: 6e74 733a 2031 2e20 4172 6961 6c0a 2020  nts: 1. Arial.  
+000264a0: 2020 4361 6c69 6272 690a 2020 2020 4365    Calibri.    Ce
+000264b0: 6e74 7572 7920 476f 7468 6963 0a20 2020  ntury Gothic.   
+000264c0: 2020 426f 6c64 2034 2e20 0a20 2020 2020    Bold 4. .     
+000264d0: 4672 616e 6b6c 696e 2047 6f74 6869 6320  Franklin Gothic 
+000264e0: 0a20 2020 2020 426f 6c64 2035 2e20 0a20  .     Bold 5. . 
+000264f0: 2020 2020 4675 7475 7261 2042 6f6c 6420      Futura Bold 
+00026500: 362e 200a 2020 2020 2047 696c 6c20 5361  6. .     Gill Sa
+00026510: 6e73 2042 6f6c 6420 372e 200a 2020 2020  ns Bold 7. .    
+00026520: 4865 6c76 6574 6963 6120 426f 6c64 2038  Helvetica Bold 8
+00026530: 2e20 0a20 2020 2049 6d70 6163 7420 426f  . .    Impact Bo
+00026540: 6c64 2039 2e0a 2020 2020 4c75 6369 6461  ld 9..    Lucida
+00026550: 2053 616e 7320 426f 6c64 2031 302e 200a   Sans Bold 10. .
+00026560: 2020 2020 4d79 7269 6164 2050 726f 2042      Myriad Pro B
+00026570: 6f6c 6420 3131 2e20 4f70 656e 2053 616e  old 11. Open San
+00026580: 7320 426f 6c64 2031 322e 2050 616c 6174  s Bold 12. Palat
+00026590: 696e 6f20 426f 6c64 2031 332e 2052 6f63  ino Bold 13. Roc
+000265a0: 6b77 656c 6c20 426f 6c64 2031 342e 200a  kwell Bold 14. .
+000265b0: 2020 2020 5365 676f 6520 5549 2042 6f6c      Segoe UI Bol
+000265c0: 6420 3135 2e20 5469 6d65 7320 4e65 7720  d 15. Times New 
+000265d0: 526f 6d61 6e20 426f 6c64 2031 362e 2055  Roman Bold 16. U
+000265e0: 6e69 7665 7273 2042 6f6c 6420 3137 2e20  nivers Bold 17. 
+000265f0: 5665 7264 616e 6120 426f 6c64 2031 382e  Verdana Bold 18.
+00026600: 2041 7665 6e69 7220 426f 6c64 2031 392e   Avenir Bold 19.
+00026610: 2042 6173 6b65 7276 696c 6c65 2042 6f6c   Baskerville Bol
+00026620: 6420 3230 2e20 436c 6172 656e 646f 6e20  d 20. Clarendon 
+00026630: 426f 6c64 2032 312e 2043 0a20 2020 206f  Bold 21. C.    o
+00026640: 7070 6572 706c 6174 6520 426f 6c64 2032  pperplate Bold 2
+00026650: 322e 2044 6964 6f74 2042 6f6c 6420 3233  2. Didot Bold 23
+00026660: 2e20 4575 726f 7374 696c 6520 426f 6c64  . Eurostile Bold
+00026670: 2032 342e 2046 7275 7469 6765 7220 426f   24. Frutiger Bo
+00026680: 6c64 2032 352e 2047 6172 616d 6f6e 6420  ld 25. Garamond 
+00026690: 426f 6c64 2032 362e 2047 656f 7267 6961  Bold 26. Georgia
+000266a0: 2042 6f6c 6420 3237 2e20 476f 7468 616d   Bold 27. Gotham
+000266b0: 2042 6f6c 6420 3238 2e20 0a20 2020 2048   Bold 28. .    H
+000266c0: 6f65 666c 6572 2054 6578 7420 426f 6c64  oefler Text Bold
+000266d0: 2032 392e 2049 5443 2041 7661 6e74 2047   29. ITC Avant G
+000266e0: 6172 6465 2047 6f74 6869 6320 426f 6c64  arde Gothic Bold
+000266f0: 2033 302e 2049 5443 2046 7261 6e6b 6c69   30. ITC Frankli
+00026700: 6e20 476f 7468 6963 2042 6f6c 6420 3331  n Gothic Bold 31
+00026710: 2e20 4954 4320 4c75 6261 6c69 6e20 4772  . ITC Lubalin Gr
+00026720: 6170 6820 426f 6c64 2033 322e 200a 2020  aph Bold 32. .  
+00026730: 2020 4954 4320 4f66 6669 6369 6e61 2053    ITC Officina S
+00026740: 616e 7320 426f 6c64 2033 332e 2049 5443  ans Bold 33. ITC
+00026750: 2053 746f 6e65 2053 616e 7320 426f 6c64   Stone Sans Bold
+00026760: 2033 342e 204d 696e 696f 6e20 5072 6f20   34. Minion Pro 
+00026770: 426f 6c64 2033 352e 204d 7573 656f 2053  Bold 35. Museo S
+00026780: 616e 7320 426f 6c64 2033 362e 204e 6575  ans Bold 36. Neu
+00026790: 7472 6166 6163 6520 426f 6c64 2033 372e  traface Bold 37.
+000267a0: 200a 2020 2020 4f70 7469 6d61 2042 6f6c   .    Optima Bol
+000267b0: 6420 3338 2e20 5072 6f78 696d 6120 4e6f  d 38. Proxima No
+000267c0: 7661 2042 6f6c 6420 3339 2e20 526f 626f  va Bold 39. Robo
+000267d0: 746f 2042 6f6c 6420 3430 2e20 5361 626f  to Bold 40. Sabo
+000267e0: 6e20 426f 6c64 2034 312e 2054 7261 6465  n Bold 41. Trade
+000267f0: 2047 6f74 6869 6320 426f 6c64 2034 322e   Gothic Bold 42.
+00026800: 200a 2020 2020 5472 6562 7563 6865 7420   .    Trebuchet 
+00026810: 4d53 2042 6f6c 6420 3433 2e20 0a20 2020  MS Bold 43. .   
+00026820: 2055 6275 6e74 7520 426f 6c64 2034 342e   Ubuntu Bold 44.
+00026830: 200a 2020 2020 5641 4720 526f 756e 6465   .    VAG Rounde
+00026840: 6420 426f 6c64 2034 352e 200a 2020 2020  d Bold 45. .    
+00026850: 5768 6974 6e65 7920 426f 6c64 2034 362e  Whitney Bold 46.
+00026860: 200a 2020 2020 5869 7473 2042 6f6c 6420   .    Xits Bold 
+00026870: 3437 2e20 0a20 2020 2059 616e 6f6e 6520  47. .    Yanone 
+00026880: 4b61 6666 6565 7361 747a 2042 6f6c 6420  Kaffeesatz Bold 
+00026890: 3438 2e20 0a20 2020 205a 696c 6c61 2053  48. .    Zilla S
+000268a0: 6c61 620a 2020 2020 5a6f 6e61 0a20 2020  lab.    Zona.   
+000268b0: 205a 7572 6963 6820 0a20 2020 2022 2222   Zurich .    """
+000268c0: 0a0a 2020 2020 2320 2020 2063 6c61 7373  ..    #    class
+000268d0: 2041 6d69 466f 6e74 3a0a 0a20 2020 2040   AmiFont:..    @
+000268e0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+000268f0: 6465 6620 6d61 7463 685f 666f 6e74 5f70  def match_font_p
+00026900: 726f 7065 7274 7928 636c 732c 206e 616d  roperty(cls, nam
+00026910: 652c 2072 6567 6578 293a 0a20 2020 2020  e, regex):.     
+00026920: 2020 206d 6174 6368 203d 2072 6567 6578     match = regex
+00026930: 2e6d 6174 6368 286e 616d 6529 0a20 2020  .match(name).   
+00026940: 2020 2020 2069 6620 6d61 7463 683a 0a20       if match:. 
+00026950: 2020 2020 2020 2020 2020 206e 616d 6520             name 
+00026960: 3d20 6d61 7463 682e 6772 6f75 7028 3129  = match.group(1)
+00026970: 202b 206d 6174 6368 2e67 726f 7570 2833   + match.group(3
+00026980: 2920 2320 6368 6f70 206f 7574 206d 6174  ) # chop out mat
+00026990: 6368 0a20 2020 2020 2020 2072 6574 7572  ch.        retur
+000269a0: 6e20 6e61 6d65 2c20 6d61 7463 680a 0a20  n name, match.. 
+000269b0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+000269c0: 2020 2020 6465 6620 636f 6e76 6572 745f      def convert_
+000269d0: 636f 6d6d 6f6e 5f66 6f6e 7473 2863 6c73  common_fonts(cls
+000269e0: 293a 0a20 2020 2020 2020 2070 6173 730a  ):.        pass.
+000269f0: 0a20 2020 2023 2020 2020 636c 6173 7320  .    #    class 
+00026a00: 416d 6946 6f6e 743a 0a0a 2020 2020 4063  AmiFont:..    @c
+00026a10: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+00026a20: 6566 2063 7265 6174 655f 666f 6e74 5f65  ef create_font_e
+00026a30: 6469 7465 645f 7374 796c 655f 6672 6f6d  dited_style_from
+00026a40: 5f68 6561 645f 7374 796c 6528 636c 732c  _head_style(cls,
+00026a50: 2073 7479 6c65 5f65 6c65 6d29 3a0a 2020   style_elem):.  
+00026a60: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00026a70: 2020 656d 7069 7269 6361 6c6c 7920 6372    empirically cr
+00026a80: 6561 7465 2073 7461 6e64 6172 6420 666f  eate standard fo
+00026a90: 6e74 7320 616e 6420 6174 7472 6962 7574  nts and attribut
+00026aa0: 6573 2066 726f 6d20 666f 6e74 206e 616d  es from font nam
+00026ab0: 6573 0a20 2020 2020 2020 203a 7061 7261  es.        :para
+00026ac0: 6d20 6373 735f 7374 796c 653a 2043 5353  m css_style: CSS
+00026ad0: 5374 796c 6520 4f62 6a65 6374 206f 7220  Style Object or 
+00026ae0: 4854 4d4c 2068 6561 642f 7374 796c 6520  HTML head/style 
+00026af0: 7769 7468 2075 6e6b 6e6f 776e 2066 6f6e  with unknown fon
+00026b00: 742d 6661 6d69 6c79 0a20 2020 2020 2020  t-family.       
+00026b10: 203a 7265 7475 726e 3a20 7475 706c 6520   :return: tuple 
+00026b20: 2873 796d 626f 6c5f 7265 662c 206e 6577  (symbol_ref, new
+00026b30: 2063 7373 5f73 7479 6c65 206f 626a 6563   css_style objec
+00026b40: 7420 7769 7468 2073 7461 6e64 6172 6420  t with standard 
+00026b50: 666f 6e74 2061 6e64 206d 6179 6265 206e  font and maybe n
+00026b60: 6577 2077 6569 6768 7420 6f72 2073 7479  ew weight or sty
+00026b70: 6c65 290a 2020 2020 2020 2020 2222 220a  le).        """.
+00026b80: 2020 2020 2020 2020 6966 206e 6f74 2074          if not t
+00026b90: 7970 6528 7374 796c 655f 656c 656d 2920  ype(style_elem) 
+00026ba0: 6973 205f 456c 656d 656e 743a 0a20 2020  is _Element:.   
+00026bb0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00026bc0: 4e6f 6e65 2c20 4e6f 6e65 0a20 2020 2020  None, None.     
+00026bd0: 2020 2073 796d 626f 6c5f 7265 662c 2063     symbol_ref, c
+00026be0: 7373 5f73 7479 6c65 203d 2043 5353 5374  ss_style = CSSSt
+00026bf0: 796c 652e 6372 6561 7465 5f63 7373 5f73  yle.create_css_s
+00026c00: 7479 6c65 5f66 726f 6d5f 6874 6d6c 5f68  tyle_from_html_h
+00026c10: 6561 645f 7374 796c 655f 656c 656d 2873  ead_style_elem(s
+00026c20: 7479 6c65 5f65 6c65 6d29 0a20 2020 2020  tyle_elem).     
+00026c30: 2020 2069 6620 6373 735f 7374 796c 6520     if css_style 
+00026c40: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00026c50: 2020 2020 2020 2020 2066 6f6e 745f 6661           font_fa
+00026c60: 6d69 6c79 203d 2063 7373 5f73 7479 6c65  mily = css_style
+00026c70: 2e66 6f6e 745f 6661 6d69 6c79 0a20 2020  .font_family.   
+00026c80: 2020 2020 2020 2020 2061 6d69 5f66 6f6e           ami_fon
+00026c90: 7420 3d20 416d 6946 6f6e 742e 6578 7472  t = AmiFont.extr
+00026ca0: 6163 745f 6e61 6d65 5f77 6569 6768 745f  act_name_weight_
+00026cb0: 7374 796c 655f 7374 7265 7463 6865 645f  style_stretched_
+00026cc0: 6173 5f66 6f6e 7428 666f 6e74 5f66 616d  as_font(font_fam
+00026cd0: 696c 7929 0a20 2020 2020 2020 2020 2020  ily).           
+00026ce0: 206e 6577 5f63 7373 5f73 7479 6c65 203d   new_css_style =
+00026cf0: 2043 5353 5374 796c 6528 290a 2020 2020   CSSStyle().    
+00026d00: 2020 2020 2020 2020 666f 7220 6974 656d          for item
+00026d10: 2069 6e20 6373 735f 7374 796c 652e 6e61   in css_style.na
+00026d20: 6d65 5f76 616c 7565 5f64 6963 743a 0a20  me_value_dict:. 
+00026d30: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00026d40: 6577 5f63 7373 5f73 7479 6c65 2e6e 616d  ew_css_style.nam
+00026d50: 655f 7661 6c75 655f 6469 6374 5b69 7465  e_value_dict[ite
+00026d60: 6d5b 305d 5d20 3d20 6974 656d 5b31 5d0a  m[0]] = item[1].
+00026d70: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+00026d80: 6373 735f 7374 796c 652e 7365 745f 6174  css_style.set_at
+00026d90: 7472 6962 7574 6528 464f 4e54 5f46 414d  tribute(FONT_FAM
+00026da0: 494c 592c 2061 6d69 5f66 6f6e 742e 6661  ILY, ami_font.fa
+00026db0: 6d69 6c79 290a 2020 2020 2020 2020 2020  mily).          
+00026dc0: 2020 6e65 775f 6373 735f 7374 796c 652e    new_css_style.
+00026dd0: 7365 745f 6174 7472 6962 7574 6528 464f  set_attribute(FO
+00026de0: 4e54 5f57 4549 4748 542c 2061 6d69 5f66  NT_WEIGHT, ami_f
+00026df0: 6f6e 742e 7765 6967 6874 290a 2020 2020  ont.weight).    
+00026e00: 2020 2020 2020 2020 6e65 775f 6373 735f          new_css_
+00026e10: 7374 796c 652e 7365 745f 6174 7472 6962  style.set_attrib
+00026e20: 7574 6528 464f 4e54 5f53 5459 4c45 2c20  ute(FONT_STYLE, 
+00026e30: 616d 695f 666f 6e74 2e73 7479 6c65 290a  ami_font.style).
+00026e40: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+00026e50: 6373 735f 7374 796c 652e 7365 745f 6174  css_style.set_at
+00026e60: 7472 6962 7574 6528 464f 4e54 5f53 5452  tribute(FONT_STR
+00026e70: 4554 4348 4544 2c20 616d 695f 666f 6e74  ETCHED, ami_font
+00026e80: 2e73 7472 6574 6368 6564 290a 2020 2020  .stretched).    
+00026e90: 2020 2020 7265 7475 726e 2073 796d 626f      return symbo
+00026ea0: 6c5f 7265 662c 206e 6577 5f63 7373 5f73  l_ref, new_css_s
+00026eb0: 7479 6c65 0a0a 2020 2020 4063 6c61 7373  tyle..    @class
+00026ec0: 6d65 7468 6f64 0a20 2020 2064 6566 2063  method.    def c
+00026ed0: 7265 6174 655f 666f 6e74 5f65 6469 7465  reate_font_edite
+00026ee0: 645f 7374 796c 655f 6672 6f6d 5f63 7373  d_style_from_css
+00026ef0: 5f73 7479 6c65 5f6f 626a 6563 7428 636c  _style_object(cl
+00026f00: 732c 2063 7373 5f73 7479 6c65 293a 0a20  s, css_style):. 
+00026f10: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00026f20: 2020 2065 6d70 6972 6963 616c 6c79 2063     empirically c
+00026f30: 7265 6174 6520 7374 616e 6461 7264 2066  reate standard f
+00026f40: 6f6e 7473 2061 6e64 2061 7474 7269 6275  onts and attribu
+00026f50: 7465 7320 6672 6f6d 2066 6f6e 7420 6e61  tes from font na
+00026f60: 6d65 730a 2020 2020 2020 2020 3a70 6172  mes.        :par
+00026f70: 616d 2063 7373 5f73 7479 6c65 3a20 4353  am css_style: CS
+00026f80: 5353 7479 6c65 204f 626a 6563 7420 6f72  SStyle Object or
+00026f90: 2048 544d 4c20 6865 6164 2f73 7479 6c65   HTML head/style
+00026fa0: 2077 6974 6820 756e 6b6e 6f77 6e20 666f   with unknown fo
+00026fb0: 6e74 2d66 616d 696c 790a 2020 2020 2020  nt-family.      
+00026fc0: 2020 3a72 6574 7572 6e3a 2074 7570 6c65    :return: tuple
+00026fd0: 2028 7379 6d62 6f6c 5f72 6566 2c20 6e65   (symbol_ref, ne
+00026fe0: 7720 6373 735f 7374 796c 6520 6f62 6a65  w css_style obje
+00026ff0: 6374 2077 6974 6820 7374 616e 6461 7264  ct with standard
+00027000: 2066 6f6e 7420 616e 6420 6d61 7962 6520   font and maybe 
+00027010: 6e65 7720 7765 6967 6874 206f 7220 7374  new weight or st
+00027020: 796c 6529 0a20 2020 2020 2020 2022 2222  yle).        """
+00027030: 0a0a 2020 2020 2020 2020 6966 2063 7373  ..        if css
+00027040: 5f73 7479 6c65 2069 7320 4e6f 6e65 3a0a  _style is None:.
+00027050: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00027060: 726e 204e 6f6e 650a 2020 2020 2020 2020  rn None.        
+00027070: 6966 2074 7970 6528 6373 735f 7374 796c  if type(css_styl
+00027080: 6529 2069 7320 4554 2e5f 456c 656d 656e  e) is ET._Elemen
+00027090: 743a 0a20 2020 2020 2020 2020 2020 2070  t:.            p
+000270a0: 7269 6e74 2028 6622 656c 656d 656e 7420  rint (f"element 
+000270b0: 7b45 542e 746f 7374 7269 6e67 2863 7373  {ET.tostring(css
+000270c0: 5f73 7479 6c65 297d 2229 0a20 2020 2020  _style)}").     
+000270d0: 2020 2069 6620 7479 7065 2863 7373 5f73     if type(css_s
+000270e0: 7479 6c65 2920 6973 2073 7472 3a0a 2020  tyle) is str:.  
+000270f0: 2020 2020 2020 2020 2020 6373 735f 7374            css_st
+00027100: 796c 6520 3d20 4353 5353 7479 6c65 2e63  yle = CSSStyle.c
+00027110: 7265 6174 655f 6373 735f 7374 796c 655f  reate_css_style_
+00027120: 6672 6f6d 5f63 7373 5f73 7472 696e 6728  from_css_string(
+00027130: 6373 735f 7374 796c 6529 0a20 2020 2020  css_style).     
+00027140: 2020 2069 6620 6373 735f 7374 796c 6520     if css_style 
+00027150: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00027160: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+00027170: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+00027180: 7479 7065 2863 7373 5f73 7479 6c65 2920  type(css_style) 
+00027190: 6973 2043 5353 5374 796c 652c 2066 2266  is CSSStyle, f"f
+000271a0: 6f75 6e64 207b 7479 7065 2863 7373 5f73  ound {type(css_s
+000271b0: 7479 6c65 297d 220a 2020 2020 2020 2020  tyle)}".        
+000271c0: 6966 206e 6f74 2063 7373 5f73 7479 6c65  if not css_style
+000271d0: 2e66 6f6e 745f 6661 6d69 6c79 3a0a 2020  .font_family:.  
+000271e0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000271f0: 2063 7373 5f73 7479 6c65 0a20 2020 2020   css_style.     
+00027200: 2020 2061 6d69 5f66 6f6e 7420 3d20 416d     ami_font = Am
+00027210: 6946 6f6e 742e 6578 7472 6163 745f 6e61  iFont.extract_na
+00027220: 6d65 5f77 6569 6768 745f 7374 796c 655f  me_weight_style_
+00027230: 7374 7265 7463 6865 645f 6173 5f66 6f6e  stretched_as_fon
+00027240: 7428 6373 735f 7374 796c 652e 666f 6e74  t(css_style.font
+00027250: 5f66 616d 696c 7929 0a20 2020 2020 2020  _family).       
+00027260: 206e 6577 5f63 7373 5f73 7479 6c65 203d   new_css_style =
+00027270: 2043 5353 5374 796c 6528 290a 2020 2020   CSSStyle().    
+00027280: 2020 2020 666f 7220 6974 656d 2069 6e20      for item in 
+00027290: 6373 735f 7374 796c 652e 6e61 6d65 5f76  css_style.name_v
+000272a0: 616c 7565 5f64 6963 742e 6974 656d 7328  alue_dict.items(
+000272b0: 293a 0a20 2020 2020 2020 2020 2020 206e  ):.            n
+000272c0: 6577 5f63 7373 5f73 7479 6c65 2e6e 616d  ew_css_style.nam
+000272d0: 655f 7661 6c75 655f 6469 6374 5b69 7465  e_value_dict[ite
+000272e0: 6d5b 305d 5d20 3d20 6974 656d 5b31 5d0a  m[0]] = item[1].
+000272f0: 2020 2020 2020 2020 6e65 775f 6373 735f          new_css_
+00027300: 7374 796c 652e 7365 745f 6174 7472 6962  style.set_attrib
+00027310: 7574 6528 464f 4e54 5f4e 414d 452c 2073  ute(FONT_NAME, s
+00027320: 7472 2861 6d69 5f66 6f6e 742e 6e61 6d65  tr(ami_font.name
+00027330: 2929 0a20 2020 2020 2020 206e 6577 5f63  )).        new_c
+00027340: 7373 5f73 7479 6c65 2e73 6574 5f61 7474  ss_style.set_att
+00027350: 7269 6275 7465 2846 4f4e 545f 464f 4e54  ribute(FONT_FONT
+00027360: 2c20 7374 7228 616d 695f 666f 6e74 2e66  , str(ami_font.f
+00027370: 6f6e 7429 290a 2020 2020 2020 2020 6e65  ont)).        ne
+00027380: 775f 6373 735f 7374 796c 652e 7365 745f  w_css_style.set_
+00027390: 6174 7472 6962 7574 6528 464f 4e54 5f46  attribute(FONT_F
+000273a0: 414d 494c 592c 2073 7472 2861 6d69 5f66  AMILY, str(ami_f
+000273b0: 6f6e 742e 6661 6d69 6c79 2929 0a20 2020  ont.family)).   
+000273c0: 2020 2020 206e 6577 5f63 7373 5f73 7479       new_css_sty
+000273d0: 6c65 2e73 6574 5f61 7474 7269 6275 7465  le.set_attribute
+000273e0: 2846 4f4e 545f 5745 4947 4854 2c20 7374  (FONT_WEIGHT, st
+000273f0: 7228 616d 695f 666f 6e74 2e77 6569 6768  r(ami_font.weigh
+00027400: 7429 2e6c 6f77 6572 2829 290a 2020 2020  t).lower()).    
+00027410: 2020 2020 6e65 775f 6373 735f 7374 796c      new_css_styl
+00027420: 652e 7365 745f 6174 7472 6962 7574 6528  e.set_attribute(
+00027430: 464f 4e54 5f53 5459 4c45 2c20 7374 7228  FONT_STYLE, str(
+00027440: 616d 695f 666f 6e74 2e73 7479 6c65 292e  ami_font.style).
+00027450: 6c6f 7765 7228 2929 0a20 2020 2020 2020  lower()).       
+00027460: 206e 6577 5f63 7373 5f73 7479 6c65 2e73   new_css_style.s
+00027470: 6574 5f61 7474 7269 6275 7465 2846 4f4e  et_attribute(FON
+00027480: 545f 5354 5245 5443 4845 442c 2073 7472  T_STRETCHED, str
+00027490: 2861 6d69 5f66 6f6e 742e 7374 7265 7463  (ami_font.stretc
+000274a0: 6865 6429 2e6c 6f77 6572 2829 290a 2020  hed).lower()).  
+000274b0: 2020 2020 2020 7265 7475 726e 206e 6577        return new
+000274c0: 5f63 7373 5f73 7479 6c65 0a0a 2020 2020  _css_style..    
+000274d0: 2320 2020 2063 6c61 7373 2041 6d69 466f  #    class AmiFo
+000274e0: 6e74 3a0a 0a20 2020 2040 7072 6f70 6572  nt:..    @proper
+000274f0: 7479 0a20 2020 2064 6566 2069 735f 626f  ty.    def is_bo
+00027500: 6c64 2873 656c 6629 3a0a 2020 2020 2020  ld(self):.      
+00027510: 2020 7265 7475 726e 2073 7472 2846 6f6e    return str(Fon
+00027520: 7450 726f 7065 7274 792e 424f 4c44 2920  tProperty.BOLD) 
+00027530: 3d3d 2073 656c 662e 7765 6967 6874 0a0a  == self.weight..
+00027540: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
+00027550: 2020 6465 6620 6973 5f69 7461 6c69 6328    def is_italic(
+00027560: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
+00027570: 6574 7572 6e20 7374 7228 466f 6e74 5072  eturn str(FontPr
+00027580: 6f70 6572 7479 2e49 5441 4c49 4329 203d  operty.ITALIC) =
+00027590: 3d20 7365 6c66 2e73 7479 6c65 0a0a 2020  = self.style..  
+000275a0: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+000275b0: 2020 2064 6566 2074 7269 6d5f 7064 665f     def trim_pdf_
+000275c0: 7072 6566 6978 2863 6c73 2c20 6e61 6d65  prefix(cls, name
+000275d0: 293a 0a20 2020 2020 2020 2022 2222 7265  ):.        """re
+000275e0: 6d6f 7665 7320 7468 6520 4142 4344 4546  moves the ABCDEF
+000275f0: 2b20 7072 6566 6978 2066 726f 6d20 666f  + prefix from fo
+00027600: 6e74 2d6e 616d 650a 2020 2020 2020 2020  nt-name.        
+00027610: 5468 6973 2070 7265 6669 7820 7365 7276  This prefix serv
+00027620: 6573 206e 6f20 7573 6566 756c 2070 7572  es no useful pur
+00027630: 706f 7365 2066 6f72 2074 6578 7420 616e  pose for text an
+00027640: 616c 7973 6973 2061 6e64 2069 7320 6469  alysis and is di
+00027650: 7363 6172 6465 6422 2222 0a20 2020 2020  scarded""".     
+00027660: 2020 2069 6620 6e61 6d65 3a0a 2020 2020     if name:.    
+00027670: 2020 2020 2020 2020 6d61 7463 6820 3d20          match = 
+00027680: 5245 5f50 5245 462e 6d61 7463 6828 6e61  RE_PREF.match(na
+00027690: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
+000276a0: 6966 206d 6174 6368 3a0a 2020 2020 2020  if match:.      
+000276b0: 2020 2020 2020 2020 2020 6e61 6d65 203d            name =
+000276c0: 206d 6174 6368 2e67 726f 7570 2822 6e61   match.group("na
+000276d0: 6d65 2229 0a20 2020 2020 2020 2072 6574  me").        ret
+000276e0: 7572 6e20 6e61 6d65 0a0a 0a63 6c61 7373  urn name...class
+000276f0: 2053 6563 7469 6f6e 4869 6572 6172 6368   SectionHierarch
+00027700: 793a 0a20 2020 2022 2222 0a20 2020 2062  y:.    """.    b
+00027710: 7569 6c64 7320 616e 6420 7175 6572 6965  uilds and querie
+00027720: 7320 6869 6572 6172 6368 6963 616c 2073  s hierarchical s
+00027730: 6563 7469 6f6e 730a 2020 2020 2222 220a  ections.    """.
+00027740: 0a20 2020 2049 4420 3d20 2269 6422 0a20  .    ID = "id". 
+00027750: 2020 2043 4c41 5353 203d 2027 636c 6173     CLASS = 'clas
+00027760: 7327 0a20 2020 2044 4f54 203d 2022 2e22  s'.    DOT = "."
+00027770: 0a20 2020 204d 4953 5349 4e47 203d 2022  .    MISSING = "
+00027780: 6d69 7373 696e 6722 0a20 2020 2053 4543  missing".    SEC
+00027790: 5420 3d20 2273 6563 7422 0a0a 2020 2020  T = "sect"..    
+000277a0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+000277b0: 6629 3a0a 2020 2020 2020 2020 7061 7373  f):.        pass
+000277c0: 0a0a 2020 2020 6465 6620 6164 645f 7365  ..    def add_se
+000277d0: 6374 696f 6e73 2873 656c 662c 2064 6563  ctions(self, dec
+000277e0: 696d 616c 5f73 6563 7469 6f6e 732c 2074  imal_sections, t
+000277f0: 6f70 3d4e 6f6e 652c 2070 6f70 6c69 7374  op=None, poplist
+00027800: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+00027810: 6966 206e 6f74 2070 6f70 6c69 7374 3a0a  if not poplist:.
+00027820: 2020 2020 2020 2020 2020 2020 706f 706c              popl
+00027830: 6973 7420 3d20 5b5d 0a20 2020 2020 2020  ist = [].       
+00027840: 2073 6563 7469 6f6e 735f 6279 5f6c 6576   sections_by_lev
+00027850: 656c 203d 2073 656c 662e 6372 6561 7465  el = self.create
+00027860: 5f73 6563 7469 6f6e 735f 6279 5f6c 6576  _sections_by_lev
+00027870: 656c 2864 6563 696d 616c 5f73 6563 7469  el(decimal_secti
+00027880: 6f6e 7329 0a20 2020 2020 2020 2070 6172  ons).        par
+00027890: 656e 745f 6469 6374 203d 2073 656c 662e  ent_dict = self.
+000278a0: 6372 6561 7465 5f70 6172 656e 745f 6469  create_parent_di
+000278b0: 6374 2873 6563 7469 6f6e 735f 6279 5f6c  ct(sections_by_l
+000278c0: 6576 656c 290a 2020 2020 2020 2020 666f  evel).        fo
+000278d0: 7220 706f 7020 696e 2070 6f70 6c69 7374  r pop in poplist
+000278e0: 3a0a 2020 2020 2020 2020 2020 2020 7472  :.            tr
+000278f0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+00027900: 2020 2070 6172 656e 745f 6469 6374 2e70     parent_dict.p
+00027910: 6f70 2870 6f70 2920 2023 2072 656d 6f76  op(pop)  # remov
+00027920: 6520 6e6f 6e2d 6e75 6d65 7269 6320 6974  e non-numeric it
+00027930: 656d 0a20 2020 2020 2020 2020 2020 2065  em.            e
+00027940: 7863 6570 743a 0a20 2020 2020 2020 2020  xcept:.         
+00027950: 2020 2020 2020 2070 7269 6e74 2822 4361         print("Ca
+00027960: 6e6e 6f74 2070 6f70 207b 706f 707d 2229  nnot pop {pop}")
+00027970: 0a0a 2020 2020 2020 2020 726f 6f74 203d  ..        root =
+00027980: 2045 6c65 6d65 6e74 2873 656c 662e 5345   Element(self.SE
+00027990: 4354 290a 2020 2020 2020 2020 726f 6f74  CT).        root
+000279a0: 2e61 7474 7269 625b 7365 6c66 2e49 445d  .attrib[self.ID]
+000279b0: 203d 2022 3422 0a20 2020 2020 2020 2066   = "4".        f
+000279c0: 6f72 2073 6563 745f 6964 2069 6e20 7061  or sect_id in pa
+000279d0: 7265 6e74 5f64 6963 742e 6b65 7973 2829  rent_dict.keys()
+000279e0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+000279f0: 6c66 2e65 6e73 7572 655f 656c 656d 656e  lf.ensure_elemen
+00027a00: 7428 726f 6f74 2c20 7365 6374 5f69 642c  t(root, sect_id,
+00027a10: 2070 6172 656e 745f 6469 6374 290a 0a20   parent_dict).. 
+00027a20: 2020 2064 6566 2063 7265 6174 655f 7061     def create_pa
+00027a30: 7265 6e74 5f64 6963 7428 7365 6c66 2c20  rent_dict(self, 
+00027a40: 7365 6374 696f 6e73 5f62 795f 6c65 7665  sections_by_leve
+00027a50: 6c29 3a0a 2020 2020 2020 2020 7061 7265  l):.        pare
+00027a60: 6e74 5f64 6963 7420 3d20 6469 6374 2829  nt_dict = dict()
+00027a70: 0a20 2020 2020 2020 2066 6f72 206c 6576  .        for lev
+00027a80: 656c 2069 6e20 7365 6374 696f 6e73 5f62  el in sections_b
+00027a90: 795f 6c65 7665 6c2e 6b65 7973 2829 3a0a  y_level.keys():.
+00027aa0: 2020 2020 2020 2020 2020 2020 7365 6374              sect
+00027ab0: 5f69 6473 203d 2073 656c 662e 6164 645f  _ids = self.add_
+00027ac0: 7061 7265 6e74 7328 6c65 7665 6c2c 2073  parents(level, s
+00027ad0: 6563 7469 6f6e 735f 6279 5f6c 6576 656c  ections_by_level
+00027ae0: 2c20 7061 7265 6e74 5f64 6963 7429 0a20  , parent_dict). 
+00027af0: 2020 2020 2020 2072 6574 7572 6e20 7061         return pa
+00027b00: 7265 6e74 5f64 6963 740a 0a20 2020 2064  rent_dict..    d
+00027b10: 6566 2063 7265 6174 655f 7365 6374 696f  ef create_sectio
+00027b20: 6e73 5f62 795f 6c65 7665 6c28 7365 6c66  ns_by_level(self
+00027b30: 2c20 6465 6369 6d61 6c5f 7365 6374 696f  , decimal_sectio
+00027b40: 6e73 293a 0a20 2020 2020 2020 2073 6563  ns):.        sec
+00027b50: 7469 6f6e 735f 6279 5f6c 6576 656c 203d  tions_by_level =
+00027b60: 2064 6566 6175 6c74 6469 6374 286c 6973   defaultdict(lis
+00027b70: 7429 0a20 2020 2020 2020 2066 6f72 2073  t).        for s
+00027b80: 6563 7469 6f6e 2069 6e20 6465 6369 6d61  ection in decima
+00027b90: 6c5f 7365 6374 696f 6e73 3a0a 2020 2020  l_sections:.    
+00027ba0: 2020 2020 2020 2020 6c65 7665 6c20 3d20          level = 
+00027bb0: 7365 6374 696f 6e2e 6174 7472 6962 2e67  section.attrib.g
+00027bc0: 6574 2873 656c 662e 434c 4153 5329 2e73  et(self.CLASS).s
+00027bd0: 706c 6974 2829 5b31 5d0a 2020 2020 2020  plit()[1].      
+00027be0: 2020 2020 2020 7365 6374 696f 6e73 5f62        sections_b
+00027bf0: 795f 6c65 7665 6c5b 6c65 7665 6c5d 2e61  y_level[level].a
+00027c00: 7070 656e 6428 7365 6374 696f 6e2e 7465  ppend(section.te
+00027c10: 7874 290a 2020 2020 2020 2020 7265 7475  xt).        retu
+00027c20: 726e 2073 6563 7469 6f6e 735f 6279 5f6c  rn sections_by_l
+00027c30: 6576 656c 0a0a 2020 2020 6465 6620 6164  evel..    def ad
+00027c40: 645f 7061 7265 6e74 7328 7365 6c66 2c20  d_parents(self, 
+00027c50: 6c65 7665 6c2c 206d 756c 7469 6469 6374  level, multidict
+00027c60: 2c20 7061 7265 6e74 5f64 6963 7429 3a0a  , parent_dict):.
+00027c70: 2020 2020 2020 2020 6c65 7665 6c5f 7365          level_se
+00027c80: 6374 7320 3d20 6d75 6c74 6964 6963 745b  cts = multidict[
+00027c90: 6c65 7665 6c5d 0a20 2020 2020 2020 2066  level].        f
+00027ca0: 6f72 206c 6576 656c 5f73 6563 7420 696e  or level_sect in
+00027cb0: 206c 6576 656c 5f73 6563 7473 3a0a 2020   level_sects:.  
+00027cc0: 2020 2020 2020 2020 2020 7061 7265 6e74            parent
+00027cd0: 203d 2073 656c 662e 6765 745f 7061 7265   = self.get_pare
+00027ce0: 6e74 286c 6576 656c 5f73 6563 7429 0a20  nt(level_sect). 
+00027cf0: 2020 2020 2020 2020 2020 2070 6172 656e             paren
+00027d00: 745f 6469 6374 5b6c 6576 656c 5f73 6563  t_dict[level_sec
+00027d10: 745d 203d 2070 6172 656e 740a 0a20 2020  t] = parent..   
+00027d20: 2064 6566 2067 6574 5f70 6172 656e 7428   def get_parent(
+00027d30: 7365 6c66 2c20 6c65 7665 6c5f 7365 6374  self, level_sect
+00027d40: 293a 0a20 2020 2020 2020 2062 6974 7320  ):.        bits 
+00027d50: 3d20 6c65 7665 6c5f 7365 6374 2e73 706c  = level_sect.spl
+00027d60: 6974 2822 2e22 290a 2020 2020 2020 2020  it(".").        
+00027d70: 7061 7265 6e74 203d 204e 6f6e 6520 6966  parent = None if
+00027d80: 206c 656e 2862 6974 7329 203d 3d20 3120   len(bits) == 1 
+00027d90: 656c 7365 2073 656c 662e 444f 542e 6a6f  else self.DOT.jo
+00027da0: 696e 2862 6974 735b 3a2d 315d 290a 2020  in(bits[:-1]).  
+00027db0: 2020 2020 2020 7265 7475 726e 2070 6172        return par
+00027dc0: 656e 740a 0a20 2020 2064 6566 2065 6e73  ent..    def ens
+00027dd0: 7572 655f 656c 656d 656e 7428 7365 6c66  ure_element(self
+00027de0: 2c20 726f 6f74 2c20 7365 6374 5f69 642c  , root, sect_id,
+00027df0: 2070 6172 656e 745f 6469 6374 293a 0a20   parent_dict):. 
+00027e00: 2020 2020 2020 2069 6620 7365 6374 5f69         if sect_i
+00027e10: 6420 3d3d 2022 223a 0a20 2020 2020 2020  d == "":.       
+00027e20: 2020 2020 2070 7269 6e74 2866 2252 414e       print(f"RAN
+00027e30: 204f 4646 2054 4f50 2229 0a20 2020 2020   OFF TOP").     
+00027e40: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+00027e50: 6e65 0a20 2020 2020 2020 2078 7061 7468  ne.        xpath
+00027e60: 203d 2066 222f 2f7b 7365 6c66 2e53 4543   = f"//{self.SEC
+00027e70: 547d 5b40 6964 3d27 7b73 6563 745f 6964  T}[@id='{sect_id
+00027e80: 7d27 5d22 0a20 2020 2020 2020 2065 6c65  }']".        ele
+00027e90: 6d73 203d 2072 6f6f 742e 7870 6174 6828  ms = root.xpath(
+00027ea0: 7870 6174 6829 0a20 2020 2020 2020 2069  xpath).        i
+00027eb0: 6620 6c65 6e28 656c 656d 7329 203d 3d20  f len(elems) == 
+00027ec0: 303a 0a20 2020 2020 2020 2020 2020 2070  0:.            p
+00027ed0: 6172 656e 745f 6964 203d 2070 6172 656e  arent_id = paren
+00027ee0: 745f 6469 6374 2e67 6574 2873 6563 745f  t_dict.get(sect_
+00027ef0: 6964 290a 2020 2020 2020 2020 2020 2020  id).            
+00027f00: 6d69 7373 696e 6720 3d20 4661 6c73 650a  missing = False.
+00027f10: 2020 2020 2020 2020 2020 2020 6966 2070              if p
+00027f20: 6172 656e 745f 6964 2069 7320 4e6f 6e65  arent_id is None
+00027f30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00027f40: 2020 7072 696e 7428 6622 206d 6973 7369    print(f" missi
+00027f50: 6e67 2070 6172 656e 7420 7365 6374 696f  ng parent sectio
+00027f60: 6e20 7b73 6563 745f 6964 7d22 290a 2020  n {sect_id}").  
+00027f70: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
+00027f80: 7373 696e 6720 3d20 5472 7565 0a20 2020  ssing = True.   
+00027f90: 2020 2020 2020 2020 2020 2020 2073 706c               spl
+00027fa0: 203d 2073 6563 745f 6964 2e73 706c 6974   = sect_id.split
+00027fb0: 2873 656c 662e 444f 5429 0a20 2020 2020  (self.DOT).     
+00027fc0: 2020 2020 2020 2020 2020 2073 706c 6974             split
+00027fd0: 5f20 3d20 7370 6c5b 3a2d 315d 0a20 2020  _ = spl[:-1].   
+00027fe0: 2020 2020 2020 2020 2020 2020 2070 6172               par
+00027ff0: 656e 745f 6964 203d 2073 656c 662e 444f  ent_id = self.DO
+00028000: 542e 6a6f 696e 2873 706c 6974 5f29 0a20  T.join(split_). 
+00028010: 2020 2020 2020 2020 2020 2069 6620 7061             if pa
+00028020: 7265 6e74 5f69 6420 3d3d 2022 223a 0a20  rent_id == "":. 
+00028030: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00028040: 7269 6e74 2866 2220 736b 6970 2072 6f6f  rint(f" skip roo
+00028050: 742e 2e2e 2229 0a20 2020 2020 2020 2020  t...").         
+00028060: 2020 2065 6c65 6d20 3d20 7365 6c66 2e65     elem = self.e
+00028070: 6e73 7572 655f 656c 656d 656e 7428 726f  nsure_element(ro
+00028080: 6f74 2c20 7061 7265 6e74 5f69 642c 2070  ot, parent_id, p
+00028090: 6172 656e 745f 6469 6374 290a 2020 2020  arent_dict).    
+000280a0: 2020 2020 2020 2020 6966 2065 6c65 6d20          if elem 
+000280b0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+000280c0: 2020 2020 2020 2020 2020 2020 2073 6563               sec
+000280d0: 745f 786d 6c20 3d20 4554 2e53 7562 456c  t_xml = ET.SubEl
+000280e0: 656d 656e 7428 656c 656d 2c20 7365 6c66  ement(elem, self
+000280f0: 2e53 4543 5429 0a20 2020 2020 2020 2020  .SECT).         
+00028100: 2020 2020 2020 2073 6563 745f 786d 6c2e         sect_xml.
+00028110: 6174 7472 6962 5b73 656c 662e 4944 5d20  attrib[self.ID] 
+00028120: 3d20 7365 6374 5f69 640a 2020 2020 2020  = sect_id.      
+00028130: 2020 2020 2020 2020 2020 6966 206d 6973            if mis
+00028140: 7369 6e67 3a0a 2020 2020 2020 2020 2020  sing:.          
+00028150: 2020 2020 2020 2020 2020 7365 6374 5f78            sect_x
+00028160: 6d6c 2e61 7474 7269 625b 7365 6c66 2e4d  ml.attrib[self.M
+00028170: 4953 5349 4e47 5d20 3d20 2259 220a 2020  ISSING] = "Y".  
+00028180: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00028190: 7475 726e 2073 6563 745f 786d 6c0a 2020  turn sect_xml.  
+000281a0: 2020 2020 2020 656c 6966 206c 656e 2865        elif len(e
+000281b0: 6c65 6d73 2920 3e20 313a 0a20 2020 2020  lems) > 1:.     
+000281c0: 2020 2020 2020 2070 7269 6e74 2866 2220         print(f" 
+000281d0: 6475 706c 6963 6174 6520 6964 733a 207b  duplicate ids: {
+000281e0: 7365 6374 5f69 647d 2229 0a20 2020 2020  sect_id}").     
+000281f0: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+00028200: 6e65 0a20 2020 2020 2020 2065 6c73 653a  ne.        else:
+00028210: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00028220: 7572 6e20 656c 656d 735b 305d 0a0a 2020  urn elems[0]..  
+00028230: 2020 6465 6620 736f 7274 5f73 6563 7469    def sort_secti
+00028240: 6f6e 7328 7365 6c66 293a 0a20 2020 2020  ons(self):.     
+00028250: 2020 2070 7269 6e74 2822 736f 7274 2073     print("sort s
+00028260: 6563 7469 6f6e 7320 4e59 4922 290a 2020  ections NYI").  
+00028270: 2020 2020 2020 7061 7373 0a0a 2020 2020        pass..    
+00028280: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+00028290: 2064 6566 2073 6f72 745f 6964 7328 636c   def sort_ids(cl
+000282a0: 7329 3a0a 2020 2020 2020 2020 7061 7373  s):.        pass
+000282b0: 0a0a 636c 6173 7320 466f 6f74 6e6f 7465  ..class Footnote
+000282c0: 3a0a 2020 2020 2222 2265 7874 7261 6374  :.    """extract
+000282d0: 7320 666f 6f74 6e6f 7465 7320 6279 2073  s footnotes by s
+000282e0: 697a 6520 616e 6420 7374 796c 6520 616e  ize and style an
+000282f0: 6420 7065 7268 6170 7320 706f 7369 7469  d perhaps positi
+00028300: 6f6d 0a20 2020 2022 2222 0a0a 2020 2020  om.    """..    
+00028310: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+00028320: 2064 6566 2065 7874 7261 6374 5f66 6f6f   def extract_foo
+00028330: 746e 6f74 6573 2863 6c73 2c20 666e 5f78  tnotes(cls, fn_x
+00028340: 7061 7468 2c20 666f 6f74 6e6f 7465 5f74  path, footnote_t
+00028350: 6578 745f 636c 6173 7365 732c 2068 746d  ext_classes, htm
+00028360: 6c5f 656c 656d 293a 0a20 2020 2020 2020  l_elem):.       
+00028370: 206e 6577 5f68 746d 6c5f 656c 656d 203d   new_html_elem =
+00028380: 2048 746d 6c4c 6962 2e63 7265 6174 655f   HtmlLib.create_
+00028390: 6e65 775f 6874 6d6c 5f77 6974 685f 6f6c  new_html_with_ol
+000283a0: 645f 7374 796c 6573 2868 746d 6c5f 656c  d_styles(html_el
+000283b0: 656d 290a 2020 2020 2020 2020 666f 6f74  em).        foot
+000283c0: 6e6f 7465 5f6e 756d 6265 725f 666f 6e74  note_number_font
+000283d0: 5f65 6c65 6d73 203d 2068 746d 6c5f 656c  _elems = html_el
+000283e0: 656d 2e78 7061 7468 2866 6e5f 7870 6174  em.xpath(fn_xpat
+000283f0: 6829 0a20 2020 2020 2020 206c 6173 745f  h).        last_
+00028400: 666f 6f74 6e75 6d20 3d20 300a 2020 2020  footnum = 0.    
+00028410: 2020 2020 756c 203d 2045 542e 456c 656d      ul = ET.Elem
+00028420: 656e 7428 2275 6c22 290a 2020 2020 2020  ent("ul").      
+00028430: 2020 4874 6d6c 4c69 622e 6765 745f 626f    HtmlLib.get_bo
+00028440: 6479 286e 6577 5f68 746d 6c5f 656c 656d  dy(new_html_elem
+00028450: 292e 6170 7065 6e64 2875 6c29 0a20 2020  ).append(ul).   
+00028460: 2020 2020 2023 206d 6573 7379 2c20 6e65       # messy, ne
+00028470: 6564 2061 2046 6f6f 746e 6f74 6520 6f62  ed a Footnote ob
+00028480: 6a65 6374 2068 6572 650a 2020 2020 2020  ject here.      
+00028490: 2020 666f 7220 666f 6f74 6e6f 7465 5f6e    for footnote_n
+000284a0: 756d 6265 725f 656c 656d 2069 6e20 666f  umber_elem in fo
+000284b0: 6f74 6e6f 7465 5f6e 756d 6265 725f 666f  otnote_number_fo
+000284c0: 6e74 5f65 6c65 6d73 3a0a 2020 2020 2020  nt_elems:.      
+000284d0: 2020 2020 2020 6c61 7374 5f66 6f6f 746e        last_footn
+000284e0: 756d 2c20 6c69 203d 2046 6f6f 746e 6f74  um, li = Footnot
+000284f0: 652e 6578 7472 6163 745f 666f 6f74 6e6f  e.extract_footno
+00028500: 7465 5f61 6e64 5f73 6176 6528 0a20 2020  te_and_save(.   
+00028510: 2020 2020 2020 2020 2020 2020 2066 6f6f               foo
+00028520: 746e 6f74 655f 6e75 6d62 6572 5f65 6c65  tnote_number_ele
+00028530: 6d2c 2066 6f6f 746e 6f74 655f 7465 7874  m, footnote_text
+00028540: 5f63 6c61 7373 6573 2c20 6c61 7374 5f66  _classes, last_f
+00028550: 6f6f 746e 756d 290a 2020 2020 2020 2020  ootnum).        
+00028560: 2020 2020 6966 206c 6920 6973 206e 6f74      if li is not
+00028570: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00028580: 2020 2020 2020 2075 6c2e 6170 7065 6e64         ul.append
+00028590: 286c 6929 0a20 2020 2020 2020 2072 6574  (li).        ret
+000285a0: 7572 6e20 6e65 775f 6874 6d6c 5f65 6c65  urn new_html_ele
+000285b0: 6d0a 0a20 2020 2040 636c 6173 736d 6574  m..    @classmet
+000285c0: 686f 640a 2020 2020 6465 6620 6973 5f66  hod.    def is_f
+000285d0: 6f6f 746e 6f74 655f 666f 6e74 2863 6c73  ootnote_font(cls
+000285e0: 2c20 666f 6f74 6e6f 7465 5f6e 756d 6265  , footnote_numbe
+000285f0: 725f 656c 656d 293a 0a20 2020 2020 2020  r_elem):.       
+00028600: 2022 2222 0a20 2020 2020 2020 2066 6f6e   """.        fon
+00028610: 7420 7369 7a65 2061 6c6f 6e65 2064 6f65  t size alone doe
+00028620: 7320 6e6f 7420 6469 7374 696e 6775 6973  s not distinguis
+00028630: 682c 2073 6f20 7573 6520 6e65 6967 6862  h, so use neighb
+00028640: 6f75 7269 6e67 2074 6578 740a 2020 2020  ouring text.    
+00028650: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00028660: 6e65 7874 203d 2058 6d6c 4c69 622e 6765  next = XmlLib.ge
+00028670: 745f 6e65 7874 5f65 6c65 6d65 6e74 2866  t_next_element(f
+00028680: 6f6f 746e 6f74 655f 6e75 6d62 6572 5f65  ootnote_number_e
+00028690: 6c65 6d29 0a20 2020 2020 2020 2074 6578  lem).        tex
+000286a0: 7420 3d20 666f 6f74 6e6f 7465 5f6e 756d  t = footnote_num
+000286b0: 6265 725f 656c 656d 2e74 6578 740a 2020  ber_elem.text.  
+000286c0: 2020 2020 2020 6966 206e 6578 7420 6973        if next is
+000286d0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+000286e0: 2020 2070 7269 6e74 2866 224e 4f20 666f     print(f"NO fo
+000286f0: 6c6c 6f77 696e 6720 656c 656d 2229 0a20  llowing elem"). 
+00028700: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00028710: 6e20 4661 6c73 650a 2020 2020 2020 2020  n False.        
+00028720: 2320 666f 6c6c 6f65 6420 6279 2073 6d61  # folloed by sma
+00028730: 6c6c 2066 6f6e 743f 0a20 2020 2020 2020  ll font?.       
+00028740: 206e 6578 745f 636c 6173 7320 3d20 6e65   next_class = ne
+00028750: 7874 2e61 7474 7269 625b 2263 6c61 7373  xt.attrib["class
+00028760: 225d 0a20 2020 2020 2020 2069 6620 6e65  "].        if ne
+00028770: 7874 5f63 6c61 7373 203d 3d20 2273 3130  xt_class == "s10
+00028780: 3435 223a 0a20 2020 2020 2020 2020 2020  45":.           
+00028790: 2072 6574 7572 6e20 5472 7565 0a20 2020   return True.   
+000287a0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+000287b0: 650a 0a0a 2320 466f 6f74 6e6f 7465 0a0a  e...# Footnote..
+000287c0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+000287d0: 0a20 2020 2064 6566 2065 7874 7261 6374  .    def extract
+000287e0: 5f66 6f6f 746e 6f74 655f 616e 645f 7361  _footnote_and_sa
+000287f0: 7665 2863 6c73 2c20 666f 6f74 6e6f 7465  ve(cls, footnote
+00028800: 5f6e 756d 6265 725f 656c 656d 2c20 666f  _number_elem, fo
+00028810: 6f74 6e6f 7465 5f74 6578 745f 636c 6173  otnote_text_clas
+00028820: 7365 732c 206c 6173 745f 666f 6f74 6e75  ses, last_footnu
+00028830: 6d29 3a0a 2020 2020 2020 2020 7465 7874  m):.        text
+00028840: 203d 2066 6f6f 746e 6f74 655f 6e75 6d62   = footnote_numb
+00028850: 6572 5f65 6c65 6d2e 7465 7874 0a20 2020  er_elem.text.   
+00028860: 2020 2020 2066 6f6f 746e 6f74 655f 6e75       footnote_nu
+00028870: 6d62 6572 203d 202d 310a 2020 2020 2020  mber = -1.      
+00028880: 2020 6967 6e6f 7265 203d 2046 616c 7365    ignore = False
+00028890: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+000288a0: 636c 732e 6973 5f66 6f6f 746e 6f74 655f  cls.is_footnote_
+000288b0: 666f 6e74 2866 6f6f 746e 6f74 655f 6e75  font(footnote_nu
+000288c0: 6d62 6572 5f65 6c65 6d29 3a0a 2020 2020  mber_elem):.    
+000288d0: 2020 2020 2020 2020 6967 6e6f 7265 203d          ignore =
+000288e0: 2054 7275 650a 2020 2020 2020 2020 7472   True.        tr
+000288f0: 793a 0a20 2020 2020 2020 2020 2020 2066  y:.            f
+00028900: 6f6f 746e 6f74 655f 6e75 6d62 6572 203d  ootnote_number =
+00028910: 2069 6e74 2874 6578 7429 0a20 2020 2020   int(text).     
+00028920: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+00028930: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
+00028940: 2069 676e 6f72 6520 3d20 5472 7565 0a20   ignore = True. 
+00028950: 2020 2020 2020 206c 6920 3d20 4e6f 6e65         li = None
+00028960: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00028970: 6967 6e6f 7265 2061 6e64 2035 203e 2028  ignore and 5 > (
+00028980: 666f 6f74 6e6f 7465 5f6e 756d 6265 7220  footnote_number 
+00028990: 2d20 6c61 7374 5f66 6f6f 746e 756d 2920  - last_footnum) 
+000289a0: 3e3d 2030 3a0a 2020 2020 2020 2020 2020  >= 0:.          
+000289b0: 2020 6c61 7374 5f66 6f6f 746e 756d 2c20    last_footnum, 
+000289c0: 6c69 203d 2063 6c73 2e64 656c 6574 655f  li = cls.delete_
+000289d0: 666f 6f74 6e6f 7465 5f6e 756d 6265 725f  footnote_number_
+000289e0: 616e 645f 666f 6c6c 6f77 696e 675f 7465  and_following_te
+000289f0: 7874 5f5f 616e 645f 6164 645f 746f 5f6c  xt__and_add_to_l
+00028a00: 6973 7428 0a20 2020 2020 2020 2020 2020  ist(.           
+00028a10: 2020 2020 2066 6f6f 746e 6f74 655f 7465       footnote_te
+00028a20: 7874 5f63 6c61 7373 6573 2c20 666f 6f74  xt_classes, foot
+00028a30: 6e6f 7465 5f6e 756d 6265 722c 0a20 2020  note_number,.   
+00028a40: 2020 2020 2020 2020 2020 2020 2066 6f6f               foo
+00028a50: 746e 6f74 655f 6e75 6d62 6572 5f65 6c65  tnote_number_ele
+00028a60: 6d29 0a20 2020 2020 2020 2072 6574 7572  m).        retur
+00028a70: 6e20 6c61 7374 5f66 6f6f 746e 756d 2c20  n last_footnum, 
+00028a80: 6c69 0a0a 2020 2020 2320 466f 6f74 6e6f  li..    # Footno
+00028a90: 7465 0a0a 2020 2020 4063 6c61 7373 6d65  te..    @classme
+00028aa0: 7468 6f64 0a20 2020 2064 6566 2063 7265  thod.    def cre
+00028ab0: 6174 655f 666f 6f74 6e6f 7465 5f6e 756d  ate_footnote_num
+00028ac0: 6265 725f 7870 6174 6828 636c 732c 2066  ber_xpath(cls, f
+00028ad0: 6f6f 746e 6f74 655f 6e75 6d62 6572 5f63  ootnote_number_c
+00028ae0: 6c61 7373 6573 293a 0a20 2020 2020 2020  lasses):.       
+00028af0: 2078 7061 7468 3020 3d20 2222 0a20 2020   xpath0 = "".   
+00028b00: 2020 2020 2066 6f72 2069 2c20 666e 6320       for i, fnc 
+00028b10: 696e 2065 6e75 6d65 7261 7465 2866 6f6f  in enumerate(foo
+00028b20: 746e 6f74 655f 6e75 6d62 6572 5f63 6c61  tnote_number_cla
+00028b30: 7373 6573 293a 0a20 2020 2020 2020 2020  sses):.         
+00028b40: 2020 2078 7061 7468 3020 2b3d 2022 2220     xpath0 += "" 
+00028b50: 6966 2069 203d 3d20 3020 656c 7365 2022  if i == 0 else "
+00028b60: 206f 7220 220a 2020 2020 2020 2020 2020   or ".          
+00028b70: 2020 7870 6174 6830 202b 3d20 6622 277b    xpath0 += f"'{
+00028b80: 666e 637d 2722 0a20 2020 2020 2020 2066  fnc}'".        f
+00028b90: 6e5f 7870 6174 6820 3d20 6622 2e2f 2f73  n_xpath = f".//s
+00028ba0: 7061 6e5b 7b78 7061 7468 307d 5d22 0a20  pan[{xpath0}]". 
+00028bb0: 2020 2020 2020 2072 6574 7572 6e20 666e         return fn
+00028bc0: 5f78 7061 7468 0a0a 2020 2020 2320 466f  _xpath..    # Fo
+00028bd0: 6f74 6e6f 7465 0a0a 2020 2020 4063 6c61  otnote..    @cla
+00028be0: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+00028bf0: 2064 656c 6574 655f 666f 6f74 6e6f 7465   delete_footnote
+00028c00: 5f6e 756d 6265 725f 616e 645f 666f 6c6c  _number_and_foll
+00028c10: 6f77 696e 675f 7465 7874 5f5f 616e 645f  owing_text__and_
+00028c20: 6164 645f 746f 5f6c 6973 7428 0a20 2020  add_to_list(.   
+00028c30: 2020 2020 2020 2020 2063 6c73 2c20 636c           cls, cl
+00028c40: 6173 7365 732c 2066 6f6f 746e 6f74 655f  asses, footnote_
+00028c50: 6e75 6d62 6572 2c20 666f 6f74 6e6f 7465  number, footnote
+00028c60: 5f6e 756d 6265 725f 656c 656d 293a 0a20  _number_elem):. 
+00028c70: 2020 2020 2020 206c 6920 3d20 4554 2e45         li = ET.E
+00028c80: 6c65 6d65 6e74 2822 6c69 2229 0a20 2020  lement("li").   
+00028c90: 2020 2020 206c 692e 6170 7065 6e64 2863       li.append(c
+00028ca0: 6f70 792e 6465 6570 636f 7079 2866 6f6f  opy.deepcopy(foo
+00028cb0: 746e 6f74 655f 6e75 6d62 6572 5f65 6c65  tnote_number_ele
+00028cc0: 6d29 290a 2020 2020 2020 2020 666f 6f74  m)).        foot
+00028cd0: 6e6f 7465 5f66 6f6c 6c6f 7765 7273 203d  note_followers =
+00028ce0: 2058 6d6c 4c69 622e 6765 745f 666f 6c6c   XmlLib.get_foll
+00028cf0: 6f77 696e 675f 656c 656d 656e 7473 2866  owing_elements(f
+00028d00: 6f6f 746e 6f74 655f 6e75 6d62 6572 5f65  ootnote_number_e
+00028d10: 6c65 6d29 0a20 2020 2020 2020 2023 2061  lem).        # a
+00028d20: 6464 206f 6e65 2073 7061 6e28 656e 6473  dd one span(ends
+00028d30: 2061 6674 6572 2066 6f6e 7420 6368 616d   after font cham
+00028d40: 6765 290a 2020 2020 2020 2020 636c 732e  ge).        cls.
+00028d50: 6974 6572 6174 655f 756e 7469 6c5f 756e  iterate_until_un
+00028d60: 6163 6365 7074 6162 6c65 5f66 6f6e 745f  acceptable_font_
+00028d70: 636c 6173 7328 666f 6f74 6e6f 7465 5f66  class(footnote_f
+00028d80: 6f6c 6c6f 7765 7273 2c20 6c69 3d6c 692c  ollowers, li=li,
+00028d90: 2066 6e5f 636c 6173 7365 733d 636c 6173   fn_classes=clas
+00028da0: 7365 7329 0a20 2020 2020 2020 206c 6173  ses).        las
+00028db0: 745f 666f 6f74 6e75 6d20 3d20 666f 6f74  t_footnum = foot
+00028dc0: 6e6f 7465 5f6e 756d 6265 720a 2020 2020  note_number.    
+00028dd0: 2020 2020 586d 6c4c 6962 2e72 656d 6f76      XmlLib.remov
+00028de0: 655f 656c 656d 656e 7428 666f 6f74 6e6f  e_element(footno
+00028df0: 7465 5f6e 756d 6265 725f 656c 656d 290a  te_number_elem).
+00028e00: 2020 2020 2020 2020 7265 7475 726e 206c          return l
+00028e10: 6173 745f 666f 6f74 6e75 6d2c 206c 690a  ast_footnum, li.
+00028e20: 0a20 2020 2023 2046 6f6f 746e 6f74 650a  .    # Footnote.
+00028e30: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+00028e40: 640a 2020 2020 6465 6620 6974 6572 6174  d.    def iterat
+00028e50: 655f 756e 7469 6c5f 756e 6163 6365 7074  e_until_unaccept
+00028e60: 6162 6c65 5f66 6f6e 745f 636c 6173 7328  able_font_class(
+00028e70: 636c 732c 2066 6f6c 6c6f 7765 7273 2c20  cls, followers, 
+00028e80: 6c69 3d4e 6f6e 652c 2066 6e5f 636c 6173  li=None, fn_clas
+00028e90: 7365 733d 4e6f 6e65 2c20 6465 6275 673d  ses=None, debug=
+00028ea0: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
+00028eb0: 2222 2269 7465 7261 7465 7320 6f76 6572  """iterates over
+00028ec0: 2065 6c65 6d74 7320 666f 6c6c 6f77 696e   elemts followin
+00028ed0: 6720 6120 666f 6f74 6e6f 7465 206e 756d  g a footnote num
+00028ee0: 6265 7220 756e 7469 6c20 616e 2069 6e63  ber until an inc
+00028ef0: 6f6d 7061 7469 626c 650a 2020 2020 2020  ompatible.      
+00028f00: 2020 636c 6173 7320 7374 796c 6520 6973    class style is
+00028f10: 2066 6f75 6e64 2c20 7768 656e 2062 7265   found, when bre
+00028f20: 616b 2222 220a 2020 2020 2020 2020 666f  ak""".        fo
+00028f30: 7220 666f 6c6c 6f77 6572 2069 6e20 666f  r follower in fo
+00028f40: 6c6c 6f77 6572 733a 0a20 2020 2020 2020  llowers:.       
+00028f50: 2020 2020 2063 6c61 7a7a 203d 2066 6f6c       clazz = fol
+00028f60: 6c6f 7765 722e 6174 7472 6962 5b22 636c  lower.attrib["cl
+00028f70: 6173 7322 5d0a 2020 2020 2020 2020 2020  ass"].          
+00028f80: 2020 6966 2063 6c61 7a7a 2069 6e20 666e    if clazz in fn
+00028f90: 5f63 6c61 7373 6573 3a0a 2020 2020 2020  _classes:.      
+00028fa0: 2020 2020 2020 2020 2020 6c69 2e61 7070            li.app
+00028fb0: 656e 6428 636f 7079 2e64 6565 7063 6f70  end(copy.deepcop
+00028fc0: 7928 666f 6c6c 6f77 6572 2929 0a20 2020  y(follower)).   
+00028fd0: 2020 2020 2020 2020 2020 2020 2058 6d6c               Xml
+00028fe0: 4c69 622e 7265 6d6f 7665 5f65 6c65 6d65  Lib.remove_eleme
+00028ff0: 6e74 2866 6f6c 6c6f 7765 7229 0a20 2020  nt(follower).   
+00029000: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00029010: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00029020: 6620 6465 6275 673a 0a20 2020 2020 2020  f debug:.       
+00029030: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00029040: 6e74 2866 2262 726f 6b65 206f 7574 206f  nt(f"broke out o
+00029050: 6620 666f 6f74 6e6f 7465 2061 7420 7b63  f footnote at {c
+00029060: 6c61 7a7a 7d22 290a 2020 2020 2020 2020  lazz}").        
+00029070: 2020 2020 2020 2020 6272 6561 6b0a 0a0a          break...
```

### Comparing `amilib-0.0.5/amilib/ami_integrate.py` & `amilib-0.0.6/amilib/ami_integrate.py`

 * *Files identical despite different names*

### Comparing `amilib-0.0.5/amilib/ami_nlp.py` & `amilib-0.0.6/amilib/ami_nlp.py`

 * *Files 0% similar despite different names*

```diff
@@ -27,15 +27,14 @@
 T_TEXT = "t_text"
 T_ID = "t_id"
 
 # nltk
 N_ENGLISH = 'english'
 N_PUNKT = 'punkt'
 
-logger = logging.getLogger(__file__)
 
 class AmiNLP:
 
     def __init__(self):
         self.stemmer = nltk.stem.porter.PorterStemmer()
         self.remove_punctuation_map = dict((ord(char), None) for char in string.punctuation)
         self.vectorizer = TfidfVectorizer(tokenizer=self.normalize, stop_words=N_ENGLISH)
```

### Comparing `amilib-0.0.5/amilib/ami_pdf_libs.py` & `amilib-0.0.6/amilib/ami_pdf_libs.py`

 * *Files identical despite different names*

### Comparing `amilib-0.0.5/amilib/ami_svg.py` & `amilib-0.0.6/amilib/ami_svg.py`

 * *Files identical despite different names*

### Comparing `amilib-0.0.5/amilib/ami_util.py` & `amilib-0.0.6/amilib/ami_util.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,23 +1,19 @@
 """
 Utilities (mainly classmethods)
 """
-import logging
 from pathlib import Path
 import numpy as np
 # import numpy.linalg as LA
 import math
 import csv
 
 X = 0
 Y = 1
 
-logger = logging.getLogger(__file__)
-
-
 class AmiUtil:
 
     @classmethod
     def check_type_and_existence(cls, target, expected_type):
         """
         asserts not None for object and its type
         if path asserts existence
@@ -37,16 +33,16 @@
     def is_ordered_numbers(cls, limits2):
         """
         check limits2 is a numeric 2-tuple in increasing order
         :param limits2:
         :return: True tuple[1] > tuple[2]
         """
         return limits2 is not None and len(limits2) == 2 \
-           and AmiUtil.is_number(limits2[0]) and AmiUtil.is_number(limits2[1]) \
-           and limits2[1] > limits2[0]
+               and AmiUtil.is_number(limits2[0]) and AmiUtil.is_number(limits2[1]) \
+               and limits2[1] > limits2[0]
 
     @classmethod
     def is_number(cls, s):
         """
         test if s is a number
         :param s:
         :return: True if float(s) succeeds
@@ -71,15 +67,15 @@
 
     @classmethod
     def int2hex(cls, ii):
         """convert int (0-255) to 2-character hex string
         :param ii: integer
         :return: 2-digit hex string of form 01, 09, 0f, 10, ff , or None if not int 0-125
         """
-        if ii is None or not type(ii) is int or ii < 0 or ii > 255:
+        if ii is None or not type(ii) is int or ii < 0 or ii> 255:
             return None
         return ('0' + hex(ii)[2:])[-2:]
 
     @classmethod
     def is_white(cls, color, delta=20, sat=255):
         """is color white within given tolerance
         255 - color[i] < delta
@@ -129,14 +125,15 @@
             return False
         mean = (color[0] + color[1] + color[2]) / 3
         for i in range(3):
             if abs(color[i] - mean) > delta:
                 return False
         return True
 
+
     @classmethod
     def get_xy_from_sknw_centroid(cls, yx):
         """
         yx is a 2-array and coords need swapping
         and changing from numpy to int
         :param yx:
         :return: [x,y]
@@ -183,17 +180,17 @@
         '''
         AmiUtil.assert_is_float_array(p0)
         AmiUtil.assert_is_float_array(p1)
         AmiUtil.assert_is_float_array(p2)
 
         linal = False
         if linal:
-            np0 = np.array(p0, dtype=np.uint8)
-            np1 = np.array(p1, dtype=np.uint8)
-            np2 = np.array(p2, dtype=np.uint8)
+            np0 = np.array(p0, dtype=uint8)
+            np1 = np.array(p1, dtype=uint8)
+            np2 = np.array(p2, dtype=uint8)
             v0 = np0 - np1
             v1 = np2 - np1
             angle = np.math.atan2(np.linalg.det([v0, v1]), np.dot(v0, v1))
         else:
             dx0 = p0[0] - p1[0]
             dy0 = p0[1] - p1[1]
             v01 = [p0[0] - p1[0], p0[1] - p1[1]]
@@ -234,14 +231,15 @@
 
         dx0 = fxy0[0] - fxy1[0]
         dy0 = fxy0[1] - fxy1[1]
         dist = math.sqrt(dx0 * dx0 + dy0 * dy0)
 
         return dist
 
+
     @classmethod
     def assert_is_float_array(cls, arr, length=2):
         """
         assert arr[0] is float and has given length
         :param arr:
         :param length:
         :return:
@@ -265,15 +263,15 @@
         """
         converts a list of ints or uint16 or uint8 to floats
         :param int_lst: 
         :return: 
         """
         assert int_lst is not None and type(int_lst) is list and len(int_lst) > 0, f"not a list: {int_lst}"
         tt = type(int_lst[0])
-        assert tt is int or tt is np.uint8 or tt is np.uint16, f"expected int, got {tt}"
+        assert tt is int or tt is uint8 or tt is uint16, f"expected int, got {tt}"
         return [float(i) for i in int_lst]
 
     @classmethod
     def to_float_array(cls, arr):
         """
         converts to array of floats if possible
         :param arr:
@@ -333,15 +331,14 @@
         assert path is not None, "no path given"
         with open(path, "w", encoding="UTF-8", newline='') as f:
             writer = csv.writer(f)
             if header:
                 writer.writerow(header)
             writer.writerows(xy_array)
 
-
 class Vector2:
 
     def __init__(self, v2):
         self.vec2 = v2
 
     # @classmethod
     # def angle_to(cls, vv0, vv1):
```

### Comparing `amilib-0.0.5/amilib/amidriver.py` & `amilib-0.0.6/amilib/amidriver.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-import logging
 import time
 from io import StringIO
 from pathlib import Path
 
 from selenium import webdriver
 from selenium.webdriver import Chrome
 from selenium.webdriver.chrome.service import Service
@@ -15,15 +14,15 @@
 
 import lxml.etree as ET
 
 URL = "url"
 XPATH = "xpath"
 OUTFILE = "out_file"
 
-logger = logging.getLogger(__file__)
+
 
 class AmiDriver:
     """
     create and wrap a Chrome headless browser
     Author Ayush Garg, modified Peter Murray-Rust
     """
```

### Comparing `amilib-0.0.5/amilib/amix.py` & `amilib-0.0.6/amilib/amix.py`

 * *Files 1% similar despite different names*

```diff
@@ -2,26 +2,24 @@
 import logging
 import re
 import sys
 import textwrap
 from enum import Enum
 from pathlib import Path
 
-from amilib.html_args import HTMLArgs
+from amilib.ami_html import HTMLArgs
 from amilib.pdf_args import PDFArgs
 from amilib.util import AbstractArgs
 from amilib.wikimedia import WikidataLookup
 
 # local
 
 AMIX_DIR = Path(__file__).parent
 REPO_DIR = AMIX_DIR.parent
 
-logger = logging.getLogger(__file__)
-
 
 class AmiLib:
     logger = logging.getLogger("amilib")
     #     """ main entry point for running pyami
     #      """
     #     OUTFILE = "outfile"
     #
@@ -161,41 +159,36 @@
             print(f"run pdf")
 
         # def run_project():
         #     print(f"run project {self.args}")
 
         version = self.version()
         if not sys.argv or len(sys.argv) == 0:
+            # what does this do?
             sys.argv = [AmiLib.AmiLib]
         parser = argparse.ArgumentParser(
             description=f'pyamihtmlx: V{version} call with ONE of subcommands (HTML,PDF, IPCC, UNFCCC), e.g. pyamihtmlx IPCC --help'
         )
 
-        # apply_choices = [self.PDF2TXT, self.PDF2SVG, self.SVG2XML, self.TXT2SENT, self.XML2HTML, self.XML2TXT]
-        # apply_choices = ConvType.list_values()
-        # self.logger.debug(f"ch {apply_choices}")
         parser.add_argument('-v', '--version', action="store_true",
                             help=f"show version {version}")
         parser.formatter_class = argparse.RawDescriptionHelpFormatter
         parser.description = textwrap.dedent(
             'pyamihtml: create, manipulate, use CProject \n'
             '----------------------------------------\n\n'
             'Pyamihtml is the largest collection of functionality in the AMI system.'
             'It contains executable code and libraries to manage complex documents.\n'
             'A key structure is the corpus (CProject directory) which contains a list of subdirectories '
             '(CTrees) which themselves contain many different document features (text, tables, images, graphics.\n'
             'Pyamihtml can create, fill, manipulate, transform many of the components including PDF, HTML, TXT, images, CSV.\n'
             '\n'
             'The subcommands:\n\n'
-            # '  DICT <options>      # create/edit/search dictionaries\n'
-            # '  GUI <options>       # run tkinter GUI (prototype)\n'
             '  HTML <options>      # create/edit HTML\n'
             '  IPCC <options>      # customised IPCC tools\n'
             '  PDF <options>       # convert PDF into HTML and images\n'
-            # '  PROJECT <options>   # create and transform a corpus of documents\n'
             '  UNFCCC <options>    # customised UNFCCC tools\n'
             '\n'
             'After installation, run \n'
             '  pyamihtmlx <subcommand> <options>\n'
             '\n'
             '\nExamples (# foo is a comment):\n'
             '  pyamihtmlx        # runs help\n'
@@ -1155,17 +1148,17 @@
         This is still a mess. We need to set the version once somewhere.
         """
 
         version = '0.0.1a1'  # 2024-03-27
         version = '0.0.1a3'  # 2024-03-27
         version = '0.0.1'  # 2024-04-03
         version = '0.0.2'  # 2024-04-04
-        version = '0.0.3'  # 2024-04-06
-        version = '0.0.4'  # 2024-04-06
-        version = '0.0.5'  # 2024-04-06
+        version = '0.0.3'  # 2024-04-19
+        # had to revert here I think
+        version = '0.0.6'  # 2024-04-19
 
         # logging.warn(f"VERSION {version}")
         return version
 
 
 class AmiLibArgs(AbstractArgs):
     """Parse args to analyze, edit and annotate HTML"""
```

### Comparing `amilib-0.0.5/amilib/bbox.py` & `amilib-0.0.6/amilib/bbox.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,14 +1,13 @@
 """bounding box"""
-import logging
+
 import math
 # this should be in a separate library
 from amilib.ami_util import AmiUtil
 
-logger = logging.getLogger(__file__)
 
 
 class BBox:
     """bounding box 2array of 2arrays, based on integers
     """
 
     X = "x"
```

### Comparing `amilib-0.0.5/amilib/file_lib.py` & `amilib-0.0.6/amilib/file_lib.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,25 +1,22 @@
 """
 standalone library from pyamihtml
 """
 import ast
-import errno
 import glob
 import json
 import logging
 import os
 import re
 import shutil
 from pathlib import Path, PurePath, PurePosixPath
 
 import chardet
 import requests
 
-from amilib.util import TextUtil
-
 logging.debug("loading file_lib")
 
 # wildcards
 STARS = "**"
 STAR = "*"
 
 # suffixes
@@ -52,18 +49,18 @@
 
 # files
 # FULLTEXT_PAGE = "fulltext-page*"
 # CHANNEL_STAR = "channel*"
 # RAW = "raw"
 
 
-logger = logging.getLogger(__file__)
 
 
 class FileLib:
+
     logger = logging.getLogger("file_lib")
 
     @classmethod
     def force_mkdir(cls, dirx):
         """ensure dirx and its parents exist
         :dirx: directory
         """
@@ -72,14 +69,16 @@
             try:
                 path.mkdir(parents=True, exist_ok=True)
                 assert (f := path).exists(), f"dir {path} should now exist"
             except Exception as e:
                 cls.logger.error(f"cannot make dirx {dirx} , {e}")
                 print(f"cannot make dirx {dirx}, {e}")
 
+
+
     @classmethod
     def force_mkparent(cls, file):
         """ensure parent directory exists
 
         :path: whose parent directory is to be created if absent
         """
         if file is not None:
@@ -230,15 +229,15 @@
         """
         deletes directories recursively using shutil.rmtree
         :param dirx: directory tree to delete
         :param delete_directory: If True, delete dirx
         :return None:
         """
         if not dirx or not Path(dirx).exists():
-            print(f"no directory given or found {dirx}")
+            print (f"no directory given or found {dirx}")
             return
         if delete_directory:
             shutil.rmtree(dirx)
         else:
             for path in Path(dirx).glob("**/*"):
                 if path.is_file():
                     path.unlink()
@@ -315,14 +314,15 @@
         """converts list of files to posix form (i.e. all files have / not backslash)
         """
         if file_list is None:
             return None
         posix_files = [PurePosixPath(f) for f in file_list]
         return posix_files
 
+
     @classmethod
     def delete_file(cls, file):
         """delete file (uses unlink) and asserts it has worked
         ;param file: to delete"""
         if file.exists():
             file.unlink()
         assert not file.exists()
@@ -338,16 +338,15 @@
 
         with open(str(path), "w") as f:
             json.dump(dikt, f, indent=indent)
         if debug:
             print(f"wrote dictionary to {path}")
 
     @classmethod
-    def read_string_with_user_agent(self, url, user_agent='my-app/0.0.1', encoding="UTF-8", encoding_scheme="chardet",
-                                    debug=False):
+    def read_string_with_user_agent(self, url, user_agent='my-app/0.0.1', encoding="UTF-8", encoding_scheme="chardet", debug=False):
         """
         allows request.get() to use a user_agent
         :param url: url to read
         :param encoding_scheme: id "chardet uses chardet else response.appenent_encoding
         :return: decoded string
         """
         if not url:
@@ -357,16 +356,15 @@
         response = requests.get(url, headers={'user-agent': user_agent})
         if debug:
             print(f"response: {response} content: {response.content[:400]}")
         content = response.content
         if debug:
             print(f"apparent encoding: {response.apparent_encoding}")
         if encoding is None:
-            encoding = chardet.detect(content)[
-                'encoding'] if encoding_scheme == "chardet" else response.apparent_encoding
+            encoding = chardet.detect(content)['encoding'] if encoding_scheme == "chardet" else response.apparent_encoding
         content = content.decode(encoding)
         return content, encoding
 
     @classmethod
     def join_dir_and_file_as_posix(cls, indir, input):
         """
         joins indir (directory) and input (descendants) to make a list of full filenames
@@ -401,15 +399,15 @@
             for input_item in input:
                 if input_item[0] != "/":
                     posix = PurePosixPath(indir, input_item)
                     outputs.append(str(posix))
             return outputs
 
     @classmethod
-    def posix_glob(cls, glob_str, recursive=True):
+    def posix_glob(cls, glob_str, recursive = True):
         """expands glob and ensure all output is posix
         :param glob_str: glob or list of globs to expand
         :param recursive: use recursive glob
         :return: list of files in posix format"""
         files = []
         if glob_str is None:
             return files
@@ -431,23 +429,25 @@
         try:
             assert path.exists(), f"file {path} must exist"
             assert (s := path.stat().st_size) > minsize, f"file {file} size = {s} must be above {minsize}"
         except AssertionError as e:
             if abort:
                 raise e
 
+
     @classmethod
     def get_home(cls):
         """
         gets home directory os.path.expanduser("~")
         """
         home = os.path.expanduser("~")
         return home
 
 
+
 # see https://realpython.com/python-pathlib/
 
 def main():
     print("started file_lib")
     # test_templates()
 
     print("finished file_lib")
@@ -457,15 +457,14 @@
     print("running file_lib main")
     main()
 else:
     #    print("running file_lib main anyway")
     #    main()
     pass
 
-
 # examples of regex for filenames
 
 
 def glob_re(pattern, strings):
     return filter(re.compile(pattern).match, strings)
```

### Comparing `amilib-0.0.5/amilib/html_generator.py` & `amilib-0.0.6/amilib/html_generator.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,23 +1,24 @@
+import json
 import logging
 from io import BytesIO
 from pathlib import Path
 
 import lxml
 import pdfplumber
 from pyamihtml.ami_pdf import PDFDebug
 
-from amilib.ami_html import H_BODY, H_DIV
 from amilib.ami_html import HtmlUtil, P_FONTNAME, P_HEIGHT, P_STROKING_COLOR, P_NON_STROKING_COLOR, AmiSpan, P_TEXT, \
     HtmlGroup, HtmlStyle
-from amilib.ami_pdf_libs import AmiPDFPlumber, AmiPage, TextStyle
-from amilib.ami_pdf_libs import create_thin_line_from_rect, AmiPlumberJson
+from amilib.ami_pdf_libs import create_thin_line_from_rect, AmiPDFPlumber, AmiPlumberJson
+from amilib.ami_pdf_libs import AmiPDFPlumber,AmiPage, TextStyle
 from amilib.file_lib import FileLib
 from amilib.util import AmiLogger
 from amilib.xml_lib import HtmlLib, XmlLib
+from amilib.ami_html import H_BODY, H_DIV
 
 logger = AmiLogger.create_named_logger(__file__)
 logger = logging.getLogger(__file__)
 
 DICT_KEYSET = set([
     'annots',
     'bbox',
```

### Comparing `amilib-0.0.5/amilib/html_marker.py` & `amilib-0.0.6/amilib/html_marker.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,25 +1,23 @@
 import copy
 import csv
-import logging
+import glob
 import re
 from collections import Counter, defaultdict
 from dataclasses import dataclass
 from pathlib import Path
 
 import lxml.etree
 
 from amilib.ami_html import HtmlStyle
 from amilib.ami_integrate import HtmlGenerator
 from amilib.util import Util, EnhancedRegex, GENERATE
 # from pyamihtmlx.util import EnhancedRegex, GENERATE, Util
 from amilib.xml_lib import HtmlLib, Templater, XmlLib
 
-logger = logging.getLogger(__file__)
-
 
 def replace_parent(current_parents, div):
     pass
 
 
 def add__and_insert_parents(current_parents, div, level_index):
     pass
@@ -980,64 +978,64 @@
     styles: list
     force_make_pdf: bool
     svg_dir: str
     page_json_dir: str
     debug: bool
 
     def __init__(self,
-                 file_splitter=None,
-                 insubdir=None,
-                 instem=None,
-                 outsubdir=None,
-                 top_outdir=None,
-                 directory_maker=None,
-                 markukp_dict=None,
-                 inline_dict=None,
-                 param_dict=None,
-                 targets=None,
-                 styles=None,
-                 force_make_pdf=True,
-                 svg_dir=None,
-                 page_json_dir=None,
-                 debug=False
-                 ):
-        self.file_splitter = file_splitter
-        self.insubdir = insubdir
-        self.instem = instem
-        self.outsubdir = outsubdir
-        self.top_outdir = top_outdir
-        self.directory_maker = directory_maker
-        self.markukp_dict = markukp_dict
-        self.inline_dict = inline_dict
-        self.param_dict = param_dict
-        self.targets = targets
-        self.styles = styles
-        self.force_make_pdf = force_make_pdf
-        self.svg_dir = svg_dir
-        self.page_json_dir = page_json_dir
-        self.debug = debug
+        file_splitter = None,
+        insubdir = None,
+        instem = None,
+        outsubdir = None,
+        top_outdir = None,
+        directory_maker = None,
+        markukp_dict = None,
+        inline_dict = None,
+        param_dict = None,
+        targets = None,
+        styles = None,
+        force_make_pdf = True,
+        svg_dir = None,
+        page_json_dir = None,
+        debug = False
+    ):
+        self.file_splitter=file_splitter
+        self.insubdir=insubdir
+        self.instem=instem
+        self.outsubdir=outsubdir
+        self.top_outdir=top_outdir
+        self.directory_maker=directory_maker
+        self.markukp_dict=markukp_dict
+        self.inline_dict=inline_dict
+        self.param_dict=param_dict
+        self.targets=targets
+        self.styles=styles
+        self.force_make_pdf=force_make_pdf
+        self.svg_dir=svg_dir
+        self.page_json_dir=page_json_dir
+        self.debug=debug
 
     @classmethod
     def make_dataclass(cls):
         dc = HtmlPipelineData(
-            file_splitter=None,
-            insubdir=None,
-            instem=None,
-            outsubdir=None,
-            top_outdir=None,
-            directory_maker=None,
-            markukp_dict=None,
-            inline_dict=None,
-            param_dict=None,
-            targets=None,
-            styles=None,
-            force_make_pdf=True,
-            svg_dir=None,
-            page_json_dir=None,
-            debug=False
+        file_splitter = None,
+        insubdir = None,
+        instem = None,
+        outsubdir = None,
+        top_outdir = None,
+        directory_maker = None,
+        markukp_dict = None,
+        inline_dict = None,
+        param_dict = None,
+        targets = None,
+        styles = None,
+        force_make_pdf = True,
+        svg_dir = None,
+        page_json_dir = None,
+        debug = False
         )
         """holds state and can be passed between steps"""
         return dc
 
 
 class HtmlPipeline:
     """pipeline for HTML conversioms"""
@@ -1247,15 +1245,14 @@
         html_elem = HtmlLib.parse_html(infile)
         HtmlLib.write_html_file(html_elem, outfile=outfile)
 
     @classmethod
     def print_step(cls, step):
         print(f"==========\nrunning {step}\n============")
 
-
 class HearstPattern:
     """extracts Hearst paaterns using regexes
     NYI
     """
 
     def __init__(self, regex=None):
         self.regex = regex
```

### Comparing `amilib-0.0.5/amilib/pdf_args.py` & `amilib-0.0.6/amilib/pdf_args.py`

 * *Files identical despite different names*

### Comparing `amilib-0.0.5/amilib/util.py` & `amilib-0.0.6/amilib/util.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,28 +1,29 @@
 import argparse
 import ast
-import base64
 import codecs
-import csv
 import importlib
-import json
 import logging
 import os
-import re
 import sys
-import time
+import csv
+import re
+from enum import Enum
 from abc import ABC, abstractmethod
 from collections import Counter
-from enum import Enum
-from pathlib import Path
 
+import lxml
 import pandas as pd
 import pyvis
-import requests
 from lxml import html
+from pathlib import Path
+import time
+import requests
+import json
+import base64
 
 logger = logging.getLogger(__file__)
 
 HREF = "href"
 
 
 class Util:
```

### Comparing `amilib-0.0.5/amilib/wikimedia.py` & `amilib-0.0.6/amilib/wikimedia.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,24 +1,25 @@
 import json
 import logging
 import os
 import re
 import sys
 from enum import Enum
-from io import StringIO
 from pathlib import Path
-from urllib.error import HTTPError
-from urllib.parse import quote
-from urllib.request import urlopen
 
-import lxml.etree
 import requests
-from SPARQLWrapper import SPARQLWrapper
 from lxml import etree as ET
-from lxml import html
+from lxml import etree, html
+import lxml.etree
+from urllib.parse import quote
+from io import StringIO
+from urllib.request import urlopen
+from lxml import etree
+from urllib.error import HTTPError
+from SPARQLWrapper import SPARQLWrapper
 
 # local
 from amilib.ami_html import HtmlUtil
 from amilib.util import Util
 
 logging.debug("loading wikimedia.py")
 
@@ -54,19 +55,17 @@
 ID_NAME = "id_name"
 SPQ_NAME = "sparql_name"
 DICT_NAME = "dict_name"
 
 ARTICLEs = [
     ".*((scientific|journal)\\s+)?article.*",
     ".*((scientific|academic)\\s+)?journal.*"
-]
+     ]
 ARTS = [".*(film|song|album)"]
 
-logger = logging.getLogger(__file__)
-
 
 # this should go in config files
 class WikidataPredicate:
     chemistry = {
         "P31": {
             "Q11173": "chemical compound",
             "weight": 0.9
@@ -91,24 +90,26 @@
     def __init__(self, exact_lookup=False):
         self.term = None
         self.wikidata_dict = None
         self.root = None
         self.exact_lookup = exact_lookup
         self.hits_dict = dict()
 
+
     def lookup_wikidata(self, term):
         """
         Looks up term in Wikidata and gets Q number and descriptiom
 
         NOTE requires Internet
 
         :param term: word or phrase to lookup
         :return: triple (e.g. hit0_id, hit0_description, wikidata_hits)
         """
 
+
         if not term:
             logging.warning("null term")
             return None, None, None
         self.term = term
         MAX_ENTRIES = 5
         url = WIKIDATA_QUERY_URI + quote(term.encode('utf8'))
         # print(f"url {url}")
@@ -169,15 +170,15 @@
                 self.add_subdict_title_desc_statements(li, qitem, result_heading_a_elem, wikidata_dict)
         return wikidata_dict
 
     def add_subdict_title_desc_statements(self, li, qitem, result_heading_a, wikidata_dict):
         sub_dict = {}
         wikidata_dict[qitem] = sub_dict
         # make title from text children not tooltip
-        text = ''.join(result_heading_a.itertext())  # acetone (Q49546)
+        text = ''.join(result_heading_a.itertext()) # acetone (Q49546)
         title = text.split("(Q")[0]
         sub_dict[TITLE] = title
         find_arg = "./div[@class='" + SEARCH_RESULT + "']/span"
         find_elem = li.find(find_arg)
         sub_dict[DESC] = None if find_elem is None else find_elem.text
 
         # just take statements at present (n statements or 1 statement)
@@ -561,14 +562,15 @@
         </div>
         """
         li_list = self.root.xpath(
             ".//div[normalize-space(@class)='wikibase-entitytermsview-heading-aliases']/ul/li[@class='wikibase-entitytermsview-aliases-alias']")
         aliases = [li.text for li in li_list]
         return
 
+
     def get_id(self):
         """
         get id from <span class="wikibase-title-id">(Q42)</span>
         remove brackets
         :return: P/Q id or None
         """
         id_list = self.get_elements_for_normalized_attrib_val("class", "wikibase-title-id")
@@ -677,24 +679,27 @@
             logging.error(f"must give required wikidata label")
             return None
         idlist = []
         for label, id in zip(labels, ids):
             if label_match(label, wikidata_label, method, ignorecase):  # METHOD NOT WRITTEN
                 idlist.append(id)
 
+
     """<div class="wikibase-entitytermsview-heading-description">chemical compound</div>"""
 
     def debug_page(self):
         """debug crude"""
         if self.root is None:
             print(f"no root for wikidata")
         else:
             HtmlUtil.write_html_elem(self.root, sys.stdout, pretty_print=True)
 
 
+
+
 class WikidataSparql:
 
     def __init__(self, dictionary):
         self.dictionary = dictionary
 
     def update_from_sparql(self, sparql_file, sparql_to_dictionary):
         self.sparql_to_dictionary = sparql_to_dictionary
@@ -789,14 +794,15 @@
         except HTTPError as e:
             print(f"cannout open {url} because {e}")
         tree = ET.parse(StringIO(content), ET.HTMLParser())
         root = tree.getroot()
         return root
 
 
+
 class WikidataExtractor:
     """Thanks to Awena for showing the approach"""
     VERSION = "0.1"
     USER_AGENT = "Mozilla/5.0 (compatible; Pyami/" + VERSION + "; +https://github.com/petermr/pyami/)"
     WIKIDATA_API = "https://www.wikidata.org/w/api.php"
 
     def __init__(self, lang='en'):
```

### Comparing `amilib-0.0.5/amilib/xml_lib.py` & `amilib-0.0.6/amilib/xml_lib.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,25 +1,25 @@
 import copy
 import html
 import logging
 import os
 import pprint
 import re
-import tkinter as tk
-from io import StringIO
 from pathlib import Path
 from urllib.request import urlopen
 
+import chardet
 import lxml
 import lxml.etree
 import requests
 import tkinterweb
 from lxml import etree as ET
 from lxml.etree import _Element, _ElementTree
 from lxml.html import HTMLParser
+import tkinter as tk
 
 from amilib.file_lib import FileLib
 
 logging.debug("loading xml_lib")
 
 # make leafnodes and copy remaning content as XML
 TERMINAL_COPY = {
```

### Comparing `amilib-0.0.5/amilib.egg-info/PKG-INFO` & `amilib-0.0.6/amilib.egg-info/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: amilib
-Version: 0.0.5
+Version: 0.0.6
 Summary: document download, cleaning, managemenr
 Home-page: https://github.com/petermr/amilib
 Author: Peter Murray-Rust
 Author-email: petermurrayrust@googlemail.com
 License: Apache2
 Keywords: text and data mining
 Classifier: Development Status :: 3 - Alpha
```

### Comparing `amilib-0.0.5/amilib.egg-info/SOURCES.txt` & `amilib-0.0.6/amilib.egg-info/SOURCES.txt`

 * *Files 5% similar despite different names*

```diff
@@ -10,15 +10,14 @@
 amilib/ami_pdf_libs.py
 amilib/ami_svg.py
 amilib/ami_util.py
 amilib/amidriver.py
 amilib/amix.py
 amilib/bbox.py
 amilib/file_lib.py
-amilib/html_args.py
 amilib/html_generator.py
 amilib/html_marker.py
 amilib/pdf_args.py
 amilib/util.py
 amilib/wikimedia.py
 amilib/xml_lib.py
 amilib.egg-info/PKG-INFO
```

### Comparing `amilib-0.0.5/setup.py` & `amilib-0.0.6/setup.py`

 * *Files 1% similar despite different names*

```diff
@@ -29,15 +29,15 @@
  'scikit-learn',
 
 ]
 
 setup(
     name='amilib',
     url='https://github.com/petermr/amilib',
-    version='0.0.5',
+    version='0.0.6',
     description='document download, cleaning, managemenr',
     long_description_content_type='text/markdown',
     long_description=readme,
     author="Peter Murray-Rust",
     author_email='petermurrayrust@googlemail.com',
     license='Apache2',
     install_requires=requirements,
```

### Comparing `amilib-0.0.5/test/test_headless.py` & `amilib-0.0.6/test/test_headless.py`

 * *Files identical despite different names*

### Comparing `amilib-0.0.5/test/test_html.py` & `amilib-0.0.6/test/test_html.py`

 * *Files identical despite different names*

### Comparing `amilib-0.0.5/test/test_nlp.py` & `amilib-0.0.6/test/test_nlp.py`

 * *Files identical despite different names*

### Comparing `amilib-0.0.5/test/test_pdf.py` & `amilib-0.0.6/test/test_pdf.py`

 * *Files 0% similar despite different names*

```diff
@@ -145,19 +145,17 @@
         page_json_dir = output_page_dir
         output_page_dir.mkdir(exist_ok=True, parents=True)
         ami_pdfplumber = AmiPDFPlumber()
         HtmlGenerator.create_html_pages(
             ami_pdfplumber, input_pdf=input_pdf, outdir=output_page_dir, page_json_dir=page_json_dir,
             pages=[1, 2, 3, 4, 5, 6, 7])
 
-    # @unittest.skipUnless(AmiAnyTest.run_long(), "run occasionally")
-    @unittest.skip(reason="too complex")
+    @unittest.skipUnless(AmiAnyTest.run_long(), "run occasionally")
     def test_pdfplumber_doublecol_create_pages_for_WGs_HACKATHON(self):
         """
-        TODO move this to climate
         creates AmiPDFPlumber and reads double-column pdf and debugs
         This is also an integration/project test
         """
 
         report_names = [
             # "SYR_LR",
             # "SYR_SPM",
```

### Comparing `amilib-0.0.5/test/test_stat.py` & `amilib-0.0.6/test/test_stat.py`

 * *Files identical despite different names*

### Comparing `amilib-0.0.5/test/test_svg.py` & `amilib-0.0.6/test/test_svg.py`

 * *Files identical despite different names*

### Comparing `amilib-0.0.5/test/test_util.py` & `amilib-0.0.6/test/test_util.py`

 * *Files 1% similar despite different names*

```diff
@@ -266,7 +266,18 @@
         }
 
         template = "{DecRes}_{decision}_{type}_{session}"
         regex = "(?P<DecRes>Decision|Resolution)\\s(?P<decision>\\d+)/(?P<type>CMA|CMP|CP)\\.(?P<session>\\d+)"
         ss = ["Decision 12/CMP.5", "Decision 10/CP.17", "Decision 2/CMA.2", "Decision 4/CCC.9"]
         matched_templates = Templater.get_matched_templates(regex, ss, template)
         assert matched_templates == ['Decision_12_CMP_5', 'Decision_10_CP_17', 'Decision_2_CMA_2', None]
+
+class UtilTests:
+    def test_dict_read(self):
+        file = "section_templates.json"
+        return Util.read_pydict_from_json(file)
+
+class TestCommandline:
+
+    def test_command(self):
+        command = "--help"
+
```

### Comparing `amilib-0.0.5/test/test_wikidata.py` & `amilib-0.0.6/test/test_wikidata.py`

 * *Files identical despite different names*

### Comparing `amilib-0.0.5/test/test_xml.py` & `amilib-0.0.6/test/test_xml.py`

 * *Files identical despite different names*

